<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Build Lifecycles"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Build Lifecycles</h1></div></div></div><p>A Maven build lifecycle consists of a set of well-defined phases. Each phase groups a set of goals defined by Maven plugins, and the lifecycle defines the order of execution. A Maven plugin is a collection of goals where each goal is responsible for performing a specific action. We discussed Maven plugins in detail in <a class="link" href="ch04.html" title="Chapter 4. Maven Plugins">Chapter 4</a>, <span class="emphasis"><em>Maven Plugins</em></span>.</p><p>In this chapter, the following topics will be covered:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Standard lifecycles in Maven</li><li class="listitem" style="list-style-type: disc">Lifecycle bindings</li><li class="listitem" style="list-style-type: disc">Building custom lifecycle extensions</li></ul></div><p>The following figure shows the relationship between Maven plugin goals and lifecycle phases:</p><div class="mediaobject"><img src="graphics/B02157_05_01.jpg" alt="Build Lifecycles"/></div><p>Let's take the simplest Maven build command that every Java developer is familiar with:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean install</strong></span>
</pre></div><p>What will this do? As a developer, how many times have you executed the previous command? Have you ever thought of what happens inside? If not, it's time to explore it now.</p><div class="section" title="Standard lifecycles in Maven"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec37"/>Standard lifecycles in Maven</h1></div></div></div><p>Maven comes <a id="id228" class="indexterm"/>with three standard lifecycles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">clean</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">default</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">site</code></li></ul></div><p>Each lifecycle defines its own set of phases.</p><div class="section" title="The clean lifecycle"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec38"/>The clean lifecycle</h2></div></div></div><p>The <code class="literal">clean</code> lifecycle <a id="id229" class="indexterm"/>defines three phases: <code class="literal">pre-clean</code>, <code class="literal">clean</code>, and <code class="literal">post-clean</code>. A phase in a lifecycle is just an ordered placeholder in the <a id="id230" class="indexterm"/>build execution path. For example, the <code class="literal">clean</code> phase in the <code class="literal">clean</code> lifecycle cannot do anything on its own. In the Maven architecture, it has two key elements: nouns and verbs. Both nouns and verbs, which are related to a given project, are defined in the POM file. The name of the project, the name of the parent project, the dependencies, and the type of packaging are nouns. Plugins bring verbs into the Maven build system, and they define what needs to be done during the build execution via its goals. A plugin is a group of goals. Each goal of a plugin can be executed on its own or can be registered as part of a phase in a Maven build lifecycle.</p><p>When you type <code class="literal">mvn clean</code>, it executes all the phases defined in the <code class="literal">clean</code> lifecycle up to and including the <code class="literal">clean</code> phase. Don't be confused; in this command, <code class="literal">clean</code> is not the name of the lifecycle it's the name of a phase. It's only a coincidence that the name of the phase happens to be the name of the lifecycle. In Maven, you cannot simply execute a lifecycle by its name—it has to be the name of a phase. Maven will find the corresponding lifecycle and will execute all phases in it up to the given phase (including that phase).</p><p>When you type <code class="literal">mvn clean</code>, it cleans out project's working directory (by default, it's the <code class="literal">target</code> directory). This is done via the Maven <code class="literal">clean</code> plugin. To find more details about the Maven <code class="literal">clean</code> plugin, type the following command. It describes all the goals defined inside the <code class="literal">clean</code> plugin:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn help:describe -Dplugin=clean</strong></span>

<span class="strong"><strong>Name: Maven Clean Plugin</strong></span>
<span class="strong"><strong>Description: The Maven Clean Plugin is a plugin that removes files generated at build-time in a project's directory.</strong></span>
<span class="strong"><strong>Group Id: org.apache.maven.plugins</strong></span>
<span class="strong"><strong>Artifact Id: maven-clean-plugin</strong></span>
<span class="strong"><strong>Version: 2.5</strong></span>
<span class="strong"><strong>Goal Prefix: clean</strong></span>

<span class="strong"><strong>This plugin has 2 goals.</strong></span>

<span class="strong"><strong>clean:clean</strong></span>

<span class="strong"><strong>Description: Goal, which cleans the build. This attempts to clean a project's working directory of the files that were generated at build-time. By default, it discovers and deletes the directories configured in project.build.directory, project.build.outputDirectory, project.build.testOutputDirectory, andproject.reporting.outputDirectory.Files outside the default may also be included in the deletion by configuring the filesets tag.</strong></span>

<span class="strong"><strong>clean:help</strong></span>

<span class="strong"><strong>Description: Display help information on maven-clean-plugin.Call</strong></span>
<span class="strong"><strong>mvn clean:help -Ddetail=true -Dgoal=&lt;goal-name&gt; to display parameter details.</strong></span>

<span class="strong"><strong>For more information, run 'mvn help:describe [...] -Ddetail'</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note29"/>Note</h3><p>Everything in Maven is a plugin. Even the command we executed previously to get goal details of the <code class="literal">clean</code> plugin executes another plugin—the <code class="literal">help</code> plugin. The following command will describe the <code class="literal">help</code> plugin:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn help:describe -Dplugin=help</strong></span>
</pre></div><p>
<code class="literal">describe</code> is a goal defined inside the <code class="literal">help</code> plugin.</p></div></div><p>The <code class="literal">clean</code> plugin<a id="id231" class="indexterm"/> has two goals defined in it: <code class="literal">clean</code> and <code class="literal">help</code>. As<a id="id232" class="indexterm"/> mentioned previously, each goal of a plugin can be executed on its own or can be registered as part of a phase in a Maven build lifecycle. The <code class="literal">clean</code> goal of the <code class="literal">clean</code> plugin can be executed on its own with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean:clean</strong></span>
</pre></div><p>The following figure shows the relationship between the Maven <code class="literal">clean</code> plugin goals and the <code class="literal">clean</code> lifecycle phases:</p><div class="mediaobject"><img src="graphics/B02157_05_02.jpg" alt="The clean lifecycle"/></div><p>The first instance of the <code class="literal">clean</code> word in the previous command is the prefix of the <code class="literal">clean</code> plugin, while the <a id="id233" class="indexterm"/>second one is the name of the goal. When you <a id="id234" class="indexterm"/>type <code class="literal">mvn clean</code>, it's the same <code class="literal">clean</code> goal that gets executed. However, this time, it gets executed through the <code class="literal">clean</code> phase of the <code class="literal">clean</code> lifecycle, and it also executes all the phases in the corresponding lifecycle up to, and including, the <code class="literal">clean</code> phase—not just the <code class="literal">clean</code> phase. The <code class="literal">clean</code> goal of the <code class="literal">clean</code> plugin is configured by default to get executed during the <code class="literal">clean</code> phase of the <code class="literal">clean</code> lifecycle. The plugin goal to lifecycle phase mapping can be provided through the application POM file; if not, it will be inherited from the super POM file. The super POM file, which defines the <code class="literal">clean</code> plugin by default, adds the plugin to the <code class="literal">clean</code> phase of the <code class="literal">clean</code> lifecycle. You cannot define a phase with the same name in two different lifecycles.</p><p>The following code snippet shows how the <code class="literal">clean</code> goal of the Maven <code class="literal">clean</code> plugin is associated with the <code class="literal">clean</code> phase of the <code class="literal">clean</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
   &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
   &lt;version&gt;2.5&lt;/version&gt;
   &lt;executions&gt;
      &lt;execution&gt;
         &lt;id&gt;default-clean&lt;/id&gt;
         &lt;phase&gt;clean&lt;/phase&gt;
         &lt;goals&gt;
            &lt;goal&gt;clean&lt;/goal&gt;
         &lt;/goals&gt;
      &lt;/execution&gt;
   &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>The <code class="literal">pre-clean</code> and <code class="literal">post-clean</code> phases of the <code class="literal">clean</code> lifecycle do not have any plugin bindings. The <a id="id235" class="indexterm"/>objective of the <code class="literal">pre-clean</code> phase is to<a id="id236" class="indexterm"/> perform any operations prior to the cleaning task and the objective of the <code class="literal">post-clean</code> phase is to perform any operations after the cleaning task. If you need to associate any plugins with these two phases, you simply need to add them to the corresponding plugin configuration.</p></div><div class="section" title="The default lifecycle"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec39"/>The default lifecycle</h2></div></div></div><p>The <code class="literal">default</code> lifecycle <a id="id237" class="indexterm"/>in Maven defines 23 phases. When you run<a id="id238" class="indexterm"/> the <code class="literal">mvn clean install</code> command, it will execute all the phases from the <code class="literal">default</code> lifecycle up to, and including, the <code class="literal">install</code> phase. To be precise, Maven will first execute all the phases in the <code class="literal">clean</code> lifecycle up to, and including, the <code class="literal">clean</code> phase, and it will then execute the <code class="literal">default</code> lifecycle up to, and including, the <code class="literal">install</code> phase.</p><p>The phases in the <code class="literal">default</code> lifecycle do not have any associated plugin goals. The plugin bindings for each phase are defined by the corresponding packaging (that is, <code class="literal">jar</code> or <code class="literal">war</code>). If the type of packaging of your Maven project is <code class="literal">jar</code>, then it will define its own set of plugins for each phase. If the packaging type is <code class="literal">war</code>, then it will have its own set of plugins. The following points summarize all the phases defined under the <code class="literal">default</code> lifecycle in their order of execution:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">validate</code>: This phase <a id="id239" class="indexterm"/>validates the project POM file and ensures that all the necessary information related to carrying out the build is available.</li><li class="listitem" style="list-style-type: disc"><code class="literal">initialize</code>: This<a id="id240" class="indexterm"/> phase initializes the build by setting up the right directory structure and initializing properties.</li><li class="listitem" style="list-style-type: disc"><code class="literal">generate-sources</code>: This <a id="id241" class="indexterm"/>phase generates any required source code.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-sources</code>: This phase processes the generated source code; for example, there<a id="id242" class="indexterm"/> can be a plugin running in this phase to filter the source code based on some defined criteria.</li><li class="listitem" style="list-style-type: disc"><code class="literal">generate-resources</code>: This phase generates any resources that need to be packaged <a id="id243" class="indexterm"/>with the final artifact.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-resources</code>: This phase processes the generated resources. It copies the<a id="id244" class="indexterm"/> resources to their destination directories and makes them ready for packaging.</li><li class="listitem" style="list-style-type: disc"><code class="literal">compile</code>: This<a id="id245" class="indexterm"/> phase compiles the source code.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-classes</code>: This phase can be used to carry out any bytecode enhancements<a id="id246" class="indexterm"/> after the <code class="literal">compile</code> phase.</li><li class="listitem" style="list-style-type: disc"><code class="literal">generate-test-sources</code>: This<a id="id247" class="indexterm"/> phase generates the required source code for tests.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-test-sources</code>: This phase processes the generated test source code; for <a id="id248" class="indexterm"/>example, there can be a plugin running in this phase to filter the source code based on some defined criteria.</li><li class="listitem" style="list-style-type: disc"><code class="literal">generate-test-resources</code>: This phase generates all the resources required to<a id="id249" class="indexterm"/> run tests.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-test-resources</code>: This <a id="id250" class="indexterm"/>phase processes the generated test resources. It copies the resources to their destination directories and makes them ready <a id="id251" class="indexterm"/>for testing.</li><li class="listitem" style="list-style-type: disc"><code class="literal">test-compile</code>: This<a id="id252" class="indexterm"/> phase compiles the<a id="id253" class="indexterm"/> source code for tests.</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-test-classes</code>: This phase can be used to carry out any bytecode enhancements<a id="id254" class="indexterm"/> after the <code class="literal">test-compile</code> phase.</li><li class="listitem" style="list-style-type: disc"><code class="literal">test</code>: This<a id="id255" class="indexterm"/> phase executes tests using the appropriate unit test framework.</li><li class="listitem" style="list-style-type: disc"><code class="literal">prepare-package</code>: This<a id="id256" class="indexterm"/> phase is useful in organizing the artifacts to be packaged.</li><li class="listitem" style="list-style-type: disc"><code class="literal">package</code>: This <a id="id257" class="indexterm"/>phase packs the artifacts into a distributable format, for example, JAR or WAR.</li><li class="listitem" style="list-style-type: disc"><code class="literal">pre-integration-test</code>: This phase performs the actions required (if any) before <a id="id258" class="indexterm"/>running integration tests. This may be used to start any external application servers and deploy the artifacts into different test environments.</li><li class="listitem" style="list-style-type: disc"><code class="literal">integration-test</code>: This<a id="id259" class="indexterm"/> phase runs integration tests.</li><li class="listitem" style="list-style-type: disc"><code class="literal">post-integration-test</code>: This phase can be used to perform any cleanup tasks after<a id="id260" class="indexterm"/> running the integration tests.</li><li class="listitem" style="list-style-type: disc"><code class="literal">verify</code>: This<a id="id261" class="indexterm"/> phase verifies the validity of the package. The criteria to check the validity needs to be defined by the respective plugins.</li><li class="listitem" style="list-style-type: disc"><code class="literal">install</code>: This<a id="id262" class="indexterm"/> phase installs the final artifact in the local repository.</li><li class="listitem" style="list-style-type: disc"><code class="literal">deploy</code>: This <a id="id263" class="indexterm"/>phase deploys the final artifact to a remote repository.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note31"/>Note</h3><p>The packaging type of a given Maven project is defined under the <code class="literal">&lt;packaging&gt;</code> element in the <code class="literal">pom.xml</code> file. If the element is omitted, then Maven assumes it as a <code class="literal">jar</code> packaging.</p></div></div><p>The following figure <a id="id264" class="indexterm"/>shows all the phases defined under the Maven <code class="literal">default</code> lifecycle <a id="id265" class="indexterm"/>and their order of execution:</p><div class="mediaobject"><img src="graphics/B02157_05_03.jpg" alt="The default lifecycle"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>More details<a id="id266" class="indexterm"/> about Maven lifecycles can be found at <a class="ulink" href="http://maven.apache.org/ref/3.3.3/maven-core/lifecycles.html">http://maven.apache.org/ref/3.3.3/maven-core/lifecycles.html</a>.</p></div></div><p>Let's take a<a id="id267" class="indexterm"/> look at a concrete example. Run the following command against a <a id="id268" class="indexterm"/>Maven project having the <code class="literal">jar</code> packaging:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn help:describe -Dcmd=deploy</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>If you do not have such a project, you can download a sample Maven project from <a class="ulink" href="https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter05/jose/">https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter05/jose/</a>.</p></div></div><p>Here, we are <a id="id269" class="indexterm"/>using the Maven <code class="literal">help</code> plugin to find more details about<a id="id270" class="indexterm"/> the <code class="literal">deploy</code> phase corresponding to the <code class="literal">jar</code> packaging, and it will produce the following output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>It is a part of the lifecycle for the POM packaging 'jar'. This lifecycle includes the following phases:</strong></span>

<span class="strong"><strong>* validate: Not defined</strong></span>
<span class="strong"><strong>* initialize: Not defined</strong></span>
<span class="strong"><strong>* generate-sources: Not defined</strong></span>
<span class="strong"><strong>* process-sources: Not defined</strong></span>
<span class="strong"><strong>* generate-resources: Not defined</strong></span>
<span class="strong"><strong>* process-resources: org.apache.maven.plugins:maven-resources-plugin:2.6:resources</strong></span>
<span class="strong"><strong>* compile: org.apache.maven.plugins:maven-compiler-plugin:2.5.1:compile</strong></span>
<span class="strong"><strong>* process-classes: Not defined</strong></span>
<span class="strong"><strong>* generate-test-sources: Not defined</strong></span>
<span class="strong"><strong>* process-test-sources: Not defined</strong></span>
<span class="strong"><strong>* generate-test-resources: Not defined</strong></span>
<span class="strong"><strong>* process-test-resources: org.apache.maven.plugins:maven-resources-plugin:2.6:testResources</strong></span>
<span class="strong"><strong>* test-compile: org.apache.maven.plugins:maven-compiler-plugin:2.5.1:testCompile</strong></span>
<span class="strong"><strong>* process-test-classes: Not defined</strong></span>
<span class="strong"><strong>* test: org.apache.maven.plugins:maven-surefire-plugin:2.12.4:test</strong></span>
<span class="strong"><strong>* prepare-package: Not defined</strong></span>
<span class="strong"><strong>* package: org.apache.maven.plugins:maven-jar-plugin:2.4:jar</strong></span>
<span class="strong"><strong>* pre-integration-test: Not defined</strong></span>
<span class="strong"><strong>* integration-test: Not defined</strong></span>
<span class="strong"><strong>* post-integration-test: Not defined</strong></span>
<span class="strong"><strong>* verify: Not defined</strong></span>
<span class="strong"><strong>* install: org.apache.maven.plugins:maven-install-plugin:2.4:install</strong></span>
<span class="strong"><strong>* deploy: org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy</strong></span>
</pre></div><p>The output lists out all the Maven plugins registered against different phases of the <code class="literal">default</code> lifecycle for the <code class="literal">jar</code> packaging. The <code class="literal">jar</code> goal of <code class="literal">maven-jar-plugin</code> is registered against the <code class="literal">package</code> phase, while the <code class="literal">install</code> goal of <code class="literal">maven-install-plugin</code> is registered in the <code class="literal">install</code> phase.</p><p>Let's run the <a id="id271" class="indexterm"/>previous command against a POM file having <a id="id272" class="indexterm"/>the <code class="literal">war</code> packaging. It produces the following output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>It is a part of the lifecycle for the POM packaging 'war'. This life includes the following phases:</strong></span>
<span class="strong"><strong>* validate: Not defined</strong></span>
<span class="strong"><strong>* initialize: Not defined</strong></span>
<span class="strong"><strong>* generate-sources: Not defined</strong></span>
<span class="strong"><strong>* process-sources: Not defined</strong></span>
<span class="strong"><strong>* generate-resources: Not defined</strong></span>
<span class="strong"><strong>* process-resources: org.apache.maven.plugins:maven-resources-plugin:2.6:resources</strong></span>
<span class="strong"><strong>* compile: org.apache.maven.plugins:maven-compiler-plugin:2.5.1:compile</strong></span>
<span class="strong"><strong>* process-classes: Not defined</strong></span>
<span class="strong"><strong>* generate-test-sources: Not defined</strong></span>
<span class="strong"><strong>* process-test-sources: Not defined</strong></span>
<span class="strong"><strong>* generate-test-resources: Not defined</strong></span>
<span class="strong"><strong>* process-test-resources: org.apache.maven.plugins:maven-resources-plugin:2.6:testResources</strong></span>
<span class="strong"><strong>* test-compile: org.apache.maven.plugins:maven-compiler-plugin:2.5.1:testCompile</strong></span>
<span class="strong"><strong>* process-test-classes: Not defined</strong></span>
<span class="strong"><strong>* test: org.apache.maven.plugins:maven-surefire-plugin:2.12.4:test</strong></span>
<span class="strong"><strong>* prepare-package: Not defined</strong></span>
<span class="strong"><strong>* package: org.apache.maven.plugins:maven-war-plugin:2.2:war</strong></span>
<span class="strong"><strong>* pre-integration-test: Not defined</strong></span>
<span class="strong"><strong>* integration-test: Not defined</strong></span>
<span class="strong"><strong>* post-integration-test: Not defined</strong></span>
<span class="strong"><strong>* verify: Not defined</strong></span>
<span class="strong"><strong>* install: org.apache.maven.plugins:maven-install-plugin:2.4:install</strong></span>
<span class="strong"><strong>* deploy: org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy</strong></span>
</pre></div><p>Now, if you look at the <code class="literal">package</code> phase, you will notice that we have a different plugin goal: the <code class="literal">war</code> goal of <code class="literal">maven-war-plugin</code>.</p><p>Similar to the <code class="literal">jar</code> and <code class="literal">war</code> packaging, each of the other packaging type defines its own binding for the <code class="literal">default</code> lifecycle.</p></div><div class="section" title="The site lifecycle"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec40"/>The site lifecycle</h2></div></div></div><p>The <code class="literal">site</code> lifecycle<a id="id273" class="indexterm"/> is defined with four phases: <code class="literal">pre-site</code>, <code class="literal">site</code>, <code class="literal">post-site</code>, and <code class="literal">site-deploy</code>. The <code class="literal">site</code> lifecycle has no value without the Maven <code class="literal">site</code> plugin. The <code class="literal">site</code> plugin<a id="id274" class="indexterm"/> is used to generate static HTML content for a project. The generated HTML content will also include appropriate reports corresponding to the project. The <code class="literal">site</code> plugin defines eight goals, and two of them are directly associated with the phases in the <code class="literal">site</code> lifecycle.</p><p>Let's run the following command against a POM file to describe the site goal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn help:describe -Dcmd=site</strong></span>
</pre></div><p>As shown in the <a id="id275" class="indexterm"/>following output, the <code class="literal">site</code> goal of the <code class="literal">site</code> plugin is associated <a id="id276" class="indexterm"/>with the <code class="literal">site</code> phase, while the <code class="literal">deploy</code> goal of the <code class="literal">site</code> plugin is associated with the <code class="literal">site-deploy</code> phase:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[INFO] 'site' is a lifecycle with the following phases: </strong></span>
<span class="strong"><strong>* pre-site: Not defined</strong></span>
<span class="strong"><strong>* site: org.apache.maven.plugins:maven-site-plugin:3.3:site</strong></span>
<span class="strong"><strong>* post-site: Not defined</strong></span>
<span class="strong"><strong>* site-deploy: org.apache.maven.plugins:maven-site-plugin:3.3:deploy</strong></span>
</pre></div><p>The following figure shows the relationship between the Maven <code class="literal">site</code> plugin goals and the <code class="literal">site</code> lifecycle phases:</p><div class="mediaobject"><img src="graphics/B02157_05_04.jpg" alt="The site lifecycle"/></div></div></div></div>
<div class="section" title="Lifecycle bindings"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec38"/>Lifecycle bindings</h1></div></div></div><p>Under the discussion of the <code class="literal">default</code> lifecycle, we briefly touched upon the concept of lifecycle bindings. The <code class="literal">default</code> lifecycle is defined without any associated lifecycle bindings, while<a id="id277" class="indexterm"/> both the <code class="literal">clean</code> and <code class="literal">site</code> lifecycles are defined with bindings. The standard Maven lifecycles and their associated bindings are defined under the file <code class="literal">META-INF/plex/components.xml</code> of <code class="literal">MAVEN_HOME/lib/maven-core-3.3.3.jar</code>.</p><p>Here is the <a id="id278" class="indexterm"/>configuration for the <code class="literal">default</code> lifecycle without any associated plugin bindings:</p><div class="informalexample"><pre class="programlisting">&lt;component&gt;  
  &lt;role&gt;org.apache.maven.lifecycle.Lifecycle&lt;/role&gt;
  &lt;implementation&gt;
    <span class="strong"><strong>org.apache.maven.lifecycle.Lifecycle</strong></span>                                           
  &lt;/implementation&gt;
  &lt;role-hint&gt;default&lt;/role-hint&gt;
  &lt;configuration&gt;
    &lt;id&gt;default&lt;/id&gt;
    &lt;phases&gt;
      &lt;phase&gt;validate&lt;/phase&gt;
      &lt;phase&gt;initialize&lt;/phase&gt;
      &lt;phase&gt;generate-sources&lt;/phase&gt;
      &lt;phase&gt;process-sources&lt;/phase&gt;
      &lt;phase&gt;generate-resources&lt;/phase&gt;
      &lt;phase&gt;process-resources&lt;/phase&gt;
      &lt;phase&gt;compile&lt;/phase&gt;
      &lt;phase&gt;process-classes&lt;/phase&gt;
      &lt;phase&gt;generate-test-sources&lt;/phase&gt;
      &lt;phase&gt;process-test-sources&lt;/phase&gt;
      &lt;phase&gt;generate-test-resources&lt;/phase&gt;
      &lt;phase&gt;process-test-resources&lt;/phase&gt;
      &lt;phase&gt;test-compile&lt;/phase&gt;
      &lt;phase&gt;process-test-classes&lt;/phase&gt;
      &lt;phase&gt;test&lt;/phase&gt;
      &lt;phase&gt;prepare-package&lt;/phase&gt;
      &lt;phase&gt;package&lt;/phase&gt;
      &lt;phase&gt;pre-integration-test&lt;/phase&gt;
      &lt;phase&gt;integration-test&lt;/phase&gt;
      &lt;phase&gt;post-integration-test&lt;/phase&gt;
      &lt;phase&gt;verify&lt;/phase&gt;
      &lt;phase&gt;install&lt;/phase&gt;
      &lt;phase&gt;deploy&lt;/phase&gt;
    &lt;/phases&gt;       
  &lt;/configuration&gt;
&lt;/component&gt;</pre></div><p>The <code class="literal">components.xml</code> file, which<a id="id279" class="indexterm"/> is also known as the <span class="strong"><strong>component descriptor</strong></span>, describes the properties required by Maven to manage the lifecycle of a Maven project. The <code class="literal">role</code> element specifies the Java interface exposed by this lifecycle component and defines the type of the component. All the lifecycle components must have <code class="literal">org.apache.maven.lifecycle.Lifecycle</code> as the role. The <code class="literal">implementation</code> tag specifies the concrete implementation of the interface. The identity of a component is defined by the combination of the role and the <code class="literal">role-hint</code> elements. The <code class="literal">role-hint</code> element is not <a id="id280" class="indexterm"/>a mandatory element; however, if we have multiple elements of the same type, then we must define a <code class="literal">role-hint</code> element. Corresponding to Maven lifecycles, the name of the lifecycle is set as the value of the <code class="literal">role-hint</code> element.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>Maven uses <code class="literal">components.xml</code> to define more other components than Maven lifecycles. Based on the type of the component, the value of the <code class="literal">role</code> element is set.</p></div></div><p>The <code class="literal">clean</code> lifecycle is defined with an associated plugin binding to the <code class="literal">clean</code> goal of <code class="literal">maven-clean-plugin</code>. The plugin binding is defined under the element <code class="literal">default-phases</code>. The configuration is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;component&gt;
  &lt;role&gt;org.apache.maven.lifecycle.Lifecycle&lt;/role&gt;
  &lt;implementation&gt;
    <span class="strong"><strong>org.apache.maven.lifecycle.Lifecycle</strong></span>
  &lt;/implementation&gt;
  &lt;role-hint&gt;clean&lt;/role-hint&gt;
  &lt;configuration&gt;
    &lt;id&gt;clean&lt;/id&gt;
    &lt;phases&gt;
      &lt;phase&gt;pre-clean&lt;/phase&gt;
      &lt;phase&gt;clean&lt;/phase&gt;
      &lt;phase&gt;post-clean&lt;/phase&gt;
    &lt;/phases&gt;
    <span class="strong"><strong>&lt;default-phases&gt;</strong></span>
<span class="strong"><strong>      &lt;clean&gt;</strong></span>
<span class="strong"><strong>          org.apache.maven.plugins:maven-clean-plugin:2.4.1:clean </strong></span>
<span class="strong"><strong>      &lt;/clean&gt;  </strong></span>
<span class="strong"><strong>    &lt;/default-phases&gt;</strong></span>
  &lt;/configuration&gt;
&lt;/component&gt;</pre></div><p>The <code class="literal">site</code> lifecycle is defined with associated plugin bindings to the <code class="literal">site</code> and <code class="literal">site-deploy</code> goals of <code class="literal">maven-site-plugin</code>. The plugin bindings are defined under the <code class="literal">default-phases</code> element, with the following configuration:</p><div class="informalexample"><pre class="programlisting">&lt;component&gt;
  &lt;role&gt;org.apache.maven.lifecycle.Lifecycle&lt;/role&gt;
  &lt;implementation&gt;
    <span class="strong"><strong>org.apache.maven.lifecycle.Lifecycle</strong></span>
  &lt;/implementation&gt;
  &lt;role-hint&gt;site&lt;/role-hint&gt;
  &lt;configuration&gt;
    &lt;id&gt;site&lt;/id&gt;
    &lt;phases&gt;
      &lt;phase&gt;pre-site&lt;/phase&gt;
      &lt;phase&gt;site&lt;/phase&gt;
      &lt;phase&gt;post-site&lt;/phase&gt;
      &lt;phase&gt;site-deploy&lt;/phase&gt;
    &lt;/phases&gt;
    <span class="strong"><strong>&lt;default-phases&gt;</strong></span>
<span class="strong"><strong>      &lt;site&gt;</strong></span>
<span class="strong"><strong>        org.apache.maven.plugins:maven-site-plugin:2.0.1:site</strong></span>
<span class="strong"><strong>      &lt;/site&gt;</strong></span>
<span class="strong"><strong>      &lt;site-deploy&gt;</strong></span>
<span class="strong"><strong>        org.apache.maven.plugins:maven-site-plugin:2.0.1:deploy</strong></span>
<span class="strong"><strong>      &lt;/site-deploy&gt;</strong></span>
<span class="strong"><strong>    &lt;/default-phases&gt;</strong></span>
  &lt;/configuration&gt;
&lt;/component&gt;</pre></div><p>Finally, let's<a id="id281" class="indexterm"/> take a look at how the <code class="literal">jar</code> plugin binding for the <code class="literal">default</code> lifecycle is defined. The following <code class="literal">component</code> element defines a plugin binding to an existing lifecycle. The associated lifecycle is defined under the <code class="literal">configuration/lifecycles/lifecycle/id</code> element:</p><div class="informalexample"><pre class="programlisting">&lt;component&gt;  
  &lt;role&gt;
      org.apache.maven.lifecycle.mapping.LifecycleMapping  
  &lt;/role&gt;
  &lt;role-hint&gt;jar&lt;/role-hint&gt;      
  &lt;implementation&gt;<span class="strong"><strong>org.apache.maven.lifecycle.mapping.DefaultLifecycleMapping</strong></span>
  &lt;/implementation&gt;
  &lt;configuration&gt;
    &lt;lifecycles&gt;
      &lt;lifecycle&gt;
       <span class="strong"><strong>&lt;id&gt;default&lt;/id&gt;</strong></span>
        &lt;phases&gt;
          &lt;process-resources&gt;
            org.apache.maven.plugins:maven-resources-plugin:2.4.3:resources
          &lt;/process-resources&gt;
          &lt;compile&gt;
            org.apache.maven.plugins:maven-compiler-plugin:2.3.2:compile
          &lt;/compile&gt;
          &lt;process-test-resources&gt;
            org.apache.maven.plugins:maven-resources-plugin:2.4.3:testResources
          &lt;/process-test-resources&gt;
          &lt;test-compile&gt;
            org.apache.maven.plugins:maven-compiler-plugin:2.3.2:testCompile
          &lt;/test-compile&gt;
          &lt;test&gt;
            org.apache.maven.plugins:maven-surefire-plugin:2.5:test
          &lt;/test&gt;
          &lt;package&gt;
            org.apache.maven.plugins:maven-jar-plugin:2.3.1:jar
          &lt;/package&gt;
          &lt;install&gt;
            org.apache.maven.plugins:maven-install-plugin:2.3.1:install
          &lt;/install&gt;
          &lt;deploy&gt;
            org.apache.maven.plugins:maven-deploy-plugin:2.5:deploy
          &lt;/deploy&gt;
        &lt;/phases&gt;            
      &lt;/lifecycle&gt;
    &lt;/lifecycles&gt;
  &lt;/configuration&gt;
&lt;/component&gt;</pre></div></div>
<div class="section" title="Lifecycle extensions"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec39"/>Lifecycle extensions</h1></div></div></div><p>The lifecycle extensions in Maven allow you to customize the standard build behavior. Let's take <a id="id282" class="indexterm"/>a look at the <code class="literal">org.apache.maven.AbstractMavenLifecycleParticipant</code> class. A custom lifecycle extension should extend from the <code class="literal">AbstractMavenLifecycleParticipant</code> class, which provides the following three methods that you can override:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">afterProjectsRead(MavenSession session)</code>: This method is invoked after all the Maven project instances have been created. There will be one project instance for each POM file. In a large-scale build system, you have one parent POM and it points to multiple child POM files.</li><li class="listitem" style="list-style-type: disc"><code class="literal">afterSessionEnd(MavenSession session)</code>: This method is invoked after all Maven projects are built.</li><li class="listitem" style="list-style-type: disc"><code class="literal">afterSessionStart(MavenSession session)</code>: This method is invoked after the <code class="literal">MavenSession</code> instance is created.</li></ul></div><p>Let's try out<a id="id283" class="indexterm"/> the following example:</p><div class="informalexample"><pre class="programlisting">package com.packt.lifecycle.ext;

import org.apache.maven.AbstractMavenLifecycleParticipant;
import org.apache.maven.MavenExecutionException;
import org.apache.maven.execution.MavenSession;
import org.codehaus.plexus.component.annotations.Component;

@Component(role = AbstractMavenLifecycleParticipant.class, hint ="packt")
public class PACKTLifeCycleExtension extends AbstractMavenLifecycleParticipant {

 @Override
  public void afterProjectsRead(MavenSession session) {

   System.out.println("All Maven project instances are created.");
   System.out.println("Offline building: " + session.isOffline());
  }

  @Override
  public void afterSessionEnd(MavenSession session) 
                      throws MavenExecutionException {
   System.out.println("All Maven projects are built.");
  }
}</pre></div><p>The previous code can be built with the following application POM file:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;com.packt.lifecycle.ext&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;
      &lt;artifactId&gt;maven-compat&lt;/artifactId&gt;
      &lt;version&gt;3.2.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.maven&lt;/groupId&gt;
      &lt;artifactId&gt;maven-core&lt;/artifactId&gt;
      &lt;version&gt;3.2.1&lt;/version&gt;
   &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      <span class="strong"><strong>&lt;plugin&gt;</strong></span>
<span class="strong"><strong>        &lt;groupId&gt;org.codehaus.plexus&lt;/groupId&gt;</strong></span>
<span class="strong"><strong>        &lt;artifactId&gt;plexus-component-metadata&lt;/artifactId&gt;</strong></span>
<span class="strong"><strong>        &lt;version&gt;1.5.5&lt;/version&gt;</strong></span>
<span class="strong"><strong>  </strong></span>
<span class="strong"><strong>      &lt;executions&gt;</strong></span>
<span class="strong"><strong>          &lt;execution&gt;</strong></span>
<span class="strong"><strong>            &lt;goals&gt;</strong></span>
<span class="strong"><strong>              &lt;goal&gt;generate-metadata&lt;/goal&gt;</strong></span>
<span class="strong"><strong>              &lt;goal&gt;generate-test-metadata&lt;/goal&gt;</strong></span>
<span class="strong"><strong>            &lt;/goals&gt;</strong></span>
<span class="strong"><strong>          &lt;/execution&gt;</strong></span>
<span class="strong"><strong>        &lt;/executions&gt;</strong></span>
<span class="strong"><strong>      &lt;/plugin&gt;</strong></span>
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div><p>Here, in the<a id="id284" class="indexterm"/> POM file, we use the <code class="literal">plexus-component-metadata</code> plugin to generate the Plexus descriptor from the source tags and class annotations.</p><p>Once the extension project is built successfully with <code class="literal">mvn clean install</code>, we need to incorporate the extension to other Maven builds. You can do it in two ways; one is by adding it to the project POM as an extension, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;
    com.packt.lifecycle.ext.sample.project
  &lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;Custom Lifecycle Extension Project&lt;/name&gt;

  &lt;build&gt;
    &lt;extensions&gt;
      <span class="strong"><strong>&lt;extension&gt;</strong></span>
<span class="strong"><strong>        &lt;groupId&gt;com.packt&lt;/groupId&gt;</strong></span>
<span class="strong"><strong>        &lt;artifactId&gt;com.packt.lifecycle.ext&lt;/artifactId&gt;</strong></span>
<span class="strong"><strong>        &lt;version&gt;1.0.0&lt;/version&gt;</strong></span>
<span class="strong"><strong>      &lt;/extension&gt;</strong></span>
    &lt;/extensions&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div><p>Now, you <a id="id285" class="indexterm"/>can build the sample project with <code class="literal">mvn clean install</code>. It will produce the following output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[INFO] Scanning for projects...</strong></span>
<span class="strong"><strong>All Maven project instances are created.</strong></span>
<span class="strong"><strong>Offline building: false</strong></span>

<span class="strong"><strong>[INFO] --------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong>[INFO] --------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Total time: 1.328 s</strong></span>
<span class="strong"><strong>[INFO] Finished at: 2014-07-29T11:29:52+05:30</strong></span>
<span class="strong"><strong>[INFO] Final Memory: 6M/81M</strong></span>
<span class="strong"><strong>[INFO] --------------------------------------------------------------</strong></span>

<span class="strong"><strong>All Maven projects are built.</strong></span>
</pre></div><p>If you want to execute this extension for all your Maven projects without changing each and every POM file, then you need to add the lifecycle extension JAR file to <code class="literal">MAVEN_HOME/lib/ext</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>The complete<a id="id286" class="indexterm"/> source code corresponding to the lifecycle extension project can be downloaded from <a class="ulink" href="https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter05/">https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter05/</a>.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec40"/>Summary</h1></div></div></div><p>In this chapter, we focused on Maven lifecycles and explained how the three standard lifecycles work and how we can customize them. Later in the chapter, we discussed how to develop our own lifecycle extensions.</p><p>In the next chapter, we will discuss how to build Maven assemblies.</p></div></body></html>