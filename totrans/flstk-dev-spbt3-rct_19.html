<html><head></head><body>
  <div id="_idContainer306" class="Basic-Text-Frame">
    <h1 class="chapterNumber">16</h1>
    <h1 id="_idParaDest-201" class="chapterTitle">Securing Your Application</h1>
    <p class="normal">We will learn how to secure our application in this chapter. This chapter will explain how to implement authentication in our frontend when we are using <strong class="keyWord">JSON Web Token</strong> (<strong class="keyWord">JWT</strong>) authentication in the backend. First, we will switch on security in our backend to enable JWT authentication. Then, we will create a component for the login functionality. Finally, we will modify our CRUD functionalities to send the token in the request’s authorization header to the backend, and implement the logout functionality.</p>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Securing the backend</li>
      <li class="bulletList">Securing the frontend</li>
    </ul>
    <h1 id="_idParaDest-202" class="heading-1">Technical requirements</h1>
    <p class="normal">The Spring Boot application that we created in <em class="chapterRef">Chapter 5</em>, <em class="italic">Securing Your Backend</em>, is required (<a href="https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter05"><span class="url">https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter05</span></a>), as is the React app that we used in <em class="chapterRef">Chapter 14</em>, <em class="italic">Styling the Frontend with React MUI</em> (<a href="https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter14"><span class="url">https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter14</span></a>).</p>
    <p class="normal">The following GitHub link for this chapter will also be useful: <a href="https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter16"><span class="url">https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter16</span></a>.</p>
    <h1 id="_idParaDest-203" class="heading-1">Securing the backend</h1>
    <p class="normal">In <em class="chapterRef">Chapter 13</em>, we implemented CRUD functionalities<a id="_idIndexMarker795"/> in our frontend using an unsecured backend. Now, it is time to switch on security for our backend and go back to the version that we created in <em class="chapterRef">Chapter 5</em>, <em class="italic">Securing Your Backend</em>:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open your backend project with the Eclipse IDE and open the <code class="inlineCode">SecurityConfig.java</code> file in the editor view. We have commented the security out and allowed everyone access to all endpoints. Now, we can remove that line and also remove the comments from the original version. Now, the <code class="inlineCode">filterChain()</code> method of your <code class="inlineCode">SecurityConfig.java</code> file should look like the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> SecurityFilterChain <span class="hljs-title">filterChain</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
  http.csrf((csrf) -&gt; csrf.disable()) .cors(withDefaults())
    .sessionManagement((sessionManagement) -&gt;
      sessionManagement.sessionCreationPolicy(
      SessionCreationPolicy.STATELESS))
    .authorizeHttpRequests( (authorizeHttpRequests) -&gt;
      authorizeHttpRequests.requestMatchers(HttpMethod.POST, <span class="hljs-string">"/</span>
<span class="hljs-string">      login"</span>).permitAll().anyRequest().authenticated())
    .addFilterBefore(authenticationFilter,
      UsernamePasswordAuthenticationFilter.class)
    .exceptionHandling((exceptionHandling) -&gt;
      exceptionHandling.authenticationEntryPoint(exceptionHandler));
  <span class="hljs-keyword">return</span> http.build();
}
</code></pre>
      </li>
      <li class="numberedList">Let’s test what happens when the backend is secured again. Run the backend by pressing the <strong class="screenText">Run</strong> button in Eclipse, and check from the console view that the application started correctly. Run the frontend by typing the <code class="inlineCode">npm run dev</code> command into your terminal, and the browser should be opened to the address <code class="inlineCode">localhost:5173</code>.</li>
      <li class="numberedList">You should now see that the list page and the car list are loading. If you open the developer tools and the <strong class="screenText">Network</strong> tab, you will notice that the response status is <strong class="screenText">401 Unauthorized</strong>. This is actually what we want because we haven’t yet executed authentication in relation to our frontend:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_16_01.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.1: 401 Unauthorized</p>
    <p class="normal">Now, we are ready<a id="_idIndexMarker796"/> to work with the frontend.</p>
    <h1 id="_idParaDest-204" class="heading-1">Securing the frontend</h1>
    <p class="normal">In <em class="chapterRef">Chapter 5</em>, <em class="italic">Securing Your Backend</em>, we created JWT authentication<a id="_idIndexMarker797"/> and allowed everyone access to the <code class="inlineCode">/login</code> endpoint without authentication. Now, on the frontend login page, we have to send a <code class="inlineCode">POST</code> request to the <code class="inlineCode">/login</code> endpoint using user credentials to get a token. After that, the token will be included in all requests that we send to the backend, as demonstrated in the following figure:</p>
    <figure class="mediaobject"><img src="../Images/B19818_16_02.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.2: Secured application</p>
    <p class="normal">With this knowledge, we will start to implement login functionality on our frontend. We will implement the login page where the user enters credentials, and then we will send a login request to get a token<a id="_idIndexMarker798"/> from the server. We will use the stored token in the requests that we send to the server.</p>
    <h2 id="_idParaDest-205" class="heading-2">Creating a login component</h2>
    <p class="normal">Let’s first create a login component<a id="_idIndexMarker799"/> that asks for credentials from the user<a id="_idIndexMarker800"/> to get a token from the backend:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a new file called <code class="inlineCode">Login.tsx</code> in the <code class="inlineCode">components</code> folder. Now, the file structure of the frontend should be the following:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_16_03.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.3: Project structure</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Open the file in the VS Code editor<a id="_idIndexMarker801"/> view and add the following<a id="_idIndexMarker802"/> base code to the <code class="inlineCode">Login</code> component. We need <code class="inlineCode">axios</code> to send <code class="inlineCode">POST</code> requests to the <code class="inlineCode">/login</code> endpoint:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">Login</span>() {
  <span class="hljs-keyword">return</span>(
    <span class="hljs-tag">&lt;&gt;&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">Login</span>;
</code></pre>
      </li>
      <li class="numberedList">We need two states for the authentication: one for the credentials (username and password), and one boolean value to indicate the status of the authentication. We also create a type for the user state. The initial value of the authentication status state is <code class="inlineCode">false</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="code-highlight"><strong class="hljs-slc">type </strong><strong class="hljs-title-slc">User</strong><strong class="hljs-slc"> = {</strong></span>
  <span class="code-highlight"><strong class="hljs-attr-slc">username</strong><strong class="hljs-slc">: string;</strong></span>
  <span class="code-highlight"><strong class="hljs-attr-slc">password</strong><strong class="hljs-slc">: string;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
<span class="hljs-keyword">function</span> <span class="hljs-title">Login</span>() {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> [user, setUser] = useState&lt;</strong><strong class="hljs-title-slc">User</strong><strong class="hljs-slc">&gt;({</strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc">username</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">''</strong><strong class="hljs-slc">,</strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc">password</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">''</strong></span>
  <span class="code-highlight"><strong class="hljs-slc">});</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> [isAuthenticated, setAuth] = </strong><strong class="hljs-title-slc">useState</strong><strong class="hljs-slc">(</strong><strong class="hljs-literal-slc">false</strong><strong class="hljs-slc">);</strong></span>
  
  <span class="hljs-keyword">return</span>(
    <span class="hljs-tag">&lt;&gt;&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">Login</span>;
</code></pre>
      </li>
      <li class="numberedList">In the user<a id="_idIndexMarker803"/> interface, we are going to use the <strong class="keyWord">Material UI</strong> (<strong class="keyWord">MUI</strong>) component library, as we did with the rest<a id="_idIndexMarker804"/> of the user<a id="_idIndexMarker805"/> interface. We need <code class="inlineCode">TextField</code> components for the credentials, the <code class="inlineCode">Button</code> component to call a login function, and the <code class="inlineCode">Stack</code> component for layout. Add imports for the components to the <code class="inlineCode">Login.tsx</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-title">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Button'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">TextField</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/TextField'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">Stack</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Stack'</span>;
</code></pre>
    <div class="packt_tip">
      <p class="normal">We have already used all three of these component types in <em class="chapterRef">Chapter 14</em>, <em class="italic">Styling the Frontend with MUI</em>, to style our UI.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add the imported components to the <code class="inlineCode">return</code> statement. We need two <code class="inlineCode">TextField</code> components: one for the username and one for the password. One <code class="inlineCode">Button</code> component is needed to call the login function that we are going to implement later in this section. We use the <code class="inlineCode">Stack</code> component to align our <code class="inlineCode">TextField</code> components to the center and to get spacing between them:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">return</span>(
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Stack</span><span class="hljs-tag"> </span><span class="hljs-attr">spacing</span><span class="hljs-tag">=</span><span class="hljs-string">{2}</span><span class="hljs-tag"> </span><span class="hljs-attr">alignItems</span><span class="hljs-tag">=</span><span class="hljs-string">"center"</span><span class="hljs-tag"> </span><span class="hljs-attr">mt</span><span class="hljs-tag">=</span><span class="hljs-string">{2}</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">TextField</span>
<span class="hljs-tag">        </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"username"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">label</span><span class="hljs-tag">=</span><span class="hljs-string">"Username"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{handleChange}</span><span class="hljs-tag"> /&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">TextField</span>
<span class="hljs-tag">        </span><span class="hljs-attr">type</span><span class="hljs-tag">=</span><span class="hljs-string">"</span><span class="hljs-string">password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">label</span><span class="hljs-tag">=</span><span class="hljs-string">"Password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{handleChange}/</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">Button</span>
<span class="hljs-tag">        </span><span class="hljs-attr">variant</span><span class="hljs-tag">=</span><span class="hljs-string">"</span><span class="hljs-string">outlined"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">color</span><span class="hljs-tag">=</span><span class="hljs-string">"primary"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onClick</span><span class="hljs-tag">=</span><span class="hljs-string">{handleLogin}</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">          Login</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Button</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">    </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Stack</span><span class="hljs-tag">&gt;</span>
);
</code></pre>
      </li>
      <li class="numberedList">Implement the change handler<a id="_idIndexMarker806"/> function for the <code class="inlineCode">TextField</code> components, in order<a id="_idIndexMarker807"/> to save typed values to the states. You have to use the spread syntax because it ensures that you retain all the other properties of the <code class="inlineCode">user</code> object that are not modified in this update:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">handleChange</span> = (<span class="hljs-params">event: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;
  {
  <span class="hljs-title">setUser</span>({...user,
     [event.<span class="hljs-property">target</span>.<span class="hljs-property">name</span>] : event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
<span class="hljs-property">  </span>});
}
</code></pre>
      </li>
      <li class="numberedList">As shown in <em class="chapterRef">Chapter 5</em>, <em class="italic">Securing Your Backend</em>, the login is done by calling the <code class="inlineCode">/login</code> endpoint using the <code class="inlineCode">POST</code> method and sending the <code class="inlineCode">user</code> object inside the body. If authentication succeeds, we get a token in a response <code class="inlineCode">Authorization</code> header. We will then save the token to session storage and set the <code class="inlineCode">isAuthenticated</code> state value to <code class="inlineCode">true</code>.<div class="note">
          <p class="normal"><strong class="keyWord">Session storage</strong> is similar to local storage, but it is cleared<a id="_idIndexMarker808"/> when a page session ends (when the page is closed). <code class="inlineCode">localStorage</code> and <code class="inlineCode">sessionStorage</code> are properties of the <code class="inlineCode">Window</code> interface.</p>
        </div>
    <p class="normal">When the <code class="inlineCode">isAuthenticated</code> state value is changed, the user interface is re-rendered:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">handleLogin</span> = () =&gt; {
  axios.<span class="hljs-title">post</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span> + <span class="hljs-string">"/login"</span>, user, {
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  })
  .<span class="hljs-title">then</span>(<span class="hljs-params">res</span><span class="hljs-function"> =&gt;</span> {
    <span class="hljs-keyword">const</span> jwtToken = res.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>;
    <span class="hljs-keyword">if</span> (jwtToken !== <span class="hljs-literal">null</span>) {
      <span class="hljs-variable">sessionStorage</span>.<span class="hljs-title">setItem</span>(<span class="hljs-string">"jwt"</span>, jwtToken);
      <span class="hljs-title">setAuth</span>(<span class="hljs-literal">true</span>);
    }
  })
  .<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err));
}
</code></pre>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">We will implement some conditional<a id="_idIndexMarker809"/> rendering that renders the <code class="inlineCode">Login</code> component<a id="_idIndexMarker810"/> if the <code class="inlineCode">isAuthenticated</code> state is <code class="inlineCode">false</code>, or the <code class="inlineCode">Carlist</code> component if the <code class="inlineCode">isAuthenticated</code> state is <code class="inlineCode">true</code>. First, import the <code class="inlineCode">Carlist</code> component into the <code class="inlineCode">Login.tsx</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-title">Carlist</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Carlist'</span>;
</code></pre>
    <p class="normal">Then, implement the following changes to the <code class="inlineCode">return</code> statement:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> (isAuthenticated) {</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Carlist</strong><strong class="hljs-tag-slc"> /&gt;</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">else</strong><strong class="hljs-slc"> {</strong></span>
  <span class="hljs-keyword">return</span>(
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Stack</span><span class="hljs-tag"> </span><span class="hljs-attr">spacing</span><span class="hljs-tag">=</span><span class="hljs-string">{2}</span><span class="hljs-tag"> </span><span class="hljs-attr">alignItems</span><span class="hljs-tag">=</span><span class="hljs-string">"center"</span><span class="hljs-tag"> </span><span class="hljs-attr">mt</span><span class="hljs-tag">=</span><span class="hljs-string">{2}</span><span class="hljs-tag"> &gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">TextField</span>
<span class="hljs-tag">        </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"username"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">label</span><span class="hljs-tag">=</span><span class="hljs-string">"Username"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{handleChange}</span><span class="hljs-tag"> /&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">TextField</span>
<span class="hljs-tag">        </span><span class="hljs-attr">type</span><span class="hljs-tag">=</span><span class="hljs-string">"password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">label</span><span class="hljs-tag">=</span><span class="hljs-string">"Password"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{handleChange}/</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">Button</span>
<span class="hljs-tag">        </span><span class="hljs-attr">variant</span><span class="hljs-tag">=</span><span class="hljs-string">"outlined"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">color</span><span class="hljs-tag">=</span><span class="hljs-string">"primary"</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onClick</span><span class="hljs-tag">=</span><span class="hljs-string">{handleLogin}</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">          Login</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Button</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">    </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Stack</span><span class="hljs-tag">&gt;</span>
  );
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">To show the login<a id="_idIndexMarker811"/> form, we have to render the <code class="inlineCode">Login</code> component<a id="_idIndexMarker812"/> instead of the <code class="inlineCode">Carlist</code> component in the <code class="inlineCode">App.tsx</code> file. Import and render the <code class="inlineCode">Login</code> component and remove the unused <code class="inlineCode">Carlist</code> import:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// App.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title">AppBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/AppBar'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">Toolbar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Toolbar'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">Typography</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Typography'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">Container</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Container'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">CssBaseline</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/CssBaseline'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Login</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'./components/Login'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> { <span class="hljs-title">QueryClient</span>, <span class="hljs-title">QueryClientProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-</span>
<span class="hljs-string">  query'</span>;
<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title">QueryClient</span>();
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;</span><span class="hljs-name">Container</span><span class="hljs-tag"> </span><span class="hljs-attr">maxWidth</span><span class="hljs-tag">=</span><span class="hljs-string">"xl"</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">CssBaseline</span><span class="hljs-tag"> /&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">AppBar</span><span class="hljs-tag"> </span><span class="hljs-attr">position</span><span class="hljs-tag">=</span><span class="hljs-string">"static"</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">        </span><span class="hljs-tag">&lt;</span><span class="hljs-name">Toolbar</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">          </span><span class="hljs-tag">&lt;</span><span class="hljs-name">Typography</span><span class="hljs-tag"> </span><span class="hljs-attr">variant</span><span class="hljs-tag">=</span><span class="hljs-string">"h6"</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">            Carshop</span>
<span class="language-xml">          </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Typography</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">        </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Toolbar</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">AppBar</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">QueryClientProvider</span><span class="hljs-tag"> </span><span class="hljs-attr">client</span><span class="hljs-tag">=</span><span class="hljs-string">{queryClient}</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">        </span><span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Login</strong><strong class="hljs-tag-slc"> /&gt;</strong></span>
  <span class="language-xml">    </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">QueryClientProvider</span><span class="hljs-tag">&gt;</span>
<span class="language-xml">    </span><span class="hljs-tag">&lt;/</span><span class="hljs-name">Container</span><span class="hljs-tag">&gt;</span>
  )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
      </li>
    </ol>
    <p class="normal">Now, when your frontend<a id="_idIndexMarker813"/> and backend<a id="_idIndexMarker814"/> are running, your frontend should look like the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B19818_16_04.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.4: Login page</p>
    <p class="normal">If you log in using the <em class="italic">user</em>/<em class="italic">user</em> or <em class="italic">admin</em>/<em class="italic">admin</em> credentials that we have inserted into the database, you should see the car list page. If you open the developer tools’ <strong class="screenText">Application</strong> tab, you can see that the token<a id="_idIndexMarker815"/> is now saved to session<a id="_idIndexMarker816"/> storage:</p>
    <figure class="mediaobject"><img src="../Images/B19818_16_05.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.5: Session storage</p>
    <h2 id="_idParaDest-206" class="heading-2">Implementing REST API calls</h2>
    <p class="normal">At the end of the previous section, the car list<a id="_idIndexMarker817"/> is still loading and we can’t fetch cars. This is the correct<a id="_idIndexMarker818"/> behavior because we haven’t included the token in any requests yet. That is required for JWT authentication, which we will implement in the next phase:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">carapi.ts</code> file in the VS Code editor view. To fetch the cars, we first have to read the token from session storage and then add the <code class="inlineCode">Authorization</code> header with the token value to the <code class="inlineCode">GET</code> request. You can see the source code for the <code class="inlineCode">getCars</code> function here:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// carapi.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCars = <span class="hljs-keyword">async</span> (): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>[]&gt; =&gt; {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> token = </strong><strong class="hljs-variable-slc">sessionStorage</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">getItem</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">"jwt"</strong><strong class="hljs-slc">);</strong></span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">get</span>(<span class="hljs-string">`</span><span class="hljs-subst">${</span><span class="hljs-keyword">import</span><span class="hljs-subst">.meta.env.VITE_API_URL}</span><span class="hljs-string">/</span>
<span class="hljs-string">                   api/cars`</span>, <span class="code-highlight"><strong class="hljs-slc">{</strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc">headers</strong><strong class="hljs-slc">: { </strong><strong class="hljs-string-slc">'Authorization'</strong><strong class="hljs-slc"> : token }</strong></span>
  <span class="code-highlight"><strong class="hljs-slc">}</strong></span>);
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">_embedded</span>.<span class="hljs-property">cars</span>;
}
</code></pre>
      </li>
      <li class="numberedList">If you log in to your frontend, you should see the car list populated with cars from the database.</li>
      <li class="numberedList">Check the request content from the developer tools; you can see that it contains the <code class="inlineCode">Authorization</code> header with the token value:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_16_06.png" alt="Figure 14.6 – Request headers "/></figure>
    <p class="packt_figref">Figure 16.6: Request headers</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Modify the other CRUD functionalities in the same way so they work correctly. The source code for the <code class="inlineCode">deleteCar</code> function appears as follows, after the modifications:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// carapi.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">link</span>: string): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt;
{
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> token = </strong><strong class="hljs-variable-slc">sessionStorage</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">getItem</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">"jwt"</strong><strong class="hljs-slc">);</strong></span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">delete</span>(link, <span class="code-highlight"><strong class="hljs-slc">{</strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc">headers</strong><strong class="hljs-slc">: { </strong><strong class="hljs-string-slc">'</strong><strong class="hljs-string-slc">Authorization'</strong><strong class="hljs-slc">: token }</strong></span>
  <span class="code-highlight"><strong class="hljs-slc">}</strong></span>)
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal">The source code<a id="_idIndexMarker819"/> for the <code class="inlineCode">addCar</code> and <code class="inlineCode">editCar</code> functions appears<a id="_idIndexMarker820"/> as follows, after the modifications:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// carapi.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">car</span>: <span class="hljs-title">Car</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt; {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> token = </strong><strong class="hljs-variable-slc">sessionStorage</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">getItem</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">"jwt"</strong><strong class="hljs-slc">);</strong></span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">post</span>(<span class="hljs-string">`</span><span class="hljs-subst">${</span><span class="hljs-keyword">import</span><span class="hljs-subst">.meta.env.VITE_API_</span>
<span class="hljs-subst">                   URL}</span><span class="hljs-string">/api/cars`</span>, car, {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="code-highlight"><strong class="hljs-string-slc">'Authorization'</strong><strong class="hljs-slc">: token</strong></span>
    },
  });
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> updateCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">carEntry</span>: <span class="hljs-title">CarEntry</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt; {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> token = </strong><strong class="hljs-variable-slc">sessionStorage</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">getItem</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">"jwt"</strong><strong class="hljs-slc">);</strong></span>
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">put</span>(carEntry.<span class="hljs-property">url</span>, carEntry.<span class="hljs-property">car</span>, {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'</span><span class="hljs-string">Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      <span class="code-highlight"><strong class="hljs-string-slc">'Authorization'</strong><strong class="hljs-slc">: token</strong></span>
    },
  });
  
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
}
</code></pre>
    <h2 id="_idParaDest-207" class="heading-2">Refactoring duplicate code</h2>
    <p class="normal">Now, all the CRUD functionalities<a id="_idIndexMarker821"/> will work after you have logged in to the<a id="_idIndexMarker822"/> application. But, as you can see, we have quite a lot of duplicate code, such as the lines where we retrieve our token from session storage. We can do some refactoring to avoid repeating the same code and make our code easier to maintain:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, we will create a function that retrieves the token from session storage and creates a configuration object for Axios requests that contains headers with the token. Axios provides the <code class="inlineCode">AxiosRequestConfig</code> interface, which can be used to configure requests we send using Axios. We also set the <code class="inlineCode">content-type</code> header value to <code class="inlineCode">application/json</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// carapi.ts</span>
<span class="hljs-keyword">import</span> axios, { <span class="code-highlight"><strong class="hljs-title-slc">AxiosRequestConfig</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">CarResponse</span>, <span class="hljs-title">Car</span>, <span class="hljs-title">CarEntry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> getAxiosConfig = (): </strong><strong class="hljs-params-slc">AxiosRequestConfig</strong><strong class="hljs-function-slc"> =&gt;</strong><strong class="hljs-slc"> {</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> token = </strong><strong class="hljs-variable-slc">sessionStorage</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">getItem</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">"jwt"</strong><strong class="hljs-slc">);</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> {</strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc">headers</strong><strong class="hljs-slc">: {</strong></span>
      <span class="code-highlight"><strong class="hljs-string-slc">'Authorization'</strong><strong class="hljs-slc">: token,</strong></span>
      <span class="code-highlight"><strong class="hljs-string-slc">'Content-Type'</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">'application/json'</strong><strong class="hljs-slc">,</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">},</strong></span>
  <span class="code-highlight"><strong class="hljs-slc">};</strong></span>
<span class="code-highlight"><strong class="hljs-slc">};</strong></span>
</code></pre>
      </li>
      <li class="numberedList">Then, we can use the <code class="inlineCode">getAxiosConfig()</code> function without retrieving<a id="_idIndexMarker823"/> a token in each function, by removing<a id="_idIndexMarker824"/> the configuration object and calling the <code class="inlineCode">getAxiosConfig()</code> function instead, as shown in the following code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// carapi.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCars = <span class="hljs-keyword">async</span> (): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>[]&gt; =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">get</span>(<span class="hljs-string">`</span><span class="hljs-subst">${</span><span class="hljs-keyword">import</span><span class="hljs-subst">.meta.env.VITE_API_URL}</span><span class="hljs-string">/</span>
<span class="hljs-string">                   api/cars`</span>, <span class="code-highlight"><strong class="hljs-title-slc">getAxiosConfig</strong><strong class="hljs-slc">()</strong></span>);
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">_embedded</span>.<span class="hljs-property">cars</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">link</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt;
{
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">delete</span>(link, <span class="code-highlight"><strong class="hljs-title-slc">getAxiosConfig</strong><strong class="hljs-slc">()</strong></span>)
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">car</span>: <span class="hljs-title">Car</span>): <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">post</span>(<span class="hljs-string">`</span><span class="hljs-subst">${</span><span class="hljs-keyword">import</span><span class="hljs-subst">.meta.env.VITE_API_</span>
<span class="hljs-subst">                   URL}</span><span class="hljs-string">/api/cars`</span>, car, <span class="code-highlight"><strong class="hljs-title-slc">getAxiosConfig</strong><strong class="hljs-slc">()</strong></span>);
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> updateCar = <span class="hljs-keyword">async</span> (<span class="hljs-attr">carEntry</span>: <span class="hljs-title">CarEntry</span>):
  <span class="hljs-title">Promise</span>&lt;<span class="hljs-title">CarResponse</span>&gt; =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">put</span>(carEntry.<span class="hljs-property">url</span>, carEntry.<span class="hljs-property">car</span>,
                                   <span class="code-highlight"><strong class="hljs-title-slc">getAxiosConfig</strong><strong class="hljs-slc">()</strong></span>);
<span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
}
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="normal">Axios also provides <strong class="keyWord">interceptors</strong> that can be used to intercept<a id="_idIndexMarker825"/> and modify requests and responses before they are handled by <code class="inlineCode">then</code> or <code class="inlineCode">catch</code>. You can read<a id="_idIndexMarker826"/> more about interceptors in the Axios documentation: <a href="https://axios-http.com/docs/interceptors"><span class="url">https://axios-http.com/docs/interceptors</span></a>.</p>
    </div>
    <h2 id="_idParaDest-208" class="heading-2">Displaying an error message</h2>
    <p class="normal">In this phase, we are going to implement<a id="_idIndexMarker827"/> an error message that is shown to a user if authentication<a id="_idIndexMarker828"/> fails. We will use the <code class="inlineCode">Snackbar</code> MUI component to show the message:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Add the following import to the <code class="inlineCode">Login.tsx</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-title">Snackbar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'</span><span class="hljs-string">@mui/material/Snackbar'</span>;
</code></pre>
      </li>
      <li class="numberedList">Add a new state called <code class="inlineCode">open</code> to control the visibility of the <code class="inlineCode">Snackbar</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> [open, setOpen] = <span class="hljs-title">useState</span>(<span class="hljs-literal">false</span>);
</code></pre>
      </li>
      <li class="numberedList">Add the <code class="inlineCode">Snackbar</code> component to the <code class="inlineCode">return</code> statement, inside the stack just under the <code class="inlineCode">Button</code> component. The <code class="inlineCode">Snackbar</code> component is used to show toast messages. The component is shown if the <code class="inlineCode">open</code> prop value is <code class="inlineCode">true</code>. The <code class="inlineCode">autoHideDuration</code> defines the number of milliseconds to wait before the <code class="inlineCode">onClose</code> function is called:
        <pre class="programlisting code"><code class="hljs-code">&lt;<span class="hljs-title">Snackbar</span>
  open={open}
  autoHideDuration={<span class="hljs-number">3000</span>}
  onClose={<span class="hljs-function">() =&gt;</span> <span class="hljs-title">setOpen</span>(<span class="hljs-literal">false</span>)}
  message=<span class="hljs-string">"Login failed: Check your username and password"</span>
/&gt;
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">Snackbar</code> component if authentication fails by setting the <code class="inlineCode">open</code> state value to <code class="inlineCode">true</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">login</span> = () =&gt; {
  axios.<span class="hljs-title">post</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span> + <span class="hljs-string">"/login"</span>, user, {
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
  })
  .<span class="hljs-title">then</span>(<span class="hljs-params">res</span><span class="hljs-function"> =&gt;</span> {
    <span class="hljs-keyword">const</span> jwtToken = res.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>;
    <span class="hljs-keyword">if</span> (jwtToken !== <span class="hljs-literal">null</span>) {
      <span class="hljs-variable">sessionStorage</span>.<span class="hljs-title">setItem</span>(<span class="hljs-string">"jwt"</span>, jwtToken);
      <span class="hljs-title">setAuth</span>(<span class="hljs-literal">true</span>);
    }
  })
  .<span class="hljs-title">catch</span>(<span class="code-highlight"><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">setOpen</strong><strong class="hljs-slc">(</strong><strong class="hljs-literal-slc">true</strong><strong class="hljs-slc">)</strong></span>);
}
</code></pre>
      </li>
      <li class="numberedList">If you now try to log<a id="_idIndexMarker829"/> in with the wrong credentials, you will see the following<a id="_idIndexMarker830"/> message in the bottom-left corner of the screen:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_16_07.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.7: Login failed</p>
    <h2 id="_idParaDest-209" class="heading-2">Logging out</h2>
    <p class="normal">In this last section, we will implement<a id="_idIndexMarker831"/> the logout functionality<a id="_idIndexMarker832"/> in the <code class="inlineCode">Login</code> component. The logout button is rendered on the car list page. The <code class="inlineCode">Carlist</code> component is a child component of the <code class="inlineCode">Login</code> component; therefore, we can pass the logout function to the car list using the props. Let’s do this:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, we create a <code class="inlineCode">handleLogout()</code> function for the <code class="inlineCode">Login</code> component, which updates the <code class="inlineCode">isAuthenticated</code> state to <code class="inlineCode">false</code> and clears the token from session storage:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Login.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title">handleLogout</span> = () =&gt; {
  <span class="hljs-title">setAuth</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-variable">sessionStorage</span>.<span class="hljs-title">setItem</span>(<span class="hljs-string">"jwt"</span>, <span class="hljs-string">""</span>);
}
</code></pre>
      </li>
      <li class="numberedList">Next, we pass the <code class="inlineCode">handleLogout</code> function to the <code class="inlineCode">Carlist</code> component using the props, as shown in the highlighted code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Login.tsx</span>
<span class="hljs-keyword">if</span> (isAuthenticated) {
  <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">Carlist</span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc">logOut</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">{handleLogout}</strong></span><span class="hljs-string">/</span><span class="hljs-tag">&gt;</span>;
}
<span class="hljs-keyword">else</span> {  
  <span class="hljs-keyword">return</span>(
  ...
</code></pre>
      </li>
      <li class="numberedList">We have to create a new type for the props that we receive in the <code class="inlineCode">Carlist</code> component. The prop name is <code class="inlineCode">logOut</code>, which is a function that takes no arguments, and we mark this prop as optional. Add the following type to the <code class="inlineCode">Carlist</code> component and receive the <code class="inlineCode">logOut</code> prop in the function arguments:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">//Carlist.tsx</span>
<span class="code-highlight"><strong class="hljs-slc">type </strong><strong class="hljs-title-slc">CarlistProps</strong><strong class="hljs-slc"> = {</strong></span>
  <span class="code-highlight"><strong class="hljs-attr-slc">logOut?</strong><strong class="hljs-slc">: </strong><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">void</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
<span class="hljs-keyword">function</span> <span class="hljs-title">Carlist</span>(<span class="code-highlight"><strong class="hljs-params-slc">{ logOut }: CarlistProps</strong></span>) {
  <span class="hljs-keyword">const</span> [open, setOpen] = <span class="hljs-title">useState</span>(<span class="hljs-literal">false</span>);
  ...
</code></pre>
      </li>
      <li class="numberedList">Now, we can call the logout function and add the logout button. We use the Material UI <code class="inlineCode">Stack</code> component<a id="_idIndexMarker833"/> to align the buttons so that the <strong class="screenText">NEW CAR</strong> button is on the left and the <strong class="screenText">LOG OUT</strong> button<a id="_idIndexMarker834"/> is on the right side of the screen:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Carlist.tsx</span>
<span class="hljs-comment">// Add the following imports</span>
<span class="hljs-keyword">import</span> <span class="hljs-title">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Button'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title">Stack</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@mui/material/Stack'</span>;
<span class="hljs-comment">// Render the Stack and Button  </span>
<span class="hljs-keyword">if</span> (!isSuccess) {
    <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span><span class="language-xml">Loading...</span><span class="hljs-tag">&lt;/</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span>
}
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error) {
  <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span><span class="language-xml">Error when fetching cars...</span><span class="hljs-tag">&lt;/</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span>
}
<span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">return</span> ( 
    <span class="hljs-tag">&lt;&gt;</span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Stack</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">direction</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"row"</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">alignItems</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"center"</strong></span>
       <span class="code-highlight"><strong class="hljs-attr-slc">justifyContent</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"space-between"</strong><strong class="hljs-tag-slc">&gt;</strong></span>
        <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">AddCar</strong><strong class="hljs-tag-slc"> /&gt;</strong></span>
        <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Button</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">onClick</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">{logOut}</strong><strong class="hljs-tag-slc">&gt;</strong><strong class="hljs-slc">Log out</strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">Button</strong><strong class="hljs-tag-slc">&gt;</strong></span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">Stack</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">DataGrid</span>
<span class="hljs-tag">        </span><span class="hljs-attr">rows</span><span class="hljs-tag">=</span><span class="hljs-string">{data}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">columns</span><span class="hljs-tag">=</span><span class="hljs-string">{columns}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">disableRowSelectionOnClick</span><span class="hljs-tag">=</span><span class="hljs-string">{true}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">slots</span><span class="hljs-tag">=</span><span class="hljs-string">{{</span><span class="hljs-tag"> </span><span class="hljs-attr">toolbar:</span><span class="hljs-tag"> </span><span class="hljs-attr">GridToolbar</span><span class="hljs-tag"> }}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">getRowId</span><span class="hljs-tag">=</span><span class="hljs-string">{row</span><span class="hljs-tag"> =&gt;</span><span class="language-xml"> row._links.self.href} /&gt; </span>
<span class="language-xml">      </span><span class="hljs-tag">&lt;</span><span class="hljs-name">Snackbar</span>
<span class="hljs-tag">        </span><span class="hljs-attr">open</span><span class="hljs-tag">=</span><span class="hljs-string">{open}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">autoHideDuration</span><span class="hljs-tag">=</span><span class="hljs-string">{2000}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onClose</span><span class="hljs-tag">=</span><span class="hljs-string">{()</span><span class="hljs-tag"> =&gt;</span><span class="language-xml"> setOpen(false)}</span>
<span class="language-xml">        message="Car deleted" /&gt;</span>
<span class="language-xml">    </span><span class="hljs-tag">&lt;/&gt;</span>
  );
}
</code></pre>
      </li>
      <li class="numberedList">Now, if you log in to your frontend, you can see the <strong class="screenText">LOG OUT</strong> button on the car list page, as shown in the following screenshot. When you click the button, the login page is rendered because the <code class="inlineCode">isAuthenticated</code> state is set to <code class="inlineCode">false</code> and the token is cleared from session storage:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_16_08.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 16.8: Log out</p>
    <p class="normal">If you have a more complicated frontend with multiple pages, it would be wise to render the logout button in the app bar so that it is shown on each page. Then, you can use a state management technique<a id="_idIndexMarker835"/> to share a state with the whole component tree in your app. One solution would be to use the <strong class="keyWord">React Context API</strong> that we introduced in <em class="chapterRef">Chapter 8</em>, <em class="italic">Getting Started with React</em>. In this scenario, you could use context to share the <code class="inlineCode">isAuthenticated</code> state in your application’s component tree.</p>
    <p class="normal">As your application<a id="_idIndexMarker836"/> grows in complexity, managing state<a id="_idIndexMarker837"/> becomes crucial to ensuring that your components can access and update data efficiently. There are also other alternatives to the React Context API to manage states that you can study. The most common<a id="_idIndexMarker838"/> state management libraries are <strong class="keyWord">React Redux</strong> (<a href="https://react-redux.js.org"><span class="url">https://react-redux.js.org</span></a>) and MobX (<a href="https://github.com/mobxjs/mobx"><span class="url">https://github.com/mobxjs/mobx</span></a>).</p>
    <div class="note">
      <p class="normal">In the previous chapter, we created test cases for the <code class="inlineCode">CarList</code> component, and at that point the app was unsecured. At this stage, our <code class="inlineCode">CarList</code> component test cases will fail, and you should refactor them. To create a React test that simulates a login process and then tests whether data is fetched from a backend REST API, you can also use libraries like <code class="inlineCode">axios-mock-adapter</code> (<a href="https://github.com/ctimmerm/axios-mock-adapter"><span class="url">https://github.com/ctimmerm/axios-mock-adapter</span></a>). Mocking Axios allows you to simulate the login process and data fetching without making actual network requests. We are not going into the details here, but we recommend you explore this further.</p>
    </div>
    <p class="normal">Now, we are ready with our car application.</p>
    <h1 id="_idParaDest-210" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we learned how to implement a login and logout functionality for our frontend when we are using JWT authentication. Following successful authentication, we used session storage to save the token that we received from the backend. The token was then used in all requests that we sent to the backend; therefore, we had to modify our CRUD functionalities to work with authentication properly.</p>
    <p class="normal">In the next and final chapter, we will deploy our backend and frontend and also demonstrate how to create Docker containers.</p>
    <h1 id="_idParaDest-211" class="heading-1">Questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">How should you create a login form?</li>
      <li class="numberedList">How should you log in to the backend using JWT?</li>
      <li class="numberedList">What is session storage?</li>
      <li class="numberedList">How should you send a token to the backend in CRUD functions?</li>
    </ol>
    <h1 id="_idParaDest-212" class="heading-1">Further reading</h1>
    <p class="normal">Here are some other resources for learning about React and state management:</p>
    <ul>
      <li class="bulletList"><em class="italic">State Management with React Query</em>, by Daniel Afonso (<a href="https://www.packtpub.com/product/state-management-with-react-query/9781803231341"><span class="url">https://www.packtpub.com/product/state-management-with-react-query/9781803231341</span></a>)</li>
      <li class="bulletList"><em class="italic">MobX Quick Start Guide</em>, by Pavan Podila and Michel Weststrate (<a href="https://www.packtpub.com/product/mobx-quick-start-guide/9781789344837"><span class="url">https://www.packtpub.com/product/mobx-quick-start-guide/9781789344837</span></a>)</li>
    </ul>
    <h1 class="heading-1">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask the author questions, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/FullStackSpringBootReact4e"><span class="url">https://packt.link/FullStackSpringBootReact4e</span></a></p>
    <p class="normal"><img src="../Images/QR_Code10796108009382640.png" alt="" role="presentation"/></p>
  </div>
</body></html>