<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Setting Up the Environment"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Setting Up the Environment</h1></div></div></div><p>We extend you a very warm welcome to the first chapter of our journey. Let's give you an idea of what you will achieve here. After reading this chapter, you will have the basic and stimulating knowledge you need to set up a development environment to work with RESTful web services. Then, you will familiarize yourself with the development of a very basic project related to it. In addition, by the end, you will have a very clear idea of how to create applications using RESTful web services and how you can achieve this. This chapter will give you the information you need to work with web services of this kind in a very easy and comprehensive way.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing the development environment</li><li class="listitem" style="list-style-type: disc">Creating our first RESTful web services application</li><li class="listitem" style="list-style-type: disc">Testing the RESTful web service</li></ul></div><div class="section" title="Downloading tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>Downloading tools</h1></div></div></div><p>First, we must obtain our work tools so that we get our hands into code. Tools specified here are used around the world, but you are free to choose your tools. Remember, "Tools do not make the artist". It doesn't matter<a class="indexterm" id="id0"/> if you use Windows, MAC OS X, or Linux; tools are available for every OS.</p><p>Let's explain briefly what each tool is for. We will develop the examples using Eclipse as our IDE, JBoss AS 7.1.1.Final as our application server, Maven to automatize the build process, and SoapUI as a tool to test the functionality of web services that we will create. In addition, we suggest that you should install the latest version of JDK, which is JDK 1.7.x. For help, we have obtained and included some links that you need to use to get the software to implement the first example. Each link gives you more information about each tool, which can be profitable as you learn something about each one if you don't know about them already.</p><div class="section" title="Downloading links"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec07"/>Downloading links</h2></div></div></div><p>The following tools have to be downloaded:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Eclipse IDE <a class="indexterm" id="id1"/>for Java<a class="indexterm" id="id2"/> EE Developers 4.3 (<a class="ulink" href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/</a>)</li><li class="listitem" style="list-style-type: disc">JBoss AS 7.1.1 <a class="indexterm" id="id3"/>Final<a class="indexterm" id="id4"/> (<a class="ulink" href="http://www.jboss.org/jbossas/downloads/">http://www.jboss.org/jbossas/downloads/</a>)</li><li class="listitem" style="list-style-type: disc">Apache Maven 3.1.1<a class="indexterm" id="id5"/> or <a class="indexterm" id="id6"/>higher (<a class="ulink" href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a>)</li><li class="listitem" style="list-style-type: disc">SoapUI 4.6<a class="indexterm" id="id7"/> or <a class="indexterm" id="id8"/>higher<a class="indexterm" id="id9"/> (<a class="ulink" href="http://www.soapui.org/">http://www.soapui.org/</a>)</li><li class="listitem" style="list-style-type: disc">JDK 1.7.x (<a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html</a>)</li></ul></div></div></div></div>
<div class="section" title="Creating the base project"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Creating the base project</h1></div></div></div><p>In order to make the process of <a class="indexterm" id="id10"/>building our sample project easier, we will use Maven. This wonderful software will create a base project at the blink of an eye, and our project can be easily compiled and packaged without depending on a specific IDE.</p><p>Maven uses archetypes<a class="indexterm" id="id11"/> for a specific kind of project. The archetypes are project templates that have been previously created; they allow us to create all kinds of applications from Java desktop applications to multimodule projects, where the EAR can contain several artifacts such as JAR and WAR. Its main<a class="indexterm" id="id12"/> objective is to get<a class="indexterm" id="id13"/> users up and running as quickly as possible by providing a sample project that demonstrates many of the features of Maven. If you want to<a class="indexterm" id="id14"/> learn more about Maven, you can find more information by visiting <a class="ulink" href="http://maven.apache.org/">http://maven.apache.org/</a>.</p><p>However, the information we described here is enough to keep moving on. We will use an archetype in order to create a basic project; if we want to be more specific, we will use an archetype to create a web application with Java. To do this, we will type the following command line in a terminal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mvn archetype:generate</strong></span>
</pre></div><p>When we execute this command line in a terminal, we will obtain all available archetypes in Maven's repository. So, let's look for the archetype we need in order to create our web application; its name is <code class="literal">webapp-javaee6</code>, and it belongs to the group <code class="literal">org.codehaus.mojo.archetypes</code>. Also, we can search through it using a number that represents its ID; this number is <code class="literal">557</code>, as shown<a class="indexterm" id="id15"/> in the following screenshot. We recommend that<a class="indexterm" id="id16"/> you search by the name as the numbers are likely to change because some other archetypes may be added later:</p><div class="mediaobject"><img alt="Creating the base project" src="graphics/0109OS_01_01.jpg"/></div><p>Several questions will appear; we must provide the respective information for each question. Maven will use this information to create the archetype we selected before, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating the base project" src="graphics/0109OS_01_02.jpg"/></div><p>As you have probably noticed, each question asks you to define a property, and each property is explained as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">groupId</code>: This property <a class="indexterm" id="id17"/>represents the company's domain reversed order; this way we can recognize which company is the code's owner</li><li class="listitem" style="list-style-type: disc"><code class="literal">artifactId</code>: This property represents<a class="indexterm" id="id18"/> the project's name</li><li class="listitem" style="list-style-type: disc"><code class="literal">version</code>: This property<a class="indexterm" id="id19"/> represents the project's version</li><li class="listitem" style="list-style-type: disc"><code class="literal">package</code>: This property<a class="indexterm" id="id20"/> represents the base package's name where classes are going to be added</li></ul></div><p>Class names and package names together shape the class's full name. This full name allows the class names to be identified in a unique way<a class="indexterm" id="id21"/>. Sometimes, when there are several classes with the same name, the package name helps to identify which<a class="indexterm" id="id22"/> library it belongs to.</p><p>The next step is to put the project into Eclipse's workspace; to do this, we must import our project into Eclipse by navigating through <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Import</strong></span> | <span class="strong"><strong>Maven</strong></span> | <span class="strong"><strong>Existing Maven Projects</strong></span>.</p><p>We should see the project in the IDE, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating the base project" src="graphics/0109OS_01_03.jpg"/></div><p>Before moving on, let's fix the problems that have occurred in the file <code class="literal">pom.xml</code>.</p><p>The error shown<a class="indexterm" id="id23"/> in the following<a class="indexterm" id="id24"/> code is related to a bug that comes from Eclipse and Maven integration. In order to fix this, we have to add the <code class="literal">&lt;pluginManagement&gt;</code> tag after the <code class="literal">&lt;build&gt;</code> tag.</p><p>The <code class="literal">pom.xml</code> file should look like the following:</p><div class="informalexample"><pre class="programlisting">&lt;project  
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.packtpub&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-examples&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;

  . . .

  &lt;build&gt;
<span class="strong"><strong>    &lt;pluginManagement&gt;</strong></span>
      &lt;plugins&gt;
        &lt;plugin&gt;
          . . .
        &lt;/plugin&gt;
      &lt;/plugins&gt;
<span class="strong"><strong>    &lt;/pluginManagement&gt;</strong></span>
  &lt;/build&gt;

&lt;/project&gt;</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the sample code</strong></span>
</p><p>You can download the sample code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you. Also, we highly suggest obtaining the source code from GitHub available at <a class="ulink" href="https://github.com/restful-java-web-services-security">https://github.com/restful-java-web-services-security</a>.</p></div></div><p>This will fix the error, and now we only need to update Maven's configuration in the project, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Creating the base project" src="graphics/0109OS_01_04.jpg"/></div><p>After refreshing the project, the errors should go away because when we update Maven's configuration we are<a class="indexterm" id="id25"/> actually updating our project's dependencies, such as missing libraries. Through this, we will include them in our project<a class="indexterm" id="id26"/> and errors will disappear.</p><p>Inside the <code class="literal">src/main/webapp</code> path, let's create the <code class="literal">WEB-INF</code> folder.</p><p>Now, inside the <code class="literal">WEB-INF</code> folder, we will create a new file named <code class="literal">web.xml</code> with the following content:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="3.0" 
  
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
  http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
&lt;/web-app&gt;</pre></div><p>This file is very useful when you are securing your applications; this time, we will create it without any configuration. For now, the <code class="literal">/WEB-INF</code> folder and the <code class="literal">web.xml</code> file only define the structure of the web application.</p></div>
<div class="section" title="First functional example"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>First functional example</h1></div></div></div><p>Now that we have our development environment all set up, it is time to get your hands dirty and write the first <a class="indexterm" id="id27"/>RESTful web service. As we are using JBoss, let's use the RESTEasy implementation for JAX-RS. We will develop a very simple example; let's imagine you want to<a class="indexterm" id="id28"/> implement a service to save and search for people's information.</p><p>First, we create a simple <code class="literal">Person</code> domain class that uses JAXB annotations. JAXB marshals/unmarshals objects between XML and Java. For this example, we'll store these instances in an in-memory cache instead of a database. In JEE, this typically represents a table in a relational<a class="indexterm" id="id29"/> database, and each entity instance corresponds to a row in that table, as presented in the following code:</p><div class="informalexample"><pre class="programlisting">package com.packtpub.resteasy.entities;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlAttribute;
import javax.xml.bind.annotation.XmlElement;
import javax.xml.bind.annotation.XmlRootElement;

@XmlRootElement(name = "person")
@XmlAccessorType(XmlAccessType.FIELD)
public class Person {

  @XmlAttribute
  protected int id;

  @XmlElement
  protected String name;

  @XmlElement
  protected String lastname;

  public int getId() {
    return id;
  }

  public void setId(int id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public String getLastname() {
    return lastname;
  }

  public void setLastname(String lastname) {
    this.lastname = lastname;
  }

}</pre></div><p>Next, we create a new class called <code class="literal">PersonService</code> in the <code class="literal">com.packtpub.resteasy.services</code> package. This class will have two methods; one to register a new person and<a class="indexterm" id="id30"/> another to search for people by ID. This class will store people using an in-memory map cache.</p><p>The service will have the following implementation:</p><div class="informalexample"><pre class="programlisting">package com.packtpub.resteasy.services;

import java.net.URI;
import java.util.HashMap;
import java.util.Map;

import javax.ws.rs.Consumes;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.WebApplicationException;
import javax.ws.rs.core.Response;

import com.packtpub.resteasy.entities.Person;

@Path("/person")
public class PersonService {
  private Map&lt;Integer, Person&gt; dataInMemory;
  public PersonService() {
    dataInMemory = new HashMap&lt;Integer, Person&gt;();
  }

  @POST
  @Consumes("application/xml")
  public Response savePerson(Person person) {
    int id = dataInMemory.size() + 1;
    person.setId(id);
    dataInMemory.put(id, person);
    return Response.created(URI.create("/person/" + id)).build();
  }

  @GET
  @Path("{id}")
  @Produces("application/xml")
  public Person findById(@PathParam("id") int id) {
    Person person = dataInMemory.get(id);
    if (person == null) {
      throw new WebApplicationException(Response.Status.NOT_FOUND);
    }
    return person;
  }
}</pre></div><p>The <code class="literal">@Path</code> annotation <a class="indexterm" id="id31"/>defines the path in the URL that will be available on the functionalities that have been written within this class. The method annotated with <code class="literal">@Post</code> indicates that it <a class="indexterm" id="id32"/>should make a HTTP POST request. Furthermore, it is annotated with <code class="literal">@Consumes</code> and uses the <code class="literal">application</code>/<code class="literal">xml</code> value; this means that the POST request will be performed with a string in XML format, containing the information of the person to be saved. On the other hand, to find a person from its ID, you must make an HTTP GET request. The URL must indicate the ID the same way as indicated by the <code class="literal">@Path</code> annotation on the method. The <code class="literal">@Produces</code> annotation indicates that we will get the response in XML format. Finally, notice that the parameter ID, as indicated in the <code class="literal">@Path</code> annotation, is used as an argument of the method using the <code class="literal">@PathParam</code> annotation.</p><p>Finally, we write a class that will extend the <code class="literal">Application</code> class and set the service we just created as a singleton. So, the information won't get lost in every request, and we will keep it in memory as follows:</p><div class="informalexample"><pre class="programlisting">package com.packtpub.resteasy.services;

import java.util.HashSet;
import java.util.Set;

import javax.ws.rs.ApplicationPath;
import javax.ws.rs.core.Application;

@ApplicationPath("/services")
public class MyRestEasyApplication extends Application {

  private Set&lt;Object&gt; services;

  public MyRestEasyApplication() {
    services = new HashSet&lt;Object&gt;();
    services.add(new PersonService());
  }

  @Override
  public Set&lt;Object&gt; getSingletons() {
    return services;
  }
}</pre></div><p>Note that as we have mapped our entity using JAXB, our methods consume and produce information in the XML format.</p><p>In order to deploy our application in JBoss, we should add a dependency in the <code class="literal">pom.xml</code> file. This dependency<a class="indexterm" id="id33"/> must reference to the JBoss plugin. We have to change the generated artifact name in <code class="literal">pom.xml</code>. The default value for this is the <code class="literal">artifactId</code> file, followed by the version; for example, <code class="literal">resteasy-examples-1.0-snapshot.war</code>. We will set it, so we will use just the <code class="literal">artifactId</code> file; in this case, <code class="literal">resteasy-examples.war</code>. All of these configurations must be included, modified, and implemented in <code class="literal">pom.xml</code>, as shown in the following piece of XML code:</p><div class="informalexample"><pre class="programlisting">  &lt;build&gt;
<span class="strong"><strong>    &lt;finalName&gt;${artifactId}&lt;/finalName&gt;</strong></span>
    &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;groupId&gt;org.jboss.as.plugins&lt;/groupId&gt;
          &lt;artifactId&gt;jboss-as-maven-plugin&lt;/artifactId&gt;
          &lt;version&gt;7.5.Final&lt;/version&gt;
          &lt;configuration&gt;
            &lt;jbossHome&gt;/pathtojboss/jboss-as-7.1.1.Final&lt;/jbossHome&gt;
          &lt;/configuration&gt;
        &lt;/plugin&gt;
        ...
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
  &lt;/build&gt;</pre></div><p>You should change the value of the <code class="literal">jbossHome</code> property for the path of your JBoss installation. After this, we will use the command terminal; head to the project's directory, and type <code class="literal">mvn jboss-as:run</code>. If you make any change on the code after the command has been executed, then you should use the following command in order to see the changes:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mvn jboss-as:redeploy</strong></span>
</pre></div><p>Run and redeploy are the goals of this plugin. If you want to know more goals about this plugin, you can visit <a class="ulink" href="https://docs.jboss.org/jbossas/7/plugins/maven/latest/">https://docs.jboss.org/jbossas/7/plugins/maven/latest/</a>). This will compile all project classes again; it will then be packaged in order to create the <code class="literal">.war</code> file. At the end, the modifications <a class="indexterm" id="id34"/>will be deployed on the server. If everything is okay, we should see a message in the terminal saying that the deployment has been done successfully, as shown in the following screenshot:</p><div class="mediaobject"><img alt="First functional example" src="graphics/0109OS_01_05.jpg"/></div><p>The source code of this chapter is available on GitHub at the following location:</p><p>
<a class="ulink" href="https://github.com/restful-java-web-services-security/source-code/tree/master/chapter01">https://github.com/restful-java-web-services-security/source-code/tree/master/chapter01</a>
</p><div class="section" title="Testing the example web service"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Testing the example web service</h2></div></div></div><p>At this moment, we will test the<a class="indexterm" id="id35"/> functionality we just created. We will use SoapUI as our test tool; make sure you use the latest version, or at least the version equal to or greater than 4.6.x because this version offers more features to test the RESTful Web services. Let's start by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">From the main menu, let's create a new REST project by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New REST Project</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Testing the example web service" src="graphics/0109OS_01_06.jpg"/></div></li><li class="listitem">Set the URI of our service, as follows:<div class="mediaobject"><img alt="Testing the example web service" src="graphics/0109OS_01_07.jpg"/></div></li><li class="listitem">After this, let's create a new person using the <code class="literal">POST</code> method from workspace. In the field <span class="strong"><strong>Media Type</strong></span>, select <span class="strong"><strong>application/xml</strong></span> and perform a request with a string that contains<a class="indexterm" id="id36"/> the XML with the information, as shown in the following text:<div class="informalexample"><pre class="programlisting">&lt;person&gt;&lt;name&gt;Rene&lt;/name&gt;&lt;lastname&gt;Enriquez&lt;/lastname&gt;&lt;/person&gt;</pre></div></li><li class="listitem">When we click on the <span class="strong"><strong>Play</strong></span> button, we should obtain an answer where it shows the created resource URI (hyperlink "<code class="literal">http://localhost:8080/resteasy-examples/services/person/1</code>"), as shown in the following screenshot:<div class="mediaobject"><img alt="Testing the example web service" src="graphics/0109OS_01_08.jpg"/></div></li><li class="listitem">If we change the URI from the <span class="strong"><strong>Resource</strong></span> textbox in SoapUI and use the <code class="literal">GET</code> method, it will show us the data we just entered, as shown in the following screenshot:<div class="mediaobject"><img alt="Testing the example web service" src="graphics/0109OS_01_09.jpg"/></div></li></ol></div><p>Congratulations! We have developed our first functional RESTful web service with two features. The first is to <a class="indexterm" id="id37"/>keep people's information in memory, and the second is to retrieve people's information through an ID.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>If you restart JBoss or deploy the application again, all data will be lost. Before searching for people's information, you must first save the data.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Summary</h1></div></div></div><p>In this chapter, we created our first functional application—something like a <span class="emphasis"><em>hello world</em></span> example but with a bit more functionality close to the real world.</p><p>The essential part we covered in this chapter is to familiarize ourselves with the tools we will use. In later chapters, we will assume that these concepts are already clear. For example, we will move forward step-by-step when using SoapUI as this is a tool that will facilitate the task of testing the functionality that we will be developing. This way, we will avoid the task of writing code for web service clients.</p><p>Now we are ready to review the next chapter, which contains some security models that Java provides. We will understand each one of them and learn how to implement them.</p></div></body></html>