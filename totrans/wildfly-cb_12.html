<html><head></head><body><div class="chapter" title="Chapter&#xA0;12.&#xA0;Role-based Access Control with WildFly"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter 12. Role-based Access Control with WildFly</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Switching between simple and RBAC providers</li><li class="listitem" style="list-style-type: disc">Managing users, groups, and their role mapping</li><li class="listitem" style="list-style-type: disc">Setting a predefined role to all authenticated users</li><li class="listitem" style="list-style-type: disc">Granting user access by server group or host – scoped roles</li><li class="listitem" style="list-style-type: disc">Integrating with OpenLDAP</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec98"/>Introduction</h1></div></div></div><p>In this chapter, you will learn how to improve your WildFly management console by providing a fine-grained access control mechanism. WildFly comes with two built-in providers: one is called simple, which is the default one and the second one is called RBAC—as you guessed, it stands for <span class="strong"><strong>role-based access control</strong></span>.</p><p>Switching to the <a id="id878" class="indexterm"/>RBAC provider means you can control what a user can do and see, and what kinds of operations the user is allowed to perform. Using the RBAC provider, you are basically sharing responsibility with different users. You might want some users to just make deployments, others to occasionally monitor the overall system, and so on. Furthermore, we will see how to integrate RBAC with an LDAP system (which provides users and groups), and mapping them to the WildFly roles.</p><p>WildFly comes with a set of predefined roles, each one having a specific permission. These roles are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Monitor</strong></span>: As the <a id="id879" class="indexterm"/>name may suggest, this role can just view the state of the server, but it cannot see sensitive data, such as passwords.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Operator</strong></span>: This role has <a id="id880" class="indexterm"/>the same permissions as those provided by the monitor, plus it can stop and start a server, or pause runtime services such as JMS destinations. You would typically give such a role to people who are responsible for managing a specific server instance. Still, an operator cannot see sensitive data, such as passwords.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Maintainer</strong></span>: This role <a id="id881" class="indexterm"/>has the permissions to view and edit all the runtime states and all configurations, besides sensitive data. Users with such a role can manage almost the entire system.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Deployer</strong></span>: This <a id="id882" class="indexterm"/>role is like the monitor role, plus it can read and modify the configuration and the state of deployments.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Auditor</strong></span>: This role is <a id="id883" class="indexterm"/>like the monitor role, plus it can view sensitive data. It also has access to the audit logging subsystem.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Administrator</strong></span>: This <a id="id884" class="indexterm"/>role can do anything, view and modify everything except the audit logging subsystem. The administrator can also configure the RBAC provider.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SuperUser</strong></span>: This is the <a id="id885" class="indexterm"/>most powerful role. It can view and modify resources, state, and sensitive data. This role is the one that was used before the RBAC was introduced.</li></ul></div><p>These roles can be combined together to form a group of roles, which can be used by a specific user.</p></div></div>
<div class="section" title="Switching between simple and RBAC providers"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec99"/>Switching between simple and RBAC providers</h1></div></div></div><p>In this <a id="id886" class="indexterm"/>recipe, we will learn how to switch from the simple provider to the RBAC provider. RBAC provides a fine-grained access control to our management console.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec279"/>Getting ready</h2></div></div></div><p>To get started, let's first create an <code class="literal">ad-hoc</code> folder to run our WildFly. In a terminal window, execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone rbac-std-node-1</pre></div><p>Now it's time to run our WildFly!!!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec280"/>How to do it…</h2></div></div></div><p>Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal window and enter the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=rbac-std-node-1</pre></div></li><li class="listitem">Once <a id="id887" class="indexterm"/>started, in a new terminal window, connect to the CLI and switch to the RBAC provider, as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] :reload()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}
[standalone@localhost:9990 /]</pre></div><p>Great, we successfully switched to the RBAC provider.</p></li><li class="listitem">In our <code class="literal">standalone.xml</code> file, we should find the following definition:<div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div></li><li class="listitem">To switch back to the <code class="literal">simple</code> provider, do as follows:<div class="informalexample"><pre class="programlisting">standalone@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=simple)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] :reload()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">In our <a id="id888" class="indexterm"/><code class="literal">standalone.xml</code> file, we should find the following definition:<div class="informalexample"><pre class="programlisting">&lt;access-control provider="simple"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div></li></ol></div><p>That's it, pretty easy so far!!!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec281"/>How it works…</h2></div></div></div><p>This approach is pretty easy and straightforward; there is not much to talk about except its usage. The preceding example is just the first step. As a matter of fact, if you try to access the console after you switch to the <code class="literal">RBAC</code> provider, you are not able to log in.</p><p>Try it!!! Open the browser and point it to <code class="literal">http://localhost:9990</code>. Enter the username and password that we specified at the beginning of the book: <code class="literal">wildfly</code> as the username and <code class="literal">cookbook.2015</code> as the password.</p><p>See, you cannot log in. How to resolve this?</p><p>From the preceding XML code snippet, you should have noticed the directive <code class="literal">include</code> referring the user named <code class="literal">$local</code>. In this case, <code class="literal">$local</code> means the users defined within the <code class="literal">ManagementRealm</code> and <code class="literal">ApplicationRealm</code> realms, but with no privileges at all to access the console.</p><p>What we should do, is add our <code class="literal">wildfly</code> user from <code class="literal">ManagementRealm</code>  in the <code class="literal">include</code> XML element, as follows:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=SuperUser/include=wildfly:add(name=wildfly,realm=ManagementRealm,type=USER)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div><p>The preceding <a id="id889" class="indexterm"/>commands generate the following XML code into our <code class="literal">standalone.xml</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
                &lt;user alias="wildfly" realm="ManagementRealm" name="wildfly"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div><p>Now if we try to access the console as usual, we should be able to log in successfully.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec282"/>There's more…</h2></div></div></div><p>Regardless the providers that you have chosen, once logged in, you can see the role of your user, by clicking on the username, displayed on the top-right corner of the web console:</p><div class="mediaobject"><img src="graphics/3744_12_01.jpg" alt="There's more…"/><div class="caption"><p>Displaying current logged user's role</p></div></div><p>As you can <a id="id890" class="indexterm"/>see, we have a role called <span class="strong"><strong>SuperUser</strong></span>. Looking a little bit further, there is an interesting link <span class="strong"><strong>Run as…</strong></span> which should intrigue you. Let's click it!</p><div class="mediaobject"><img src="graphics/3744_12_02.jpg" alt="There's more…"/><div class="caption"><p>Run as role selection role pop-up</p></div></div><p>Try to play around with it to better understand the different roles and the permissions you get. For example, try to deploy an application using the <span class="strong"><strong>Monitor</strong></span> role, or check if you can view or edit the username and password of a datasource. Be curious!</p></div></div>
<div class="section" title="Managing users, groups, and their role mapping"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec100"/>Managing users, groups, and their role mapping</h1></div></div></div><p>In this <a id="id891" class="indexterm"/>recipe, you will learn how to manage users, groups, and their relative <a id="id892" class="indexterm"/>mapping to the WildFly roles. We will perform most of the tasks from within the Web Console.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec283"/>Getting ready</h2></div></div></div><p>To get started, let's first create an <code class="literal">ad-hoc</code> folder to run our WildFly. In a terminal window, execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone rbac-std-node-2</pre></div><p>Now it's time to run our WildFly.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec284"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a <a id="id893" class="indexterm"/>terminal window and enter the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=rbac-std-node-2</pre></div></li><li class="listitem">Once <a id="id894" class="indexterm"/>started, connect to the CLI and switch to the RBAC provider in a new terminal window as we did in the previous recipe:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] :reload()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now that we've successfully switched to the RBAC provider, we need to map our local management user (if you've been following the book, you'll know it is <span class="strong"><strong>wildfly</strong></span>) to the <span class="strong"><strong>SuperUser</strong></span> role, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=SuperUser/include=wildfly:add(name=wildfly,realm=ManagementRealm,type=USER)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li></ol></div><p>Okay, we can now <a id="id895" class="indexterm"/>access the Web Console, and see how we can manage <a id="id896" class="indexterm"/>users, groups, and their relative mappings.</p><div class="section" title="Users"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec66"/>Users</h3></div></div></div><p>Let's first add <a id="id897" class="indexterm"/>some users:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In a new terminal window, execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/add-user.sh --silent=true devguy devguy.2015 -sc rbac-std-node-2/configuration
$ ./bin/add-user.sh --silent=true opsguy opsguy.2015 -sc rbac-std-node-2/configuration
$ ./bin/add-user.sh --silent=true devopsguy devopsguy.2015 -sc rbac-std-node-2/configuration
$ ./bin/add-user.sh --silent=true pmguy pmguy.2015 -sc rbac-std-node-2/configuration</pre></div></li><li class="listitem">Okay, now let's open the browser and point it to <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Once logged in as the <span class="strong"><strong>wildfly</strong></span> user, click on the Administration tab and you should see a page like the following:<div class="mediaobject"><img src="graphics/3744_12_03.jpg" alt="Users"/><div class="caption"><p>Displaying RBAC users</p></div></div></li><li class="listitem">Our <span class="strong"><strong>wildfly</strong></span> <a id="id898" class="indexterm"/>user is there. Let's add the user <code class="literal">devguy</code> by clicking on the button labeled <span class="strong"><strong>Add</strong></span>, and filling in the form as follows:<div class="mediaobject"><img src="graphics/3744_12_04.jpg" alt="Users"/><div class="caption"><p>RBAC form for adding a user and its roles</p></div></div></li><li class="listitem">Confirm by <a id="id899" class="indexterm"/>clicking the <span class="strong"><strong>Save</strong></span> button. Now we should have the new user added to the list, as depicted in the next image:<div class="mediaobject"><img src="graphics/3744_12_05.jpg" alt="Users"/><div class="caption"><p>Displaying the newly added user devguy</p></div></div></li><li class="listitem">If we cannot <a id="id900" class="indexterm"/>access the Web Console for any reason, we can rely on the CLI, and specify the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Deployer:add
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Deployer/include=devguy:add(name=devguy,type=USER,realm=ManagementRealm)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Operator:add
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Operator/include=devguy:add(name=devguy,type=USER,realm=ManagementRealm)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Let's add the other users, <code class="literal">opsguy</code>, <code class="literal">devopsguy</code>, and <code class="literal">pmguy</code>, giving them appropriate roles:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">opsguy</code>: Roles of the maintainer and operator</li><li class="listitem" style="list-style-type: disc"><code class="literal">devopsguy</code>: Role <a id="id901" class="indexterm"/>of the administrator</li><li class="listitem" style="list-style-type: disc"><code class="literal">pmguy</code>: Role of the monitor</li></ul></div></li><li class="listitem">You should have the following list:<div class="mediaobject"><img src="graphics/3744_12_06.jpg" alt="Users"/><div class="caption"><p>List of users</p></div></div><p>Now that we've entered all our users, let's try one of them.</p></li><li class="listitem">So log out and log <a id="id902" class="indexterm"/>back in with the user <code class="literal">pmguy</code>. Once we are back in, let's go to the <span class="strong"><strong>Deployments</strong></span> tab. You see a page similar to the following:<div class="mediaobject"><img src="graphics/3744_12_07.jpg" alt="Users"/><div class="caption"><p>Deployments page without any buttons to alter deployments</p></div></div><p>As you can see, we cannot manage our deployments, we cannot remove or disable them, nor can we deploy new applications.</p></li><li class="listitem">Let's go back to our <a id="id903" class="indexterm"/><span class="strong"><strong>Administration</strong></span> tab and see if we can add a more powerful role:<div class="mediaobject"><img src="graphics/3744_12_08.jpg" alt="Users"/><div class="caption"><p>Administration page warning about Authorization Required</p></div></div></li></ol></div><p>We can't; only users with the Administrator and SuperUser roles can.</p></div><div class="section" title="Groups"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec67"/>Groups</h3></div></div></div><p>As we saw, every role <a id="id904" class="indexterm"/>has specific permissions on what you can and can't do, and on what you can and cannot see. Despite the simple mapping user roles, you can manage and combine multiple roles under a specific group.</p><p>Let's create two groups: <code class="literal">development</code> and <code class="literal">operations</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If you are still logged in as the <code class="literal">pmguy</code> user, log off and log back in with as the <code class="literal">wildfly</code> user.</li><li class="listitem">Once there, go to the <span class="strong"><strong>Administration</strong></span> tab and click <span class="strong"><strong>Groups</strong></span>:<div class="mediaobject"><img src="graphics/3744_12_09.jpg" alt="Groups"/><div class="caption"><p>Displaying RBAC groups</p></div></div></li><li class="listitem">Add the two groups by clicking the <span class="strong"><strong>Add</strong></span> button, as follows:<div class="mediaobject"><img src="graphics/3744_12_10.jpg" alt="Groups"/><div class="caption"><p>Creating the Development group</p></div></div></li><li class="listitem">In the preceding <a id="id905" class="indexterm"/>screenshot, we are selecting the <span class="strong"><strong>Deployer</strong></span> and the <span class="strong"><strong>Operator</strong></span> roles from the list of WildFly's built-in roles, and giving them to the <span class="strong"><strong>Development</strong></span> group.<div class="mediaobject"><img src="graphics/3744_12_11.jpg" alt="Groups"/><div class="caption"><p>Creating the Operations group</p></div></div></li><li class="listitem">In the preceding <a id="id906" class="indexterm"/>screenshot, we are selecting the <span class="strong"><strong>Maintainer</strong></span> and the <span class="strong"><strong>Operator</strong></span> roles from the list of WildFly's built-in roles, and giving them to the <span class="strong"><strong>Operations</strong></span> group.</li><li class="listitem">Now we should have the following entries in our <code class="literal">group-roles</code> table:<div class="mediaobject"><img src="graphics/3744_12_12.jpg" alt="Groups"/><div class="caption"><p>List of groups</p></div></div></li><li class="listitem">Our <code class="literal">standalone.xml</code> <a id="id907" class="indexterm"/>file should have the following definition:<div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
                &lt;user alias="wildfly" realm="ManagementRealm" name="wildfly"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Deployer"&gt;
            &lt;include&gt;
                &lt;user realm="ManagementRealm" name="devguy"/&gt;
                &lt;group name="Development"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Operator"&gt;
            &lt;include&gt;
                &lt;user realm="ManagementRealm" name="devguy"/&gt;
                &lt;user realm="ManagementRealm" name="opsguy"/&gt;
                &lt;group name="Development"/&gt;
                &lt;group name="Operations"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Maintainer"&gt;
            &lt;include&gt;
                &lt;user realm="ManagementRealm" name="opsguy"/&gt;
                &lt;group name="Operations"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Administrator"&gt;
            &lt;include&gt;
                &lt;user realm="ManagementRealm" name="devopsguy"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
        &lt;role name="Monitor"&gt;
            &lt;include&gt;
                &lt;user realm="ManagementRealm" 
                name="pmguy"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div></li></ol></div><p>As you can see, the groups too have been included in the appropriate role. Now we need to give a group to a user. With <a id="id908" class="indexterm"/>our configuration, we could give the <span class="strong"><strong>Development</strong></span> group to the <code class="literal">devguy</code> user, and the <span class="strong"><strong>Operations</strong></span> group to the <code class="literal">opsguy</code>.</p><p>As we are dealing with users that belong to <span class="strong"><strong>ManagementRealm</strong></span> to accomplish this task from the command line, we can follow two different ways:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Insert the user again, using the <code class="literal">add-user.sh</code> script and passing the group, as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/add-user.sh --silent=true devguy devguy.2015 -g Development -sc rbac-std-node-2/configuration</pre></div></li><li class="listitem">Adding the user directly to the <code class="literal">mgmt-groups.properties</code> file, as follows:<div class="informalexample"><pre class="programlisting">$ echo "opsguy=Operations" &gt;&gt; rbac-std-node-2/configuration/mgmt-groups.properties</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note35"/>Note</h3><p>Because we could potentially have tens, hundreds, and thousands of users, we probably do not want to map a role for every user, but instead, map a set of roles to a group, and map users to that group. This is the kind of scenario that we find in a corporate having its users stored in an <code class="literal">Active Directory</code> or LDAP stores—we will dive into integrating the LDAP store later in this chapter.</p></div></div></li></ol></div><p>Having said that, let's <a id="id909" class="indexterm"/>remove the role mapping for the users <code class="literal">devguy</code> and <code class="literal">opsguy</code>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We can do this from the Web Console, by selecting the user and clicking on the <span class="strong"><strong>Remove</strong></span> button.</li><li class="listitem">Once done, we should have the following scenario:<div class="mediaobject"><img src="graphics/3744_12_13.jpg" alt="Groups"/><div class="caption"><p>List of users</p></div></div></li><li class="listitem">Now we should be able to log out and log back in with the user <code class="literal">devguy</code>.</li><li class="listitem">Once done, let's click on the <code class="literal">devguy</code> link on the top-right corner of the page, and we should see his roles, as follows:<div class="mediaobject"><img src="graphics/3744_12_14.jpg" alt="Groups"/><div class="caption"><p>Displaying user's roles</p></div></div></li></ol></div><p>Let's try this with the other user, <code class="literal">opsguy</code>. If everything is fine, we should see his roles as well.</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec285"/>How it works…</h2></div></div></div><p>Users and groups <a id="id910" class="indexterm"/>management is simplified by the Web Console; nevertheless, we still need some tasks to be done outside the Web Console, like mapping users to groups. By the way, here is the main process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We need a user capable of accessing the RBAC administration page and adding/removing users and groups—just like our WildFly SuperUser</li><li class="listitem" style="list-style-type: disc">We need to add users or groups and map them to the appropriate role</li><li class="listitem" style="list-style-type: disc">Users have to be present in a store, like the properties file and LDAP (both stores are supported by WildFly); we used the <code class="literal">add-user.sh</code> script to silently add users, along with their realm</li></ul></div></div></div>
<div class="section" title="Setting a predefined role to all authenticated users"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec101"/>Setting a predefined role to all authenticated users</h1></div></div></div><p>In this <a id="id911" class="indexterm"/>recipe, you will learn how to set a predefined <a id="id912" class="indexterm"/>role to all authenticated users. This setting might be handy when you have a large user base and you don't have a complete view of all users and groups that are present in the the identity store. So instead of not authorizing some users, you may want to give them the simplest and the least privileges.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec286"/>Getting ready</h2></div></div></div><p>To get started, let's first create an <code class="literal">ad-hoc</code> folder to run our WildFly. In a terminal window execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone rbac-std-node-3</pre></div><p>Now it's time to run our WildFly!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec287"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal window and enter the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=rbac-std-node-3</pre></div></li><li class="listitem">Once started, in a new terminal window, connect to the CLI and switch to the RBAC provider as we did in the previous recipe:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] :reload()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now that <a id="id913" class="indexterm"/>we've successfully <a id="id914" class="indexterm"/>switched to the RBAC provider, we need to map our local management user (if you are following the book, the local management user is <code class="literal">wildfly</code>) to the <span class="strong"><strong>SuperUser</strong></span> role, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=SuperUser/include=wildfly:add(name=wildfly,realm=ManagementRealm,type=USER)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now we need to add some users, just to simulate the users whom we didn't consider as having access to our system; in a new terminal window, execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/add-user.sh --silent=true luigi luigi.2015 -sc rbac-std-node-3/configuration
$ ./bin/add-user.sh --silent=true fabio fabio.2015 -sc rbac-std-node-3/configuration
$ ./bin/add-user.sh --silent=true stefano stefano.2015 -sc rbac-std-node-3/configuration</pre></div><p>Okay, we can now access the Web Console and see how we can manage those kinds of users, by giving them the default role.</p></li><li class="listitem">Let's open <a id="id915" class="indexterm"/>the browser and point it to <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Authenticate with the <code class="literal">wildfly</code> user and once there, click on the <span class="strong"><strong>Administration</strong></span> tab and then on the <span class="strong"><strong>Roles</strong></span> section.</li><li class="listitem">Then, select <a id="id916" class="indexterm"/>the <span class="strong"><strong>Monitor</strong></span> role, click the <span class="strong"><strong>Edit</strong></span> link, and mark the <span class="strong"><strong>Include All</strong></span> check, as follows:<div class="mediaobject"><img src="graphics/3744_12_15.jpg" alt="How to do it…"/><div class="caption"><p>Giving a default role to all authenticated users</p></div></div></li><li class="listitem">Once you click <span class="strong"><strong>Save</strong></span>, the selected role will be given as the default one to all authenticated users.<div class="mediaobject"><img src="graphics/3744_12_16.jpg" alt="How to do it…"/><div class="caption"><p>List of roles</p></div></div></li><li class="listitem">If we don't <a id="id917" class="indexterm"/>have access to <a id="id918" class="indexterm"/>the Web Console, we can still rely on our CLI and issue the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=Monitor:write-attribute(name=include-all,value=true)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Okay, let's try our settings by logging out and logging back in with the user <code class="literal">luigi</code>. Open the browser and point it to <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Insert <code class="literal">luigi</code> as the username and <code class="literal">luigi.2015</code> as the password; we should end up with the following scenario:<div class="mediaobject"><img src="graphics/3744_12_17.jpg" alt="How to do it…"/><div class="caption"><p>User luigi mapped to the default role Monitor</p></div></div></li></ol></div><p>Neat!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec288"/>How it works…</h2></div></div></div><p>There is not much to talk about as the process is pretty straightforward. Let's recap what we did and how we did it.</p><p>First we needed to <a id="id919" class="indexterm"/>switch the provider, passing <a id="id920" class="indexterm"/>it from <code class="literal">simple</code> to <code class="literal">rbac</code> using the CLI.</p><p>Secondly, we needed to include our management user <code class="literal">wildfly</code> to the <span class="strong"><strong>SuperUser</strong></span> role, which resulted in the following configuration:</p><div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
                &lt;user alias="wildfly" realm="ManagementRealm" name="wildfly"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div><p>Then, we added the potential, unmanaged users to the <code class="literal">ManagementRealm</code> realm, using the <code class="literal">add-user.sh</code> script:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/add-user.sh --silent=true luigi luigi.2015 -sc rbac-std-node-3/configuration
$ ./bin/add-user.sh --silent=true fabio fabio.2015 -sc rbac-std-node-3/configuration
$ ./bin/add-user.sh --silent=true stefano stefano.2015 -sc rbac-std-node-3/configuration</pre></div><p>The <code class="literal">--silent=true</code> command basically means non-interactive mode; we then passed the username followed by its password, and then we specified the path for storing our users. By default, the store is represented by the <code class="literal">mgmt-users.properties</code> file, which corresponds to the <code class="literal">ManagementRealm</code>, on the WildFly side.</p><p>If we wanted to store the users in <code class="literal">ApplicationRealm</code>, we should have passed the option <code class="literal">-a</code> to the script. Furthermore, if we wanted to store the users' credentials into a different file, we could have passed the option <code class="literal">-up /path/filename.properties</code>.</p><p>For a complete <a id="id921" class="indexterm"/>list of available options, issue <a id="id922" class="indexterm"/>the <code class="literal">add-user.sh</code> script passing the <code class="literal">--help</code> directive, as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/add-user.sh –help</pre></div><div class="mediaobject"><img src="graphics/3744_12_18.jpg" alt="How it works…"/></div><p>Lastly, we made the monitor role the default one for all authenticated users.</p></div></div>
<div class="section" title="Granting user access by server group or host &#x2013; scoped roles"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec102"/>Granting user access by server group or host – scoped roles</h1></div></div></div><p>In this recipe, you will <a id="id923" class="indexterm"/>learn how to grant access to a user <a id="id924" class="indexterm"/>only in a specific server-group or host. This is <a id="id925" class="indexterm"/>available only in the domain mode, obviously. This feature takes the name of scoped roles, and it comes in very handy when you need to <a id="id926" class="indexterm"/>share your environment with multiple teams such as development teams. This way, every team can actually work on its server group or dedicated host, without interfering with the other server groups or hosts.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec289"/>Getting ready</h2></div></div></div><p>To get started, let's first create an <code class="literal">ad-hoc</code> folder to run our WildFly. In a terminal window enter the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a domain rbac-dmn-scp-roles</pre></div><p>Now it's time to run our WildFly.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec290"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/domain.sh -Djboss.domain.base.dir=rbac-dmn-scp-roles</pre></div></li><li class="listitem">Once started, connect to the CLI in a new terminal window and switch to the RBAC provider, as we did in the previous recipe:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[domain@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    },
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {
            "outcome" =&gt; "success",
            "response-headers" =&gt; {
                "operation-requires-reload" =&gt; true,
                "process-state" =&gt; "reload-required"
            }
        }},
        "server-two" =&gt; {"response" =&gt; {
            "outcome" =&gt; "success",
            "response-headers" =&gt; {
                "operation-requires-reload" =&gt; true,
                "process-state" =&gt; "reload-required"
            }
        }}
    }}}}
}
[domain@localhost:9990 /] reload --host=master
[domain@localhost:9990 /]</pre></div></li><li class="listitem">Now that we've <a id="id927" class="indexterm"/>successfully switched to the <a id="id928" class="indexterm"/>RBAC provider, we need to map <a id="id929" class="indexterm"/>our <code class="literal">wildfly</code> user to the <a id="id930" class="indexterm"/><span class="strong"><strong>SuperUser</strong></span> role, as follows:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /core-service=management/access=authorization/role-mapping=SuperUser/include=wildfly:add(name=wildfly,realm=ManagementRealm,type=USER)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; {"main-server-group" =&gt; {"host" =&gt; {"master" =&gt; {
        "server-one" =&gt; {"response" =&gt; {"outcome" =&gt; 
    "success"}},
        "server-two" =&gt; {"response" =&gt; {"outcome" =&gt; "success"}}
    }}}}
}
[domain@localhost:9990 /]</pre></div><p>Now we can log in to our WildFly console and create the so called <code class="literal">scoped-roles</code>.</p></li><li class="listitem">Log in to the <a id="id931" class="indexterm"/>WildFly Web Console and <a id="id932" class="indexterm"/>go to the <span class="strong"><strong>Administration</strong></span> tab. Then <a id="id933" class="indexterm"/>select the <span class="strong"><strong>Roles</strong></span> sub tab, and select <a id="id934" class="indexterm"/>the <span class="strong"><strong>Scoped Roles</strong></span> section. The page is depicted as follows:<div class="mediaobject"><img src="graphics/3744_12_19.jpg" alt="How to do it…"/><div class="caption"><p>Administrative page of the scoped roles</p></div></div></li><li class="listitem">Now click the <span class="strong"><strong>Add</strong></span> button and fill in the form as depicted in the following screenshot:<div class="mediaobject"><img src="graphics/3744_12_20.jpg" alt="How to do it…"/><div class="caption"><p>Scoped Role adding form</p></div></div></li><li class="listitem">Once you <a id="id935" class="indexterm"/>submit the form by clicking <a id="id936" class="indexterm"/>on the <span class="strong"><strong>Save</strong></span> button, the scoped role will be <a id="id937" class="indexterm"/>inserted and shown as per the <a id="id938" class="indexterm"/>following list:<div class="mediaobject"><img src="graphics/3744_12_21.jpg" alt="How to do it…"/><div class="caption"><p>List displaying the dev-team-one scoped role</p></div></div></li></ol></div><p>Now it's time to <a id="id939" class="indexterm"/>create a user to map it to the scoped role created in the previous steps.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a <a id="id940" class="indexterm"/>terminal and execute the following <a id="id941" class="indexterm"/>commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/add-user.sh --silent=true user-dev-1 devguy.2015 -sc rbac-dmn-scp-roles/configuration</pre></div><p>Now we can add that user to the <code class="literal">dev-team-one</code> scoped role.</p></li><li class="listitem">Let's go back <a id="id942" class="indexterm"/>to the WildFly Web Console, select the <span class="strong"><strong>Administration</strong></span> tab, then the <span class="strong"><strong>Users</strong></span> sub tab, and click the <span class="strong"><strong>Add</strong></span> button. Fill in the form as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_12_22.jpg" alt="How to do it…"/></div></li><li class="listitem">Once you <a id="id943" class="indexterm"/>save your changes, you should <a id="id944" class="indexterm"/>have the following list:<div class="mediaobject"><img src="graphics/3744_12_23.jpg" alt="How to do it…"/></div></li><li class="listitem">Now we can <a id="id945" class="indexterm"/>log out and log back in with <a id="id946" class="indexterm"/>the <code class="literal">user-dev-1</code> user and the <a id="id947" class="indexterm"/>password <code class="literal">devguy.2015</code>.<p>Now if you <a id="id948" class="indexterm"/>go to the <span class="strong"><strong>Domain</strong></span> tab, in the <span class="strong"><strong>Overview</strong></span> section (the menu item on the left), you will only see the topology of the server group that your user belongs to, as depicted in  the following screenshot:</p><div class="mediaobject"><img src="graphics/3744_12_24.jpg" alt="How to do it…"/></div></li></ol></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec291"/>How it works…</h2></div></div></div><p>There is not much to talk about as the process is pretty straightforward. Let's recap what we did and how we did it.</p><p>First we needed to switch the provider, passing from <code class="literal">simple</code> to the <code class="literal">rbac</code> provider, using the CLI.</p><p>Secondly, we needed to include our management user <code class="literal">wildfly</code> to the <span class="strong"><strong>SuperUser</strong></span> role, which resulted in the following configuration:</p><div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
  &lt;role-mapping&gt;
    &lt;role name="SuperUser"&gt;
      &lt;include&gt;
        &lt;user name="$local"/&gt;
        &lt;user alias="wildfly" realm="ManagementRealm" name="wildfly"/&gt;
      &lt;/include&gt;
    &lt;/role&gt;
  &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div><p>Then we logged into the WildFly Web Console with the user <code class="literal">wildfly</code>, and added our first scoped role. We mapped the scoped role to a server group, the one named <code class="literal">main-server-group</code> with the base role of <code class="literal">Deployer</code>.</p><p>We could have also <a id="id949" class="indexterm"/>mapped our scoped role to a host by <a id="id950" class="indexterm"/>specifying the <code class="literal">Host</code> in the <span class="strong"><strong>Type</strong></span> selection <a id="id951" class="indexterm"/>component, depicted as follows:</p><div class="mediaobject"><img src="graphics/3744_12_25.jpg" alt="How it works…"/></div><p>As you can see, the <a id="id952" class="indexterm"/>scope of the role would have matched the host names available in our configuration, that is, <code class="literal">master</code> in our case.</p><p>Then, we added a user, using the <code class="literal">add- user.sh</code> script:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/add-user.sh --silent=true user-dev-1 devguy.2015 -sc rbac-dmn-scp-roles/configuration</pre></div><p>The <code class="literal">--silent=true</code> command basically means the non-interactive mode; we then passed the username followed by its password, and then we specified the path for storing users. By default, the store is represented by the <code class="literal">mgmt-users.properties</code> file, which corresponds to the <code class="literal">ManagementRealm</code>, on the WildFly side.</p><p>Lastly, we mapped the <a id="id953" class="indexterm"/><code class="literal">user-dev-1</code> to the scoped role, and we logged in with it.</p><p>As a result, we had the <a id="id954" class="indexterm"/>WildFly Web Console available just to the <a id="id955" class="indexterm"/>server group specified in the scoped role, accordingly <a id="id956" class="indexterm"/>to the role assigned to it; in our case that was the <code class="literal">Deployer</code> role.</p></div></div>
<div class="section" title="Integrating with OpenLDAP"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec103"/>Integrating with OpenLDAP</h1></div></div></div><p>In this recipe, you <a id="id957" class="indexterm"/>will learn how to integrate OpenLDAP to provide a user base for our RBAC provider. In an enterprise environment, you usually find databases where companies store their users. Those databases typically have some kind of structure which defines roles, profiles, and/or groups for each user.</p><p>For example, people connecting to a server may or may not see certain files or directories. People accessing an application may or may not find a particular functionality; that could be the case of the WildFly Web Console. LDAP is a protocol used by many databases that are used to store those users' grants. There are many of them such as the Microsoft Active Directory, but to keep us on track with the open source world, we will see and use the OpenLDAP tool.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec292"/>Getting ready</h2></div></div></div><p>For this recipe, you will use a ready-to-use OpenLDAP server as the installation of the OpenLDAP server is out of the scope of this book.</p><p>Nonetheless, we will use the <a id="id958" class="indexterm"/>LDAP structure defined in the following LDIF file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif">https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif</a></li></ul></div><p>By the way, if you want a deep dive into OpenLDAP, you can rely on the excellent book <span class="emphasis"><em>Mastering OpenLDAP: Configuring, Securing and Integrating Directory Services</em></span>, <span class="emphasis"><em>Matt Butcher</em></span>, <span class="emphasis"><em>Packt Publishing</em></span>.</p><p>To get started, let's first create an <code class="literal">ad-hoc</code> folder to run our WildFly. In a terminal window enter the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone rbac-std-ldap</pre></div><p>Now it's time to run our WildFly.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec293"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a <a id="id959" class="indexterm"/>terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=rbac-std-ldap</pre></div></li><li class="listitem">Once started, in a new terminal window, connect to the CLI  and switch to the RBAC provider, as we did in the previous recipes:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /] /core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] :reload()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now that we've successfully switched to the RBAC provider, we need to map our local management user (if you are following the book, you'll know it is <code class="literal">wildfly</code>) to the <span class="strong"><strong>SuperUser</strong></span> role, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /core-service=management/access=authorization/role-mapping=SuperUser/include=wildfly:add(name=wildfly,realm=ManagementRealm,type=USER)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now that we've completely switched to the RBAC provider, we need to configure the <a id="id960" class="indexterm"/>LDAP connection and its grouping filter. Stop WildFly, open the <code class="literal">standalone.xml</code> file, and then add the following <code class="literal">security-realm</code>:<div class="informalexample"><pre class="programlisting">&lt;security-realm name="LDAPRealm"&gt;
    &lt;authentication&gt;
        &lt;ldap connection="ldap" base-dn="ou=Users,dc=example,dc=com"&gt;
            &lt;username-filter attribute="uid"/&gt;
        &lt;/ldap&gt;
    &lt;/authentication&gt;
    &lt;authorization&gt;
        &lt;ldap connection="ldap"&gt;
            &lt;group-search group-name="SIMPLE" 
            iterative="true" group-dn-attribute="dn" group-name-attribute="cn"&gt;
                &lt;group-to-principal base-
                dn="ou=Groups,dc=example,dc=com" recursive="true" search-by="DISTINGUISHED_NAME"&gt;
                    &lt;membership-filter principal-attribute="uniqueMember" /&gt;
                &lt;/group-to-principal&gt;
            &lt;/group-search&gt;
        &lt;/ldap&gt;
    &lt;/authorization&gt;
&lt;/security-realm&gt;</pre></div></li><li class="listitem">Now, just right after the <code class="literal">&lt;/security-realms&gt;</code> XML closing tag, add the following:<div class="informalexample"><pre class="programlisting">&lt;outbound-connections&gt;
    &lt;ldap name="ldap" url="ldap://localhost:389" search-dn="cn=Manager,dc=example,dc=com" search-credential="ldap.2015"/&gt;
&lt;/outbound-connections&gt;</pre></div></li></ol></div><p>Map distinguish name (the <code class="literal">dn</code> attribute), to whatever fits your current LDAP system. Do the same for the <code class="literal">search-credential</code> attribute which represents the password used by the <code class="literal">admin</code> user, specified at the beginning of the <code class="literal">dn</code> attribute: <code class="literal">cn=Manager</code>.</p><p>Also keep in mind that in a production environment you would use the LDAP protocol over SSL, which transmit credentials in a secure way. Thus the URL would be <code class="literal">ldaps://secureldap.intranet:636</code>.</p><p>Keep your <code class="literal">standalone.xml</code> file open and apply the following changes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Find the following definition:<div class="informalexample"><pre class="programlisting">&lt;management-interfaces&gt;
    &lt;http-interface security-realm="ManagementRealm" http-upgrade-enabled="true"&gt;
        &lt;socket-binding http="management-http"/&gt;
    &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</pre></div></li><li class="listitem">Replace it with the following:<div class="informalexample"><pre class="programlisting">&lt;management-interfaces&gt;
    &lt;http-interface security-realm="LDAPRealm" http-
    upgrade-enabled="true"&gt;
        &lt;socket-binding http="management-http"/&gt;
    &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</pre></div></li></ol></div><p>That's all we have to do to integrate LDAP with RBAC for our management console.</p><p>I've populated the OpenLDAP server with the <code class="literal">rbac.ldif</code> file, and have referenced <code class="literal">user1</code> to the custom <a id="id961" class="indexterm"/>groups on OpenLDAP itself. The following is an extraction of such a configuration:</p><div class="informalexample"><pre class="programlisting"># Development Group:
dn: cn=<span class="strong"><strong>Developers</strong></span>,ou=Groups,dc=example,dc=com
cn: Developers
ou: Groups
description: Users who are Developers
uniqueMember: uid=<span class="strong"><strong>user1</strong></span>,ou=Users,dc=example,dc=com
uniqueMember: uid=user3,ou=Users,dc=example,dc=com
uniqueMember: uid=user5,ou=Users,dc=example,dc=com
objectClass: groupOfUniqueNames

# Operational Group:
dn: cn=<span class="strong"><strong>Operational</strong></span>,ou=Groups,dc=example,dc=com
cn: Operational
ou: Groups
description: Users who are Operational
uniqueMember: uid=<span class="strong"><strong>user1</strong></span>,ou=Users,dc=example,dc=com
uniqueMember: uid=user2,ou=Users,dc=example,dc=com
objectClass: groupOfUniqueNames</pre></div><p>Now we need to map the OpenLDAP groups to WildFly's built-in roles, as described in the <span class="emphasis"><em>Managing users, groups, and their role mapping</em></span> recipe, such that <code class="literal">user1</code> would have the roles <span class="strong"><strong>Deployers</strong></span>, <span class="strong"><strong>Operators</strong></span>, and <span class="strong"><strong>Maintainer</strong></span>. Please bind the groups and roles as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_12_26.jpg" alt="How to do it…"/></div><p>Now, if you try to log out and log back into the WildFly Web Console with the user <code class="literal">user1</code>, you will be <a id="id962" class="indexterm"/>first prompted for credentials for the LDAPRealm, as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_12_27.jpg" alt="How to do it…"/></div><p>Next, you will login with proper roles, as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_12_28.jpg" alt="How to do it…"/></div><p>As you can see, the user <code class="literal">user1</code> is logged in with the roles of <span class="strong"><strong>Operator</strong></span>, <span class="strong"><strong>Maintainer</strong></span>, and <span class="strong"><strong>Deployer</strong></span>.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec294"/>How it works…</h2></div></div></div><p>First we needed to <a id="id963" class="indexterm"/>switch the provider, passing from <code class="literal">simple</code> to <code class="literal">rbac</code> using the CLI.</p><p>Secondly, we needed to include our management user <code class="literal">wildfly</code> in the <code class="literal">SuperUser</code> role, which resulted in the following configuration:</p><div class="informalexample"><pre class="programlisting">&lt;access-control provider="rbac"&gt;
    &lt;role-mapping&gt;
        &lt;role name="SuperUser"&gt;
            &lt;include&gt;
                &lt;user name="$local"/&gt;
                &lt;user alias="wildfly" realm="ManagementRealm" name="wildfly"/&gt;
            &lt;/include&gt;
        &lt;/role&gt;
    &lt;/role-mapping&gt;
&lt;/access-control&gt;</pre></div><p>Then we added a new security-realm named LDAPRealm. In it, we defined the authentication and authorization process, which involved setting the proper LDAP distinguish names.</p><p>In order to connect to the LDAP, we had to create a connection reference using the outbound-connections directive.</p><p>Lastly, we mapped the HTTP management interface, the WildFly console, to the LDAPRealm realm.</p><p>Because of the structure of the <code class="literal">rbac.ldif</code> file, where the group that the user belongs to is mapped into the <a id="id964" class="indexterm"/>group itself, we had to instruct the <code class="literal">group-search</code> element instead of the <code class="literal">user-to-dn</code> element.</p></div></div></body></html>