<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Handling Mobiles and Tablets"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Handling Mobiles and Tablets</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing Spring Mobile</li><li class="listitem" style="list-style-type: disc">Detecting mobiles and tablets</li><li class="listitem" style="list-style-type: disc">Switching to the normal view on mobiles</li><li class="listitem" style="list-style-type: disc">Using different JSP views for mobiles automatically</li><li class="listitem" style="list-style-type: disc">Using a <code class="literal">.mobi</code> domain name on mobiles</li><li class="listitem" style="list-style-type: disc">Using an <code class="literal">m.</code> subdomain on mobiles</li><li class="listitem" style="list-style-type: disc">Using a different domain name on mobiles</li><li class="listitem" style="list-style-type: disc">Using a subfolder path on mobiles</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Introduction</h1></div></div></div><p>To build a mobile-friendly website, the current trend is to use responsive design where the page adapts to the screen width. This way, the same page is nicely displayed on all devices: computers, tablets and mobiles.</p><p>Another approach, which this chapter covers, is to build a separate website for mobile devices. This requires building two pages (different HTML and distinct URLs) for each page of the website: one for the computer and one for the mobile. This extra work makes sense when:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Performance is important. For example, the loading time of a responsive website like <a class="ulink" href="https://www.flickr.com/">https://www.flickr.com/</a> would be too long on mobile devices because of the high-resolution images of the desktop version. A separate mobile website makes it easier to optimize the user experience on mobile devices.</li><li class="listitem" style="list-style-type: disc">The computer version of the website already exists; in this case, it's usually much simpler to build a separate mobile website.</li></ul></div><p>In this chapter, we'll cover how to serve different pages to mobile devices using Spring Mobile, a Spring project.</p></div></div>
<div class="section" title="Installing Spring Mobile"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Installing Spring Mobile</h1></div></div></div><p>In this recipe, you'll learn  how to install Spring Mobile and prepare the <a id="id413" class="indexterm"/>Spring configuration class for the other recipes.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec208"/>How to do it…</h2></div></div></div><p>Here are the steps to install Spring Mobile:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Maven dependency for Spring Mobile in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.mobile&lt;/groupId&gt;
  &lt;artifactId&gt;spring-mobile-device&lt;/artifactId&gt;
  &lt;version&gt;1.1.3.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem">Make the Spring configuration class extend <code class="literal">WebMvcConfigurerAdapter</code>:<div class="informalexample"><pre class="programlisting">@Configuration
@EnableWebMvc
@ComponentScan(basePackages = {"com.spring_cookbook.controllers"})
public class AppConfig <span class="strong"><strong>extends WebMvcConfigurerAdapter </strong></span>{</pre></div></li><li class="listitem">Override the <code class="literal">addInterceptors()</code> method from <code class="literal">WebMvcConfigurerAdapter</code>:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec209"/>How it works…</h2></div></div></div><p>The <code class="literal">addInterceptors()</code> method will be used in the following recipes to register various interceptors.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec210"/>There's more…</h2></div></div></div><p>For more information about interceptors, refer to the <span class="emphasis"><em>Executing some code before and after controllers using interceptors</em></span> recipe in <a class="link" href="ch03.html" title="Chapter 3. Using Controllers and Views">Chapter 3</a>, <span class="emphasis"><em>Using Controllers and Views</em></span>.</p></div></div>
<div class="section" title="Detecting mobiles and tablets"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Detecting mobiles and tablets</h1></div></div></div><p>In this recipe, you'll learn how, from a controller method, you can detect whether the current HTTP request has come from a desktop computer, mobile, or tablet.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec211"/>How to do it…</h2></div></div></div><p>Register<a id="id414" class="indexterm"/> a <code class="literal">DeviceResolverHandlerInterceptor</code> interceptor and<a id="id415" class="indexterm"/> use <code class="literal">DeviceUtils</code> in the controller method:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the Spring configuration class, declare a <code class="literal">DeviceResolverHandlerInterceptor</code> bean:<div class="informalexample"><pre class="programlisting">@Bean
public DeviceResolverHandlerInterceptor deviceResolverHandlerInterceptor() {
    return new DeviceResolverHandlerInterceptor();
}</pre></div></li><li class="listitem">Register the <code class="literal">DeviceResolverHandlerInterceptor</code> bean as an interceptor in the <code class="literal">addInterceptors()</code> method:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
registry.addInterceptor(deviceResolverHandlerInterceptor()) ;
}</pre></div></li><li class="listitem">Add an <code class="literal">HttpServletRequest</code> argument to your controller method:<div class="informalexample"><pre class="programlisting">@Controller
public class UserController {  
  @RequestMapping("/user_list")
  public void userList(<span class="strong"><strong>HttpServletRequest request</strong></span>) {</pre></div></li><li class="listitem">Use <code class="literal">DeviceUtils.getCurrentDevice()</code> to generate a <code class="literal">Device</code> object from <code class="literal">HttpServletRequest</code>:<div class="informalexample"><pre class="programlisting">Device currentDevice = DeviceUtils.getCurrentDevice(request);</pre></div></li><li class="listitem">Use the <code class="literal">Device</code> object to detect the type of device that sent the request:<div class="informalexample"><pre class="programlisting">if(currentDevice == null) {
  // detection failed
}
if(currentDevice.isMobile()) {
  // mobile
}
else if(currentDevice.isTablet()) {
  // tablet  
}
else if(currentDevice.isNormal()) {
  // desktop computer
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec212"/>How it works…</h2></div></div></div><p>The <code class="literal">DeviceResolverHandlerInterceptor</code> interceptor generates a <code class="literal">Device</code> object from the <a id="id416" class="indexterm"/>HTTP request and stores it in <code class="literal">HttpServletRequest</code>, passed to<a id="id417" class="indexterm"/> the controller method. <code class="literal">DeviceUtils.getCurrentDevice()</code> is a convenient method to retrieve the <code class="literal">Device</code> object.</p><p>You can then choose to display different JSPs based on the <code class="literal">Device</code> type.</p><p>To generate the <code class="literal">Device</code> object, <code class="literal">DeviceResolverHandlerInterceptor</code> uses <code class="literal">LiteDeviceResolver</code> by default, which uses the <span class="strong"><strong>User-Agent </strong></span>header of the HTTP request. The algorithm is<a id="id418" class="indexterm"/> based on WordPress Mobile Pack's detection algorithm.</p></div></div>
<div class="section" title="Switching to the normal view on mobiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Switching to the normal view on mobiles</h1></div></div></div><p>A mobile user<a id="id419" class="indexterm"/> gets the mobile version of the website by <a id="id420" class="indexterm"/>default, but he/she may want to access some contents displayed only on the normal version. Spring Mobile offers the <code class="literal">SitePreference</code> object for that purpose, which is to be used instead of the <code class="literal">Device</code> object used in the previous recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec213"/>How to do it…</h2></div></div></div><p>Follow these steps to create links, to switch between the normal version and the mobile version of a website:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the Spring configuration class, declare a <code class="literal">DeviceResolverHandlerInterceptor</code> bean and a <code class="literal">SitePreferenceHandlerInterceptor</code> bean and register them as interceptors:<div class="informalexample"><pre class="programlisting">@Bean
public <span class="strong"><strong>DeviceResolverHandlerInterceptor</strong></span> deviceResolverHandlerInterceptor() {
    return new DeviceResolverHandlerInterceptor();
}

@Bean
public <span class="strong"><strong>SitePreferenceHandlerInterceptor</strong></span> sitePreferenceHandlerInterceptor() {
    return new SitePreferenceHandlerInterceptor();
}


@Override
public void addInterceptors(InterceptorRegistry registry) {
    registry.addInterceptor(deviceResolverHandlerInterceptor()) ;
    registry.addInterceptor(sitePreferenceHandlerInterceptor()) ;
}</pre></div></li><li class="listitem">In your<a id="id421" class="indexterm"/> controller method, add an <code class="literal">HttpServletRequest</code> argument:<div class="informalexample"><pre class="programlisting">@Controller
public class UserController {  
  @RequestMapping("/user_list")
  public void userList(<span class="strong"><strong>HttpServletRequest request</strong></span>) {</pre></div></li><li class="listitem">Use <code class="literal">SitePreferenceUtils.getCurrentSitePreference()</code> to generate a <code class="literal">SitePreference</code> object:<div class="informalexample"><pre class="programlisting">SitePreference sitePreference = SitePreferenceUtils.getCurrentSitePreference(request);</pre></div></li><li class="listitem">Use the <code class="literal">SitePreference</code> object to <a id="id422" class="indexterm"/>detect the version of the page to be displayed:<div class="informalexample"><pre class="programlisting">if(sitePreference == null || sitePreference.isNormal()) {
  // normal
}
if(sitePreference.isMobile()) {
  // mobile
}</pre></div></li><li class="listitem">In the view, add links to the two versions of the page:<div class="informalexample"><pre class="programlisting">Site:
&lt;a href="?site_preference=normal"&gt;Normal&lt;/a&gt;
| 
&lt;a href="?site_preference=mobile"&gt;Mobile&lt;/a&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec214"/>How it works…</h2></div></div></div><p>Spring Mobile automatically detects the <code class="literal">site_preference</code> parameter (via the <code class="literal">SitePreferenceHandlerInterceptor</code> interceptor) and adjusts the <code class="literal">SitePreference</code> value accordingly.</p><p>By default, the <code class="literal">SitePreference</code> value is the same as <code class="literal">Device</code>. For example, a <span class="emphasis"><em>mobile</em></span> preference for a <span class="emphasis"><em>mobile</em></span> device. When the user clicks on a link containing a <code class="literal">site_preference</code> parameter, the site preference is changed, but the device type remains the same. For <a id="id423" class="indexterm"/>example, a <span class="emphasis"><em>normal</em></span> preference for a <span class="emphasis"><em>mobile</em></span> device.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec215"/>There's more…</h2></div></div></div><p>Spring Mobile <a id="id424" class="indexterm"/>supports a <span class="emphasis"><em>tablet</em></span> site preference. Some websites provide pages optimized for tablets; Google Search, for example, provides a page optimized for tablets.</p></div></div>
<div class="section" title="Using different JSP views for mobiles automatically"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Using different JSP views for mobiles automatically</h1></div></div></div><p>Instead of having to manually select the correct JSP in each controller method depending on the request device or site preference, use <code class="literal">LiteDeviceDelegatingViewResolver</code> provided by Spring Mobile.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec216"/>How to do it…</h2></div></div></div><p>In the <a id="id425" class="indexterm"/>Spring configuration class, replace <a id="id426" class="indexterm"/>any existing <code class="literal">ViewResolver</code> bean with a <code class="literal">LiteDeviceDelegatingViewResolver</code> bean:</p><div class="informalexample"><pre class="programlisting">@Bean
public LiteDeviceDelegatingViewResolver liteDeviceAwareViewResolver() {
    InternalResourceViewResolver delegate = new InternalResourceViewResolver();
    delegate.setPrefix("/WEB-INF/jsp/");
    delegate.setSuffix(".jsp");
    LiteDeviceDelegatingViewResolver resolver = new LiteDeviceDelegatingViewResolver(delegate);
    <span class="strong"><strong>resolver.setMobilePrefix("mobile/");</strong></span>
    resolver.setEnableFallback(true);
    return resolver;
}</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec217"/>How it works…</h2></div></div></div><p>For a controller returning the <code class="literal">userList</code> String, the <code class="literal">/WEB-INF/userList.jsp</code> JSP view will be used if the site preference is <span class="emphasis"><em>normal</em></span>. The <code class="literal">/WEB-INF/mobile/userList.jsp</code> JSP view will be used if the site preference is <span class="emphasis"><em>mobile</em></span>.</p><p>If the site <a id="id427" class="indexterm"/>preference is <span class="emphasis"><em>mobile</em></span> and <code class="literal">/WEB-INF/mobile/userList.jsp</code> doesn't exist, <code class="literal">/WEB-INF/userList.jsp</code> will be used as a fallback instead. This is enabled by the line:</p><div class="informalexample"><pre class="programlisting">resolver.setEnableFallback(true);</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec218"/>There's more…</h2></div></div></div><p><code class="literal">LiteDeviceDelegatingViewResolver</code> supports custom JSP views for tablets:</p><div class="informalexample"><pre class="programlisting">resolver.setTabletPrefix("tablet/");</pre></div></div></div>
<div class="section" title="Using a .mobi domain name on mobiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec94"/>Using a .mobi domain name on mobiles</h1></div></div></div><p>In this recipe, you'll learn how to use a top-level <code class="literal">.mobi</code> domain name for the mobile pages of<a id="id428" class="indexterm"/> your website. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.com</code> for the normal website</li><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.mobi</code> for the mobile version</li></ul></div><p>The top-level <a id="id429" class="indexterm"/>domain name <code class="literal">.mobi</code> has been created to enable visitors of a website to ask explicitly for its mobile version. For example, <a class="ulink" href="http://google.mobi">http://google.mobi</a>. Google, Microsoft, Nokia, and Samsung originally sponsored it.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec219"/>Getting ready</h2></div></div></div><p>Make sure that the <code class="literal">SitePreferenceHandlerInterceptor</code> interceptor is declared in the Spring configuration. Refer to the <span class="emphasis"><em>Switching to the normal view on mobiles</em></span> recipe in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec220"/>How to do it…</h2></div></div></div><p>Follow these steps to use a <code class="literal">.mobi</code> domain name for the mobile version of the website:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the Spring configuration, declare a <code class="literal">SiteSwitcherHandlerInterceptor</code> bean initialized with the <code class="literal">dotMobi()</code> method with your main domain name as a parameter:<div class="informalexample"><pre class="programlisting">@Bean
public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {
    return SiteSwitcherHandlerInterceptor.<span class="strong"><strong>dotMobi</strong></span>("mywebsite.com");
}</pre></div></li><li class="listitem">Declare that bean as an interceptor:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
  ...
registry.addInterceptor(siteSwitcherHandlerInterceptor());
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec221"/>How it works…</h2></div></div></div><p>Behind<a id="id430" class="indexterm"/> the scenes, <code class="literal">SiteSwitcherHandlerInterceptor</code> reads the current <code class="literal">SitePreference</code> value (<span class="emphasis"><em>normal</em></span>, <span class="emphasis"><em>tablet</em></span>, or <span class="emphasis"><em>mobile</em></span>) and performs a redirect to the correct domain name if necessary. For <a id="id431" class="indexterm"/>example, an HTTP request from a mobile device for <code class="literal">mywebsite.com</code> will be automatically redirected to <code class="literal">mywebsite.mobi</code>. A tablet will go to the normal website.</p></div></div>
<div class="section" title="Using an m. subdomain on mobiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec95"/>Using an m. subdomain on mobiles</h1></div></div></div><p>In this <a id="id432" class="indexterm"/>recipe, you'll learn how to use an <code class="literal">m.</code> subdomain<a id="id433" class="indexterm"/> for the mobile pages of your website. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.com</code> for the normal website</li><li class="listitem" style="list-style-type: disc"><code class="literal">m.mysite.com</code> for the mobile version</li></ul></div><p>Some advantages of an <code class="literal">m.</code> subdomain are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">No need to purchase another domain name (and another SSL certificate if you're using HTTPS)</li><li class="listitem" style="list-style-type: disc">It is easy to remember for the user</li></ul></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec222"/>Getting ready</h2></div></div></div><p>Make sure that the <code class="literal">SitePreferenceHandlerInterceptor</code> interceptor is declared in the Spring configuration. Refer to the <span class="emphasis"><em>Switching to the normal view on mobiles</em></span> recipe in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec223"/>How to do it…</h2></div></div></div><p>Follow these steps to use a <code class="literal">m.</code> subdomain for the mobile version of the website:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the Spring configuration, declare a <code class="literal">SiteSwitcherHandlerInterceptor</code> bean initialized with the <code class="literal">mDot()</code> method with your main domain name as a parameter:<div class="informalexample"><pre class="programlisting">@Bean
public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {
    return SiteSwitcherHandlerInterceptor.<span class="strong"><strong>mDot</strong></span>("mywebsite.com");
}</pre></div></li><li class="listitem">Declare that bean as an interceptor:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
  ...
registry.addInterceptor(siteSwitcherHandlerInterceptor());
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec224"/>How it works…</h2></div></div></div><p>Behind<a id="id434" class="indexterm"/> the scenes, <code class="literal">SiteSwitcherHandlerInterceptor</code> reads the current <code class="literal">SitePreference</code> value (<span class="emphasis"><em>normal</em></span>,<span class="emphasis"><em> tablet</em></span>, or <span class="emphasis"><em>mobile</em></span>) and performs a redirect to the correct domain name if necessary. For <a id="id435" class="indexterm"/>example, an HTTP request from a mobile device for <code class="literal">mywebsite.com</code> will be automatically redirected to <code class="literal">m.mywebsite.com</code>. A tablet will go to the normal website.</p></div></div>
<div class="section" title="Using a different domain name on mobiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec96"/>Using a different domain name on mobiles</h1></div></div></div><p>In this recipe, you'll learn how to use a different domain name for the mobile pages of your website. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.com</code> for the normal website</li><li class="listitem" style="list-style-type: disc"><code class="literal">mymobilesite.com</code> for the mobile version</li></ul></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec225"/>Getting ready</h2></div></div></div><p>Make <a id="id436" class="indexterm"/>sure that the <code class="literal">SitePreferenceHandlerInterceptor</code> interceptor is declared in the Spring configuration. Refer<a id="id437" class="indexterm"/> to the <span class="emphasis"><em>Switching to the normal view on mobiles</em></span> recipe in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec226"/>How to do it…</h2></div></div></div><p>Follow these steps to use a different domain name for the mobile version of the website:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <a id="id438" class="indexterm"/>Spring configuration, declare <a id="id439" class="indexterm"/>a <code class="literal">SiteSwitcherHandlerInterceptor</code> bean initialized with the <code class="literal">standard()</code> method with your main domain name, mobile domain name, and the value for the <code class="literal">Set-Cookie</code> HTTP header field:<div class="informalexample"><pre class="programlisting">@Bean
public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {
    return SiteSwitcherHandlerInterceptor.<span class="strong"><strong>standard</strong></span>("mywebsite.com", "mymobilewebsite.com", ".mywebsite.com");
}</pre></div></li><li class="listitem">Declare that bean as an interceptor:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
  ...
registry.addInterceptor(siteSwitcherHandlerInterceptor());
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec227"/>How it works…</h2></div></div></div><p>Behind the scenes, <code class="literal">SiteSwitcherHandlerInterceptor</code> reads the current <code class="literal">SitePreference</code> value (<span class="emphasis"><em>normal</em></span>,<span class="emphasis"><em> tablet</em></span>, or <span class="emphasis"><em>mobile</em></span>) and performs a redirect to the correct domain name if necessary. For example, an HTTP request from a mobile device for <code class="literal">mywebsite.com</code> will be redirected automatically to <code class="literal">mymobilewebsite.com</code>. A tablet will go to the normal website.</p><p>The <code class="literal">Set-Cookie</code> HTTP header field contains the <code class="literal">SitePreference</code> value. The cookie allows us to share that value with subdomains. In this recipe, <code class="literal">.mywebsite.com</code> makes the <code class="literal">SitePreference</code> value available to <code class="literal">www.mywebsite.com</code>, for example.</p></div></div>
<div class="section" title="Using a subfolder path on mobiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec97"/>Using a subfolder path on mobiles</h1></div></div></div><p>In this recipe, you'll learn<a id="id440" class="indexterm"/> how to use a subfolder in the <a id="id441" class="indexterm"/>URL for the mobile pages of your website. For example:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.com</code> for the normal website</li><li class="listitem" style="list-style-type: disc"><code class="literal">mysite.com/mobile</code> for the mobile version</li></ul></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec228"/>Getting ready</h2></div></div></div><p>Make sure that the <code class="literal">SitePreferenceHandlerInterceptor</code> interceptor is declared in the Spring configuration. Refer to the <span class="emphasis"><em>Switching to the normal view on mobiles</em></span> recipe in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec229"/>How to do it…</h2></div></div></div><p>Follow these steps to use a subfolder path for the mobile version of the website:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the Spring configuration, declare a <code class="literal">SiteSwitcherHandlerInterceptor</code> bean initialized with the <code class="literal">urlPath()</code> method with the subfolder name and the web application root path if necessary:<div class="informalexample"><pre class="programlisting">@Bean
public SiteSwitcherHandlerInterceptor siteSwitcherHandlerInterceptor() {
    return SiteSwitcherHandlerInterceptor.<span class="strong"><strong>urlPath</strong></span>("/mobile", "spring_webapp");
}</pre></div></li><li class="listitem">Declare that bean as an interceptor:<div class="informalexample"><pre class="programlisting">@Override
public void addInterceptors(InterceptorRegistry registry) {
  ...
registry.addInterceptor(siteSwitcherHandlerInterceptor());
}</pre></div></li><li class="listitem">Add the controller method for the URL with the <code class="literal">mobile</code> subfolder:<div class="informalexample"><pre class="programlisting">@RequestMapping("<span class="strong"><strong>/mobile</strong></span>/user_list")
public String userListMobile(HttpServletRequest request) {
  ...
  return "user_list";
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec230"/>How it works…</h2></div></div></div><p>Behind the scenes, <code class="literal">SiteSwitcherHandlerInterceptor</code> reads the current <code class="literal">SitePreference</code> value (<span class="emphasis"><em>normal</em></span>, <span class="emphasis"><em>tablet</em></span>, or <span class="emphasis"><em>mobile</em></span>) and performs a redirect to add or remove <a id="id442" class="indexterm"/>the <code class="literal">mobile</code> subfolder to the URL if necessary. For <a id="id443" class="indexterm"/>example, an HTTP request from a mobile device for <code class="literal">mywebsite.com</code> will be automatically redirected to <code class="literal">mywebsite.com/mobile</code>. A tablet will go to the normal website.</p></div></div></body></html>