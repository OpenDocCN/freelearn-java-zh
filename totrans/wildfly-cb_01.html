<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Welcome to WildFly!"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Welcome to WildFly!</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Software prerequisites</li><li class="listitem" style="list-style-type: disc">Downloading and installing WildFly</li><li class="listitem" style="list-style-type: disc">Understanding WildFly's directory overview</li><li class="listitem" style="list-style-type: disc">Running WildFly in standalone mode</li><li class="listitem" style="list-style-type: disc">Running WildFly in domain mode</li><li class="listitem" style="list-style-type: disc">Running WildFly as a service</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Introduction</h1></div></div></div><p>In this first chapter, we will describe WildFly's history, its prerequisites, where to get it, and how to install it. We will also explain the standalone and domain running modes, that is, how to run them up.</p><p>JBoss.org community is <a id="id0" class="indexterm"/>a huge community, where people all over the world develop, test, and document pieces of code. There are a lot of projects in there other than JBoss AS or the recent WildFly such as Infinispan, Undertow, PicketLink, Arquillian, HornetQ, RESTeasy, AeroGear, and Vert.x. For a complete list of all projects, visit the <a id="id1" class="indexterm"/>following site: <a class="ulink" href="http://www.jboss.org/projects/">http://www.jboss.org/projects/</a>.</p><p>Despite marketing reasons, as there is no preferred project, the community wanted to change the name of the JBoss AS project to something different that would not collide with the community name. The other reason was the Red Hat JBoss supported version named JBoss <a id="id2" class="indexterm"/><span class="strong"><strong>Enterprise Application Platform</strong></span> (<span class="strong"><strong>EAP</strong></span>). This was another point towards replacing the JBoss AS name. </p><p>How did the community change the name? How would they have decided? Easy—ask us, the community, for new names. The election process started, people from the JBoss Community, <span class="strong"><strong>JBoss </strong></span><a id="id3" class="indexterm"/><span class="strong"><strong>User Group</strong></span> (<span class="strong"><strong>JBUGs</strong></span>), <span class="strong"><strong>Java User Group </strong></span>(<span class="strong"><strong>JUGs</strong></span>), and <a id="id4" class="indexterm"/>related communities all over the world, expressed their preferences.</p><p>The new name for JBoss AS should have suggested Java application server capabilities and affinities such as integration, cloud, mobile, messaging, nimbleness, strength, open source, free spirit, and so on. You guessed the winner!</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>"A wild fly is extremely agile, lightweight, untamed and truly free."</em></span></p></blockquote></div><p>The brand new name was announced during the JUDCon 2013 in Brazil. Zzzzhhh... Welcome to WildFly!</p><p>Let's talk about the <a id="id5" class="indexterm"/>WildFly features and characteristics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">WildFly replaces JBoss AS. The first version of WildFly was 8.0, which was based on JBoss AS 7.1. To keep things simple the community decided to keep the same numbering.</li><li class="listitem" style="list-style-type: disc">WildFly has gained the Java EE 7 Full platform compatible implementations badge, which means it has the newest Java technologies. Easy development, better security, better integration, better management! </li><li class="listitem" style="list-style-type: disc">WildFly boots in seconds. All its services start up together, but just the ones that it needs. This is because there is a centralized metadata cache and a modular classloading system, which prevents the famous classpath hell.</li><li class="listitem" style="list-style-type: disc">Another big change is the default web server; WildFly now utilizes Undertow.<div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>"Undertow is a flexible performant web server written in java, providing both blocking and non-blocking API's based on NIO."</em></span></p></blockquote></div></li><li class="listitem" style="list-style-type: disc">It is lightweight, less then 1 MB for its core jar, and less then 4 MB at runtime. Undertow is embeddable, flexible; it supports WebSocket (HTTP upgrade protocols) and Servlet 3.1. Later in the book, we will see how to configure and tune Undertow embedded in WildFly.</li><li class="listitem" style="list-style-type: disc">With this new <a id="id6" class="indexterm"/>release of WildFly has been introduced a <span class="strong"><strong>Role Based Access Control</strong></span> (<span class="strong"><strong>RBAC</strong></span>) system. This new feature actually gives functionalities to define users, groups and roles. This way you will have not simply a Superuser, but a user to do its proper task without compromising on security. It's highly customizable and it can be integrated with most identity stores such as LDAPs and ADs.</li><li class="listitem" style="list-style-type: disc">WildFly has just one configuration file, so that all your settings are centralized in one place.</li><li class="listitem" style="list-style-type: disc">You can manage your configurations through the Admin Console (also known as Web Console), the <span class="strong"><strong>Command Line Interface</strong></span> (<span class="strong"><strong>CLI</strong></span>), the REST API and the <a id="id7" class="indexterm"/>Java API. All these tools give great powers to customize your management settings. Within this book we will concentrate mainly on the CLI and the Admin Console.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>WildFly has been built using Java SE 1.7; thus, it requires you to have at least a JRE version 1.7.</p></div></div></li></ul></div><p>Having said that, let's start for real!</p><p>In the following recipes we will see what we need to start JBoss AS, ops, and WildFly, where to get it, what does its folder structure look like, and where to find its configuration files.</p></div></div>
<div class="section" title="Software prerequisites"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Software prerequisites</h1></div></div></div><p>WildFly runs on top <a id="id8" class="indexterm"/>of the Java platform. It needs at least a <span class="strong"><strong>Java Runtime Environment</strong></span> (<span class="strong"><strong>JRE</strong></span>) version 1.7 to run (further references to versions 1.7 and 7 should be considered equal—the same applies for versions 1.8 and 8 as well), but it also works perfectly with the latest JRE version 8.</p><p>As we will also need to compile and build Java web applications, we will need the <span class="strong"><strong>Java Development Kit</strong></span> (<span class="strong"><strong>JDK</strong></span>), which provides the necessary tools to work with the Java source code. In the JDK panorama we can find the Oracle JDK, developed and maintained by Oracle, and OpenJDK, which relies on community contribution.</p><p>Nevertheless, after <a id="id9" class="indexterm"/>April 2015, Oracle will no longer post updates of Java SE 7 to its public download sites, as mentioned at <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/eol-135779.html">http://www.oracle.com/technetwork/java/javase/downloads/eol-135779.html</a>. Also, keep in mind that the Java Critical Patch Updates are released on a quarterly basis; thus, for reasons of stability and feature support, we will use the Oracle JDK 8, which is freely <a id="id10" class="indexterm"/>available for download at <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</p><p>While writing this book, the latest stable Oracle JDK is version 1.8.0_31 (as well as 8u31). Hereby, every reference to <span class="strong"><strong>Java Virtual Machine</strong></span> (<span class="strong"><strong>JVM</strong></span>), Java, JRE, and JDK will be intended Oracle JDK 1.8.0_31. To keep things simple, if you don't mind, use that same version.</p><p>In addition to the JDK, we <a id="id11" class="indexterm"/>will need Apache Maven 3, which is a build tool for Java projects. It is freely available for download at <a class="ulink" href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a>. A generic download link can be found at <a class="ulink" href="http://www.us.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.tar.gz">http://www.us.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.tar.gz</a>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Getting ready</h2></div></div></div><p>To fully follow the recipes in the book, using the same environment is a fundamental requirement. As I cannot replicate the same recipe to suit different settings (such as Windows, Mac, and Linux), I'll use Linux (actually, Fedora 21) as the base operating system.</p><p>If you are running a different <a id="id12" class="indexterm"/>system and you want to carefully follow what's in the book, you can easily install and run Fedora 21 inside a virtual <a id="id13" class="indexterm"/>machine using the VirtualBox software, available at <a class="ulink" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Choose the version that is compatible with your actual system. You can install Fedora 21 by <a id="id14" class="indexterm"/>downloading its image at <a class="ulink" href="https://getfedora.org/en/workstation/">https://getfedora.org/en/workstation/</a>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>The installation of the above software is out of the scope of this book.</p></div></div></li><li class="listitem">To install the Oracle <a id="id15" class="indexterm"/>JDK, you need to open your browser and point it to <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a>.</li><li class="listitem">Once there, click on the JDK download link, as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_01_01.jpg" alt="Getting ready"/></div></li><li class="listitem">The link will take <a id="id16" class="indexterm"/>you to the download page, where you first need to mark the option of <span class="strong"><strong>Accept License Agreement</strong></span> to enable the links, as depicted in the following screenshot:<div class="mediaobject"><img src="graphics/3744_01_02.jpg" alt="Getting ready"/></div></li><li class="listitem">As you accept the <a id="id17" class="indexterm"/>agreement, all the links get activated. Choose the one that best fits your hardware and operating system.<div class="mediaobject"><img src="graphics/3744_01_03.jpg" alt="Getting ready"/></div><p>I'm running a Fedora 21 Linux machine, with a 64-bit hardware support, thus I'll use the <span class="strong"><strong>jdk-8u40-linux-x64.tar.gz</strong></span> bundle. I could have used the RPM bundle, but I prefer installing the archive version to better fit my needs in terms of paths; what goes where.</p></li><li class="listitem">Next, we will create a folder named <code class="literal">WFC</code>, which stands for <span class="emphasis"><em>WildFly Cookbook</em></span> to store the contents of all the necessary software, codes, and files to follow all the recipes of the <a id="id18" class="indexterm"/>book. Open your terminal application and run the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd &amp;&amp; mkdir WFC</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>The <code class="literal">WFC</code> folder is used just to not interfere with your current environment.</p></div></div></li></ol></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Choose the package archive; once the download is complete, open your command line and extract its contents to the <code class="literal">WFC</code> folder as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; tar zxvf jdk-8u40-linux-x64.tar.gz</strong></span>
</pre></div><p>This will extract the Oracle JDK software into the <code class="literal">jdk1.8.0_40</code> folder, inside the <code class="literal">WFC</code> folder starting from your <code class="literal">home</code> folder. For convenience, we will use a different folder name, like <code class="literal">jdk8</code>, to refer to the preceding JDK installation folder. Run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; mv jdk1.8.0_40 jdk8</strong></span>
</pre></div><p>Now we need to set the <code class="literal">JAVA_HOME</code> environment variable and make the JDK commands available from our shell (also terminal).</p></li><li class="listitem">Open a text editor of your choice, and add the following directives to the <code class="literal">.bash_profile</code> file placed in your <code class="literal">home</code> folder:<div class="informalexample"><pre class="programlisting">export JAVA_HOME=~/WFC/jdk8
export PATH=$JAVA_HOME/bin:$PATH</pre></div><p>The preceding two commands will set the <code class="literal">JAVA_HOME</code> variable and export the <code class="literal">JAVA_HOME/bin</code> path into your <span class="strong"><strong>PATH</strong></span> system variable, respectively. The tilde <code class="literal">~</code> symbol is a shortcut to the user home directory in Unix-like systems.</p><p>For the changes to take effect, you can either log out and log back in, or just issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source ~/.bash_profile</strong></span>
</pre></div></li><li class="listitem">Once you are done with the installation phase, test your new environment by executing the <code class="literal">java -version</code> command in your terminal application and you should see (more or less) the output as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_01_04.jpg" alt="How to do it…"/></div></li><li class="listitem">Next, we need to <a id="id19" class="indexterm"/>install Apache Maven 3. If you haven't downloaded it yet, click on the following link:<p>
<a class="ulink" href="http://www.us.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.tar.gz">http://www.us.apache.org/dist/maven/maven-3/3.2.5/binaries/apache-maven-3.2.5-bin.tar.gz</a>
</p></li><li class="listitem">Once the download is <a id="id20" class="indexterm"/>complete, open your command line and extract its content to the <code class="literal">WFC</code> folder:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; tar zxvf apache-maven-3.2.5-bin.tar.gz</strong></span>
</pre></div><p>This will extract the Apache Maven (also known as Maven) software into the <code class="literal">apache-maven-3.2.5</code> folder, inside the <code class="literal">WFC</code> folder, starting from your <code class="literal">home</code> folder. For convenience, we will use a different folder name, like <code class="literal">maven</code>, to refer to the preceding Maven installation folder. Run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; mv apache-maven-3.2.5 maven</strong></span>
</pre></div><p>Now we need to set the <code class="literal">M2_HOME</code> environment variable and make Maven's commands available from our shell (also terminal).</p></li><li class="listitem">Open a text editor of your choice, and add the following directives to the <code class="literal">.bash_profile</code> file placed in your <code class="literal">home</code> folder:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>export M2_HOME=~/WFC/maven</strong></span>
<span class="strong"><strong>export PATH=$JAVA_HOME/bin:M2_HOME/bin:$PATH</strong></span>
</pre></div><p>The preceding two commands will set the <code class="literal">M2_HOME</code> variable and export the <code class="literal">M2_HOME/bin</code> path into your <span class="strong"><strong>PATH</strong></span> system variable, respectively. The tilde <code class="literal">~</code> symbol is a shortcut to the user home directory, in Unix-like systems.</p><p>For the changes to take effect, you can either log out and log back in, or just issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source ~/.bash_profile</strong></span>
</pre></div></li><li class="listitem">Once you are done with the installation phase, test your new environment by executing the <code class="literal">mvn -version</code> command in your terminal application and you should see (more or less) the <a id="id21" class="indexterm"/>output as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_01_05.jpg" alt="How to do it…"/></div></li><li class="listitem">Last, but not the least, we will need to install the <code class="literal">git</code>, which is a distributed revision control system. It is mainly used with the source code, but it's also used as a configuration repository. To install the <code class="literal">git</code> tool, we will rely on the <code class="literal">yum</code> software manager, which makes the installation process easy. Open a terminal and do as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo yum -y install git</strong></span>
</pre></div></li><li class="listitem">Once done, try to hit the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git version</strong></span>
<span class="strong"><strong>git version 2.1.0</strong></span>
</pre></div></li></ol></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>There's more…</h2></div></div></div><p>Now that we have the <code class="literal">git</code> installed, we can proceed to download the code repository (or repo) used for this book, available <a id="id22" class="indexterm"/>on my GitHub account at the following URL: <a class="ulink" href="https://github.com/foogaro/wildfly-cookbook.git">https://github.com/foogaro/wildfly-cookbook.git</a>.</p><p>You can <code class="literal">git-clone</code> the repository or just download it as a ZIP archive. Either way, create a folder named <code class="literal">github</code> into the <code class="literal">WFC</code> folder and place the source into it.</p><p>Using the <code class="literal">git-clone</code> command, do as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC</strong></span>
<span class="strong"><strong>$ mkdir github</strong></span>
<span class="strong"><strong>$ cd github</strong></span>
<span class="strong"><strong>$ git clone https://github.com/foogaro/wildfly-cookbook.git</strong></span>
</pre></div><p>Once the <code class="literal">git</code> has done cloning the repo, you will find a new folder named <code class="literal">wildfly-cookbook</code> where you can find all the projects used for the book.</p><p>To build a project, just go into the proper folder and execute the <code class="literal">maven-package</code> command.</p><p>For example, to build the project <code class="literal">example</code>, do as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC/github/wildfly-cookbook/example</strong></span>
<span class="strong"><strong>$ mvn -e clean package</strong></span>
</pre></div><p>The preceding commands builds the project, and generate the web application artifact into a folder named <code class="literal">target</code>. There you can find the application <code class="literal">example.war</code>, ready to be deployed.</p><p>OK, we have finally finished installing all the software that we will need and use within the book. Just to be sure you <a id="id23" class="indexterm"/>are not missing any piece, you should have an environment as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_01_06.jpg" alt="There's more…"/></div></div></div>
<div class="section" title="Downloading and installing WildFly"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Downloading and installing WildFly</h1></div></div></div><p>In this recipe, we <a id="id24" class="indexterm"/>will learn how to get and install WildFly. As <a id="id25" class="indexterm"/>always, in the open source world you can do the same thing in different ways. WildFly can be installed using your preferred software manager or by downloading the <a id="id26" class="indexterm"/>bundle provided by the <a class="ulink" href="http://wildfly.org">http://wildfly.org</a> site. We will choose the second way, as per the JDK.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>Getting ready</h2></div></div></div><p>Just open your favorite browser and point it to <a class="ulink" href="http://wildfly.org/downloads/">http://wildfly.org/downloads/</a>. You should see a page <a id="id27" class="indexterm"/>similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/3744_01_07.jpg" alt="Getting ready"/><div class="caption"><p>WildFly's download page</p></div></div><p>At the time of writing this book, the latest WildFly was version 9.0.0.Beta2. The final version is now available and in use.</p><p>Now, download the latest version into the <code class="literal">WFC</code> folder.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Once the download is complete, open a terminal and extract its contents into the <code class="literal">WFC</code> folder, executing the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; tar zx wildfly-9.0.0.Beta2.tar.gz</strong></span>
</pre></div><p>The preceding command will first point to our <code class="literal">WildFly Cookbook</code> folder; it will then extract the WildFly archive from it. Listing our <code class="literal">WFC</code> folder, we should find the newly created WildFly' folder named <code class="literal">wildfly-9.0.0.Beta2</code>.</p></li><li class="listitem">To better <a id="id28" class="indexterm"/>remember and handle WildFly's installation directory, rename it <code class="literal">wildfly</code>, as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd ~/WFC &amp;&amp; mv wildfly-9.0.0.Beta2 wildfly</strong></span>
</pre></div><p>By the way, WildFly can be also installed using the traditional <code class="literal">YUM</code>, Fedora's software manager.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>In a production environment, you will <span class="emphasis"><em>not</em></span> place the WildFly installation directory into the <code class="literal">home</code> folder of a specific user. Rather, you will be placing it into different paths, relative to the context you are working in.</p></div></div></li><li class="listitem">Now we need to create the <code class="literal">JBOSS_HOME</code> environment variable, which is used by WildFly itself as base directory when it starts up (probably in future releases, this will be updated to <code class="literal">WILDFLY_HOME</code>). We will also create the <code class="literal">WILDFLY_HOME</code> <a id="id29" class="indexterm"/>environment variable, which we will use throughout the whole book to reference WildFly's installation directory. Thus, open the <code class="literal">.bash_profile</code> file, placed in your <code class="literal">home</code> folder, with your favorite text editor and add the following directives:<div class="informalexample"><pre class="programlisting">export JBOSS_HOME=~/WFC/wildfly
export WILDFLY_HOME=$JBOSS_HOME</pre></div></li><li class="listitem">For the changes to take effect, you can either log out and log back in, or just issue the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ source ~/.bash_profile</strong></span>
</pre></div></li></ol></div><p>If you followed the first two recipes carefully, your .<code class="literal">bash_profile</code> file should look like the following image:</p><div class="mediaobject"><img src="graphics/3744_01_08.jpg" alt="How to do it…"/></div></div></div>
<div class="section" title="Understanding WildFly's directory overview"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Understanding WildFly's directory overview</h1></div></div></div><p>Now that we have <a id="id30" class="indexterm"/>finished installing WildFly, let's look into its folders. This recipe is going to be a little theoretical.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your <a id="id31" class="indexterm"/>terminal and run the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd $WILDFLY_HOME</strong></span>
<span class="strong"><strong>$ pwd &amp;&amp; ls -la</strong></span>
</pre></div></li><li class="listitem">The output of your commands should be similar to the following image:<div class="mediaobject"><img src="graphics/3744_01_09.jpg" alt="How to do it…"/><div class="caption"><p>WildFly's folders overview</p></div></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>How it works…</h2></div></div></div><p>The preceding image depicts <a id="id32" class="indexterm"/>WildFly's folders in the filesystem. Each is outlined in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">appclient</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configuration files, deployment content, and writable areas used by the application client container run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bin</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Start up scripts, start up configuration files, and various command line utilities like Vault, add-user, and Java diagnostic report available for Unix and Windows environments.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">bin/client</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Contains a client jar for use by non-maven based clients.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">docs/schema</code>
</p>
</td><td style="text-align: left" valign="top">
<p>XML schema definition files.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">docs/examples/configs</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Example configuration files representing specific use cases.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">domain</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configuration files, deployment content, and writable areas used by the domain mode processes run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">modules</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly is based on a modular class loading architecture. The various modules used in the server are stored here.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">standalone</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configuration files, deployment content, and writable areas used by the single standalone server run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">welcome-content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Default Welcome Page content.</p>
</td></tr></tbody></table></div><p>In the preceding table, I've emphasized the "domain" and the "standalone" folders which are those that determine the mode which WildFly will run in: standalone or domain. In the next few recipes, we will <a id="id33" class="indexterm"/>have an overview of them, and get a deep insight later in the book.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Hereby, whenever <a id="id34" class="indexterm"/>mentioned, WildFly's home will be intended as <code class="literal">$WILDFLY_HOME</code>.</p></div></div></div></div>
<div class="section" title="Running WildFly in standalone mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Running WildFly in standalone mode</h1></div></div></div><p>WildFly in the <a id="id35" class="indexterm"/>standalone mode means a WildFly instance is launched and managed on its own. You can have as many standalone WildFly <a id="id36" class="indexterm"/>instances as you like, but you will have to manage them separately. This means that every configuration, datasource, deployment, and module has to be managed once per instance.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>The main difference between the standalone and domain modes is about management and not about capabilities. Capabilities are determined by the profile you choose to run WildFly with.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec18"/>Getting ready</h2></div></div></div><p>Let's have a look into the standalone folder:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder's name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">configuration</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configuration files used by the single standalone server run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">deployments</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Deployments content used by the single standalone server run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">lib</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Libraries used by the single standalone server run from this installation.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">log</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Log files created by the single standalone server run from this installation.</p>
</td></tr></tbody></table></div><p>So, the configuration folder contains all the configuration files. Yes, you can have more than one, but you will have to choose which one to run with. The <code class="literal">deployments</code> folder contains all your applications to deploy, deployed and undeployed (as we will see later, there is even a marker for failed deployments). The folder <code class="literal">lib</code> contains all the library jars referenced by your applications using the Extension-List mechanism. Lastly, the <code class="literal">log</code> folder contains WildFly's <code class="literal">server.log</code> file.</p><p>As previously mentioned, in the <code class="literal">configuration</code> folder you will find the following files:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>File name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">standalone.xml (default)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Java Enterprise Edition 7 web profile certified configuration with the required technologies.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">standalone-ha.xml</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Java Enterprise Edition 7 web profile certified configuration with high availability.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">standalone-full.xml</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Java Enterprise Edition 7 full profile certified configuration including all the required EE 7 technologies, including messaging—JMS.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">standalone-full-ha.xml</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Java Enterprise Edition 7 full profile certified configuration with high availability.</p>
</td></tr></tbody></table></div><p>Along the lines of Java EE 7 profiles, WildFly defines its own profiles. For the standalone mode, each file corresponds to a WildFly profile, that is, <code class="literal">standalone.xml</code> corresponds to the default profile, <code class="literal">standalone-ha.xml</code> corresponds to the <code class="literal">ha</code> profile, <code class="literal">standalone-full.xml</code> corresponds to the <code class="literal">full</code> profile, and <code class="literal">standalone-full-ha.xml</code> corresponds <a id="id37" class="indexterm"/>to the <code class="literal">full-ha</code> profile. The same <a id="id38" class="indexterm"/>WildFly profiles will be found in the domain mode as well.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec19"/>How to do it…</h2></div></div></div><p>Let's try running <a id="id39" class="indexterm"/>WildFly in the standalone mode with its default settings, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd $WILDFLY_HOME</strong></span>
<span class="strong"><strong>$ ./bin/standalone.sh =========================================================================</strong></span>

<span class="strong"><strong>  JBoss Bootstrap Environment</strong></span>

<span class="strong"><strong>  JBOSS_HOME: /home/wildfly/WFC/wildfly</strong></span>

<span class="strong"><strong>  JAVA: /home/wildfly/WFC/jdk8/bin/java</strong></span>

<span class="strong"><strong>  JAVA_OPTS:  -server -XX:+UseCompressedOops  -server -XX:+UseCompressedOops -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true</strong></span>

<span class="strong"><strong>=========================================================================</strong></span>

<span class="strong"><strong>Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0</strong></span>
<span class="strong"><strong>08:43:50,658 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final</strong></span>
<span class="strong"><strong>08:43:50,799 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final</strong></span>
<span class="strong"><strong>08:43:50,850 INFO  [org.jboss.as] (MSC service thread 1-6) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting</strong></span>
<span class="strong"><strong>08:43:51,543 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 26) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!</strong></span>
<span class="strong"><strong>08:43:51,564 INFO  [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0039: Creating http management service using socket-binding (management-http)</strong></span>
<span class="strong"><strong>08:43:51,592 INFO  [org.xnio] (MSC service thread 1-11) XNIO version 3.3.0.Final</strong></span>
<span class="strong"><strong>08:43:51,601 INFO  [org.xnio.nio] (MSC service thread 1-11) XNIO NIO Implementation Version 3.3.0.Final</strong></span>
<span class="strong"><strong>08:43:51,627 WARN  [org.jboss.as.txn] (ServerService Thread Pool -- 54) WFLYTX0013: Node identifier property is set to the default value. Please make sure it is unique.</strong></span>
<span class="strong"><strong>08:43:51,626 INFO  [org.jboss.as.security] (ServerService Thread Pool -- 53) WFLYSEC0002: Activating Security Subsystem</strong></span>
<span class="strong"><strong>08:43:51,631 INFO  [org.wildfly.extension.io] (ServerService Thread Pool -- 37) WFLYIO001: Worker 'default' has auto-configured to 16 core threads with 128 task threads based on your 8 available processors</strong></span>
<span class="strong"><strong>08:43:51,635 INFO  [org.jboss.as.security] (MSC service thread 1-10) WFLYSEC0001: Current PicketBox version=4.9.0.Beta2</strong></span>
<span class="strong"><strong>08:43:51,649 INFO  [org.jboss.as.jsf] (ServerService Thread Pool -- 44) WFLYJSF0007: Activated the following JSF Implementations: [main]</strong></span>
<span class="strong"><strong>08:43:51,650 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 38) WFLYCLINF0001: Activating Infinispan subsystem.</strong></span>
<span class="strong"><strong>08:43:51,680 INFO  [org.jboss.as.naming] (ServerService Thread Pool -- 46) WFLYNAM0001: Activating Naming Subsystem</strong></span>
<span class="strong"><strong>08:43:51,686 INFO  [org.jboss.remoting] (MSC service thread 1-11) JBoss Remoting version 4.0.8.Final</strong></span>
<span class="strong"><strong>08:43:51,687 INFO  [org.jboss.as.webservices] (ServerService Thread Pool -- 56) WFLYWS0002: Activating WebServices Extension</strong></span>
<span class="strong"><strong>08:43:51,704 INFO  [org.jboss.as.connector.subsystems.datasources] (ServerService Thread Pool -- 33) WFLYJCA0004: Deploying JDBC-compliant driver class org.h2.Driver (version 1.3)</strong></span>
<span class="strong"><strong>08:43:51,707 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-5) WFLYUT0003: Undertow 1.2.0.Beta10 starting</strong></span>
<span class="strong"><strong>08:43:51,707 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0003: Undertow 1.2.0.Beta10 starting</strong></span>
<span class="strong"><strong>08:43:51,714 INFO  [org.jboss.as.connector] (MSC service thread 1-3) WFLYJCA0009: Starting JCA Subsystem (IronJacamar 1.2.3.Final)</strong></span>
<span class="strong"><strong>08:43:51,725 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-5) WFLYJCA0018: Started Driver service with driver-name = h2</strong></span>
<span class="strong"><strong>08:43:51,813 INFO  [org.jboss.as.naming] (MSC service thread 1-5) WFLYNAM0003: Starting Naming Service</strong></span>
<span class="strong"><strong>08:43:51,814 INFO  [org.jboss.as.mail.extension] (MSC service thread 1-7) WFLYMAIL0001: Bound mail session [java:jboss/mail/Default]</strong></span>
<span class="strong"><strong>08:43:51,876 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0014: Creating file handler for path /Users/foogaro/wildfly9/wildfly-9.0.0.Beta2/welcome-content</strong></span>
<span class="strong"><strong>08:43:51,904 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-16) WFLYUT0012: Started server default-server.</strong></span>
<span class="strong"><strong>08:43:51,926 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0018: Host default-host starting</strong></span>
<span class="strong"><strong>08:43:51,990 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-12) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8080</strong></span>
<span class="strong"><strong>08:43:52,122 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-12) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]</strong></span>
<span class="strong"><strong>08:43:52,166 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-5) WFLYDS0013: Started FileSystemDeploymentService for directory /Users/foogaro/wildfly9/wildfly-9.0.0.Beta2/standalone/deployments</strong></span>
<span class="strong"><strong>08:43:52,244 INFO  [org.jboss.ws.common.management] (MSC service thread 1-11) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3</strong></span>
<span class="strong"><strong>08:43:52,403 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management</strong></span>
<span class="strong"><strong>08:43:52,403 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990</strong></span>
<span class="strong"><strong>08:43:52,403 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 1970ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</strong></span>
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec20"/>How it works…</h2></div></div></div><p>The first few lines tell you where WildFly is located and the JVM options. What follows is the Undertow <a id="id40" class="indexterm"/>HTTP Listener, which is the component that processes the HTTP request, listening on <code class="literal">http://127.0.0.1:8080</code>. As a matter of fact, you <a id="id41" class="indexterm"/>can test that WildFly is running correctly by pointing to the previous address, and you should see something like the following image:</p><div class="mediaobject"><img src="graphics/3744_01_10.jpg" alt="How it works…"/><div class="caption"><p>WildFly's welcome content</p></div></div><p>Next are the logs about WildFly's management listeners which I have emphasized. The first listener is the HTTP management listener, which is actually an HTTP API used to invoke commands over HTTP. The second one is the Admin Console, which provides you with a Web Console to simplify most of WildFly's configuration. The HTTP management interface and the <a id="id42" class="indexterm"/>Admin Console are listening respectively on <code class="literal">http://127.0.0.1:9990/management</code> and <code class="literal">http://127.0.0.1:9990</code>.</p><p>To access the Admin <a id="id43" class="indexterm"/>Console, open a browser and point it to <code class="literal">http://127.0.0.1:9990/</code>. What you should see is a page as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_01_11.jpg" alt="How it works…"/><div class="caption"><p>WildFly's management error page</p></div></div><p>WildFly is up and running, but the Admin Console is not visible at the moment because there is no user registered to the "security context" (the proper WildFly term is Realm) that the Admin <a id="id44" class="indexterm"/>Console belongs to. We will talk about security and realms later in this recipe and in the upcoming chapters.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Hereby, whenever <a id="id45" class="indexterm"/>I use the term Admin Console or Web Console, they are to intend the same thing.</p></div></div><p>Furthermore, the preceding screenshot tells you how to create a user to access the Admin Console. We need to create the admin user by using the <code class="literal">add-user.sh</code> script provided by WildFly in its <code class="literal">bin</code> folder.</p><p>Once again, open your command line (you should never close it, unless you are shutting down your PC) and execute the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ cd $WILDFLY</strong></span>
<span class="strong"><strong>$ ./bin/add-user.sh</strong></span>
</pre></div><p>The following screenshot is the result of the preceding code:</p><div class="mediaobject"><img src="graphics/3744_01_12.jpg" alt="How it works…"/></div><p>Examining the script and its interaction:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the preceding screenshot, the script first asks for a user type; in our case we need a management user. So just hit <span class="emphasis"><em>Enter</em></span> or type <code class="literal">a</code> and then hit <span class="emphasis"><em>Enter</em></span>. We do not need to create a user at the application level, used to create security context.</li><li class="listitem" style="list-style-type: disc">We specify the username, for example <code class="literal">wildfly</code>.</li><li class="listitem" style="list-style-type: disc">Then we need to enter the password following the specified policy. So we type <code class="literal">cookbook.2015</code> and hit <span class="emphasis"><em>Enter</em></span>.</li><li class="listitem" style="list-style-type: disc">We confirm the <a id="id46" class="indexterm"/>password provided in the previous step by re-entering it.</li><li class="listitem" style="list-style-type: disc">We confirm that we want to add our user "wildfly" to the <code class="literal">ManagementRealm</code> realm. So we type <code class="literal">yes</code> and hit <span class="emphasis"><em>Enter</em></span>.</li><li class="listitem" style="list-style-type: disc">In the final step, the script asks if the user will be used to connect one of the WildFly process to another one, or used to authenticate to an EJB. In this case, we type <code class="literal">no</code> and hit <span class="emphasis"><em>Enter</em></span>.</li></ul></div><p>Now, let's point to the admin address <code class="literal">http://127.0.0.1:9990</code> again. The page now asks you to enter the <a id="id47" class="indexterm"/>username and the password. Specify <code class="literal">wildfly</code> as username and <code class="literal">cookbook.2015</code> as password, and you should see the WildFly Admin Console as follows:</p><div class="mediaobject"><img src="graphics/3744_01_13.jpg" alt="How it works…"/><div class="caption"><p>WildFly's Web Console</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec21"/>See also</h2></div></div></div><p>We will take a deep <a id="id48" class="indexterm"/>dive into the standalone mode soon. In <a class="link" href="ch02.html" title="Chapter 2. Running WildFly in Standalone Mode">Chapter 2</a>, <span class="emphasis"><em>Running WildFly in Standalone Mode</em></span>, there will be described in detail all the configuration files, which one you should use, and how to manage your instance <a id="id49" class="indexterm"/>with both the Admin Console and the <a id="id50" class="indexterm"/>CLI. We will also deploy both the management tools.</p></div></div>
<div class="section" title="Running WildFly in domain mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Running WildFly in domain mode</h1></div></div></div><p>The Domain <a id="id51" class="indexterm"/>mode is something totally new since JBoss AS 4, 5, and 6. It was first introduced in JBoss AS 7.</p><p>It's about grouping <a id="id52" class="indexterm"/>several WildFly instances into one single group, a server-group using the WildFly nomenclature. In fact, we group the WildFly server into one logical server-group, and all the WildFly instances will share the same configuration. By this we intend that they share the same WildFly profile (<code class="literal">default</code>, <code class="literal">ha</code>, <code class="literal">full</code>, and <code class="literal">full-ha</code>), same deployments, and so on. What will not be shared is specific instance configuration such as IP bind address, ports, and others.</p><p>Suppose you have an application and you want it to deploy on four servers of your infrastructure (or test rather than preproduction or production). You will need to configure a server-group, associate the four server instances to it, and you are done. Dealing just with the server-group, all your settings and changes will be spread to all the related server instances. This was definitely a big miss in JBoss AS, but now we have it.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>Remember that a server-group does <span class="emphasis"><em>not</em></span> form a cluster in any way.</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec22"/>Getting ready</h2></div></div></div><p>When dealing with domain mode, there are two new terms to know and understand: <span class="strong"><strong>domain controller</strong></span> (<span class="strong"><strong>DC</strong></span>) and <span class="strong"><strong>host controller</strong></span> (<span class="strong"><strong>HC</strong></span>).</p><p>The first one, the DC, acts as the parent process, the "gran maestro" of an orchestra. Every single change is provided by the DC towards all the HCs of all server-groups. The DC configuration file is named <code class="literal">domain.xml</code>, whilst the HC configuration file is named <code class="literal">host.xml</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>To avoid confusion, it's better to clarify the terminology that we will use in the book. We might refer to the server running the domain controller as the "master" or the "domain". Alternatively, we might refer to a running WildFly instance that is not the domain, as the "host", or "slave".</p></div></div><p>One more thing to know is that contrary to the standalone mode where you have different files for different profiles, in the domain mode you end up with just one file (there is another one named <code class="literal">host.xml</code>, but we will talk about it soon) having all the profiles configured in for you. Profiles are the same as for the standalone mode. We will learn how to associate a profile to a server-group in the chapter dedicated to the domain mode.</p><p>Let's have a look at the <code class="literal">domain</code> folder:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Folder's name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">configuration</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configuration files for the domain and for the host controller and any servers running off this installation. All configuration information for the servers managed within the domain is located here and is the single place for configuration information.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>An internal working area for the host controller that controls this installation. This is where it internally stores the deployment content. This directory is generated by WildFly when it starts and is not meant to be manipulated by the end users. Note that the domain mode does not support deploying content based on scanning a file system.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">lib/ext</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Location for the installed library jars referenced by applications using the Extension-List mechanism.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">log</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Location where the host controller process writes its logs. The process controller, a small lightweight process that actually spawns the other host controller processes and any application server processes also writes a log here.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">servers</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Writable <a id="id53" class="indexterm"/>area used by each application server instance that runs from this installation. Each application server instance will have its own subdirectory, created when the server is first started. In each server's subdirectory there will be the following subdirectories:</p>
<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">data</code>: Information written by the server that needs to survive a restart of the server</li><li class="listitem" style="list-style-type: disc"><code class="literal">log</code>: The <a id="id54" class="indexterm"/>server's log files</li><li class="listitem" style="list-style-type: disc"><code class="literal">tmp</code>: Location for temporary files written by the server</li></ul></div>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tmp</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Location for temporary files written by the server</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tmp/auth</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Special location used to exchange authentication tokens with local clients so they can confirm that they are local to the running AS process.</p>
</td></tr></tbody></table></div><p>So, the <code class="literal">configuration</code> folder contains all the configuration files. Let's have a look at all of them:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>File name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">domain.xml (default name)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the main configuration file that includes all WildFly profiles plus all other configurations needed to run the AS. When WildFly starts, it will look for a file named <code class="literal">domain.xml</code> if not differently specified.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">host.xml (default name)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the host controller configuration file provided by the WildFly installation. In this you will find the entire specific configurations about server instances. When WildFly starts, it will look for a file named <code class="literal">host.xml</code> if not differently specified.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">host-master.xml</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a host controller configuration example file provided by the WildFly installation. It shows you how to configure WildFly running only the domain controller. </p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">host-slave.xml</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is a host controller configuration example file provided by the WildFly installation used to configure WildFly running as slave and connecting to the domain controller.</p>
</td></tr></tbody></table></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec23"/>How to do it...</h2></div></div></div><p>Let's try running WildFly <a id="id55" class="indexterm"/>in the domain mode with its default settings (two server-groups—first one with two instances named <code class="literal">server-one</code> and <code class="literal">server-two</code>, last one with one instance named <code class="literal">server-three</code> with auto-start disabled). Do as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ CD $WILDFLY_HOME</strong></span>
<span class="strong"><strong>$ ./bin/domain.sh -b 0.0.0.0 -bmanagement 0.0.0.0</strong></span>
<span class="strong"><strong>====================================================================</strong></span>

<span class="strong"><strong>  JBoss Bootstrap Environment</strong></span>

<span class="strong"><strong>  JBOSS_HOME: /home/wildfly/WFC/wildfly</strong></span>

<span class="strong"><strong>  JAVA: /home/wildfly/WFC/jdk8/bin/java</strong></span>

<span class="strong"><strong>  JAVA_OPTS: -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true</strong></span>

<span class="strong"><strong>====================================================================</strong></span>

<span class="strong"><strong>Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0</strong></span>
<span class="strong"><strong>08:50:53,715 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final</strong></span>
<span class="strong"><strong>08:50:53,804 INFO  [org.jboss.as.process.Host Controller.status] (main) WFLYPC0018: Starting process 'Host Controller'</strong></span>
<span class="strong"><strong>[Host Controller] Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:54,154 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:54,841 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:54,869 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:55,326 INFO  [org.xnio] (MSC service thread 1-7) XNIO version 3.3.0.Final</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:55,328 INFO  [org.jboss.as] (Controller Boot Thread) WFLYHC0003: Creating http management service using network interface (management) port (9990) securePort (-1)</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:55,332 INFO  [org.xnio.nio] (MSC service thread 1-7) XNIO NIO Implementation Version 3.3.0.Final</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:55,391 INFO  [org.jboss.remoting] (MSC service thread 1-7) JBoss Remoting version 4.0.8.Final</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:55,415 INFO  [org.jboss.as.remoting] (MSC service thread 1-1) WFLYRMT0001: Listening on 0.0.0.0:9999</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:56,189 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0023: Starting server server-one</strong></span>
<span class="strong"><strong>08:50:56,199 INFO  [org.jboss.as.process.Server:server-one.status] (ProcessController-threads - 3) WFLYPC0018: Starting process 'Server:server-one'</strong></span>
<span class="strong"><strong>[Server:server-one] 08:50:56,527 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final</strong></span>
<span class="strong"><strong>[Server:server-one] 08:50:56,692 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final</strong></span>
<span class="strong"><strong>[Server:server-one] 08:50:56,753 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:57,401 INFO  [org.jboss.as.domain.controller.mgmt] (Remoting "master:MANAGEMENT" task-4) WFLYHC0021: Server [Server:server-one] connected using connection [Channel ID 56504cde (inbound) of Remoting connection 0f0a1d33 to /192.168.59.3:50968]</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:57,420 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0023: Starting server server-two</strong></span>
<span class="strong"><strong>08:50:57,423 INFO  [org.jboss.as.process.Server:server-two.status] (ProcessController-threads - 3) WFLYPC0018: Starting process 'Server:server-two'</strong></span>
<span class="strong"><strong>[Host Controller] 08:50:57,430 INFO  [org.jboss.as.host.controller] (server-registration-threads - 1) WFLYHC0020: Registering server server-one</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>[Server:server-two] 08:50:58,213 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final</strong></span>
<span class="strong"><strong>[Server:server-two] 08:50:58,513 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final</strong></span>
<span class="strong"><strong>[Server:server-two] 08:50:58,621 INFO  [org.jboss.as] (MSC service thread 1-6) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting</strong></span>
</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec24"/>How it works...</h2></div></div></div><p>The domain controller <a id="id56" class="indexterm"/>is responsible for initiating all local host controllers along with the configured instances. Now, opening the WildFly Admin <a id="id57" class="indexterm"/>Console, you can see an overview of the details of both your instances:</p><div class="mediaobject"><img src="graphics/3744_01_14.jpg" alt="How it works..."/><div class="caption"><p>WildFly's runtime domain overview</p></div></div><p>From the domain perspective, you can see two server-groups named <span class="strong"><strong>main-server-group</strong></span> with <code class="literal">full</code> profile and the <span class="strong"><strong>other-server-group</strong></span> with <code class="literal">full-ha</code> profile. The latter is not running because its auto-start property is set to false.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>This time, even if running in the domain mode for the first time, we did <span class="emphasis"><em>not</em></span> have to create a new user, because we already did so while setting up the standalone mode.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec25"/>See also</h2></div></div></div><p>We will take a deep dive into the domain mode soon. In <a class="link" href="ch03.html" title="Chapter 3. Running WildFly in Domain Mode">Chapter 3</a>, <span class="emphasis"><em>Running WildFly in Domain Mode</em></span>, all configuration files will be described in detail apart from learning how to choose the correct profile and how to manage your instance with both the Admin Console and the CLI. We will analyze the domain and host controller processes. We will create various examples of server groups, running locally and in pseudo-different machines. We will also <a id="id58" class="indexterm"/>deploy both the management tools and analyze how this behaves in the domain mode.</p></div></div>
<div class="section" title="Running WildFly as a service"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Running WildFly as a service</h1></div></div></div><p>In this recipe, you will <a id="id59" class="indexterm"/>learn how to install WildFly as a service, actually having WildFly run automatically when the OS starts. If you want to run Wildfly manually on demand, you can skip this recipe, unless for knowledge purpose.</p><p>Most Unix-like systems have different "runlevels" (think about them as steps) for various stages of the system running phase. At the operating system level, a service can be activated only if other services have been successfully activated. Thus if you activate a service that needs network before this one is up and running, it gets faulty or useless. This is essentially what "runlevels" are for.</p><p>The following is a list of runlevels:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc1.d</strong></span>: Single user mode</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc2.d</strong></span>: Single user mode with networking</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc3.d</strong></span>: Multi-user mode—boot up in text mode</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc4.d</strong></span>: Undefined</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc5.d</strong></span>: Multi-user mode—boot up in X Windows</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>rc6.d</strong></span>: Shutdown</li></ul></div><p>Most production Linux systems boot using runlevel 3 (UI is not needed and it will be a waste of resources), but to reach all audiences, we will use level 2, 3 and 5.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec26"/>How to do it…</h2></div></div></div><p>WildFly comes with a predefined script, which can be used to run WildFly as a service. This script is located in the <code class="literal">bin/init.d</code> folder of the WildFly installation folder. So we just need to copy the file inside the <code class="literal">/etc/init.d</code> system folder and set it as a service, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo cp $WILDFLY_HOME/bin/init.d/wildfly-init-redhat.sh /etc/init.d/wildfly</strong></span>
<span class="strong"><strong>$ sudo chkconfig --add wildfly</strong></span>
<span class="strong"><strong>$ sudo chkconfig wildfly on --level 235</strong></span>
</pre></div><p>There is also one more file <a id="id60" class="indexterm"/>that we need to take a look at, and it is the <code class="literal">wildfly.conf</code>, placed into the same <code class="literal">bin/init.d</code> directory of the WildFly installation folder. The following is the file as is:</p><div class="informalexample"><pre class="programlisting"># General configuration for the init.d scripts,
# not necessarily for JBoss AS itself.
# default location: /etc/default/wildfly

## Location of JDK
# JAVA_HOME="/usr/lib/jvm/default-java"

## Location of WildFly
# JBOSS_HOME="/opt/wildfly"

## The username who should own the process.
# JBOSS_USER=wildfly

## The mode WildFly should start, standalone or domain
# JBOSS_MODE=standalone

## Configuration for standalone mode
# JBOSS_CONFIG=standalone.xml

## Configuration for domain mode
# JBOSS_DOMAIN_CONFIG=domain.xml
# JBOSS_HOST_CONFIG=host-master.xml

## The amount of time to wait for startup
# STARTUP_WAIT=60

## The amount of time to wait for shutdown
# SHUTDOWN_WAIT=60

## Location to keep the console log
# JBOSS_CONSOLE_LOG="/var/log/wildfly/console.log"</pre></div><p>The previous configuration file basically sets a series of parameters that tell <code class="literal">init-script</code> which WildFly mode to use, which configuration file, which user WildFly should run with, and so on. Any update should be placed into that file.</p><p>For the moment, we will rely on the defaults, except for the user that we will mention explicitly by uncommenting the line <code class="literal"># JBOSS_USER=wildfly</code>, by removing the hash <code class="literal">#</code> symbol. You may have noticed that you can also specify the mode which WildFly will run with: domain or standalone.</p><p>We now need to create the <a id="id61" class="indexterm"/><code class="literal">wildfly</code> user, and give the ownership of the WildFly <code class="literal">home</code> folder to the <code class="literal">wildfly</code> user. Do as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo groupadd -r wildfly</strong></span>
<span class="strong"><strong>$ sudo useradd -r -g wildfly -s /sbin/nologin -c "WildFly user" wildfly</strong></span>
<span class="strong"><strong>$ sudo passwd -d wildfly</strong></span>
<span class="strong"><strong>$ sudo chown -R :wildfly $WILDFLY_HOME/*</strong></span>
</pre></div><p>Now if you reboot your system, you will have WildFly up and running as a service with the default settings, launched by the <code class="literal">wildfly</code> user.</p></div></div></body></html>