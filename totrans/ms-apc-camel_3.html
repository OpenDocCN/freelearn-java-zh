<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Routing and Processors"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Routing and Processors</h1></div></div></div><p>In the previous chapter, we saw the core concepts of implementing the messaging and routing system provided by Camel.</p><p>In this chapter we will cover routing—one of the most important features of Camel. Without the routing, Camel would be a simple <span class="emphasis"><em>connectivity</em></span> framework. Routing is a key function of Camel, it means we can apply all the transformations  to a message. It can modify the content of the message itself or the destination of the message, all on the fly.</p><p>This chapter introduces:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to use a processor to change an exchange</li><li class="listitem" style="list-style-type: disc">A complete example of a route containing a processor</li></ul></div><div class="section" title="What is a processor?"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>What is a processor?</h1></div></div></div><p>A consumer endpoint receives an<a id="id75" class="indexterm"/> event from the environment and wraps it as an <a id="id76" class="indexterm"/>
<span class="strong"><strong>Exchange</strong></span>.</p><p>The routing engine transports this Exchange from the endpoint to a processor, which is possible from one processor to another<a id="id77" class="indexterm"/> processor, up to a final endpoint via a <span class="strong"><strong>Channel</strong></span>. The route can end at a processor returning the Exchange to the consumer endpoint if the MEP is <code class="literal">InOut</code> (and using the out message), or stop with a producer endpoint, sending the message to the environment.</p><p>This means that a processor acts as an Exchange modifier—it consumes an Exchange, and eventually updates it. We can see the processor as a message translator. Actually, all Camel<a id="id78" class="indexterm"/> <span class="strong"><strong>Exchange Integration Patterns</strong></span> (<span class="strong"><strong>EIPs</strong></span>) are implemented using processors.</p><p>A processor is described by the <code class="literal">org.apache.camel.Processor</code> interface. This interface provides only one method:</p><div class="informalexample"><pre class="programlisting">void process(Exchange exchange) throws Exception(Exchange exchange) throws Exception</pre></div><p>As the processor directly receives an Exchange, it has access to all the data contained in the<a id="id79" class="indexterm"/> Exchange:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The message exchange pattern</li><li class="listitem">The <code class="literal">in</code> message</li><li class="listitem">The <code class="literal">out</code> message</li><li class="listitem">The <code class="literal">exchange</code> exception</li></ol></div></div></div>
<div class="section" title="An example of Camel routes containing processors"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>An example of Camel routes containing processors</h1></div></div></div><p>Here we will illustrate the use of processors in an example. This example will create an <span class="strong"><strong>OSGi</strong></span> bundle, which <a id="id80" class="indexterm"/>will create two Camel contexts with one route in each; they are as<a id="id81" class="indexterm"/> follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">One route using the Camel Java DSL</li><li class="listitem" style="list-style-type: disc">One route using the Camel Blueprint DSL</li></ul></div><p>First, we create the Maven project <code class="literal">pom.xml</code> for our bundle:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.packt.camel&lt;/groupId&gt;
  &lt;artifactId&gt;chapter3&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;bundle&lt;/packaging&gt;

  &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
            &lt;artifactId&gt;camel-core&lt;/artifactId&gt;
            &lt;version&gt;2.12.4&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.osgi&lt;/groupId&gt;
            &lt;artifactId&gt;org.osgi.core&lt;/artifactId&gt;
            &lt;version&gt;4.3.1&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
      &lt;plugins&gt;
          &lt;plugin&gt;
                &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
                &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.3.7&lt;/version&gt;
                &lt;extensions&gt;true&lt;/extensions&gt;
                &lt;configuration&gt;
                      &lt;instructions&gt;
                            &lt;Import-Package&gt;*&lt;/Import-Package&gt;
                            &lt;Bundle-Activator&gt;com.packt.camel.chapter3.Activator&lt;/Bundle-Activator&gt;
                      &lt;/instructions&gt;
                &lt;/configuration&gt;
          &lt;/plugin&gt;
      &lt;/plugins&gt;
  &lt;/build&gt;

&lt;/project&gt;</pre></div><p>In this <code class="literal">pom.xml</code>, we can see:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">That we depend on camel-core (in the version of our choice; here it's 2.12.3)</li><li class="listitem" style="list-style-type: disc">We also depend to osgi-core as we create an OSGi bundle</li><li class="listitem" style="list-style-type: disc">We use the<a id="id82" class="indexterm"/> maven-bundle plugin to create the OSGi bundle (especially the MANIFEST containing the OSGi headers). Here, we provide a bundle Activator (<code class="literal">com.pack.camel.chapter3.Activator</code>), the details of which we will see later in this chapter.</li></ul></div><div class="section" title="Prefixer processor"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec08"/>Prefixer processor</h2></div></div></div><p>We are now<a id="id83" class="indexterm"/> ready to create a Prefixer processor. This processor will get the incoming Exchange, extract the <code class="literal">in</code> message body, and prefix this body with <span class="emphasis"><em>Prefixed.</em></span>
</p><p>The processor is a simple class implementing the Camel processor interface.</p><p>We create <code class="literal">PrefixerProcessor</code> as follows:</p><div class="informalexample"><pre class="programlisting">package com.packt.camel.chapter3;

import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class PrefixerProcessor implements Processor {

  private final static Logger LOGGER = LoggerFactory.getLogger(PrefixerProcessor.class);

  public void process(Exchange exchange) throws Exception {
      String inBody = exchange.getIn().getBody(String.class);
      LOGGER.info("Received in message with body {}", inBody);
      LOGGER.info("Prefixing body ...");
      inBody = "Prefixed " + inBody;
      exchange.getIn().setBody(inBody);
  }

}</pre></div><p>Here, we can<a id="id84" class="indexterm"/> see how the processor acts as a message translator; it transforms the <code class="literal">in</code> message.</p></div><div class="section" title="Creating a route using Java DSL"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec09"/>Creating a route using Java DSL</h2></div></div></div><p>It's now time to create the first <a id="id85" class="indexterm"/>route using the Camel Java DSL, using the <code class="literal">PrefixerProcessor</code>. In order to use the Camel Java DSL, we create a class extending the Camel <code class="literal">RouteBuilder</code> class (<code class="literal">org.apache.camel.RouteBuilder</code>). This class describes<a id="id86" class="indexterm"/> the route in a <code class="literal">configure()</code> method.</p><p>We create a <code class="literal">MyRouteBuilder</code> class which is as follows:</p><div class="informalexample"><pre class="programlisting">package com.packt.camel.chapter3;

import org.apache.camel.Exchange;
import org.apache.camel.Processor;
import org.apache.camel.builder.RouteBuilder;

public class MyRouteBuilder extends RouteBuilder {

  public void configure() {
      from("timer:fire?period=5000")
              .setBody(constant("Hello Chapter3"))
              .process(new PrefixerProcessor())
              .to("log:MyRoute")
              .process(new Processor() {
                  public void process(Exchange exchange) throws Exception {
                      String body = exchange.getIn().getBody(String.class);
                      if (body.startsWith("Prefixed ")) {
                          body = body.substring("Prefixed ".length());
                          exchange.getIn().setBody(body);
                      }
                  }
              })
              .to("log:MyRoute");
  }

}</pre></div><p>This route starts with a timer. The timer creates an empty Exchange every 5 seconds.</p><p>We define the body of the <code class="literal">in</code> message (of this Exchange) using<a id="id87" class="indexterm"/> the <code class="literal">.setBody()</code> method, containing the <code class="literal">Hello Chapter3</code> constant String.</p><p>We call <code class="literal">PrefixerProcessor</code> using the <code class="literal">.process()</code> <a id="id88" class="indexterm"/>method. As expected, the <code class="literal">PrefixerProcessor</code> appends <code class="literal">Prefixed</code> to the body of the <code class="literal">in</code> message, resulting to <code class="literal">Prefixed Hello Chapter3</code>. We can see that <code class="literal">PrefixerProcesser</code> has been correctly called using a log endpoint just after (<code class="literal">.to("log:MyRoute")</code>).</p><p>Instead of creating a dedicated class for a processor, it's also possible to create a processor inline. It's what we do using <code class="literal">.process(new Processor(){…})</code>. We implement an<a id="id89" class="indexterm"/> inline processor that removes<a id="id90" class="indexterm"/> the prefix appended by <code class="literal">PrefixerProcessor</code>.</p><p>Finally, we can see that we are back to the original message in the latest log endpoint (<code class="literal">.to("log:MyRoute")</code>).</p><p>The <code class="literal">MyRouteBuilder</code> class is the route builder. A route has to be embedded in the <code class="literal">CamelContext</code>. It's the purpose of our bundle Activator; the Activator creates the <code class="literal">CamelContext</code>, builds the route, and registers the route in this <code class="literal">CamelContext</code>. For convenience, we also register the <code class="literal">CamelContext</code> as an OSGi service (it allows us to see the <code class="literal">CamelContext</code> and the route using the <code class="literal">camel:* Karaf</code> commands).</p><p>The <code class="literal">Activator</code> is a class implementing the <code class="literal">BundleActivator</code> interface (<code class="literal">org.osgi.framework.BundleActivator</code>):</p><div class="informalexample"><pre class="programlisting">package com.packt.camel.chapter3;

import org.apache.camel.CamelContext;
import org.apache.camel.impl.DefaultCamelContext;
import org.osgi.framework.BundleActivator;
import org.osgi.framework.BundleContext;
import org.osgi.framework.ServiceRegistration;

public class Activator implements BundleActivator {

  private CamelContext camelContext;
  private ServiceRegistration serviceRegistration;

  public void start(BundleContext bundleContext) throws Exception {
      camelContext = new DefaultCamelContext();
      camelContext.addRoutes(new MyRouteBuilder());
      serviceRegistration = bundleContext.registerService(CamelContext.class, camelContext, null);
      camelContext.start();
  }

  public void stop(BundleContext bundleContext) throws Exception {
      if (serviceRegistration != null) {
          serviceRegistration.unregister();
      }
      if (camelContext != null) {
          camelContext.stop();
      }
  }

}</pre></div><p>When the bundle starts, the <code class="literal">start()</code> method of the <code class="literal">Activator</code> is called by the OSGi framework.</p><p>At startup, we<a id="id91" class="indexterm"/> create the <code class="literal">CamelContext</code> using <code class="literal">new DefaultCamelContext()</code>.</p><p>We create<a id="id92" class="indexterm"/> and register our route in this <code class="literal">CamelContext</code> using <code class="literal">camelContext.addRoutes(new MyRouteBuilder())</code>.</p><p>For convenience, we register the <code class="literal">CamelContext</code> as an OSGi service using <code class="literal">bundleContext.registerService(CamelContext.class, camelContext, null)</code>. Thanks to this service registration, our <code class="literal">CamelContext</code> and route will be visible for the Camel:<code class="literal">*</code> commands that we have in the Apache Karaf OSGi container.</p><p>Finally, we start the Camel Context (and the route) using <code class="literal">camelContext.start()</code>.</p><p>On the other hand, when we stop the bundle, the OSGi framework will call the <code class="literal">stop()</code> method of the Activator.</p><p>In the <code class="literal">stop()</code> method, we unregister the Camel Context OSGi service (using <code class="literal">serviceRegistration.unregister()</code>) and we<a id="id93" class="indexterm"/> stop the Camel Context (using <code class="literal">camelContext.stop()</code>).</p></div><div class="section" title="Route using Camel Blueprint DSL"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec10"/>Route using Camel Blueprint DSL</h2></div></div></div><p>In the same bundle, we<a id="id94" class="indexterm"/> can create another Camel Context and design another route, but this time using the Camel <a id="id95" class="indexterm"/>Blueprint DSL (OSGi specific). When using the Camel Blueprint DSL, we don't have to write all the plumbing code as we do for the first Camel Context. The Camel Context is implicitly created by Camel, and we declare the route in the Camel Context using the XML description.</p><p>In the <code class="literal">OSGI-INF/blueprint</code> folder of our bundle, we create <code class="literal">route.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;blueprint &gt;

  &lt;bean id="prefixerProcessor" class="com.packt.camel.chapter3.PrefixerProcessor"/&gt;

  &lt;camelContext &gt;
      &lt;route&gt;
          &lt;from uri="timer:fire?period=5000"/&gt;
          &lt;setBody&gt;
              &lt;constant&gt;Hello Chapter3&lt;/constant&gt;
          &lt;/setBody&gt;
          &lt;process ref="prefixerProcessor"/&gt;
          &lt;to uri="log:blueprintRoute"/&gt;
      &lt;/route&gt;
  &lt;/camelContext&gt;

&lt;/blueprint&gt;</pre></div><p>In this Blueprint descriptor, we first create the <code class="literal">prefixerProcessor</code> bean. The Blueprint container will create the processor.</p><p>The Camel Blueprint DSL provides the <code class="literal">&lt;camelContext/&gt;</code> element. Camel will create the Camel Context for us and register the route that we describe. The <code class="literal">&lt;route/&gt;</code> element allows us to describe the route.</p><p>Basically, the route is very close to the previous one:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It starts with a timer, creating an empty Exchange every 5 seconds.</li><li class="listitem" style="list-style-type: disc">It sets the body to <code class="literal">Hello Chapter3</code>.</li><li class="listitem" style="list-style-type: disc">It calls the <code class="literal">prefixerProcessor</code>. In this case, we use the reference to the registered bean. The <code class="literal">ref="prefixerProcessor"</code> corresponds to the <code class="literal">id="prefixerProcessor"</code> of the <code class="literal">PrefixerProcessor</code> bean.</li><li class="listitem" style="list-style-type: disc">We also call a log endpoint.</li></ul></div><p>It's important to<a id="id96" class="indexterm"/> understand that even if we use the same class, we have two different instances of <code class="literal">PrefixerProcessor</code>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A first instance is created in the bundle <code class="literal">Activator</code> and used in the route described using the Camel Java DSL</li><li class="listitem" style="list-style-type: disc">A second instance is created in the <code class="literal">blueprint</code> container and used in the route described using the Camel Blueprint DSL</li></ul></div><p>Building and<a id="id97" class="indexterm"/> deploying our bundle, we are now ready to build our bundle.</p><p>Using Maven, we just run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean install</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Total time: 4.489s</strong></span>
<span class="strong"><strong>[INFO] Finished at: Thu Sep 11 15:14:42 CEST 2014</strong></span>
<span class="strong"><strong>[INFO] Final Memory: 33M/1188M</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
</pre></div><p>Our bundle is now available in our local Maven repository (by default, in the <code class="literal">.m2/repository</code> folder of the <code class="literal">home</code> directory).</p><p>We are ready to deploy the bundle in the Karaf OSGi container.</p><p>After having started Karaf (using <code class="literal">bin/karaf</code> for instance, providing the Karaf shell console), we first have to install the Camel support. For this, we register the camel features repository and install the <code class="literal">camel-blueprint</code> feature.</p><p>The <code class="literal">camel-blueprint</code> feature provides support for Camel core (so the Camel Java DSL, and all core classes such as <code class="literal">CamelContext</code>, <code class="literal">Processor</code>, and so on), and Camel Blueprint DSL.</p><p>To register the Camel features repository, we use the Karaf <code class="literal">feature:repo-add</code> command specifying the Camel version we want to use:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; feature:repo-add camel 2.12.3</strong></span>
<span class="strong"><strong>Adding feature url mvn:org.apache.camel.karaf/apache-camel/2.12.3/xml/features</strong></span>
</pre></div><p>We install the <code class="literal">camel-blueprint</code> feature using the <code class="literal">feature:install</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; feature:install -v camel-blueprint</strong></span>
<span class="strong"><strong>Installing feature camel-blueprint 2.12.3</strong></span>
<span class="strong"><strong>Installing feature camel-core 2.12.3</strong></span>
<span class="strong"><strong>Installing feature xml-specs-api 2.2.0</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.servicemix.specs.activation-api-1.1 [78]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.servicemix.specs.stax-api-1.0 [79]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.servicemix.specs.jaxb-api-2.2 [80]</strong></span>
<span class="strong"><strong>Found installed bundle: stax2-api [81]</strong></span>
<span class="strong"><strong>Found installed bundle: woodstox-core-asl [82]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.servicemix.bundles.jaxb-impl [83]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.camel.camel-core [84]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.camel.karaf.camel-karaf-commands [85]</strong></span>
<span class="strong"><strong>Found installed bundle: org.apache.camel.camel-blueprint [86]</strong></span>
</pre></div><p>We are now<a id="id98" class="indexterm"/> ready to<a id="id99" class="indexterm"/> install and start our bundle.</p><p>For the installation, we use the <code class="literal">bundle:install</code> command with the Maven location defined in the <code class="literal">pom.xml</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; bundle:install mvn:com.packt.camel/chapter3/1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>Bundle ID: 87</strong></span>
</pre></div><p>We start the bundle using the <code class="literal">bundle:start</code> command using the <code class="literal">Bundle ID</code> given by the previous command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; bundle:start 87</strong></span>
</pre></div><p>The log messages shows that our routes are running (using the <code class="literal">log:display</code> command):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; log:display</strong></span>
<span class="strong"><strong>…</strong></span>
<span class="strong"><strong>2014-09-11 15:25:45,542 | INFO  | 0 - timer://fire | MyRoute                      | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Prefixed Hello Chapter3]</strong></span>
<span class="strong"><strong>2014-09-11 15:25:45,543 | INFO  | 0 - timer://fire | MyRoute                      | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Hello Chapter3]</strong></span>
<span class="strong"><strong>2014-09-11 15:25:46,253 | INFO  | 2 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Received in message with body Hello Chapter3</strong></span>
<span class="strong"><strong>2014-09-11 15:25:46,253 | INFO  | 2 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Prefixing body ...</strong></span>
<span class="strong"><strong>2014-09-11 15:25:46,254 | INFO  | 2 - timer://fire | blueprintRoute               | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Prefixed Hello Chapter3]</strong></span>
<span class="strong"><strong>2014-09-11 15:25:50,542 | INFO  | 0 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Received in message with body Hello Chapter3</strong></span>
<span class="strong"><strong>2014-09-11 15:25:50,542 | INFO  | 0 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Prefixing body ...</strong></span>
<span class="strong"><strong>2014-09-11 15:25:50,543 | INFO  | 0 - timer://fire | MyRoute    | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Prefixed Hello Chapter3]</strong></span>
<span class="strong"><strong>2014-09-11 15:25:50,543 | INFO  | 0 - timer://fire | MyRoute    | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Hello Chapter3]</strong></span>
<span class="strong"><strong>2014-09-11 15:25:51,253 | INFO  | 2 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Received in message with body Hello Chapter3</strong></span>
<span class="strong"><strong>2014-09-11 15:25:51,254 | INFO  | 2 - timer://fire | PrefixerProcessor              | 87 - com.packt.camel.chapter3 - 1.0.0.SNAPSHOT | Prefixing body ...</strong></span>
<span class="strong"><strong>2014-09-11 15:25:51,254 | INFO  | 2 - timer://fire | blueprintRoute    | 84 - org.apache.camel.camel-core - 2.12.3 | Exchange[ExchangePattern: InOnly, BodyType: String, Body: Prefixed Hello Chapter3]</strong></span>
</pre></div><p>The Camel features also provide Karaf commands that we can use to see the running Camel <a id="id100" class="indexterm"/>Contexts and<a id="id101" class="indexterm"/> routes.</p><p>For instance, the <code class="literal">camel:context-list</code> command shows the available Camel Contexts, which are as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:context-list</strong></span>
<span class="strong"><strong> Context      Status       Uptime   </strong></span>
<span class="strong"><strong> -------      ------       ------   </strong></span>
<span class="strong"><strong> 87-camel-4   Started      7 minutes  </strong></span>
<span class="strong"><strong> camel-1      Started      7 minutes </strong></span>
</pre></div><p>Here, we can see the two Camel Contexts that we create in our bundle.</p><p>We can have details on each Camel Context using the <code class="literal">camel:context-info</code> command, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:context-info camel-1</strong></span>
<span class="strong"><strong>Camel Context camel-1</strong></span>
<span class="strong"><strong>      Name: camel-1</strong></span>
<span class="strong"><strong>      ManagementName: camel-1</strong></span>
<span class="strong"><strong>      Version: 2.12.3</strong></span>
<span class="strong"><strong>      Status: Started</strong></span>
<span class="strong"><strong>      Uptime: 12 minutes</strong></span>

<span class="strong"><strong>Statistics</strong></span>
<span class="strong"><strong>      Exchanges Total: 148</strong></span>
<span class="strong"><strong>      Exchanges Completed: 148</strong></span>
<span class="strong"><strong>      Exchanges Failed: 0</strong></span>
<span class="strong"><strong>      Min Processing Time: 0ms</strong></span>
<span class="strong"><strong>      Max Processing Time: 8ms</strong></span>
<span class="strong"><strong>      Mean Processing Time: 2ms</strong></span>
<span class="strong"><strong>      Total Processing Time: 307ms</strong></span>
<span class="strong"><strong>      Last Processing Time: 2ms</strong></span>
<span class="strong"><strong>      Delta Processing Time: 0ms</strong></span>
<span class="strong"><strong>      Load Avg: 0.00, 0.00, 0.00</strong></span>
<span class="strong"><strong>      Reset Statistics Date: 2014-09-11 15:25:04</strong></span>
<span class="strong"><strong>      First Exchange Date: 2014-09-11 15:25:05</strong></span>
<span class="strong"><strong>      Last Exchange Completed Date: 2014-09-11 15:37:20</strong></span>
<span class="strong"><strong>      Number of running routes: 1</strong></span>
<span class="strong"><strong>      Number of not running routes: 0</strong></span>

<span class="strong"><strong>Miscellaneous</strong></span>
<span class="strong"><strong>      Auto Startup: true</strong></span>
<span class="strong"><strong>      Starting Routes: false</strong></span>
<span class="strong"><strong>      Suspended: false</strong></span>
<span class="strong"><strong>      Shutdown timeout: 300 sec.</strong></span>
<span class="strong"><strong>      Allow UseOriginalMessage: true</strong></span>
<span class="strong"><strong>      Message History: true</strong></span>
<span class="strong"><strong>      Tracing: false</strong></span>

<span class="strong"><strong>Properties</strong></span>

<span class="strong"><strong>Advanced</strong></span>
<span class="strong"><strong>      ClassResolver: org.apache.camel.impl.DefaultClassResolver@a44950b</strong></span>
<span class="strong"><strong>      PackageScanClassResolver: org.apache.camel.impl.DefaultPackageScanClassResolver@1c950a71</strong></span>
<span class="strong"><strong>      ApplicationContextClassLoader: org.apache.camel.camel-core [84]</strong></span>

<span class="strong"><strong>Components</strong></span>
<span class="strong"><strong>      timer</strong></span>
<span class="strong"><strong>      log</strong></span>

<span class="strong"><strong>Dataformats</strong></span>

<span class="strong"><strong>Routes</strong></span>
<span class="strong"><strong>      route1</strong></span>
</pre></div><p>We can see that the <code class="literal">camel-1</code> context contains one route named <code class="literal">route1</code>.</p><p>Actually, <code class="literal">camel-1</code> is the Camel Context that we created in the Activator, and <code class="literal">route1</code> is the route using the Camel Java DSL. Here, we are able to see <code class="literal">CamelContext</code>, thanks to the OSGi service<a id="id102" class="indexterm"/> registration<a id="id103" class="indexterm"/> that we perform in the Activator.</p><p>On the other hand, we have another Camel Context named <code class="literal">87-camel-4</code>, which is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:context-info 87-camel-4</strong></span>
<span class="strong"><strong>Camel Context 87-camel-4</strong></span>
<span class="strong"><strong>      Name: 87-camel-4</strong></span>
<span class="strong"><strong>      ManagementName: 87-87-camel-4</strong></span>
<span class="strong"><strong>      Version: 2.12.3</strong></span>
<span class="strong"><strong>      Status: Started</strong></span>
<span class="strong"><strong>      Uptime: 15 minutes</strong></span>

<span class="strong"><strong>Statistics</strong></span>
<span class="strong"><strong>      Exchanges Total: 188</strong></span>
<span class="strong"><strong>      Exchanges Completed: 188</strong></span>
<span class="strong"><strong>      Exchanges Failed: 0</strong></span>
<span class="strong"><strong>      Min Processing Time: 0ms</strong></span>
<span class="strong"><strong>      Max Processing Time: 2ms</strong></span>
<span class="strong"><strong>      Mean Processing Time: 1ms</strong></span>
<span class="strong"><strong>      Total Processing Time: 264ms</strong></span>
<span class="strong"><strong>      Last Processing Time: 1ms</strong></span>
<span class="strong"><strong>      Delta Processing Time: 0ms</strong></span>
<span class="strong"><strong>      Load Avg: 0.00, 0.00, 0.00</strong></span>
<span class="strong"><strong>      Reset Statistics Date: 2014-09-11 15:25:05</strong></span>
<span class="strong"><strong>      First Exchange Date: 2014-09-11 15:25:06</strong></span>
<span class="strong"><strong>      Last Exchange Completed Date: 2014-09-11 15:40:41</strong></span>
<span class="strong"><strong>      Number of running routes: 1</strong></span>
<span class="strong"><strong>      Number of not running routes: 0</strong></span>

<span class="strong"><strong>Miscellaneous</strong></span>
<span class="strong"><strong>      Auto Startup: true</strong></span>
<span class="strong"><strong>      Starting Routes: false</strong></span>
<span class="strong"><strong>      Suspended: false</strong></span>
<span class="strong"><strong>      Shutdown timeout: 300 sec.</strong></span>
<span class="strong"><strong>      Allow UseOriginalMessage: true</strong></span>
<span class="strong"><strong>      Message History: true</strong></span>
<span class="strong"><strong>      Tracing: false</strong></span>

<span class="strong"><strong>Properties</strong></span>

<span class="strong"><strong>Advanced</strong></span>
<span class="strong"><strong>      ClassResolver: org.apache.camel.core.osgi.OsgiClassResolver@60e8b22b</strong></span>
<span class="strong"><strong>      PackageScanClassResolver: org.apache.camel.core.osgi.OsgiPackageScanClassResolver@4d0956c1</strong></span>
<span class="strong"><strong>      ApplicationContextClassLoader: BundleDelegatingClassLoader(com.packt.camel.chapter3 [87])</strong></span>

<span class="strong"><strong>Components</strong></span>
<span class="strong"><strong>      timer</strong></span>
<span class="strong"><strong>      properties</strong></span>
<span class="strong"><strong>      log</strong></span>

<span class="strong"><strong>Dataformats</strong></span>

<span class="strong"><strong>Routes</strong></span>
<span class="strong"><strong>      route2</strong></span>
</pre></div><p>In this Camel<a id="id104" class="indexterm"/> Context (the one created by Camel as declared in the Blueprint descriptor), we can see <code class="literal">route2</code> <a id="id105" class="indexterm"/>corresponding to the route described using the Camel Blueprint DSL.</p><p>We can also obtain details about the routes using the <code class="literal">camel:route-info</code> command (the <code class="literal">camel:route-list</code> command displays the list of all routes for all Camel Contexts):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:route-list</strong></span>
<span class="strong"><strong> Context      Route        Status   </strong></span>
<span class="strong"><strong> -------      -----        ------   </strong></span>
<span class="strong"><strong> 87-camel-4   route2       Started  </strong></span>
<span class="strong"><strong> camel-1      route1       Started </strong></span>
</pre></div><p>We can take a look at the details for <code class="literal">route1</code> in the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:route-info route1</strong></span>
<span class="strong"><strong>Camel Route route1</strong></span>
<span class="strong"><strong>      Camel Context: camel-1</strong></span>

<span class="strong"><strong>Properties</strong></span>
<span class="strong"><strong>              id = route1</strong></span>
<span class="strong"><strong>              parent = 31b3f7f4</strong></span>
<span class="strong"><strong>              group = com.packt.camel.chapter3.MyRouteBuilder</strong></span>

<span class="strong"><strong>Statistics</strong></span>
<span class="strong"><strong>      Inflight Exchanges: 0</strong></span>
<span class="strong"><strong>      Exchanges Total: 382</strong></span>
<span class="strong"><strong>      Exchanges Completed: 382</strong></span>
<span class="strong"><strong>      Exchanges Failed: 0</strong></span>
<span class="strong"><strong>      Min Processing Time: 0 ms</strong></span>
<span class="strong"><strong>      Max Processing Time: 8 ms</strong></span>
<span class="strong"><strong>      Mean Processing Time: 1 ms</strong></span>
<span class="strong"><strong>      Total Processing Time: 674 ms</strong></span>
<span class="strong"><strong>      Last Processing Time: 2 ms</strong></span>
<span class="strong"><strong>      Delta Processing Time: 0 ms</strong></span>
<span class="strong"><strong>      Load Avg: 0.00, 0.00, 0.00</strong></span>
<span class="strong"><strong>      Reset Statistics Date: 2014-09-11 15:25:04</strong></span>
<span class="strong"><strong>      First Exchange Date: 2014-09-11 15:25:05</strong></span>
<span class="strong"><strong>      Last Exchange Completed Date: 2014-09-11 15:56:50</strong></span>

<span class="strong"><strong>Definition</strong></span>
<span class="strong"><strong>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</strong></span>
<span class="strong"><strong>&lt;route group="com.packt.camel.chapter3.MyRouteBuilder" id="route1" &gt;</strong></span>
<span class="strong"><strong>  &lt;from uri="timer:fire?period=5000"/&gt;</strong></span>
<span class="strong"><strong>  &lt;setBody id="setBody1"&gt;</strong></span>
<span class="strong"><strong>      &lt;expressionDefinition&gt;Hello Chapter3&lt;/expressionDefinition&gt;</strong></span>
<span class="strong"><strong>  &lt;/setBody&gt;</strong></span>
<span class="strong"><strong>  &lt;process id="process1"/&gt;</strong></span>
<span class="strong"><strong>  &lt;to uri="log:MyRoute" id="to1"/&gt;</strong></span>
<span class="strong"><strong>  &lt;process id="process2"/&gt;</strong></span>
<span class="strong"><strong>  &lt;to uri="log:MyRoute" id="to2"/&gt;</strong></span>
<span class="strong"><strong>&lt;/route&gt;</strong></span>
</pre></div><p>We can see<a id="id106" class="indexterm"/> that the route <a id="id107" class="indexterm"/>has been executed 382 times without errors. We can also see a dump of the route with the two processors, coming from <code class="literal">MyRouteBuilder</code>.</p><p>We can also see the details of <code class="literal">route2</code> corresponding to the routing described using the Camel Blueprint DSL:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>karaf@root()&gt; camel:route-info route2</strong></span>
<span class="strong"><strong>Camel Route route2</strong></span>
<span class="strong"><strong>      Camel Context: 87-camel-4</strong></span>

<span class="strong"><strong>Properties</strong></span>
<span class="strong"><strong>              id = route2</strong></span>
<span class="strong"><strong>              parent = 465796cf</strong></span>

<span class="strong"><strong>Statistics</strong></span>
<span class="strong"><strong>      Inflight Exchanges: 0</strong></span>
<span class="strong"><strong>      Exchanges Total: 414</strong></span>
<span class="strong"><strong>      Exchanges Completed: 414</strong></span>
<span class="strong"><strong>      Exchanges Failed: 0</strong></span>
<span class="strong"><strong>      Min Processing Time: 0 ms</strong></span>
<span class="strong"><strong>      Max Processing Time: 3 ms</strong></span>
<span class="strong"><strong>      Mean Processing Time: 1 ms</strong></span>
<span class="strong"><strong>      Total Processing Time: 529 ms</strong></span>
<span class="strong"><strong>      Last Processing Time: 1 ms</strong></span>
<span class="strong"><strong>      Delta Processing Time: 0 ms</strong></span>
<span class="strong"><strong>      Load Avg: 0.00, 0.00, 0.00</strong></span>
<span class="strong"><strong>      Reset Statistics Date: 2014-09-11 15:25:05</strong></span>
<span class="strong"><strong>      First Exchange Date: 2014-09-11 15:25:06</strong></span>
<span class="strong"><strong>      Last Exchange Completed Date: 2014-09-11 15:59:31</strong></span>

<span class="strong"><strong>Definition</strong></span>
<span class="strong"><strong>&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</strong></span>
<span class="strong"><strong>&lt;route id="route2" &gt;</strong></span>
<span class="strong"><strong>  &lt;from uri="timer:fire?period=5000"/&gt;</strong></span>
<span class="strong"><strong>  &lt;setBody id="setBody2"&gt;</strong></span>
<span class="strong"><strong>      &lt;constant&gt;Hello Chapter3&lt;/constant&gt;</strong></span>
<span class="strong"><strong>  &lt;/setBody&gt;</strong></span>
<span class="strong"><strong>  &lt;process ref="prefixerProcessor" id="process3"/&gt;</strong></span>
<span class="strong"><strong>  &lt;to uri="log:blueprintRoute" id="to3"/&gt;</strong></span>
<span class="strong"><strong>&lt;/route&gt;</strong></span>
</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Summary</h1></div></div></div><p>Processor is one of the most important components of Camel. It's like a Swiss knife. You can use processor to implement message translation and transformation, and any kind of EIPs. All Camel EIPs are implemented using processor to implement the Camel component using <code class="literal">ProcessorEndpoint</code>. We will see later that processors are also useful for error handling or for unit tests. To make it even easier, you can also use existing beans, acting as processors. Camel can directly use your existing beans thanks to an extended bean support, as we will see in the next chapter.</p></div></body></html>