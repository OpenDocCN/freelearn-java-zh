<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Publishing to Bintray" id="aid-19UOO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Publishing to Bintray</h1></div></div></div><p>In the previous chapter, we learned how to deploy our artifacts to a Maven repository. In this chapter, you will learn how we can deploy our artifacts to Bintray as a Maven repository. We will see what Bintray is and how it helps to publish our project.</p><p>We will see how we can configure the Gradle Bintray plugin to deploy our artifacts.</p><div class="section" title="What is Bintray?"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec38"/>What is Bintray?</h1></div></div></div><p>Bintray advertises itself as a <a id="id231" class="indexterm"/>Distribution as a Service. This means that when we have something we want to distribute, for example our project artifacts, we can use Bintray. Bintray offers a platform to store the software we want to share and makes it accessible for others to download. Around this, there is a lot of tooling to provide insights into how the packages are distributed and used. Bintray also offers a REST API to make it easy to work with the platform. The company running Bintray is JFrog, which is very well known for its repository product, Artifactory.</p><p>A part of Bintray is called JCenter. JCenter hosts Java dependencies within the Bintray platform. We already learned about <a id="id232" class="indexterm"/>JCenter as a repository host for dependencies. However, we can also use JCenter as a distribution repository for our own dependencies. In this chapter, we are going to use JCenter to deploy our artifacts.</p><div class="section" title="Defining a new repository"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec41"/>Defining a new repository</h2></div></div></div><p>Before we can use <a id="id233" class="indexterm"/>Bintray's JCenter, we must create an account with Bintray at  <a class="ulink" href="https://bintray.com">https://bintray.com</a>. One of the easiest ways is to use your existing GitHub account to sign in.</p><p>Next, we will create a new repository in which we will store our artifacts. So, first we log in to Bintray. From our user page, we will select the <span class="strong"><strong>New repository</strong></span> option. In our browser window, we can see some fields we need to fill in, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00133.jpeg" alt="Defining a new repository"/></div><p style="clear:both; height: 1em;"> </p><p>We need to give our repository a name and an optional description. We choose <span class="strong"><strong>Maven</strong></span> as the type of repository. Bintray <a id="id234" class="indexterm"/>can also be used for other types of dependencies, but for our Java code we want to use Maven. After we have filled in all the fields, we click on the <span class="strong"><strong>Create</strong></span> button, and Bintray creates a new and empty repository. In the next screenshot, we will see our newly created repository:</p><div class="mediaobject"><img src="../Images/image00134.jpeg" alt="Defining a new repository"/></div><p style="clear:both; height: 1em;"> </p></div></div></div>
<div class="section" title="Defining the Bintray plugin" id="aid-1AT9A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec39"/>Defining the Bintray plugin</h1></div></div></div><p>In order to deploy our artifacts to <a id="id235" class="indexterm"/>JCenter, we use the Bintray Gradle plugin. This plugin adds extra functionality to our project to publish our artifacts.</p><p>Let's continue with our example build file from the previous project. The build file is for a Java project with some code. We will use the publishing plugin to define our publications or artifacts for the project. We will now add the Gradle plugin to the project by using the <code class="literal">buildscript</code> configuration block. In the next example build file, we will apply the Bintray plugin to our project. The following code shows this:</p><div class="informalexample"><pre class="programlisting">// Define Bintray plugin.
buildscript {
  repositories {
    jcenter()
  }

  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.1
  }
}

// Apply plugin to project.
apply plugin: 'com.jfrog.bintray'

apply plugin: 'maven-publish'
apply plugin: 'java'

version = '1.0.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(MavenPublication) {
      from components.java
    }
  }
}</pre></div><p>Since the release of Gradle 2.1, we use an alternative syntax to include an external plugin in our build script. The new syntax works for plugins that are deployed to the Gradle plugin portal. The feature is <a id="id236" class="indexterm"/>incubating, which means it can change in the future. Also, an important restriction is that the new syntax is not supported in the <code class="literal">subprojects</code> and <code class="literal">allprojects</code> configuration blocks. In the following example build file, the new syntax to add a plugin is used:</p><div class="informalexample"><pre class="programlisting">// Define and apply Bintray plugin.
plugins {
  id 'com.jfrog.bintray' version '1.0'
}</pre></div><p>With the new plugin in our project, we can run the <code class="literal">tasks</code> command to see which tasks have been added by the plugin:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle tasks</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Publishing tasks</strong></span>
<span class="strong"><strong>----------------</strong></span>
<span class="strong"><strong>bintrayUpload - Publishes artifacts to bintray.com.</strong></span>
<span class="strong"><strong>...</strong></span>
</pre></div><p>We notice the <code class="literal">bintrayUpload</code> task that has been added by the plugin to our project.</p></div>
<div class="section" title="Deploying publications to Bintray"><div class="titlepage" id="aid-1BRPS2"><div><div><h1 class="title"><a id="ch06lvl1sec40"/>Deploying publications to Bintray</h1></div></div></div><p>Before we can run the <code class="literal">bintrayUpload</code> task, we must add some configuration to our Gradle build file. The Bintray plugin can be configured with the <code class="literal">bintray</code> configuration block. Inside this configuration block, we see all the properties needed to deploy our project's publications to Bintray.</p><p>First, we need to set the username <a id="id237" class="indexterm"/>and the API key for the Bintray account we are using to deploy with. To get the API key, we must first log in to Bintray in our web browser. From our account page, we click on the <span class="strong"><strong>Edit</strong></span> button. Next, we will select the <span class="strong"><strong>API</strong></span> menu option to get to our API key. The key can then be copied to the clipboard so that we can use it in our build script. The <code class="literal">user</code> and <code class="literal">key</code> properties from the <code class="literal">bintray</code> configuration block contain information that we don't want to share. It is best to keep the values of these properties externalized from our Gradle build file. We can add a <code class="literal">gradle.properties</code> file to our project directory with the values for the properties. The <code class="literal">gradle.properties</code> file can also be added to our Gradle user home directory, which, by default, is <code class="literal">&lt;user_home&gt;/.gradle</code>. Alternatively, we can use the command-line options <code class="literal">-P</code> and <code class="literal">--project-prop</code> to set the values.</p><p>The <code class="literal">user</code> and <code class="literal">key</code> properties are required. Also, we must set the <code class="literal">pkg.repo</code> properties with the repository name we have in Bintray and <code class="literal">pkg.name</code> as the group name of our deployment. Finally, we need to define what we need to publish. Fortunately, the Bintray plugin supports the Gradle publishing plugin, so we can reuse the publication we have configured in the build file.</p><p>In the following example build file, we configure the Bintray plugin in the <code class="literal">bintray</code> configuration block:</p><div class="informalexample"><pre class="programlisting">// Define Bintray plugin.
buildscript {
  repositories {
    jcenter()
  }

  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.0'
  }
}

// Apply plugin to project.
apply plugin: 'com.jfrog.bintray'

apply plugin: 'maven-publish'
apply plugin: 'java'

version = '1.0.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(MavenPublication) {
      from components.java
    }
  }
}

bintray {

  // Use externalized project property bintrayUsername.
  user = bintrayUsername

  // Use externalized project property bintrayApiKey.
  key = bintrayApiKey

  // Define publication that needs to be published
  // to Bintray.
  publications = ['sample']

  pkg {
    // Name of repository in Bintray
    repo = 'book-sample'

    // Name for package.
    name = 'sample'
  }

}</pre></div><p>Before we can upload our artifact, we must first create a <code class="literal">book-sample</code> repository with the <code class="literal">sample</code> package by using the <a id="id238" class="indexterm"/>web browser interface of Bintray. We need to log in using our account and then select the <span class="strong"><strong>New repository</strong></span> link. In the following screenshot, we see the fields that need to be filled in:</p><div class="mediaobject"><img src="../Images/image00135.jpeg" alt="Deploying publications to Bintray"/></div><p style="clear:both; height: 1em;"> </p><p>After we have created a new <a id="id239" class="indexterm"/>repository, we get an overview of the repository, as shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00136.jpeg" alt="Deploying publications to Bintray"/></div><p style="clear:both; height: 1em;"> </p><p>From this screen, we click on the <span class="strong"><strong>New package</strong></span> button. A repository can contain multiple packages. The next screenshot <a id="id240" class="indexterm"/>shows the fields that we need to fill to create a new package. We must set the <span class="strong"><strong>Name</strong></span>, the <span class="strong"><strong>Licenses</strong></span> field, and a <span class="strong"><strong>Version control</strong></span> link.</p><div class="mediaobject"><img src="../Images/image00135.jpeg" alt="Deploying publications to Bintray"/></div><p style="clear:both; height: 1em;"> </p><p>Once we have created the <a id="id241" class="indexterm"/>package in our repository, we can invoke the <code class="literal">bintrayUpload</code> task for our project. Let's see the output when we invoke the task:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle bintrayUpload</strong></span>
<span class="strong"><strong>:generatePomFileForSamplePublication</strong></span>
<span class="strong"><strong>:compileJava</strong></span>
<span class="strong"><strong>:processResources UP-TO-DATE</strong></span>
<span class="strong"><strong>:classes</strong></span>
<span class="strong"><strong>:jar</strong></span>
<span class="strong"><strong>:publishSamplePublicationToMavenLocal</strong></span>
<span class="strong"><strong>:bintrayUpload</strong></span>

<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 9.125 secs</strong></span>
</pre></div><p>We notice that the <code class="literal">bintrayUpload</code> task is dependent on the tasks necessary to first compile and build our artifact before it is uploaded. We do not have to define this task dependency ourselves.</p><p>Everything was built successfully, so we can now open our web browser and go to the repository and package page. In the following screenshot, we see our updated package web page:</p><div class="mediaobject"><img src="../Images/image00137.jpeg" alt="Deploying publications to Bintray"/></div><p style="clear:both; height: 1em;"> </p><p>Bintray first puts the uploaded files into an unpublished state. This way, we have time to decide whether we really want to publish this version or not. We can see the message on our screen. We are sure that we want to publish this version, so we will click on the <span class="strong"><strong>Publish</strong></span> link. Now, the files are published so that others can also see the files. If we click on the release version, we can even see the actual files in our web browser. The following screenshot shows our published <a id="id242" class="indexterm"/>artifact JAR file and the corresponding POM file:</p><div class="mediaobject"><img src="../Images/image00138.jpeg" alt="Deploying publications to Bintray"/></div><p style="clear:both; height: 1em;"> </p></div>
<div class="section" title="Configuring the Bintray plugin" id="aid-1CQAE1"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec41"/>Configuring the Bintray plugin</h1></div></div></div><p>We have configured the <a id="id243" class="indexterm"/>required configuration properties to get our project published to Bintray. However, the plugin allows for more configuration. We can see the configuration properties in the following table:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Name</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>
<code class="literal">user</code>
</p>
</td><td valign="top">
<p>This sets the Bintray username.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">key</code>
</p>
</td><td valign="top">
<p>This sets the API key.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">configurations</code>
</p>
</td><td valign="top">
<p>This defines the configuration list with deployable files.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">publications</code>
</p>
</td><td valign="top">
<p>This defines the list of publications to be deployed.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">filesSpec</code>
</p>
</td><td valign="top">
<p>Use <code class="literal">CopySpec</code> to define the arbitrary files to be published, which are not part of a publication or configuration.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">dryRun</code>
</p>
</td><td valign="top">
<p>This allows you to execute all tasks without deploying them.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">publish</code>
</p>
</td><td valign="top">
<p>Should version be published after upload, instead of publishing it via the web browser.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.repo</code>
</p>
</td><td valign="top">
<p>This is the name of the repository.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.name</code>
</p>
</td><td valign="top">
<p>This is the name of the package.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.userOrg</code>
</p>
</td><td valign="top">
<p>This is the optional organization name when the repository belongs to an organization.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.desc</code>
</p>
</td><td valign="top">
<p>This is the description of the package.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.websiteUrl</code>
</p>
</td><td valign="top">
<p>This is the URL of the website belonging to the project.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.issueTrackerUrl</code>
</p>
</td><td valign="top">
<p>This is the URL of the issue-tracking system used for the project.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.vcsUrl</code>
</p>
</td><td valign="top">
<p>This is the URL of the version control system used.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.licenses</code>
</p>
</td><td valign="top">
<p>This is <a id="id244" class="indexterm"/>the list of licenses valid for this project.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.labels</code>
</p>
</td><td valign="top">
<p>This is the list of labels describing what the project is about.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.publicDownloadNumbers</code>
</p>
</td><td valign="top">
<p>This shows how many times published files are downloaded.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.attributes</code>
</p>
</td><td valign="top">
<p>This is the map of custom attributes for package.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.name</code>
</p>
</td><td valign="top">
<p>This is the custom Bintray version.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.desc</code>
</p>
</td><td valign="top">
<p>This is the <a id="id245" class="indexterm"/>description specific to this version.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.released</code>
</p>
</td><td valign="top">
<p>This is the date of release.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.vcsTag</code>
</p>
</td><td valign="top">
<p>This is the tag for this version in the version control system.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.attributes</code>
</p>
</td><td valign="top">
<p>These are the custom attributes for this version package.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.gpg.sign</code>
</p>
</td><td valign="top">
<p>This is set to <code class="literal">true</code> to use GPG signing.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.gpg.passphrase</code>
</p>
</td><td valign="top">
<p>This is the passphrase for GPG signing.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.mavenCentralSync.sync</code>
</p>
</td><td valign="top">
<p>This is set to <code class="literal">true</code> to sync with Maven Central.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.mavenCentralSync.user</code>
</p>
</td><td valign="top">
<p>This is the user token to sync with Maven Central.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.mavenCentralSync.password</code>
</p>
</td><td valign="top">
<p>This is the password for the user syncing with Maven Central.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">pkg.version.mavenCentralSync.close</code>
</p>
</td><td valign="top">
<p>By <a id="id246" class="indexterm"/>default, the staging repository is closed and artifacts are released to Maven Central. You can optionally turn this behavior off (by putting <code class="literal">0</code> as value) and release the version manually.</p>
</td></tr></tbody></table></div><p>In the following example build file, we will use some of these configuration properties:</p><div class="informalexample"><pre class="programlisting">// Define Bintray plugin.
buildscript {
  repositories {
    jcenter()
  }

  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.0'
  }
}

// Apply plugin to project.
apply plugin: 'com.jfrog.bintray'

apply plugin: 'maven-publish'
apply plugin: 'java'

version = '1.0.2.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(MavenPublication) {
      from components.java
    }
  }
}

bintray {
  user = bintrayUsername
  key = bintrayApiKey
  publications = ['sample']

  publish = true

  pkg {
    repo = 'book-sample'
    name = 'full-sample'

    desc = 'Sample package for Gradle book.'

    websiteUrl = 'https://github.com/mrhaki/gradle-dep-book/'
    issueTrackerUrl = 'https://github.com/mrhaki/gradle-dep-book/issues'
    vcsUrl = 'https://github.com/mrhaki/gradle-dep-book.git'

    licenses = ['Apache-2.0']

    labels = ['book', 'sample', 'Gradle']

    publicDownloadNumbers = true

    version {
      desc = 'Fixed some issues.'
      released = new Date()
    }

  }

}</pre></div><p>It is good to see that if we define the <code class="literal">vcsUrl</code> and <code class="literal">licenses</code> configuration properties, the plugin will automatically create the package in our repository. So, we don't have to use the web browser to create a <a id="id247" class="indexterm"/>new package. Instead, we can use the configuration in our build script to automatically create a package. Also, notice that the package is automatically published, unlike in the first example in which it was in an unpublished state.</p></div>
<div class="section" title="Summary" id="aid-1DOR01"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec42"/>Summary</h1></div></div></div><p>In this chapter, you learned how to use the third-party Bintray plugin. We learned about Bintray and JCenter. We saw how we can create a repository on Bintray and use it to deploy our project as a package to this repository.</p><p>You learned about the different configuration properties that can be set for the deployment to Bintray.</p><p>In the next chapter, we will see how we can upload to an Ivy repository.</p></div></body></html>