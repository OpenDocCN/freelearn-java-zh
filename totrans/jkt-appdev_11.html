<html><head></head><body>
<div id="_idContainer061">
<h1 class="chapter-number" id="_idParaDest-139"><a id="_idTextAnchor146"/><span class="koboSpan" id="kobo.1.1">11</span></h1>
<h1 id="_idParaDest-140"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.2.1">Servlet Development and Deployment</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will discuss how to develop and deploy Java EE Servlets. </span><span class="koboSpan" id="kobo.3.2">Servlets allow us as application developers to implement server-side logic in Java web and </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">enterprise applications.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">The topics covered include </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">What is </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">a servlet?</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Request forwarding and </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">response redirection</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Persisting application data </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">across requests</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Passing initialization parameters to a servlet </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">via annotations</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.15.1">Servlet filters</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.16.1">Servlet listeners</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.17.1">Pluggability</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Configuring web </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">applications programmatically</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.20.1">Asynchronous processing</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">HTTP/2 server </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">push support</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.23.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.24.1">Example source code for this chapter can be found on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">at </span></span><a href="https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch11_src"><span class="No-Break"><span class="koboSpan" id="kobo.26.1">https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch11_src</span></span></a></p>
<h1 id="_idParaDest-141"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.27.1">What is a servlet?</span></h1>
<p><span class="koboSpan" id="kobo.28.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.29.1">servlet</span></strong><span class="koboSpan" id="kobo.30.1"> is a Java class that is used to extend</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.31.1"> the capabilities of servers that host server-side web applications. </span><span class="koboSpan" id="kobo.31.2">Servlets can respond to requests and generate responses. </span><span class="koboSpan" id="kobo.31.3">The base class for all servlets is </span><strong class="source-inline"><span class="koboSpan" id="kobo.32.1">jakarta.servlet.GenericServlet</span></strong><span class="koboSpan" id="kobo.33.1">. </span><span class="koboSpan" id="kobo.33.2">This class defines a generic, </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">protocol-independent servlet.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">By far the most common type of servlet is an HTTP servlet. </span><span class="koboSpan" id="kobo.35.2">This type of servlet is used when handling HTTP requests and generating HTTP responses. </span><span class="koboSpan" id="kobo.35.3">An HTTP servlet is a class that extends the </span><strong class="source-inline"><span class="koboSpan" id="kobo.36.1">jakarta.servlet.</span></strong><span class="koboSpan" id="kobo.37.1">http.HttpServlet class, which is a subclass </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.39.1">jakarta.servlet.GenericServlet</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.41.1">A servlet must implement one or more methods to respond to specific HTTP request types. </span><span class="koboSpan" id="kobo.41.2">These methods are overridden from the parent </span><strong class="source-inline"><span class="koboSpan" id="kobo.42.1">HttpServlet</span></strong><span class="koboSpan" id="kobo.43.1"> class. </span><span class="koboSpan" id="kobo.43.2">As can be seen in </span><em class="italic"><span class="koboSpan" id="kobo.44.1">Table 11.1</span></em><span class="koboSpan" id="kobo.45.1">, these methods</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.46.1"> are named so that knowing which one to use </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">is intuitive.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-6">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.48.1">HTTP Request</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.49.1">HttpServlet Method</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.50.1">GET</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">doGet(HttpServletRequest request, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">HttpServletResponse response)</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.53.1">POST</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">doPost(HttpServletRequest request, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.55.1">HttpServletResponse response)</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.56.1">PUT</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.57.1">doPut(HttpServletRequest request, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">HttpServletResponse response)</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.59.1">DELETE</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">doDelete(HttpServletRequest request, </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">HttpServletResponse response)</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.62.1">Table 11.1 – Servlet methods for different HTTP request types</span></p>
<p><span class="koboSpan" id="kobo.63.1">Each of these methods takes the same two parameters, namely an instance of a class implementing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">jakarta.servlet.http.HttpServletRequest</span></strong><span class="koboSpan" id="kobo.65.1"> interface and an instance of a class implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">jakarta.servlet.http.HttpServletResponse</span></strong><span class="koboSpan" id="kobo.67.1">. </span><span class="koboSpan" id="kobo.67.2">These interfaces will be covered in detail later in </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">this chapter.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.69.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.70.1">Application developers never call the above methods directly. </span><span class="koboSpan" id="kobo.70.2">They are called automatically by the application server whenever it receives the corresponding </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">HTTP request.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">Of the four methods listed above, </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">doGet()</span></strong><span class="koboSpan" id="kobo.74.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">doPost()</span></strong><span class="koboSpan" id="kobo.76.1"> are, by far, the most </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">commonly used.</span></span></p>
<p><span class="koboSpan" id="kobo.78.1">An HTTP GET request is generated whenever a user types the servlet’s URL in the browser, when a user clicks on a link pointing to the servlet’s URL, or when a user submits an HTML form using generating an HTTP GET method where the form’s action points to the servlet’s URL. </span><span class="koboSpan" id="kobo.78.2">In any of these cases, the code inside the servlet’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">doGet()</span></strong><span class="koboSpan" id="kobo.80.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">gets executed.</span></span></p>
<p><span class="koboSpan" id="kobo.82.1">An HTTP POST request is typically generated</span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.83.1"> when a user submits an HTML form generating an HTTP POST method and an action pointing to the servlet’s URL. </span><span class="koboSpan" id="kobo.83.2">In this case, the servlet’s code inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">doPost()</span></strong><span class="koboSpan" id="kobo.85.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">gets executed.</span></span></p>
<p><span class="koboSpan" id="kobo.87.1">Now that we’ve explained how a servlet works, let’s take a look at how to </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">develop servlets.</span></span></p>
<h2 id="_idParaDest-142"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.89.1">Writing our first servlet</span></h2>
<p><span class="koboSpan" id="kobo.90.1">In this section, we will develop</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.91.1"> a simple servlet to illustrate how to use the servlet API. </span><span class="koboSpan" id="kobo.91.2">The code for our servlet is </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.93.1">
package com.ensode.jakartaeebook.simpleapp;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.94.1">@WebServlet(urlPatterns = {"/simpleservlet"})</span></strong><span class="koboSpan" id="kobo.95.1">
public class SimpleServlet extends HttpServlet {
  @Override
  </span><strong class="bold"><span class="koboSpan" id="kobo.96.1">protected void doGet(HttpServletRequest req,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.97.1">   HttpServletResponse res)</span></strong><span class="koboSpan" id="kobo.98.1"> {
    try {
      </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">res.setContentType("text/html");</span></strong><span class="koboSpan" id="kobo.100.1">
      </span><strong class="bold"><span class="koboSpan" id="kobo.101.1">PrintWriter printWriter = res.getWriter();</span></strong><span class="koboSpan" id="kobo.102.1">
      </span><strong class="bold"><span class="koboSpan" id="kobo.103.1">printWriter.println("&lt;h2&gt;");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.104.1">      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.105.1">printWriter</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.106.1">        .println("Hello servlet world!");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.107.1">      printWriter.println("&lt;/h2&gt;");</span></strong><span class="koboSpan" id="kobo.108.1">
    } catch (IOException ioException) {
      ioException.printStackTrace();
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.109.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.111.1"> annotation specifies</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.112.1"> that our class is a servlet. </span><span class="koboSpan" id="kobo.112.2">Its </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">urlPatterns</span></strong><span class="koboSpan" id="kobo.114.1"> attribute specifies the relative URL of </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">our servlet.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.116.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.117.1">Servlets can also be configured via a </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">web.xml</span></strong><span class="koboSpan" id="kobo.119.1"> deployment descriptor. </span><span class="koboSpan" id="kobo.119.2">However, since Java EE 6, annotation-based configuration </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">is preferred.</span></span></p>
<p><span class="koboSpan" id="kobo.121.1">Since this servlet is meant to execute when a user enters its URL in the browser window, we need to override the </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">doGet()</span></strong><span class="koboSpan" id="kobo.123.1"> method from the parent </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">HttpServlet</span></strong><span class="koboSpan" id="kobo.125.1"> class. </span><span class="koboSpan" id="kobo.125.2">As explained, this method takes two parameters, an instance of a class implementing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">jakarta.servlet.http.HttpServletRequest</span></strong><span class="koboSpan" id="kobo.127.1"> interface, and an instance of a class implementing the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">jakarta.servlet.http.HttpServletResponse</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.129.1"> interface.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.130.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.131.1">Even though </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">HttpServletRequest</span></strong><span class="koboSpan" id="kobo.133.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">HttpServletResponse</span></strong><span class="koboSpan" id="kobo.135.1"> are interfaces, application developers don’t typically write classes implementing them. </span><span class="koboSpan" id="kobo.135.2">When control goes to a servlet from an HTTP request, the application server provides objects implementing </span><span class="No-Break"><span class="koboSpan" id="kobo.136.1">these interfaces.</span></span></p>
<p><span class="koboSpan" id="kobo.137.1">The first thing our </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">doGet()</span></strong><span class="koboSpan" id="kobo.139.1"> method does is to set the content type for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">HttpServletResponse</span></strong><span class="koboSpan" id="kobo.141.1"> object to </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">"text/html"</span></strong><span class="koboSpan" id="kobo.143.1">. </span><span class="koboSpan" id="kobo.143.2">If we forget to do this, the default content type used is </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">"text/plain"</span></strong><span class="koboSpan" id="kobo.145.1">, which means that the HTML tags used a couple of lines down will be displayed on the browser, as opposed to them being interpreted as </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">HTML tags.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">Then we obtain an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.148.1">java.io.PrintWriter</span></strong><span class="koboSpan" id="kobo.149.1"> by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">HttpServletResponse.getWriter()</span></strong><span class="koboSpan" id="kobo.151.1"> method. </span><span class="koboSpan" id="kobo.151.2">We can then send text output to the browser by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">PrintWriter.print()</span></strong><span class="koboSpan" id="kobo.153.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">PrintWriter.println()</span></strong><span class="koboSpan" id="kobo.155.1"> methods (the preceding example uses </span><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">println()</span></strong><span class="koboSpan" id="kobo.157.1"> exclusively). </span><span class="koboSpan" id="kobo.157.2">Since we set the content type to </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">"text/html"</span></strong><span class="koboSpan" id="kobo.159.1">, any HTML tags </span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.160.1">are interpreted properly by </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">the browser.</span></span></p>
<h2 id="_idParaDest-143"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.162.1">Testing the web application</span></h2>
<p><span class="koboSpan" id="kobo.163.1">To verify that the servlet</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.164.1"> has been properly</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.165.1"> deployed, we need to point our browser to our application’s URL, for example, </span><strong class="source-inline"><span class="koboSpan" id="kobo.166.1">http://localhost:8080/simpleapp/simpleservlet</span></strong><span class="koboSpan" id="kobo.167.1">. </span><span class="koboSpan" id="kobo.167.2">After doing so, we should see a page like the one shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.168.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.169.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer053">
<span class="koboSpan" id="kobo.171.1"><img alt="Figure 11.1 – Simple servlet responding to an HTTP GET request" src="image/B21231_11_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.172.1">Figure 11.1 – Simple servlet responding to an HTTP GET request</span></p>
<p><span class="koboSpan" id="kobo.173.1">In this example, we simply displayed some static text in the browser. </span><span class="koboSpan" id="kobo.173.2">Servlets are typically used to process user-entered data in an HTML form, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">next section.</span></span></p>
<h2 id="_idParaDest-144"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.175.1">Processing HTML forms</span></h2>
<p><span class="koboSpan" id="kobo.176.1">Servlets are rarely accessed</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.177.1"> by typing their </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.178.1">URL directly in the browser. </span><span class="koboSpan" id="kobo.178.2">The most common use for servlets is to process data entered by users in an HTML form. </span><span class="koboSpan" id="kobo.178.3">In this section, we illustrate </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">this process.</span></span></p>
<p><span class="koboSpan" id="kobo.180.1">The relevant markup for the HTML file containing the form for our application looks </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">like this:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.182.1">&lt;form method="post" action="formhandlerservlet"&gt;</span></strong><span class="koboSpan" id="kobo.183.1">
  &lt;table cellpadding="0" cellspacing="0" border="0"&gt;
    &lt;tr&gt;
      &lt;td&gt;Please enter some text:&lt;/td&gt;
      &lt;td&gt;&lt;input type="text" name="enteredValue" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;/td&gt;
      &lt;td&gt;&lt;input type="submit" value="Submit"&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/form&gt;</span></pre> <p><span class="koboSpan" id="kobo.184.1">The value for the form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">action</span></strong><span class="koboSpan" id="kobo.186.1"> attribute must match</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.187.1"> the value of the servlet’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">urlPatterns</span></strong><span class="koboSpan" id="kobo.189.1"> attribute</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.190.1"> in its </span><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.192.1"> annotation. </span><span class="koboSpan" id="kobo.192.2">Since the value of the form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">method</span></strong><span class="koboSpan" id="kobo.194.1"> attribute is </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">"post"</span></strong><span class="koboSpan" id="kobo.196.1">, our servlet’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">doPost()</span></strong><span class="koboSpan" id="kobo.198.1"> method will be executed when the form </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">is submitted.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">Now let’s take a look at our </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">servlet’s code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.202.1">
package com.ensode.jakartaeebook.formhandling;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.203.1">@WebServlet(urlPatterns = {"/formhandlerservlet"})</span></strong><span class="koboSpan" id="kobo.204.1">
public class FormHandlerServlet extends HttpServlet {
  @Override
  protected void doPost(HttpServletRequest request,
    HttpServletResponse response) {
    String enteredValue;
    </span><strong class="bold"><span class="koboSpan" id="kobo.205.1">enteredValue = request.getParameter("enteredValue");</span></strong><span class="koboSpan" id="kobo.206.1">
    response.setContentType("text/html");
    PrintWriter printWriter;
    try {
      printWriter = response.getWriter();
      printWriter.println("&lt;p&gt;");
      printWriter.print("You entered: ");
      </span><strong class="bold"><span class="koboSpan" id="kobo.207.1">printWriter.print(enteredValue);</span></strong><span class="koboSpan" id="kobo.208.1">
      printWriter.print("&lt;/p&gt;");
    } catch (IOException e) {
      e.printStackTrace();
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.209.1">As can be seen in this example, we obtain a reference</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.210.1"> to the value the user typed</span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.211.1"> by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">request.getParameter()</span></strong><span class="koboSpan" id="kobo.213.1"> method. </span><span class="koboSpan" id="kobo.213.2">This method takes a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">String</span></strong><span class="koboSpan" id="kobo.215.1"> object as its sole parameter. </span><span class="koboSpan" id="kobo.215.2">The value of this string must match the name of the input field in the HTML file. </span><span class="koboSpan" id="kobo.215.3">In this case, the HTML file has a text field </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">"enteredValue"</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">&lt;input type="text" </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">name="enteredValue" /&gt;</span></strong></span></p>
<p><span class="koboSpan" id="kobo.221.1">Therefore, the servlet has this </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">corresponding line:</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">enteredValue = </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">request.getParameter("enteredValue");</span></strong></span></p>
<p><span class="koboSpan" id="kobo.225.1">This is to obtain the text entered by the user and store it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">String</span></strong><span class="koboSpan" id="kobo.227.1"> variable named </span><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">enteredValue</span></strong><span class="koboSpan" id="kobo.229.1"> (the name of the variable does not need to match the input field name, but naming it that way is good practice to make it easy to remember what value the variable </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">is holding).</span></span></p>
<p><span class="koboSpan" id="kobo.231.1">After packaging the preceding</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.232.1"> three files in a WAR file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">formhandling.war</span></strong><span class="koboSpan" id="kobo.234.1">, followed by deploying </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.235.1">the WAR file, we can see the rendered HTML file by entering a URL similar to the following in the browser (the exact URL will depend on the Jakarta EE application server being </span><span class="No-Break"><span class="koboSpan" id="kobo.236.1">used): </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">http://localhost:8080/formhandling</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.239.1">The HTML form will be rendered as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.240.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.241.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer054">
<span class="koboSpan" id="kobo.243.1"><img alt="Figure 11.2 – HTML form" src="image/B21231_11_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.244.1">Figure 11.2 – HTML form</span></p>
<p><span class="koboSpan" id="kobo.245.1">After the user enters </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">some text</span></strong><span class="koboSpan" id="kobo.247.1"> in the text field and submits the form (either by hitting </span><em class="italic"><span class="koboSpan" id="kobo.248.1">Enter</span></em><span class="koboSpan" id="kobo.249.1"> or clicking on the </span><strong class="bold"><span class="koboSpan" id="kobo.250.1">Submit</span></strong><span class="koboSpan" id="kobo.251.1"> button), we should see the output of the servlet, as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.252.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.253.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer055">
<span class="koboSpan" id="kobo.255.1"><img alt="Figure 11.3 – Servlet form handling" src="image/B21231_11_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.256.1">Figure 11.3 – Servlet form handling</span></p>
<p><span class="koboSpan" id="kobo.257.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">HttpServletRequest.getParameter()</span></strong><span class="koboSpan" id="kobo.259.1"> method can be used to obtain the value of any HTML input field that can only return one value (textboxes, text areas, single selects, radio buttons, hidden fields, etc.). </span><span class="koboSpan" id="kobo.259.2">The procedure to obtain any of these fields’ values is identical. </span><span class="koboSpan" id="kobo.259.3">In other words, the servlet doesn’t care if the user typed in the value in a text field, selected it from a set of radio buttons, and so on. </span><span class="koboSpan" id="kobo.259.4">As long as the input field’s name matches the value passed to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">getParameter()</span></strong><span class="koboSpan" id="kobo.261.1"> method, the preceding code </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">will work.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.263.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.264.1">When dealing with radio buttons, all related radio buttons must have the same name. </span><span class="koboSpan" id="kobo.264.2">Calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">HttpServletRequest.getParameter()</span></strong><span class="koboSpan" id="kobo.266.1"> method and passing the name of the radio buttons will return the value of the selected </span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">radio button.</span></span></p>
<p><span class="koboSpan" id="kobo.268.1">Some HTML input fields</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.269.1"> such as checkboxes</span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.270.1"> and multiple select boxes allow the user to select more than one value. </span><span class="koboSpan" id="kobo.270.2">For these fields, instead of using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">HttpServletRequest.getParameter()</span></strong><span class="koboSpan" id="kobo.272.1"> method, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">HttpServletRequest.getParameterValues()</span></strong><span class="koboSpan" id="kobo.274.1"> method is used. </span><span class="koboSpan" id="kobo.274.2">This method also takes </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">String</span></strong><span class="koboSpan" id="kobo.276.1"> containing the input field’s name as its only parameter and returns an array of strings containing all the values that were selected by </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">the user.</span></span></p>
<p><span class="koboSpan" id="kobo.278.1">The following example illustrates this case. </span><span class="koboSpan" id="kobo.278.2">The relevant sections of our new HTML markup are </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">shown here:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.280.1">&lt;form method="post" action="multiplevaluefieldhandlerservlet"&gt;</span></strong><span class="koboSpan" id="kobo.281.1">
&lt;p&gt;Please enter one or more options.&lt;/p&gt;
&lt;table cellpadding="0" cellspacing="0" border="0"&gt;
  &lt;tr&gt;
    &lt;td&gt;
      </span><strong class="bold"><span class="koboSpan" id="kobo.282.1">&lt;input name="options" type="checkbox" value="option1" /&gt;</span></strong><span class="koboSpan" id="kobo.283.1">
      Option 1&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.284.1">&lt;input name="options" type="checkbox" value="option2" /&gt;</span></strong><span class="koboSpan" id="kobo.285.1">
    Option 2&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.286.1">&lt;input name="options" type="checkbox" value="option3" /&gt;</span></strong><span class="koboSpan" id="kobo.287.1">
    Option 3&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;&lt;input type="submit" value="Submit" /&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;/form&gt;</span></pre> <p><span class="koboSpan" id="kobo.288.1">The new </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">HTML</span></strong><span class="koboSpan" id="kobo.290.1"> file contains</span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.291.1"> a simple form having</span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.292.1"> three checkboxes and a submit button. </span><span class="koboSpan" id="kobo.292.2">Notice how every checkbox has the same value for its </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">name</span></strong><span class="koboSpan" id="kobo.294.1"> attribute. </span><span class="koboSpan" id="kobo.294.2">As we mentioned before, any checkboxes that are clicked by the user will be sent to </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">the servlet.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">Let’s now take a look at the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">doPost()</span></strong><span class="koboSpan" id="kobo.298.1"> method of the servlet that will handle the </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">HTML form:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.300.1">
@Override
protected void doPost(HttpServletRequest request,
  HttpServletResponse response) {
  </span><strong class="bold"><span class="koboSpan" id="kobo.301.1">String[] selectedOptions =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.302.1">    request.getParameterValues("options");</span></strong><span class="koboSpan" id="kobo.303.1">
  response.setContentType("text/html");
  try {
    PrintWriter printWriter = response.getWriter();
    printWriter.println("&lt;p&gt;");
    printWriter.print("The following options were selected:");
    printWriter.println("&lt;br/&gt;");
    </span><strong class="bold"><span class="koboSpan" id="kobo.304.1">if (selectedOptions != null) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.305.1">      for (String option : selectedOptions) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.306.1">        printWriter.print(option);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.307.1">        printWriter.println("&lt;br/&gt;");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.308.1">      }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.309.1">    } else {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.310.1">      printWriter.println("None");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.311.1">    </span></strong><strong class="bold"><span class="koboSpan" id="kobo.312.1">}</span></strong><span class="koboSpan" id="kobo.313.1">
    printWriter.println("&lt;/p&gt;");
  } catch (IOException e) {
    e.printStackTrace();
   }
}</span></pre> <p><span class="koboSpan" id="kobo.314.1">The preceding code</span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.315.1"> calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">request.getParameterValues()</span></strong><span class="koboSpan" id="kobo.317.1"> method and assigns</span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.318.1"> its return value to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">selectedOptions</span></strong><span class="koboSpan" id="kobo.320.1"> variable. </span><span class="koboSpan" id="kobo.320.2">Farther down the </span><strong class="source-inline"><span class="koboSpan" id="kobo.321.1">doPost()</span></strong><span class="koboSpan" id="kobo.322.1"> method, the code traverses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.323.1">selectedOptions</span></strong><span class="koboSpan" id="kobo.324.1"> array and prints the selected values in </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.326.1">If no checkboxes are clicked, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">request.getParameterValues()</span></strong><span class="koboSpan" id="kobo.328.1"> method will return </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">null</span></strong><span class="koboSpan" id="kobo.330.1">, therefore it is a good idea to check for </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">null</span></strong><span class="koboSpan" id="kobo.332.1"> before attempting to traverse through this method’s </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">return values.</span></span></p>
<p><span class="koboSpan" id="kobo.334.1">After packaging our new servlet in a WAR file</span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.335.1"> and deploying it, we can see the changes</span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.336.1"> in action by typing its URL in the browser window. </span><span class="koboSpan" id="kobo.336.2">In most application servers, the URL will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">http://localhost:8080/multiplevaluefields/</span></strong><span class="koboSpan" id="kobo.338.1">. </span><span class="koboSpan" id="kobo.338.2">The form will be rendered as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.339.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.340.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer056">
<span class="koboSpan" id="kobo.342.1"><img alt="Figure 11.4 – HTML form with multiple value fields" src="image/B21231_11_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.343.1">Figure 11.4 – HTML form with multiple value fields</span></p>
<p><span class="koboSpan" id="kobo.344.1">After submitting the form, control goes to our servlet, and the browser window should look something like what’s illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.345.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.346.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer057">
<span class="koboSpan" id="kobo.348.1"><img alt="Figure 11.5 – Servlet handling fields with multiple values" src="image/B21231_11_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.349.1">Figure 11.5 – Servlet handling fields with multiple values</span></p>
<p><span class="koboSpan" id="kobo.350.1">Of course, the actual message seen in the browser</span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.351.1"> window will depend on what checkboxes the user </span><span class="No-Break"><span class="koboSpan" id="kobo.352.1">clicked</span></span><span class="No-Break"><a id="_idIndexMarker515"/></span><span class="No-Break"><span class="koboSpan" id="kobo.353.1"> on.</span></span></p>
<p><span class="koboSpan" id="kobo.354.1">Now that we’ve seen how to process HTML form data, we’ll focus our attention on automatically navigating to a different page via HTTP request forwarding and HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">response redirection.</span></span></p>
<h1 id="_idParaDest-145"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.356.1">Request forwarding and response redirection</span></h1>
<p><span class="koboSpan" id="kobo.357.1">In many cases, one servlet processes form data, then transfers control to another servlet or JSP to do some more processing or displays a confirmation message on the screen. </span><span class="koboSpan" id="kobo.357.2">There are two ways of doing this: either the request can be forwarded or the response can be redirected to another servlet </span><span class="No-Break"><span class="koboSpan" id="kobo.358.1">or page.</span></span></p>
<h2 id="_idParaDest-146"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.359.1">Request forwarding</span></h2>
<p><span class="koboSpan" id="kobo.360.1">Notice how the text displayed in the previous</span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.361.1"> section’s example matches the value of the value attribute of the checkboxes that were clicked, and not the labels displayed on the previous page. </span><span class="koboSpan" id="kobo.361.2">This might confuse the users. </span><span class="koboSpan" id="kobo.361.3">Let’s modify the servlet to change these values so that they match the labels, then forward the request to another servlet that will display the confirmation message in </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.363.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">doPost()</span></strong><span class="koboSpan" id="kobo.365.1"> method for the new version of </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">MultipleValueFieldHandlerServlet</span></strong><span class="koboSpan" id="kobo.367.1"> is </span><span class="No-Break"><span class="koboSpan" id="kobo.368.1">shown next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.369.1">
protected void doPost(HttpServletRequest request, HttpServletResponse response) {
  String[] selectedOptions =
    request.getParameterValues("options");
  ArrayList&lt;String&gt; selectedOptionLabels = null;
  if (selectedOptions != null) {
    selectedOptionLabels =
      new ArrayList&lt;String&gt;(selectedOptions.length);
    for (String selectedOption : selectedOptions) {
      if (selectedOption.equals("option1")) {
        selectedOptionLabels.add("Option 1");
      } else if (selectedOption.equals("option2")) {
        selectedOptionLabels.add("Option 2");
      } else if (selectedOption.equals("option3")) {
        selectedOptionLabels.add("Option 3");
      }
    }
  }
  </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">request.setAttribute("checkedLabels", selectedOptionLabels);</span></strong><span class="koboSpan" id="kobo.371.1">
  try {
    </span><strong class="bold"><span class="koboSpan" id="kobo.372.1">request.getRequestDispatcher("confirmationservlet").</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.373.1">      forward(request,response);</span></strong><span class="koboSpan" id="kobo.374.1">
  } catch (ServletException | IOException e) {
    e.printStackTrace();
  }
}</span></pre> <p><span class="koboSpan" id="kobo.375.1">This version of the servlet iterates through the selected </span><a id="_idIndexMarker517"/><span class="koboSpan" id="kobo.376.1">options and adds the corresponding label to an </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">ArrayList</span></strong><span class="koboSpan" id="kobo.378.1"> of strings. </span><span class="koboSpan" id="kobo.378.2">This string is then attached to the request object by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">request.setAttribute()</span></strong><span class="koboSpan" id="kobo.380.1"> method. </span><span class="koboSpan" id="kobo.380.2">This method is used to attach any object to the request so that any other code we forward the request to can have access to </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">it later.</span></span></p>
<p><span class="koboSpan" id="kobo.382.1">After attaching </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">ArrayList</span></strong><span class="koboSpan" id="kobo.384.1"> to the request, we then forward the request to the new servlet in the following line </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">of code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.386.1">
request.getRequestDispatcher("confirmationservlet").forward(
    request, response);</span></pre> <p><span class="koboSpan" id="kobo.387.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">String</span></strong><span class="koboSpan" id="kobo.389.1"> argument to this method must match the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">urlPatterns</span></strong><span class="koboSpan" id="kobo.391.1"> tag of the target servlet’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">WebServlet</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.394.1"> annotation.</span></span></p>
<p><span class="koboSpan" id="kobo.395.1">At this point, control goes to our new servlet. </span><span class="koboSpan" id="kobo.395.2">Since we are forwarding</span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.396.1"> an HTTP POST request, its </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">doPost()</span></strong><span class="koboSpan" id="kobo.398.1"> method is automatically called. </span><span class="koboSpan" id="kobo.398.2">The code for this new servlet is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.400.1">
package com.ensode.jakartaeebook.requestforward;
//imports omitted for brevity
@WebServlet(urlPatterns = {"/confirmationservlet"})
public class ConfirmationServlet extends HttpServlet {
  @Override
  protected void doPost(HttpServletRequest request,
    HttpServletResponse response) {
    try {
      PrintWriter printWriter;
    </span><strong class="bold"><span class="koboSpan" id="kobo.401.1">  List&lt;String&gt; checkedLabels = (List&lt;String&gt;) request</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.402.1">        .getAttribute("checkedLabels");</span></strong><span class="koboSpan" id="kobo.403.1">
      response.setContentType("text/html");
      printWriter = response.getWriter();
      printWriter.println("&lt;p&gt;");
      printWriter.print("The following options were selected:");
      printWriter.println("&lt;br/&gt;");
      if (checkedLabels != null) {
        for (String optionLabel : checkedLabels) {
          printWriter.print(optionLabel);
          printWriter.println("&lt;br/&gt;");
        }
      } else {
        printWriter.println("None");
      }
      printWriter.println("&lt;/p&gt;");
    } catch (IOException ioException) {
      ioException.printStackTrace();
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.404.1">This code obtains </span><strong class="source-inline"><span class="koboSpan" id="kobo.405.1">ArrayList</span></strong><span class="koboSpan" id="kobo.406.1"> that was attached</span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.407.1"> to the request by the previous servlet. </span><span class="koboSpan" id="kobo.407.2">This is accomplished by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">request.getAttribute()</span></strong><span class="koboSpan" id="kobo.409.1"> method. </span><span class="koboSpan" id="kobo.409.2">The parameter for this method must match the value used to attach the object to </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">the request.</span></span></p>
<p><span class="koboSpan" id="kobo.411.1">Once the above servlet obtains the list of option labels, it traverses through it and displays them in </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">the browser.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.413.1"><img alt="Figure 11.6 – Request forwarding in action" src="image/B21231_11_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.414.1">Figure 11.6 – Request forwarding in action</span></p>
<p><span class="koboSpan" id="kobo.415.1">Forwarding a request as described only works for other resources (servlets and JSP pages) in the same context as the code doing the forwarding. </span><span class="koboSpan" id="kobo.415.2">In simple terms, the servlet or JSP we want to forward to must be packaged in the same WAR file as the code that is invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">request.getRequestDispatcher().forward()</span></strong><span class="koboSpan" id="kobo.417.1"> method. </span><span class="koboSpan" id="kobo.417.2">If we need to direct the user to a page in another context (or even another server), we can do it by redirecting the </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">response</span></span><span class="No-Break"><a id="_idIndexMarker520"/></span><span class="No-Break"><span class="koboSpan" id="kobo.419.1"> object.</span></span></p>
<h2 id="_idParaDest-147"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.420.1">Response redirection</span></h2>
<p><span class="koboSpan" id="kobo.421.1">One disadvantage of forwarding</span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.422.1"> a request as described in the previous section is that requests can only be forwarded to other servlets or JSPs in the same context. </span><span class="koboSpan" id="kobo.422.2">If we need to direct the user to a page in a different context (deployed in another WAR file on the same server or deployed on a different server), we need to use the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">HttpServletResponse.sendRedirect()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.424.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.425.1">To illustrate response redirection, let’s develop a simple web application that asks the user to select their favorite search engine, and then direct the user to their search engine of choice. </span><span class="koboSpan" id="kobo.425.2">The HTML form for this application would look </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.427.1">
&lt;form method="post" action="responseredirectionservlet"&gt;
  &lt;p&gt;Please indicate your favorite search engine.&lt;/p&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.428.1">&lt;input type="radio" name="searchEngine"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.429.1">            value="http://www.google.com"/&gt;</span></strong><span class="koboSpan" id="kobo.430.1">Google&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.431.1">&lt;input type="radio" name="searchEngine"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.432.1">            value="http://www.bing.com"/&gt;</span></strong><span class="koboSpan" id="kobo.433.1">Bing&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.434.1">&lt;input type="radio" name="searchEngine"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.435.1">            value="http://www.yahoo.com"/&gt;</span></strong><span class="koboSpan" id="kobo.436.1">Yahoo!&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;input type="submit" value="Submit" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/form&gt;</span></pre> <p><span class="koboSpan" id="kobo.437.1">The HTML form in the markup code</span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.438.1"> above contains three radio buttons. </span><span class="koboSpan" id="kobo.438.2">The value for each of them is the URL for the search engine corresponding to the user’s selection. </span><span class="koboSpan" id="kobo.438.3">Notice how the value for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">name</span></strong><span class="koboSpan" id="kobo.440.1"> attribute of each radio button is the same, namely </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">"searchEngine"</span></strong><span class="koboSpan" id="kobo.442.1">. </span><span class="koboSpan" id="kobo.442.2">The servlet will obtain the value of the selected radio button by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">request.getParameter()</span></strong><span class="koboSpan" id="kobo.444.1"> method and passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">"searchEngine"</span></strong><span class="koboSpan" id="kobo.446.1"> string as a parameter, as is demonstrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">code here:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.448.1">
package com.ensode.jakartaeebook.responseredirection;
//imports omitted
@WebServlet(urlPatterns = {"/responseredirectionservlet"})
public class ResponseRedirectionServlet extends HttpServlet {
  @Override
  protected void doPost(HttpServletRequest request,
    HttpServletResponse response)
    throws IOException {
    </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">String url = request.getParameter("searchEngine");</span></strong><span class="koboSpan" id="kobo.450.1">
    if (url != null) {
      </span><strong class="bold"><span class="koboSpan" id="kobo.451.1">response.sendRedirect(url);</span></strong><span class="koboSpan" id="kobo.452.1">
    } else {
      PrintWriter printWriter = response.getWriter();
      printWriter.println("No search engine was selected.");
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.453.1">By calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">request.getParameter("searchEngine")</span></strong><span class="koboSpan" id="kobo.455.1">, the code shown here assigns the URL of the selected</span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.456.1"> search engine to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">url</span></strong><span class="koboSpan" id="kobo.458.1"> variable. </span><span class="koboSpan" id="kobo.458.2">Then, (after checking for </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">null</span></strong><span class="koboSpan" id="kobo.460.1">, in case the user clicked on the </span><strong class="bold"><span class="koboSpan" id="kobo.461.1">Submit</span></strong><span class="koboSpan" id="kobo.462.1"> button without selecting a search engine), directs the user to the selected search engine by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">response.sendRedirect()</span></strong><span class="koboSpan" id="kobo.464.1"> and passing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">url</span></strong><span class="koboSpan" id="kobo.466.1"> variable as </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">a parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.468.1">After packaging the code and deploying it, we can see it in action by typing a URL similar to the following in the </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">browser: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">http://localhost:8080/responseredirection/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer059">
<span class="koboSpan" id="kobo.472.1"><img alt="Figure 11.7 – Response redirection example" src="image/B21231_11_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.473.1">Figure 11.7 – Response redirection example</span></p>
<p><span class="koboSpan" id="kobo.474.1">After clicking the </span><strong class="bold"><span class="koboSpan" id="kobo.475.1">Submit</span></strong><span class="koboSpan" id="kobo.476.1"> button, the user is directed to their favorite </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">search engine.</span></span></p>
<p><span class="koboSpan" id="kobo.478.1">It should be noted that redirecting the response as illustrated here creates a new HTTP request to the page we are redirecting</span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.479.1"> to, therefore any request parameters and attributes </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">are lost.</span></span></p>
<h1 id="_idParaDest-148"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.481.1">Persisting application data across requests</span></h1>
<p><span class="koboSpan" id="kobo.482.1">In the previous section, we saw how</span><a id="_idIndexMarker525"/><span class="koboSpan" id="kobo.483.1"> it is possible to store an object in the request by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">HttpRequest.setAttribute()</span></strong><span class="koboSpan" id="kobo.485.1"> method, and how later this object can be retrieved by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">HttpRequest.getAttribute()</span></strong><span class="koboSpan" id="kobo.487.1"> method. </span><span class="koboSpan" id="kobo.487.2">This approach only works if the request was forwarded to the servlet invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">getAttribute()</span></strong><span class="koboSpan" id="kobo.489.1"> method. </span><span class="koboSpan" id="kobo.489.2">If this is not the case, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">getAttribute()</span></strong><span class="koboSpan" id="kobo.491.1"> method will </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">return null.</span></span></p>
<p><span class="koboSpan" id="kobo.493.1">It is possible to persist an object across requests. </span><span class="koboSpan" id="kobo.493.2">In addition to attaching an object to the request object, an object can also be attached to the session object or to the servlet context. </span><span class="koboSpan" id="kobo.493.3">The difference between these two is that objects attached to the session will not be visible to different users, whereas objects attached to the servlet </span><span class="No-Break"><span class="koboSpan" id="kobo.494.1">context are.</span></span></p>
<p><span class="koboSpan" id="kobo.495.1">Attaching objects to the session and servlet context is very similar to attaching objects to the request. </span><span class="koboSpan" id="kobo.495.2">To attach an object to the session, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.496.1">HttpServletRequest.getSession()</span></strong><span class="koboSpan" id="kobo.497.1"> method must be invoked. </span><span class="koboSpan" id="kobo.497.2">This method returns an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.498.1">jakarta.servlet.http.HttpSession</span></strong><span class="koboSpan" id="kobo.499.1">. </span><span class="koboSpan" id="kobo.499.2">We then call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">HttpSession.setAttribute()</span></strong><span class="koboSpan" id="kobo.501.1"> method to attach the object to the session. </span><span class="koboSpan" id="kobo.501.2">The following code fragment illustrates </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">the process:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.503.1">
protected void doPost(HttpServletRequest request,
  HttpServletResponse response) {
  .
</span><span class="koboSpan" id="kobo.503.2">  .
</span><span class="koboSpan" id="kobo.503.3">  .
</span><span class="koboSpan" id="kobo.503.4">  Foo foo = new Foo(); //theoretical object
  </span><strong class="bold"><span class="koboSpan" id="kobo.504.1">HttpSession session = request.getSession();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.505.1">  session.setAttribute("foo", foo);</span></strong><span class="koboSpan" id="kobo.506.1">
  .
</span><span class="koboSpan" id="kobo.506.2">  .
</span><span class="koboSpan" id="kobo.506.3">  .
</span><span class="koboSpan" id="kobo.506.4">}</span></pre> <p><span class="koboSpan" id="kobo.507.1">We can then retrieve the object from the session by calling the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">HttpSession.getAttribute()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.509.1"> method:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.510.1">
protected void doPost(HttpServletRequest request, HttpServletResponse response)
{
  </span><strong class="bold"><span class="koboSpan" id="kobo.511.1">HttpSession session = request.getSession();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.512.1">  Foo foo = (Foo)session.getAttribute("foo");</span></strong><span class="koboSpan" id="kobo.513.1">
}</span></pre> <p><span class="koboSpan" id="kobo.514.1">Notice how the return value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">session.getAttribute()</span></strong><span class="koboSpan" id="kobo.516.1"> needs to be cast to the appropriate type. </span><span class="koboSpan" id="kobo.516.2">This is necessary</span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.517.1"> since the return value of this method </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">java.lang.Object</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.521.1">The procedure to attach and retrieve objects to and from the servlet context is very similar. </span><span class="koboSpan" id="kobo.521.2">The servlet needs to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">getServletContext()</span></strong><span class="koboSpan" id="kobo.523.1"> method (defined in the class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">GenericServlet</span></strong><span class="koboSpan" id="kobo.525.1">, which is the parent class of </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">HttpServlet</span></strong><span class="koboSpan" id="kobo.527.1">, which in turn is the parent class of our servlets). </span><span class="koboSpan" id="kobo.527.2">This method returns an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">jakarta.servlet.ServletContext</span></strong><span class="koboSpan" id="kobo.529.1">, which defines a </span><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">setAttribute()</span></strong><span class="koboSpan" id="kobo.531.1"> and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">getAttribute()</span></strong><span class="koboSpan" id="kobo.533.1"> method. </span><span class="koboSpan" id="kobo.533.2">These methods work the same way as their </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">HttpServletRequest</span></strong><span class="koboSpan" id="kobo.535.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">HttpSessionResponse</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.537.1"> counterparts.</span></span></p>
<p><span class="koboSpan" id="kobo.538.1">The procedure to attach an object to the servlet context is illustrated in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">code snippet:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.540.1">
protected void doPost(HttpServletRequest request,
  HttpServletResponse response) {
  //The getServletContext() method is defined higher in
  //the inheritance hierarchy.
</span><span class="koboSpan" id="kobo.540.2">  </span><strong class="bold"><span class="koboSpan" id="kobo.541.1">ServletContext servletContext = getServletContext();</span></strong><span class="koboSpan" id="kobo.542.1">
  Foo foo = new Foo();
  </span><strong class="bold"><span class="koboSpan" id="kobo.543.1">servletContext.setAttribute("foo", foo);</span></strong><span class="koboSpan" id="kobo.544.1">
  .
</span><span class="koboSpan" id="kobo.544.2">  .
</span><span class="koboSpan" id="kobo.544.3">  .
</span><span class="koboSpan" id="kobo.544.4">}</span></pre> <p><span class="koboSpan" id="kobo.545.1">The preceding code attaches the </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">foo</span></strong><span class="koboSpan" id="kobo.547.1"> object to the servlet context. </span><span class="koboSpan" id="kobo.547.2">This object will be available to any servlet in our application and will be the same across sessions. </span><span class="koboSpan" id="kobo.547.3">It can be retrieved by calling the </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">ServletContext.getAttribute()</span></strong><span class="koboSpan" id="kobo.549.1"> method, as is </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">illustrated next:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.551.1">
protected void doPost(HttpServletRequest request,
  HttpServletResponse response){
  </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">ServletContext servletContext = getServletContext();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.553.1">  Foo foo = (Foo)servletContext.getAttribute("foo");</span></strong><span class="koboSpan" id="kobo.554.1">
  .
</span><span class="koboSpan" id="kobo.554.2">  .
</span><span class="koboSpan" id="kobo.554.3">  .
</span><span class="koboSpan" id="kobo.554.4">}</span></pre> <p><span class="koboSpan" id="kobo.555.1">This code obtains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.556.1">foo</span></strong><span class="koboSpan" id="kobo.557.1"> object from the request</span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.558.1"> context. </span><span class="koboSpan" id="kobo.558.2">Again, a cast is needed since the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">ServletContext.getAttribute()</span></strong><span class="koboSpan" id="kobo.560.1"> method, like its counterparts, returns an instance </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">java.lang.Object</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.564.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.565.1">Objects attached to the servlet context are said to have a scope of </span><em class="italic"><span class="koboSpan" id="kobo.566.1">application</span></em><span class="koboSpan" id="kobo.567.1">. </span><span class="koboSpan" id="kobo.567.2">Similarly, objects attached to the session are said to have a scope of </span><em class="italic"><span class="koboSpan" id="kobo.568.1">session</span></em><span class="koboSpan" id="kobo.569.1">, and objects attached to the request are said to have a scope </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">of </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.571.1">request</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.572.1">.</span></span></p>
<h1 id="_idParaDest-149"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.573.1">Passing initialization parameters to a servlet via annotations</span></h1>
<p><span class="koboSpan" id="kobo.574.1">Sometimes it is useful to pass</span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.575.1"> some initialization parameters</span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.576.1"> to a servlet. </span><span class="koboSpan" id="kobo.576.2">That way, we can</span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.577.1"> make said servlet behave differently based on the parameters that are sent to it. </span><span class="koboSpan" id="kobo.577.2">For example, we may want to configure a servlet to behave differently in development and </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">production environments.</span></span></p>
<p><span class="koboSpan" id="kobo.579.1">In the old days, servlet initialization parameters were sent via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">&lt;init-param&gt;</span></strong><span class="koboSpan" id="kobo.581.1"> parameter in </span><strong class="source-inline"><span class="koboSpan" id="kobo.582.1">web.xml</span></strong><span class="koboSpan" id="kobo.583.1">. </span><span class="koboSpan" id="kobo.583.2">As of servlet 3.0, initialization parameters can be passed to the servlet as the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.584.1">initParams</span></strong><span class="koboSpan" id="kobo.585.1"> attribute of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.587.1"> annotation. </span><span class="koboSpan" id="kobo.587.2">The following example illustrates how to </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">do this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.589.1">
package com.ensode.jakartaeebook.initparams;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.590.1">@WebServlet(name = "InitParamsServlet", urlPatterns = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.591.1">  "/InitParamsServlet"}, initParams = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.592.1">  @WebInitParam(name = "param1", value = "value1"),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.593.1">  @WebInitParam(name = "param2", value = "value2")})</span></strong><span class="koboSpan" id="kobo.594.1">
public class InitParamsServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest request,
          HttpServletResponse response)
          throws ServletException, IOException {
    </span><strong class="bold"><span class="koboSpan" id="kobo.595.1">ServletConfig servletConfig = getServletConfig();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.596.1">    String param1Val = servletConfig.getInitParameter("param1");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.597.1">    String param2Val = servletConfig.getInitParameter("param2");</span></strong><span class="koboSpan" id="kobo.598.1">
    response.setContentType("text/html");
    PrintWriter printWriter = response.getWriter();
    printWriter.println("&lt;p&gt;");
    printWriter.println("Value of param1 is " + param1Val);
    printWriter.println("&lt;/p&gt;");
    printWriter.println("&lt;p&gt;");
    printWriter.println("Value of param2 is " + param2Val);
    printWriter.println("&lt;/p&gt;");
  }
}</span></pre> <p><span class="koboSpan" id="kobo.599.1">As we can see, the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">initParams</span></strong><span class="koboSpan" id="kobo.601.1"> attribute of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.603.1"> annotation is an array</span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.604.1"> of </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">@WebInitParam</span></strong><span class="koboSpan" id="kobo.606.1"> annotations. </span><span class="koboSpan" id="kobo.606.2">Each </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">@WebInitParam</span></strong><span class="koboSpan" id="kobo.608.1"> annotation has two attributes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">name</span></strong><span class="koboSpan" id="kobo.610.1">, which corresponds</span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.611.1"> to the parameter</span><a id="_idIndexMarker533"/><span class="koboSpan" id="kobo.612.1"> name, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">value</span></strong><span class="koboSpan" id="kobo.614.1">, which corresponds to the </span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">parameter value.</span></span></p>
<p><span class="koboSpan" id="kobo.616.1">We can obtain the values of our parameters by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">getInitParameter()</span></strong><span class="koboSpan" id="kobo.618.1"> method on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">jakarta.servlet.ServletConfig</span></strong><span class="koboSpan" id="kobo.620.1"> class. </span><span class="koboSpan" id="kobo.620.2">This method takes a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.621.1">String</span></strong><span class="koboSpan" id="kobo.622.1"> argument as a parameter, corresponding to the parameter name, and returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">String</span></strong><span class="koboSpan" id="kobo.624.1"> corresponding to the </span><span class="No-Break"><span class="koboSpan" id="kobo.625.1">parameter value.</span></span></p>
<p><span class="koboSpan" id="kobo.626.1">Each servlet has a corresponding instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">ServletConfig</span></strong><span class="koboSpan" id="kobo.628.1"> assigned to it. </span><span class="koboSpan" id="kobo.628.2">As we can see in this example, we can obtain this instance by invoking </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">getServletConfig()</span></strong><span class="koboSpan" id="kobo.630.1">, which is a method inherited from </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">jakarta.servlet.GenericServlet</span></strong><span class="koboSpan" id="kobo.632.1">, the parent class of </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">HttpServlet</span></strong><span class="koboSpan" id="kobo.634.1">, which our </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">servlets extend.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">After packaging and deploying our servlet, then pointing the browser to the servlet URL, we will see the following page rendered in the browser, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.637.1">Figure 11</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.638.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.639.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer060">
<span class="koboSpan" id="kobo.640.1"><img alt="Figure 11.8 – Servlet initialization parameters" src="image/B21231_11_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.641.1">Figure 11.8 – Servlet initialization parameters</span></p>
<p><span class="koboSpan" id="kobo.642.1">As we can see, the rendered values correspond to the values we have set in each </span><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.644.1">WebInitParam</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.645.1"> annotation.</span></span></p>
<p><span class="koboSpan" id="kobo.646.1">Now that we’ve seen how to initialize</span><a id="_idIndexMarker534"/><span class="koboSpan" id="kobo.647.1"> a servlet, we’ll shift our attention</span><a id="_idIndexMarker535"/><span class="koboSpan" id="kobo.648.1"> to intercepting</span><a id="_idIndexMarker536"/><span class="koboSpan" id="kobo.649.1"> HTTP requests via </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">servlet filters.</span></span></p>
<h1 id="_idParaDest-150"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.651.1">Servlet filters</span></h1>
<p><span class="koboSpan" id="kobo.652.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.653.1">servlet filter</span></strong><span class="koboSpan" id="kobo.654.1"> is an object that can dynamically intercept</span><a id="_idIndexMarker537"/><span class="koboSpan" id="kobo.655.1"> a request and manipulate its data before the request is handled by the servlet. </span><span class="koboSpan" id="kobo.655.2">Filters can also manipulate a response after a servlet’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">doGet()</span></strong><span class="koboSpan" id="kobo.657.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">doPost()</span></strong><span class="koboSpan" id="kobo.659.1"> method finishes, but before the output is sent to </span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.661.1">The only way to configure a filter in earlier servlet specifications was to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.662.1">&lt;filter-mapping&gt;</span></strong><span class="koboSpan" id="kobo.663.1"> tag in </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">web.xml</span></strong><span class="koboSpan" id="kobo.665.1">. </span><strong class="bold"><span class="koboSpan" id="kobo.666.1">Servlet 3.0</span></strong><span class="koboSpan" id="kobo.667.1"> introduced the ability to configure</span><a id="_idIndexMarker538"/><span class="koboSpan" id="kobo.668.1"> servlets via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">WebFilter</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.671.1"> annotation.</span></span></p>
<p><span class="koboSpan" id="kobo.672.1">The following example illustrates how to </span><span class="No-Break"><span class="koboSpan" id="kobo.673.1">do this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.674.1">
package com.ensode.jakartaeebook.servletfilter;
//imports omitted
</span><strong class="bold"><span class="koboSpan" id="kobo.675.1">@WebFilter(initParams = {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.676.1">  </span></strong><strong class="bold"><span class="koboSpan" id="kobo.677.1">@WebInitParam(name = "filterparam1", value = "filtervalue1")},</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.678.1">        urlPatterns = {"/InitParamsServlet"})</span></strong><span class="koboSpan" id="kobo.679.1">
public class SimpleFilter implements Filter {
  private static final Logger LOG
    = Logger.getLogger(SimpleFilter.class.getName());
  private FilterConfig filterConfig;
  @Override
  public void init(FilterConfig filterConfig) throws
    ServletException {
    this.filterConfig = filterConfig;
  }
  @Override
  public void doFilter(ServletRequest servletRequest,
    ServletResponse servletResponse, FilterChain filterChain)
    throws IOException, ServletException {
    LOG.log(Level.INFO, "Entering doFilter()");
    LOG.log(Level.INFO, "initialization parameters: ");
    Enumeration&lt;String&gt; initParameterNames = filterConfig.
</span><span class="koboSpan" id="kobo.679.2">      getInitParameterNames();
    String parameterName;
    String parameterValue;
    while (initParameterNames.hasMoreElements()) {
      parameterName = initParameterNames.nextElement();
      parameterValue =
        filterConfig.getInitParameter(parameterName);
      LOG.log(Level.INFO, "{0} = {1}",
        new Object[]{parameterName,
        parameterValue});
    }
    LOG.log(Level.INFO, "Invoking servlet...");
    filterChain.doFilter(servletRequest, servletResponse);
    LOG.log(Level.INFO, "Back from servlet invocation");
  }
  @Override
  public void destroy() {
    filterConfig = null;
  }
}</span></pre> <p><span class="koboSpan" id="kobo.680.1">As we can see in the example, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">@WebFilter</span></strong><span class="koboSpan" id="kobo.682.1"> annotation</span><a id="_idIndexMarker539"/><span class="koboSpan" id="kobo.683.1"> has several attributes we can use to configure the filter. </span><span class="koboSpan" id="kobo.683.2">Of special importance is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.684.1">urlPatterns</span></strong><span class="koboSpan" id="kobo.685.1"> attribute. </span><span class="koboSpan" id="kobo.685.2">This attribute takes an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">String</span></strong><span class="koboSpan" id="kobo.687.1"> objects as its value. </span><span class="koboSpan" id="kobo.687.2">Each element in the array corresponds to a URL that our filter will intercept. </span><span class="koboSpan" id="kobo.687.3">In our example, we are intercepting a single URL pattern, which corresponds to the servlet we wrote in the </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">previous section.</span></span></p>
<p><span class="koboSpan" id="kobo.689.1">Other attributes in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">@WebFilter</span></strong><span class="koboSpan" id="kobo.691.1"> annotation include the optional </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">filterName</span></strong><span class="koboSpan" id="kobo.693.1"> attribute, which we can use to give our filter a name. </span><span class="koboSpan" id="kobo.693.2">If we don’t specify a name for our filter, then the filter name defaults to the filter’s </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">class name.</span></span></p>
<p><span class="koboSpan" id="kobo.695.1">As we can see in our example servlet filter, we can send initialization parameters to a filter. </span><span class="koboSpan" id="kobo.695.2">This is done just like we send initialization parameters to a servlet. </span><span class="koboSpan" id="kobo.695.3">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">@WebFilter</span></strong><span class="koboSpan" id="kobo.697.1"> annotation has an </span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">initParams</span></strong><span class="koboSpan" id="kobo.699.1"> attribute that takes an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">@WebInitParam</span></strong><span class="koboSpan" id="kobo.701.1"> annotations as its value. </span><span class="koboSpan" id="kobo.701.2">We can obtain the values of said parameters by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.702.1">getInitParameter()</span></strong><span class="koboSpan" id="kobo.703.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">jakarta.servlet.FilterConfig</span></strong><span class="koboSpan" id="kobo.705.1">, as illustrated in </span><span class="No-Break"><span class="koboSpan" id="kobo.706.1">the example.</span></span></p>
<p><span class="koboSpan" id="kobo.707.1">Our filter is fairly simple; it simply sends some output to the server log before and after the servlet is invoked. </span><span class="koboSpan" id="kobo.707.2">Inspecting the server log after deploying our application and pointing the browser to the servlet’s URL should reveal our </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">filter’s output:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.709.1">
  Loading application [servletfilter] at [/servletfilter]|#]
  servletfilter was successfully deployed in 69 milliseconds.|#]
  Entering doFilter()|#]
  initialization parameters: |#]
  filterparam1 = filtervalue1|#]
  Invoking servlet…|#]
  Back from servlet invocation|#]</span></pre> <p><span class="koboSpan" id="kobo.710.1">Some common uses of servlet filters</span><a id="_idIndexMarker540"/><span class="koboSpan" id="kobo.711.1"> include profiling web applications, applying security, and compressing data, </span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">among others.</span></span></p>
<h1 id="_idParaDest-151"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.713.1">Servlet listeners</span></h1>
<p><span class="koboSpan" id="kobo.714.1">During the lifetime of a typical web</span><a id="_idIndexMarker541"/><span class="koboSpan" id="kobo.715.1"> application, a number of events take place, such as HTTP requests being created or destroyed, request or session attributes being added, removed, or modified, and so on and </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">so forth.</span></span></p>
<p><span class="koboSpan" id="kobo.717.1">The servlet API provides a number of listener interfaces we can implement in order to react to these events. </span><span class="koboSpan" id="kobo.717.2">All of these interfaces</span><a id="_idIndexMarker542"/><span class="koboSpan" id="kobo.718.1"> are in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">jakarta.servlet</span></strong><span class="koboSpan" id="kobo.720.1"> package. </span><span class="koboSpan" id="kobo.720.2">The following table </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">summarizes them.</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table002-3">
<colgroup>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.722.1">Listener Interface</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.723.1">Description</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">ServletContextListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.725.1">Contains methods for handling context initialization and </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">destruction events.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">ServletContextAttributeListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.728.1">Contains methods for reacting to any attributes added, removed, or replaced in the servlet context (</span><span class="No-Break"><span class="koboSpan" id="kobo.729.1">application scope).</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.730.1">ServletRequestListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.731.1">Contains methods for handling request initialization and </span><span class="No-Break"><span class="koboSpan" id="kobo.732.1">destruction events.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">ServletRequestAttributeListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.734.1">Contains methods for reacting to any attributes added, removed, or replaced in </span><span class="No-Break"><span class="koboSpan" id="kobo.735.1">the request.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">HttpSessionListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.737.1">Contains methods for handling HTTP session initialization and </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">destruction events.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">HttpSessionAttributeListener</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.740.1">Contains methods for reacting to any attributes added, removed, or replaced in the </span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">HTTP session.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.742.1">Table 11.2 – Servlet listener interfaces</span></p>
<p><span class="koboSpan" id="kobo.743.1">All we need to do to handle any of the events handled by the interfaces described in the preceding table is to implement one of the interfaces and annotate it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">@WebListener</span></strong><span class="koboSpan" id="kobo.745.1"> interface or declare it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.746.1">web.xml</span></strong><span class="koboSpan" id="kobo.747.1"> deployment descriptor via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">listener&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.750.1"> tag.</span></span></p>
<p><span class="koboSpan" id="kobo.751.1">The API for all of the preceding interfaces is fairly straightforward and intuitive. </span><span class="koboSpan" id="kobo.751.2">We will show an example for one of the interfaces. </span><span class="koboSpan" id="kobo.751.3">Others will be </span><span class="No-Break"><span class="koboSpan" id="kobo.752.1">very similar.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.753.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.754.1">The JavaDoc for all of the preceding</span><a id="_idIndexMarker543"/><span class="koboSpan" id="kobo.755.1"> interfaces can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.756.1">at </span></span><a href="https://jakarta.ee/specifications/platform/10/apidocs/jakarta/servlet/package-summary"><span class="No-Break"><span class="koboSpan" id="kobo.757.1">https://jakarta.ee/specifications/platform/10/apidocs/jakarta/servlet/package-summary</span></span></a></p>
<p><span class="koboSpan" id="kobo.758.1">The following example illustrates</span><a id="_idIndexMarker544"/><span class="koboSpan" id="kobo.759.1"> how to implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.760.1">ServletRequestListener</span></strong><span class="koboSpan" id="kobo.761.1"> interface, which can be used to perform some action whenever an HTTP request is created </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">or destroyed:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.763.1">
package com.ensode.jakartaeebook.listener;
//imports omitted
</span><strong class="bold"><span class="koboSpan" id="kobo.764.1">@WebListener</span></strong><span class="koboSpan" id="kobo.765.1">
public class HttpRequestListener implements ServletRequestListener {
  @Override
  </span><strong class="bold"><span class="koboSpan" id="kobo.766.1">public void requestInitialized(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.767.1">   ServletRequestEvent servletRequestEvent)</span></strong><span class="koboSpan" id="kobo.768.1"> {
    ServletContext servletContext = servletRequestEvent.
</span><span class="koboSpan" id="kobo.768.2">    getServletContext();
    servletContext.log("New request initialized");
  }
  @Override
  </span><strong class="bold"><span class="koboSpan" id="kobo.769.1">public void requestDestroyed(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.770.1">   ServletRequestEvent servletRequestEvent)</span></strong><span class="koboSpan" id="kobo.771.1"> {
    ServletContext servletContext = servletRequestEvent.
</span><span class="koboSpan" id="kobo.771.2">    getServletContext();
    servletContext.log("Request destroyed");
  }
}</span></pre> <p><span class="koboSpan" id="kobo.772.1">As we can see, all we need to do to activate our listener class is to annotate it with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.773.1">@WebListener</span></strong><span class="koboSpan" id="kobo.774.1"> annotation. </span><span class="koboSpan" id="kobo.774.2">Our listener must also implement one of the listener interfaces we listed. </span><span class="koboSpan" id="kobo.774.3">In our example, we chose to implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">jakarta.servlet.ServletRequestListener</span></strong><span class="koboSpan" id="kobo.776.1">. </span><span class="koboSpan" id="kobo.776.2">This interface has methods that are automatically invoked whenever an HTTP request is initialized </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">or destroyed.</span></span></p>
<p><span class="koboSpan" id="kobo.778.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.779.1">ServletRequestListener</span></strong><span class="koboSpan" id="kobo.780.1"> interface has two methods, </span><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">requestInitialized()</span></strong><span class="koboSpan" id="kobo.782.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.783.1">requestDestroyed()</span></strong><span class="koboSpan" id="kobo.784.1">. </span><span class="koboSpan" id="kobo.784.2">In the preceding simple implementation, we simply sent some output to the log, but of course, we can do anything we need to do in </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">our implementations.</span></span></p>
<p><span class="koboSpan" id="kobo.786.1">Using our listener to listen to requests handled by the simple servlet we developed earlier in the chapter results in the following output in the Jakarta EE </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">runtime log:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.788.1">
Loading application [servletlistener] at [/servletlistener]|#]
  servletlistener was successfully deployed in 142 milliseconds.|#]
  </span><strong class="bold"><span class="koboSpan" id="kobo.789.1">New request initialized|#]</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.790.1">  Request destroyed|#]</span></strong></pre> <p><span class="koboSpan" id="kobo.791.1">Implementing the other listener interfaces</span><a id="_idIndexMarker545"/><span class="koboSpan" id="kobo.792.1"> is just as simple </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">and straightforward.</span></span></p>
<h1 id="_idParaDest-152"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.794.1">Pluggability</span></h1>
<p><span class="koboSpan" id="kobo.795.1">When the original servlet API</span><a id="_idIndexMarker546"/><span class="koboSpan" id="kobo.796.1"> was released back in the late 1990s, writing servlets was the only way of writing server-side web applications in Java. </span><span class="koboSpan" id="kobo.796.2">Since then, several Jakarta EE and third-party frameworks have been built on top of the Servlet API. </span><span class="koboSpan" id="kobo.796.3">Examples of such frameworks include JSP and JSF, Apache Struts, Apache Wicket, Spring Web MVC, and </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">several others.</span></span></p>
<p><span class="koboSpan" id="kobo.798.1">Nowadays, very few (if any) Java web applications are built using the Servlet API directly. </span><span class="koboSpan" id="kobo.798.2">Instead, the vast majority of projects utilize one of the available Java web application frameworks. </span><span class="koboSpan" id="kobo.798.3">All of these frameworks use the servlet API “under the covers,” therefore setting up an application to use one of these frameworks has always involved making some configuration in the application’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">web.xml</span></strong><span class="koboSpan" id="kobo.800.1"> deployment descriptor. </span><span class="koboSpan" id="kobo.800.2">In some cases, some applications use more than one framework. </span><span class="koboSpan" id="kobo.800.3">This tends to make the </span><strong class="source-inline"><span class="koboSpan" id="kobo.801.1">web.xml</span></strong><span class="koboSpan" id="kobo.802.1"> deployment descriptor fairly large and hard </span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">to maintain.</span></span></p>
<p><span class="koboSpan" id="kobo.804.1">Servlet 3.0 introduced the concept</span><a id="_idIndexMarker547"/><span class="koboSpan" id="kobo.805.1"> of pluggability. </span><span class="koboSpan" id="kobo.805.2">Web application framework developers now have not one, but two ways to avoid having application developers have to modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">web.xml</span></strong><span class="koboSpan" id="kobo.807.1"> deployment descriptor in order to use their framework. </span><span class="koboSpan" id="kobo.807.2">Framework developers can choose to use annotations instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">web.xml</span></strong><span class="koboSpan" id="kobo.809.1"> to configure their servlets. </span><span class="koboSpan" id="kobo.809.2">After doing this, all that is needed to use the framework is to include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1">library jar</span></strong><span class="koboSpan" id="kobo.811.1"> file(s) provided by the framework developers in the application’s WAR file. </span><span class="koboSpan" id="kobo.811.2">Alternatively, framework developers may choose to include </span><strong class="source-inline"><span class="koboSpan" id="kobo.812.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.813.1"> as part of the JAR file to be included in web applications that use </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">their framework.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.815.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.816.1"> is almost identical to </span><strong class="source-inline"><span class="koboSpan" id="kobo.817.1">web.xml</span></strong><span class="koboSpan" id="kobo.818.1">. </span><span class="koboSpan" id="kobo.818.2">The main difference is that the root element of </span><strong class="source-inline"><span class="koboSpan" id="kobo.819.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.820.1"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.821.1">&lt;web-fragment&gt;</span></strong><span class="koboSpan" id="kobo.822.1"> as opposed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.823.1">&lt;web-app&gt;</span></strong><span class="koboSpan" id="kobo.824.1">. </span><span class="koboSpan" id="kobo.824.2">The following example illustrates a </span><span class="No-Break"><span class="koboSpan" id="kobo.825.1">sample </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.826.1">web-fragment.xml</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.827.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.828.1">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-fragment 
  
  xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee
  https://jakarta.ee/xml/ns/jakartaee/web-fragment_5_0.xsd"
  version="5.0" metadata-complete="true"&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;WebFragment&lt;/servlet-name&gt;
    &lt;servlet-class&gt;
      com.ensode.jakartaeebook.webfragment.WebFragmentServlet
    &lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;WebFragment&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/WebFragment&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-fragment&gt;</span></pre> <p><span class="koboSpan" id="kobo.829.1">As we can see, </span><strong class="source-inline"><span class="koboSpan" id="kobo.830.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.831.1"> is almost identical to typical </span><strong class="source-inline"><span class="koboSpan" id="kobo.832.1">web.xml</span></strong><span class="koboSpan" id="kobo.833.1">. </span><span class="koboSpan" id="kobo.833.2">In this simple example, we only use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.834.1">&lt;servlet&gt;</span></strong><span class="koboSpan" id="kobo.835.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">&lt;servlet-mapping&gt;</span></strong><span class="koboSpan" id="kobo.837.1"> elements, but all other usual </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">web.xml</span></strong><span class="koboSpan" id="kobo.839.1"> elements such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">&lt;filter&gt;</span></strong><span class="koboSpan" id="kobo.841.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.842.1">&lt;filter-mapping&gt;</span></strong><span class="koboSpan" id="kobo.843.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">&lt;listener&gt;</span></strong><span class="koboSpan" id="kobo.845.1"> are available </span><span class="No-Break"><span class="koboSpan" id="kobo.846.1">as well.</span></span></p>
<p><span class="koboSpan" id="kobo.847.1">As specified in </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.849.1">, our servlet can be invoked via its URL pattern, </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">/WebFragment</span></strong><span class="koboSpan" id="kobo.851.1">, therefore the URL to execute our servlet once deployed as part of a web application would be </span><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">http://localhost:8080/webfragmentapp/WebFragment</span></strong><span class="koboSpan" id="kobo.853.1">. </span><span class="koboSpan" id="kobo.853.2">Of course, the hostname, port, and context root must be adjusted </span><span class="No-Break"><span class="koboSpan" id="kobo.854.1">as appropriate.</span></span></p>
<p><span class="koboSpan" id="kobo.855.1">All we need to do for any Jakarta EE-compliant</span><a id="_idIndexMarker548"/><span class="koboSpan" id="kobo.856.1"> application server to pick up the settings in </span><strong class="source-inline"><span class="koboSpan" id="kobo.857.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.858.1"> is to place the file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.859.1">META-INF</span></strong><span class="koboSpan" id="kobo.860.1"> folder of the library where we pack our servlet, filter, and/or listener, then place our library’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.861.1">jar</span></strong><span class="koboSpan" id="kobo.862.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.863.1">lib</span></strong><span class="koboSpan" id="kobo.864.1"> directory of the WAR file containing </span><span class="No-Break"><span class="koboSpan" id="kobo.865.1">our application.</span></span></p>
<h1 id="_idParaDest-153"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.866.1">Configuring web applications programmatically</span></h1>
<p><span class="koboSpan" id="kobo.867.1">In addition to allowing us to configure</span><a id="_idIndexMarker549"/><span class="koboSpan" id="kobo.868.1"> web applications through annotations and  </span><strong class="source-inline"><span class="koboSpan" id="kobo.869.1">web-fragment.xml</span></strong><span class="koboSpan" id="kobo.870.1">, Servlet 3.0 also allows us to configure our web applications programmatically </span><span class="No-Break"><span class="koboSpan" id="kobo.871.1">at runtime.</span></span></p>
<p><span class="koboSpan" id="kobo.872.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">ServletContext</span></strong><span class="koboSpan" id="kobo.874.1"> class has new methods to configure servlets, filters, and listeners programmatically. </span><span class="koboSpan" id="kobo.874.2">The following example illustrates how to configure a servlet programmatically at runtime, without resorting to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.875.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.876.1"> annotation or </span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">to XML:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.878.1">
package com.ensode.jakartaeebook.servlet;
//imports omitted
@WebListener()
public class ServletContextListenerImpl implements
  ServletContextListener {
  @Override
  public void contextInitialized(
    ServletContextEvent servletContextEvent) {
    ServletContext servletContext = servletContextEvent.
</span><span class="koboSpan" id="kobo.878.2">      getServletContext();
    try {
      </span><strong class="bold"><span class="koboSpan" id="kobo.879.1">ProgrammaticallyConfiguredServlet servlet = servletContext.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.880.1">        createServlet(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.881.1">          ProgrammaticallyConfiguredServlet.class);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.882.1">      servletContext.addServlet(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.883.1">        "ProgrammaticallyConfiguredServlet", servlet);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.884.1">      ServletRegistration servletRegistration = servletContext.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.885.1">        getServletRegistration(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.886.1">          "ProgrammaticallyConfiguredServlet");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.887.1">      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.888.1">servletRegistration.addMapping(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.889.1">        "/ProgrammaticallyConfiguredServlet");</span></strong><span class="koboSpan" id="kobo.890.1">
    } catch (ServletException servletException) {
      servletContext.log(servletException.getMessage());
    }
  }
  //additional methods omitted for brevity
}</span></pre> <p><span class="koboSpan" id="kobo.891.1">In this example, we invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">createServlet()</span></strong><span class="koboSpan" id="kobo.893.1"> method of </span><strong class="source-inline"><span class="koboSpan" id="kobo.894.1">ServletContext</span></strong><span class="koboSpan" id="kobo.895.1"> to create the servlet that we are about to configure. </span><span class="koboSpan" id="kobo.895.2">This method takes an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.896.1">java.lang.Class</span></strong><span class="koboSpan" id="kobo.897.1"> corresponding to our servlet’s class. </span><span class="koboSpan" id="kobo.897.2">This method returns a class implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.898.1">jakarta.servlet.Servlet</span></strong><span class="koboSpan" id="kobo.899.1"> or any of its </span><span class="No-Break"><span class="koboSpan" id="kobo.900.1">child interfaces.</span></span></p>
<p><span class="koboSpan" id="kobo.901.1">Once we create our servlet, we need </span><a id="_idIndexMarker550"/><span class="koboSpan" id="kobo.902.1">to invoke </span><strong class="source-inline"><span class="koboSpan" id="kobo.903.1">addServlet()</span></strong><span class="koboSpan" id="kobo.904.1"> on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.905.1">ServletContext</span></strong><span class="koboSpan" id="kobo.906.1"> instance to register our servlet with the servlet container. </span><span class="koboSpan" id="kobo.906.2">This method takes two parameters, the first being </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">String</span></strong><span class="koboSpan" id="kobo.908.1"> corresponding to the servlet name and the second being the servlet instance returned by the call </span><span class="No-Break"><span class="koboSpan" id="kobo.909.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.910.1">createServlet()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.912.1">Once we have registered our servlet, we need to add a URL mapping to it. </span><span class="koboSpan" id="kobo.912.2">In order to do this, we need to invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.913.1">getServletRegistration()</span></strong><span class="koboSpan" id="kobo.914.1"> method on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">ServletContext</span></strong><span class="koboSpan" id="kobo.916.1"> instance, passing the servlet name as a parameter. </span><span class="koboSpan" id="kobo.916.2">This method returns the servlet container’s implementation of </span><strong class="source-inline"><span class="koboSpan" id="kobo.917.1">jakarta.servlet.ServletRegistration</span></strong><span class="koboSpan" id="kobo.918.1">. </span><span class="koboSpan" id="kobo.918.2">From this object, we need to invoke its </span><strong class="source-inline"><span class="koboSpan" id="kobo.919.1">addMapping()</span></strong><span class="koboSpan" id="kobo.920.1"> method, passing the URL mapping we wish our servlet </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">to handle.</span></span></p>
<p><span class="koboSpan" id="kobo.922.1">Our example servlet is very simple. </span><span class="koboSpan" id="kobo.922.2">It simply displays a text message in the browser. </span><span class="koboSpan" id="kobo.922.3">Its </span><strong class="source-inline"><span class="koboSpan" id="kobo.923.1">doGet()</span></strong><span class="koboSpan" id="kobo.924.1"> method looks </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.926.1">
@Override
protected void doGet(HttpServletRequest request,
  HttpServletResponse response)
  throws ServletException, IOException {
  ServletOutputStream outputStream = response.getOutputStream();
  outputStream.println(
    "This message was generated from a servlet that was "
    + "configured programmatically.");
  }</span></pre> <p><span class="koboSpan" id="kobo.927.1">After packing our code in a WAR file and deploying it to a Jakarta EE runtime, then pointing the browser to the appropriate URL (i.e </span><strong class="source-inline"><span class="koboSpan" id="kobo.928.1">http://localhost:8080/programmaticservletwebapp/ProgrammaticallyConfiguredServlet</span></strong><span class="koboSpan" id="kobo.929.1">), we should see the following message in </span><span class="No-Break"><span class="koboSpan" id="kobo.930.1">the browser:</span></span></p>
<p><strong class="bold"><span class="koboSpan" id="kobo.931.1">This message was generated from a servlet that was </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.932.1">configured programmatically.</span></strong></span></p>
<p><span class="koboSpan" id="kobo.933.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">ServletContext</span></strong><span class="koboSpan" id="kobo.935.1"> interface has methods to create and add servlet filters and listeners. </span><span class="koboSpan" id="kobo.935.2">They work very similarly to the way the </span><strong class="source-inline"><span class="koboSpan" id="kobo.936.1">addServlet()</span></strong><span class="koboSpan" id="kobo.937.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.938.1">createServlet()</span></strong><span class="koboSpan" id="kobo.939.1"> methods work, therefore</span><a id="_idIndexMarker551"/><span class="koboSpan" id="kobo.940.1"> we won’t be discussing them</span><a id="_idIndexMarker552"/><span class="koboSpan" id="kobo.941.1"> in detail. </span><span class="koboSpan" id="kobo.941.2">Refer to the Jakarta EE API documentation at </span><a href="https://jakarta.ee/specifications/platform/10/apidocs/"><span class="koboSpan" id="kobo.942.1">https://jakarta.ee/specifications/platform/10/apidocs/</span></a> <span class="No-Break"><span class="koboSpan" id="kobo.943.1">for details.</span></span></p>
<h1 id="_idParaDest-154"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.944.1">Asynchronous processing</span></h1>
<p><span class="koboSpan" id="kobo.945.1">Traditionally, servlets have created </span><a id="_idIndexMarker553"/><span class="koboSpan" id="kobo.946.1">a single thread per request in Java web applications. </span><span class="koboSpan" id="kobo.946.2">After a request is processed, the thread is made available for other requests to use. </span><span class="koboSpan" id="kobo.946.3">This model works fairly well for traditional web applications, in which HTTP requests are relatively</span><a id="_idIndexMarker554"/><span class="koboSpan" id="kobo.947.1"> few and far between. </span><span class="koboSpan" id="kobo.947.2">However, most modern web applications take advantage of </span><strong class="bold"><span class="koboSpan" id="kobo.948.1">Ajax</span></strong><span class="koboSpan" id="kobo.949.1"> (short for </span><strong class="bold"><span class="koboSpan" id="kobo.950.1">Asynchronous JavaScript and XML</span></strong><span class="koboSpan" id="kobo.951.1">), a technique that makes web applications behave much more responsively than traditional </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">web applications.</span></span></p>
<p><span class="koboSpan" id="kobo.953.1">Ajax has the side effect of generating a lot more HTTP requests than traditional web applications. </span><span class="koboSpan" id="kobo.953.2">If some of these threads block for a long time waiting, for a resource to be ready or doing anything that takes a long time to process, it is possible our application may suffer from </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1">thread starvation.</span></span></p>
<p><span class="koboSpan" id="kobo.955.1">To alleviate the situation described in the previous paragraph, the Servlet 3.0 specification introduced asynchronous processing. </span><span class="koboSpan" id="kobo.955.2">Using this new capability, we are no longer limited to a single thread per request. </span><span class="koboSpan" id="kobo.955.3">We can now spawn a separate thread and return the original thread back to the pool, to be reused by </span><span class="No-Break"><span class="koboSpan" id="kobo.956.1">other clients.</span></span></p>
<p><span class="koboSpan" id="kobo.957.1">The following example illustrates how to implement asynchronous processing using the new capabilities introduced in </span><span class="No-Break"><span class="koboSpan" id="kobo.958.1">Servlet 3.0:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.959.1">
package com.ensode.jakartaeebook.asynchronousservlet;
//imports omitted for brevity
@WebServlet(name = "AsynchronousServlet", urlPatterns = {
  "/AsynchronousServlet"}, </span><strong class="bold"><span class="koboSpan" id="kobo.960.1">asyncSupported = true</span></strong><span class="koboSpan" id="kobo.961.1">)
public class AsynchronousServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest request,
    HttpServletResponse response) throws Exception {
    </span><strong class="bold"><span class="koboSpan" id="kobo.962.1">final AsyncContext ac = request.startAsync();</span></strong><span class="koboSpan" id="kobo.963.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.964.1">ac.start(new Runnable()</span></strong><span class="koboSpan" id="kobo.965.1"> {
      @Override
      public void run() {
        try {
          Thread.sleep(10000);
          ac.getResponse().getWriter().
</span><span class="koboSpan" id="kobo.965.2">            println("You should see this after a brief wait");
          ac.complete();
        } catch (Exception ex) {
          //handle the exception
        }
      }
    });
  }
}</span></pre> <p><span class="koboSpan" id="kobo.966.1">The first thing we need to do to make</span><a id="_idIndexMarker555"/><span class="koboSpan" id="kobo.967.1"> sure our asynchronous processing code works as expected is to set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.968.1">asyncSupported</span></strong><span class="koboSpan" id="kobo.969.1"> attribute of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">@WebServlet</span></strong><span class="koboSpan" id="kobo.971.1"> annotation </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.973.1">true</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.974.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.975.1">To actually spawn an asynchronous process, we need to invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.976.1">startAsync()</span></strong><span class="koboSpan" id="kobo.977.1"> method on the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.978.1">HttpServletRequest</span></strong><span class="koboSpan" id="kobo.979.1"> that we receive as a parameter in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.980.1">doGet()</span></strong><span class="koboSpan" id="kobo.981.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.982.1">doPost()</span></strong><span class="koboSpan" id="kobo.983.1"> method in our servlet. </span><span class="koboSpan" id="kobo.983.2">This method returns an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.984.1">jakarta.servlet.AsyncContext</span></strong><span class="koboSpan" id="kobo.985.1">. </span><span class="koboSpan" id="kobo.985.2">This class has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.986.1">start()</span></strong><span class="koboSpan" id="kobo.987.1"> method that takes an instance of a class implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.988.1">java.lang.Runnable</span></strong><span class="koboSpan" id="kobo.989.1"> as its sole parameter. </span><span class="koboSpan" id="kobo.989.2">In our example, we used an anonymous inner class to implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.990.1">Runnable</span></strong><span class="koboSpan" id="kobo.991.1"> in line. </span><span class="koboSpan" id="kobo.991.2">Of course, a standard Java class implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.992.1">Runnable</span></strong><span class="koboSpan" id="kobo.993.1"> can be used as well, or a </span><span class="No-Break"><span class="koboSpan" id="kobo.994.1">lambda expression.</span></span></p>
<p><span class="koboSpan" id="kobo.995.1">When we invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.996.1">start()</span></strong><span class="koboSpan" id="kobo.997.1"> method of </span><strong class="source-inline"><span class="koboSpan" id="kobo.998.1">AsyncContext</span></strong><span class="koboSpan" id="kobo.999.1">, a new thread is spawned and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">run()</span></strong><span class="koboSpan" id="kobo.1001.1"> method of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">Runnable</span></strong><span class="koboSpan" id="kobo.1003.1"> instance is executed. </span><span class="koboSpan" id="kobo.1003.2">This thread runs in the background, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1004.1">doGet()</span></strong><span class="koboSpan" id="kobo.1005.1"> method returns immediately, and the request thread is immediately available to service other clients. </span><span class="koboSpan" id="kobo.1005.2">It is important to notice that, even though the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1006.1">doGet()</span></strong><span class="koboSpan" id="kobo.1007.1"> method returns immediately, the response is not committed until after the thread spawned finishes. </span><span class="koboSpan" id="kobo.1007.2">It can signal it is done processing by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1008.1">complete()</span></strong><span class="koboSpan" id="kobo.1009.1"> method </span><span class="No-Break"><span class="koboSpan" id="kobo.1010.1">on </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1011.1">AsyncContext</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1012.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1013.1">In our example, the message </span><strong class="bold"><span class="koboSpan" id="kobo.1014.1">You should see this after a brief wait</span></strong><span class="koboSpan" id="kobo.1015.1"> is displayed in the browser after 10 seconds, which is how long our spawned thread takes </span><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">to complete.</span></span></p>
<p><span class="koboSpan" id="kobo.1017.1">Now that we’ve seen how to perform</span><a id="_idIndexMarker556"/><span class="koboSpan" id="kobo.1018.1"> asynchronous processing in servlets, we’ll focus our attention on how to implement HTTP/2 server </span><span class="No-Break"><span class="koboSpan" id="kobo.1019.1">push support.</span></span></p>
<h1 id="_idParaDest-155"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.1020.1">HTTP/2 server push support</span></h1>
<p><strong class="bold"><span class="koboSpan" id="kobo.1021.1">HTTP/2</span></strong><span class="koboSpan" id="kobo.1022.1"> is the newest version of the HTTP </span><a id="_idIndexMarker557"/><span class="koboSpan" id="kobo.1023.1">protocol. </span><span class="koboSpan" id="kobo.1023.2">It offers several advantages over HTTP 1.1. </span><span class="koboSpan" id="kobo.1023.3">For example, with HTTP/2 there is a single connection between the browser and the server, and this connection remains open until the user navigates to another page. </span><span class="koboSpan" id="kobo.1023.4">HTTP/2 also offers multiplexing, meaning that several concurrent requests from the browser to the server are allowed. </span><span class="koboSpan" id="kobo.1023.5">Additionally, HTTP/2 features server push, meaning that the server can send resources to the browser without the browser specifically having to </span><span class="No-Break"><span class="koboSpan" id="kobo.1024.1">request them.</span></span></p>
<p><span class="koboSpan" id="kobo.1025.1">HTTP/2 server push support was added to the servlet specification in version 4.0, released as part of Java EE 8. </span><span class="koboSpan" id="kobo.1025.2">In this section, we’ll see how we can write code to take advantage of HTTP/2’s server push</span><a id="_idIndexMarker558"/><span class="koboSpan" id="kobo.1026.1"> functionality. </span><span class="koboSpan" id="kobo.1026.2">The following example illustrates how this can </span><span class="No-Break"><span class="koboSpan" id="kobo.1027.1">be done:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1028.1">
package com.ensode.jakartaeebook.servlet;
//imports omitted
@WebServlet(name = "ServletPushDemoServlet", urlPatterns = {"/ServletPushDemoServlet"})
public class ServletPushDemoServlet extends HttpServlet {
  @Override
  protected void doPost(HttpServletRequest request,
      HttpServletResponse response) throws Exception {
    </span><strong class="bold"><span class="koboSpan" id="kobo.1029.1">PushBuilder pushBuilder = request.newPushBuilder();</span></strong><span class="koboSpan" id="kobo.1030.1">
    if (pushBuilder != null) {
      </span><strong class="bold"><span class="koboSpan" id="kobo.1031.1">pushBuilder.path("images/david_heffelfinger.png").</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1032.1">        addHeader("content-type", "image/png").push();</span></strong><span class="koboSpan" id="kobo.1033.1">
      response.sendRedirect("response.html");
    } else {
      //handle the case when the browser does not support HTTP/2.
</span><span class="koboSpan" id="kobo.1033.2">    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.1034.1">We can push resources to the browser via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1035.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1036.1"> interface, introduced in version 4 of the servlet specification. </span><span class="koboSpan" id="kobo.1036.2">We can obtain an instance of a class implementing </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1038.1"> by invoking the new </span><strong class="source-inline"><span class="koboSpan" id="kobo.1039.1">PushBuilder()</span></strong><span class="koboSpan" id="kobo.1040.1"> method on the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1041.1">HttpServletRequest</span></strong><span class="koboSpan" id="kobo.1042.1"> we get as a parameter in our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1043.1">doPost()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1044.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.1045.1">As its name implies, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1046.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1047.1"> interface implements the Builder pattern, meaning that most of its methods return a new instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.1048.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1049.1"> we can use, allowing us to conveniently chain together </span><span class="No-Break"><span class="koboSpan" id="kobo.1050.1">method invocations.</span></span></p>
<p><span class="koboSpan" id="kobo.1051.1">We indicate the path of the resource we’d like to push to the browser by invoking </span><strong class="source-inline"><span class="koboSpan" id="kobo.1052.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1053.1">’s appropriately named </span><strong class="source-inline"><span class="koboSpan" id="kobo.1054.1">path()</span></strong><span class="koboSpan" id="kobo.1055.1"> method. </span><span class="koboSpan" id="kobo.1055.2">This method takes a single </span><strong class="source-inline"><span class="koboSpan" id="kobo.1056.1">String</span></strong><span class="koboSpan" id="kobo.1057.1"> argument indicating the path of the resource to push. </span><span class="koboSpan" id="kobo.1057.2">Paths beginning with a forward slash </span><strong class="source-inline"><span class="koboSpan" id="kobo.1058.1">("/")</span></strong><span class="koboSpan" id="kobo.1059.1"> indicate an absolute path; all other paths indicate a path relative to our application’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1060.1">context root.</span></span></p>
<p><span class="koboSpan" id="kobo.1061.1">Once we have specified the path of our resource, we can optionally set some HTTP headers. </span><span class="koboSpan" id="kobo.1061.2">In our case, we are pushing an image in PNG format, therefore we set the content type </span><span class="No-Break"><span class="koboSpan" id="kobo.1062.1">as appropriate.</span></span></p>
<p><span class="koboSpan" id="kobo.1063.1">Finally, we invoke the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1064.1">push()</span></strong><span class="koboSpan" id="kobo.1065.1"> method on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1066.1">PushBuilder</span></strong><span class="koboSpan" id="kobo.1067.1"> instance to actually push our resource to </span><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">the browser.</span></span></p>
<p><span class="koboSpan" id="kobo.1069.1">What we accomplished with our example</span><a id="_idIndexMarker559"/><span class="koboSpan" id="kobo.1070.1"> was pushing a resource to the browser before the browser submitted a request for it. </span><span class="koboSpan" id="kobo.1070.2">This task was impossible before the HTTP/2 protocol </span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">was released.</span></span></p>
<h1 id="_idParaDest-156"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.1072.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1073.1">This chapter covered how to develop, configure, package, and deploy servlets. </span><span class="koboSpan" id="kobo.1073.2">The following topics were covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.1074.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.1075.1">How to process HTML form information by accessing the HTTP </span><span class="No-Break"><span class="koboSpan" id="kobo.1076.1">request object</span></span></li>
<li><span class="koboSpan" id="kobo.1077.1">Forwarding HTTP requests from one servlet to another was covered, as well as redirecting the HTTP response to a </span><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">different server</span></span></li>
<li><span class="koboSpan" id="kobo.1079.1">Persisting objects in memory across requests by attaching them to the servlet context and the </span><span class="No-Break"><span class="koboSpan" id="kobo.1080.1">HTTP session</span></span></li>
<li><span class="koboSpan" id="kobo.1081.1">Configuring web applications </span><span class="No-Break"><span class="koboSpan" id="kobo.1082.1">via annotations</span></span></li>
<li><span class="koboSpan" id="kobo.1083.1">Pluggability </span><span class="No-Break"><span class="koboSpan" id="kobo.1084.1">through </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1085.1">web-fragment.xml</span></strong></span></li>
<li><span class="koboSpan" id="kobo.1086.1">Programmatic </span><span class="No-Break"><span class="koboSpan" id="kobo.1087.1">servlet configuration</span></span></li>
<li> <span class="No-Break"><span class="koboSpan" id="kobo.1088.1">Asynchronous processing</span></span></li>
<li><span class="koboSpan" id="kobo.1089.1">HTTP/2 </span><span class="No-Break"><span class="koboSpan" id="kobo.1090.1">server push</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.1091.1">Armed with the knowledge from this chapter, we can now implement server-side web application logic using </span><span class="No-Break"><span class="koboSpan" id="kobo.1092.1">Jakarta servlets.</span></span></p>
</div>
</body></html>