<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer138">
<h1 class="chapter-number" id="_idParaDest-420"><a id="_idTextAnchor625"/>19</h1>
<h1 id="_idParaDest-421"><a id="_idTextAnchor626"/>Build GraalVM Native Images</h1>
<p>This chapter is dedicated to honing skills concerning native images and <strong class="source-inline">GraalVM</strong>. Throughout this chapter, you’ll receive guidance on crafting a Spring Security application that makes use of <span class="No-Break">native functionalities.</span></p>
<p><strong class="source-inline">Spring Boot 3</strong> introduces native image generation support through <strong class="source-inline">GraalVM</strong>, and Spring Security seamlessly integrates with this capability, making its features compatible with native images. This integration can be a great way to improve the performance and security of your Spring <span class="No-Break">Security applications.</span></p>
<p>We’ll delve into the essential steps for efficiently updating build configurations to leverage <strong class="source-inline">GraalVM</strong> tools, enabling seamless integration of native capabilities into <span class="No-Break">your applications.</span></p>
<p>Additionally, we will explore <strong class="source-inline">GraalVM</strong> Native Image support with Spring Security features that we have not covered so far in this book, including the <span class="No-Break">following topics:</span></p>
<ul>
<li><span class="No-Break">Introducing </span><span class="No-Break"><strong class="source-inline">GraalVM</strong></span></li>
<li><span class="P---Regular-Char">Creating </span><strong class="source-inline">GraalVM</strong> images <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">Buildpacks</strong></span></li>
<li>Building a native image using Native <span class="No-Break">Build Tools</span></li>
<li>Handling method security in <strong class="source-inline">GraalVM</strong> <span class="No-Break">Native Image</span></li>
</ul>
<p>The following section is dedicated to offering guidance on specific <strong class="source-inline">Spring Security</strong> features that may necessitate additional hints to be supplied by <span class="No-Break">the application.</span></p>
<p>This chapter’s code in action link is <span class="No-Break">here: </span><a href="https://packt.link/fQ5AM"><span class="No-Break">https://packt.link/fQ5AM</span></a><span class="No-Break">.</span></p>
<h1 id="_idParaDest-422"><a id="_idTextAnchor627"/>Introducing GraalVM</h1>
<p><strong class="bold">GraalVM</strong> is<a id="_idIndexMarker1389"/> a high-performance runtime that provides significant improvements in application performance and efficiency. <strong class="bold">GraalVM</strong> represents a high-performance<a id="_idIndexMarker1390"/> runtime <strong class="bold">Java Development </strong><span class="No-Break"><strong class="bold">Kit</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">JDK</strong></span><span class="No-Break">).</span></p>
<p>Besides <a id="_idIndexMarker1391"/>supporting <strong class="bold">just-in-time</strong> (<strong class="bold">JIT</strong>) compilation, <strong class="bold">GraalVM</strong> also enables ahead-of-time compilation of Java applications. This feature facilitates quicker initialization, enhanced runtime performance, and reduced resource consumption. However, the resulting executable is limited to running on the platform for which it was compiled. <strong class="bold">GraalVM</strong> extends its functionality by offering additional programming languages and execution modes. The first production-ready<a id="_idIndexMarker1392"/> version, <strong class="bold">GraalVM</strong> 19.0, was introduced in <span class="No-Break">May 2019.</span></p>
<p>In the following section, we will delve deeper into the concept of native images to gain a <span class="No-Break">better understanding.</span></p>
<h2 id="_idParaDest-423"><a id="_idTextAnchor628"/>What are native images?</h2>
<p>Native images<a id="_idIndexMarker1393"/> in <strong class="bold">GraalVM</strong> refer to executables<a id="_idIndexMarker1394"/> compiled <strong class="bold">Ahead Of Time</strong> (<strong class="bold">AOT</strong>) from Java applications. Unlike traditional Java applications, which are typically compiled to bytecode and run on the <strong class="bold">Java Virtual Machine</strong> (<strong class="bold">JVM</strong>), native<a id="_idIndexMarker1395"/> images are compiled directly into machine code for a <span class="No-Break">specific platform.</span></p>
<p><strong class="bold">GraalVM’s</strong> native image leverages the <strong class="bold">GraalVM</strong> compiler to analyze and optimize the Java application’s code during compilation, resulting in a standalone native executable tailored for the target environment. These native images can be deployed independently without requiring a separate JVM installation, making them particularly useful for deploying lightweight, fast-starting applications in containerized environments or <span class="No-Break">serverless platforms.</span></p>
<h2 id="_idParaDest-424"><a id="_idTextAnchor629"/>Key features of GraalVM</h2>
<p><strong class="bold">GraalVM</strong> distinguishes itself from the <a id="_idIndexMarker1396"/>base JDK through several <span class="No-Break">key features:</span></p>
<ul>
<li>The<strong class="bold"> Graal compiler</strong>, serving as<a id="_idIndexMarker1397"/> a <span class="No-Break">JIT compiler.</span></li>
<li><strong class="bold">GraalVM Native Image</strong>, a<a id="_idIndexMarker1398"/> technology facilitating ahead-of-time compilation of <span class="No-Break">Java applications.</span></li>
<li><strong class="bold">Truffle</strong> is the<a id="_idIndexMarker1399"/> language implementation framework and <strong class="source-inline">GraalVM</strong> SDK, comprising a Java-based framework and a suite of APIs tailored for developing high-performance <span class="No-Break">language runtimes.</span></li>
<li><strong class="bold">GraalVM</strong> offers runtimes for <strong class="source-inline">JavaScript</strong>, <strong class="source-inline">Ruby</strong>, <strong class="source-inline">Python</strong>, and several other widely-used languages. With GraalVM’s polyglot capabilities, developers can seamlessly blend multiple programming languages within a single application without incurring additional overhead from foreign <span class="No-Break">language calls.</span></li>
<li><strong class="bold">JavaScript runtime</strong>, featuring <a id="_idIndexMarker1400"/>an <strong class="source-inline">ECMAScript 2023</strong>-compliant JavaScript runtime, <span class="No-Break">alongside Node.js.</span></li>
<li><strong class="bold">Low-Level Virtual Machine (LLVM) runtime</strong>, designed to<a id="_idIndexMarker1401"/> <span class="P---Regular-Char">compile</span> languages<a id="_idIndexMarker1402"/> transformable into <span class="No-Break"><strong class="source-inline">LLVM</strong></span><span class="No-Break"> bitcode.</span></li>
</ul>
<h2 id="_idParaDest-425"><a id="_idTextAnchor630"/>Security benefits of GraalVM</h2>
<p>In terms of security, <strong class="bold">GraalVM</strong> offers some<a id="_idIndexMarker1403"/> <span class="No-Break">notable advantages:</span></p>
<ul>
<li>It stops new, unfamiliar code from being loaded while the program <span class="No-Break">is running.</span></li>
<li>It only incorporates paths that the application has proven reachable within <span class="No-Break">its image.</span></li>
<li>Reflection is turned off by default and requires a specific inclusion list <span class="No-Break">to enable.</span></li>
<li>Deserialization is allowed only for a predefined list <span class="No-Break">of classes.</span></li>
<li>Issues related to the just-in-time compiler, such as crashes, incorrect compilations, or the possibility of creating machine code gadgets via <a id="_idIndexMarker1404"/>techniques like <strong class="bold">JIT spraying</strong> (security exploit) <span class="No-Break">are</span><span class="No-Break"><a id="_idIndexMarker1405"/></span><span class="No-Break"> eliminated.</span></li>
</ul>
<p>After covering the key features and security benefits of <strong class="bold">GraalVM</strong>, we’ll proceed to explore practical examples of building <strong class="bold">GraalVM</strong> images. This will involve utilizing Buildpacks and applying them to our JBCP <span class="No-Break">Calendar application.</span></p>
<h1 id="_idParaDest-426"><a id="_idTextAnchor631"/>GraalVM images using Buildpacks</h1>
<p>Ensure Docker is installed by referring to the details in the Docker documentation (<a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a>). If you are using Linux, configure Docker to permit <span class="No-Break">non-root users.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">For macOS users, it is advisable to enhance the allocated Docker memory to a minimum of <strong class="bold">8 GB</strong> and consider adding more CPUs. On Microsoft Windows, ensure optimal performance by enabling the Docker WSL 2 <span class="No-Break">backend (</span><a href="https://docs.docker.com/desktop/wsl/"><span class="No-Break">https://docs.docker.com/desktop/wsl/</span></a><span class="No-Break">).</span></p>
<p>In the upcoming sections, we will construct <strong class="bold">GraalVM</strong> images employing <strong class="source-inline">Buildpacks</strong> and <strong class="source-inline">Gradle</strong>, as well as crafting <strong class="bold">GraalVM</strong> images utilizing <strong class="source-inline">Buildpacks</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">Maven</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-427"><a id="_idTextAnchor632"/>Building GraalVM images using Buildpacks and Gradle</h2>
<p>The <a id="_idIndexMarker1406"/>AOT tasks are automatically configured by <a id="_idIndexMarker1407"/>the <strong class="bold">Spring Boot Gradle plugin</strong> when<a id="_idIndexMarker1408"/> the <strong class="bold">GraalVM Native Image plugin</strong> is applied. Ensure that your Gradle build includes a <strong class="source-inline">plugins</strong> block <span class="No-Break">with </span><span class="No-Break"><strong class="source-inline">org.graalvm.buildtools.native</strong></span><span class="No-Break">.</span></p>
<p>For our sample application, we need to add the plugin declaration to the <span class="No-Break"><strong class="source-inline">build.gradle</strong></span><span class="No-Break"> file:</span></p>
<pre class="source-code">
//build.gradle
plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.4'
    id 'io.spring.dependency-management' version '1.1.4'
    id 'org.graalvm.buildtools.native' version '0.10.1'
}</pre> <p>Once the <strong class="source-inline">org.graalvm.buildtools.native</strong> plugin is applied, the <strong class="source-inline">bootBuildImage</strong> task will<a id="_idIndexMarker1409"/> produce a native image instead of a JVM one. Execute the <span class="No-Break">task using:</span></p>
<pre class="console">
./gradlew bootBuildImage</pre> <h2 id="_idParaDest-428"><a id="_idTextAnchor633"/>Building GraalVM images using Buildpacks and Maven</h2>
<p>To create a<a id="_idIndexMarker1410"/> native image container using <strong class="bold">Maven</strong>, make sure that your <strong class="source-inline">pom.xml</strong> file adopts the <strong class="source-inline">spring-boot-starter-parent</strong> and includes the <strong class="source-inline">org.graalvm.buildtools:native-maven-plugin</strong>. Ensure that the <strong class="source-inline">&lt;parent&gt;</strong> section in your <strong class="source-inline">pom.xml</strong> resembles <span class="No-Break">the following:</span></p>
<pre class="source-code">
&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;3.2.4&lt;/version&gt;
&lt;/parent&gt;</pre> <p>Additionally, you should include the following <strong class="source-inline">native-maven-plugin</strong> in the <strong class="source-inline">&lt;plugins&gt;</strong> section of <span class="No-Break">your </span><span class="No-Break"><strong class="source-inline">pom.xml</strong></span><span class="No-Break">:</span></p>
<pre class="source-code">
&lt;build&gt;
    &lt;plugins&gt;
       &lt;plugin&gt;
          &lt;groupId&gt;org.graalvm.buildtools&lt;/groupId&gt;
          &lt;artifactId&gt;native-maven-plugin&lt;/artifactId&gt;
       &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</pre> <p>The <strong class="source-inline">spring-boot-starter-parent</strong> includes a <strong class="bold">native profile</strong> that sets up the necessary executions<a id="_idIndexMarker1411"/> for creating a native image. You can activate profiles by using <strong class="source-inline">-P</strong> flag on the <span class="No-Break">command line.</span></p>
<pre class="console">
mvn -Pnative spring-boot:build-image</pre> <p class="callout-heading">Important note</p>
<p class="callout">Your code should now look like that <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">chapter19.01-calendar</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-429"><a id="_idTextAnchor634"/>Running GraalVM images from Buildpacks</h2>
<p>After<a id="_idIndexMarker1412"/> executing the relevant build command for <strong class="bold">Maven</strong> or <strong class="bold">Gradle</strong>, a Docker image should be accessible. Initiate your application by <a id="_idIndexMarker1413"/>utilizing the <a id="_idIndexMarker1414"/>docker <span class="No-Break">run command:</span></p>
<pre class="console">
docker run --rm -p 8080:8080 docker.io/library/chapter19.01-calendar:0.0.1-SNAPSHOT</pre> <p>Your application should be reachable <span class="No-Break">via </span><span class="No-Break"><strong class="source-inline">http://localhost:8080</strong></span><span class="No-Break">.</span></p>
<p>To gracefully shut down the application, press <em class="italic">Ctrl + </em><span class="No-Break"><em class="italic">C</em></span><span class="No-Break">.</span></p>
<p>Following the construction of <strong class="bold">GraalVM</strong> images with <strong class="source-inline">Buildpacks</strong>, we will delve into a detailed exploration of building a Native Image using <strong class="bold">Native </strong><span class="No-Break"><strong class="bold">Build Tools</strong></span><span class="No-Break">.</span></p>
<h1 id="_idParaDest-430"><a id="_idTextAnchor635"/>Building a native image using Native Build Tools</h1>
<p>If you prefer generating a native <a id="_idIndexMarker1415"/>executable without relying <a id="_idIndexMarker1416"/>on <strong class="bold">Docker</strong>, <strong class="bold">GraalVM</strong><strong class="bold"> </strong><strong class="bold">Native Build Tools</strong> come<a id="_idIndexMarker1417"/> in handy. These tools are provided as plugins by <strong class="bold">GraalVM</strong> for <a id="_idIndexMarker1418"/>both <strong class="bold">Maven</strong> and <strong class="bold">Gradle</strong>, offering a range of <strong class="bold">GraalVM</strong> tasks, including the generation of a <a id="_idIndexMarker1419"/><span class="No-Break">native image.</span></p>
<p>In the following sections, we will understand the process of building and running <strong class="bold">GraalVM</strong> images using <strong class="bold">Native Build Tools</strong> with either <strong class="bold">Maven</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="bold">Gradle</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-431"><a id="_idTextAnchor636"/>Prerequisites</h2>
<p>To generate a native image with the <strong class="bold">Native Build Tools</strong>, ensure that you have a <strong class="bold">GraalVM</strong> distribution installed on <span class="No-Break">your system.</span></p>
<p>For our examples, we will use <strong class="source-inline">bellsoft-liberica-vm-openjdk17-23.0.3 </strong>that is available in the Liberica Native Image Kit Download <span class="No-Break">Center (</span><a href="https://bell-sw.com/pages/downloads/native-image-kit/#nik-23-(jdk-17)"><span class="No-Break">https://bell-sw.com/pages/downloads/native-image-kit/#nik-23-(jdk-17)</span></a><span class="No-Break">).</span></p>
<h2 id="_idParaDest-432"><a id="_idTextAnchor637"/>Building GraalVM images using Native Build Tools and Maven</h2>
<p>Just like with the <a id="_idIndexMarker1420"/>buildpack support, it’s essential to ensure the usage of <strong class="source-inline">spring-boot-starter-parent</strong> to inherit the native profile. Additionally, make sure to incorporate the <span class="No-Break"><strong class="source-inline">org.graalvm.buildtools:native-maven-plugin</strong></span><span class="No-Break"> plugin.</span></p>
<p>Once the native profile is enabled, you can initiate the <strong class="source-inline">native:compile</strong> goal to commence the native-image <span class="No-Break">compilation process.</span></p>
<pre class="console">
mvn -Pnative native:compile</pre> <p>You can locate the executable of the native image in the <span class="No-Break"><strong class="source-inline">target</strong></span><span class="No-Break"> directory.</span></p>
<h2 id="_idParaDest-433"><a id="_idTextAnchor638"/>Building GraalVM images using Native Build Tools and Gradle</h2>
<p>For our sample application, we <a id="_idIndexMarker1421"/>need to add the <strong class="bold">Native Build Tools </strong><span class="No-Break"><strong class="bold">Gradle plugin</strong></span><span class="No-Break">.</span></p>
<p>When you incorporate the Native Build Tools Gradle plugin into your project, the Spring Boot Gradle plugin will promptly activate the Spring AOT engine. Task dependencies are prearranged, enabling you to simply execute the standard <strong class="source-inline">nativeCompile</strong> task for generating a <span class="No-Break">native image.</span></p>
<pre class="console">
./gradlew nativeCompile</pre> <p>You can locate the native image executable within the directory <span class="No-Break">named </span><span class="No-Break"><strong class="source-inline">build/native/nativeCompile</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-434"><a id="_idTextAnchor639"/>Running GraalVM images from Native Build Tools</h2>
<p>At this<a id="_idIndexMarker1422"/> stage, your application should be functional. The startup time varies across different machines, but it is expected to be considerably faster than a Spring Boot application running on <span class="No-Break">a JVM.</span></p>
<p>You can run the application by executing <span class="No-Break">it directly:</span></p>
<pre class="console">
target/chapter19.01-calendar</pre> <p>By navigating to <strong class="source-inline">http://localhost:8080</strong> in your web browser, you should have access to the <strong class="bold">JBCP </strong><span class="No-Break"><strong class="bold">Calendar</strong></span><span class="No-Break"> application.</span></p>
<p>To gracefully shut down the application, press <em class="italic">Ctrl + </em><span class="No-Break"><em class="italic">C</em></span><span class="No-Break">.</span></p>
<p>Upon grasping the fundamental configurations for building <strong class="bold">GraalVM</strong> images, we will delve deeper into specific use cases associated with <strong class="bold">Spring Security</strong> <span class="No-Break">native images.</span></p>
<h1 id="_idParaDest-435"><a id="_idTextAnchor640"/>Method Security in GraalVM Native Image</h1>
<p>While <strong class="bold">GraalVM</strong> Native Image does<a id="_idIndexMarker1423"/> support <strong class="bold">Method Security</strong>, certain use cases may require the application to supply additional hints for <span class="No-Break">proper functionality.</span></p>
<p>If you’re employing custom implementations of <strong class="source-inline">UserDetails</strong> or authentication classes and using <strong class="source-inline">@PreAuthorize</strong> and <strong class="source-inline">@PostAuthorize</strong> annotations, you may need supplementary indications. Consider a scenario where you’ve crafted a custom implementation of the <strong class="source-inline">UserDetails</strong> class, which is returned by <span class="No-Break">your </span><span class="No-Break"><strong class="source-inline">UserDetailsService</strong></span><span class="No-Break">:</span></p>
<ol>
<li>First, create a custom <strong class="source-inline">UserDetails</strong> implementation <span class="No-Break">as follows:</span></li>
</ol>
<pre class="source-code">
//src/main/java/com/packtpub/springsecurity/service/ CalendarUserDetails.java
public class CalendarUserDetails extends CalendarUser implements UserDetails {
    CalendarUserDetails(CalendarUser user) {
       setId(user.getId());
       setEmail(user.getEmail());
       setFirstName(user.getFirstName());
       setLastName(user.getLastName());
       setPassword(user.getPassword());
    }
    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
       return CalendarUserAuthorityUtils.createAuthorities(this);
    }
    public boolean hasAdminRole() {
       return getUsername().startsWith("admin");
    }
    @Override
    public String getUsername() {
       return getEmail();
    }
    @Override
    public boolean isAccountNonExpired() {
       return true;
    }
    @Override
    public boolean isAccountNonLocked() {
       return true;
    }
    @Override
    public boolean isCredentialsNonExpired() {
       return true;
    }
    @Override
    public boolean isEnabled() {
       return true;
    }
    private static final long serialVersionUID = 3384436451564509032L;
}</pre> <p class="callout-heading">Important note</p>
<p class="callout">The provided implementation of <strong class="source-inline">hasAdminRole()</strong> is merely presented as an illustration of how method security can be managed with <strong class="source-inline">GraalVM</strong> native images. However, for production environments, it’s advisable to consider a safer implementation <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">hasAdminRole()</strong></span><span class="No-Break">.</span></p>
<ol>
<li value="2">We want <a id="_idIndexMarker1424"/>to use <strong class="source-inline">hasAdminRole()</strong> method within a <strong class="source-inline">@PreAuthorize</strong> annotation in the <span class="No-Break"><strong class="source-inline">CalendarService</strong></span><span class="No-Break"> interface:</span></li>
</ol>
<pre class="source-code">
//src/main/java/com/packtpub/springsecurity/service/ CalendarUserDetails.java
public interface CalendarService{
... omitted for brevity
    @PreAuthorize("principal?.hasAdminRole()")
    List&lt;Event&gt; getEvents();
}</pre> <ol>
<li value="3">Ensure that the <strong class="source-inline">@EnableMethodSecurity</strong> annotation is present in <strong class="source-inline">SecurityConfig.java</strong> to activate method<a id="_idIndexMarker1425"/> <span class="No-Break">security annotations.</span></li>
</ol>
<p class="callout-heading">Important note</p>
<p class="callout">Your code should now look like that <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">chapter19.02-calendar</strong></span><span class="No-Break">.</span></p>
<ol>
<li value="4">Sign in to the application with <strong class="source-inline">admin1@example.com/admin1</strong> and try accessing http://localhost:8080/events<span class="P---Regular-Char">. </span>You will notice all the events can <span class="No-Break">be displayed.</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer136">
<img alt="Figure 19.1 – All the events page" height="406" src="image/B21757_19_01.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.1 – All the events page</p>
<ol>
<li value="5">When you sign in to the application with <strong class="source-inline">user1@example.com/user1</strong> and try accessing http://localhost:8080/events, You will get the following access <span class="No-Break">denied page:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer137">
<img alt="Figure 19.2 – Access denied page for unauthorized user" height="327" src="image/B21757_19_02.jpg" width="1631"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 19.2 – Access denied page for unauthorized user</p>
<ol>
<li value="6">If you<a id="_idIndexMarker1426"/> execute your application’s native image with the provided configuration, attempting to invoke the <strong class="source-inline">hasAdminRole()</strong> method will result in an error resembling <span class="No-Break">the following:</span><pre class="source-code">
Caused by: org.springframework.expression.spel.SpelEvaluationException: <strong class="source-inline">EL1004E: Method call: Method</strong> hasAdminRole() cannot be found on type com.packtpub.springsecurity.service.CalendarUserDetails
at org.springframework.expression.spel.ast.MethodReference.findAccessorForMethod(MethodReference.java:237) ~[na:na]
at org.springframework.expression.spel.ast.MethodReference.getValueInternal(MethodReference.java:147) ~[na:na]
at org.springframework.expression.spel.ast.MethodReference$MethodValueRef.getValue(MethodReference.java:400) ~[na:na]
at org.springframework.expression.spel.ast.CompoundExpression.getValueInternal(CompoundExpression.java:98) ~[na:na]
at org.springframework.expression.spel.ast.SpelNodeImpl.getTypedValue(SpelNodeImpl.java:119) ~[chapter19.02-calendar:6.1.5]
at org.springframework.expression.spel.standard.SpelExpression.getValue(SpelExpression.java:309) ~[na:na]
at org.springframework.security.access.expression.ExpressionUtils.evaluateAsBoolean(ExpressionUtils.java:30) ~[na:na]
... 113 common frames omitted</pre><p class="list-inset">The error above indicates that the <strong class="source-inline">hasAdminRole()</strong> method cannot be located on <span class="No-Break">the </span><span class="No-Break"><strong class="source-inline">CalendarUserDetails.class</strong></span><span class="No-Break">.</span></p></li> </ol>
<p>Spring Security <a id="_idIndexMarker1427"/>relies on reflection to invoke the <strong class="source-inline">hasAdminRole()</strong> method, and <strong class="source-inline">GraalVM</strong> Native Image does not inherently <span class="No-Break">support reflection.</span></p>
<p>To resolve this problem, you must follow the <span class="No-Break">subsequent steps:</span></p>
<ol>
<li>Provide hints to GraalVM Native Image to enable reflection on the <strong class="source-inline">CalendarUserDetails#hasAdminRole()</strong> method. This can be achieved by supplying a custom hint, as demonstrated in the <span class="No-Break">following example:</span></li>
</ol>
<pre class="source-code">
//src/main/java/com/packtpub/springsecurity/configuration/ SpringSecurityHints.java
@Configuration(proxyBeanMethods = false)
@ImportRuntimeHints(SpringRuntimeHints.class)
public class SpringSecurityHints {
    static class SpringRuntimeHints implements RuntimeHintsRegistrar {
       @Override
       public void registerHints(RuntimeHints hints, ClassLoader classLoader) {
          hints.reflection()
                .registerType(CalendarUserDetails.class,
                      MemberCategory.INVOKE_DECLARED_METHODS);
       }
    }
}</pre> <ol>
<li value="2">Now<a id="_idIndexMarker1428"/> you can build the native image of your application, and it should function <span class="No-Break">as intended.</span></li>
</ol>
<p class="callout-heading">Important note</p>
<p class="callout">Your code should now look like that <span class="No-Break">in </span><span class="No-Break"><strong class="source-inline">chapter19.03-calendar</strong></span><span class="No-Break">.</span></p>
<h1 id="_idParaDest-436"><a id="_idTextAnchor641"/>Summary</h1>
<p>In this chapter, we delved into the support for <strong class="bold">GraalVM</strong> Native Image in conjunction with Spring Security features, which were not previously covered in this book. We introduced the concept of native images, including the key features and security benefits <span class="No-Break">of </span><span class="No-Break"><strong class="bold">GraalVM</strong></span><span class="No-Break">.</span></p>
<p>The key topics explored included <strong class="source-inline">Spring Boot 3</strong>, which introduces native image generation support via <strong class="bold">GraalVM</strong>, seamlessly integrating with Spring Security features and making them compatible with native images. We have seen that there are some cases where we need to provide hints to be used <span class="No-Break">by </span><span class="No-Break"><strong class="bold">GraalVM</strong></span><span class="No-Break">.</span></p>
<p>Moreover, we’ve successfully improved our application’s performance and security, aligning with contemporary software <span class="No-Break">development practices.</span></p>
<p>In concluding this chapter, I want to extend my heartfelt congratulations to you for reaching this milestone of completing the book. Your dedication and commitment to learning about <strong class="source-inline">Spring Security 6</strong> features <span class="No-Break">are commendable.</span></p>
<p>As you reflect on the concepts covered, remember that every step you take toward mastering these technologies brings you closer to becoming an adept developer. Embrace the challenges ahead with confidence, knowing that each hurdle is an opportunity for growth. Keep exploring, keep experimenting, and never underestimate the power of <span class="No-Break">continuous learning.</span></p>
<p>Wishing you continued success on your software <span class="No-Break">development journey!</span></p>
</div>
</div>

<div id="sbo-rt-content"><div id="_idContainer152">
<h1 id="_idParaDest-437"><a id="_idTextAnchor642"/>Appendix – Additional Reference Material</h1>
<p>In this <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, we will cover some reference material that we feel is helpful (and largely <a id="_idTextAnchor643"/>undocumented) but too comprehensive to insert in <span class="No-Break">the chapters.</span></p>
<p>During this section, we will cover the <span class="No-Break">following topics:</span></p>
<ul>
<li>Using <a id="_idIndexMarker1429"/>build tools (<strong class="source-inline">Gradle</strong> or <strong class="source-inline">Maven</strong>) and<a id="_idIndexMarker1430"/> IDE (<strong class="bold">IntelliJ IDEA</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="bold">Eclipse</strong></span><span class="No-Break">)</span></li>
<li>Getting started with the JBCP calendar <span class="No-Break">sample code</span></li>
<li>Generating a <span class="No-Break">server certificate</span></li>
<li>Additional <span class="No-Break">supporting resource</span></li>
</ul>
<p>This section is designed to provide you with guidance for further depth and clarity on the provided code covered in <span class="No-Break">this book.</span></p>
<h1 id="_idParaDest-438"><a id="_idTextAnchor644"/>Build tools</h1>
<p>The book’s <a id="_idIndexMarker1431"/>code is <a id="_idIndexMarker1432"/>executable via <strong class="bold">Gradle</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="bold">Maven</strong></span><span class="No-Break">.</span></p>
<p>In subsequent <a id="_idIndexMarker1433"/>sections, we’ll elaborate on executing projects utilizing either <strong class="source-inline">Gradle</strong> or <strong class="source-inline">Maven</strong> as the build tool. The code from the book operates independently <a id="_idIndexMarker1434"/>of any <strong class="bold">Integrated Development </strong><span class="No-Break"><strong class="bold">Environment</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">IDE</strong></span><span class="No-Break">).</span></p>
<p>However, we’ll provide <a id="_idIndexMarker1435"/>examples of <a id="_idIndexMarker1436"/>implementations using <strong class="bold">Eclipse</strong> and <span class="No-Break"><strong class="bold">IntelliJ IDEA</strong></span><span class="No-Break">.</span></p>
<p>In the following section, we demonstrate the usage of build tools such as <strong class="source-inline">Gradle</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">Maven</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-439"><a id="_idTextAnchor645"/>Gradle build tool</h2>
<p>All the code <a id="_idIndexMarker1437"/>in this book can be built using the <strong class="bold">Gradle build tool</strong> and is organized in a chapter-by-chapter multimodule build. You can find instructions <a id="_idIndexMarker1438"/>and options for getting <strong class="source-inline">Gradle</strong> locally <span class="No-Break">at </span><a href="https://gradle.org/install/"><span class="No-Break">https://gradle.org/install/</span></a><span class="No-Break">.</span></p>
<p>A local installation of <strong class="source-inline">Gradle</strong> is not required as the root of the source code already has the <strong class="source-inline">Gradle</strong> wrapper installed. The <strong class="source-inline">Gradle</strong> wrapper can be installed in any submodule. You can find additional information about the <strong class="source-inline">Gradle</strong> wrapper <span class="No-Break">at </span><a href="https://docs.gradle.org/current/userguide/gradle_wrapper.xhtml"><span class="No-Break">https://docs.gradle.org/current/userguide/gradle_wrapper.xhtml</span></a><span class="No-Break">.</span></p>
<h2 id="_idParaDest-440"><a id="_idTextAnchor646"/>Maven build tool</h2>
<p>Throughout <a id="_idIndexMarker1439"/>the chapters ahead, you’ll find a wealth of code <a id="_idIndexMarker1440"/>examples, practical tips, and hands-on exercises designed for those who are comfortable <span class="No-Break">with </span><span class="No-Break"><strong class="bold">Maven</strong></span><span class="No-Break">.</span></p>
<p><strong class="bold">Maven</strong> is a powerful build automation tool primarily used for Java projects, though it can be adapted to other languages and frameworks. It simplifies the process of project management, dependency resolution, and build configuration, allowing developers to focus on writing code rather than managing project infrastructure. You can find instructions and options for getting <strong class="source-inline">Maven</strong> locally <span class="No-Break">at </span><a href="https://maven.apache.org/download.cgi"><span class="No-Break">https://maven.apache.org/download.cgi</span></a><span class="No-Break">.</span></p>
<p class="callout-heading">Downloading the example code</p>
<p class="callout">You can download the example code files for all Packt books you have purchased from your account at <a href="https://www.packtpub.com">https://www.packtpub.com</a>. If you purchased this book from elsewhere, you <a id="_idTextAnchor647"/>could visit <a href="https://www.packtpub.com/support">https://www.packtpub.com/support</a> and register to have the files emailed directly <span class="No-Break">to you.</span></p>
<p>In the following section, we’ll delve into initiating the JBCP calendar sample code with your preferred IDE such as <strong class="bold">IntelliJ IDEA</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="bold">Eclipse</strong></span><span class="No-Break">.</span></p>
<h1 id="_idParaDest-441"><a id="_idTextAnchor648"/>Getting started with the JBCP calendar sample code</h1>
<p>As we described in <a href="B21757_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Anatomy of an Unsafe Application</em>, we have assumed that you <a id="_idIndexMarker1441"/>have installed <strong class="source-inline">Java 17</strong> as a minimum. You can download a JDK from Oracle’s website (<a href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a>) or use any other OpenJDK <span class="No-Break">version 17.</span></p>
<p>Upon the <a id="_idIndexMarker1442"/>publication of this book, all the code has been validated with <strong class="source-inline">Java 21</strong>, the most recent <strong class="bold">Long-Term Support</strong> (<span class="No-Break"><strong class="bold">LTS</strong></span><span class="No-Break">) version.</span></p>
<p>The upcoming section discusses the structure of sample code and its utilization within your <span class="No-Break">preferred IDE.</span></p>
<h2 id="_idParaDest-442"><a id="_idTextAnchor649"/>Sample code structure</h2>
<p>The sample code contains folders of a multimodule <strong class="source-inline">Gradle</strong> or <strong class="source-inline">Maven</strong> project. Each folder is named <strong class="source-inline">ChapterNN</strong>, where <strong class="source-inline">NN</strong> is the <strong class="source-inline">chapter number</strong>. Each <strong class="source-inline">ChapterNN</strong> folder has <a id="_idIndexMarker1443"/>additional folders containing each milestone project with the format <strong class="source-inline">chapterNN.mm-calendar</strong>, where <strong class="source-inline">NN</strong> is the <strong class="source-inline">chapter number</strong> and <strong class="source-inline">mm</strong> is the <strong class="source-inline">milestone</strong> within <span class="No-Break">that chapter.</span></p>
<p>For simplicity, we recommend that you extract the source to a path that does not contain any spaces. Each milestone is a checkpoint within the <strong class="source-inline">chapter</strong> and allows you to easily compare your code with the book’s code. For example, <strong class="source-inline">chapter02.03-calendar</strong> contains milestone number <strong class="source-inline">03</strong> within <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, of the calendar application. The location of the preceding project would be <strong class="source-inline">~/ </strong><span class="No-Break"><strong class="source-inline">Spring-Security-Fourth-Edition/Chapter02/chapter02.03-calendar</strong></span><span class="No-Break">.</span></p>
<p><a href="B21757_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Anatomy of an Unsafe Application</em>, and <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, have been created as <strong class="source-inline">Spring projects</strong>, not using <strong class="source-inline">Spring Boot</strong> as a <span class="No-Break">project base.</span></p>
<p><a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Custom Authentication</em>, converted the calendar project to a <strong class="source-inline">Spring </strong><span class="No-Break"><strong class="source-inline">Boot codebase</strong></span><span class="No-Break">.</span></p>
<p>To keep each chapter as independent as possible, most chapters in the book are built on <a href="B21757_09.xhtml#_idTextAnchor295"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Opening up to OAuth2</em>, or <a href="B21757_15.xhtml#_idTextAnchor479"><span class="No-Break"><em class="italic">Chapter 15</em></span></a>, <em class="italic">Additional Spring Security Features</em>. This means that, in most cases, you can read through <a href="B21757_09.xhtml#_idTextAnchor295"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Opening up to OAuth2</em>, and then skip around to the other parts of the book. However, this also means that it is important to start each chapter with the chapter’s <strong class="source-inline">milestone 00</strong> source code rather than continuing to work on the code from the previous chapter. This ensures that your code starts in the same place that the <span class="No-Break">chapter does.</span></p>
<p>While you can get through the entire book without performing any of the steps, we recommend <a id="_idIndexMarker1444"/>starting each chapter with <strong class="source-inline">milestone 00</strong> and implementing the steps in the book. This will ensure that you get the most out of the book. You can us<a id="_idTextAnchor650"/>e the milestone versions to copy large portions of code or to compare your code if you run <span class="No-Break">into problems.</span></p>
<h2 id="_idParaDest-443"><a id="_idTextAnchor651"/>Using the samples in IntelliJ IDEA</h2>
<p>There are a few things that are necessary to run the sample applications within <strong class="bold">IntelliJ IDEA</strong>. In <a id="_idIndexMarker1445"/>all the projects, a <strong class="source-inline">Tomcat</strong> plugin has been configured with <strong class="source-inline">Gradle</strong> or <a id="_idTextAnchor652"/><strong class="source-inline">Maven</strong> to run the embedded instance to help you get<a id="_idTextAnchor653"/> <span class="No-Break">started faster.</span></p>
<h3>Importing projects in IntelliJ IDEA</h3>
<p>Most of the diagrams used in this book were taken from <strong class="bold">IntelliJ IDEA</strong> from JetBrains (<a href="https://www.jetbrains.com/idea/">https://www.jetbrains.com/idea/</a>). IntelliJ IDEA has <a id="_idIndexMarker1446"/>wonderful support for multimodule <strong class="source-inline">Gradle</strong> or <span class="No-Break"><strong class="source-inline">Maven</strong></span><span class="No-Break"> projects.</span></p>
<p>IntelliJ IDEA will allow you to import an existing project, or you can simply open <strong class="source-inline">build.gradle</strong> or <strong class="source-inline">pom.xml</strong> from the root of the source code base and IDEA will create the necessary project files <span class="No-Break">for you.</span></p>
<ol>
<li>Once you open IntelliJ IDEA, you can open the entire project using the <strong class="bold">Open</strong> option, as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer139">
<img alt="Appendix figure 1 – JBCP calendar samples import" height="649" src="image/B21757_20_1.jpg" width="1010"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 1 – JBCP calendar samples import</p>
<ol>
<li value="2">Then, you will be prompted to select various options for how IntelliJ IDEA will execute <a id="_idIndexMarker1447"/>this project, either <strong class="bold">Gradle</strong> or <strong class="bold">Maven</strong>, as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer140">
<img alt="Appendix figure 2 – Gradle or Maven option" height="190" src="image/B21757_20_2.jpg" width="427"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 2 – Gradle or Maven option</p>
<ol>
<li value="3">Once we choose <strong class="bold">Gradle</strong>, for example, you will be able to work with any of the chapters, and the layout will look as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer141">
<img alt="Appendix figure 3 – Chapter presentation layout with IDEA" height="333" src="image/B21757_20_3.jpg" width="441"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 3 – Chapter presentation layout with IDEA</p>
<p>After <a id="_idIndexMarker1448"/>importing the project in <strong class="bold">IntelliJ IDEA</strong>, you can run your code following the guidance provided in the <span class="No-Break">next section.</span></p>
<h3>Running the samples within IntelliJ IDEA</h3>
<p>Running <a id="_idIndexMarker1449"/>milestone projects can be done by creating a <strong class="bold">Run/Debug Configuration</strong> entry for <span class="No-Break">each project.</span></p>
<ol>
<li>For each <strong class="source-inline">spring-boot</strong> project (starting from <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a><em class="italic">, Custom Authentication</em>), you can simply click the green play button in the toolbar, or right-click on the main class and choose <strong class="bold">Run CalendarApplication</strong>. IntelliJ IDEA will start the Spring Boot application, and you will see the logs in the <strong class="bold">Run</strong> <span class="No-Break">tool window.</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer142">
<img alt="Appendix figure 4 – Running the Spring Boot project with IntelliJ IDEA" height="177" src="image/B21757_20_4.jpg" width="561"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 4 – Running the Spring Boot project with IntelliJ IDEA</p>
<ol>
<li value="2">For other projects, you can use the terminal or if using IntelliJ IDEA, go to <strong class="bold">File</strong> | <strong class="bold">Run</strong> and select <strong class="bold">Edit Configurations...</strong>, as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer143">
<img alt="Appendix figure 5 – Custom applications, Run with IntelliJ IDEA" height="317" src="image/B21757_20_5.jpg" width="412"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 5 – Custom applications, Run with IntelliJ IDEA</p>
<ol>
<li value="3">You will <a id="_idIndexMarker1450"/>be presented with options to add new configurations. Select the plus (<strong class="bold">+</strong>) sign in the upper-left corner to choose a new <strong class="bold">Gradle</strong> configuration, as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer144">
<img alt="Appendix figure 6 – Custom applications, Add New Configuration with IntelliJ IDEA" height="435" src="image/B21757_20_6.jpg" width="251"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 6 – Custom applications, Add New Configuration with IntelliJ IDEA</p>
<ol>
<li value="4">Now, you can give it a name such as <strong class="source-inline">chapter01.00 (bootRun)</strong> and select the actual milestone directory for this configuration. Finally, enter <strong class="source-inline">tomcatRun </strong>under the <strong class="bold">Run</strong> option to execute, as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer145">
<img alt="Appendix figure 7 – Custom project, Run with IntelliJ IDEA" height="607" src="image/B21757_20_7.jpg" width="887"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 7 – Custom project, Run with IntelliJ IDEA</p>
<ol>
<li value="5">Select the <a id="_idIndexMarker1451"/>configuration you want to execute; click on the green <strong class="bold">Run</strong> button (as shown in <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a><em class="italic"> </em><span class="No-Break"><em class="italic">figure 7</em></span><span class="No-Break">).</span></li>
</ol>
<p>In the next section, we will cover the usage of <strong class="bold">Eclipse</strong> to run the <span class="No-Break">sample code.</span></p>
<h2 id="_idParaDest-444"><a id="_idTextAnchor654"/>Using the samples in Eclipse</h2>
<p>In this section, we will cover the sample applications usage within Eclipse. Across <a id="_idIndexMarker1452"/>all projects, a <strong class="source-inline">Tomcat</strong> plugin has been set up using <strong class="source-inline">Gradle</strong> or <strong class="source-inline">Maven</strong> to facilitate the rapid initiation of an embedded instance, expediting your initial <span class="No-Break">setup process.</span></p>
<h3>Importing projects in Eclipse</h3>
<p>After you <a id="_idIndexMarker1453"/>download and install your Eclipse IDE (<a href="https://www.eclipse.org/downloads/">https://www.eclipse.org/downloads/</a>), <span class="No-Break">launch Eclipse.</span></p>
<ol>
<li>When you first open Eclipse, it will prompt you for the workspace location. You may need to go to <strong class="bold">File</strong> | <strong class="bold">Switch Workspace</strong> | <strong class="bold">Other</strong> to create a new workspace. We recommend entering a workspace location that does not contain any spaces. For example, look at the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer146">
<img alt="Appendix figure 8 – Eclipse workspace choice" height="348" src="image/B21757_20_8.jpg" width="685"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 8 – Eclipse workspace choice</p>
<ol>
<li value="2">Once you <a id="_idIndexMarker1454"/>have created a new workspace, choose <span class="No-Break"><strong class="bold">Import Projects</strong></span><span class="No-Break">.</span></li>
<li>This time, we will choose <strong class="bold">Existing </strong><span class="No-Break"><strong class="bold">Maven Projects</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer147">
<img alt="Appendix figure 9 – Eclipse project import as Maven project" height="527" src="image/B21757_20_9.jpg" width="593"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 9 – Eclipse project import as Maven project</p>
<ol>
<li value="4">Browse to the location you exported the code to and select the parent folder of the code. You will see all the projects listed. You can select the projects you are interested in or leave all the projects selected. If you decide to import all the projects, you can easily focus on the current chapter since the naming conventions will ensure that the projects are sorted in the order that they are presented in <span class="No-Break">the book:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer148">
<img alt="Appendix figure 10 – Eclipse Maven project import confirmation" height="680" src="image/B21757_20_10.jpg" width="745"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 10 – Eclipse Maven project import confirmation</p>
<ol>
<li value="5">You will be <a id="_idIndexMarker1455"/>able to work with any of the chapters, and the layout will look as shown in the <span class="No-Break">following screenshot:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer149">
<img alt="Appendix figure 11 – Chapters presentation layout with Eclipse" height="755" src="image/B21757_20_11.jpg" width="1007"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 11 – Chapters presentation layout with Eclipse</p>
<p>After importing the project in <strong class="bold">Eclipse</strong>, you can run your code following the guidance provided in the <span class="No-Break">next section.</span></p>
<h3>Running the samples within Eclipse</h3>
<p>To execute <a id="_idIndexMarker1456"/>each milestone project, you can proceed with the <span class="No-Break">subsequent steps:</span></p>
<ol>
<li>For each spring-boot project (starting from <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a><em class="italic">, Custom Authentication</em>), you can simply click on the <strong class="bold">Run</strong> button in Eclipse, or right-click on your project and select <strong class="bold">Run As</strong> | <span class="No-Break"><strong class="bold">Java Application</strong></span><span class="No-Break">.</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer150">
<img alt="Appendix figure 12 – Running the Spring Boot project with Eclipse" height="755" src="image/B21757_20_12.jpg" width="1007"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 12 – Running the Spring Boot project with Eclipse</p>
<ol>
<li value="2">For other projects, you can use the terminal, go to the <strong class="bold">Run</strong> button using <strong class="bold">Eclipse</strong>, or right-click on your project and select <span class="No-Break"><strong class="bold">Run Configurations</strong></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer151">
<img alt="Appendix figure 13 – Custom applications, Run with Eclipse" height="683" src="image/B21757_20_13.jpg" width="1139"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Appendix figure 13 – Custom applications, Run with Eclipse</p>
<ol>
<li value="3">In the <strong class="bold">Goals</strong> section, choose, for example, to run <strong class="bold">chapter01.00-calendar</strong>, and declare the goal: <span class="No-Break"><strong class="source-inline">package cargo:run</strong></span><span class="No-Break">.</span></li>
</ol>
<h2 id="_idParaDest-445"><a id="_idTextAnchor655"/>Starting the samples from the command line</h2>
<p>In <a href="B21757_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Anatomy of an Unsafe Application</em>, and <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, you will <a id="_idIndexMarker1457"/>use different tasks to run <span class="No-Break">the project.</span></p>
<ul>
<li>If you’re using <strong class="source-inline">Gradle</strong>, run the following command to start <span class="No-Break">the application:</span><pre class="source-code">
<strong class="bold">./gradlew</strong> tomcatRun</pre></li> <li>Alternatively, if using <strong class="source-inline">Maven</strong>, run the following command to start <span class="No-Break">the application:</span><pre class="source-code">
<strong class="bold">./mvnw</strong> package cargo:run</pre></li> </ul>
<p>For the rest of the chapters in the book (starting from <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a><em class="italic">, Custom Authentication</em>), Spring Boot has <span class="No-Break">been used:</span></p>
<ul>
<li>If you’re using <strong class="source-inline">Gradle</strong>, run the following command to start <span class="No-Break">the application:</span><pre class="source-code">
<strong class="bold">./gradlew</strong> bootRun</pre></li> <li>Alternatively, if using <strong class="source-inline">Maven</strong>, run the following command to start <span class="No-Break">the application:</span><pre class="source-code">
<strong class="bold">./mvnw</strong> spring-boot:run</pre></li> </ul>
<p>In general, for every section of the book, there’s a <strong class="source-inline">README.md</strong> file in the root directory of each chapter milestone. This file includes the necessary commands to launch the application, tailored to your preferred <span class="No-Break">build tool.</span></p>
<p>In the following section, we’ll address the generation of a <span class="No-Break">server certificate.</span></p>
<h1 id="_idParaDest-446"><a id="_idTextAnchor656"/>Generating a server certificate</h1>
<p>Some of the <a id="_idIndexMarker1458"/>chapters sample code (that is, <a href="B21757_08.xhtml#_idTextAnchor261"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Client Certificate Authentication with TLS</em>, <a href="B21757_09.xhtml#_idTextAnchor295"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Opening up to OAuth2</em>, <a href="B21757_10.xhtml#_idTextAnchor314"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">SAML 2 Support</em>, and <a href="B21757_18.xhtml#_idTextAnchor591"><span class="No-Break"><em class="italic">Chapter 18</em></span></a>, <em class="italic">Single Sign-On with the Central Authentication Service</em>) requires the use of HTTPS in order for the sample code <span class="No-Break">to work.</span></p>
<p>Some projects have been configured to run <strong class="source-inline">HTTPS</strong>; most of the configuration is managed in properties or <span class="No-Break"><strong class="source-inline">YAML</strong></span><span class="No-Break"> files.</span></p>
<p>Now, when you run the sample code on the embedded Tomcat server from <strong class="source-inline">Maven</strong> or <strong class="source-inline">Gradle</strong>, you can connect to <strong class="source-inline">http://localhost:8080</strong> <span class="No-Break">or </span><span class="No-Break"><strong class="source-inline">https://localhost:8443</strong></span><span class="No-Break">.</span></p>
<p>If you do not already have a certificate, you must first <span class="No-Break">generate one.</span></p>
<p>If you wish, you can skip this step and use the <strong class="source-inline">tomcat.keystore</strong> file, which contains a certificate that is located in the <strong class="source-inline">src/main/resources/keys</strong> directory in the book’s <span class="No-Break">sample source.</span></p>
<p>Enter the <a id="_idIndexMarker1459"/>following command lines at the <span class="No-Break">command prompt:</span></p>
<pre class="console">
keytool -genkey -alias jbcpcalendar -keypass changeit -keyalg RSA \
-keystore tomcat.keystore
Enter keystore password: changeit
Re-enter new password: changeitWhat is your first and last name? [Unknown]: localhost
What is the name of your organizational unit? [Unknown]: JBCP Calendar What is the name of your organization? [Unknown]: JBCP
What is the name of your City or Locality? [Unknown]: Anywhere What is the name of your State or Province? [Unknown]: UT
What is the two-letter country code for this unit? [Unknown]: US
Is CN=localhost, OU=JBCP Calendar, O=JBCP, L=Anywhere, ST=UT, C=US correct? [no]: yes</pre> <p>Most of the values are self-explanatory, but you will want to ensure that the answer to <strong class="bold">What is your first and last name?</strong> is the host that you will be accessing your web application from. This is necessary to ensure that the SSL handshake <span class="No-Break">will succeed.</span></p>
<p>You should now have a file in the current directory named <strong class="source-inline">tomcat.keystore</strong>. You can view its contents using the following command from within the <span class="No-Break">same directory:</span></p>
<pre class="console">
keytool -list -v -keystore tomcat.keystore Enter keystore password: changeit
Keystore type: JKS Keystore provider: SUN
...
Alias name: jbcpcalendar
...
Owner: CN=localhost, OU=JBCP Calendar, O=JBCP, L=Anywhere, ST=UT, C=US Issuer: CN=localhost, OU=JBCP Calendar, O=JBCP, L=Anywhere, ST=UT, C=US</pre> <p>As you may have guessed, it is insecure to use <strong class="source-inline">changeit</strong> as a password, as this is the default password used with many JDK implementations. In a production environment, you should <a id="_idIndexMarker1460"/>use a secure password rather than something as simple <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">changeit</strong></span><span class="No-Break">.</span></p>
<p>For additional information about the <strong class="source-inline">keytool</strong> command, refer to the documentation found on Oracle’s <span class="No-Break">website (</span><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/keytool.xhtml"><span class="No-Break">https://docs.oracle.com/en/java/javase/17/docs/specs/man/keytool.xhtml</span></a><span class="No-Break">).</span></p>
<p>If you are having issues, you might also find the <em class="italic">CAS SSL Troubleshooting and Reference Guide</em> <span class="No-Break">helpful (</span><a href="https://apereo.github.io/cas/7.0.x/installation/Troubleshooting-Guide.xhtml"><span class="No-Break">https://apereo.github.io/cas/7.0.x/installation/Troubleshooting-Guide.xhtml</span></a><span class="No-Break">).</span></p>
<h1 id="_idParaDest-447"><a id="_idTextAnchor657"/>Supplementary materials</h1>
<p>This section contains a listing of additional resources to technologies and concepts that are used throughout <span class="No-Break">the book:</span></p>
<ul>
<li><strong class="bold">Java Development Kit Downloads</strong>: Refer <a id="_idIndexMarker1461"/>to <a href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a> for downloading <span class="No-Break">the JDK.</span></li>
<li><strong class="bold">MVC Architecture</strong>: Refer <a id="_idIndexMarker1462"/><span class="No-Break">to </span><a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller"><span class="No-Break">https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller</span></a><span class="No-Break">.</span></li>
<li><strong class="bold">Spring Security site</strong>: Refer to <a href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a>. You can <a id="_idIndexMarker1463"/>find links to the Spring Security Javadoc, downloads, source code, and reference at <span class="No-Break">this link.</span></li>
<li><strong class="bold">Spring Framework</strong>: Refer to <a href="https://projects.spring.io/spring-framework/">https://projects.spring.io/spring-framework/</a>. You can <a id="_idIndexMarker1464"/>find links to the Spring Framework Javadoc, downloads, source code, and reference from <span class="No-Break">this link.</span></li>
<li><strong class="bold">Spring Boot</strong>: Refer to <a href="https://projects.spring.io/spring-boot/">https://projects.spring.io/spring-boot/</a>. You can find links to <a id="_idIndexMarker1465"/>the Spring Boot Javadoc, downloads, source code, and reference from <span class="No-Break">this link.</span></li>
<li><strong class="bold">Spring Data</strong>: Refer to <a href="https://projects.spring.io/spring-data/">https://projects.spring.io/spring-data/</a>. You can find links to <a id="_idIndexMarker1466"/>the Spring Data Javadoc, downloads, source code, and reference from this link. In this book, we covered three of the sub-projects of Spring Data, including Spring Data JPA (<a href="https://projects.spring.io/spring-data-jpa/">https://projects.spring.io/spring-data-jpa/</a>) and Spring Data <span class="No-Break">MongoDB (</span><a href="https://projects.spring.io/spring-data-mongodb/"><span class="No-Break">https://projects.spring.io/spring-data-mongodb/</span></a><span class="No-Break">).</span></li>
<li><strong class="bold">Maven</strong>: For more <a id="_idIndexMarker1467"/>information about Maven, visit their site at <a href="https://maven.apache.org">https://maven.apache.org</a>. For more information about Maven transitive dependencies, refer to the <em class="italic">Introduction to the Dependency Mechanism</em> documentation <span class="No-Break">at </span><a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.xhtml#Transitive_Dependencies"><span class="No-Break">https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.xhtml#Transitive_Dependencies</span></a><span class="No-Break">.</span></li>
<li><strong class="bold">Building with Gradle</strong>: Spring <a id="_idIndexMarker1468"/>Security builds with <strong class="source-inline">Gradle</strong> (<a href="https://gradle.org">https://gradle.org</a>) instead of <span class="No-Break">using </span><span class="No-Break"><strong class="source-inline">Maven</strong></span><span class="No-Break">.</span></li>
<li><strong class="bold">Object-relational mapping (ORM)</strong>: You <a id="_idIndexMarker1469"/>can find more general information on Wikipedia at <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">https://en.wikipedia.org/wiki/Object-relational_mapping</a>. If you want more hands-on instruction, you may also be interested in the Hibernate (a common Java ORM framework) documentation <span class="No-Break">at </span><a href="https://hibernate.org/"><span class="No-Break">https://hibernate.org/</span></a><span class="No-Break">.</span></li>
</ul>
<p>The following are <span class="No-Break">UI technologies:</span></p>
<ul>
<li><strong class="bold">JSP</strong>: You can <a id="_idIndexMarker1470"/>find more information about JSP on Oracle’s <a id="_idIndexMarker1471"/>site <span class="No-Break">at </span><a href="https://www.oracle.com/technical-resources/articles/javase/servlets-jsp.xhtml"><span class="No-Break">https://www.oracle.com/technical-resources/articles/javase/servlets-jsp.xhtml</span></a><span class="No-Break">.</span></li>
<li><strong class="bold">Thymeleaf</strong>: This is a <a id="_idIndexMarker1472"/>modern, tempting framework that provides an excellent alternative to JSP. An additional benefit is that it provides <a id="_idIndexMarker1473"/>support for both Spring and Spring Security out of the box. You can find more information about Thymeleaf <span class="No-Break">at </span><a href="https://www.thymeleaf.org/"><span class="No-Break">https://www.thymeleaf.org/</span></a><span class="No-Break">.</span></li>
</ul>
</div>
</div></body></html>