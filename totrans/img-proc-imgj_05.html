<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Basic Measurements with ImageJ"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Basic Measurements with ImageJ</h1></div></div></div><p>We saw in the previous chapter how to perform some preprocessing steps that prepared the image data for measurement and analysis. In this chapter, we will take a closer look at the measurement system available in ImageJ. You will also learn how to create some visualizations of movement and dynamics. We will look at the following topics in this chapter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Selections and regions</li><li class="listitem" style="list-style-type: disc">The ROI Manager</li><li class="listitem" style="list-style-type: disc">Kymographs and line profiles</li><li class="listitem" style="list-style-type: disc">Area and line selections</li><li class="listitem" style="list-style-type: disc">Semiquantitative colocalization</li><li class="listitem" style="list-style-type: disc">Particle analysis</li></ul></div><div class="section" title="Selections and regions in ImageJ"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec26"/>Selections and regions in ImageJ</h1></div></div></div><p>We will first look at the tools that<a id="id198" class="indexterm"/> are available in ImageJ to select <span class="strong"><strong>Regions Of Interest</strong></span> (<span class="strong"><strong>ROIs</strong></span>). These tools <a id="id199" class="indexterm"/>can be useful if you wish to only<a id="id200" class="indexterm"/> process a small portion of your image. ROIs <a id="id201" class="indexterm"/>are a very important element in ImageJ, and there is also a specific manager to handle the ROIs: <span class="strong"><strong>ROI Manager</strong></span>. It can <a id="id202" class="indexterm"/>be opened by going to <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>ROI Manager…</strong></span>, which will open the following window:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_01.jpg" alt="Selections and regions in ImageJ"/></div><p>On the left-hand side, there is a list that will contain the ROIs, while on the right-hand side, there are several buttons that will perform certain actions on the ROIs. The checkboxes in the bottom-right corner allow the user to see all the regions at once (<span class="strong"><strong>Show All</strong></span>), while the <span class="strong"><strong>Labels</strong></span> checkbox displays the region label in the image.</p><p>There are different types of region that are supported by ImageJ. They can be divided into two major<a id="id203" class="indexterm"/> types: <span class="strong"><strong>area </strong></span><a id="id204" class="indexterm"/>
<span class="strong"><strong>selections</strong></span> and <span class="strong"><strong>line selections</strong></span>. A third singular type is the <a id="id205" class="indexterm"/>
<span class="strong"><strong>Point ROI</strong></span>, which only has one member. When used for measurements, the parameters that can be measured are slightly different. Area can only be measured with the area type ROIs, while angle can only be measured with line selections.</p><p>First, I will discuss a few of the common selection types that are supported by ImageJ, and then, we will apply them to take measurements.</p><div class="section" title="Area selections"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec36"/>Area selections</h2></div></div></div><p>Area<a id="id206" class="indexterm"/> selections in ImageJ <a id="id207" class="indexterm"/>contain different types with different properties. The<a id="id208" class="indexterm"/> following types are available in ImageJ:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Rectangles</li><li class="listitem" style="list-style-type: disc">Ovals</li><li class="listitem" style="list-style-type: disc">Polygons</li><li class="listitem" style="list-style-type: disc">Freehand</li></ul></div><p>Rectangles are<a id="id209" class="indexterm"/> mostly used to select areas to crop images or for rectangular objects. If your images contain more organic shapes, oval or polygon areas are more suitable. These<a id="id210" class="indexterm"/> types can be added to images by selecting the appropriate tool in the toolbar of the ImageJ program. Then, you can left-click and drag the mouse to enclose the area you wish to select and then release the mouse button. After the selection has been set, you can press the <span class="strong"><strong>Add</strong></span> button on the ROI Manager (or press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>T</em></span>) to add the region to the ROI Manager.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>If the <span class="strong"><strong>Require control/command key for shortcuts</strong></span> option is unchecked when you go to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Options</strong></span> | <span class="strong"><strong>Misc…</strong></span>, then pressing only the letter <span class="emphasis"><em>T</em></span> is sufficient to add the ROI to the Manager.</p></div></div><p>When an ROI is added to the ROI Manager, it can be saved to a file to preserve it for later. When multiple ROIs are added to the ROI Manager and one is selected when attempting to save the ROIs, only the selected ROI will be saved. If you wish to save all the ROIs at once, press <span class="strong"><strong>Deselect</strong></span> to unselect all ROIs. Alternatively, you can use <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>A</em></span> to select all the ROIs, before selecting <span class="strong"><strong>More »</strong></span> | <span class="strong"><strong>Save</strong></span> from the ROI Manager.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>Single ROIs will be saved to the disk as a file with the <code class="literal">.roi</code> extension. Multiple ROIs will be saved as an ROI set in a <code class="literal">.zip</code> file. This zip archive contains individual <code class="literal">.roi</code> files, one for each selection. On Windows, extensions are hidden by default for known file types. So, to see the extensions, you may have to uncheck the <span class="strong"><strong>Hide extensions for known file types</strong></span> option in the folder options.</p></div></div><p>When adding additional ROIs, it may be convenient to select the <span class="strong"><strong>Show All</strong></span> checkbox in the ROI Manager. This will show all the ROIs currently in the list. Clicking on the ROI in the ROI Manager can set the active region. It always shows in the color you have set in the options (refer to, <a class="link" href="ch01.html" title="Chapter 1. Getting Started with ImageJ">Chapter 1</a>, <span class="emphasis"><em>Getting Started with ImageJ</em></span>), with small white squares at the corners:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_02.jpg" alt="Area selections"/></div><p>These small <a id="id211" class="indexterm"/>squares are control points that can be used to move and resize the ROI. If you modify a region by resizing it or positioning it, pressing the <span class="strong"><strong>Update</strong></span> button on the ROI Manager will update the region in the list. To resize, click and drag one of the squares to a new location and release the mouse button. If you hold the <span class="emphasis"><em>Shift</em></span> key while dragging the handles, the shape will become a square or circle with equal width and height. If you hold the <span class="emphasis"><em>Ctrl</em></span> key (or <span class="emphasis"><em>Cmd</em></span> key on a Mac) while clicking on the control points, the region grows in width and height equally around the center. If you hold the <span class="emphasis"><em>Alt</em></span> key while resizing, the handle on the opposite side will stay at a fixed location while you resize the region, keeping the length-to-width proportion equal. If you press the <span class="emphasis"><em>Alt</em></span> key and create an area that overlaps with your previous region, a subtraction of the overlapping <a id="id212" class="indexterm"/>part of the two regions will be formed. Conversely, if you hold the <span class="emphasis"><em>Shift</em></span> key before creating a new region that overlaps a previous region, you will create a union of the overlapping part of the two regions:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_10.jpg" alt="Area selections"/></div><p>A combination of two of the keys can also be pressed while dragging for a combination of both resizing effects. To move a region, move the cursor inside the region and click and drag the region to a new location. Make sure that the cursor is shaped like an arrow—and not like a hand or crosshair—before you click and drag the region. For small regions, you might have to zoom in in order to move the region. If the cursor gets close to the control points, it will change to resize mode.</p><p>Once a region is placed and added to the ROI Manager, pushing the <span class="strong"><strong>Measure</strong></span> button in the ROI Manager or using the <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>M</em></span> keyboard shortcut will measure the region. To select the parameters that are measured, go to <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Set Measurements…</strong></span> to select the parameters:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_03.jpg" alt="Area selections"/></div><p>
<span class="strong"><strong>Mean gray value</strong></span> is<a id="id213" class="indexterm"/> the average intensity within the area, while <span class="strong"><strong>Area</strong></span> measures the area of the region in the units of the image. Once you click on <span class="strong"><strong>Measure</strong></span> in the ROI Manager, a new window with the measurements is opened. This window shows the results. Some of the different measurements will be explained in the <span class="emphasis"><em>Area selections and measurements</em></span> section, where we will use them to extract useful information from our images.</p></div><div class="section" title="Line selections"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec37"/>Line selections</h2></div></div></div><p>The<a id="id214" class="indexterm"/> line selections<a id="id215" class="indexterm"/> contain the following types:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Straight line</li><li class="listitem" style="list-style-type: disc">Segmented line</li><li class="listitem" style="list-style-type: disc">Angle tool</li></ul></div><p>ImageJ handles these selection types in a similar way. However, they can be used for different measurements. One of the most used functions for line segments is to plot a profile along a<a id="id216" class="indexterm"/> line or segmented line. Another option is to create a <span class="strong"><strong>kymograph</strong></span>. Both<a id="id217" class="indexterm"/> these options will be demonstrated in the upcoming sections.</p></div><div class="section" title="Point selections"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec38"/>Point selections</h2></div></div></div><p>The third type of <a id="id218" class="indexterm"/>selection only contains one tool: the point tool. It selects<a id="id219" class="indexterm"/> a single pixel only and is mostly used in counting or marking an object's center point. The advantage of point selection is that it requires only a single click to place it. However, the measurements that can be obtained are limited to the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> coordinates and the intensity.</p></div></div></div>
<div class="section" title="Basic measurements"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec27"/>Basic measurements</h1></div></div></div><p>We will now look at a<a id="id220" class="indexterm"/> few techniques that can be used to measure specific parameters from data. For these measurements, we will use the ROI Manager and several different types of region to select and measure intensities, speed, and other interesting things. Besides measurements, regions can also be used for other purposes relevant to processing and image handling. One useful application of selections is that they can be used to limit certain processing steps to the selected area while leaving the unselected pixels unaffected. A few examples of these applications will be demonstrated as well.</p><div class="section" title="Area selections and measurements"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec39"/>Area selections and measurements</h2></div></div></div><p>We will start<a id="id221" class="indexterm"/> with some basic measurements using area selections. We will use these to measure some basic parameters such as area, perimeter (or circumference), and many more. We will start with the most basic area selection: the rectangle.</p><p>Rectangular <a id="id222" class="indexterm"/>selections are very useful for cropping <a id="id223" class="indexterm"/>image areas. By reducing the size of an image, you reduce the memory required as well as the processing time for complicated algorithms. Another good use for a rectangular selection is to restrict processing in a larger image to a specific region. Some ImageJ algorithms and tools can work within an active selection. We will see an example of this type of application in a plugin that we will develop in <a class="link" href="ch09.html" title="Chapter 9. Creating ImageJ Plugins for Analysis">Chapter 9</a>, <span class="emphasis"><em>Creating ImageJ Plugins for Analysis</em></span>. As a result of the simplicity of the rectangle, measurements, such as area and perimeter are not really relevant. You <a id="id224" class="indexterm"/>can calculate the area and perimeter of a rectangle very easily using the width and height. We will, therefore, focus on some more useful applications of<a id="id225" class="indexterm"/> rectangular selections.</p><p>To start with, let's use the rectangular selection to modify a small section of an image by inverting its gray values. To start with an example, open the <span class="strong"><strong>Blobs</strong></span> image from the sample images. We will invert the LUT for a single blob using these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select a blob in the image using the rectangular selection tool.</li><li class="listitem">After selecting a blob, press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>I</em></span> to invert the LUT.</li><li class="listitem">Use <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>A</em></span> to remove all selections and invert the LUT again using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>I</em></span>.</li></ol></div><p>In this little exercise, we focused on only modifying pixels that were selected, while the pixels outside of the selection were left unchanged. If no pixels were selected, the <span class="strong"><strong>Invert LUT</strong></span> command worked on all pixels. This is an example of how to use area selection to limit processing to selected pixels only. The same method also works for other area selections. You could also use this method to highlight a specific part of an image by making it stand out. For instance, in the following kymograph example, we could show the lines that were acquired during stimulation by creating a square selection and inverting the LUT for only that time period.</p><div class="section" title="Oval selections"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec17"/>Oval selections</h3></div></div></div><p>ImageJ has two types of selection for<a id="id226" class="indexterm"/> rounded shapes: <span class="strong"><strong>ellipses</strong></span> and <span class="strong"><strong>ovals</strong></span>. The difference <a id="id227" class="indexterm"/>between the two types is subtle, but oval selections can only by shaped along the <span class="emphasis"><em>x</em></span> or <span class="emphasis"><em>y</em></span> axis. Ellipses, on the other hand, can be freely rotated as well. To create a circle, hold the <span class="emphasis"><em>Shift</em></span> key while creating an<a id="id228" class="indexterm"/> oval selection to force ImageJ to make a circle with equal width and height. Another important property of oval selections is their shape descriptors. The shape descriptors that ImageJ reports in its measurements are the circularity (Circ.), roundness (Round), aspect ratio (AR), and solidity (Solidity). Circularity is defined as follows:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_15.jpg" alt="Oval selections"/></div><p>Here, <span class="emphasis"><em>A</em></span> is the area, and <span class="emphasis"><em>C</em></span> is the circumference. Roundness is defined as follows:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_16.jpg" alt="Oval selections"/></div><p>Here, the major axis is the largest diameter of an oval. Aspect ratio is the ratio between the major and minor axes of an oval. Solidity is defined as the area divided by the convex hull of the area. Solidity is helpful for irregular shapes. A convex hull is the smallest curve that can be fitted around an object without intersecting with it. It can be seen as trying to stretch an elastic band around the object to encompass it completely. For oval- or ellipse-shaped objects, this parameter does not add any information.</p><p>Let's look<a id="id229" class="indexterm"/> at some of the results when drawing a few ellipses and ovals and measuring their shape descriptors. Here are a few examples of elliptical selections (left of the image) and oval selections (right of the image):</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_04.jpg" alt="Oval selections"/></div><p>The shapes with a circularity of 1.00 are colored orange (ellipse) and light green (oval). The red ellipse has a very low circularity (0.28), while the cyan oval has an intermediate circularity (0.48). This circularity parameter will be useful when trying to detect particles, as it is a very basic description of a shape using a single value. Round objects will have a value of 1, while flattened ovals will have a low value closer to 0.</p><p>It is also possible<a id="id230" class="indexterm"/> to create a doughnut selection using the oval tool. Making two circles, one bigger than the other, and then removing the smaller of the two circles can do this. The following steps will create a doughnut selection:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create the larger circle first over the object you wish to select and press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>T</em></span> to add it to the ROI Manager. Make the size of the circle 20 x 20 pixels.</li><li class="listitem">To create the inner circle, you can add a new circle using the oval tool. However, it may not be centered. To create a centered inner circle, we will select the outer circle and select <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Selection</strong></span> | <span class="strong"><strong>Enlarge…</strong></span> from the menu.</li><li class="listitem">Enter a <a id="id231" class="indexterm"/>value of <code class="literal">-5</code> to shrink the circle to a new circle of 10 x 10 pixels and press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>T</em></span> to add it to the ROI Manager.</li><li class="listitem">To create the doughnut, select both circles in the ROI Manager.</li><li class="listitem">With both circles selected, select <span class="strong"><strong>More »</strong></span> | <span class="strong"><strong>XOR</strong></span> from the ROI Manager. This will result in the doughnut. To add the new selection, press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>T</em></span>.</li></ol></div><p>Note that creating a doughnut this way forces the new area selection to be "pixelated". The outline of the region will be aligned across the pixel grid unlike the ROIs generated by ImageJ. You can also create the doughnut by holding the <span class="emphasis"><em>Alt</em></span> key while creating the inner circle. However, it can be difficult to align both circles properly.</p></div><div class="section" title="Polygon selections"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec18"/>Polygon selections</h3></div></div></div><p>Other types of area selection are polygon and freehand selections. They allow more organic shapes to<a id="id232" class="indexterm"/> be selected. To create a polygon selection, select the tool and by left-clicking, you can add points to the polygon. Each point is connected by a straight line (vertex), and by double-clicking or by left-clicking on the first point, the polygon is closed and turns into an area selection. If you right-click, the polygon tool will add a point at the point where you clicked and close the polygon at the same time. A polygon requires a minimum of three points. This is tool is helpful for selecting irregular shapes, such as in the <span class="strong"><strong>Blobs</strong></span> example:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_11.jpg" alt="Polygon selections"/></div><p>For this type of irregular shape, the polygon tool is more suited to only selecting the blob. A similar effect <a id="id233" class="indexterm"/>can be achieved with the freehand tool. However, it may be more difficult to select very precisely. The freehand tool works by left-clicking and holding the button while you drag the mouse around the shape.</p><p>Another way of creating an irregular area selection is to use the magic wand selection tool. This tool works in the same way as the wand tool in other graphics programs such as Photoshop and Gimp. It selects pixels that have the same intensity or color as the one that was clicked. To select a blob in the sample image, we can follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <span class="strong"><strong>Wand Tool</strong></span> from the toolbar.</li><li class="listitem">Left-click on a blob. This will create a selection.</li><li class="listitem">Change the<a id="id234" class="indexterm"/> tolerance for the selection by double-clicking on the wand tool button and set <span class="strong"><strong>Tolerance</strong></span> to <code class="literal">60</code>. Then, press <span class="strong"><strong>OK </strong></span>(see the following screenshot).</li><li class="listitem">Left-click on the same blob to see the effect of the tolerance setting on the selection:<div class="mediaobject"><img src="graphics/Insert_image_4909_05_12.jpg" alt="Polygon selections"/></div></li></ol></div><p>The wand tool allows us to set a tolerance, which means that values that fall within the tolerance relative to the selected pixel will be included in the selection. A value of <code class="literal">0</code> will only consider pixels that are identical. When enabling thresholding, the tolerance will be ignored (basically, it is set to <code class="literal">0</code>). The mode allows you to use the 4-connected or 8-connected neighbors to determine the selection. The difference between a tolerance of <code class="literal">0</code> (left image) and <code class="literal">60</code> (right image) for the blobs example can be as follows:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_13.jpg" alt="Polygon selections"/></div><p>This tool can be very efficient for selecting organic shapes such as these blobs. However, it requires the contrast between the object (the blobs) and the background to be high. If you set the tolerance higher, in the blobs example for instance, not only is the object selected, but also background. If you try a tolerance value of <code class="literal">150</code> in the blobs example, the selection would still be OK. However, it already includes some background pixels. A tolerance value of<a id="id235" class="indexterm"/> <code class="literal">160</code>, however, would include almost the entire image if you click on one of the blobs' lighter pixels. There is a different way to select organic shapes such as blobs using the particle analyzer, which will be discussed later on.</p></div></div><div class="section" title="Line selections and measurements"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec40"/>Line selections and measurements</h2></div></div></div><p>Besides the<a id="id236" class="indexterm"/> area selection tools for measurements, there are also line selection tools that can be used for measurements. Line selections can be useful to select thin, elongated structures. Brain cells have a basic structure with a cell <a id="id237" class="indexterm"/>body and long, thin processes called <span class="strong"><strong>neurites</strong></span>. Measuring along these thin processes can be done using line selections to determine characteristics such as length. In time series, a line along the neurite will allow for measurement of intensity over time using a specialized visualization of dynamics called a kymograph.</p><div class="section" title="Kymographs"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec19"/>Kymographs</h3></div></div></div><p>A kymograph is a representation of all the pixels along a line for each frame or slice. This type of image shows the<a id="id238" class="indexterm"/> dynamics of objects. Straight lines that run from top to bottom of the image represent static objects, while angled lines indicate movement. The steeper the angle, the faster the object moves. This can be used to measure the velocity of objects. It is also a very <a id="id239" class="indexterm"/>simple visual aid to identify movement in a confined space. This latter point is an important distinction. Any object that starts on the line but leaves it on either side will not be visualized and cannot be measured.</p><p>Let's look at a very basic kymograph of the time series we used in the previous chapter when we normalized a time series. Open the <code class="literal">time_series.tif</code> image in ImageJ. Next, we will trace one of the stretches where many puncta are present. To trace an irregular shape like we have here, we want to select the segmented line region.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Right-click on the line tool in the ImageJ main interface and select <span class="strong"><strong>Segmented Line</strong></span> from the options presented.</li><li class="listitem">Draw a line as indicated in the following image (feel free to take a different stretch).</li><li class="listitem">If you wish to create multiple kymographs, you can add each line to the ROI manager using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>T</em></span>.<div class="mediaobject"><img src="graphics/Insert_image_4909_05_05.jpg" alt="Kymographs"/></div></li></ol></div><p>Make sure that<a id="id240" class="indexterm"/> the line that you draw intersects the puncta and that you stay along their path. As stated earlier, the kymograph will only show what is on the line! As an exercise, you can draw a line<a id="id241" class="indexterm"/> more accurately by first creating a maximum projection and drawing the line there and then transferring it to the time series. To do so, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a maximum<a id="id242" class="indexterm"/> projection by going to <span class="strong"><strong>Image</strong></span> | <span class="strong"><strong>Stacks</strong></span> | <span class="strong"><strong>Z Project…</strong></span> and selecting <span class="strong"><strong>Maximum intensity</strong></span>.</li><li class="listitem">In the new image, select a stretch using the segmented line and add it to the ROI Manager.</li><li class="listitem">Select the original <code class="literal">time_series.tif</code> window.</li><li class="listitem">Transfer the selection by either selecting the added ROI from the ROI Manager or by going to <span class="strong"><strong>Edit | Selection | Restore Selection</strong></span> from the menu. Note that the latter option will only work for the last active selection, while the former option will work for any number of selections.</li></ol></div><p>Now that we have our line, we will create the kymograph by going to <span class="strong"><strong>Image</strong></span> | <span class="strong"><strong>Stacks</strong></span> | <span class="strong"><strong>Reslice [/]…</strong></span> from<a id="id243" class="indexterm"/> the menu. Alternatively, you can press the forward slash key (<span class="emphasis"><em>/</em></span>). If you have a recent version of Fiji, you could also select <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Multi Kymograph</strong></span> | <span class="strong"><strong>Multi Kymograph </strong></span>to create a kymograph. When<a id="id244" class="indexterm"/> using the <span class="strong"><strong>Reslice</strong></span> option, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure that the line is the active selection by selecting it in the ROI Manager.</li><li class="listitem">Select <span class="strong"><strong>Image</strong></span> | <span class="strong"><strong>Stacks</strong></span> | <span class="strong"><strong>Reslice</strong></span> from the menu or press the forward slash key.</li><li class="listitem">Select the <span class="strong"><strong>Avoid interpolation</strong></span> checkbox and press <span class="strong"><strong>OK</strong></span>.</li></ol></div><p>After pressing <span class="strong"><strong>OK</strong></span>, a new image opens. It has a width equal to the length of the line and a height equal to the number of frames (600). Here are the first 300 lines from the earlier selection:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_06.jpg" alt="Kymographs"/></div><p>When using Fiji, using the <a id="id245" class="indexterm"/>
<span class="strong"><strong>Multi Kymograph</strong></span> tool that is located in the <span class="strong"><strong>Analyze</strong></span> menu can generate the<a id="id246" class="indexterm"/> same effect. This plugin has an additional feature that allows you to average a few pixels along the line's length. This will reduce the effects of noise along the line by averaging<a id="id247" class="indexterm"/> pixel intensities. To use this plugin, use these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select line selection in the ROI Manager.</li><li class="listitem">Select <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Multi Kymograph</strong></span> | <span class="strong"><strong>Multi Kymograph</strong></span> from the menu.</li><li class="listitem">Enter a value for line thickness: a value larger than 1 will create an average, in this case use 3 and press <span class="strong"><strong>OK</strong></span>.</li></ol></div><p>The kymograph clearly shows that some of the puncta are moving, while others are more static. Depending on the line you drew, you should get more or less the same result, although some areas have less movement. As this selection was a single line, it is also clear from this example that some of the puncta move in a different direction than others.</p><p>To measure velocity in a kymograph (remember that velocity is distance divided by time), all we have to do is draw a single line across each section that is not vertical. Vertical lines have zero distance and, therefore, a velocity of 0. To make it a little easier to do the calculations, we will first change the calibration of the image (refer to <a class="link" href="ch02.html" title="Chapter 2. Basic Image Processing with ImageJ">Chapter 2</a>, <span class="emphasis"><em>Basic Image Processing with ImageJ,</em></span> for details on how to do this). Set the pixel width to <code class="literal">266.67</code> and the pixel height to <code class="literal">0.125</code>. The unit can be set to pixel. What we do here is specify that the <a id="id248" class="indexterm"/>width (<span class="emphasis"><em>x</em></span> coordinates) is in nanometers, while the height (<span class="emphasis"><em>y</em></span> coordinates) is in seconds. ImageJ does not fully support this notion, but this will function for our purposes nonetheless.</p><p>To perform the <a id="id249" class="indexterm"/>measurement, proceed as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <span class="strong"><strong>Straight Line</strong></span> tool and draw a line through the center of a track for as long as the line stays in the middle of that track.</li><li class="listitem">Make sure that the <span class="strong"><strong>Bounding box</strong></span> option is selected in your measurements.</li><li class="listitem">Press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>M</em></span> to measure the current selection, which will be added to your results.</li><li class="listitem">Measure the next part of the track by dragging the top handle of your line to the next point where the track starts to change velocity and measure again.</li><li class="listitem">Repeat this process until the track disappears from the kymograph.</li></ol></div><p>As the <span class="strong"><strong>Bounding box</strong></span> option was selected, you will have four columns in your results table, labeled <span class="strong"><strong>BX</strong></span>, <span class="strong"><strong>BY</strong></span>, <span class="strong"><strong>Width</strong></span>, and <span class="strong"><strong>Height</strong></span>. For velocity measurements, we only require the width and height parameters. The width is equal to the distance that was traveled, while the height is equal to the time spent traveling. To get the correct value for velocity, we will divide the width by the height to get the velocity, expressed in <span class="emphasis"><em>nm/sec</em></span> with the calibration mentioned earlier.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>This method of calculating the velocity for moving particles is not very difficult, but it is very time consuming and error prone. Also, kymographs are not suited for objects that travel in arbitrary directions in space (that is, not along a line). So, for that type of object and for a more detailed approach to tracking the movement of objects, we will revisit this topic in a later chapter.</p></div></div></div><div class="section" title="Line profiles"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec20"/>Line profiles</h3></div></div></div><p>In the previous<a id="id250" class="indexterm"/> section, we saw what we can do using a simple line selection and a time series for quantification. Line selections can also be used for single images, especially when quantifying features <a id="id251" class="indexterm"/>related to intensity, (co) localization, and intactness. For these types of assessment, we would like to know the intensity profile of an object. To create an intensity profile, we can use a straight line or a segmented line selection.</p><p>In the following example, we will look at the distribution of rings within a section of a tree. When trees grow, they add a ring every year of young wood. The thicker a ring is, the faster the tree grows, indicating favorable conditions for growth (sunlight, mild temperatures, rainfall, soil conditions, and so on). For this kind of analysis, we need to know two things: the number of rings and the thickness of each ring.</p><p>To start with, open the <span class="strong"><strong>Tree Rings</strong></span> image from <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Samples</strong></span>. The image that opens shows a partial section of a tree, with the tree center at location (<code class="literal">135,54</code>), approximately. The rings can be seen as white areas separated by dark lines. Each dark line is the boundary of a growth ring. When you zoom in on the center of the tree, it is immediately apparent that the rings are not equal in width. The fourth ring, for instance, is quite thin, while<a id="id252" class="indexterm"/> the fifth ring is five times thicker. For the analysis, we could use the same strategy that we used for the kymograph. We could draw a line from dark border to border and measure the length each time. This has a very big drawback. It is very time consuming (again), and it will be difficult to keep the line straight. Measuring the width of each ring should be based on the shortest distance between each ring border.</p><p>To create a<a id="id253" class="indexterm"/> line profile, select a line across a section of the image that you wish to profile and go to <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Plot Profile</strong></span> from the menu (or press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>K</em></span>):</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_07.jpg" alt="Line profiles"/></div><p>This shows the line profile at the bottom of the figure across the line in the image. It shows the intensity along the line's pixels. The plot profile window also has an option to show a live updating plot. This means that when the region is moved or resized, the plot is updated immediately. Each of the low points in the profile indicates a tree ring border. When we press the <span class="strong"><strong>List</strong></span> button in the <span class="strong"><strong>Plot Profile</strong></span> window, a window opens with intensity values for each pixel along the line. If we copy this to a spreadsheet program, we can calculate the distance between each valley to determine the width of each ring in pixels (without calibrating the image, the real width in practical units is unknown). The number of valleys gives the number of years.</p><p>Alternatively, it is<a id="id254" class="indexterm"/> possible to measure the widths of the rings using the profile plot as shown earlier. To do this, we must draw a segmented line on the profile plot. Every graphics window (text and results windows excluded) in ImageJ can be used to draw selections. For this example, it is important to disable grid lines in the profile plot before creating<a id="id255" class="indexterm"/> the profile plot. This can be done by unchecking the <span class="strong"><strong>Draw grid lines</strong></span> checkbox in the profile plot settings, which can be found by selecting <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Options</strong></span> | <span class="strong"><strong>Profile Plot Options…</strong></span> from the menu.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Draw a segmented line from the lowest point of each valley starting from the left-hand side.</li><li class="listitem">Set the foreground color to black using the color picker and draw the line using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span> or by going to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Draw</strong></span> from the menu.</li><li class="listitem">Make sure that your measurement settings include the <span class="strong"><strong>Bounding rectangle</strong></span> option.</li><li class="listitem">Select the wand tool to measure the area underneath the graph. To measure the width of a tree ring, click with the wand tool above your segmented line, but below the black line of the graph. This will select the white pixels of the chart, which is continuous up to the black line of the graph. You will see that only the section underneath the graph until your segmented line selection is selected (see the following image).</li><li class="listitem">When you press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>M</em></span> to measure this selection, you will get the width and height for the selection.<div class="mediaobject"><img src="graphics/Insert_image_4909_05_14.jpg" alt="Line profiles"/></div></li></ol></div><p>The width measurement will be the thickness of the tree ring. By doing this for each area between the valleys, you can measure the thickness of each ring. Note that if the area underneath the graph <a id="id256" class="indexterm"/>is meaningful for your measurements, then selecting <span class="strong"><strong>Area</strong></span> in your measurement options would give you this parameter as well. A similar method is used when<a id="id257" class="indexterm"/> analyzing electrophoresis gels and western blots. For this purpose, ImageJ has a special collection of tools to analyze gels. These tools can be found by going to <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Gels</strong></span>, with an explanation of how to use<a id="id258" class="indexterm"/> it at <a class="ulink" href="http://imagej.nih.gov/ij/docs/guide/146-30.html#toc-Subsection-30.13">http://imagej.nih.gov/ij/docs/guide/146-30.html#toc-Subsection-30.13</a> and a video explaining<a id="id259" class="indexterm"/> it at <a class="ulink" href="http://imagejdocu.tudor.lu/doku.php?id=video:analysis:gel_quantification_analysis">http://imagejdocu.tudor.lu/doku.php?id=video:analysis:gel_quantification_analysis</a>.</p></div></div></div>
<div class="section" title="Colocalization"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec28"/>Colocalization</h1></div></div></div><p>In the previous <a id="id260" class="indexterm"/>sections, we looked at ways to measure certain aspects of our images, such as velocity and length. This section will look at a different aspect of measurements that involve the colocalization of different signals. Colocalization means that two (or more) objects are within proximity of each other. Whenever two signals overlap in space, we can conclude that they are at the same location, within the boundaries of the resolution that an imaging system allows us. In biology, the localization of two labeled structures or proteins provides clues to whether the protein is contained within a structure or whether it moves to a certain location after being stimulated. For<a id="id261" class="indexterm"/> dynamic structures such as cells, we can observe a change in the amount of colocalization, depending on time or stimulation.</p><div class="section" title="Semiquantitative colocalization"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec41"/>Semiquantitative colocalization</h2></div></div></div><p>Semiquantitative colocalization means that you examine the amount of colocalization by eye or using a crude measurement and classify it (rather arbitrarily) as colocalized or not. This can be a very good<a id="id262" class="indexterm"/> place to start off. However, it is very difficult to conclude anything if the results are not black and white. For this type of colocalization, we only require an image for each signal, and we need to merge them to see the colocalization. This is sometimes done automatically when we acquire images, and sometimes, images need to be merged by hand. To merge two different images, a few prerequisites need to be met:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Images need to be the same size (<span class="emphasis"><em>X</em></span>, <span class="emphasis"><em>Y</em></span>, and optionally <span class="emphasis"><em>Z</em></span> or <span class="emphasis"><em>T</em></span>)</li><li class="listitem" style="list-style-type: disc">Images need to be the same type (8-bit, 16-bit, and so on)</li><li class="listitem" style="list-style-type: disc">Images cannot be moved between each channel's acquisition</li></ul></div><p>If these conditions are met, then the result of the colocalization should provide a qualitative result.</p><p>To merge two channels, go to <span class="strong"><strong>Image</strong></span> | <span class="strong"><strong>Color</strong></span> | <span class="strong"><strong>Merge Channels…</strong></span> from the menu. Currently, ImageJ supports merging seven different images into a single multichannel image using seven different LUTs: red, green, blue, gray, cyan, magenta, and yellow. The most frequently used combination is <span class="strong"><strong>Red/Green</strong></span>, where colocalization results in yellow pixels. Another good combination of colors is <span class="strong"><strong>Green/Magenta</strong></span>, with colocalization showing as white pixels. The latter option is recommended for publications, as people with color-blindness can still appreciate the colocalization. Note that if one channel has very low intensities and the other channel has high intensities, the human visual system will only perceive the brighter channel. For a good visualization of colocalization, both channels need a similar distribution of gray values. The respective histograms should look similar.</p><p>A simple way to quantify this colocalization in a rudimentary way is to look at the overlap of bright pixels. To do this, we can take a threshold for each channel and create a mask for each image. To look at the overlap, we can use the image calculator to perform an <code class="literal">AND</code> operation. Overlap of pixels is classified as pixels that are 1 (technically, 255) at the same location in both images. After performing this <code class="literal">AND</code> operation, we can determine the amount of overlap by counting the number of white pixels in the resulting image. A simple way to do this is by taking the histogram by pressing <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>H</em></span> and then pressing the <span class="strong"><strong>List</strong></span> button in the resulting histogram window. By looking at the value for 255 (at the bottom of the list), you will get a count for the number of pixels that overlap. We will revisit this topic in <a class="link" href="ch08.html" title="Chapter 8. Anatomy of ImageJ Plugins">Chapter 8</a>, <span class="emphasis"><em>Anatomy of ImageJ Plugins</em></span>, where we will apply more rigorous quantification <a id="id263" class="indexterm"/>using some of the plugins supplied with Fiji.</p></div></div>
<div class="section" title="Particle analysis"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec29"/>Particle analysis</h1></div></div></div><p>This section <a id="id264" class="indexterm"/>will look at the methods available for particle analysis, a field that deals with detecting multiple (similar) objects within an image, with the purpose of segmenting and quantifying them. Many problems can be defined as a particle system, which consists of many individual cells within a single image, holes in a surface, detecting cars on a road, and so on. The basic particle analysis step is detecting or segmenting the particles in a single image.</p><div class="section" title="Preprocessing and preparations"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec42"/>Preprocessing and preparations</h2></div></div></div><p>To detect particles, they<a id="id265" class="indexterm"/> first need to be separated from the background. To do this, we need to create a mask that isolates all the objects from the background. We <a id="id266" class="indexterm"/>already saw how to set a threshold in the previous chapter and how to use it to create a mask. This mask image will be used for particle analysis. For this example, we will use a relatively simple example. Open the <span class="strong"><strong>Blobs</strong></span> image by going to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Samples</strong></span> in the ImageJ menu. When the image opens, go to <span class="strong"><strong>Image</strong></span> | <span class="strong"><strong>Adjust</strong></span> | <span class="strong"><strong>Threshold…</strong></span> and set the threshold using the <span class="strong"><strong>Auto</strong></span> button. Make sure that <span class="strong"><strong>Dark background</strong></span> box is not checked. You should now see something similar to the following image:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_08.jpg" alt="Preprocessing and preparations"/></div><p>The red areas indicate<a id="id267" class="indexterm"/> the foreground, which are our potential particles, while everything else will be<a id="id268" class="indexterm"/> ignored. The goal will now be to segment the particles based on two main characteristics: their shape and size. We will finish this step by creating the mask by selecting <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Selection</strong></span> | <span class="strong"><strong>Create Mask</strong></span> from the menu (the mask is the image on the right-hand side).</p><p>Before we start detecting the particles, we first need to know a few things about them. We need to know the size of the particles. There are two simple ways of determining the size of all the particles within this image, and we will start with the most straightforward one. To determine the size of a specific particle, we will just draw a region around it and measure it. In the section on area measurements, we used polygon selection to measure the area and shape descriptors. For particle analysis, we need to determine what the smallest particle is that we may still consider a real particle.</p><p>To get started, let's take the particle at (103,111) as the smallest real particle. After drawing a polygon around it, you may get an area of 363 pixels and a circularity of 0.9188. If we take a less circular particle, for instance at (133,83), we get an area of 434 and a circularity of 0.7329. Let's take the minimum value for each parameter of these two observations, giving us a minimum area of 363 pixels and a minimum circularity of 0.7329 to continue with. We can now perform particle analysis by selecting <span class="strong"><strong>Analyze</strong></span> | <span class="strong"><strong>Analyze Particles…</strong></span> from the menu. Enter the following parameters in the dialog that opens:</p><div class="mediaobject"><img src="graphics/Insert_image_4909_05_09.jpg" alt="Preprocessing and preparations"/></div><p>The size is the<a id="id269" class="indexterm"/> range of sizes that will be counted as particles, measured in square pixels (area). The circularity range that we found is now defined as the particles<a id="id270" class="indexterm"/> that are round or more round than our estimate. For the <span class="strong"><strong>Show</strong></span> option, you can select multiple output types, including outlines. When you use the <span class="strong"><strong>Add to Manager</strong></span> option, this output is not really required anymore and can be set to <span class="strong"><strong>Nothing</strong></span>. When you do not wish to measure particles that are only partially in the image, you must select the <span class="strong"><strong>Exclude on edges</strong></span> option. In <a class="link" href="ch09.html" title="Chapter 9. Creating ImageJ Plugins for Analysis">Chapter 9</a>, <span class="emphasis"><em>Creating ImageJ Plugins for Analysis</em></span>, we will look at an implementation of particle analysis in a time series.</p><p>After clicking on <span class="strong"><strong>OK</strong></span>, the particles will be added to the ROI Manager, at which point, segmenting the particles is completed. We can now measure the particles using the same methods for any other area selection that we looked at in the earlier sections. Another way of setting the parameters for area and circularity is to run the particle analysis, but without restrictions on either the size or circularity parameter. This will detect every particle<a id="id271" class="indexterm"/> within the image, and the results can be filtered after the segmentation. Both methods should give you similar results, with an equal <a id="id272" class="indexterm"/>amount of work.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec30"/>Summary</h1></div></div></div><p>In this chapter, we saw some methods to measure parameters within images and time series. We used some of the techniques used in the previous chapters to extract data from our images. You learned how to visualize dynamic data in a single image (kymographs). We looked at colocalization in a qualitative way, as a prelude to quantitative analysis later on in the book. Finally, we looked at particle analysis as a way to detect similar objects within a single image.</p><p>In the next chapter, you will use some of the techniques that you learned and apply them in macros to increase your efficiency.</p></div></body></html>