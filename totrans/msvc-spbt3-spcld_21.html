<html><head></head><body>
<div id="book-content">
<div id="sbo-rt-content"><div id="_idContainer550" class="Basic-Text-Frame">
    <h1 class="chapterNumber">21</h1>
    <h1 id="_idParaDest-519" class="chapterTitle">Installation Instructions for macOS</h1>
    <p class="normal">In this chapter, we will learn how to set up the tools required to run the commands described in this book on macOS. We will also learn how to get access to the source code of the book.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="bulletList">Technical requirements</li>
      <li class="bulletList">Installing tools</li>
      <li class="bulletList">Accessing the source code</li>
    </ul>
    <div class="packt_tip">
      <p class="normal">If you are using a Windows PC, you should follow the instructions in <em class="chapterRef">Chapter 22</em>, <em class="italic">Installation Instructions for Microsoft Windows with WSL 2 and Ubuntu</em>.</p>
    </div>
    <h1 id="_idParaDest-520" class="heading-1">Technical requirements</h1>
    <p class="normal">All of the commands described in this book are run on a MacBook Pro with macOS Ventura and use <strong class="keyWord">bash</strong>, a command shell. All commands have been verified on both an Intel and Apple silicon-based MacBook Pro.</p>
    <p class="normal">If you are using another shell, such as <strong class="keyWord">zsh</strong>, I recommend that you switch to bash before running commands from this book using this command:</p>
    <pre class="programlisting con"><code class="hljs-con">/bin/bash
</code></pre>
    <h1 id="_idParaDest-521" class="heading-1">Installing tools</h1>
    <p class="normal">In this section, we will learn <a id="_idIndexMarker1539"/>how to install and configure the tools. Here is a list of the tools we will install, with a link to more information on downloading and installation, if required:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Git</strong>: <a href="https://git-scm.com/downloads"><span class="url">https://git-scm.com/downloads</span></a></li>
      <li class="bulletList"><strong class="keyWord">Docker Desktop for Mac</strong>: <a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac/"><span class="url">https://hub.docker.com/editions/community/docker-ce-desktop-mac/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Java</strong>: <a href="https://adoptium.net/installation"><span class="url">https://adoptium.net/installation</span></a> </li>
      <li class="bulletList"><strong class="keyWord">curl</strong>: <a href="https://curl.haxx.se/download.html"><span class="url">https://curl.haxx.se/download.html</span></a></li>
      <li class="bulletList"><strong class="keyWord">jq</strong>: <a href="https://stedolan.github.io/jq/download/"><span class="url">https://stedolan.github.io/jq/download/</span></a></li>
      <li class="bulletList"><strong class="keyWord">The Spring Boot CLI</strong>: <a href="https://docs.spring.io/spring-boot/docs/3.0.4/reference/html/getting-started.html#getting-started.installing.cli"><span class="url">https://docs.spring.io/spring-boot/docs/3.0.4/reference/html/getting-started.html#getting-started.installing.cli</span></a><span class="url"> </span></li>
      <li class="bulletList"><strong class="keyWord">Siege</strong>: <a href="https://github.com/JoeDog/siege#where-is-it"><span class="url">https://github.com/JoeDog/siege#where-is-it</span></a></li>
      <li class="bulletList"><strong class="keyWord">Helm</strong>: <a href="https://helm.sh/docs/intro/install/"><span class="url">https://helm.sh/docs/intro/install/</span></a></li>
      <li class="bulletList"><strong class="keyWord">kubectl</strong>: <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/"><span class="url">https://kubernetes.io/docs/tasks/tools/install-kubectl-macos/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Minikube</strong>: <a href="https://minikube.sigs.k8s.io/docs/start/"><span class="url">https://minikube.sigs.k8s.io/docs/start/</span></a></li>
      <li class="bulletList"><strong class="keyWord">Istioctl</strong>: <a href="https://istio.io/latest/docs/setup/getting-started/#download"><span class="url">https://istio.io/latest/docs/setup/getting-started/#download</span></a></li>
    </ul>
    <p class="normal">The following versions have been used when writing this book:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Git</strong>: v2.37.1</li>
      <li class="bulletList"><strong class="keyWord">Docker Desktop for Mac</strong>: v4.12.0</li>
      <li class="bulletList"><strong class="keyWord">Java</strong>: v17.0.6</li>
      <li class="bulletList"><strong class="keyWord">curl</strong>: v7.86.0</li>
      <li class="bulletList"><strong class="keyWord">jq</strong>: v1.6</li>
      <li class="bulletList"><strong class="keyWord">Spring Boot CLI</strong>: v3.0.4</li>
      <li class="bulletList"><strong class="keyWord">Siege</strong>: v4.1.6</li>
      <li class="bulletList"><strong class="keyWord">Helm</strong>: v3.11.1</li>
      <li class="bulletList"><strong class="keyWord">kubectl</strong>: v1.26.1</li>
      <li class="bulletList"><strong class="keyWord">Minikube</strong>: v1.29.0</li>
      <li class="bulletList"><strong class="keyWord">Istioctl</strong>: v1.17.0</li>
    </ul>
    <p class="normal">Most of the tools <a id="_idIndexMarker1540"/>will be installed using the <strong class="keyWord">Homebrew</strong> package manager (<a href="https://brew.sh/"><span class="url">https://brew.sh/</span></a>), so we <a id="_idIndexMarker1541"/>will start by installing Homebrew. After that, we will install most of the tools using Homebrew and wrap up by installing the remaining tools.</p>
    <p class="normal">For tools where control is required over the version that is installed – not just installing the latest available – I find Homebrew insufficient. When it comes to <code class="inlineCode">minikube</code>, <code class="inlineCode">kubectl</code>, and <code class="inlineCode">istioctl</code>, it is important to install versions that are compatible with each other, specifically when it comes to the versions of Kubernetes that they support. Simply installing and upgrading to the latest versions can lead to situations where incompatible versions of <code class="inlineCode">minikube</code>, Kubernetes, and Istio are used.</p>
    <div class="note">
      <p class="normal">For supported <a id="_idIndexMarker1542"/>Kubernetes <a id="_idIndexMarker1543"/>versions when it comes to Istio, see <a href="https://istio.io/latest/about/supported-releases/#support-status-of-istio-releases"><span class="url">https://istio.io/latest/about/supported-releases/#support-status-of-istio-releases</span></a>. For <code class="inlineCode">minikube</code>, see <a href="https://minikube.sigs.k8s.io/docs/handbook/config/#selecting-a-kubernetes-version"><span class="url">https://minikube.sigs.k8s.io/docs/handbook/config/#selecting-a-kubernetes-version</span></a>.</p>
    </div>
    <h2 id="_idParaDest-522" class="heading-2">Installing Homebrew</h2>
    <p class="normal">If you don’t have <a id="_idIndexMarker1544"/>Homebrew installed already, you can install it with the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
</code></pre>
    <div class="packt_tip">
      <p class="normal">Installing Homebrew also installs the command-line tools for <strong class="keyWord">Xcode</strong>, if they are not already installed, so it might take a while.</p>
    </div>
    <p class="normal">Verify the <a id="_idIndexMarker1545"/>installation of Homebrew with the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">brew --version
</code></pre>
    <p class="normal">Expect a response such as the following:</p>
    <pre class="programlisting con"><code class="hljs-con">Homebrew 4.0.1
</code></pre>
    <h2 id="_idParaDest-523" class="heading-2">Using Homebrew to install tools</h2>
    <p class="normal">On macOS, <code class="inlineCode">curl</code> is already pre-installed and <code class="inlineCode">git</code> was installed as part of the installation of the command-line <a id="_idIndexMarker1546"/>tools for Xcode, required by Homebrew. Homebrew can be used to install Docker, Java, jq, the Spring Boot CLI, Helm, and Siege with the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">brew tap spring-io/tap &amp;&amp; \
brew tap homebrew/cask-versions &amp;&amp; \brew install --cask temurin17 &amp;&amp; \
brew install jq &amp;&amp; \
brew install spring-boot &amp;&amp; \
brew install helm &amp;&amp; \
brew install siege &amp;&amp; \
brew install --cask docker
</code></pre>
    <div class="note">
      <p class="normal">Brew installs the tools in different folders on Intel and Apple silicon-based Macs, in <code class="inlineCode">/usr/local</code> and <code class="inlineCode">/opt/homebrew</code> respectively.</p>
      <p class="normal">Java is installed <a id="_idIndexMarker1547"/>using the distribution called <strong class="keyWord">Eclipse Temurin</strong>; for more information, see <a href="https://adoptium.net/temurin/"><span class="url">https://adoptium.net/temurin/</span></a>.</p>
    </div>
    <h2 id="_idParaDest-524" class="heading-2">Install tools without Homebrew</h2>
    <p class="normal">When it <a id="_idIndexMarker1548"/>comes to installing <code class="inlineCode">minikube</code>, <code class="inlineCode">kubectl</code>, and <code class="inlineCode">istioctl</code>, we will avoid using <code class="inlineCode">brew</code> for improved control over what versions we install. The commands look slightly different on Intel and Apple silicon-based Macs, so will go through them separately.</p>
    <h3 id="_idParaDest-525" class="heading-3">Install tools on an Intel-based Mac</h3>
    <p class="normal">To install <a id="_idIndexMarker1549"/>the <code style="font-weight: bold;" class="codeHighlighted">kubectl</code> version used in this book, run the <a id="_idIndexMarker1550"/>following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -LO "https://dl.k8s.io/release/v1.26.1/bin/darwin/amd64/kubectl"
sudo install kubectl /usr/local/bin/kubectl
rm kubectl
</code></pre>
    <p class="normal">To install the <code class="inlineCode">minikube</code> version used in this book, run the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -LO https://storage.googleapis.com/minikube/releases/v1.29.0/minikube-darwin-amd64
sudo install minikube-darwin-amd64 /usr/local/bin/minikube
rm minikube-darwin-amd64
</code></pre>
    <p class="normal">To install the<code class="inlineCode"> istioctl</code> version used in this book, run the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.17.0 TARGET_ARCH=x86_64 sh -
sudo install istio-1.17.0/bin/istioctl /usr/local/bin/istioctl
rm -r istio-1.17.0
</code></pre>
    <h3 id="_idParaDest-526" class="heading-3">Install tools on an Apple silicon-based Mac</h3>
    <p class="normal">To install <a id="_idIndexMarker1551"/>the <code style="font-weight: bold;" class="codeHighlighted">kubectl</code> version used in this book, run the <a id="_idIndexMarker1552"/>following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -LO "https://dl.k8s.io/release/v1.26.1/bin/darwin/arm64/kubectl"
sudo install kubectl /usr/local/bin/kubectl
rm kubectl
</code></pre>
    <p class="normal">To install the <code class="inlineCode">minikube</code> version used in this book, run the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -LO https://storage.googleapis.com/minikube/releases/v1.29.0/minikube-darwin-arm64
sudo install minikube-darwin-arm64 /usr/local/bin/minikube
rm minikube-darwin-arm64
</code></pre>
    <p class="normal">To install the <code class="inlineCode">istioctl</code> version used in this book, run the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.17.0 TARGET_ARCH=arm64 sh -
sudo install istio-1.17.0/bin/istioctl /usr/local/bin/istioctl
rm -r istio-1.17.0
</code></pre>
    <div class="note">
      <p class="normal">If you want to use the latest versions, with the risk of incompatible versions as described above, you should be able to install <code style="font-weight: bold;" class="codeHighlighted">minikube</code>, <code style="font-weight: bold;" class="codeHighlighted">kubectl</code>, and <code style="font-weight: bold;" class="codeHighlighted">istioctl</code> with Homebrew using the following commands:</p>
      <pre class="programlisting con"><code class="hljs-con">brew install kubernetes-cli &amp;&amp; \&lt;
brew install istioctl &amp;&amp; \&lt;
brew install minikube
</code></pre>
    </div>
    <p class="normal">With the tools installed, we need to take some post-installation actions before we can verify the installations.</p>
    <h2 id="_idParaDest-527" class="heading-2">Post-installation actions</h2>
    <p class="normal">We need <a id="_idIndexMarker1553"/>to take some actions after installing Java and Docker to make them work properly:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1"><strong class="keyWord">Java</strong></li>
    </ol>
    <p class="normal">Add a command to your login script to set up the <code class="inlineCode">JAVA_HOME</code> environment variable:</p>
    <pre class="programlisting con"><code class="hljs-con">echo 'export JAVA_HOME=$(/usr/libexec/java_home -v17)' &gt;&gt; ~/.bash_profile 
</code></pre>
    <div class="note">
      <p class="normal">If you are not using <code class="inlineCode">~/.bash_profile</code> as your login script, you need to replace it with the login script you use, for example, <code class="inlineCode">~/.zshrc</code>.</p>
    </div>
    <p class="normal">Apply the settings in your current terminal session:</p>
    <pre class="programlisting con"><code class="hljs-con">source ~/.bash_profile
</code></pre>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2"><strong class="keyWord">Docker</strong></li>
    </ol>
    <p class="normal">To be able to run the examples in this book, it is recommended that you configure Docker so that it can use most of the CPUs except a few (allocating all CPUs to Docker can make the computer unresponsive when tests are running) and 10 GB of memory, if available. The initial chapters will work fine with less memory allocated, for example, 6 GB. But the more features we add later in the book, the more memory will be required by the Docker host to be able to run all the microservices smoothly.</p>
    <p class="normal">Before we can configure Docker, we must ensure that the Docker daemon is running. You can start Docker as you start any application on a Mac, for example, by using <strong class="keyWord">Spotlight</strong> or opening the <code class="inlineCode">Application</code> folder in <strong class="keyWord">Finder</strong> and starting it from there.</p>
    <p class="normal">To configure Docker, click on the Docker icon in the status bar and select <strong class="screenText">Preferences…</strong>. Go to the <strong class="screenText">Resources</strong> tab in the <strong class="screenText">Preferences</strong> settings for Docker and set <strong class="screenText">CPUs</strong> and <strong class="screenText">Memory</strong>, as illustrated by the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B19825_21_01.png" alt="A screenshot of a computer  Description automatically generated" width="812" height="567"/></figure>
    <p class="packt_figref">Figure 21.1: Docker Desktop resource configuration</p>
    <p class="normal">If you don’t <a id="_idIndexMarker1554"/>want to start Docker manually after a system startup, you can go to the <strong class="screenText">General</strong> tab and select the <strong class="screenText">Start Docker Desktop when you log in</strong> option, as shown in the screenshot below:</p>
    <figure class="mediaobject"><img src="../Images/B19825_21_02.png" alt="A screenshot of a computer  Description automatically generated with medium confidence" width="812" height="564"/></figure>
    <p class="packt_figref">Figure 21.2: Docker Desktop general configuration</p>
    <p class="normal">Finalize the configuration by clicking on the <strong class="screenText">Apply &amp; Restart</strong> button.</p>
    <p class="normal">With the post-installation actions performed, we can verify that the tools are installed as expected.</p>
    <h2 id="_idParaDest-528" class="heading-2">Verifying the installations</h2>
    <p class="normal">To verify <a id="_idIndexMarker1555"/>the tool installations, run the following commands to print each tool’s version:</p>
    <pre class="programlisting con"><code class="hljs-con">git version &amp;&amp; \
docker version -f json | jq -r .Client.Version &amp;&amp; \
java -version 2&gt;&amp;1 | grep "openjdk version" &amp;&amp; \
curl --version | grep "curl" | sed 's/(.*//' &amp;&amp; \
jq --version &amp;&amp; \
spring --version &amp;&amp; \
siege --version 2&gt;&amp;1 | grep SIEGE &amp;&amp; \
helm version --short &amp;&amp; \
kubectl version --client -o json | jq -r .clientVersion.gitVersion &amp;&amp; \
minikube version | grep "minikube" &amp;&amp; \
istioctl version --remote=false
</code></pre>
    <p class="normal">These commands will return output like the following:</p>
    <figure class="mediaobject"><img src="../Images/B19825_21_03.png" alt="" role="presentation" width="422" height="319"/></figure>
    <p class="packt_figref">Figure 21.3: Versions used</p>
    <p class="normal">With the tools <a id="_idIndexMarker1556"/>installed and verified, let’s see how we can access the source code for this book.</p>
    <h1 id="_idParaDest-529" class="heading-1">Accessing the source code</h1>
    <p class="normal">The source code for this book can be found in the GitHub repository: <a href="https://github.com/PacktPublishing/Microservices-with-Spring-Boot-and-Spring-Cloud-Third-Edition"><span class="url">https://github.com/PacktPublishing/Microservices-with-Spring-Boot-and-Spring-Cloud-Third-Edition</span></a>.</p>
    <p class="normal">To be able to <a id="_idIndexMarker1557"/>run the commands that are described in this book, download the source code to a folder and set up an environment variable, <code class="inlineCode">$BOOK_HOME</code>, that points to that folder. </p>
    <p class="normal">Sample commands are as follows:</p>
    <pre class="programlisting con"><code class="hljs-con">export BOOK_HOME=~/Documents/Microservices-with-Spring-Boot-and-Spring-Cloud-Third-Edition 
git clone https://github.com/PacktPublishing/Microservices-with-Spring-Boot-and-Spring-Cloud-Third-Edition.git $BOOK_HOME
</code></pre>
    <p class="normal">The Java source code is written for Java SE 8 and uses a Java SE 17 JRE when executed in Docker containers. The following versions of Spring are used:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Spring Framework</strong>: 6.0.6</li>
      <li class="bulletList"><strong class="keyWord">Spring Boot</strong>: 3.0.4</li>
      <li class="bulletList"><strong class="keyWord">Spring Cloud</strong>: 2022.0.1</li>
    </ul>
    <p class="normal">The code examples in each chapter all come from the source code in <code class="inlineCode">$BOOK_HOME/ChapterNN</code>, where <code class="inlineCode">NN</code> is the number of the chapter. The code examples in the book are in many cases edited to remove irrelevant parts of the source code, such as comments, imports, and log statements.</p>
    <h2 id="_idParaDest-530" class="heading-2">Using an IDE</h2>
    <p class="normal">I recommend <a id="_idIndexMarker1558"/>that you work with your Java code using an IDE that supports the development of Spring Boot applications, such as Visual Studio Code, Spring Tool Suite, or IntelliJ IDEA Ultimate Edition. However, you don’t need an IDE to be able to follow the instructions in this book.</p>
    <h2 id="_idParaDest-531" class="heading-2">The structure of the code</h2>
    <p class="normal">Each chapter <a id="_idIndexMarker1559"/>consists of a number of Java projects, one for each microservice and Spring Cloud service, plus a couple of library projects used by the other projects. <em class="chapterRef">Chapter 14</em> contains the largest number of projects; its project structure looks like this:</p>
    <pre class="programlisting code"><code class="hljs-code">├── api
├── microservices
│   ├── product-composite-service
│   ├── product-service
│   ├── recommendation-service
│   └── review-service
├── spring-cloud
│   ├── authorization-server
│   ├── config-server
│   ├── eureka-server
│   └── gateway
└── util
</code></pre>
    <p class="normal">All projects are <a id="_idIndexMarker1560"/>built using Gradle and have a file structure that follows Gradle’s standard conventions:</p>
    <pre class="programlisting code"><code class="hljs-code">├── build.gradle
├── settings.gradle
└── src
    ├── main
    │   ├── java
    │   └── resources
    └── test
        ├── java
        └── resources
</code></pre>
    <p class="normal">For more <a id="_idIndexMarker1561"/>information on how to organize a Gradle project, see <a href="https://docs.gradle.org/current/userguide/organizing_gradle_projects.html"><span class="url">https://docs.gradle.org/current/userguide/organizing_gradle_projects.html</span></a><span class="url">.</span></p>
    <p class="normal">With this, we have the required tools installed for macOS and the source code for the book downloaded. In the next chapter, we will learn how to set up the tools in a Windows environment.</p>
    <h1 id="_idParaDest-532" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we learned how to install, configure, and verify the tools required to run the commands described in this book on macOS. For development, we will use <code class="inlineCode">git</code>, <code class="inlineCode">docker</code>, <code class="inlineCode">java</code>, and <code class="inlineCode">spring</code>. To create a Kubernetes environment to deploy our microservice at runtime, we will use <code class="inlineCode">minikube</code>, <code class="inlineCode">helm</code>, <code class="inlineCode">kubectl</code>, and <code class="inlineCode">istioctl</code>. Finally, to run tests to verify that the microservices work as expected at runtime, we will use <code class="inlineCode">curl</code>, <code class="inlineCode">jq</code>, and <code class="inlineCode">siege</code>.</p>
    <p class="normal">We also learned how to access the source code from GitHub and how the source code is structured.</p>
    <p class="normal">In the next chapter, we will learn how to set up the same tools in an environment based on Microsoft Windows with <strong class="keyWord">Windows Subsystem for Linux v2</strong> (<strong class="keyWord">WSL 2</strong>), where we will use a Linux server based on Ubuntu.</p>
  </div>
</div>
</div>
</body></html>