<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Elasticsearch-head and Bigdesk"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Elasticsearch-head and Bigdesk</h1></div></div></div><p>This chapter talks about the Elasticsearch monitoring plugins Elasticsearch-head and Bigdesk, along with the Elasticsearch cat API. These utilities are used to assess the status of your cluster and to diagnose issues:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Elasticsearch-head</strong></span>: This is<a id="id85" class="indexterm"/> used to get an idea of your overall cluster health, individual node status, and an understanding of your indices</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bigdesk</strong></span>: This is<a id="id86" class="indexterm"/> used to look into the memory, disk, and CPU usage of individual nodes in your cluster</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Elasticsearch cat API</strong></span>: This<a id="id87" class="indexterm"/> lets you access many of Elasticsearch's internal metrics without installing any plugins</li></ul></div><p>Specifically, this chapter explores the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Configuring an Elasticsearch cluster</li><li class="listitem" style="list-style-type: disc">Loading sample data into Elasticsearch</li><li class="listitem" style="list-style-type: disc">Using Elasticsearch-head</li><li class="listitem" style="list-style-type: disc">Using Bigdesk</li><li class="listitem" style="list-style-type: disc">The Elasticsearch cat API</li></ul></div><div class="section" title="Cluster setup"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec17"/>Cluster setup</h1></div></div></div><p>This section covers configuring a<a id="id88" class="indexterm"/> three-node Elasticsearch cluster and loading it with Twitter data.</p><div class="section" title="Cluster configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Cluster configuration</h2></div></div></div><p>Setting up an Elasticsearch <a id="id89" class="indexterm"/>cluster is simple. All nodes in the cluster should be on the same local network and have the same version of Java and Elasticsearch installed. For our cluster, we'll use three Ubuntu Linux 14.04 virtual hosts: <code class="literal">elasticsearch-node-01</code>, <code class="literal">elasticsearch-node-02</code>, and <code class="literal">elasticsearch-node-03</code>.</p><p>After installing Elasticsearch on all hosts, update the <code class="literal">elasticsearch.yml</code> configuration file on each, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The configuration for <code class="literal">elasticsearch-node-01</code> is as follows:<div class="informalexample"><pre class="programlisting">cluster.name: my_elasticsearch_cluster
node.name: "elasticsearch-node-01"
discovery.zen.ping.multicast.enabled: false
discovery.zen.ping.unicast.hosts: ["elasticsearch-node-02", "elasticsearch-node-03"]
index.routing.allocation.disable_allocation: false
cluster.routing.allocation.enable : all</pre></div></li><li class="listitem" style="list-style-type: disc">The configuration for <code class="literal">elasticsearch-node-02</code> is as follows:<div class="informalexample"><pre class="programlisting">cluster.name: my_elasticsearch_cluster
node.name: "elasticsearch-node-02"
discovery.zen.ping.multicast.enabled: false
discovery.zen.ping.unicast.hosts: ["elasticsearch-node-01", "elasticsearch-node-03"]
index.routing.allocation.disable_allocation: false
cluster.routing.allocation.enable : all</pre></div></li><li class="listitem" style="list-style-type: disc">The configuration for <code class="literal">elasticsearch-node-03</code> is as follows:<div class="informalexample"><pre class="programlisting">cluster.name: my_elasticsearch_cluster
node.name: "elasticsearch-node-03"
discovery.zen.ping.multicast.enabled: false
discovery.zen.ping.unicast.hosts: ["elasticsearch-node-01", "elasticsearch-node-02"]
index.routing.allocation.disable_allocation: false
cluster.routing.allocation.enable : all</pre></div></li></ul></div><p>Next, install Elasticsearch-head on all nodes in this cluster using the instructions found in the previous chapter.</p><p>Now, restart all nodes and verify that the cluster is properly formed by visiting Elasticsearch-head at <code class="literal">http://elasticsearch-node-01:9200/_plugin/head/</code>.</p><p>You should see something like this, with all of your cluster's nodes listed in the leftmost column:</p><div class="mediaobject"><img src="graphics/B03798_03_01.jpg" alt="Cluster configuration"/></div></div><div class="section" title="Sample data"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec29"/>Sample data</h2></div></div></div><p>Now that we have a <a id="id90" class="indexterm"/>cluster up and running, let's populate it with Twitter data. We use Twitter data as an example because it is easy to acquire in large quantities and because it is a continuously-flowing stream of information, which is similar to a lot of real-world datasets.</p><p>Use the Elasticsearch <code class="literal">stream2es</code> utility<a id="id91" class="indexterm"/> to get the Twitter data. This utility is available at <a class="ulink" href="https://github.com/elastic/stream2es">https://github.com/elastic/stream2es</a>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Twitter account or log into your Twitter account if you already have one.</li><li class="listitem">Associate your mobile phone number with the account at <a class="ulink" href="https://support.twitter.com/articles/110250">https://support.twitter.com/articles/110250</a>.</li><li class="listitem">Create a new Twitter application at <a class="ulink" href="https://apps.twitter.com/app/new">https://apps.twitter.com/app/new</a>.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>For <span class="emphasis"><em>website</em></span>, you can put a placeholder value such as <code class="literal">http://example.com</code> if you don't have a domain name.</p></div></div></li><li class="listitem">Make a<a id="id92" class="indexterm"/> note of your <span class="strong"><strong>Consumer Key (API Ke</strong></span><span class="strong"><strong>y)</strong></span> and <span class="strong"><strong>Consumer Secret (API Secret)</strong></span> in the <span class="strong"><strong>Ke</strong></span><span class="strong"><strong>ys and Access Tokens</strong></span> tab:<div class="informalexample"><pre class="programlisting">./stream2es twitter --authorize --key CONSUMER_KEY --secret CONSUMER_SECRET</pre></div></li><li class="listitem">Authorize the app.</li><li class="listitem">Enter the verification code.</li><li class="listitem">Create a Twitter mapping:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XPUT 'http://localhost:9200/twitter/' -d '{</strong></span>
<span class="strong"><strong>    "settings" : {</strong></span>
<span class="strong"><strong>        "index" : {</strong></span>
<span class="strong"><strong>            "number_of_shards" : 3,</strong></span>
<span class="strong"><strong>            "number_of_replicas" : 1</strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>}'</strong></span>
</pre></div></li><li class="listitem">Collect tweets:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>./stream2es twitter --target http://localhost:9200/twitter/status --settings '{</strong></span>
<span class="strong"><strong>    "settings" : {</strong></span>
<span class="strong"><strong>        "index" : {</strong></span>
<span class="strong"><strong>            "number_of_shards" : 3,</strong></span>
<span class="strong"><strong>            "number_of_replicas" : 2</strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>}'</strong></span>
</pre></div></li><li class="listitem">Take a look at the tweets coming in:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET "http://localhost:9200/twitter/_search?size=0&amp;pretty"</strong></span>
</pre></div><p>After letting <code class="literal">stream2es</code> run for a while, we get the following:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>{</strong></span>
<span class="strong"><strong>  "took" : 63,</strong></span>
<span class="strong"><strong>  "timed_out" : false,</strong></span>
<span class="strong"><strong>  "_shards" : {</strong></span>
<span class="strong"><strong>    "total" : 3,</strong></span>
<span class="strong"><strong>    "successful" : 3,</strong></span>
<span class="strong"><strong>    "failed" : 0</strong></span>
<span class="strong"><strong>  },</strong></span>
<span class="strong"><strong>  "hits" : {</strong></span>
<span class="strong"><strong>    "total" : 150765,</strong></span>
<span class="strong"><strong>    "max_score" : 0.0,</strong></span>
<span class="strong"><strong>    "hits" : [ ]</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li></ol></div><p>Now that we <a id="id93" class="indexterm"/>have populated our cluster with some sample data, we can discuss how to use Elasticsearch-head, Bigdesk, and the Elasticsearch cat API.</p></div></div></div>
<div class="section" title="Elasticsearch-head"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec18"/>Elasticsearch-head</h1></div></div></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Installation and the Requirements for Elasticsearch">Chapter 2</a>, <span class="emphasis"><em>Installation and the Requirements for Elasticsearch</em></span>, we introduced and installed <a id="id94" class="indexterm"/>Elasticsearch-head, and now we will begin examining its features.</p><div class="section" title="The Overview tab"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec30"/>The Overview tab</h2></div></div></div><p>The<a id="id95" class="indexterm"/> first tab in Elasticsearch-head is the <span class="strong"><strong>Overview</strong></span> tab. This tab answers questions such as the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How many nodes are in the cluster?</li><li class="listitem" style="list-style-type: disc">Is the cluster in a healthy state?</li><li class="listitem" style="list-style-type: disc">Is all of the cluster's data available?</li><li class="listitem" style="list-style-type: disc">How many indices are in the cluster, and how big are they?</li><li class="listitem" style="list-style-type: disc">How much data is in the cluster?</li></ul></div><p>Users can also use this tab to perform some basic administrative actions (creating indices, deleting indices, and so on).</p><p>After loading in sample Twitter data from the previous section, our <span class="strong"><strong>Overview</strong></span> tab looks like the following:</p><div class="mediaobject"><img src="graphics/B03798__03_02.jpg" alt="The Overview tab"/></div><p>We<a id="id96" class="indexterm"/> can see that three nodes are up and running:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">elasticsearch-node-01</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">elasticsearch-node-02</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">elasticsearch-node-03</code></li></ul></div><p>We also have one active index that contains our newly loaded Twitter data. From this page, we can tell the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Twitter index takes up 456 MB</li><li class="listitem" style="list-style-type: disc">The Twitter index contains 150,765 documents</li></ul></div></div><div class="section" title="Cluster states"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec31"/>Cluster states</h2></div></div></div><p>An <a id="id97" class="indexterm"/>Elasticsearch cluster can be in any of these three states:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Green</strong></span>: All data <a id="id98" class="indexterm"/>is available and all shard replicas are assigned.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>The previous screenshot tells that we are currently in a <code class="literal">green</code> state.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Yellow</strong></span>: All data is <a id="id99" class="indexterm"/>available, but not all replicas are assigned:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This usually happens in a one-node cluster when you have a replica size of <span class="emphasis"><em>&gt; 0</em></span>, or in a multi node cluster right after a node goes down.</li><li class="listitem" style="list-style-type: disc">If a node in your cluster goes down, a <code class="literal">yellow</code> state will resolve itself after all replica shards are re-assigned.</li><li class="listitem" style="list-style-type: disc">Elasticsearch will automatically try to reassign shards after a default 1-minute wait time to see if the problematic node reappears.</li></ul></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Red</strong></span>: Not all data is <a id="id100" class="indexterm"/>available, and not all shards are assigned.<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">This state deserves immediate attention. This is usually caused by multiple node failures at once due to a simultaneous restart, power failure, or network failure in your cluster.</li><li class="listitem" style="list-style-type: disc">The best way to resolve this state is to bring all of the down nodes in your cluster back up.</li><li class="listitem" style="list-style-type: disc">Note that even in a <code class="literal">red</code> state, Elasticsearch will still return query results. However, query counts will be inaccurate.</li></ul></div></li></ul></div><p>For the purposes of <a id="id101" class="indexterm"/>demonstration, we'll shut down <code class="literal">elasticsearch-node-02</code> and <code class="literal">elasticsearch-node-03</code> to get a sense of what the cluster looks like in different states:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Shut down <code class="literal">elasticsearch-node-02</code>:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>ssh elasticsearchn-node-02</strong></span>
<span class="strong"><strong>sudo /etc/init.d/elasticsearch stop</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc">Refresh Elasticsearch-head. We should see something like this:</li></ul></div><div class="mediaobject"><img src="graphics/B03798__03_03.jpg" alt="Cluster states"/></div><p>Note that<a id="id102" class="indexterm"/> <code class="literal">elasticsearch-node-02</code> is no longer present, and that the cluster is in a <code class="literal">yellow</code> state.</p><p>Remember that a <code class="literal">yellow</code> state means that all data is still available. More node failures may result in a <code class="literal">red</code> state or data being unavailable.</p><p>After waiting a few minutes, Elasticsearch will start to reassign these shards to the remaining hosts:</p><div class="mediaobject"><img src="graphics/B03798__03_04.jpg" alt="Cluster states"/></div><p>After reassignment is<a id="id103" class="indexterm"/> complete; the cluster will be back in a <code class="literal">green</code> state:</p><div class="mediaobject"><img src="graphics/B03798__03_05.jpg" alt="Cluster states"/></div><p>Let's experiment and turn the <a id="id104" class="indexterm"/>cluster into a <code class="literal">red</code> state:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Turn <code class="literal">elasticsearch-node-02</code> back on and wait until <code class="literal">elasticsearch-node-02</code> has a few shards assigned to it.</li><li class="listitem">Once this happens, shut down both <code class="literal">elasticsearch-node-02</code> and <code class="literal">elasticsearch-node-03</code> without giving the cluster time to reassign shards.</li><li class="listitem">You can do this on Elasticsearch-head by selecting <span class="strong"><strong>Shutdown</strong></span> from <span class="strong"><strong>Actions</strong></span> next to each respective node or on the command line:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>ssh elasticsearchn-node-02</strong></span>
<span class="strong"><strong>sudo /etc/init.d/elasticsearch stop</strong></span>
<span class="strong"><strong>ssh elasticsearchn-node-03</strong></span>
<span class="strong"><strong>sudo /etc/init.d/elasticsearch stop</strong></span>
</pre></div></li><li class="listitem">After shutting down these nodes and refreshing Elasticsearch-head, we'll see something like this:<div class="mediaobject"><img src="graphics/B03798__03_06.jpg" alt="Cluster states"/></div></li><li class="listitem">Note that only<a id="id105" class="indexterm"/> shards <code class="literal">1</code> and <code class="literal">2</code> in the Twitter index are assigned, and shard <code class="literal">0</code> is unassigned. As a result, the index size and document counts have decreased from 456 MB to 305 MB and 150,765 to 100,573, respectively.</li><li class="listitem">Once we restart <code class="literal">elasticsearch-node-02</code> and <code class="literal">elasticsearch-node-03</code>, the cluster will recover and return to a <code class="literal">green</code> state.</li></ol></div></div><div class="section" title="Node and index actions"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec32"/>Node and index actions</h2></div></div></div><p>Next to the name <a id="id106" class="indexterm"/>of each node and index, you'll see dropdowns labeled <span class="strong"><strong>Info</strong></span> and <span class="strong"><strong>Actions</strong></span>. Each of the links in these dropdowns corresponds to various Elasticsearch API calls:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Info</strong></span> links all return <span class="strong"><strong>JSON</strong></span> documents with details about the status of your index or node</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Actions</strong></span> links provide convenience methods to manipulate your cluster</li></ul></div><p>The following table goes into more detail about each of these links:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Target (Index or Node)</p>
</th><th style="text-align: left" valign="bottom">
<p>Type (action or info)</p>
</th><th style="text-align: left" valign="bottom">
<p>Name (for example, "Node Stats")</p>
</th><th style="text-align: left" valign="bottom">
<p>Elasticsearch API methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Node</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Info</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Cluster Node Info</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">GET /_nodes</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This provides the node's Elasticsearch configuration, installed plugins, and the server's available memory, CPU, and disk space.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Node</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Info</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Node Stat</strong></span>
<span class="strong"><strong>s</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">GET /_nodes/stats?all=true</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This provides counts and statistics of the number of Elasticsearch documents stored on the node. Also provides JVM, network, and filesystem metrics.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Node</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Action</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Shutdown</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /_cluster/nodes/&lt;NODE_ID&gt;/_shutdown</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This shuts down the Elasticsearch process on the specified node.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Info</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Index Status</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">GET /_status</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id107" class="indexterm"/>provides information about the specified index, such as the state, number of documents, size, and various other metrics.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Info</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Index Metadata</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">GET /_cluster/state</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This provides the index's mapping, aliases, and settings.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>New Alias...</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /_aliases</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This creates a new index alias.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Refresh</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_refresh</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This refreshes the index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Flush</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_flush</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This flushes the index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Optimize...</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_optimize</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This optimizes the index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Gateway Snapshot</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_gateway/snapshot</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This takes a snapshot of the index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Test Analyzer</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">GET /&lt;INDEX_NAME&gt;/_analyze?text=TEXT</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This analyzes the passed in text using the index's default text analyzer.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Close</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_analyze</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This closes an open index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Open</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_open</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This opens a closed index.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Index</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Actions</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<span class="strong"><strong>Delete</strong></span>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">POST /&lt;INDEX_NAME&gt;/_delete</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This<a id="id108" class="indexterm"/> deletes an index.</p>
</td></tr></tbody></table></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>The <span class="strong"><strong>Info</strong></span> actions just listed (<span class="strong"><strong>Cluster Node Info</strong></span>, <span class="strong"><strong>Node Stats</strong></span>, <span class="strong"><strong>Index Status</strong></span>, and <span class="strong"><strong>Index Metadata</strong></span>) provide a plethora of information about the state of your cluster and data holdings. However, looking at the JSON responses for these items can be a little overwhelming.</p></div></div><p>Bigdesk is the next tool that we'll look at in this chapter. Both Bigdesk and Marvel, a tool that we'll examine in the next chapter, take many of these metrics and display them in easy-to-read charts and graphs.</p></div><div class="section" title="The Indices tab"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec33"/>The Indices tab</h2></div></div></div><p>The <span class="strong"><strong>Indices</strong></span> tab <a id="id109" class="indexterm"/>provides a list of the indices in your cluster, their disk size usage, and the number of documents in each. It is also a way to create a new index.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>This tab doesn't offer any additional information about an index beyond what is provided in the <span class="strong"><strong>Overview</strong></span> tab.</p></div></div><div class="mediaobject"><img src="graphics/B03798__03_07.jpg" alt="The Indices tab"/></div></div><div class="section" title="The Browser tab"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec34"/>The Browser tab</h2></div></div></div><p>This tab lets you <a id="id110" class="indexterm"/>browse, view, and run basic filter queries against the documents in your indices. The following screenshot is an example of what a document view will look like in the <span class="strong"><strong>Browser</strong></span> tab:</p><div class="mediaobject"><img src="graphics/B03798__03_08.jpg" alt="The Browser tab"/></div></div><div class="section" title="The Structured Query tab"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>The Structured Query tab</h2></div></div></div><p>The <span class="strong"><strong>Structured Query</strong></span> tab is an<a id="id111" class="indexterm"/> advanced query builder to explore the documents in your index. This tab is useful when you want to build a complex query without writing out the full JSON request body.</p><p>The following screenshot shows a sample query and results created using this interface:</p><div class="mediaobject"><img src="graphics/B03798__03_09.jpg" alt="The Structured Query tab"/></div></div><div class="section" title="The Any Request tab"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>The Any Request tab</h2></div></div></div><p>The <span class="strong"><strong>Any Request</strong></span> tab allows <a id="id112" class="indexterm"/>you to run arbitrary <span class="strong"><strong>API</strong></span> calls against your cluster and view the results in <span class="strong"><strong>JSON</strong></span>. The following screenshot shows a sample aggregation query:</p><div class="mediaobject"><img src="graphics/B03798__03_10.jpg" alt="The Any Request tab"/></div></div><div class="section" title="The official website"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>The official website</h2></div></div></div><p>For more information<a id="id113" class="indexterm"/> about Elasticsearch-head, visit the plugin's website at <a class="ulink" href="https://mobz.github.io/elasticsearch-head/">https://mobz.github.io/elasticsearch-head/</a>.</p></div></div>
<div class="section" title="Bigdesk"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec19"/>Bigdesk</h1></div></div></div><p>Bigdesk<a id="id114" class="indexterm"/> is a tool to look into various JVM and operating-system level metrics about your cluster. If your cluster runs slowly or experiences unusual errors, Bigdesk is a good place to check for anything out of the ordinary.</p><p>After following the installation instructions from the previous chapter, access Bigdesk by visiting <code class="literal">http://elasticsearch-node-01:9200/plugin/bigdesk/</code>. The initial landing page looks like this:</p><div class="mediaobject"><img src="graphics/B03798__03_11.jpg" alt="Bigdesk"/></div><p>Like<a id="id115" class="indexterm"/> Elasticsearch-head, this page shows the nodes in your cluster and the cluster health. Click on any of the nodes listed in the top row to display its individual metrics:</p><div class="mediaobject"><img src="graphics/B03798__03_12.jpg" alt="Bigdesk"/></div><p>In this screenshot, we <a id="id116" class="indexterm"/>selected <code class="literal">elasticsearch-node-02</code> and are looking at <span class="strong"><strong>JVM</strong></span> metrics. A notable chart in this section is the <span class="strong"><strong>Heap Mem</strong></span> figure. If you are using close to the maximum amount of committed heap memory, you will want to increase your heap memory by setting <code class="literal">ES_HEAP_SIZE</code> to at the most half of your total available memory.</p><p>Further down, we see operating system metrics, namely:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">CPU usage</li><li class="listitem" style="list-style-type: disc">Memory usage</li><li class="listitem" style="list-style-type: disc">Swap space usage</li><li class="listitem" style="list-style-type: disc">Load average</li></ul></div><div class="mediaobject"><img src="graphics/B03798__03_13.jpg" alt="Bigdesk"/></div><p>Below operating<a id="id117" class="indexterm"/> system metrics, we come to process level metrics, including the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Open file descriptors</li><li class="listitem" style="list-style-type: disc">Process memory usage</li><li class="listitem" style="list-style-type: disc">CPU usage</li></ul></div><div class="mediaobject"><img src="graphics/B03798__03_14.jpg" alt="Bigdesk"/></div><p>Refer to the operating<a id="id118" class="indexterm"/> system and process metrics charts if you are experiencing slow queries or slow data index operations to get a sense of the performance bottleneck.</p><p>Continuing down the page, we'll see some more notable charts, including:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Cache size</li><li class="listitem" style="list-style-type: disc">Indexing operations</li><li class="listitem" style="list-style-type: disc">Filesystem activity</li></ul></div><div class="mediaobject"><img src="graphics/B03798__03_15.jpg" alt="Bigdesk"/></div><p>The <span class="strong"><strong>Cache size</strong></span> chart is an important figure in this screenshot. The <span class="strong"><strong>ID</strong></span>, <span class="strong"><strong>Filter</strong></span>, and <span class="strong"><strong>Field</strong></span> caches can fill up based on the type of queries you run. If they get too large, look at your queries for possible modifications to keep cache sizes down.</p><p>The Bigdesk <a id="id119" class="indexterm"/>charts are also useful for finding configuration errors. For example, if we meant to configure our node to use <code class="literal">32GB</code> of memory and a maximum of <code class="literal">65535</code> open file descriptors, but the <span class="strong"><strong>JVM Heap Mem</strong></span> chart shows only show <code class="literal">247MB</code> of committed memory and the <span class="strong"><strong>Process File Descriptors</strong></span> chart shows a limit of <code class="literal">1024</code> files, we'll know we didn't configure the node correctly.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>For more information about <a id="id120" class="indexterm"/>Bigdesk, visit the plugin's website at <a class="ulink" href="http://bigdesk.org/">http://bigdesk.org/</a>.</p></div></div></div>
<div class="section" title="The Elasticsearch cat API"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec20"/>The Elasticsearch cat API</h1></div></div></div><p>Think of the <span class="strong"><strong>Elasticsearch cat API</strong></span> as a <a id="id121" class="indexterm"/>simpler version of the <span class="strong"><strong>Elasticsearch Cluster</strong></span> and <span class="strong"><strong>Indices APIs</strong></span> mentioned earlier. The cat API returns results in an easy-to-read, tab-separated format, unlike the JSON returned by the Cluster and Indices APIs.</p><p>A complete list of API methods<a id="id122" class="indexterm"/> is available at <a class="ulink" href="https://www.elastic.co/blog/introducing-cat-api">https://www.elastic.co/blog/introducing-cat-api</a>, but there are some highlights, which we cover in the following sections.</p><div class="section" title="Background"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Background</h2></div></div></div><p>Elasticsearch-head and Bigdesk are, for the <a id="id123" class="indexterm"/>most part, powered by the Elasticsearch APIs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Cluster </strong></span><a id="id124" class="indexterm"/><span class="strong"><strong>API</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/cluster.html">https://www.elastic.co/guide/en/elasticsearch/reference/1.7/cluster.html</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Indices </strong></span><a id="id125" class="indexterm"/><span class="strong"><strong>API</strong></span>: <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/indices.html">https://www.elastic.co/guide/en/elasticsearch/reference/1.7/indices.html</a>.</li></ul></div><p>These two APIs provide a plethora of information about the inner workings of Elasticsearch. However, they also return large <span class="emphasis"><em>JSON</em></span> documents that are complicated to interpret quickly. For example, here's a snippet from calling the Indices Stats API:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET "http://elasticsearch-node-01:9200/_stats?pretty"</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>  ...</strong></span>
<span class="strong"><strong>  "_all" : {</strong></span>
<span class="strong"><strong>    "primaries" : {</strong></span>
<span class="strong"><strong>      "store" : {</strong></span>
<span class="strong"><strong>        "size_in_bytes" : 477638305,</strong></span>
<span class="strong"><strong>        "throttle_time_in_millis" : 0</strong></span>
<span class="strong"><strong>      },</strong></span>
<span class="strong"><strong>    ...</strong></span>
</pre></div><p>It's probably not immediately clear that the <code class="literal">size_in_bytes</code> value of <code class="literal">477638305</code> translates to 455 MB.</p></div><div class="section" title="Count"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>Count</h2></div></div></div><p>This endpoint provides a document count<a id="id126" class="indexterm"/> for the entire cluster:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET http://elasticsearch-node-01:9200/_cat/count?v</strong></span>
</pre></div><p>This gives the output:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>epoch      timestamp count</strong></span>
<span class="strong"><strong>1445910583 21:49:43  150765</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>Passing the <code class="literal">v</code> option to the cat API shows a header row.</p></div></div><p>The output <a id="id127" class="indexterm"/>columns represent the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">epoch</code>: This represents a Unix timestamp</li><li class="listitem" style="list-style-type: disc"><code class="literal">timestamp</code>: This represents the time of day</li><li class="listitem" style="list-style-type: disc"><code class="literal">count</code>: This represents the number of documents in the cluster</li></ul></div></div><div class="section" title="Health"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Health</h2></div></div></div><p>This endpoint shows the health color code<a id="id128" class="indexterm"/> for the cluster:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET http://elasticsearch-node-01:9200/_cat/health?v</strong></span>
</pre></div><p>This gives the output:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>epoch      timestamp cluster                    status node.total node.data shards pri relo init unassign pending_tasks </strong></span>
<span class="strong"><strong>1445910646 21:50:46  my_elasticsearch_cluster green           3         3      6   3    0    0        0     </strong></span>
<span class="strong"><strong>        0 </strong></span>
</pre></div><p>These columns represent the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">epoch</code>: This represents a Unix timestamp</li><li class="listitem" style="list-style-type: disc"><code class="literal">timestamp</code>: This represents the time of day</li><li class="listitem" style="list-style-type: disc"><code class="literal">cluster</code>: This represents a cluster name</li><li class="listitem" style="list-style-type: disc"><code class="literal">status</code>: This represents a cluster status (<code class="literal">green</code>, <code class="literal">yellow</code>, or <code class="literal">red</code>)</li><li class="listitem" style="list-style-type: disc"><code class="literal">node.total</code>: This represents the number of nodes in the cluster</li><li class="listitem" style="list-style-type: disc"><code class="literal">node.data</code>: This represents the number of data nodes in the cluster</li><li class="listitem" style="list-style-type: disc"><code class="literal">shards</code>: This represents the number of total shards in the cluster</li><li class="listitem" style="list-style-type: disc"><code class="literal">pri</code>: This represents the number of primary shards (as opposed to replica shards)</li><li class="listitem" style="list-style-type: disc"><code class="literal">relo</code>: This represents the number of shards currently relocating</li><li class="listitem" style="list-style-type: disc"><code class="literal">init</code>: This represents the number of shards currently initializing</li><li class="listitem" style="list-style-type: disc"><code class="literal">unassign</code>: This represents the number of unassigned shards</li><li class="listitem" style="list-style-type: disc"><code class="literal">pending_tasks</code>: This represents the number of cluster tasks in the backlog</li></ul></div></div><div class="section" title="Indices"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Indices</h2></div></div></div><p>This endpoint provides a list of all<a id="id129" class="indexterm"/> indices, their document count, and size in your cluster:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET http://elasticsearch-node-01:9200/_cat/indices?v</strong></span>
</pre></div><p>This gives the output:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>health status index pri rep docs.count docs.deleted store.size pri.store.size </strong></span>
<span class="strong"><strong>green  open   twitter   3   1     150765            0      911mb        455.5mb </strong></span>
</pre></div><p>This output has one line for each index in the cluster. The output columns represent the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">health</code>: This is index health (<code class="literal">green</code>, <code class="literal">yellow</code>, or <code class="literal">red</code>)</li><li class="listitem" style="list-style-type: disc"><code class="literal">status</code>: This indicates whether the index is open or closed</li><li class="listitem" style="list-style-type: disc"><code class="literal">index</code>: This is the index name</li><li class="listitem" style="list-style-type: disc"><code class="literal">pri</code>: This is the number of primary shards</li><li class="listitem" style="list-style-type: disc"><code class="literal">rep</code>: This is the replication level (<code class="literal">1</code> means all shards are replicated once)</li><li class="listitem" style="list-style-type: disc"><code class="literal">docs.count</code>: This is the number of documents in this index</li><li class="listitem" style="list-style-type: disc"><code class="literal">docs.deleted</code>: This is the number of deleted documents</li><li class="listitem" style="list-style-type: disc"><code class="literal">store.size</code>: This is the total index size</li><li class="listitem" style="list-style-type: disc"><code class="literal">pri.store.size</code>: This is the size of index without replicas</li></ul></div></div><div class="section" title="Shards"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Shards</h2></div></div></div><p>This endpoint provides a list of <a id="id130" class="indexterm"/>index shards and how they are distributed:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>curl -XGET http://elasticsearch-node-01:9200/_cat/shards?v</strong></span>
</pre></div><p>This gives the output:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>index   shard prirep state    docs   store ip           node                  </strong></span>
<span class="strong"><strong>twitter 0     r      STARTED 50192 150.2mb 127.0.1.1    elasticsearch-node-03 </strong></span>
<span class="strong"><strong>twitter 0     p      STARTED 50192 150.2mb 192.168.56.1 elasticsearch-node-01 </strong></span>
<span class="strong"><strong>twitter 1     p      STARTED 50305   152mb 127.0.1.1    elasticsearch-node-03 </strong></span>
<span class="strong"><strong>twitter 1     r      STARTED 50305   152mb 127.0.1.1    elasticsearch-node-02 </strong></span>
<span class="strong"><strong>twitter 2     p      STARTED 50268 153.2mb 127.0.1.1    elasticsearch-node-02 </strong></span>
<span class="strong"><strong>twitter 2     r      STARTED 50268 153.2mb 192.168.56.1 elasticsearch-node-01 </strong></span>
</pre></div><p>Each row in this output is for a single shard in the cluster. The columns represent the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">index</code>: This is <a id="id131" class="indexterm"/>the index name</li><li class="listitem" style="list-style-type: disc"><code class="literal">shard</code>: This is the shard number</li><li class="listitem" style="list-style-type: disc"><code class="literal">prirep</code>: This is <code class="literal">p</code> if a primary shard, <code class="literal">r</code> if a replica</li><li class="listitem" style="list-style-type: disc"><code class="literal">state</code>: This is the availability of the shard</li><li class="listitem" style="list-style-type: disc"><code class="literal">docs</code>: This is the number of documents in this shard</li><li class="listitem" style="list-style-type: disc"><code class="literal">store</code>: This is the size of the shard on disk</li><li class="listitem" style="list-style-type: disc"><code class="literal">ip</code>: This is the IP address where the shard is located</li><li class="listitem" style="list-style-type: disc"><code class="literal">node</code>: This is the node name where the shard is located</li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec21"/>Summary</h1></div></div></div><p>This chapter discussed how to configure and load data into a three-node Elasticsearch cluster. Additionally, it covered how to monitor a cluster using Elasticsearch-head, Bigdesk, and the cat API.</p><p>The next chapter will discuss Marvel—the official Elasticsearch monitoring tool.</p></div></body></html>