<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Maven Lifecycle"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Maven Lifecycle</h1></div></div></div><p>Let us start putting Maven to use. In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding the Maven lifecycle, phases, and goals</li><li class="listitem" style="list-style-type: disc">Understanding the pom file</li><li class="listitem" style="list-style-type: disc">Understanding Maven settings</li><li class="listitem" style="list-style-type: disc">Understanding command-line options in Maven</li><li class="listitem" style="list-style-type: disc">Understanding Maven profiles</li><li class="listitem" style="list-style-type: disc">Adding a new Maven profile</li><li class="listitem" style="list-style-type: disc">Activating/deactivating a Maven profile</li><li class="listitem" style="list-style-type: disc">Using properties in Maven</li><li class="listitem" style="list-style-type: disc">Specifying source encoding for platform-independent builds</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Introduction</h1></div></div></div><p>We have set up Maven on our computer. We have created a simple Maven project and seen how to build it. We have also set up Maven to run on our preferred IDE.</p><p>Let us now understand better how Maven works and how to use it. We will start by understanding the Maven build lifecycle as well as the phases and goals that make up the lifecycle. We will also explore Maven's project configuration pom file as well as the settings file. We will also try to understand what Maven profiles are and why they are needed. Finally, we will look at Maven's properties.</p></div></div>
<div class="section" title="Understanding the Maven lifecycle, phases, and goals"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Understanding the Maven lifecycle, phases, and goals</h1></div></div></div><p>As we start using Maven, we need to understand the Maven project lifecycle. Maven is implemented based around the concept of a build lifecycle. This means there is a clearly defined process to build and distribute artifacts with Maven.</p><p>What makes up a lifecycle? The stages of a lifecycle are called phases. In each phase, one or more goals can be executed.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec61"/>Getting ready</h2></div></div></div><p>Maven is set up <a id="id140" class="indexterm"/>on your system and is verified as working. For setting up Apache Maven, refer<a id="id141" class="indexterm"/> to the<a id="id142" class="indexterm"/> first three recipes of <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec62"/>How to do it...</h2></div></div></div><p>To build a Maven project, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the command prompt.</li><li class="listitem">Run one of the Maven commands that we are familiar with:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn package</strong></span>
</pre></div></li><li class="listitem">Observe the various steps that get executed.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec63"/>How it works...</h2></div></div></div><p>Maven has three built-in build lifecycles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">default</code>: The <code class="literal">default</code> lifecycle<a id="id143" class="indexterm"/> handles <a id="id144" class="indexterm"/>project build and deployment</li><li class="listitem" style="list-style-type: disc"><code class="literal">clean</code>: The <code class="literal">clean</code> lifecycle <a id="id145" class="indexterm"/>cleans up the files and folders<a id="id146" class="indexterm"/> produced by Maven</li><li class="listitem" style="list-style-type: disc"><code class="literal">site</code>: The <code class="literal">site</code> lifecycle <a id="id147" class="indexterm"/>handles the<a id="id148" class="indexterm"/> creation of project documentation</li></ul></div><p>You will have noticed that you do not have to explicitly specify a lifecycle. Instead, what you specify is a phase. Maven infers the lifecycle based on the phase specified.</p><p>For instance, the <code class="literal">package</code> phase indicates it is the <code class="literal">default</code> lifecycle.</p><p>When Maven is run with the <code class="literal">package</code> phase as a parameter, the <code class="literal">default</code> build lifecycle gets executed. Maven runs all the phases in sequence, up to and including the specified phase (in our case, the <code class="literal">package</code> phase).</p><p>While each lifecycle has a number of phases, let us look at the important phases for each lifecycle:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">clean</code> lifecycle: The <code class="literal">clean</code> phase<a id="id149" class="indexterm"/> removes all the files and folders <a id="id150" class="indexterm"/>created by Maven as part of its build</li><li class="listitem" style="list-style-type: disc">The <code class="literal">site</code> lifecycle: The <code class="literal">site</code> phase <a id="id151" class="indexterm"/>generates the project's <a id="id152" class="indexterm"/>documentation, which can be published, as well as a template that can be customized further</li><li class="listitem" style="list-style-type: disc">The <code class="literal">default</code> lifecycle: The <a id="id153" class="indexterm"/>following are some of the important phases <a id="id154" class="indexterm"/>of the <code class="literal">default</code> lifecycle:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">validate</code>: This <a id="id155" class="indexterm"/>phase validates that all project information is available and correct</li><li class="listitem" style="list-style-type: disc"><code class="literal">process-resources</code>: This <a id="id156" class="indexterm"/>phase copies project resources to the destination to package</li><li class="listitem" style="list-style-type: disc"><code class="literal">compile</code>: This phase <a id="id157" class="indexterm"/>compiles the source code</li><li class="listitem" style="list-style-type: disc"><code class="literal">test</code>: This phase <a id="id158" class="indexterm"/>runs unit tests within a suitable framework</li><li class="listitem" style="list-style-type: disc"><code class="literal">package</code>: This phase <a id="id159" class="indexterm"/>packages the compiled code in its distribution format</li><li class="listitem" style="list-style-type: disc"><code class="literal">integration-test</code>: This <a id="id160" class="indexterm"/>phase processes the package in the integration test environment</li><li class="listitem" style="list-style-type: disc"><code class="literal">verify</code>: This<a id="id161" class="indexterm"/> phase runs checks to verify that the package is valid</li><li class="listitem" style="list-style-type: disc"><code class="literal">install</code>: This <a id="id162" class="indexterm"/>phase installs the package in the local repository</li><li class="listitem" style="list-style-type: disc"><code class="literal">deploy</code>: This phase<a id="id163" class="indexterm"/> installs the final package in the configured repository</li></ul></div></li></ul></div><p>Each phase is made up of plugin goals. A plugin goal is a specific task that builds the project. Some goals make sense only in specific phases (for example, the compile goal of the Maven Compiler plugin makes sense in the compile phase, but the <code class="literal">checkstyle</code> goal of the Maven Checkstyle plugin can potentially be run in any phase). So some goals are bound to a specific phase of a lifecycle, while others are not.</p><p>Here is a table of <a id="id164" class="indexterm"/>phases, plugins, and goals:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Phase</p>
</th><th style="text-align: left" valign="bottom">
<p>Plugin</p>
</th><th style="text-align: left" valign="bottom">
<p>Goal</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">clean</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Clean plugin</p>
</td><td style="text-align: left" valign="top">
<p>clean</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">site</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Site plugin</p>
</td><td style="text-align: left" valign="top">
<p>site</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">process-resources</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Resources plugin</p>
</td><td style="text-align: left" valign="top">
<p>resource</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">compile</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Compiler plugin</p>
</td><td style="text-align: left" valign="top">
<p>compile</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">test</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Surefire plugin</p>
</td><td style="text-align: left" valign="top">
<p>test</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">package</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Varies based on the packaging; for instance, the Maven JAR plugin</p>
</td><td style="text-align: left" valign="top">
<p>jar (in the case of a Maven JAR plugin)</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">install</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Install plugin</p>
</td><td style="text-align: left" valign="top">
<p>install</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">deploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Maven Deploy plugin</p>
</td><td style="text-align: left" valign="top">
<p>deploy</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Understanding the pom file"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Understanding the pom file</h1></div></div></div><p>Every Maven project has a pom file that defines what the project is all about and how it should be built. Pom is an acronym for <span class="strong"><strong>project object model</strong></span>. Let us take a peek at this file.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec64"/>How to do it...</h2></div></div></div><p>Let's understand the <a id="id165" class="indexterm"/>pom file, by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to a Maven project that we created in previous chapters.</li><li class="listitem">Open the file named <code class="literal">pom.xml</code>.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec65"/>How it works...</h2></div></div></div><p>A pom file is an XML file that is based on a specific schema, as specified at the top of the file:</p><div class="informalexample"><pre class="programlisting">&lt;project 
  
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                      http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</pre></div><p>There is also a <code class="literal">modelVersion</code> element that defines the version of this schema:</p><div class="informalexample"><pre class="programlisting">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</pre></div><p>These are the basic elements of a pom file.</p><p>The <code class="literal">groupId</code> element is a unique identifier of the organization to which the project belongs. For our sample project, it is <code class="literal">org.packt.cookbook</code>. It is a good practice to follow the reverse domain name notation to specify this:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;...&lt;/groupId&gt;</pre></div><p>The <code class="literal">artifactId</code> element is the name of the project. For our sample project, it is <code class="literal">simple-project</code>:</p><div class="informalexample"><pre class="programlisting">&lt;artifactId&gt;...&lt;/artifactId&gt;</pre></div><p>The <code class="literal">version</code> element is the specific instance of the project, corresponding to the source code at a particular instance of time. In our case, it is <code class="literal">1.0-SNAPSHOT</code>, which is a default version during development:</p><div class="informalexample"><pre class="programlisting">&lt;version&gt;...&lt;/version&gt;</pre></div><p>We will explore the difference <a id="id166" class="indexterm"/>between the <span class="strong"><strong>SNAPSHOT</strong></span><a id="id167" class="indexterm"/> and concrete versions later in the book.</p><p>The combination of <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">version</code> uniquely identifies the project. In this sense, they are the coordinates of the project.</p><p>The <code class="literal">packaging</code> element indicates the artifact type of the project. This is typically a <code class="literal">jar</code>, <code class="literal">war</code>, <code class="literal">zip</code>, or in some cases, a <code class="literal">pom</code>:</p><div class="informalexample"><pre class="programlisting">  &lt;packaging&gt;...&lt;/packaging&gt;</pre></div><p>The <code class="literal">dependencies</code> element section of the pom file defines all the dependent projects of this project. This would typically be third-party libraries required to build, test, and run the project:</p><div class="informalexample"><pre class="programlisting">  &lt;dependencies&gt;...&lt;/dependencies&gt;</pre></div><p>The <code class="literal">parent</code> section is used to indicate a relationship, specifically a parent-child relationship. If the project is part of a multi-module project or inherits project information from another project, then the details are specified in this section:</p><div class="informalexample"><pre class="programlisting">  &lt;parent&gt;...&lt;/parent&gt;</pre></div><p>Maven properties are <a id="id168" class="indexterm"/>
<span class="strong"><strong>placeholders</strong></span>. Their values are accessible anywhere in the pom file by using <code class="literal">${key}</code>, where <code class="literal">key</code> is the property name:</p><div class="informalexample"><pre class="programlisting">  &lt;properties&gt;...&lt;/properties&gt;</pre></div><p>A project with modules is known as a multi-module or <a id="id169" class="indexterm"/>
<span class="strong"><strong>aggregator project</strong></span>. Modules are projects that this pom file lists and are executed as a group:</p><div class="informalexample"><pre class="programlisting">  &lt;modules&gt;...&lt;/modules&gt;</pre></div><p>For more information on multi-module projects refer to <a class="link" href="ch09.html" title="Chapter 9. Multi-module Projects">Chapter 9</a>, <span class="emphasis"><em>Multi-module Projects</em></span>.</p></div></div>
<div class="section" title="Understanding Maven settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Understanding Maven settings</h1></div></div></div><p>Now that we have got an idea of the essential elements of a pom file, let us also examine the various setting properties of Maven.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec66"/>How to do it...</h2></div></div></div><p>To understand the <a id="id170" class="indexterm"/>Maven settings, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">settings.xml</code> file in the <code class="literal">.m2</code> subfolder of your <code class="literal">HOME</code> folder, if it exists:<div class="mediaobject"><img src="graphics/6124OS_03_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Otherwise, open the <code class="literal">settings.xml</code> file in the <code class="literal">conf</code> folder of your Maven installation (as defined in <code class="literal">M2_HOME</code>).</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec67"/>How it works...</h2></div></div></div><p>Maven has a global settings file called <code class="literal">settings.xml</code> in the <code class="literal">conf</code> folder of the Maven installation. The values in this file can be overridden in the user settings file— the <code class="literal">settings.xml</code> file—that is present in the <code class="literal">.m2</code> subfolder of your <code class="literal">HOME</code> folder.</p><p>The settings file contains configurations that are not specific to a project, but are global in nature. It also contains information that is not meant to be distributed (for example, passwords).</p><p>Like the pom file, the settings file is also an XML file based on an XML schema. It starts as follows:</p><div class="informalexample"><pre class="programlisting">&lt;settings 
      
      xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                          http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;</pre></div><p>Let us now see some of the typical <a id="id171" class="indexterm"/>setting configurations:</p><div class="section" title="The localRepository element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec01"/>The localRepository element</h3></div></div></div><p>The following code <a id="id172" class="indexterm"/>represents the <code class="literal">localRepository</code> element <a id="id173" class="indexterm"/>in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;localRepository&gt;${user.home}/.m2/repository&lt;/localRepository&gt;</pre></div><p>We have seen this in the <span class="emphasis"><em>Changing the location of the Maven repository</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>, where we wanted to change the default location where Maven dependencies and plugins are stored.</p></div><div class="section" title="The offline element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec02"/>The offline element</h3></div></div></div><p>The following code <a id="id174" class="indexterm"/>represents <a id="id175" class="indexterm"/>the <code class="literal">offline</code> element in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;offline&gt;false&lt;/offline&gt;</pre></div><p>This setting indicates whether Maven should operate in offline mode; that is, it should not download updates or dependencies if they are not available.</p></div><div class="section" title="The proxies element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec03"/>The proxies element</h3></div></div></div><p>We saw proxies in<a id="id176" class="indexterm"/> the <span class="strong"><strong>Running Maven behind an HTTP proxy server</strong></span> <a id="id177" class="indexterm"/>recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>. The following code represents the <code class="literal">proxies</code> element in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;proxies&gt;
    &lt;proxy&gt;
      &lt;id&gt;myproxy&lt;/id&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;protocol&gt;http&lt;/protocol&gt;
      &lt;host&gt;proxy.myorg.com&lt;/host&gt;
      &lt;port&gt;8080&lt;/port&gt;
      &lt;username&gt;proxyuser&lt;/username&gt;
      &lt;password&gt;somepassword&lt;/password&gt;
      &lt;nonProxyHosts&gt;*.myorg.com &lt;/nonProxyHosts&gt;
    &lt;/proxy&gt;
  &lt;/proxies&gt;</pre></div><p>This allows us to specify a proxy server <a id="id178" class="indexterm"/>to connect to the Internet. This is relevant in enterprises where direct access to the Internet might be blocked due to <a id="id179" class="indexterm"/>security or other reasons.</p></div><div class="section" title="The mirrors element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec04"/>The mirrors element</h3></div></div></div><p>The following code <a id="id180" class="indexterm"/>represents the <code class="literal">mirrors</code> element in the <a id="id181" class="indexterm"/>settings file:</p><div class="informalexample"><pre class="programlisting">   &lt;mirror&gt;
      &lt;id&gt;nexus&lt;/id&gt;
      &lt;name&gt;My Company Mirror&lt;/name&gt;
      &lt;url&gt;http://nexus.mycompany.com/pub/maven2&lt;/url&gt;
      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;/mirror&gt;</pre></div><p>Instead of downloading dependencies from Maven Central, you can configure Maven to download them from a mirror of the central repository. This is extremely useful in an organization where the repository can be mirrored in a repository manager within an organization and all users can download dependencies from this mirror.</p></div><div class="section" title="The repositories element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec05"/>The repositories element</h3></div></div></div><p>Repositories are remote <a id="id182" class="indexterm"/>collections of projects that Maven <a id="id183" class="indexterm"/>uses to populate the required dependencies to a local repository. There are two types of repositories—<code class="literal">releases</code> and <code class="literal">snapshots</code>—and Maven allows specific configurations for each, as illustrated in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;repositories&gt;
        &lt;repository&gt;
          &lt;id&gt;codehausSnapshots&lt;/id&gt;
          &lt;name&gt;Codehaus Snapshots&lt;/name&gt;
          &lt;releases&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
            &lt;checksumPolicy&gt;warn&lt;/checksumPolicy&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
            &lt;checksumPolicy&gt;fail&lt;/checksumPolicy&gt;
          &lt;/snapshots&gt;
          &lt;url&gt;http://snapshots.maven.codehaus.org/maven2&lt;/url&gt;
          &lt;layout&gt;default&lt;/layout&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;</pre></div></div><div class="section" title="The pluginRepositories element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec06"/>The pluginRepositories element</h3></div></div></div><p>While repositories store<a id="id184" class="indexterm"/> dependencies required for<a id="id185" class="indexterm"/> the project, the <code class="literal">pluginRepositories</code> element <a id="id186" class="indexterm"/>stores plugin libraries and associated files. Maven distinguishes between these two by having separate configurations for both. The elements are the same as that for repositories, except that the parent element is <code class="literal">pluginRepositories</code>.</p></div><div class="section" title="The servers element"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec07"/>The servers element</h3></div></div></div><p>The repositories for download and <a id="id187" class="indexterm"/>deployment are defined by the <code class="literal">repositories</code> and <code class="literal">distributionManagement</code> elements of the pom file. However, settings <a id="id188" class="indexterm"/>such as <code class="literal">username</code> and <code class="literal">password</code> cannot be distributed in the pom file for confidentiality reasons. Maven provides a mechanism to specify this in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;server001&lt;/id&gt;
      &lt;username&gt;my_login&lt;/username&gt;
      &lt;password&gt;my_password&lt;/password&gt;
      &lt;privateKey&gt;${user.home}/.ssh/id_dsa&lt;/privateKey&gt;
      &lt;passphrase&gt;some_passphrase&lt;/passphrase&gt;
      &lt;filePermissions&gt;664&lt;/filePermissions&gt;
      &lt;directoryPermissions&gt;775&lt;/directoryPermissions&gt;
      &lt;configuration&gt;&lt;/configuration&gt;
    &lt;/server&gt;
  &lt;/servers&gt;</pre></div></div></div></div>
<div class="section" title="Understanding command-line options in Maven"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec30"/>Understanding command-line options in Maven</h1></div></div></div><p>While the most popular way to run<a id="id189" class="indexterm"/> Maven is to specify goals, Maven provides <a id="id190" class="indexterm"/>a number of command-line options to customize its behavior. They range from specifying values for properties, to varying the verbosity of the Maven output. It is useful to know some of the arguments, as they will often help with troubleshooting issues with Maven.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec68"/>Getting ready</h2></div></div></div><p>Maven is set up on your system and is verified as working.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec69"/>How to do it...</h2></div></div></div><p>To understand command-line options in Maven, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the command prompt.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –h</strong></span>
</pre></div></li><li class="listitem">You will see an output such as the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_03_02.jpg" alt="How to do it..."/></div></li></ol></div><p>A number of options that Maven supports are displayed in the preceding screenshot.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec70"/>How it works...</h2></div></div></div><p>We will briefly discuss the command-line options that Maven provides.</p><div class="section" title="Options"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec08"/>Options</h3></div></div></div><p>When there is an error <a id="id191" class="indexterm"/>while running Maven, this flag will <a id="id192" class="indexterm"/>result in Maven displaying a detailed stack trace of the error:</p><div class="informalexample"><pre class="programlisting">-e –errors
</pre></div><p>When the <code class="literal">quiet</code> option is enabled, only errors are displayed. The other outputs are not printed. This permits speeding up builds where verbose outputs are usually displayed:</p><div class="informalexample"><pre class="programlisting">-q –quiet
</pre></div><p>We have seen the <code class="literal">version</code> option to display the Maven version in the first three recipes of <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>. This is also a simple way to check if Maven is installed and working:</p><div class="informalexample"><pre class="programlisting">-v –version
</pre></div><p>When invoked with the <code class="literal">offline</code> option, Maven does not attempt to download any dependency or plugin from the Internet. This option will work correctly, provided Maven has all the information required for the project to be built and run. We will see how to enable projects to run in offline mode:</p><div class="informalexample"><pre class="programlisting">-o –offline
</pre></div><p>When enabled with the <code class="literal">debug</code> option, Maven prints a lot of verbose output about every step that it performs. This is typically used to troubleshoot any build issues:</p><div class="informalexample"><pre class="programlisting">-X –debug
</pre></div></div></div></div>
<div class="section" title="Understanding Maven profiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec31"/>Understanding Maven profiles</h1></div></div></div><p>Maven is designed to<a id="id193" class="indexterm"/> create portable builds that are expected to work across different platforms and in various runtime environments.</p><p>Now, there may be situations where you need to build the same project differently. For instance, you may need to build a project differently for the purpose of staging and production. You may not want to build a project that requires a Linux library on Windows.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec71"/>How to do it...</h2></div></div></div><p>Let's understand Maven profiles by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <code class="literal">settings.xml</code> in the <code class="literal">conf</code> subfolder of your Maven installation (as specified in <code class="literal">M2_HOME</code>).</li><li class="listitem">View the commented section of profiles.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>How it works...</h2></div></div></div><p>Maven provides <a id="id194" class="indexterm"/>three type of profiles:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Per Project profile as defined<a id="id195" class="indexterm"/> in the pom file of the project</li><li class="listitem" style="list-style-type: disc">Per User profile<a id="id196" class="indexterm"/> as defined in the user settings file (in the <code class="literal">.m2</code> subfolder of the user's <code class="literal">HOME</code> folder)</li><li class="listitem" style="list-style-type: disc">A Global profile<a id="id197" class="indexterm"/> as defined in the global settings file (in the <code class="literal">conf</code> folder of <code class="literal">M2_HOME</code>)</li></ul></div><p>By creating different profiles for different variations of the project build, you can use the same pom file to create differing builds.</p><p>One should be careful to ensure that this does not result in a non-portable build.</p></div></div>
<div class="section" title="Adding a new Maven profile"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Adding a new Maven profile</h1></div></div></div><p>Let us add a simple Maven <a id="id198" class="indexterm"/>profile to test our understanding of profiles.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>How to do it...</h2></div></div></div><p>Let's create a new Maven profile, by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Maven project using the commands specified in the <span class="emphasis"><em>Creating a simple project with Maven</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</li><li class="listitem">Add the following code in the <code class="literal">pom.xml</code> file:<div class="informalexample"><pre class="programlisting">&lt;profiles&gt;
      &lt;profile&gt;
          &lt;id&gt;dev&lt;/id&gt;
          &lt;activation&gt;
              &lt;activeByDefault&gt;false&lt;/activeByDefault&gt;
          &lt;/activation&gt;
      &lt;/profile&gt;
  &lt;/profiles&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>How it works...</h2></div></div></div><p>There are two ways to create a profile: in the project's pom file or in the settings file. It is important to note that, if a profile is active from the settings file, its values will override any profiles with equivalent IDs in the pom file.</p><p>The profile in <code class="literal">pom.xml</code> can have the following elements:</p><div class="informalexample"><pre class="programlisting">&lt;profile&gt;
      &lt;id&gt;test&lt;/id&gt;
      &lt;activation&gt;...&lt;/activation&gt;
      &lt;build&gt;...&lt;/build&gt;
      &lt;modules&gt;...&lt;/modules&gt;
      &lt;repositories&gt;...&lt;/repositories&gt;
      &lt;pluginRepositories&gt;...&lt;/pluginRepositories&gt;
      &lt;dependencies&gt;...&lt;/dependencies&gt;
      &lt;reporting&gt;...&lt;/reporting&gt;
      &lt;dependencyManagement&gt;...&lt;/dependencyManagement&gt;
      &lt;distributionManagement&gt;...&lt;/distributionManagement&gt;
    &lt;/profile&gt;</pre></div><p>The profile in <code class="literal">settings.xml</code> can only have the following elements:</p><div class="informalexample"><pre class="programlisting">&lt;profile&gt;
      &lt;id&gt;test&lt;/id&gt;
      &lt;activation&gt;...&lt;/activation&gt;
      &lt;repositories&gt;...&lt;/repositories&gt;
      &lt;pluginRepositories&gt;...&lt;/pluginRepositories&gt;
      &lt;properties&gt;…&lt;/properties&gt;
      &lt;/profile&gt;</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Activating/deactivating a Maven profile</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Activating/deactivating a Maven profile"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Activating/deactivating a Maven profile</h1></div></div></div><p>A profile can be<a id="id199" class="indexterm"/> specified<a id="id200" class="indexterm"/> in <code class="literal">pom.xml</code> or <code class="literal">settings.xml</code>. Each profile may be created for a specific purpose; for instance, to run on a particular platform or to run in an integration environment. All profiles may not need to run in all cases. Maven provides a mechanism to activate and deactivate a profile as required.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>Getting ready</h2></div></div></div><p>Use the project where we created the profile to add a new Maven profile <a id="id201" class="indexterm"/>section.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>How to do it...</h2></div></div></div><p>Let's perform the following steps to activate/deactivate a Maven profile:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To deactivate a profile, set the following value in the <code class="literal">activeByDefault</code> element:<div class="informalexample"><pre class="programlisting">&lt;activeByDefault&gt;false&lt;/activeByDefault&gt;</pre></div></li><li class="listitem">Run the Maven command to check if the profile is active:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn help:active-profiles</strong></span>
</pre></div><p>The output for the preceding command is shown as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-help-plugin:2.2:active-profiles (default-cli) @ project-with-profile ---</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>Active Profiles for Project 'com.packt.cookbook:project-with-profile:jar:1.0-SNAPSHOT':</strong></span>
<span class="strong"><strong>The following profiles are active:</strong></span>
</pre></div></li><li class="listitem">To activate the profile, set the following value:<div class="informalexample"><pre class="programlisting">&lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</pre></div></li><li class="listitem">Confirm that the profile is now active, by executing the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn help:active-profiles</strong></span>
</pre></div><p>The output for preceding command is shown as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>The following profiles are active:</strong></span>
<span class="strong"><strong>- dev (source: com.packt.cookbook:project-with-profile:1.0-SNAPSHOT)</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec78"/>How it works...</h2></div></div></div><p>Profiles can be triggered in one of the following ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Explicitly: Here, Maven provides a command-line option to invoke a profile, shown in the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –P dev package</strong></span>
</pre></div><p>This invokes the <code class="literal">dev</code> profile</p></li><li class="listitem" style="list-style-type: disc">Through settings: A profile can be activated in the settings file by setting the <code class="literal">&lt;active&gt;</code> property to <code class="literal">true</code>. If activated, when the project is built, the profile is invoked:<div class="informalexample"><pre class="programlisting">  &lt;activeProfiles&gt;
    &lt;activeProfile&gt;dev&lt;/activeProfile&gt;
  &lt;/activeProfiles&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Based on environment variables: The profile can be activated based on any environment variable and the value that it has:<div class="informalexample"><pre class="programlisting">&lt;profile&gt;
    &lt;activation&gt;
      &lt;property&gt;
        &lt;name&gt;debug&lt;/name&gt;
      &lt;/property&gt;
    &lt;/activation&gt;
    ...
&lt;/profile&gt;</pre></div><p>If the system <a id="id202" class="indexterm"/>property <code class="literal">debug</code> is defined and has <a id="id203" class="indexterm"/>any value, then the profile is activated</p></li><li class="listitem" style="list-style-type: disc">Based on OS settings: The following profile will only run on Windows:<div class="informalexample"><pre class="programlisting">&lt;profile&gt;
    &lt;activation&gt;
      &lt;os&gt;
        &lt;family&gt;Windows&lt;/family&gt;
      &lt;/os&gt;
    &lt;/activation&gt;
    ...
  &lt;/profile&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Present or missing files: The following profile will be activated if the <code class="literal">target/site</code> file is missing:<div class="informalexample"><pre class="programlisting">&lt;profile&gt;
    &lt;activation&gt;
      &lt;file&gt;
        &lt;missing&gt;target/site&lt;/missing&gt;
      &lt;/file&gt;
    &lt;/activation&gt;
  &lt;/profile&gt;</pre></div></li></ul></div></div></div>
<div class="section" title="Using properties in Maven"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Using properties in Maven</h1></div></div></div><p>Maven allows us to<a id="id204" class="indexterm"/> define as well as use properties. Properties allow us to <a id="id205" class="indexterm"/>avoid hardcoding values in multiple places such as versions of dependencies. They also provide flexibility to the build tool by allowing values to be passed at runtime.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How to do it...</h2></div></div></div><p>Let's define and use Maven properties by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the pom file of a project that we created earlier.</li><li class="listitem">Define a property:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
    &lt;junit.version&gt;3.8.1&lt;/junit.version&gt;
&lt;/properties&gt;</pre></div></li><li class="listitem">Use the property:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;${junit.version}&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec80"/>How it works...</h2></div></div></div><p>There are different types of properties. They are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Environment variables: Prefixing a variable with <code class="literal">env.</code> will return the value of the shell's environment variable. For example, <code class="literal">${env.PATH}</code> will return the value of the <code class="literal">PATH</code> variable.</li><li class="listitem" style="list-style-type: disc">pom variables: Prefixing a variable with <code class="literal">project.</code> will return the value of that element in the pom file. For example, <code class="literal">${project.version}</code> will return the value in the <code class="literal">&lt;version&gt;</code> tag of the pom file.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">settings</code> variable: Prefixing a variable with <code class="literal">settings.</code> will return the value of that element in the settings file. For example, <code class="literal">${settings.offline}</code> will return the value <code class="literal">&lt;offline&gt;</code> in the settings file.</li><li class="listitem" style="list-style-type: disc">Java properties: Any property available through the <code class="literal">System.getProperties()</code> method in Java is available. For example, <code class="literal">${java.home}</code>.</li><li class="listitem" style="list-style-type: disc">Normal properties: Values that are specified in the <code class="literal">&lt;properties&gt;</code> tag, which is shown in the following example:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;java.version&gt;1.7&lt;/java.version&gt;
&lt;/properties&gt;</pre></div><p>Here, the <code class="literal">${java.version}</code> command will return <code class="literal">1.7</code>
</p></li></ul></div><p>Do remember <a id="id206" class="indexterm"/>that properties and profiles can break the portability of the<a id="id207" class="indexterm"/> project. Two specific practices for looking up in problem areas are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">External properties: These are properties defined outside the pom file (in a settings file) but used as part of a plugin configuration. The absence of this property definition will break the build.</li><li class="listitem" style="list-style-type: disc">Incomplete specification: This is where properties are defined for different build environments. A missing definition for one will break the build.</li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec81"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Specifying source encoding for platform-independent builds</em></span> recipe in this chapter.</li></ul></div></div></div>
<div class="section" title="Specifying source encoding for platform-independent builds"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Specifying source encoding for platform-independent builds</h1></div></div></div><p>Let us put our learning of <a id="id208" class="indexterm"/>properties to <a id="id209" class="indexterm"/>practical use. You will have observed the following warning while building the simple project that we created in the <span class="emphasis"><em>Building a simple project with Maven</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[WARNING] Using platform encoding (Cp1252 actually) to copy filtered resources,</strong></span>
i.e. build is platform dependent!
</pre></div><p>Let us remove this warning if we really do not want the build to be platform dependent.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec82"/>How to do it...</h2></div></div></div><p>Let's specify the source encoding for platform-independent builds in our Maven project, by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the pom file we created previously.</li><li class="listitem">Add the following code:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
      &lt;project.build.sourceEncoding&gt;UTF-8 &lt;/project.build.sourceEncoding&gt;
  &lt;/properties&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn package</strong></span>
</pre></div></li><li class="listitem">Observe that the warning is no longer present.</li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How it works...</h2></div></div></div><p>The <code class="literal">project.build.sourceEncoding</code> property <a id="id210" class="indexterm"/>explicitly specifies<a id="id211" class="indexterm"/> the encoding of the source files. Maven plugins get information about the encoding from the value of this property and use it.</p><p>This value will be the same on any platform that the project is built on and, thus, the build becomes independent of the platform.</p></div></div></body></html>