<html><head></head><body>
  <div id="_idContainer216" class="Basic-Text-Frame">
    <h1 class="chapterNumber">10</h1>
    <h1 id="_idParaDest-133" class="chapterTitle">Consuming the REST API with React</h1>
    <p class="normal">This chapter explains networking with React. This is a really important skill that we need in most React apps. We will learn about promises, which make asynchronous code cleaner and more readable. For networking, we will use the <code class="inlineCode">fetch</code> and Axios libraries. As an example, we will use the OpenWeather and GitHub REST APIs to demonstrate how to consume RESTful web services with React. We will also see the React Query library in action.</p>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Promises</li>
      <li class="bulletList">Using the <code class="inlineCode">fetch</code> API</li>
      <li class="bulletList">Using the Axios library</li>
      <li class="bulletList">Practical examples</li>
      <li class="bulletList">Handling race conditions</li>
      <li class="bulletList">Using the React Query library</li>
    </ul>
    <h1 id="_idParaDest-134" class="heading-1">Technical requirements</h1>
    <p class="normal">The following GitHub link will be required: <a href="https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter10"><span class="url">https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter10</span></a>.</p>
    <h1 id="_idParaDest-135" class="heading-1">Promises</h1>
    <p class="normal">The traditional way<a id="_idIndexMarker534"/> to handle an asynchronous operation is to use <strong class="keyWord">callback functions</strong> for the success or failure<a id="_idIndexMarker535"/> of the operation. If the operation succeeds, the <code class="inlineCode">success</code> function is ­called; otherwise, the <code class="inlineCode">failure</code> function is called. The following (abstract) example shows the idea of using a callback function:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">function</span> <span class="hljs-title">doAsyncCall</span>(<span class="hljs-params">success,  failure</span>) {
  <span class="hljs-comment">// Do some API call</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable">SUCCEED</span>)
    <span class="hljs-title">success</span>(resp);
  <span class="hljs-keyword">else</span>
    <span class="hljs-title">failure</span>(err);
}
<span class="hljs-title">success</span>(<span class="hljs-params">response</span>) {
  <span class="hljs-comment">// Do something with response</span>
}
<span class="hljs-title">failure</span>(<span class="hljs-params">error</span>) {
  <span class="hljs-comment">// Handle error</span>
}
<span class="hljs-title">doAsyncCall</span>(success, failure);
</code></pre>
    <p class="normal">Nowadays, <strong class="keyWord">promises</strong> are a fundamental part of asynchronous programming in JavaScript. A promise is an object that represents the result of an asynchronous operation. The use of promises simplifies the code when you’re executing asynchronous calls. Promises are non-blocking. If you are using an older library for asynchronous operations that doesn’t support promises, the code becomes much more difficult to read and maintain. In that case, you will end up with multiple nested callbacks that are really hard to read. Error handling will also be hard because you will have to check for errors in each callback.</p>
    <p class="normal">With promises, we can execute asynchronous calls if the API or library we are using to send requests supports promises. In the following example, an asynchronous call is made. When the response is returned, the callback function inside the <code class="inlineCode">then</code> method is executed, taking the response as an argument:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">doAsyncCall</span>()
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-comment">// Do something with the response)</span>
</code></pre>
    <p class="normal">The <code class="inlineCode">then</code> method returns a promise. A promise can be in one of three states:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Pending</strong>: Initial state</li>
      <li class="bulletList"><strong class="keyWord">Fulfilled (or Resolved)</strong>: Successful operation</li>
      <li class="bulletList"><strong class="keyWord">Rejected</strong>: Failed operation</li>
    </ul>
    <p class="normal">The following code demonstrates a simple promise object, where <code class="inlineCode">setTimeout</code> simulates an asynchronous operation:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title">Promise</span>(<span class="hljs-function">(</span><span class="hljs-params">resolve, reject</span><span class="hljs-function">) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title">resolve</span>(<span class="hljs-string">"Hello"</span>);
  }, <span class="hljs-number">500</span>);
});
</code></pre>
    <p class="normal">The promise is in the <strong class="keyWord">pending</strong> state when the promise object<a id="_idIndexMarker536"/> is created and while the timer is running. After 500 milliseconds, the <code class="inlineCode">resolve</code> function is called with the value <code class="inlineCode">"Hello"</code> and the promise enters the <strong class="keyWord">fulfilled</strong> state. If there is an error, the promise state changes to <strong class="keyWord">rejected</strong>, and that can be handled using the <code class="inlineCode">catch()</code> function, which we’ll show later.</p>
    <p class="normal">You can chain many instances of <code class="inlineCode">then</code> together, which means that you can run multiple asynchronous operations one after another:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">doAsyncCall</span>()
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-comment">// Get some data from the response)</span>
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-comment">// Do something with the data</span>
</code></pre>
    <p class="normal">You can also add error handling to promises by using <code class="inlineCode">catch()</code>. The <code class="inlineCode">catch()</code> is executed if any error occurs in the preceding <code class="inlineCode">then</code> chain:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">doAsyncCall</span>()
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-comment">// Get some data from the response)</span>
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-comment">// Do something with data)</span>
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <h2 id="_idParaDest-136" class="heading-2">async and await</h2>
    <p class="normal">There is a more modern way to handle asynchronous<a id="_idIndexMarker537"/> calls that involves <code class="inlineCode">async</code>/<code class="inlineCode">await</code>, which<a id="_idIndexMarker538"/> was introduced in ECMAScript 2017. The <code class="inlineCode">async</code>/<code class="inlineCode">await</code> method is based on promises. To use <code class="inlineCode">async</code>/<code class="inlineCode">await</code>, you must define an <code class="inlineCode">async()</code> function that can contain <code class="inlineCode">await</code> expressions.</p>
    <p class="normal">The following is an example of an asynchronous call containing <code class="inlineCode">async</code>/<code class="inlineCode">await</code>. As you can see, you can write the code in a similar way to synchronous code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">doAsyncCall</span> = <span class="code-highlight"><strong class="hljs-keyword-slc">async</strong></span> () =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>);
  <span class="hljs-keyword">const</span> data = <span class="code-highlight"><strong class="hljs-keyword-slc">await</strong></span> response.<span class="hljs-title">json</span>();
  <span class="hljs-comment">// Do something with the data</span>
}
</code></pre>
    <p class="normal">The <code class="inlineCode">fetch()</code> function returns a promise, but now it is handled using <code class="inlineCode">await</code> instead of the <code class="inlineCode">then</code> method.</p>
    <p class="normal">For error handling, you can use <code class="inlineCode">try...catch</code> with <code class="inlineCode">async</code>/<code class="inlineCode">await</code>, as shown in the following example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">doAsyncCall</span> = <span class="hljs-keyword">async</span> () =&gt; {
  <span class="code-highlight"><strong class="hljs-keyword-slc">try</strong><strong class="hljs-slc"> {</strong></span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title">json</span>();
    <span class="hljs-comment">// Do something with the data</span>
  <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
  <span class="code-highlight"><strong class="hljs-keyword-slc">catch</strong><strong class="hljs-slc">(err) {</strong></span>
    <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err);
  <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
<span class="code-highlight"><strong class="hljs-slc">}</strong></span>
</code></pre>
    <p class="normal">Now that we understand <a id="_idIndexMarker539"/>promises, we can start learning<a id="_idIndexMarker540"/> about the <code class="inlineCode">fetch</code> API, which we can use to make requests in our React apps.</p>
    <h1 id="_idParaDest-137" class="heading-1">Using the fetch API</h1>
    <p class="normal">With the <code class="inlineCode">fetch</code> API, you can make web<a id="_idIndexMarker541"/> requests. The idea of the <code class="inlineCode">fetch</code> API is similar to the traditional <code class="inlineCode">XMLHttpRequest</code> or jQuery Ajax API, but the <code class="inlineCode">fetch</code> API also supports promises, which makes it more straightforward to use. You don’t have to install any libraries if you are using <code class="inlineCode">fetch</code> and it is supported by modern browsers natively.</p>
    <p class="normal">The <code class="inlineCode">fetch</code> API provides a <code class="inlineCode">fetch()</code> method that has one mandatory argument: the path of the resource you are calling. In the case of a web request, it will be the URL of the service. For a simple <code class="inlineCode">GET</code> method call, which returns a response, the syntax is as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>)
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(data))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <p class="normal">The <code class="inlineCode">fetch()</code> method returns a promise that contains the response. You can use the <code class="inlineCode">json()</code> method to extract the JSON data from a response, and this method also returns a promise.</p>
    <p class="normal">The <code class="inlineCode">response</code> that is passed<a id="_idIndexMarker542"/> to the first <code class="inlineCode">then</code> statement is an object that contains the properties <code class="inlineCode">ok</code> and <code class="inlineCode">status</code>, which we can use to check whether the request was successful. The <code class="inlineCode">ok</code> property value is <code class="inlineCode">true</code> if the response status is in the form <code class="inlineCode">2XX</code>:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>)
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> { 
  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>)
    <span class="hljs-comment">// Successful request -&gt; Status 2XX</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-comment">// Something went wrong -&gt; Error response</span>
})
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(data))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <p class="normal">To use another HTTP method, such as <code class="inlineCode">POST</code>, you must define it in the second argument of the <code class="inlineCode">fetch()</code> method. The second argument is an object where you can define multiple request settings. The following source code makes the request using the <code class="inlineCode">POST</code> method:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span><span class="code-highlight"><strong class="hljs-slc">, {</strong><strong class="hljs-attr-slc">method</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">'POST'</strong><strong class="hljs-slc">}</strong></span>)
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(data))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <p class="normal">You can also add headers inside the second argument. The following <code class="inlineCode">fetch()</code> call contains the <code class="inlineCode">'Content-Type':'application/json'</code> header. It is recommended that you add the <code class="inlineCode">'Content-Type'</code> header because then the server can interpret the request body correctly:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>,
  {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="code-highlight"><strong class="hljs-attr-slc">headers</strong><strong class="hljs-slc">: {</strong><strong class="hljs-string-slc">'Content-Type'</strong><strong class="hljs-slc">:</strong><strong class="hljs-string-slc">'application/json'</strong><strong class="hljs-slc">}</strong></span>
  }
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(data))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <p class="normal">If you have to send JSON-encoded data inside the request body, the syntax to do so is as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">fetch</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi.</span> <span class="hljs-string">com'</span>,
{
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">headers</span>: {<span class="hljs-string">'Content-Type'</span>:<span class="hljs-string">'</span><span class="hljs-string">application/json'</span>},
  <span class="code-highlight"><strong class="hljs-attr-slc">body</strong><strong class="hljs-slc">: </strong><strong class="hljs-title-slc">JSON</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">stringify</strong><strong class="hljs-slc">(data)</strong></span>
}
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
.<span class="hljs-title">then</span>(<span class="hljs-params">data</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(data))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(error))
</code></pre>
    <p class="normal">The <code class="inlineCode">fetch</code> API is not the only way to execute requests<a id="_idIndexMarker543"/> in the React app. There are other libraries that you can use as well. In the next section, we will learn how to use one such popular library: <code class="inlineCode">axios</code>.</p>
    <h1 id="_idParaDest-138" class="heading-1">Using the Axios library</h1>
    <p class="normal">You can also use other libraries<a id="_idIndexMarker544"/> for network calls. One very popular library is <code class="inlineCode">axios</code> (<a href="https://github.com/axios/axios"><span class="url">https://github.com/axios/axios</span></a>), which you can install in your React app with <code class="inlineCode">npm</code>:</p>
    <pre class="programlisting con"><code class="hljs-con">npm install axios
</code></pre>
    <p class="normal">You must add the following <code class="inlineCode">import</code> statement to your React component before using it:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
</code></pre>
    <p class="normal">The <code class="inlineCode">axios</code> library has some benefits, such as automatic transformation of the JSON data, so you don’t need the <code class="inlineCode">json()</code> function when using <code class="inlineCode">axios</code>. The following code shows an example call being made using <code class="inlineCode">axios</code>:</p>
    <pre class="programlisting code"><code class="hljs-code">axios.<span class="hljs-title">get</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>)
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(response))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(error))
</code></pre>
    <p class="normal">The <code class="inlineCode">axios</code> library has its own call methods for the different HTTP methods. For example, if you want to make a <code class="inlineCode">POST</code> request and send an object in the body, <code class="inlineCode">axios</code> provides the <code class="inlineCode">axios.post()</code> method:</p>
    <pre class="programlisting code"><code class="hljs-code">axios.<span class="hljs-title">post</span>(<span class="hljs-string">'http</span> <span class="hljs-string">://someapi</span> <span class="hljs-string">.com'</span>, { newObject })
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(response))
.<span class="hljs-title">catch</span>(<span class="hljs-params">error</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(error))
</code></pre>
    <p class="normal">You can also use the <code class="inlineCode">axios()</code> function and pass a configuration object that specifies the request details, such as the method, header, data, and URL:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title">axios</span>({
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https</span> <span class="hljs-string">://myapi</span> <span class="hljs-string">.com/api/cars'</span>,
  <span class="hljs-attr">headers</span>: { <span class="hljs-string">'</span><span class="hljs-string">Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">brand</span>: <span class="hljs-string">'Ford'</span>, <span class="hljs-attr">model</span>: <span class="hljs-string">'Ranger'</span> },
});
</code></pre>
    <p class="normal">The example code above sends a POST request to the <span class="url">https</span> <span class="url">://myapi</span> <span class="url">.com/api/cars</span> endpoint. The request body contains<a id="_idIndexMarker545"/> an object and Axios automatically stringifies the data.</p>
    <p class="normal">Now, we are ready to look at a few practical examples involving networking with React.</p>
    <h1 id="_idParaDest-139" class="heading-1">Practical examples</h1>
    <p class="normal">In this section, we will go through two examples of using public REST APIs in your React apps. In the first example, we use the OpenWeather API to fetch the current weather for London and render it in the component. In the second example, we use the GitHub API and allow the user to fetch repositories by keyword.</p>
    <h2 id="_idParaDest-140" class="heading-2">OpenWeather API</h2>
    <p class="normal">First, we will make a React app<a id="_idIndexMarker546"/> that shows the current weather in London. We will show the temperature, description, and weather icon in our app. This weather<a id="_idIndexMarker547"/> data will be fetched from <strong class="keyWord">OpenWeather</strong> (<a href="https://openweathermap.org/"><span class="url">https://openweathermap.org/</span></a>).</p>
    <p class="normal">You need to register with OpenWeather to get an API key. A free account will be sufficient for our needs. Once you have registered, navigate to your account information to find the <strong class="screenText">API keys</strong> tab. There, you’ll see the API key that you need for your React weather app:</p>
    <figure class="mediaobject"><img src="../Images/B19818_10_01.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.1: The OpenWeather API key</p>
    <div class="note">
      <p class="normal">Your API key will be activated automatically, up to 2 hours after your successful registration, so you may have to wait a while before you can use it in this section.</p>
    </div>
    <p class="normal">Let’s create a new React<a id="_idIndexMarker548"/> app with Vite:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open a terminal in Windows or Terminal in macOS/Linux, and type the following command:
        <pre class="programlisting con"><code class="hljs-con">npm create vite@latest
</code></pre>
      </li>
      <li class="numberedList">Name your app <code class="inlineCode">weatherapp</code> and select the <strong class="screenText">React</strong> framework and <strong class="screenText">JavaScript</strong> variant.</li>
      <li class="numberedList">Navigate to the <code class="inlineCode">weatherapp</code> folder and install dependencies:
        <pre class="programlisting con"><code class="hljs-con">cd weatherapp
npm install
</code></pre>
      </li>
      <li class="numberedList">Start your app with the following command:
        <pre class="programlisting con"><code class="hljs-con">npm run dev
</code></pre>
      </li>
      <li class="numberedList">Open your project folder with VS Code and open the <code class="inlineCode">App.jsx</code> file in the editor view. Remove all the code inside the fragment (<code class="inlineCode">&lt;&gt;&lt;/&gt;</code>)and remove unused imports. Now, your source code should look as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
      </li>
      <li class="numberedList">First, we must add<a id="_idIndexMarker549"/> the states that are needed to store response data. We will show the temperature, description, and weather icon in our app. We have three related values, so it is better to create one state that is an object instead of creating multiple individual states:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { useState } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'react'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> [weather, setWeather] = </strong><strong class="hljs-title-slc">useState</strong><strong class="hljs-slc">({</strong></span>
      <span class="code-highlight"><strong class="hljs-attr-slc">temp</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">''</strong><strong class="hljs-slc">, </strong><strong class="hljs-attr-slc">desc</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">''</strong><strong class="hljs-slc">, </strong><strong class="hljs-attr-slc">icon</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">''</strong></span>
  <span class="code-highlight"><strong class="hljs-slc">});</strong></span>
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
      </li>
      <li class="numberedList">When you are using a REST API, you should inspect the response so you can see the format of the JSON data. Here is the address that returns the current weather for London: <a href="https://api.openweathermap.org/data/2.5/weather?q=London&amp;units=Metric&amp;APIkey=YOUR_KEY"><span class="url">https://api.openweathermap.org/data/2.5/weather?q=London&amp;units=Metric&amp;APIkey=YOUR_KEY</span></a>.
    <p class="normal">If you copy the URL into a browser, you can view the JSON response data:</p>
    <figure class="mediaobject"><img src="../Images/B19818_10_02.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.2: Get weather by city</p>
    <p class="normal">From the response, you can<a id="_idIndexMarker550"/> see that <code class="inlineCode">temp</code> can be accessed using <code class="inlineCode">main.temp</code>. You can also see that <code class="inlineCode">description</code> and <code class="inlineCode">icon</code> are inside the <code class="inlineCode">weather</code> array, which has only one element, and that we can access it using <code class="inlineCode">weather[0].description</code> and <code class="inlineCode">weather[0].icon</code>.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">We will implement the <code class="inlineCode">fetch</code> call in the next few steps, inside the <code class="inlineCode">useEffect</code> hook function. Import <code class="inlineCode">useEffect</code> from React:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState<span class="code-highlight"><strong class="hljs-slc">, useEffect</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
</code></pre>
      </li>
      <li class="numberedList">The REST API call is executed using <code class="inlineCode">fetch</code> in the <code class="inlineCode">useEffect</code> hook function, using an empty array as the second argument. Therefore, the fetch is done once, after the first render. After a successful response, we save the weather data to the states. Once the state values have been changed, the component will be re-rendered. The following is the source code for the <code class="inlineCode">useEffect</code> hook function. It will execute the <code class="inlineCode">fetch()</code> function once after the first render (Note! Use your own API key in the code.):
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">useEffect</span>(<span class="hljs-function">() =&gt;</span> {   
  <span class="hljs-title">fetch</span>(<span class="hljs-string">'https://api.openweathermap.org/data/2.5/</span>
<span class="hljs-string">         weather?q=London&amp;APIKey=YOUR_API_KEY&amp;units=metric'</span>)
  .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
  .<span class="hljs-title">then</span>(<span class="hljs-params">result</span><span class="hljs-function"> =&gt;</span> {
    <span class="hljs-title">setWeather</span>({
      <span class="hljs-attr">temp</span>: result.<span class="hljs-property">main</span>.<span class="hljs-property">temp</span>, 
      <span class="hljs-attr">desc</span>: result.<span class="hljs-property">weather</span>[<span class="hljs-number">0</span>].<span class="hljs-property">main</span>, 
      <span class="hljs-attr">icon</span>: result.<span class="hljs-property">weather</span>[<span class="hljs-number">0</span>].<span class="hljs-property">icon</span>
    });
  })
  .<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err))
}, [])
</code></pre>
      </li>
      <li class="numberedList">Once you have added the <code class="inlineCode">useEffect</code> function, the request is executed after the first render. We can check<a id="_idIndexMarker551"/> that everything has been done correctly using React Developer Tools. Open your app in a browser and open your React Developer Tools <strong class="screenText">Components</strong> tab. Now, you can see that the states have been updated with the values from the response:
    <figure class="mediaobject"><img src="../Images/B19818_10_03.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.3: Weather component</p>
    <p class="normal">You can also check that the request status is <code class="inlineCode">200 OK</code> from the <strong class="screenText">Network</strong> tab.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="11">Finally, we will implement the <code class="inlineCode">return</code> statement<a id="_idIndexMarker552"/> to show the weather values. We will use <strong class="keyWord">conditional rendering</strong> here; otherwise, we will get an error because we don’t have image code in the first render call and the image upload won’t succeed.
    <p class="normal">To show the weather icon, we must add <code class="inlineCode">https://openweathermap.org/img/wn/</code> before the icon code, and <code class="inlineCode">@2x.png</code> after the icon code.</p>
    <div class="note">
      <p class="normal">You can find information about icons in the OpenWeather documentation: <a href="https://openweathermap.org/weather-conditions"><span class="url">https://openweathermap.org/weather-conditions</span></a>.</p>
    </div>
    <p class="normal">Then, we can set the concatenated<a id="_idIndexMarker553"/> image URL as the <code class="inlineCode">img</code> element’s <code class="inlineCode">src</code> attribute. Temperature and description are shown in the paragraph element. <code class="inlineCode">°C</code> is the degrees Celsius symbol:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">if</span> (weather.<span class="hljs-property">icon</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Temperature: {weather.temp} °C<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Description: {weather.desc}<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">img</span><span class="hljs-tag"> </span><span class="hljs-attr">src</span><span class="hljs-tag">=</span><span class="hljs-string">{</span><span class="hljs-tag">`</span><span class="hljs-attr">http:</span><span class="hljs-tag">//</span><span class="hljs-attr">openweathermap.org</span><span class="hljs-tag">/</span><span class="hljs-attr">img</span><span class="hljs-tag">/</span><span class="hljs-attr">wn</span><span class="hljs-tag">/${</span><span class="hljs-attr">weather.                 icon</span><span class="hljs-tag">}@</span><span class="hljs-attr">2x.png</span><span class="hljs-tag">`}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">alt</span><span class="hljs-tag">=</span><span class="hljs-string">"Weather icon"</span><span class="hljs-tag"> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>Loading...<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
}
</code></pre></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="12">Now, your app should be ready. When you open it in a browser, it should look as follows:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_10_04.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.4: WeatherApp</p>
    <p class="normal">The source code<a id="_idIndexMarker554"/> for the entire <code class="inlineCode">App.jsx</code> file is as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">const</span> [weather, setWeather] = <span class="hljs-title">useState</span>({<span class="hljs-attr">temp</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">desc</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">''</span>});
 
  <span class="hljs-title">useEffect</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-title">fetch</span>(<span class="hljs-string">'https://api.openweathermap.org/data/2.5/weather?q=\</span>
          <span class="hljs-string">London&amp;APIKey=YOUR_API_KEY&amp;units=metric'</span>)
    .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
    .<span class="hljs-title">then</span>(<span class="hljs-params">result</span><span class="hljs-function"> =&gt;</span> {
      <span class="hljs-title">setWeather</span>({
        <span class="hljs-attr">temp</span>: result.<span class="hljs-property">main</span>.<span class="hljs-property">temp</span>, 
        <span class="hljs-attr">desc</span>: result.<span class="hljs-property">weather</span>[<span class="hljs-number">0</span>].<span class="hljs-property">main</span>, 
        <span class="hljs-attr">icon</span>: result.<span class="hljs-property">weather</span>[<span class="hljs-number">0</span>].<span class="hljs-property">icon</span>
      });
    })
    .<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err))
  }, [])
  <span class="hljs-keyword">if</span> (weather.<span class="hljs-property">icon</span>) {
    <span class="hljs-keyword">return</span> (
      <span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Temperature: {weather.temp} °C<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Description: {weather.desc}<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">img</span><span class="hljs-tag"> </span><span class="hljs-attr">src</span><span class="hljs-tag">=</span><span class="hljs-string">{</span>
<span class="hljs-string">            </span><span class="hljs-tag">`</span><span class="hljs-attr">https</span> <span class="hljs-attr">:</span><span class="hljs-tag">//</span><span class="hljs-attr">openweathermap</span> <span class="hljs-attr">.org</span><span class="hljs-tag">/</span><span class="hljs-attr">img</span><span class="hljs-tag">/</span><span class="hljs-attr">wn</span><span class="hljs-tag">/${</span><span class="hljs-attr">weather.icon</span><span class="hljs-tag">}@</span><span class="hljs-attr">2x.png</span><span class="hljs-tag">`</span>
<span class="hljs-tag">        }</span>
<span class="hljs-tag">        </span><span class="hljs-attr">alt</span><span class="hljs-tag">=</span><span class="hljs-string">"Weather icon"</span><span class="hljs-tag"> /&gt;</span>
      <span class="hljs-tag">&lt;/&gt;</span>
    );
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;&gt;</span>Loading...<span class="hljs-tag">&lt;/&gt;</span>
  }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>
</code></pre>
    <p class="normal">In our example, we checked that the weather icon was loaded to check if the fetch was completed. This is not the optimal solution because if the fetch ends in an error, our component still renders a loading message. The boolean state is used a lot in scenarios like this, but it doesn’t solve the problem either. The best solution would be a status that indicates the exact state of the request (pending, resolved, rejected). You can read more about this in Kent C. Dodds’ blog post, <em class="italic">Stop using isLoading Booleans</em>: <a href="https://kentcdodds.com/blog/stop-using-isloading-booleans"><span class="url">https://kentcdodds.com/blog/stop-using-isloading-booleans</span></a>. This problem is solved by the React Query<a id="_idIndexMarker555"/> library, which we will use later in this chapter.</p>
    <h2 id="_idParaDest-141" class="heading-2">GitHub API</h2>
    <p class="normal">In the second example, we are going<a id="_idIndexMarker556"/> to create an app that uses the GitHub API to fetch repositories by keyword. The user enters a keyword, and we fetch repositories that contain that keyword. We will use the <code class="inlineCode">axios</code> library for web requests, and we will also practice using TypeScript in this example.</p>
    <p class="normal">Let’s first see how you can send a <code class="inlineCode">GET</code> request using <code class="inlineCode">axios</code> with TypeScript. You can make a <code class="inlineCode">GET</code> request and specify the expected data type using TypeScript generics, as shown in the following example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
type <span class="hljs-title">MyDataType</span> = {
  <span class="hljs-attr">id</span>: number;
  <span class="hljs-attr">name</span>: string;
}
axios.<span class="hljs-property">get</span>&lt;<span class="hljs-title">MyDataType</span>&gt;(apiUrl)
.<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">log</span>(response.<span class="hljs-property">data</span>))
.<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err));
</code></pre>
    <p class="normal">If you try to access some field<a id="_idIndexMarker557"/> that is not present in the expected data type, you will get an error early in the development phase. At this point, it is important to understand that TypeScript is compiled to JavaScript and all type information is removed. Therefore, TypeScript doesn’t have a direct impact on runtime behavior. If a REST API returns data of a different type than expected, TypeScript won’t catch this as a runtime error.</p>
    <p class="normal">Now, we can start to develop our GitHub app:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a new React app called <code class="inlineCode">restgithub</code> using Vite, selecting the <strong class="screenText">React</strong> framework and <strong class="screenText">TypeScript</strong> variant.</li>
      <li class="numberedList">Install dependencies, start the app, and open the project folder with VS Code.</li>
      <li class="numberedList">Install <code class="inlineCode">axios</code> using the following <code class="inlineCode">npm</code> command in your project folder:
        <pre class="programlisting con"><code class="hljs-con">npm install axios
</code></pre>
      </li>
      <li class="numberedList">Remove the extra code inside the fragment <code class="inlineCode">&lt;&gt;&lt;/&gt;</code> from the <code class="inlineCode">App.tsx</code> file. Your <code class="inlineCode">App.tsx</code> code should look as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
    <p class="normal">The URL of the GitHub REST API to search repositories is as follows: <code class="inlineCode">https://api.github.com/search/repositories?q={KEYWORD}</code>.</p>
    <div class="note">
      <p class="normal">You can find the GitHub REST API documentation at <a href="https://docs.github.com/en/rest"><span class="url">https://docs.github.com/en/rest</span></a>.</p>
    </div>
    <p class="normal">Let’s inspect the JSON response by typing the URL into a browser and using the <code class="inlineCode">react</code> keyword:</p>
    <figure class="mediaobject"><img src="../Images/B19818_10_05.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.5: GitHub REST API</p>
    <p class="normal">From the response, we can see that repositories are returned as a JSON array called <code class="inlineCode">items</code>. From the individual repositories, we will show the <code class="inlineCode">full_name</code> and <code class="inlineCode">html_url</code> values.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">We will present the data<a id="_idIndexMarker558"/> in the table and use the <code class="inlineCode">map()</code> function to transform the values into table rows, as shown in <em class="chapterRef">Chapter 8</em>. The <code class="inlineCode">id</code> can be used as a key for a table row.
    <p class="normal">We are going to make the REST API call with the keyword from the user input. One way to implement this is to create an input field and button. The user types the keyword into the input field, and the REST API call is made when the button is pressed.</p>
    <div class="packt_tip">
      <p class="normal">We can’t make the REST API call in the <code class="inlineCode">useEffect()</code> hook function because, in that phase, the user input isn’t available when the component is rendered the first time.</p>
    </div>
    <p class="normal">We will create two states, one for the user input and one for the data from the JSON response. When we are using TypeScript, we have to define a type for the repository, as shown in the following code. The <code class="inlineCode">repodata</code> state is an array of <code class="inlineCode">Repository</code> type because repositories are returned as JSON arrays in the response. We only need to access three fields; therefore, only these fields are defined in the type. We will also import <code class="inlineCode">axios</code>, which we’ll use later when sending a request:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
type <span class="hljs-title">Repository</span> = {
  <span class="hljs-attr">id</span>: number;
  <span class="hljs-attr">full_name</span>: string;
  <span class="hljs-attr">html_url</span>: string;
};
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = <span class="hljs-title">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [repodata, setRepodata] = useState&lt;<span class="hljs-title">Repository</span>[]&gt;([]);
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Next, we will implement<a id="_idIndexMarker559"/> the input field and the button in the <code class="inlineCode">return</code> statement. We also have to add a change listener to our input field to be able to save the input value to a state called <code class="inlineCode">keyword</code>. The button has a click listener, which invokes the function that will make the REST API call with the given keyword:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">handleClick</span> = () =&gt; {
  <span class="hljs-comment">// REST API call</span>
}
<span class="hljs-keyword">return</span> (
  <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">input</span>
<span class="hljs-tag">      </span><span class="hljs-attr">value</span><span class="hljs-tag">=</span><span class="hljs-string">{keyword}</span>
<span class="hljs-tag">      </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{e</span><span class="hljs-tag"> =&gt;</span> setKeyword(e.target.value)} 
<span class="hljs-attr">    </span>/&gt;
    <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">onClick</span><span class="hljs-tag">=</span><span class="hljs-string">{handleClick}</span><span class="hljs-tag">&gt;</span>Fetch<span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/&gt;</span>
);
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">handleClick()</code> function, we will concatenate the <code class="inlineCode">url</code> and <code class="inlineCode">keyword</code> states using template literals (Note! Use backticks <code class="inlineCode">``</code>). We will use the <code class="inlineCode">axios.get()</code> method to send a request. As we learned earlier, Axios does not require the <code class="inlineCode">.json()</code> method to be called on the response. Axios automatically parses the response data, and then we save the <code class="inlineCode">items</code> array from the response data to the <code class="inlineCode">repodata</code> state. We also use <code class="inlineCode">catch()</code> to handle errors. Since we are using TypeScript, we will define the expected data type in the <code class="inlineCode">GET</code> request. We have seen that the response is an object that contains an <code class="inlineCode">item</code> property. The content of the <code class="inlineCode">item</code> property is an array of repository objects; therefore, the data type is <code class="inlineCode">&lt;{ items: Repository[] }&gt;</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> <span class="hljs-title">handleClick</span> = () =&gt; {
  axios.<span class="hljs-property">get</span>&lt;{ <span class="hljs-attr">items</span>: <span class="hljs-title">Repository</span>[] }&gt; (<span class="hljs-string">`https://api.github.com/</span>
<span class="hljs-string">              search/repositories?q=</span><span class="hljs-subst">${keyword}</span><span class="hljs-string">`</span>)
  .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-title">setRepodata</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">items</span>))
  .<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err))
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">return</code> statement, we will use<a id="_idIndexMarker560"/> the <code class="inlineCode">map()</code> function to transform the <code class="inlineCode">data</code> state into table rows. The <code class="inlineCode">url</code> property of a repository will be the <code class="inlineCode">href</code> value of the <code class="inlineCode">&lt;a&gt;</code> element. Each repository has a unique <code class="inlineCode">id</code> property, which we can use as a key for a table row. We use conditional rendering to handle cases where the response doesn’t return any repositories:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">return</span> (
  <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">input</span>
<span class="hljs-tag">      </span><span class="hljs-attr">value</span><span class="hljs-tag">=</span><span class="hljs-string">{keyword}</span>
<span class="hljs-tag">      </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{e</span><span class="hljs-tag"> =&gt;</span> setKeyword(e.target.value)} 
    /&gt;
    <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">onClick</span><span class="hljs-tag">=</span><span class="hljs-string">{handleClick}</span><span class="hljs-tag">&gt;</span>Fetch<span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
    <span class="code-highlight"><strong class="hljs-slc">{repodata.length === 0 ? (</strong></span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">p</strong><strong class="hljs-tag-slc">&gt;</strong><strong class="hljs-slc">No data available</strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">p</strong><strong class="hljs-tag-slc">&gt;</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">)</strong></span> <span class="code-highlight"><strong class="hljs-slc">:</strong></span> <span class="code-highlight"><strong class="hljs-slc">(</strong></span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">table</strong><strong class="hljs-tag-slc">&gt;</strong></span>
        <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">tbody</strong><strong class="hljs-tag-slc">&gt;</strong></span>
          <span class="code-highlight"><strong class="hljs-slc">{repodata.map(repo =&gt; (</strong></span>
            <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">tr</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">key</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">{repo.id}</strong><strong class="hljs-tag-slc">&gt;</strong></span>
              <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">td</strong><strong class="hljs-tag-slc">&gt;</strong><strong class="hljs-slc">{repo.full_name}</strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">td</strong><strong class="hljs-tag-slc">&gt;</strong></span>
              <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">td</strong><strong class="hljs-tag-slc">&gt;</strong></span>
                <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">a</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">href</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">{repo.html_url}</strong><strong class="hljs-tag-slc">&gt;</strong><strong class="hljs-slc">{repo.html_url}</strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">a</strong><strong class="hljs-tag-slc">&gt;</strong></span>
              <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">td</strong><strong class="hljs-tag-slc">&gt;</strong></span>
            <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">tr</strong><strong class="hljs-tag-slc">&gt;</strong></span>
          <span class="code-highlight"><strong class="hljs-slc">))}</strong></span>
        <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">tbody</strong><strong class="hljs-tag-slc">&gt;</strong></span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">table</strong><strong class="hljs-tag-slc">&gt;</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">)}</strong></span> 
  <span class="hljs-tag">&lt;/&gt;</span>
);
</code></pre>
      </li>
      <li class="numberedList">The following screenshot shows the final app<a id="_idIndexMarker561"/> upon using the <code class="inlineCode">react</code> keyword in the REST API call:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_10_06.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.6: GitHub REST API</p>
    <p class="normal">The source code for the <code class="inlineCode">App.jsx</code> file looks as follows:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
type <span class="hljs-title">Repository</span> = {
  <span class="hljs-attr">id</span>: number;
  <span class="hljs-attr">full_name</span>: string;
  <span class="hljs-attr">html_url</span>: string;
};
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = <span class="hljs-title">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [repodata, setRepodata] = useState&lt;<span class="hljs-title">Repository</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> <span class="hljs-title">handleClick</span> = () =&gt; {
    axios.<span class="hljs-property">get</span>&lt;{ <span class="hljs-attr">items</span>: <span class="hljs-title">Repository</span>[] 
      }&gt;(<span class="hljs-string">`https://api.github.com/search/repositories?q=</span><span class="hljs-subst">${keyword}</span><span class="hljs-string">`</span>)
    .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> <span class="hljs-title">setRepodata</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">items</span>))
    .<span class="hljs-title">catch</span>(<span class="hljs-params">err</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">console</span>.<span class="hljs-title">error</span>(err));
  }
  
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">input</span>
<span class="hljs-tag">        </span><span class="hljs-attr">value</span><span class="hljs-tag">=</span><span class="hljs-string">{keyword}</span>
<span class="hljs-tag">        </span><span class="hljs-attr">onChange</span><span class="hljs-tag">=</span><span class="hljs-string">{e</span><span class="hljs-tag"> =&gt;</span> setKeyword(e.target.value)} 
<span class="hljs-attr">      </span>/&gt;
      <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">onClick</span><span class="hljs-tag">=</span><span class="hljs-string">{handleClick}</span><span class="hljs-tag">&gt;</span>Fetch<span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
      {repodata.length === 0 ? (
        <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>No data available<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;</span><span class="hljs-name">table</span><span class="hljs-tag">&gt;</span>
          <span class="hljs-tag">&lt;</span><span class="hljs-name">tbody</span><span class="hljs-tag">&gt;</span>
            {repodata.map((repo) =&gt; (
              <span class="hljs-tag">&lt;</span><span class="hljs-name">tr</span><span class="hljs-tag"> </span><span class="hljs-attr">key</span><span class="hljs-tag">=</span><span class="hljs-string">{repo.id}</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>{repo.full_name}<span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
                  <span class="hljs-tag">&lt;</span><span class="hljs-name">a</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">{repo.html_url}</span><span class="hljs-tag">&gt;</span>{repo.html_url}<span class="hljs-tag">&lt;/</span><span class="hljs-name">a</span><span class="hljs-tag">&gt;</span>
                <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
              <span class="hljs-tag">&lt;/</span><span class="hljs-name">tr</span><span class="hljs-tag">&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/</span><span class="hljs-name">tbody</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;/</span><span class="hljs-name">table</span><span class="hljs-tag">&gt;</span>
      )}
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
    <div class="note">
      <p class="normal">There is an API rate<a id="_idIndexMarker562"/> limit (number of daily requests without authentication) for the GitHub API, so if your code stops working, the reason might be here. The search endpoint that we are using has a limit of 10 requests per minute. If you exceed the limit, you have to wait one minute.</p>
    </div>
    <h1 id="_idParaDest-142" class="heading-1">Handling race conditions</h1>
    <p class="normal">If your component<a id="_idIndexMarker563"/> makes several requests quickly, it can lead to a <strong class="keyWord">race condition</strong> that can create unpredictable or incorrect results. Network requests are asynchronous; therefore, requests don’t necessarily finish in the same order as they were sent.</p>
    <p class="normal">The following example code sends a network request when the <code class="inlineCode">props.carid</code> value changes:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">CarData</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title">useState</span>({});
  <span class="hljs-title">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title">fetch</span>(<span class="hljs-string">`https</span> <span class="hljs-string">://carapi</span> <span class="hljs-string">.com/car/</span><span class="hljs-subst">${props.carid}</span><span class="hljs-string">`</span>)    .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
    .<span class="hljs-title">then</span>(<span class="hljs-params">cardata</span><span class="hljs-function"> =&gt;</span> <span class="hljs-title">setData</span>(cardata))
  }, [props.<span class="hljs-property">carid</span>]);
  
  <span class="hljs-keyword">if</span> (data) {
    <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>{data.car.brand}<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
<span class="hljs-keyword">continue</span>...
</code></pre>
    <p class="normal">Now, if <code class="inlineCode">carid</code> changes quickly multiple times, the data that is rendered might not be from the last request that was sent.</p>
    <p class="normal">We can use the <code class="inlineCode">useEffect</code> cleanup function to avoid race conditions. First, we create a boolean variable<a id="_idIndexMarker564"/> named <code class="inlineCode">ignore</code> inside the <code class="inlineCode">useEffect()</code>, with an initial value of <code class="inlineCode">false</code>. Then, we update the <code class="inlineCode">ignore</code> variable value to <code class="inlineCode">true</code> in the cleanup function. In the state update, we check the value of the <code class="inlineCode">ignore</code> variable, and the state is updated only if the value is <code class="inlineCode">false</code>, which means<a id="_idIndexMarker565"/> that no new value has replaced <code class="inlineCode">props.carid</code> and the effect is not cleaned up:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">CarData</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title">useState</span>({});
  <span class="hljs-title">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="code-highlight"><strong class="hljs-keyword-slc">let</strong><strong class="hljs-slc"> ignore = </strong><strong class="hljs-literal-slc">false</strong><strong class="hljs-slc">;</strong></span>
    <span class="hljs-title">fetch</span>(<span class="hljs-string">`https</span> <span class="hljs-string">://carapi</span> <span class="hljs-string">.com/car/</span><span class="hljs-subst">${props.carid}</span><span class="hljs-string">`</span>)
    .<span class="hljs-title">then</span>(<span class="hljs-params">response</span><span class="hljs-function"> =&gt;</span> response.<span class="hljs-title">json</span>())
    .<span class="hljs-title">then</span>(<span class="hljs-params">cardata</span><span class="hljs-function"> =&gt;</span> { 
      <span class="code-highlight"><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> (!ignore) {</strong></span>
        <span class="code-highlight"><strong class="hljs-title-slc">setData</strong><strong class="hljs-slc">(cardata)</strong></span>
      <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
  });
    <span class="code-highlight"><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> </strong><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> {</strong></span>
      <span class="code-highlight"><strong class="hljs-slc">ignore = </strong><strong class="hljs-literal-slc">true</strong><strong class="hljs-slc">;</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">};</strong></span>
  }, [props.<span class="hljs-property">carid</span>]);
  <span class="hljs-keyword">if</span> (data) {
    <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>{data.car.brand}<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
<span class="hljs-keyword">continue</span>...
</code></pre>
    <p class="normal">Now, each time a component is re-rendered, the cleanup function is called and <code class="inlineCode">ignore</code> is updated to <code class="inlineCode">true</code>, and the effect is cleaned up. Only the result from the last request is rendered, and we can avoid race conditions.</p>
    <p class="normal">React Query, which we will start to use next, provides some mechanisms for handling race conditions, such as concurrency control. It takes care that only one request is sent at a time for a given<a id="_idIndexMarker566"/> query key.</p>
    <h1 id="_idParaDest-143" class="heading-1">Using the React Query library</h1>
    <p class="normal">In proper React apps<a id="_idIndexMarker567"/> where you make a lot of network calls, the use of third-party networking libraries<a id="_idIndexMarker568"/> is recommended. The two most popular libraries are <strong class="keyWord">React Query</strong> (<a href="https://tanstack.com/query"><span class="url">https://tanstack.com/query</span></a>), also known as <strong class="keyWord">Tanstack Query</strong>, and <strong class="keyWord">SWR</strong> (<a href="https://swr.vercel.app/"><span class="url">https://swr.vercel.app/</span></a>). These libraries provide a lot of useful<a id="_idIndexMarker569"/> features, such as data caching<a id="_idIndexMarker570"/> and performance optimization.</p>
    <p class="normal">In this section, we will learn how you can use React Query to fetch data in your React app. We will create a React app that fetches repositories from the GitHub REST API using the <code class="inlineCode">react</code> keyword:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, create a React app called <code class="inlineCode">gitapi</code> using Vite and select the <strong class="screenText">React</strong> framework and <strong class="screenText">JavaScript</strong> variant. Install dependencies and move to your project folder.</li>
      <li class="numberedList">Next, install React Query and <code class="inlineCode">axios</code> using the following commands in your project folder (Note! In this book, we are using Tanstack Query v4):
        <pre class="programlisting con"><code class="hljs-con"><span class="hljs-comment">// install v4</span>
npm install @tanstack/react-query@4
npm install axios
</code></pre>
      </li>
      <li class="numberedList">Remove the extra code inside the fragment <code class="inlineCode">&lt;&gt;&lt;/&gt;</code> from the <code class="inlineCode">App.jsx</code> file. Your <code class="inlineCode">App.jsx</code> code should look as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  );
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
      </li>
      <li class="numberedList">React Query provides the <code class="inlineCode">QueryClientProvider</code> and <code class="inlineCode">QueryClient</code> components, which handle data caching. Import these components into your <code class="inlineCode">App</code> component. Then, create an instance of <code class="inlineCode">QueryClient</code> and render <code class="inlineCode">QueryClientProvider</code> in our <code class="inlineCode">App</code> component:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">QueryClient</strong><strong class="hljs-slc">, </strong><strong class="hljs-title-slc">QueryClientProvider</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong></span>
  <span class="code-highlight"><strong class="hljs-string-slc">'@tanstack/react-query'</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> queryClient = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">QueryClient</strong><strong class="hljs-slc">();</strong></span>
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">QueryClientProvider</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">client</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">{queryClient}</strong><strong class="hljs-tag-slc">&gt;</strong></span>
      <span class="code-highlight"><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">QueryClientProvider</strong><strong class="hljs-tag-slc">&gt;</strong></span>
    <span class="hljs-tag">&lt;/&gt;</span>
  )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>;
</code></pre>
    <p class="normal">React Query<a id="_idIndexMarker571"/> provides the <code class="inlineCode">useQuery</code> hook function, which is used to invoke network requests. The syntax is the following:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> query = <span class="hljs-title">useQuery</span>({ <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'repositories'</span>], <span class="hljs-attr">queryFn</span>:
  getRepositories })
</code></pre>
    <p class="normal">Note that:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">queryKey</code> is a unique key for a query and it is used for caching and refetching data.</li>
      <li class="bulletList"><code class="inlineCode">queryFn</code> is a function to fetch data, and it should return a promise.</li>
    </ul>
    <p class="normal">The <code class="inlineCode">query</code> object that the <code class="inlineCode">useQuery</code> hook returns contains important properties, such as the status of the query:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> { isLoading, isError, isSuccess } = <span class="hljs-title">useQuery</span>({ <span class="hljs-attr">queryKey</span>:
  [<span class="hljs-string">'repositories'</span>], <span class="hljs-attr">queryFn</span>: getRepositories })
</code></pre>
    <p class="normal">The possible status values are the following:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">isLoading</code>: The data is not yet available.</li>
      <li class="bulletList"><code class="inlineCode">isError</code>: The query ended with an error.</li>
      <li class="bulletList"><code class="inlineCode">isSuccess</code>: The query ended successfully and query data is available.</li>
    </ul>
    <p class="normal">The <code class="inlineCode">query</code> object’s <code class="inlineCode">data</code> property contains the data that the response returns.</p>
    <p class="normal">With this information, we can continue our GitHub example using <code class="inlineCode">useQuery</code>.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">We will create a new component<a id="_idIndexMarker572"/> for fetching data. Create a new file called <code class="inlineCode">Repositories.jsx</code> in the <code class="inlineCode">src</code> folder, and fill it with the following starter code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">function</span> <span class="hljs-title">Repositories</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span> <span class="hljs-tag">&lt;/&gt;</span>
  )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">Repositories</span>;
</code></pre>
      </li>
      <li class="numberedList">Import the <code class="inlineCode">useQuery</code> hook and create a function called <code class="inlineCode">getRepositories()</code> that invokes <code class="inlineCode">axios.get()</code> on the GitHub REST API. Here, we use <code class="inlineCode">async</code>/<code class="inlineCode">await</code> with Axios. Call the <code class="inlineCode">useQuery</code> hook function and make the value of the <code class="inlineCode">queryFn</code> property our <code class="inlineCode">fetch</code> function, <code class="inlineCode">getRepositories</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-query'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title">Repositories</span>() {
  <span class="hljs-keyword">const</span> <span class="hljs-title">getRepositories</span> = <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title">get</span>(<span class="hljs-string">"https://api.github\</span>
<span class="hljs-string">      .com/search/repositories?q=react"</span>);
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">items</span>;
  }
  <span class="hljs-keyword">const</span> { isLoading, isError, data } = <span class="hljs-title">useQuery</span>({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'repositories'</span>],
    <span class="hljs-attr">queryFn</span>: getRepositories,
  })
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;&lt;/&gt;</span>
  )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">Repositories</span>;
</code></pre>
      </li>
      <li class="numberedList">Next, implement the conditional rendering. The repositories are rendered when the data is available. We also render a message if the REST API call ends with an error:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Repositories.jsx</span>
<span class="hljs-keyword">if</span> (isLoading) {
  <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Loading...<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
}
<span class="hljs-keyword">if</span> (isError) {
  <span class="hljs-keyword">return</span> <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Error...<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
}
<span class="hljs-keyword">else</span> {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;</span><span class="hljs-name">table</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">tbody</span><span class="hljs-tag">&gt;</span>
      {
      data.map(repo =&gt;
        <span class="hljs-tag">&lt;</span><span class="hljs-name">tr</span><span class="hljs-tag"> </span><span class="hljs-attr">key</span><span class="hljs-tag">=</span><span class="hljs-string">{repo.id}</span><span class="hljs-tag">&gt;</span>
          <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>{repo.full_name}<span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
          <span class="hljs-tag">&lt;</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
            <span class="hljs-tag">&lt;</span><span class="hljs-name">a</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">{repo.html_url}</span><span class="hljs-tag">&gt;</span>{repo.html_url}<span class="hljs-tag">&lt;/</span><span class="hljs-name">a</span><span class="hljs-tag">&gt;</span>
          <span class="hljs-tag">&lt;/</span><span class="hljs-name">td</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;/</span><span class="hljs-name">tr</span><span class="hljs-tag">&gt;</span>)
      }
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">tbody</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">table</span><span class="hljs-tag">&gt;</span>
  )
}
</code></pre>
      </li>
      <li class="numberedList">In the final step, import<a id="_idIndexMarker573"/> our <code class="inlineCode">Repositories</code> component into the <code class="inlineCode">App</code> component and render it inside the <code class="inlineCode">QueryClientProvider</code> component:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Repositories</strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'./Repositories'</strong></span>
<span class="hljs-keyword">import</span> { <span class="hljs-title">QueryClient</span>, <span class="hljs-title">QueryClientProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-</span>
<span class="hljs-string">  query'</span>
<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title">QueryClient</span>()
<span class="hljs-keyword">function</span> <span class="hljs-title">App</span>() {
  <span class="hljs-keyword">return</span> (
    <span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">QueryClientProvider</span><span class="hljs-tag"> </span><span class="hljs-attr">client</span><span class="hljs-tag">=</span><span class="hljs-string">{queryClient}</span><span class="hljs-tag">&gt;</span>
        <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">Repositories</strong><strong class="hljs-tag-slc"> /&gt;</strong></span>
      <span class="hljs-tag">&lt;/</span><span class="hljs-name">QueryClientProvider</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span>
  )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">App</span>
</code></pre>
      </li>
      <li class="numberedList">Now, your app should<a id="_idIndexMarker574"/> look like the following, and repositories are fetched using the React Query library. We also managed to handle request status easily using its built-in features. We don’t need any states to store response data because React Query handles data management and caching:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_10_07.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 10.7: Tanstack Query</p>
    <p class="normal">You should also see that refetching is done automatically by React Query when the browser is <strong class="keyWord">refocused</strong> (when the user returns to the application’s window or tab). This is a good feature; you can see the updated data each time you refocus the browser. You can change this default behavior globally or per query.</p>
    <div class="packt_tip">
      <p class="normal">Refetching is also done automatically when the network is reconnected, or a new instance of the query is mounted (component is inserted into the DOM).</p>
    </div>
    <p class="normal">React Query has an important<a id="_idIndexMarker575"/> property called <code class="inlineCode">staleTime</code> that defines how long data is considered fresh before it becomes stale and triggers a re-fetch in the background. By default, <code class="inlineCode">staleTime</code> is 0, which means that data becomes stale immediately after a successful query. By setting the <code class="inlineCode">staleTime</code> value, you can avoid unnecessary re-fetches if your data is not changing so often. The following example shows how you can set <code class="inlineCode">staleTime</code> in your query:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> { isLoading, isError, data } = <span class="hljs-title">useQuery</span>({
  <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'</span><span class="hljs-string">repositories'</span>],
  <span class="hljs-attr">queryFn</span>: getRepositories,
  <span class="hljs-attr">staleTime</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// in milliseconds -&gt; 1 minute</span>
})
</code></pre>
    <p class="normal">There is also a <code class="inlineCode">cacheTime</code> property that defines when inactive queries are garbage collected, and the default time is 5 minutes.</p>
    <p class="normal">React Query simplifies handling data mutations by providing a <code class="inlineCode">useMutation</code> hook for creating, updating, and deleting data, along with built-in error handling and cache invalidation. Below is an example of <code class="inlineCode">useMutation</code> that adds a new car. Now, because we want to add a new car, we use the <code class="inlineCode">axios.post()</code> method:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// import useMutation</span>
<span class="hljs-keyword">import</span> { useMutation } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-query'</span>
<span class="hljs-comment">// usage</span>
<span class="hljs-keyword">const</span> mutation = <span class="hljs-title">useMutation</span>({
  <span class="hljs-attr">mutationFn</span>: <span class="hljs-function">(</span><span class="hljs-params">newCar</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-keyword">return</span> axios.<span class="hljs-title">post</span>(<span class="hljs-string">'api/cars'</span>, newCar);
  },
  <span class="hljs-attr">onError</span>: <span class="hljs-function">(</span><span class="hljs-params">error, variables, context</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-comment">// Error in mutation</span>
  },
  <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">(</span><span class="hljs-params">data, variables, context</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-comment">// Successful mutation</span>
  },
})
</code></pre>
    <div class="packt_tip">
      <p class="normal">In the case of updating or deleting, you can use the <code class="inlineCode">axios.put()</code>, <code class="inlineCode">axios.patch()</code>, or <code class="inlineCode">axios.delete()</code> methods.</p>
    </div>
    <p class="normal">The <code class="inlineCode">mutationFn</code> property value is a function that sends a <code class="inlineCode">POST</code> request to the server and returns a promise. React Query mutation also provides side effects, such as <code class="inlineCode">onSuccess</code> and <code class="inlineCode">onError</code>, that can be used in mutations. <code class="inlineCode">onSuccess</code> is used to define a callback function that can perform any necessary actions, such as updating the UI or displaying a success message, based on a successful mutation response. <code class="inlineCode">onError</code> is used to specify a callback function that will be executed if the mutation operation encounters an error.</p>
    <p class="normal">Then, we can execute mutation in the following way:</p>
    <pre class="programlisting code"><code class="hljs-code">mutation.<span class="hljs-title">mutate</span>(newCar);
</code></pre>
    <p class="normal"><code class="inlineCode">QueryClient</code> provides an <code class="inlineCode">invalidateQueries()</code> method that can be used to invalidate queries in the cache. If the query<a id="_idIndexMarker576"/> is invalidated in the cache, it will be fetched again. In the previous example, we used <code class="inlineCode">useMutation</code> to add a new car to the server. If we have a query that fetches all cars and the query ID is <code class="inlineCode">cars</code>, we can invalidate it in the following way after the new car has been added successfully:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { useQuery, useMutation, <span class="code-highlight"><strong class="hljs-slc">useQueryClient</strong></span> } <span class="hljs-keyword">from</span>
  <span class="hljs-string">'</span><span class="hljs-string">@tanstack/react-query'</span>
<span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> queryClient = </strong><strong class="hljs-title-slc">useQueryClient</strong><strong class="hljs-slc">();</strong></span>
<span class="hljs-comment">// Fetch all cars</span>
<span class="hljs-keyword">const</span> { data } = <span class="hljs-title">useQuery</span>({ 
  <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'cars'</span>], <span class="hljs-attr">queryFn</span>: fetchCars 
})
<span class="hljs-comment">// Add a new car</span>
<span class="hljs-keyword">const</span> mutation = <span class="hljs-title">useMutation</span>({
  <span class="hljs-attr">mutationFn</span>: <span class="hljs-function">(</span><span class="hljs-params">newCar</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-keyword">return</span> axios.<span class="hljs-title">post</span>(<span class="hljs-string">'api/cars'</span>, newCar);
  },
  <span class="hljs-attr">onError</span>: <span class="hljs-function">(</span><span class="hljs-params">error, variables, context</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-comment">// Error in mutation</span>
  },
  <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">(</span><span class="hljs-params">data, variables, context</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-comment">// Invalidate cars query -&gt; refetch</span>
    <span class="code-highlight"><strong class="hljs-slc">queryClient.</strong><strong class="hljs-title-slc">invalidateQueries</strong><strong class="hljs-slc">({ </strong><strong class="hljs-attr-slc">queryKey</strong><strong class="hljs-slc">: [</strong><strong class="hljs-string-slc">'cars'</strong><strong class="hljs-slc">] });</strong></span>
  },
})
</code></pre>
    <p class="normal">This means that the cars will be fetched again after a new car has been added to the server.</p>
    <p class="normal">By using React Query, we have to write less code to get proper error handling, data caching, and so on, due to the built-in functionalities that it provides. Now that we have learned about networking<a id="_idIndexMarker577"/> with React, we can utilize these skills in our frontend implementation.</p>
    <h1 id="_idParaDest-144" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we focused on networking with React. We started with promises, which make asynchronous network calls easier to implement. This is a cleaner way to handle calls, and it’s much better than using traditional callback functions.</p>
    <p class="normal">In this book, we are using the Axios and React Query libraries for networking in our frontend. We went through the basics of using these libraries. We implemented two React example apps using the <code class="inlineCode">fetch</code> API and Axios to call REST APIs, and we presented the response data in the browser. We learned about race conditions and looked at how to fetch data using the React Query library.</p>
    <p class="normal">In the next chapter, we will look at some useful React components that we are going to use in our frontend.</p>
    <h1 id="_idParaDest-145" class="heading-1">Questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">What is a promise?</li>
      <li class="numberedList">What are <code class="inlineCode">fetch</code> and <code class="inlineCode">axios</code>?</li>
      <li class="numberedList">What is React Query?</li>
      <li class="numberedList">What are the benefits of using a networking library?</li>
    </ol>
    <h1 id="_idParaDest-146" class="heading-1">Further reading</h1>
    <p class="normal">There are other good resources available for learning about promises and asynchronous operations. A couple are as follows:</p>
    <ul>
      <li class="bulletList"><em class="italic">Using promises</em>, by MDN web docs (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises"><span class="url">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises</span></a>)</li>
      <li class="bulletList"><em class="italic">Fetch Standard</em> (<a href="https://fetch.spec.whatwg.org/"><span class="url">https://fetch.spec.whatwg.org/</span></a>)</li>
    </ul>
    <h1 class="heading-1">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask the author questions, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/FullStackSpringBootReact4e"><span class="url">https://packt.link/FullStackSpringBootReact4e</span></a></p>
    <p class="normal"><img src="../Images/QR_Code10796108009382640.png" alt="" role="presentation"/></p>
  </div>
</body></html>