<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Commanding the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Commanding the CLI</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Invoking CLI commands</li><li class="listitem" style="list-style-type: disc">Checking the WildFly version</li><li class="listitem" style="list-style-type: disc">Checking WildFly operational mode</li><li class="listitem" style="list-style-type: disc">Getting the OS version</li><li class="listitem" style="list-style-type: disc">Getting the JVM version</li><li class="listitem" style="list-style-type: disc">Checking the JVM options</li><li class="listitem" style="list-style-type: disc">Checking JVM memories – heap-size and all</li><li class="listitem" style="list-style-type: disc">Checking the server status</li><li class="listitem" style="list-style-type: disc">Checking the JNDI tree view</li><li class="listitem" style="list-style-type: disc">Invoking CLI commands declared in an external file</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec72"/>Introduction</h1></div></div></div><p>In this chapter, you will learn how to use the CLI to grab the information that you need. The CLI also provides a method to execute commands outside it, by specifying the WildFly to connect to and the command to be executed. Furthermore, WildFly provides you with an HTTP API, which can be used to perform action and to also retrieve information. Most of this API is used to perform system monitoring.</p><p>As WildFly can be run in a standalone or domain mode, whenever it makes sense, we will use both modes because you may access the same information differently.</p><p>Within this chapter, we will simulate/use remote WildFly instances, just like the real scenario where you can apply the following recipes to connect to remote servers. It does not make sense trying the recipes in <code class="literal">localhost</code> without seeing any authentication and authorization issues.</p><p>To simulate a remote server, you can eventually use VirtualBox or Docker and then install WildFly as described in the first chapter.</p><p>I'm going to use WildFly running on a Linux container using the Docker tool version 1.5. You can obviously use a real remote server, it would be the same; what counts is the WildFly platform being exposed</p><p>By the way, the last chapter of this book is all about running WildFly within a Linux container using Docker, so if you are totally new to Docker (where have you been hiding?), have a look at the last chapter of this book, or grab a definitely excellent Docker book, <span class="emphasis"><em>The Docker Book</em></span>, <span class="emphasis"><em>James Turnbull</em></span> at <a class="ulink" href="http://www.dockerbook.com">http://www.dockerbook.com</a>
</p><p>So, my Docker <a id="id619" class="indexterm"/>configuration says the following:</p><div class="informalexample"><pre class="programlisting">DOCKER_HOST=tcp://192.168.59.103:2376</pre></div><p>Thus, my remote WildFly instance will be bound to that IP along with the usual WildFly ports such as <code class="literal">8080</code>, <code class="literal">9990</code> and <code class="literal">9999</code>. The same management user is the one used throughout the book: <code class="literal">wildfly</code> as username and <code class="literal">cookbook.2015</code> as password.</p></div></div>
<div class="section" title="Invoking CLI commands"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec73"/>Invoking CLI commands</h1></div></div></div><p>In this recipe, you <a id="id620" class="indexterm"/>will learn how to invoke CLI commands directly from your command line without accessing the CLI itself, let's say not in an interactive way. This technique might be helpful in case you have to script some processes, like stopping and starting servers in a sequence, deploying an application only if another one has already been deployed, and so on. Often times, you also need to monitor some state, thus you just need that number (as typically seen in Nagios).</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec189"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec190"/>How to do it…</h2></div></div></div><p>On your local PC, open a new terminal window and run the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=release-codename)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "Kenny"
}</pre></div><p>Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=release-codename)" | awk 'NR==3 { print $3 }'
"Kenny"</pre></div><p>In case you are running WildFly in the domain mode, both the invocation and the result are the same.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec191"/>How it works…</h2></div></div></div><p>Actually, there is not much to say or explain, just that the <code class="literal">jboss-cli.sh</code> script invokes the <code class="literal">org.jboss.as.cli.CommandLineMain</code> class of the <code class="literal">wildfly-cli-1.0.0.Beta2.jar</code> library, passing all the arguments. The <code class="literal">--command</code> basically disables the interactive <a id="id621" class="indexterm"/>mode, executes the statements, and prints the output in the standard output before returning back to the standard input.</p><p>What we have done is basically the following:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password: [cookbook.2015]
[standalone@192.168.59.103:9990 /] :read-attribute(name=release-codename)
{
    "outcome" =&gt; "success",
    "result" =&gt; "Kenny"
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec192"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec25"/>curl</h3></div></div></div><p>With a running WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">On you local PC, open <a id="id622" class="indexterm"/>a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/?operation=attribute\&amp;name=release—codename
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/?operation=attribute&amp;name=release-codename HTTP/1.1
&gt; User-Agent: curl/7.37.0
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="it/3pAte8WkNMTQzMDkzNzkzNDYwN+FFS4e5sd6vPqf6T/M4bQI=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Wed, 06 May 2015 18:45:34 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a <code class="literal">Digest</code> authentication for the <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the username <code class="literal">wildfly</code> and password <code class="literal">cookbook.2015</code> to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/?operation=attribute\&amp;name=release-codename
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=release-codename HTTP/1.1
&gt; User-Agent: curl/7.37.0
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="6ofpOO62oNsNMTQzMDkzNzk2ODQzORxjucrlmU+bXpQSbl6Mkos=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Wed, 06 May 2015 18:46:08 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/?operation=attribute&amp;name=release-codename'
* Found bundle for host 192.168.59.103: 0x228bb70
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Initializing NSS with certpath: sql:/etc/pki/nssdb
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=release-codename HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="6ofpOO62oNsNMTQzMDkzNzk2ODQzORxjucrlmU+bXpQSbl6Mkos=", uri="/management/?operation=attribute&amp;name=release-codename", response="e52ce8f429808ef48a76da7193de27e9", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.0
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="tsPhgznQArENMTQzMDkzNzk2ODU0NSgg91cYeN3rLKUkBXYRMA8="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 7
&lt; Date: Wed, 06 May 2015 18:46:08 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
"Kenny"</pre></div></li><li class="listitem">Okay, it works; now <a id="id623" class="indexterm"/>remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just <code class="literal">Kenny</code>, after entering the password.</li><li class="listitem">If you do not want to enter the password, you can pass it as an argument as well, with all the security concerns this comes with. For this, do as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/?operation=attribute\&amp;name=release-codename
"Kenny"</pre></div></li></ol></div></div></div></div>
<div class="section" title="Checking the WildFly version"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec74"/>Checking the WildFly version</h1></div></div></div><p>In this recipe, you <a id="id624" class="indexterm"/>will learn to check the version of WildFly that you are running by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec193"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec194"/>How to do it…</h2></div></div></div><p>On your local PC, open a new terminal window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=product-version)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "9.0.0.Beta2"
}</pre></div><p>Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=product-version)" | awk 'NR==3 { print $3 }'
"9.0.0.Beta2"</pre></div><p>In case you are running WildFly in the domain mode, the invocation and result would be the same.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec195"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> <a id="id625" class="indexterm"/>parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] :read-attribute(name=product-version)
{
    "outcome" =&gt; "success",
    "result" =&gt; "9.0.0.Beta2"
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec196"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools <a id="id626" class="indexterm"/>such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec26"/>curl</h3></div></div></div><p>With a running WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and run the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/?operation=attribute\&amp;name=product-version
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/?operation=attribute&amp;name=product-version HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="Z9fm45feS/QNMTQzMTk1ODE4OTA5OXjLOp5ZQcJ+ag+dmE6jbEM=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:09:49 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see <code class="literal">curl</code> complains about a Digest authentication for the <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the username <code class="literal">wildfly</code> and password <code class="literal">cookbook.2015</code> to the command, as <a id="id627" class="indexterm"/>follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/?operation=attribute\&amp;name=product-version
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=product-version HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="iRU9d5SaQI8NMTQzMTk1ODc1NTY2OAgdi5zSNYp+IAgtpOgBZRU=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:19:15 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/?operation=attribute&amp;name=product-version'
* Found bundle for host 192.168.59.103: 0x7fc3a0400ed0
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=product-version HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="iRU9d5SaQI8NMTQzMTk1ODc1NTY2OAgdi5zSNYp+IAgtpOgBZRU=", uri="/management/?operation=attribute&amp;name=product-version", response="e3f7a23441f44992d1d7e2c9fcc00cc2", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="45+yNlhzGZ8NMTQzMTk1ODc1NTY4MZP/ti6JYQlWeum3jKxWEao="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 13
&lt; Date: Mon, 18 May 2015 14:19:15 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
"9.0.0.Beta2"</pre></div><p>Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just <code class="literal">9.0.0.Beta2</code>, after entering the password.</p></li><li class="listitem">If you do not <a id="id628" class="indexterm"/>want to enter the password, you can pass it as an argument as well, with all the security concerns this comes with, as follows:<div class="informalexample"><pre class="programlisting">$ curl  --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/?operation=attribute\&amp;name=product-version
"9.0.0.Beta2"</pre></div></li></ol></div></div></div></div>
<div class="section" title="Checking WildFly operational mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec75"/>Checking WildFly operational mode</h1></div></div></div><p>In this <a id="id629" class="indexterm"/>recipe, you will learn to check the operational mode that WildFly is running with by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec197"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec198"/>How to do it…</h2></div></div></div><p>Open a new terminal window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=launch-type)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "STANDALONE"
}</pre></div><p>Obviously, you can extract just the information you need  using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=launch-type)" | awk 'NR==3 { print $3 }'
"STANDALONE"</pre></div><p>In case you are <a id="id630" class="indexterm"/>running WildFly in the domain mode, the invocation is the same, but the result would be as follows:</p><div class="informalexample"><pre class="programlisting">"DOMAIN"</pre></div><p>That's it!</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec199"/>How it works...</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] :read-attribute(name=launch-type)
{
    "outcome" =&gt; "success",
    "result" =&gt; "STANDALONE"
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec200"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line <a id="id631" class="indexterm"/>tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec27"/>curl</h3></div></div></div><p>With a running WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/?operation=attribute\&amp;name=launch-type
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/?operation=attribute&amp;name=launch-type HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="oOubmxOIcS0NMTQzMTk1OTg2Mjk4Nqu/YSX7Gh368EZ1XPoG3Eg=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:37:42 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a Digest authentication for  <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the <a id="id632" class="indexterm"/>username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/?operation=attribute\&amp;name=launch-type
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=launch-type HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="ma7nUTWjpCINMTQzMTk2MDA1MjIyOPhpd9+Np6mKrGK9OIhVD1A=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:40:52 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/?operation=attribute&amp;name=launch-type'
* Found bundle for host 192.168.59.103: 0x7fb833d00c70
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=launch-type HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="ma7nUTWjpCINMTQzMTk2MDA1MjIyOPhpd9+Np6mKrGK9OIhVD1A=", uri="/management/?operation=attribute&amp;name=launch-type", response="3ae09c2aaf9a1c29a0f2c5153d56d485", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="xWcBNZToWOoNMTQzMTk2MDA1MjIzNKGJWH9tRyHEBw/DEd3VE6w="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 12
&lt; Date: Mon, 18 May 2015 14:40:52 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
"STANDALONE"</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You <a id="id633" class="indexterm"/>should get just <code class="literal">STANDALONE</code>, after entering the password.</li><li class="listitem">If you do not want to enter the password, you can pass it as an argument as well, with all the security concerns this comes with, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/?operation=attribute\&amp;name=launch-type
"STANDALONE"</pre></div></li></ol></div></div></div></div>
<div class="section" title="Getting the OS version"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec76"/>Getting the OS version</h1></div></div></div><p>In this recipe, you <a id="id634" class="indexterm"/>will learn how to get the OS version that WildFly is running on by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec201"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec202"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new <a id="id635" class="indexterm"/>terminal window and run the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=operating-system:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Linux",
        "arch" =&gt; "amd64",
        "version" =&gt; "3.18.5-tinycore64",
        "available-processors" =&gt; 8,
        "system-load-average" =&gt; 0.0,
        "object-name" =&gt; "java.lang:type=OperatingSystem"
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=operating-system:read-resource(include-runtime=true,include-defaults=true)" | awk 'NR==4 { print $3 }'
"Linux",</pre></div></li><li class="listitem">In case you are running WildFly in the domain mode, the invocation is done as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=operating-system:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Linux",
        "arch" =&gt; "amd64",
        "version" =&gt; "3.18.5-tinycore64",
        "available-processors" =&gt; 8,
        "system-load-average" =&gt; 0.0,
        "object-name" =&gt; "java.lang:type=OperatingSystem"
    }
}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec203"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it <a id="id636" class="indexterm"/>would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /core-service=platform-mbean/type=operating-system:read-resource(include-runtime=true,include-defaults=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Linux",
        "arch" =&gt; "amd64",
        "version" =&gt; "3.16.4-tinycore64",
        "available-processors" =&gt; 8,
        "system-load-average" =&gt; 0.0,
        "object-name" =&gt; "java.lang:type=OperatingSystem"
    }
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec204"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec28"/>curl</h3></div></div></div><p>With a running <a id="id637" class="indexterm"/>WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and do as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/core-service/platform-mbean/type/operating-system?operation=resource\&amp;include-runtime=true\&amp;include-defaults=true
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/core-service/platform-mbean/type/operating-system?operation=resource&amp;include-runtime=true&amp;include-defaults=true HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="vgtjzIheBzkNMTQzMTk2MDkwMzkyMPnsADViafwy586SMaSftDU=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:55:03 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a Digest authentication for  <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the <a id="id638" class="indexterm"/>username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/core-service/platform-mbean/type/operating-system?operation=resource\&amp;include-runtime=true\&amp;include-defaults=true
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/operating-system?operation=resource&amp;include-runtime=true&amp;include-defaults=true HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="Z7R7/j+3b5oNMTQzMTk2MTA3NjQ1N4lD5fc075kCb3a0afe4pCg=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 14:57:56 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/core-service/platform-mbean/type/operating-system?operation=resource&amp;include-runtime=true&amp;include-defaults=true'
* Found bundle for host 192.168.59.103: 0x7ff722414af0
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/operating-system?operation=resource&amp;include-runtime=true&amp;include-defaults=true HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="Z7R7/j+3b5oNMTQzMTk2MTA3NjQ1N4lD5fc075kCb3a0afe4pCg=", uri="/management/core-service/platform-mbean/type/operating-system?operation=resource&amp;include-runtime=true&amp;include-defaults=true", response="d71b0f677bfb476226880ae0f55b899c", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="xEfjYw89nD8NMTQzMTk2MTA3NjQ3MSkjdHABRCjFARHS2aR438k="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 176
&lt; Date: Mon, 18 May 2015 14:57:56 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
{"name" : "Linux", "arch" : "amd64", "version" : "3.18.5-tinycore64", "available-processors" : 8, "system-load-average" : 0.0, "object-name" : "java.lang:type=OperatingSystem"}</pre></div></li><li class="listitem">Okay, it <a id="id639" class="indexterm"/>works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just the JSON output after entering the password, as follows:<div class="informalexample"><pre class="programlisting">{"name" : "Linux", "arch" : "amd64", "version" : "3.16.4-tinycore64", "available-processors" : 8, "system-load-average" : 0.0, "object-name" : "java.lang:type=OperatingSystem"}</pre></div><p>Neat, but pretty ugly!</p></li><li class="listitem">If you want to prettify the JSON output and you do not want to enter the password (you can pass it as an argument as well, with all the security concerns this comes with), you can do as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/core-service/platform-mbean/type/operating-system?operation=resource\&amp;include-runtime=true\&amp;include-defaults=true<span class="strong"><strong>\&amp;json.pretty=true</strong></span>
{
    "name" : "Linux",
    "arch" : "amd64",
    "version" : "3.18.5-tinycore64",
    "available-processors" : 8,
    "system-load-average" : 0.0,
    "object-name" : "java.lang:type=OperatingSystem"
}</pre></div></li></ol></div><p>That's the <a id="id640" class="indexterm"/>way I like it!</p></div></div></div>
<div class="section" title="Getting the JVM version"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec77"/>Getting the JVM version</h1></div></div></div><p>In this recipe, you <a id="id641" class="indexterm"/>will learn how to get the JVM WildFly is running with by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec205"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec206"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=runtime:read-attribute(name=spec-version)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "1.8"
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=runtime:read-attribute(name=spec-version)" | awk 'NR==3 { print $3 }'
"1.8"</pre></div></li><li class="listitem">In case you <a id="id642" class="indexterm"/>are running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=runtime:read-attribute(name=spec-version)" | awk 'NR==3 { print $3 }'
"1.8"</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec207"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /core-service=platform-mbean/type=runtime:read-attribute(name=spec-version)
{
    "outcome" =&gt; "success",
    "result" =&gt; "1.8"
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec208"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec29"/>curl</h3></div></div></div><p>With a running <a id="id643" class="indexterm"/>WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and run the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=spec-version
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=spec-version HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="wvo9g8raGFsNMTQzMTk2MTgwNjk1NE1gqeXx9Q8BkyC5OMS5Dy8=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 15:10:06 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a Digest authentication for  <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=spec-version
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=spec-version HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="lq4EWazA3IUNMTQzMTk2MTgzMjI3NM2iKbJNsltAipmEDWj2zBs=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 15:10:32 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=spec-version'
* Found bundle for host 192.168.59.103: 0x7fb35ac14a40
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=spec-version HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="lq4EWazA3IUNMTQzMTk2MTgzMjI3NM2iKbJNsltAipmEDWj2zBs=", uri="/management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=spec-version", response="b91b7944f1c95154b5a0a97e2c87cace", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="EP8IM2uluIcNMTQzMTk2MTgzMjI4NeTU7FBtoaXVQ/6HR5zlVzw="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 5
&lt; Date: Mon, 18 May 2015 15:10:32 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
"1.8"</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just the output after entering the password, as follows:<div class="informalexample"><pre class="programlisting">"1.8"</pre></div></li><li class="listitem">If you do not <a id="id644" class="indexterm"/>want to enter the password, you can pass it as an argument as well, with all the security concerns this comes with, as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=spec-version
"1.8"</pre></div></li></ol></div><p>That's the way I like it!</p></div><div class="section" title="More about the runtime type"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec30"/>More about the runtime type</h3></div></div></div><p>The <code class="literal">runtime</code> <a id="id645" class="indexterm"/>type that we just used in the preceding steps, provides a lot of information that can be very helpful. Here is the complete list of all the information you can have in a pretty JSON format:</p><div class="informalexample"><pre class="programlisting">{    "name" : "1145@e0d713e81636",
    "vm-name" : "Java HotSpot(TM) 64-Bit Server VM",
    "vm-vendor" : "Oracle Corporation",
    "vm-version" : "25.40-b25",
    "spec-name" : "Java Virtual Machine Specification",
    "spec-vendor" : "Oracle Corporation",
    "spec-version" : "1.8",
    "management-spec-version" : "1.2",
    "class-path" : "/home/wildfly/WFC/wildfly/jboss-modules.jar",
    "library-path" : "/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib",
    "boot-class-path-supported" : true,
    "boot-class-path" : "/home/wildfly/WFC/jdk8/jre/lib/resources.jar:/home/wildfly/WFC/jdk8/jre/lib/rt.jar:/home/wildfly/WFC/jdk8/jre/lib/sunrsasign.jar:/home/wildfly/WFC/jdk8/jre/lib/jsse.jar:/home/wildfly/WFC/jdk8/jre/lib/jce.jar:/home/wildfly/WFC/jdk8/jre/lib/charsets.jar:/home/wildfly/WFC/jdk8/jre/lib/jfr.jar:/home/wildfly/WFC/jdk8/jre/classes",
    "input-arguments" : [
        "-D[Standalone]",
        "-XX:+UseCompressedOops",
        "-XX:+UseCompressedOops",
        "-Xms64m",
        "-Xmx512m",
        "-XX:MaxPermSize=256m",
        "-Djava.net.preferIPv4Stack=true",
        "-Djboss.modules.system.pkgs=org.jboss.byteman",
        "-Djava.awt.headless=true",
        "-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log",
        "-Dlogging.configuration=file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"
    ],
    "start-time" : 1431960757217,
    "system-properties" : {
        "[Standalone]" : "",
        "awt.toolkit" : "sun.awt.X11.XToolkit",
        "file.encoding" : "ANSI_X3.4-1968",
        "file.encoding.pkg" : "sun.io",
        "file.separator" : "/",
        "java.awt.graphicsenv" : "sun.awt.X11GraphicsEnvironment",
        "java.awt.headless" : "true",
        "java.awt.printerjob" : "sun.print.PSPrinterJob",
        "java.class.path" : "/home/wildfly/WFC/wildfly/jboss-modules.jar",
        "java.class.version" : "52.0",
        "java.endorsed.dirs" : "/home/wildfly/WFC/jdk8/jre/lib/endorsed",
        "java.ext.dirs" : "/home/wildfly/WFC/jdk8/jre/lib/ext:/usr/java/packages/lib/ext",
        "java.home" : "/home/wildfly/WFC/jdk8/jre",
        "java.io.tmpdir" : "/tmp",
        "java.library.path" : "/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib",
        "java.naming.factory.url.pkgs" : "org.jboss.as.naming.interfaces:org.jboss.ejb.client.naming",
        "java.net.preferIPv4Stack" : "true",
        "java.runtime.name" : "Java(TM) SE Runtime Environment",
        "java.runtime.version" : "1.8.0_40-b26",
        "java.specification.name" : "Java Platform API 
        Specification",
        "java.specification.vendor" : "Oracle Corporation",
        "java.specification.version" : "1.8",
        "java.util.logging.manager" : "org.jboss.logmanager.LogManager",
        "java.vendor" : "Oracle Corporation",
        "java.vendor.url" : "http://java.oracle.com/",
        "java.vendor.url.bug" : "http://bugreport.sun.com/bugreport/",
        "java.version" : "1.8.0_40",
        "java.vm.info" : "mixed mode",
        "java.vm.name" : "Java HotSpot(TM) 64-Bit Server VM",
        "java.vm.specification.name" : "Java Virtual Machine Specification",
        "java.vm.specification.vendor" : "Oracle Corporation",
        "java.vm.specification.version" : "1.8",
        "java.vm.vendor" : "Oracle Corporation",
        "java.vm.version" : "25.40-b25",
        "javax.management.builder.initial" : "org.jboss.as.jmx.PluggableMBeanServerBuilder",
        "javax.xml.datatype.DatatypeFactory" : "__redirected.__DatatypeFactory",
        "javax.xml.parsers.DocumentBuilderFactory" : "__redirected.__DocumentBuilderFactory",
        "javax.xml.parsers.SAXParserFactory" : 
        "__redirected.__SAXParserFactory",
        "javax.xml.stream.XMLEventFactory" : 
        "__redirected.__XMLEventFactory",
        "javax.xml.stream.XMLInputFactory" : "__redirected.__XMLInputFactory",
        "javax.xml.stream.XMLOutputFactory" : "__redirected.__XMLOutputFactory",
        "javax.xml.transform.TransformerFactory" : "__redirected.__TransformerFactory",
        "javax.xml.validation.SchemaFactory:http://www.w3.org/2001/XMLSchema" : "__redirected.__SchemaFactory",
        "javax.xml.xpath.XPathFactory:http://java.sun.com/jaxp/xpath/dom" : "__redirected.__XPathFactory",
        "jboss.bind.address" : "0.0.0.0",
        "jboss.bind.address.management" : "0.0.0.0",
        "jboss.home.dir" : "/home/wildfly/WFC/wildfly",
        "jboss.host.name" : "e0d713e81636",
        "jboss.modules.dir" : "/home/wildfly/WFC/wildfly/modules",
        "jboss.modules.system.pkgs" : "org.jboss.byteman",
        "jboss.node.name" : "e0d713e81636",
        "jboss.qualified.host.name" : "e0d713e81636",
        "jboss.server.base.dir" : "/home/wildfly/WFC/wildfly/standalone",
        "jboss.server.config.dir" : "/home/wildfly/WFC/wildfly/standalone/configuration",
        "jboss.server.data.dir" : "/home/wildfly/WFC/wildfly/standalone/data",
        "jboss.server.deploy.dir" : "/home/wildfly/WFC/wildfly/standalone/data/content",
        "jboss.server.log.dir" : "/home/wildfly/WFC/wildfly/standalone/log",
        "jboss.server.name" : "e0d713e81636",
        "jboss.server.persist.config" : "true",
        "jboss.server.temp.dir" : "/home/wildfly/WFC/wildfly/standalone/tmp",
        "line.separator" : "\n",
        "logging.configuration" : "file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties",
        "module.path" : "/home/wildfly/WFC/wildfly/modules",
        "org.apache.xml.security.ignoreLineBreaks" : "true",
        "org.jboss.boot.log.file" : "/home/wildfly/WFC/wildfly/standalone/log/server.log",
        "org.jboss.resolver.warning" : "true",
        "org.jboss.security.context.ThreadLocal" : "true",
        "org.xml.sax.driver" : "__redirected.__XMLReaderFactory",
        "os.arch" : "amd64",
        "os.name" : "Linux",
        "os.version" : "3.18.5-tinycore64",
        "path.separator" : ":",
        "sun.arch.data.model" : "64",
        "sun.boot.class.path" : "/home/wildfly/WFC/jdk8/jre/lib/resources.jar:/home/wildfly/WFC/jdk8/jre/lib/rt.jar:/home/wildfly/WFC/jdk8/jre/lib/sunrsasign.jar:/home/wildfly/WFC/jdk8/jre/lib/jsse.jar:/home/wildfly/WFC/jdk8/jre/lib/jce.jar:/home/wildfly/WFC/jdk8/jre/lib/charsets.jar:/home/wildfly/WFC/jdk8/jre/lib/jfr.jar:/home/wildfly/WFC/jdk8/jre/classes",
        "sun.boot.library.path" : "/home/wildfly/WFC/jdk8/jre/lib/amd64",
        "sun.cpu.endian" : "little",
        "sun.cpu.isalist" : "",
        "sun.io.unicode.encoding" : "UnicodeLittle",
        "sun.java.command" : "/home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.standalone -Djboss.home.dir=/home/wildfly/WFC/wildfly -Djboss.server.base.dir=/home/wildfly/WFC/wildfly/standalone -b 0.0.0.0 -bmanagement 0.0.0.0",
        "sun.java.launcher" : "SUN_STANDARD",
        "sun.jnu.encoding" : "ANSI_X3.4-1968",
        "sun.management.compiler" : "HotSpot 64-Bit Tiered Compilers",
        "sun.nio.ch.bugLevel" : "",
        "sun.os.patch.level" : "unknown",
        "user.country" : "US",
        "user.dir" : "/home/wildfly/WFC/wildfly",
        "user.home" : "/home/wildfly",
        "user.language" : "en",
        "user.name" : "wildfly",
        "user.timezone" : "America/New_York"
    },
    "uptime" : 1393273,
    "object-name" : "java.lang:type=Runtime"
}</pre></div><p>As you can see, there <a id="id646" class="indexterm"/>is a lot of information, and with the <code class="literal">operation=attribute</code> directive, you can directly grab the attribute that you need. Otherwise use the <code class="literal">awk</code> command.</p></div></div></div>
<div class="section" title="Checking the JVM options"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec78"/>Checking the JVM options</h1></div></div></div><p>In this recipe, you <a id="id647" class="indexterm"/>will learn how to get the JVM options used to run WildFly by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec209"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec210"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=runtime:read-attribute(name=input-arguments,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "-D[Standalone]",
        "-Xms64m",
        "-Xmx512m",
        "-XX:MaxPermSize=256m",
        "-Djava.net.preferIPv4Stack=true",
        "-Djboss.modules.system.pkgs=org.jboss.byteman",
        "-Djava.awt.headless=true",
        "-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log",
        "-Dlogging.configuration=file:home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"
    ]
}</pre></div></li><li class="listitem">Obviously, you can extract just the information that you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=runtime:read-attribute(name=input-arguments,include-defaults=true)" | awk 'NR==6 { print $1 }'
"-Xmx521m",</pre></div></li><li class="listitem">In case you are running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=runtime:read-attribute(name=input-arguments,include-defaults=true)" | awk 'NR==6 { print $1 }'
"-Xmx521m",</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec211"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it <a id="id648" class="indexterm"/>would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /core-service=platform-mbean/type=runtime:read-attribute(name=input-arguments,include-defaults=true)

{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "-D[Standalone]",
        "-Xms64m",
        "-Xmx512m",
        "-XX:MaxPermSize=256m",
        "-Djava.net.preferIPv4Stack=true",
        "-Djboss.modules.system.pkgs=org.jboss.byteman",
        "-Djava.awt.headless=true",
        "-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log",
        "-Dlogging.configuration=file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"
    ]
}
[standalone@192.168.59.103:9990 /]</pre></div><p>Remember, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec212"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec31"/>curl</h3></div></div></div><p>With a running <a id="id649" class="indexterm"/>WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and do as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=input-arguments\&amp;include-defaults=true
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=input-arguments&amp;include-defaults=true HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="Hipx4QD6g24NMTQzMTk2MjY2ODcyNhXQ5pLbS5A/ZruXxypB1gM=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 15:24:28 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a Digest authentication for the <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the <a id="id650" class="indexterm"/>username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=input-arguments\&amp;include-defaults=true
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=input-arguments&amp;include-defaults=true HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="QVV7pMN+yIYNMTQzMTk2Mjg1MzAwNIEcpzHTEA2YeGu3jANV1bI=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Mon, 18 May 2015 15:27:33 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=input-arguments&amp;include-defaults=true'
* Found bundle for host 192.168.59.103: 0x7fd4c0500e00
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=input-arguments&amp;include-defaults=true HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="QVV7pMN+yIYNMTQzMTk2Mjg1MzAwNIEcpzHTEA2YeGu3jANV1bI=", uri="/management/core-service/platform-mbean/type/runtime?operation=attribute&amp;name=input-arguments&amp;include-defaults=true", response="8d550a343d3a56cfcd7afdd6ca0c1664", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="UkyiLKmVGuYNMTQzMTk2Mjg1MzAwN08EKUU+895ECweZBtXoCdQ="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 402
&lt; Date: Mon, 18 May 2015 15:27:33 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
["-D[Standalone]","-XX:+UseCompressedOops","-XX:+UseCompressedOops","-Xms64m","-Xmx512m","-XX:MaxPermSize=256m","-Djava.net.preferIPv4Stack=true","-Djboss.modules.system.pkgs=org.jboss.byteman","-Djava.awt.headless=true","-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log","-Dlogging.configuration=file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"]</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just the JSON output, after entering the password, as follows:<div class="informalexample"><pre class="programlisting">["-D[Standalone]","-XX:+UseCompressedOops","-XX:+UseCompressedOops","-Xms64m","-Xmx512m","-XX:MaxPermSize=256m","-Djava.net.preferIPv4Stack=true","-Djboss.modules.system.pkgs=org.jboss.byteman","-Djava.awt.headless=true","-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log","-Dlogging.configuration=file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"]</pre></div><p>Neat, but pretty ugly!</p></li><li class="listitem">If you want to prettify the JSON output and you do not want to enter the password (you can <a id="id651" class="indexterm"/>pass it as an argument as well, with all the security concerns this comes with), you can do as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/core-service/platform-mbean/type/runtime?operation=attribute\&amp;name=input-arguments\&amp;include-defaults=true\&amp;json.pretty=true[
    "-D[Standalone]",
    "-XX:+UseCompressedOops",
    "-XX:+UseCompressedOops",
    "-Xms64m",
    "-Xmx512m",
    "-XX:MaxPermSize=256m",
    "-Djava.net.preferIPv4Stack=true",
    "-Djboss.modules.system.pkgs=org.jboss.byteman",
    "-Djava.awt.headless=true",
    "-Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/standalone/log/server.log",
    "-Dlogging.configuration=file:/home/wildfly/WFC/wildfly/standalone/configuration/logging.properties"
]</pre></div></li></ol></div><p>That's the way I like it!</p></div></div></div>
<div class="section" title="Checking JVM memories &#x2013; heap-size and all"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec79"/>Checking JVM memories – heap-size and all</h1></div></div></div><p>In this recipe, we <a id="id652" class="indexterm"/>will learn how to get the JVM memory information with regard to heap-size, non heap-size, metaspace size (PermGen until Java 7), eden, old, and survivor, by invoking a command to the CLI. There is a command for each of them.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec213"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec214"/>How to do it…</h2></div></div></div><p>We will walk through the "<code class="literal">heap</code>", "<code class="literal">non-heap</code>", "<code class="literal">metaspace</code>" (PermGen until Java 7), "<code class="literal">eden</code>", "<code class="literal">old</code>", and the "<code class="literal">survivor</code>" area memories, separately.</p><div class="section" title="Heap"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec32"/>Heap</h3></div></div></div><p> For information on <a id="id653" class="indexterm"/>heap memory, perform the  following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and do as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory:read-attribute(name=heap-memory-usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 67108864L,
        "used" =&gt; 90009368L,
        "committed" =&gt; 199753728L,
        "max" =&gt; 477626368L
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory:read-attribute(name=heap-memory-usage,include-defaults=true)" | awk 'NR==7 { print $0 }'
"max" =&gt; 477626368L</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>If you just need the number, which is a <code class="literal">long</code> datatype, use <code class="literal">$3</code> in the <code class="literal">print</code> statement.</p></div></div></li><li class="listitem">In case you are <a id="id654" class="indexterm"/>running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory:read-attribute(name=heap-memory-usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 67108864L,
        "used" =&gt; 78141544L,
        "committed" =&gt; 147324928L,
        "max" =&gt; 477626368L
    }
}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="Non-heap"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec33"/>Non-heap</h3></div></div></div><p> For information on <a id="id655" class="indexterm"/>non-heap memory, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory:read-attribute(name=non-heap-memory-usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 2555904L,
        "used" =&gt; 55613336L,
        "committed" =&gt; 62128128L,
        "max" =&gt; -1L
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory:read-attribute(name=non-heap-memory-usage,include-defaults=true)" | awk 'NR==5 { print $0 }'
"used" =&gt; 55613336L,</pre></div></li><li class="listitem">In case you are <a id="id656" class="indexterm"/>running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory:read-attribute(name=non-heap-memory-usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 2555904L,
        "used" =&gt; 65766592L,
        "committed" =&gt; 73310208L,
        "max" =&gt; -1L
    }
}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="Metaspace or PermGen"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec34"/>Metaspace or PermGen</h3></div></div></div><p>Metaspace is <a id="id657" class="indexterm"/>available since Java 1.8, while PermGen was available until <a id="id658" class="indexterm"/>Java 1.7.  For the metaspace memory information, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and do as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=Metaspace:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Metaspace",
        "type" =&gt; "NON_HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; ["Metaspace_Manager"],
        "usage-threshold-supported" =&gt; true,
        "collection-usage-threshold-supported" =&gt; false,
        "usage-threshold" =&gt; 0L,
        "collection-usage-threshold" =&gt; undefined,
        "usage" =&gt; {
            "init" =&gt; 0L,
            "used" =&gt; 42415280L,
            "committed" =&gt; 47185920L,
            "max" =&gt; -1L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 0L,
            "used" =&gt; 42415280L,
            "committed" =&gt; 47185920L,
            "max" =&gt; -1L
        },
        "usage-threshold-exceeded" =&gt; false,
        "usage-threshold-count" =&gt; 0L,
        "collection-usage-threshold-exceeded" =&gt; undefined,
        "collection-usage-threshold-count" =&gt; undefined,
        "collection-usage" =&gt; undefined,
        "object-name" =&gt; "java.lang:type=MemoryPool,name=Metaspace"
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the <a id="id659" class="indexterm"/>output (you can use whichever tool you <a id="id660" class="indexterm"/>are comfortable with). However, in this case, you should better use the <code class="literal">read-attribute</code> syntax and then use the <code class="literal">awk</code> command for the information you want, as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=Metaspace:read-attribute(name=usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 0L,
        "used" =&gt; 42512536L,
        "committed" =&gt; 47448064L,
        "max" =&gt; -1L
    }
}</pre></div></li><li class="listitem">In case you are running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory-pool/name=Metaspace:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "Metaspace",
        "type" =&gt; "NON_HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; ["Metaspace_Manager"],
        "usage-threshold-supported" =&gt; true,
        "collection-usage-threshold-supported" =&gt; false,
        "usage-threshold" =&gt; 0L,
        "collection-usage-threshold" =&gt; undefined,
        "usage" =&gt; {
            "init" =&gt; 0L,
            "used" =&gt; 51111424L,
            "committed" =&gt; 56885248L,
            "max" =&gt; -1L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 0L,
            "used" =&gt; 51111424L,
            "committed" =&gt; 56885248L,
            "max" =&gt; -1L
        },
        "usage-threshold-exceeded" =&gt; false,
        "usage-threshold-count" =&gt; 0L,
        "collection-usage-threshold-exceeded" =&gt; undefined,
        "collection-usage-threshold-count" =&gt; undefined,
        "collection-usage" =&gt; undefined,
        "object-name" =&gt; "java.lang:type=MemoryPool,name=Metaspace"
    }
}</pre></div></li></ol></div><p>That's <a id="id661" class="indexterm"/>it!</p></div><div class="section" title="Eden"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec35"/>Eden</h3></div></div></div><p>For information on <a id="id662" class="indexterm"/>eden memory, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new <a id="id663" class="indexterm"/>terminal window and give the following commands:<div class="informalexample"><pre class="programlisting">$ cd /opt/wildfly
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Eden_Space:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Eden_Space",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; [
            "PS_MarkSweep",
            "PS_Scavenge"
        ],
        "usage-threshold-supported" =&gt; false,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; undefined,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 61270456L,
            "committed" =&gt; 147849216L,
            "max" =&gt; 147849216L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 67108864L,
            "committed" =&gt; 147849216L,
            "max" =&gt; 173539328L
        },
        "usage-threshold-exceeded" =&gt; undefined,
        "usage-threshold-count" =&gt; undefined,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 0L,
            "committed" =&gt; 147849216L,
            "max" =&gt; 147849216L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Eden Space\""
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information that you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with). However, in this case, you should better use the <code class="literal">read-attribute</code> syntax and then <a id="id664" class="indexterm"/><code class="literal">awk</code> the information you want, as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Eden_Space:read-attribute(name=usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 16777216L,
        "used" =&gt; 70648432L,
        "committed" =&gt; 147849216L,
        "max" =&gt; 147849216L
    }
}</pre></div></li><li class="listitem">In case you are running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory-pool/name=PS_Eden_Space:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Eden_Space",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; [
            "PS_MarkSweep",
            "PS_Scavenge"
        ],
        "usage-threshold-supported" =&gt; false,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; undefined,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 40625992L,
            "committed" =&gt; 58720256L,
            "max" =&gt; 144703488L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 58720256L,
            "committed" =&gt; 58720256L,
            "max" =&gt; 173539328L
        },
        "usage-threshold-exceeded" =&gt; undefined,
        "usage-threshold-count" =&gt; undefined,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 16777216L,
            "used" =&gt; 0L,
            "committed" =&gt; 58720256L,
            "max" =&gt; 144703488L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Eden Space\""
    }
}</pre></div></li></ol></div><p>That's <a id="id665" class="indexterm"/>it!</p></div><div class="section" title="Old"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec36"/>Old</h3></div></div></div><p> For information <a id="id666" class="indexterm"/>regarding old memory, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following:<div class="informalexample"><pre class="programlisting">$ cd /opt/wildfly
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Old_Gen:read-resource(include-runtime=true,include-defaults=true)"{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Old_Gen",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; ["PS_MarkSweep"],
        "usage-threshold-supported" =&gt; true,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; 0L,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 17330048L,
            "committed" =&gt; 59244544L,
            "max" =&gt; 358088704L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 17330048L,
            "committed" =&gt; 59244544L,
            "max" =&gt; 358088704L
        },
        "usage-threshold-exceeded" =&gt; false,
        "usage-threshold-count" =&gt; 0L,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 17330048L,
            "committed" =&gt; 59244544L,
            "max" =&gt; 358088704L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Old Gen\""
    }
}</pre></div></li><li class="listitem">Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with). However, in <a id="id667" class="indexterm"/>this case, you should better use the <code class="literal">read-attribute</code> syntax and then <code class="literal">awk</code> the information you want, as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Old_Gen:read-attribute(name=usage,include-defaults=true)"{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 45088768L,
        "used" =&gt; 17330048L,
        "committed" =&gt; 59244544L,
        "max" =&gt; 358088704L
    }
}</pre></div></li><li class="listitem">In case you are running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory-pool/name=PS_Old_Gen:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Old_Gen",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; ["PS_MarkSweep"],
        "usage-threshold-supported" =&gt; true,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; 0L,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 21521968L,
            "committed" =&gt; 70254592L,
            "max" =&gt; 358088704L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 21521968L,
            "committed" =&gt; 70254592L,
            "max" =&gt; 358088704L
        },
        "usage-threshold-exceeded" =&gt; false,
        "usage-threshold-count" =&gt; 0L,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 45088768L,
            "used" =&gt; 18670576L,
            "committed" =&gt; 70254592L,
            "max" =&gt; 358088704L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Old Gen\""
    }
}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="Survivor"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec37"/>Survivor</h3></div></div></div><p>For information <a id="id668" class="indexterm"/>regarding survivor memory, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and give the following commands:<div class="informalexample"><pre class="programlisting">$ cd /opt/wildfly
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Survivor_Space:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Survivor_Space",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; [
            "PS_MarkSweep",
            "PS_Scavenge"
        ],
        "usage-threshold-supported" =&gt; false,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; undefined,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 0L,
            "committed" =&gt; 15728640L,
            "max" =&gt; 15728640L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 12809608L,
            "committed" =&gt; 15728640L,
            "max" =&gt; 15728640L
        },
        "usage-threshold-exceeded" =&gt; undefined,
        "usage-threshold-count" =&gt; undefined,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 0L,
            "committed" =&gt; 15728640L,
            "max" =&gt; 15728640L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Survivor Space\""
    }
}</pre></div></li><li class="listitem">Obviously, you <a id="id669" class="indexterm"/>can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with). However, in this case, you should better use the <code class="literal">read-attribute</code> syntax and then <code class="literal">awk</code> the information you want, as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/core-service=platform-mbean/type=memory-pool/name=PS_Survivor_Space:read-attribute(name=usage,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 2621440L,
        "used" =&gt; 0L,
        "committed" =&gt; 15728640L,
        "max" =&gt; 15728640L
    }
}</pre></div></li><li class="listitem">In case you are running <a id="id670" class="indexterm"/>WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/core-service=platform-mbean/type=memory-pool/name=PS_Survivor_Space:read-resource(include-runtime=true,include-defaults=true)"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "name" =&gt; "PS_Survivor_Space",
        "type" =&gt; "HEAP",
        "valid" =&gt; true,
        "memory-manager-names" =&gt; [
            "PS_MarkSweep",
            "PS_Scavenge"
        ],
        "usage-threshold-supported" =&gt; false,
        "collection-usage-threshold-supported" =&gt; true,
        "usage-threshold" =&gt; undefined,
        "collection-usage-threshold" =&gt; 0L,
        "usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 15199856L,
            "committed" =&gt; 15204352L,
            "max" =&gt; 15204352L
        },
        "peak-usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 15199856L,
            "committed" =&gt; 15204352L,
            "max" =&gt; 15204352L
        },
        "usage-threshold-exceeded" =&gt; undefined,
        "usage-threshold-count" =&gt; undefined,
        "collection-usage-threshold-exceeded" =&gt; false,
        "collection-usage-threshold-count" =&gt; 0L,
        "collection-usage" =&gt; {
            "init" =&gt; 2621440L,
            "used" =&gt; 15199856L,
            "committed" =&gt; 15204352L,
            "max" =&gt; 15204352L
        },
        "object-name" =&gt; "java.lang:type=MemoryPool,name=\"PS Survivor Space\""
    }
}</pre></div></li></ol></div><p>That's it!</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec215"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would <a id="id671" class="indexterm"/>be as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /core-service=platform-mbean/type=memory:read-attribute(name=heap-memory-usage,include-defaults=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "init" =&gt; 67108864L,
        "used" =&gt; 76422344L,
        "committed" =&gt; 175112192L,
        "max" =&gt; 477626368L
    }
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p><p>You can try the other memory spaces yourself, by replacing the memory name with the one that you are interested in.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec216"/>There's more…</h2></div></div></div><p>WildFly provides one <a id="id672" class="indexterm"/>more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><p>Here we will examine just the JVM heap memory, as an example.</p><div class="section" title="Curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec38"/>Curl</h3></div></div></div><p>Perform the following steps using curl:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly instance, open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/core-service/platform-mbean/type/memory?operation=attribute\&amp;name=heap-memory-usage
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/core-service/platform-mbean/type/memory?operation=attribute&amp;name=heap-memory-usage HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="SwXvsbP7j0UNMTQzMjAxNjUxODY4Ml1gpwERAQYWFmaOqeygbx4=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 19 May 2015 06:21:58 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see,  <code class="literal">curl</code> complains about a Digest authentication for <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the <a id="id673" class="indexterm"/>username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/core-service/platform-mbean/type/memory?operation=attribute\&amp;name=heap-memory-usage
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/memory?operation=attribute&amp;name=heap-memory-usage HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="47ky6duDTAANMTQzMjAxNjY2NTc1NDQr1KuuN1GzJ50GQ0PUuCs=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 19 May 2015 06:24:25 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/core-service/platform-mbean/type/memory?operation=attribute&amp;name=heap-memory-usage'
* Found bundle for host 192.168.59.103: 0x7fa919d00dd0
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/core-service/platform-mbean/type/memory?operation=attribute&amp;name=heap-memory-usage HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="47ky6duDTAANMTQzMjAxNjY2NTc1NDQr1KuuN1GzJ50GQ0PUuCs=", uri="/management/core-service/platform-mbean/type/memory?operation=attribute&amp;name=heap-memory-usage", response="f04575d464d4151697dc6468610ec989", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="kFsM2zG0/XANMTQzMjAxNjY2NTc2MP4TtqHrlyzAujuq4ZLn9ek="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 82
&lt; Date: Tue, 19 May 2015 06:24:25 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
{"init" : 67108864, "used" : 62314024, "committed" : 222298112, "max" : 477626368}</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just the JSON output, after entering the password, as follows:<div class="informalexample"><pre class="programlisting">{"init" : 67108864, "used" : 66257248, "committed" : 222298112, "max" : 477626368}</pre></div><p>Neat, but pretty ugly!</p></li><li class="listitem">If you want to prettify <a id="id674" class="indexterm"/>the JSON output and you do not want to enter the password (you can pass it as an argument as well, with all the security concerns this comes with), you can execute the following commands:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/core-service/platform-mbean/type/memory?operation=attribute\&amp;name=heap-memory-usage\&amp;json.pretty=true{
    "init" : 67108864,
    "used" : 67826544,
    "committed" : 222298112,
    "max" : 477626368
}</pre></div></li></ol></div><p>That's the way I <a id="id675" class="indexterm"/>like it!</p></div></div></div>
<div class="section" title="Checking the server status"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec80"/>Checking the server status</h1></div></div></div><p>In this recipe, we will <a id="id676" class="indexterm"/>learn how to check the state of a running WildFly instance, by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec217"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec218"/>How to do it…</h2></div></div></div><p>Open a new terminal window and execute the following:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=server-state)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "running"
}</pre></div><p>You can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with), as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":read-attribute(name=server-state)" | awk 'NR==3 { print $3 }'
"running"</pre></div><p>In case you are running WildFly in the domain mode, the invocation is as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one:read-attribute(name=server-state)" | awk 'NR==3 { print $3 }'
"running"</pre></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec219"/>How it works…</h2></div></div></div><p>Here we are telling <a id="id677" class="indexterm"/>the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] :read-attribute(name=server-state)
{
    "outcome" =&gt; "success",
    "result" =&gt; "running"
}
[standalone@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec220"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl3sec39"/>curl</h3></div></div></div><p>With a running WildFly instance, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/?operation=attribute\&amp;name=server-state
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; GET /management/?operation=attribute&amp;name=server-state HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="kv+FBaxYgDINMTQzMjAxNzUzMTYyNbC9h3WcIBNOnUH1mBkR1vY=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 19 May 2015 06:38:51 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a Digest authentication for <code class="literal">ManagementRealm</code>, which is the one used by WildFly management interfaces.</p></li><li class="listitem">Let's give the <a id="id678" class="indexterm"/>username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/?operation=attribute\&amp;name=server-state
Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=server-state HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="Pl2q17HyCSsNMTQzMjAxNzU0NTUxOC3ZiDpK6wbWOysSkGTtFd8=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 19 May 2015 06:39:05 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/?operation=attribute&amp;name=server-state'
* Found bundle for host 192.168.59.103: 0x7f897b500c70
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; GET /management/?operation=attribute&amp;name=server-state HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="Pl2q17HyCSsNMTQzMjAxNzU0NTUxOC3ZiDpK6wbWOysSkGTtFd8=", uri="/management/?operation=attribute&amp;name=server-state", response="7b740a1695f01a9041a3d0c61cf35c91", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="3gZb5DbobbENMTQzMjAxNzU0NTUzOD7wAHJMcsZDujeJP3F/N9M="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 9
&lt; Date: Tue, 19 May 2015 06:39:05 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
"running"</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just <code class="literal">running</code>, after entering the password.</li><li class="listitem">If you do not want to <a id="id679" class="indexterm"/>enter the password, you can pass it as an argument as well, with all the security concerns this comes with. For this, execute the following:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/?operation=attribute \&amp;name=server-state
"running"</pre></div></li></ol></div></div></div></div>
<div class="section" title="Checking the JNDI tree view"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec81"/>Checking the JNDI tree view</h1></div></div></div><p>In this recipe, we will <a id="id680" class="indexterm"/>learn how to get the JNDI tree view of your WildFly instances, by invoking a command to the CLI. This might be useful in case you need to check whether some application context exits, if you need to know a datasource JNDI name, or if you need to lookup for an EJB.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec221"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec222"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a new terminal window and execute the as following:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 –command="/subsystem=naming:jndi-view"
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "java: contexts" =&gt; {
            "java:" =&gt; {"TransactionManager" =&gt; {
                "class-name" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate",
                "value" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate@16b89a30"
            }},
            "java:jboss" =&gt; {
                "TransactionManager" =&gt; {
                    "class-name" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate",
                    "value" =&gt; "com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate@16b89a30"
                },
                "TransactionSynchronizationRegistry" =&gt; {
                    "class-name" =&gt; "org.jboss.as.txn.service.internal.tsr.TransactionSynchronizationRegistryWrapper",
                    "value" =&gt; "org.jboss.as.txn.service.internal.tsr.TransactionSynchronizationRegistryWrapper@315ee6c0"
                },
                "UserTransaction" =&gt; {
                    "class-name" =&gt; "javax.transaction.UserTransaction",
                    "value" =&gt; "UserTransaction"
                },
                "jaas" =&gt; {
                    "class-name" =&gt; "com.sun.proxy.$Proxy11",
                    "value" =&gt; "java:jboss/jaas/ Context proxy"
                },
                "ee" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"concurrency" =&gt; {
                        "class-name" =&gt; "javax.naming.Context",
                        "children" =&gt; {
                            "scheduler" =&gt; {
                                "class-name" =&gt; "javax.naming.Context",
                                "children" =&gt; {"default" =&gt; {
                                    "class-name" =&gt; "java.lang.Object",
                                    "value" =&gt; "?"
                                }}
                            },
                            "factory" =&gt; {
                                "class-name" =&gt; "javax.naming.Context",
                                "children" =&gt; {"default" =&gt; {
                                    "class-name" =&gt; "java.lang.Object",
                                    "value" =&gt; "?"
                                }}
                            },
                            "executor" =&gt; {
                                "class-name" =&gt; "javax.naming.Context",
                                "children" =&gt; {"default" =&gt; {
                                    "class-name" =&gt; "java.lang.Object",
                                    "value" =&gt; "?"
                                }}
                            },
                            "context" =&gt; {
                                "class-name" =&gt; "javax.naming.Context",
                                "children" =&gt; {"default" =&gt; {
                                    "class-name" =&gt; "java.lang.Object",
                                    "value" =&gt; "?"
                                }}
                            }
                        }
                    }}
                },
                "datasources" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"ExampleDS" =&gt; {
                        "class-name" =&gt; "org.jboss.as.connector.subsystems.datasources.WildFlyDataSource",
                        "value" =&gt; "org.jboss.as.connector.subsystems.datasources.WildFlyDataSource@59b69704"
                    }}
                },
                "mail" =&gt; {
                    "class-name" =&gt; "javax.naming.Context",
                    "children" =&gt; {"Default" =&gt; {
                        "class-name" =&gt; "javax.mail.Session",
                        "value" =&gt; "javax.mail.Session@25c2acd6"
                    }}
                }
            },
            "java:jboss/exported" =&gt; undefined,
            "java:global" =&gt; undefined
        },
        "applications" =&gt; undefined
    }
}</pre></div><p>Obviously, you can extract just the information you need by using the <code class="literal">awk</code> command in the output (you can use whichever tool you are comfortable with).</p></li><li class="listitem">In case you are <a id="id681" class="indexterm"/>running WildFly in the domain mode, the invocation is as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command='/host=master/server=server-one/subsystem=naming:jndi-view'
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "java: contexts" =&gt; {
            ...
        },
        "applications" =&gt; {"example.war" =&gt; {
            "java:app" =&gt; {
                "AppName" =&gt; {
                    "class-name" =&gt; "java.lang.String",
                    "value" =&gt; "example"
                },
                "env" =&gt; {
                    "class-name" =&gt; "org.jboss.as.naming.NamingContext",
                    "value" =&gt; "env"
                }
            },
            "modules" =&gt; undefined
        }}
    }
}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec223"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> <a id="id682" class="indexterm"/>parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /subsystem=naming:jndi-view
....</pre></div><p>The output would be the <a id="id683" class="indexterm"/>same as shown in the image of the <span class="emphasis"><em>How to do it</em></span> section of this recipe.</p></div></div>
<div class="section" title="Invoking CLI commands declared in an external file"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Invoking CLI commands declared in an external file</h1></div></div></div><p>In this recipe, we <a id="id684" class="indexterm"/>will learn how to execute commands declared in a separate file, using the <code class="literal">jboss-cli.sh</code> script.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec224"/>Getting ready</h2></div></div></div><p>Remember I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p><p>Create a file named <code class="literal">wildfly-cookbook.cli</code>, and insert the listing command <code class="literal">ls</code> into it. Place the file in your local <code class="literal">$WILDFLY_HOME</code> folder.</p><p>Now it's time to invoke our commands through the CLI!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec225"/>How to do it…</h2></div></div></div><p>Open a new terminal window and execute the following:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --file=wildfly-cookbook.cli
core-service
deployment
deployment-overlay
extension
interface
path
socket-binding-group
subsystem
system-property
launch-type=STANDALONE
management-major-version=3
management-micro-version=0
management-minor-version=0
name=7536a491dba6
namespaces=[]
process-type=Server
product-name=WildFly Full
product-version=9.0.0.Beta2
profile-name=undefined
release-codename=Kenny
release-version=1.0.0.Beta2
running-mode=NORMAL
schema-locations=[]
server-state=running
suspend-state=RUNNING</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec226"/>How it works…</h2></div></div></div><p>Here we are telling the <code class="literal">jboss-cli.sh</code> script to read the commands defined inside the <code class="literal">wildfly-cookbook.2015</code> file, by the <code class="literal">--file</code> directive. The CLI reads our <code class="literal">wildfly-cookbook.cli</code> file and executes its commands.</p><p>Using a file to store the <a id="id685" class="indexterm"/>commands needed to configure your WildFly instance is very useful to automate configuration.</p><p>Imagine a scenario where you need to scale a system automatically. Suppose you have all your applications' source code in a version-control-software repository such as <code class="literal">git</code>, along with the <code class="literal">.cli</code> configuration files. It would be a piece of cake to download your app, build it, configure your WildFly instance using the <code class="literal">.cli</code> files, deploy the app, and start the server!</p><p>In the next chapter, we will discuss how to stop and start a server, deploy an application using the CLI, and much more.</p></div></div></body></html>