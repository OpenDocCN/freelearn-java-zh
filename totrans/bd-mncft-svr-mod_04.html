<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;4.&#xA0;Testing on the Spigot Server" id="VF2I1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04" class="calibre1"/>Chapter 4. Testing on the Spigot Server</h1></div></div></div><p class="calibre8">Bukkit plugins are designed to run on a CraftBukkit or Spigot server. At this point, you have a Spigot <a id="id100" class="calibre1"/>server and a simple plugin. After completing this chapter, you will have your new plugin installed on your server. In this chapter, you will make changes to your plugin's code, and you will quickly see it being reflected on your server. This will help you develop the plugin much faster and allow you to accomplish more as you create new plugins. You will also learn how to troubleshoot the code in order to fix it when it is not working properly. This chapter will cover the following topics:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Building a JAR file for your plugin</li><li class="listitem">Installing the plugin on your server</li><li class="listitem">Testing the plugin</li><li class="listitem">Testing new versions of the plugin</li><li class="listitem">Debugging the code</li></ul></div></div>

<div class="book" title="Chapter&#xA0;4.&#xA0;Testing on the Spigot Server" id="VF2I1-b66e70deee6e4ed481db4b113e303f23">
<div class="book" title="Building a JAR file"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch04lvl1sec27" class="calibre1"/>Building a JAR file</h1></div></div></div><p class="calibre8">In order to<a id="id101" class="calibre1"/> install a plugin on a server, we need a <code class="email">.jar</code> file. A <code class="email">JAR</code> file is a Java executable. It contains all the written code, which is bundled together in a ZIP file format. This code needs to be translated so that a computer can understand and run it.</p><p class="calibre8">In NetBeans, there is a single button that we can click on to build a project. This will generate the <code class="email">.jar</code> file that we need. Let's add a block of code to our project to automatically copy the created <code class="email">.jar</code> file to a more convenient location. In NetBeans, click on the <span class="strong"><strong class="calibre2">Files</strong></span> tab to access the <code class="email">build.xml file</code> for your project, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00025.jpeg" alt="Building a JAR file" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Open <code class="email">build.xml</code> and<a id="id102" class="calibre1"/> add the following block of code after the <code class="email">import</code> <code class="email">file</code> line:</p><div class="informalexample"><pre class="programlisting">&lt;target name="-post-jar"&gt;
  &lt;copy file="${dist.jar}" todir="../Plugin Jars" failonerror="true"/&gt;
&lt;/target&gt;</pre></div><p class="calibre8">This additional code will be executed after the JAR file is successfully built. It will copy the JAR file from the <code class="email">dist</code> directory to the specified location. You can change <code class="email">"../Plugin Jars"</code> to whichever directory you want. Here, <code class="email">..</code> means to go up one folder. Therefore, if your NetBeans project is located at <code class="email">C:\Users\Owner\Documents\NetBeansProjects\MyFirstBukkitPlugin</code>, then the <code class="email">.jar</code> file will be copied to <code class="email">C\Users\Owner\Documents\NetBeansProjects\Plugin Jars\MyFirstBukkitPlugin.jar</code>. Adding this code to each of your plugins will keep them organized in a central folder. After adding this new code, your file will look similar to the following piece of code:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="MyFirstBukkitPlugin" default="default" basedir="."&gt;
  &lt;description&gt;Builds, tests, and runs the project MyFirstBukkitPlugin.&lt;/description&gt;
  &lt;import file="nbproject/build-impl.xml"/&gt;
  &lt;target name="-post-jar"&gt;
    &lt;copy file="${dist.jar}" todir="../Plugin Jars" failonerror="true"/&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip08" class="calibre1"/>Tip</h3><p class="calibre8">In the preceding code, <code class="email">failonerror</code> is set to <code class="email">true</code>. This means that an error will be presented when building in case the JAR file fails to be copied to the defined location. An error such as this may indicate that the location does not exist or you have insufficient privileges. You can set this value to <code class="email">false</code> if you do not wish to see these warnings.</p></div><p class="calibre8">Note that you <a id="id103" class="calibre1"/>will have many additional lines between <code class="email">&lt;!--</code> and <code class="email">--&gt;</code>. These are comments, and I encourage you to read them if you wish to learn more about what you can add to the <code class="email">build.xml</code> file. Once you save this file, you are ready to build your project. You can do so by clicking on the hammer icon or using the <span class="strong"><em class="calibre9">F11</em></span> shortcut key. The hammer icon, which is present on your toolbar, looks like the following image:</p><div class="mediaobject"><img src="../images/00026.jpeg" alt="Building a JAR file" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">If NetBeans fails to successfully build a jar, then you may have errors in your code.</p><p class="calibre8">These errors are most likely shown by the red lines and light bulbs, as seen in <a class="calibre1" title="Chapter 3. Creating Your First Bukkit Plugin" href="part0026_split_000.html#OPEK1-b66e70deee6e4ed481db4b113e303f23">Chapter 3</a>, <span class="strong"><em class="calibre9">Creating Your First Bukkit Plugin</em></span>. You can usually find these errors by hovering over or clicking on the bulbs for help. If you are not able to do so, refer to the previous chapter to check whether your code is correct or not. If you still have doubts, refer to <a class="calibre1" title="Chapter 2. Learning the Bukkit API" href="part0020_split_000.html#J2B81-b66e70deee6e4ed481db4b113e303f23">Chapter 2</a>, <span class="strong"><em class="calibre9">Learning the Bukkit API</em></span> for help.</p></div></div>
<div class="book" title="Installing the plugin" id="10DJ41-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec28" class="calibre1"/>Installing the plugin</h1></div></div></div><p class="calibre8">The installation <a id="id104" class="calibre1"/>of the new plugin is quite simple. You need to create a copy of the <code class="email">.jar</code> file from the directory that you chose earlier in your server's <code class="email">plugins</code> folder. Then, start your server as you normally would. You will see the output of the console informing you that the plugin is loaded, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00027.jpeg" alt="Installing the plugin" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">If you<a id="id105" class="calibre1"/> do not see the <code class="email">Hello World!</code> message when your server initially starts, don't worry. This behavior is normal because at this point, there will never be players online for the message to be broadcasted to. For now, we are only concerned with the messages that were highlighted in the previous screenshot.</p><p class="calibre8">Every time you make changes to the code, you will have to build a new JAR file and install the new version. To install the newer version, you can simply copy and paste it into the server's <code class="email">plugin</code> folder and overwrite the old file. This can be usually done without even shutting down the server. However, if the server is running, you will need to use the <code class="email">reload</code> command to load the new version.</p><p class="calibre8">If you do not wish to manually copy the <code class="email">plugin .jar</code> file and paste it in the server's plugin folder every time you make changes in the code, then you can automate it in <code class="email">build.xml</code>. In addition to copying the <code class="email">jar</code> file and pasting it in the <code class="email">Plugin Jars</code> directory, you can also copy and paste it directly in your server's <code class="email">plugins</code> directory. To do so, add a second <code class="email">copy file</code> tag and set <code class="email">todir</code> to your server's <code class="email">plugin</code> directory. The following code is an example of what this will look like:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="MyFirstBukkitPlugin" default="default" basedir="."&gt;
  &lt;description&gt;Builds, tests, and runs the project MyFirstBukkitPlugin.&lt;/description&gt;
  &lt;import file="nbproject/build-impl.xml"/&gt;
  &lt;target name="-post-jar"&gt;
    &lt;copy file="${dist.jar}" todir="../ Plugin Jars" failonerror="true"/&gt;
    &lt;copy file="${dist.jar}" todir="C:/Users/Owner/Desktop/Bukkit Server/plugins" failonerror="true"/&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre></div><p class="calibre8">Again, you<a id="id106" class="calibre1"/> should do this for every plugin that you want to automatically install on your server.</p></div>
<div class="book" title="Testing your plugin" id="11C3M1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec29" class="calibre1"/>Testing your plugin</h1></div></div></div><p class="calibre8">As you<a id="id107" class="calibre1"/> may recall, the purpose of the first plugin was to discover when a plugin is loaded. Issue a <code class="email">reload</code> command by typing the following command into the console:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">&gt;reload</strong></span>
</pre></div><p class="calibre8">You will see that Spigot will automatically disable and re-enable the plugin, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00028.jpeg" alt="Testing your plugin" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">This time, you will see the <span class="strong"><strong class="calibre2">Hello World!</strong></span> message once your plugin is enabled. If exactly one player is online, then it will say hello to that player. Let's observe this by logging onto the server and issuing the reload command from in-game. Open your Minecraft client and connect to your server. From in-game, first issue the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">/plugins</strong></span>
</pre></div><p class="calibre8">You will be given a list of all the plugins that are installed. For now, there is only one plugin, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00029.jpeg" alt="Testing your plugin" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Now that there is one player on the server, we can test the plugin by reloading the server. Issue the following in-game command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong class="calibre2">/reload</strong></span>
</pre></div><p class="calibre8">Note that in both the game and console, you will see the <span class="strong"><strong class="calibre2">Hello Codisimus</strong></span> message, as shown in the following screenshot, to indicate that the plugin is working as intended:</p><div class="mediaobject"><img src="../images/00030.jpeg" alt="Testing your plugin" class="calibre10"/></div><p class="calibre11"> </p></div>
<div class="book" title="Testing new versions of the plugin" id="12AK81-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec30" class="calibre1"/>Testing new versions of the plugin</h1></div></div></div><p class="calibre8">The plugin <a id="id108" class="calibre1"/>works as intended, but there is always room for improvement. Let's continue working with this plugin by adding code to it.</p><p class="calibre8">A player may not see the <span class="strong"><strong class="calibre2">hello</strong></span> message when it is white in color. We can change the color of the message using <code class="email">ChatColor Enum</code>. This <code class="email">Enum constants</code> has all the color codes that are supported in-game so that we can easily add them to messages. Let's modify the plugin and install the newly modified version on the server. Choose your favorite color and place it before the message in the <code class="email">broadcastToServer</code> method, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">Bukkit.broadcastMessage(ChatColor.BLUE + msg);</pre></div><p class="calibre8">Before you build a new JAR file, change the version in <code class="email">plugin.yml</code> to <code class="email">0.2</code> to indicate that this is an updated version. Each time you make a revision to the code, you create a new version. Changing the version number to reflect the code change will ensure that the new code will have a unique version number assigned to it. This is valuable if you need to know the code changes that are included within a specific edition of the project.</p><p class="calibre8">Build a new JAR file using either the build icon or the <span class="strong"><em class="calibre9">F11</em></span> key. Copy and paste the new version into the <code class="email">plugins</code> folder if you did not set up <code class="email">build.xml</code> to do so automatically. Issue the <code class="email">reload</code> command again to view the results, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00031.jpeg" alt="Testing new versions of the plugin" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">The plugin has been reloaded and the message is now in color. Also, note how the version number changes when the plugin is disabled, and again when it is loaded and enabled. This makes it clear that the new version of the plugin was successfully installed on the server.</p><p class="calibre8">Try to <a id="id109" class="calibre1"/>expand this plugin more on your own to test different code. The following list contains a few challenges for you:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Program the plugin to display the actual name of the world rather than the word <span class="strong"><strong class="calibre2">World</strong></span>. A hint for this challenge is that you can get a list of all the worlds and then use the first world in the list. Note that this will broadcast <code class="email">Hello world!</code>, unless you have renamed the world in <code class="email">server.properties</code>.</li><li class="listitem">Send a message to the player rather than broadcasting the message to the entire server.</li><li class="listitem">If more than one player is online, send a unique hello message to each player. A hint for this is that you can use a <code class="email">for</code> loop.</li><li class="listitem">If no players are online, send a unique hello message for each world.</li></ul></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Debugging the code"><div class="book" id="1394Q2-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec31" class="calibre1"/>Debugging the code</h1></div></div></div><p class="calibre8">As you<a id="id110" class="calibre1"/> develop this plugin as well as other Bukkit plugins, there will be times when the code that you have written does not function as you would expect. This is caused by an error that lies somewhere in the code. These errors are referred to as <span class="strong"><strong class="calibre2">bugs</strong></span>, and <a id="id111" class="calibre1"/>the<a id="id112" class="calibre1"/> process of finding these bugs and removing them is called <span class="strong"><strong class="calibre2">debugging</strong></span>.</p></div>

<div class="book" title="Debugging the code">
<div class="book" title="Learning from your mistakes"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch04lvl2sec10" class="calibre1"/>Learning from your mistakes</h2></div></div></div><p class="calibre8">Do not be discouraged when your plugin does not work on the first try. Even experienced programmers encounter bugs throughout their code. Just because your software does not work perfectly does not mean that you are a poor developer. Being able to discover bugs and fix them is a huge part of software development. The more mistakes you make, the more you can learn from them. This is apparent in the following example.</p><p class="calibre8">Some day, you<a id="id113" class="calibre1"/> may write a plugin that has a list of players in it. You may then write the following <code class="email">for</code> loop to loop through each player and remove those who are in the <code class="email">CREATIVE</code> mode:</p><div class="informalexample"><pre class="programlisting">for (Player player : playerList) {
  if (player.getGameMode() == GameMode.CREATIVE) {
    playerList.remove(player);
  }
}</pre></div><p class="calibre8">When you test this code, an error will likely occur. The error that is thrown will be a <code class="email">ConcurrentModificationException method</code>. The name of the exception may not mean much to you, but it will help you narrow down the issue.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre8">Developers need not know how to fix every error, but they should know where to find information about those errors so that they can figure out how to fix them. This is usually found in the software's documentation or public message boards. Most developers will make a note of the error message and search for information about it using Google. The top results will often be the official documentation or posts from other people who have encountered the same issue.</p></div><p class="calibre8">To know<a id="id114" class="calibre1"/> more about the error, you can search for <code class="email">ConcurrentModificationException</code>; you may find the following statement from Oracle's <span class="strong"><strong class="calibre2">Javadoc</strong></span>:</p><div class="blockquote"><blockquote class="blockquote1"><p class="calibre24"><span class="strong"><em class="calibre9">"For example, it is not generally permissible for one thread to modify a Collection while another thread is iterating over it. "</em></span></p></blockquote></div><p class="calibre8">The official javadoc can prove to be useful. But sometimes, they are still difficult to understand. Luckily, there exist websites such as <a class="calibre1" href="http://stackoverflow.com">stackoverflow.com</a>, which allow programmers to help each other debug code. If you refer back to the search results, you will see links <a id="id115" class="calibre1"/>to Stack Overflow questions as well as posts from similar websites. These links can be very helpful because often there are people just like you who have run into the same error. If you look at the questions and the answers provided by others, you can learn why this error occurs and how to remedy it.</p><p class="calibre8">After reading through the questions related to the concurrent modification bug, you will eventually learn that in most cases, the exception occurs when you attempt to modify a list or collection while looping through it. You will also find that you must use an iterator in order to avoid this scenario. Usually, there are examples of how to fix the bug too. In this case, there are explanations of how to correctly use an iterator to remove objects from a list. If an explanation is not present, then you can research iterators within Oracle's javadoc just as you would use Bukkit's javadoc. We can fix the previous code by using an iterator, as follows:</p><div class="informalexample"><pre class="programlisting">Iterator&lt;Player&gt; itr = playerList.iterator();
while (itr.hasNext()) {
  Player palyer = itr.next();
  if (player.getGameMode() == GameMode.CREATIVE) {
    itr.remove();
  }
}</pre></div><p class="calibre8">After fixing the concurrent modification bug that was present in the code, you are now a more experienced programmer. You will know how to avoid this issue in the future and you have even learned how to use an iterator in the process.</p></div></div>

<div class="book" title="Debugging the code">
<div class="book" title="When researching is not enough"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch04lvl2sec11" class="calibre1"/>When researching is not enough</h2></div></div></div><p class="calibre8">Sometimes, looking<a id="id116" class="calibre1"/> through documentation and reading message boards<a id="id117" class="calibre1"/> is not enough to fix a bug. Errors such as <span class="strong"><strong class="calibre2">NullPointerException</strong></span> are very common and can be caused by a variety of things. By researching, you will discover that <span class="strong"><strong class="calibre2">NullPointerException</strong></span> occurs when you attempt to access <a id="id118" class="calibre1"/>a method or field of a <span class="strong"><strong class="calibre2">null</strong></span> object. "Null" refers to the lack of a value. Therefore, a null object is an object that does not exist. However, knowing this does not always help you find exactly which object has a null value and why it is a null value in the first place. To aid in finding bugs, here are some steps to follow to pinpoint the troublesome code.</p><div class="book" title="Reading the stack trace"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch04lvl3sec01" class="calibre1"/>Reading the stack trace</h3></div></div></div><p class="calibre8">Most <a id="id119" class="calibre1"/>errors in Java are presented in the form of a <span class="strong"><strong class="calibre2">stack trace</strong></span>. A stack<a id="id120" class="calibre1"/> trace informs you of the lines of code that were being executed before the error occurred. On a Spigot server, these stack traces will appear similar to the following screenshot:</p><div class="mediaobject"><img src="../images/00032.jpeg" alt="Reading the stack trace" class="calibre10"/></div><p class="calibre11"> </p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip10" class="calibre1"/>Tip</h3><p class="calibre8">If your server is hosted somewhere else and you are viewing the console through an online browser tool, the stack trace may be printed in the reverse order.</p></div><p class="calibre8">Whenever there is an exception on your server, Spigot logs the error along with the plugin that caused it. Sometimes, there are even details of which event was in progress when the<a id="id121" class="calibre1"/> error occurred. With the stack trace shown in the preceding screenshot, we can see that the error was caused by <code class="email">MyFirstBukkitPlugin</code> <code class="email">version 0.3</code>. If the version does not match the version that you have in your <span class="strong"><strong class="calibre2">IDE</strong></span>, you will want to update the server with the latest version of the plugin. This way, you can be certain that the code running on the server is the same code that you have in NetBeans. We can also see that the exception was thrown when the plugin was being enabled. On the next line, we see the specific error, which was <span class="strong"><strong class="calibre2">NullPointerException</strong></span>. On the line following that, we are told the exact line of code that caused the error. It happened within the <code class="email">onEnable</code> method of the <code class="email">MyFirstBukkitPlugin</code> class. In parenthesis, it states <span class="strong"><strong class="calibre2">MyFirstBukkitPlugin.java:27</strong></span>. This tells us that the error was on line 27 of the <code class="email">MyFirstBukkitPlugin</code> class, which of course is in the <code class="email">onEnable</code> method. The first three lines of the stack trace are the most useful to us. You rarely have to look at the further lines for explanation. Sometimes, you will not see any of the class names in the code at the start of the stack trace. However, if you look further, you will probably see a familiar class and method name.</p><p class="calibre8">Now that you have the class name and line number, you can look back at your code to see if you notice why you are getting <span class="strong"><strong class="calibre2">NullPointerException</strong></span>. Within NetBeans, I can see that line 27 is as follows:</p><div class="informalexample"><pre class="programlisting">Bukkit.getPlayer("Codisimus").sendMessage("Hello, there are " + Bukkit.getOnlinePlayers().size() + " player(s) online and " + Bukkit.getWorlds().size() + " world(s) loaded.");</pre></div></div></div></div>

<div class="book" title="Debugging the code">
<div class="book" title="Breaking down the code"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch04lvl2sec12" class="calibre1"/>Breaking down the code</h2></div></div></div><p class="calibre8">The <a id="id122" class="calibre1"/>troublesome line is a very long line of code. So, it is not apparent which object has a null value. If you find yourself in a similar situation, I recommend that you break down the code into multiple lines. This will give us the following code:</p><div class="informalexample"><pre class="programlisting">Player player = Bukkit.getPlayer("Codisimus");
int playerCount = Bukkit.getOnlinePlayers().size();
int worldCount = Bukkit.getWorlds().size();
player.sendMessage("Hello, there is " + playerCount + " player(s) online and " + worldCount + " world(s) loaded.");</pre></div><p class="calibre8">After installing and running this new code, you should see the same error in the console, but it will point you to a different line of code. With this new code, you will now see that the exception is thrown on line 30, which is the last line of the preceding code segment.</p></div></div>

<div class="book" title="Debugging the code">
<div class="book" title="Adding debug messages"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch04lvl2sec13" class="calibre1"/>Adding debug messages</h2></div></div></div><p class="calibre8">There is<a id="id123" class="calibre1"/> still a lot going on in that single line of code. Therefore, you may not be sure about which variable is null. Is it <code class="email">player</code>, <code class="email">playerCount</code>, or <code class="email">worldCount</code>? If you need some additional help, you can add what we call debug messages to your code. These messages can print information to the console log to indicate what is happening throughout the code. There are a few ways to log messages in a Bukkit plugin. The easiest way is to use the <code class="email">System.out.println(String string)</code> method. However, it is a better practice to utilize the logger that the Spigot server assigns to your plugin. The logger can be retrieved with the <code class="email">getLogger</code> method. This method is in the <code class="email">JavaPlugin</code> class. You can access it from within the <code class="email">onEnable</code> method. These debug messages will only be temporary. Therefore, you can use whichever method you prefer. But I do suggest that you try using the logger as it also prints out plugin information. In our example, we will use the logger.</p><p class="calibre8">Now that we know how to print messages, let's log the values of each variable, as follows:</p><div class="informalexample"><pre class="programlisting">Player player = Bukkit.getPlayer("Codisimus");int playerCount = Bukkit.getOnlinePlayers().size();int worldCount = Bukkit.getWorlds().size();Logger logger = getLogger();logger.warning("player: " + player);logger.warning("playerCount: " + playerCount);logger.warning("worldCount: " + worldCount);player.sendMessage("Hello, there is " + playerCount + " player(s) online and " + worldCount + " world(s) loaded.");</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip11" class="calibre1"/>Tip</h3><p class="calibre8">Note that we have added the debug messages before the faulty line of code. Once an exception is thrown, the computer stops executing the code. Therefore, if the debug messages were after the <code class="email">sendMessage </code>call, the messages would never be printed.</p></div><div class="mediaobject"><img src="../images/00033.jpeg" alt="Adding debug messages" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">Once you install and run the updated code, you will see the debug messages within the console:</p><p class="calibre8">Now, we<a id="id124" class="calibre1"/> can clearly see that <code class="email">player</code> has a <code class="email">null</code> value.</p></div></div>

<div class="book" title="Debugging the code">
<div class="book" title="Referring back to the Javadoc"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch04lvl2sec14" class="calibre1"/>Referring back to the Javadoc</h2></div></div></div><p class="calibre8">If you<a id="id125" class="calibre1"/> look back at the line of code where <code class="email">player</code> is set and then read the Bukkit javadoc, you will learn that player has a value of  null because the requested player, Codisimus, is not online. If the player cannot be found, <code class="email">null</code> is returned.</p><div class="mediaobject"><img src="../images/00034.jpeg" alt="Referring back to the Javadoc" class="calibre10"/></div><p class="calibre11"> </p><p class="calibre8">As you can see, the bug in the code may not be exactly at the line given in the stack trace. In this scenario, the null value is set a few lines earlier.</p></div></div>

<div class="book" title="Debugging the code">
<div class="book" title="Fixing the bug only after you understand it"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_6"><a id="ch04lvl2sec15" class="calibre1"/>Fixing the bug only after you understand it</h2></div></div></div><p class="calibre8">Now <a id="id126" class="calibre1"/>that the bug is exposed, we can fix it. In the case of <span class="strong"><strong class="calibre2">NullPointerException</strong></span>, there are two solutions. Do not simply fix the bug a certain way because you can. You should strive to understand why the bug is present and how the code should function instead. Maybe, the variable player is never supposed to have a null value. If I know that the player Codisimus will always be online, then perhaps, I misspelled the username. However, we know that Codisimus will not always be online. So, within this plugin, the player variable will sometimes have a null value. In that scenario, we do not want to try to send a message to the player, since it will throw <span class="strong"><strong class="calibre2">NullPointerException</strong></span>. To remedy this, we can put the line of code within an <code class="email">if</code> statement, which developers typically refer to as a null check:</p><div class="informalexample"><pre class="programlisting">Player player = Bukkit.getPlayer("Codisimus");
int playerCount = Bukkit.getOnlinePlayers().size();
int worldCount = Bukkit.getWorlds().size();
//Logger logger = getLogger();
//logger.warning("player: " + player);
//logger.warning("playerCount: " + playerCount);
//logger.warning("worldCount: " + worldCount);
if (player != null) {
    player.sendMessage("Hello, there is " + playerCount + " player(s) online and " + worldCount + " world(s) loaded.");
}</pre></div><div class="informalexample" title="Note"><h3 class="title2"><a id="tip12" class="calibre1"/>Tip</h3><p class="calibre8">Note that I have changed the debug messages to comments by prepending them with // so that those messages are not printed to the log. Alternatively, I can remove these lines completely if I feel that I will never need them again.</p></div><p class="calibre8">Now <a id="id127" class="calibre1"/>that we have added the null check, the message will only be sent if the player is not null.</p></div></div>
<div class="book" title="Summary" id="147LC1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch04lvl1sec32" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">You now know how to create a JAR file from a NetBeans project. For the plugins that you will create in the future, you can follow this simple process in order to install and run your new plugin, whether it is for testing or for a finished product. You also know how to update a plugin that is already installed on your server and fix the bugs that are exposed in your code. In the following chapters, we will create increasingly complex plugins. The first step to this is creating commands for plugins that players will be able to execute in game.</p></div></body></html>