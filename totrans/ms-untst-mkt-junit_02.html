<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02" class="calibre1"/>Chapter 2. Automating JUnit Tests</h1></div></div></div><p class="calibre9">In this chapter, you will be introduced to the concept of <span class="strong"><strong class="calibre10">Extreme Programming</strong></span> (<span class="strong"><strong class="calibre10">XP</strong></span>), <span class="strong"><strong class="calibre10">Continuous Integration</strong></span> (<span class="strong"><strong class="calibre10">CI</strong></span>), the benefits of CI, and JUnit test automation using various tools.</p><p class="calibre9">The following topics will be covered in this chapter:</p><div class="book"><ul class="itemizedlist"><li class="listitem">CI</li><li class="listitem">Gradle automation</li><li class="listitem">Maven project management</li><li class="listitem">Ant</li><li class="listitem">Jenkins</li></ul></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests">
<div class="book" title="Continuous Integration"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch02lvl1sec13" class="calibre1"/>Continuous Integration</h1></div></div></div><p class="calibre9">In college, I was working on a critical steganography (image watermarking) project and simultaneously developing a module on my home computer, where I integrated my changes with other changes on the <a id="id177" class="calibre1"/>college server. Most of my time was wasted in integration. After manual integration, I would find everything broken; so, integration was terrifying.</p><p class="calibre9">When CI is not available, development teams or developers make changes to code and then all the code changes are brought together and merged. Sometimes, this merge is not very simple; it involves the integration of lots of conflicting changes. Often, after integration, weird bugs crop up and a working module may start to fail, as it involves a complete rework of numerous modules. Nothing goes as planned and the delivery is delayed. As a result, the predictability, cost, and customer service are affected.</p><p class="calibre9">CI is an XP concept. It was introduced to prevent integration issues. In CI, developers commit the code periodically, and every commit is built. Automated tests verify the system integrity. It helps in the incremental development and periodic delivery of the working software.</p></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests">
<div class="book" title="Continuous Integration">
<div class="book" title="Benefits of CI"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec21" class="calibre1"/>Benefits of CI</h2></div></div></div><p class="calibre9">CI is meant to make sure that we're not breaking something unconsciously in our hurry. We want to run the<a id="id178" class="calibre1"/> tests continuously, and we need to be warned if they fail.</p><p class="calibre9">In a good software<a id="id179" class="calibre1"/> development team, we'd find<a id="id180" class="calibre1"/> <span class="strong"><strong class="calibre10">test-driven development</strong></span> (<span class="strong"><strong class="calibre10">TDD</strong></span>) as well as CI.</p><p class="calibre9">CI requires a listener tool to keep an eye on the version control system for changes. Whenever a change is committed, this tool automatically compiles and tests the application (sometimes it creates a WAR file, deploys the WAR/EAR file, and so on).</p><p class="calibre9">If compilation fails, or a test fails, or deployment fails, or something goes wrong, the CI tool immediately notifies the concerned team so that they can fix the issue.</p><p class="calibre9">CI is a concept; to adhere to CI, tools such as Sonar and FindBugs can be added to the build process to track the code quality, and they automatically monitor the code quality and code coverage metrics. Good quality code gives us confidence that a team is following the right path. Technical debts can be identified very quickly, and the team can start reducing the debts. Often, CI tools have the ability to present dashboards pertaining to quality metrics.</p><p class="calibre9">In a nutshell, CI tools enforce code quality, predictability, and provide quick feedback, which reduces the potential risk. CI helps to increase the confidence in the build. A team can still write very poor quality code, even test poor quality code, and the CI will not care.</p><p class="calibre9">Numerous CI tools are available on the<a id="id181" class="calibre1"/> market, such as Go, Bamboo, TeamCity, CruiseControl, and Jenkins. However, CruiseControl and Jenkins are the widely used ones.</p><p class="calibre9">Jenkins supports various build scripting tools. It integrates almost all sorts of projects and is easy to configure. In this chapter, we will work with Jenkins.</p><p class="calibre9">CI is just a generic conduit to run the commands; often, build tools are used to execute the commands, and then the CI tool collects the metrics produced by the commands or build tools. Jenkins needs build scripts to execute tests, compile the source code, or even deploy deliverables. Jenkins supports different build tools to execute the commands—Gradle, Maven, and Ant are the widely used ones. We will explore the build tools and then work with Jenkins.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note07" class="calibre1"/>Note</h3><p class="calibre9">You can download the code for this chapter. Extract the ZIP file. It contains a folder named <code class="literal">Packt</code>. This folder has two subfolders: <code class="literal">gradle</code> and <code class="literal">chapter02</code>. The <code class="literal">gradle</code> folder contains the basic Gradle examples and the <code class="literal">chapter02</code> folder contains the Java projects and Ant, Gradle, and Maven build scripts.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests">
<div class="book" title="Continuous Integration">
<div class="book" title="Gradle automation"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec22" class="calibre1"/>Gradle automation</h2></div></div></div><p class="calibre9">
<span class="strong"><strong class="calibre10">Gradle</strong></span> is a build automation tool. Gradle has many benefits such as loose structure, ability to write scripts<a id="id182" class="calibre1"/> to build, simple two-pass project resolution, dependency<a id="id183" class="calibre1"/> management, remote plugins, and so on.</p><p class="calibre9">The best feature of Gradle is the ability to create a <a id="id184" class="calibre1"/>
<span class="strong"><strong class="calibre10">domain-specific language</strong></span> (<span class="strong"><strong class="calibre10">DSL</strong></span>) for the build. An example would be generate-web-service-stubs or run-all-tests-in-parallel.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note08" class="calibre1"/>Note</h3><p class="calibre9">A DSL is a programming language specialized for a domain and focuses on a particular aspect of a system. HTML is an example of DSL. We cannot build an entire system with a DSL, but DSLs are used to solve problems in a particular domain. The following are the examples of DSLs:</p><div class="book"><ul class="itemizedlist"><li class="listitem">A DSL for building Java projects</li><li class="listitem">A DSL for drawing graph</li></ul></div></div><p class="calibre9">It's one of the <span class="strong"><strong class="calibre10">unique selling point</strong></span> (<span class="strong"><strong class="calibre10">USP</strong></span>) is an<a id="id185" class="calibre1"/> incremental build. It can be configured to build a project only if any resource has changed in the project. As a result, the overall build execution time decreases.</p><p class="calibre9">Gradle comes up with numerous preloaded plugins for different projects types. We can either use them or override.</p><p class="calibre9">Unlike Maven or Ant, Gradle is not XML based; it is based on a dynamic language called <span class="strong"><strong class="calibre10">Groovy</strong></span>. Groovy<a id="id186" class="calibre1"/> is a developer-friendly<a id="id187" class="calibre1"/> <span class="strong"><strong class="calibre10">Java Virtual Machine</strong></span> (<span class="strong"><strong class="calibre10">JVM</strong></span>) language. Its syntax makes it easier to express the code intent and provides ways to effectively use expressions, collections, closures, and so on. Groovy programs run on JVM; so, if we write Java code in a Groovy file, it will run. Groovy supports DSL to make your code readable and maintainable.</p><p class="calibre9">Groovy's home page is <a class="calibre1" href="http://groovy.codehaus.org/">http://groovy.codehaus.org/</a>.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip03" class="calibre1"/>Tip</h3><p class="calibre9">We can use Ant or Maven in a Gradle script. Gradle supports the Groovy syntax. Gradle provides support for Java, Web, Hibernate, GWT, Groovy, Scala, OSGi, and many other projects.</p></div><p class="calibre9">Big companies such as LinkedIn and Siemens use Gradle. Many open source projects, such as Spring, Hibernate, and Grails use Gradle.</p><div class="book" title="Getting started"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec21" class="calibre1"/>Getting started</h3></div></div></div><p class="calibre9">Java (jdk 1.5 +) needs to be installed before executing a<a id="id188" class="calibre1"/> Gradle script. The steps to do this are as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Go to the command prompt and run <code class="literal">java –version</code>; if Java is not installed or the version is older than 1.5, install the latest version from the Oracle site.</li><li class="listitem" value="2">Gradle is available at <a class="calibre1" href="http://www.gradle.org/downloads">http://www.gradle.org/downloads</a>. Once the download is complete, extract the media. You will find that it includes a <code class="literal">bin</code> directory. Open the<a id="id189" class="calibre1"/> command prompt and go to the <code class="literal">bin</code> directory. You can extract the media to any directory you want. For example, if you extract the Gradle media under <code class="literal">D:\Software\gradle-1.10</code>, then open the command prompt and go to <code class="literal">D:\Software\gradle-1.10\bin</code>.</li><li class="listitem" value="3">Now, check the Gradle version using the <code class="literal">gradle –v</code> command. It will show you the version and other configuration. To run the Gradle from anywhere in your computer, create a <code class="literal">GRADLE_HOME</code> environment variable and set the value to the location where you extracted the Gradle media.</li><li class="listitem" value="4">Add <code class="literal">%GRADLE_HOME%\bin</code> (in Windows) to the <code class="literal">PATH</code> variable (export <code class="literal">GRADLE_HOME</code> and <code class="literal">PATH</code> to <code class="literal">bash_login</code> in Linux and <code class="literal">bashrc</code> in Mac).</li><li class="listitem" value="5">Open a new command prompt, go to any folder, and run the same command <code class="literal">gradle –v</code> again to check whether the <code class="literal">PATH</code> variable is set correctly.</li></ol><div class="calibre17"/></div><p class="calibre9">The other option is to use the Gradle wrapper (<code class="literal">gradlew</code>) and allow the batch file (or shell script) to download the version of Gradle specific to each project. This is an industry standard for working with Gradle, which ensures that there's consistency among Gradle versions. The Gradle wrapper is also checked into the source code control along with the build artifacts.</p></div><div class="book" title="Gradling"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec22" class="calibre1"/>Gradling</h3></div></div></div><p class="calibre9">In the programming world, "Hello World" is the starting point. In this section, we will write our first "Hello World" Gradle script. A Gradle script can build one or more projects. Each project can have one or more tasks. A task can <a id="id190" class="calibre1"/>be anything like compiling Java files or building a WAR file.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip04" class="calibre1"/>Tip</h3><p class="calibre9">To execute a task, we will create a <code class="literal">build.gradle</code> file and execute the <code class="literal">gradle</code> command to <a id="id191" class="calibre1"/>run a build. Gradle will look for a file named <code class="literal">build.gradle</code> in the current directory. To execute a build file other than <code class="literal">build.gradle</code>, use the <code class="literal">–b &lt;file name&gt;</code> option.</p></div><p class="calibre9">We will create a task to print "Hello World" on the console. Perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open a text editor and enter the following:<div class="informalexample"><pre class="programlisting">task firstTask &lt;&lt; {
  println 'Hello world.'
}</pre></div><p class="calibre15">Save the file as <code class="literal">build.gradle</code>.</p></li><li class="listitem" value="2">Open the command prompt <a id="id192" class="calibre1"/>and browse to the folder where you saved the <code class="literal">build.gradle</code> file. Run the <code class="literal">gradle firstTask</code> command, or if you saved the file under <code class="literal">D:\Packt\gradle</code>, simply open the command prompt and run <code class="literal">gradle –b D:\Packt\gradle\build.gradle firstTask</code>.<p class="calibre15">The following information will be printed on the command prompt:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">:firstTask</strong></span>
<span class="strong"><strong class="calibre10">Hello world.</strong></span>
<span class="strong"><strong class="calibre10">BUILD SUCCESSFUL</strong></span>
</pre></div></li></ol><div class="calibre17"/></div><p class="calibre9">Here, <code class="literal">task</code> defines a Gradle task and <code class="literal">&lt;&lt;</code> defines a task called <code class="literal">firstTask</code> with a single closure to execute. The <code class="literal">println</code> command is Groovy's equivalent to Java's <code class="literal">System.out.println</code>.</p><p class="calibre9">When we executed the task using its name, the output shows the task name and then printed the <span class="strong"><strong class="calibre10">Hello world</strong></span> message.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip05" class="calibre1"/>Tip</h3><p class="calibre9">Using the<code class="literal">–q</code> option, we can turn off the Gradle messages. If we run <code class="literal">gradle –q –b build.gradle firstTask</code>, then it will print only <span class="strong"><strong class="calibre10">Hello world</strong></span>.</p></div><div class="book" title="Ordering subtasks using doFirst and doLast"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec01" class="calibre1"/>Ordering subtasks using doFirst and doLast</h4></div></div></div><p class="calibre9">A task can contain many subtasks. Subtasks can be<a id="id193" class="calibre1"/> defined and ordered using the <code class="literal">doFirst</code> and <code class="literal">doLast </code>keywords. The following code <a id="id194" class="calibre1"/>snippet describes the Java <a id="id195" class="calibre1"/>method style task definition and subtask ordering:</p><div class="informalexample"><pre class="programlisting">task aTask(){
  doLast{
   println 'Executing last.'
  }
  
  doFirst {
        println 'Running 1st'
  }
}</pre></div><p class="calibre9">Here, we defined a task named <code class="literal">aTask</code> using the Java method style. The task <code class="literal">aTask</code> contains two closure keywords: <code class="literal">doLast</code> and <code class="literal">doFirst</code>.</p><p class="calibre9">The <code class="literal">doFirst</code> closure is executed once<a id="id196" class="calibre1"/> the task is invoked, and the <code class="literal">doLast</code> closure<a id="id197" class="calibre1"/> is executed at the end.</p><p class="calibre9">When we run <code class="literal">gradle aTask</code>, it prints the following messages:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">:aTask</strong></span>
<span class="strong"><strong class="calibre10">Running 1st</strong></span>
<span class="strong"><strong class="calibre10">Executing last.</strong></span>

<span class="strong"><strong class="calibre10">BUILD SUCCESSFUL</strong></span>
</pre></div></div><div class="book" title="Default tasks"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec02" class="calibre1"/>Default tasks</h4></div></div></div><p class="calibre9">In Ant, we can define a default target; similarly, Gradle provides options for default tasks using the keyword <code class="literal">defaultTasks 'taskName1', …'taskNameN'</code>.</p><p class="calibre9">The <code class="literal">defaultTasks</code>  '<code class="literal">aTask</code>' keyword defines <code class="literal">aTask</code> as a default task. So now if we only execute <code class="literal">gradle</code> with no task name, then it<a id="id198" class="calibre1"/> will invoke the default task.</p></div><div class="book" title="The task dependency"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec03" class="calibre1"/>The task dependency</h4></div></div></div><p class="calibre9">In Ant, a target depends on another target, for example, a Java code compile task may depend on cleaning of the output folder; similarly, in Gradle, a task may depend on another task. The<a id="id199" class="calibre1"/> dependency is defined using the <code class="literal">dependsOn</code> keyword. The following syntax is used to define a task dependency:</p><div class="informalexample"><pre class="programlisting">secondTask.dependsOn 'firstTask'</pre></div><p class="calibre9">Here, <code class="literal">secondTask</code> depends on <code class="literal">firstTask</code>.</p><p class="calibre9">Another way of defining task dependency is passing the dependency in a method-like style. The following code snippet shows the method argument style:</p><div class="informalexample"><pre class="programlisting">task secondTask (<span class="strong"><strong class="calibre10">dependsOn</strong></span>: 'firstTask') {

  doLast {
        println 'Running last'
    }
  
   doFirst {
        println 'Running first'
    }

}</pre></div><p class="calibre9">Execute <code class="literal">gradle secondTask</code>; it will first execute the dependent task <code class="literal">firstTask</code> and then execute the task <code class="literal">secondTask</code> as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">:firstTask</strong></span>
<span class="strong"><strong class="calibre10">Hello world.</strong></span>
<span class="strong"><strong class="calibre10">:secondTask</strong></span>
<span class="strong"><strong class="calibre10">Running first</strong></span>
<span class="strong"><strong class="calibre10">Running last</strong></span>
</pre></div><p class="calibre9">Another way of defining<a id="id200" class="calibre1"/> intertask dependency is using <code class="literal">secondTask.dependsOn = ['firstTask']</code> or <code class="literal">secondTask.dependsOn 'firstTask'</code>.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="note09" class="calibre1"/>Note</h3><p class="calibre9">We can abbreviate each word of a task name in a camel case to execute a task. For example, the task name <code class="literal">secondTask</code> can be abbreviated to <code class="literal">sT</code>.</p></div></div><div class="book" title="Daemon"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec04" class="calibre1"/>Daemon</h4></div></div></div><p class="calibre9">Each time the <code class="literal">gradle</code> command is invoked, a new process is started, the Gradle classes and libraries are loaded, and the build is executed. Loading classes and libraries take time. Execution time can be reduced if a JVM, Gradle classes, and libraries, are not loaded each time. The <code class="literal">--daemon</code> command-line option starts a new Java process and preloads the Gradle classes and <a id="id201" class="calibre1"/>libraries; so, the first execution takes time. The next execution with the <code class="literal">--daemon</code> option takes almost no time because only the build gets executed—the JVM, with the required Gradle classes and libraries is already loaded. The <a id="id202" class="calibre1"/>configuration for daemon is often put into a <code class="literal">GRADLE_OPTS</code> environment variable; so, the flag is not needed on all calls. The following screenshot shows the execution of daemon:</p><div class="mediaobject"><img src="../images/00018.jpeg" alt="Daemon" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre9">Note that the first build took 31 seconds, whereas<a id="id203" class="calibre1"/> the second build tool took only 2 seconds.</p><p class="calibre9">To stop a daemon process, use <code class="literal">gradle –stop</code> the command-line option.</p></div></div><div class="book" title="Gradle plugins"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec23" class="calibre1"/>Gradle plugins</h3></div></div></div><p class="calibre9">Build scripts are monotonous, for example, in a Java build script, we define the source file location, third-party JAR location, clean output folder, compile Java files, run tests, create JAR file, and so on. Almost all Java project build scripts look similar.</p><p class="calibre9">This is something similar to duplicate codes. We resolve the duplicates by refactoring and moving duplicates to a common place and share the common code. Gradle plugins <a id="id204" class="calibre1"/>solve this repetitive build task problem by moving the duplicate tasks to a common place so that all projects share and inherit the common tasks instead of redefining them.</p><p class="calibre9">A plugin is a Gradle configuration extension. It comes with some preconfigured tasks that, together, do something useful. Gradle ships with a number of plugins and helps us write neat and clean scripts.</p><p class="calibre9">In this chapter, we will explore the Java and Eclipse plugins.</p><div class="book" title="The Eclipse plugin"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec05" class="calibre1"/>The Eclipse plugin</h4></div></div></div><p class="calibre9">The Eclipse plugin generates<a id="id205" class="calibre1"/> the project files necessary to import a project in Eclipse.</p><p class="calibre9">Any Eclipse project has two important files: a <code class="literal">.project</code> file and a <code class="literal">.classpath</code> file. The <code class="literal">.project</code> file contains<a id="id206" class="calibre1"/> the project information such as the project name and project nature. The <code class="literal">.classpath</code> file contains the classpath entries for the project.</p><p class="calibre9">Let's create a simple<a id="id207" class="calibre1"/> Gradle build with the Eclipse plugin using the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a folder named <code class="literal">eclipse</code>, then a file named <code class="literal">build.gradle</code>, and add the following script:<div class="informalexample"><pre class="programlisting">apply plugin: 'eclipse'</pre></div><p class="calibre15">To inherit a plugin nature, Gradle uses the <code class="literal">apply plugin: '&lt;plug-in name&gt;'</code> syntax.</p></li><li class="listitem" value="2">Open the command prompt and check all the available tasks using the <code class="literal">gradle tasks –-all</code> command. This will list the available Eclipse plugin tasks for you.</li><li class="listitem" value="3">Now run the <code class="literal">gradle eclipse</code> command. It will generate only the <code class="literal">.project</code> file, as the <a id="id208" class="calibre1"/>command doesn't know what type of project needs to be built. You will see the following output on the command prompt:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">:eclipseProject</strong></span>
<span class="strong"><strong class="calibre10">:eclipse</strong></span>
<span class="strong"><strong class="calibre10">BUILD SUCCESSFUL</strong></span>
</pre></div></li><li class="listitem" value="4">To create a Java project, add <code class="literal">apply plugin: 'java'</code> to the <code class="literal">build.gradle</code> file and rerun the command. This<a id="id209" class="calibre1"/> time it will execute four tasks as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">:eclipseClasspath</strong></span>
<span class="strong"><strong class="calibre10">:eclipseJdt</strong></span>
<span class="strong"><strong class="calibre10">:eclipseProject</strong></span>
<span class="strong"><strong class="calibre10">:eclipse</strong></span>
</pre></div></li><li class="listitem" value="5">Open the <code class="literal">Eclipse</code> folder (the location where you put the <code class="literal">build.gradle</code> file). You will <a id="id210" class="calibre1"/>find the <code class="literal">.project</code> and <code class="literal">.classpath</code> files and a .<code class="literal">settings</code> folder. For a Java project, a <span class="strong"><strong class="calibre10">Java Development Tools</strong></span> (<span class="strong"><strong class="calibre10">JDT</strong></span>) configuration file<a id="id211" class="calibre1"/> is required. The <code class="literal">.settings</code> folder contains the <code class="literal">org.eclipse.jdt.core.prefs</code> file.</li></ol><div class="calibre17"/></div><p class="calibre9">Now, we can launch Eclipse and import the project. We can edit the <code class="literal">.project</code> file and change the project name.</p><p class="calibre9">Normally, a Java project depends on third-party JARs, such as the JUnit JAR and Apache utility JARs. In the next section, we will learn how a classpath can be generated with JAR dependencies.</p></div><div class="book" title="The Java plugin"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec06" class="calibre1"/>The Java plugin</h4></div></div></div><p class="calibre9">The Java plugin provides some default tasks for your project that will compile and unit test your Java source code and bundle it into a JAR file.</p><p class="calibre9">The Java plugin defines the default <a id="id212" class="calibre1"/>values for many aspects of the<a id="id213" class="calibre1"/> project, such as the source files' location and Maven repository. We can follow the conventions or customize them if necessary; generally, if we follow the conventional defaults, then we don't need to do much in our build script.</p><p class="calibre9">Let's create a simple Gradle <a id="id214" class="calibre1"/>build script with the Java plugin and observe what the plugin offers. Perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a <code class="literal">java.gradle</code> build file and add the  <code class="literal">apply plugin: 'java'</code> line.</li><li class="listitem" value="2">Open the command prompt and type in <code class="literal">gradle -b java.gradle tasks –-all</code>. This will list the Java plugin tasks for you.</li><li class="listitem" value="3">To build a project, we can use the build task; the build depends on many tasks. Execute the <code class="literal">gradle -b java.gradle build</code> command. The following screenshot shows the output:<div class="mediaobject"><img src="../images/00019.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">Since no source code was<a id="id215" class="calibre1"/> available, the build script didn't build anything. However, we can see the list of available tasks—build tasks are dependent on compile, JAR creation, test execution, and so on.</p><p class="calibre9">Java plugins come with a <a id="id216" class="calibre1"/>convention that<a id="id217" class="calibre1"/> the build source files will be under <code class="literal">src/main/java</code>, relative to the project directory. Non-Java resource files such as the XML and properties files will be under <code class="literal">src/main/resources</code>. Tests will be under <code class="literal">src/test/java</code>, and the test resources under the <code class="literal">src/test/resources</code>.</p><p class="calibre9">To change the default Gradle project source file directory settings, use the <code class="literal">sourceSets</code> keyword. The <code class="literal">sourceSets</code> keyword allows us to change the default source file's location.</p><p class="calibre9">A Gradle script must know the location of the <code class="literal">lib</code> directory to compile files. The Gradle convention for library locations is repositories. Gradle supports the local <code class="literal">lib</code> folder, external dependencies, and remote repositories.</p><p class="calibre9">Gradle also supports the following repositories:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre10">Maven repository</strong></span>: Maven can be <a id="id218" class="calibre1"/>configured on our<a id="id219" class="calibre1"/> local machine, on a network machine, or even the preconfigured central repository.<div class="book"><ul class="itemizedlist1"><li class="listitem"><span class="strong"><strong class="calibre10">Maven central repository</strong></span>: Maven's central repository is located at <a class="calibre1" href="http://repo1.maven.org/maven2">http://repo1.maven.org/maven2</a>. The <code class="literal">mavenCentral()</code> groovy method can be used to load dependencies from the centralized Maven <a id="id220" class="calibre1"/>repository. The following is an example of <a id="id221" class="calibre1"/>accessing the central repository:<div class="informalexample"><pre class="programlisting">repositories {
    mavenCentral()
}</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre10">Maven local repository</strong></span>: If we have a local Maven repository, we can use the <code class="literal">mavenLocal()</code>method to<a id="id222" class="calibre1"/> resolve<a id="id223" class="calibre1"/> dependencies as follows:<div class="informalexample"><pre class="programlisting">repositories {
    mavenLocal()
}</pre></div><div class="note" title="Note"><h3 class="title2"><a id="tip06" class="calibre1"/>Tip</h3><p class="calibre9">The <code class="literal">maven()</code> method<a id="id224" class="calibre1"/> can be used to access repositories configured on the intranet. The following is an <a id="id225" class="calibre1"/>example of accessing an intranet URL:</p><div class="informalexample"><pre class="programlisting">repositories {
    maven {
        name = 'Our Maven repository name'
        url = '&lt;intranet URL&gt;'
    }
}</pre></div><p class="calibre9">The <code class="literal">mavenRepo()</code> method can be used with the following code:</p><div class="informalexample"><pre class="programlisting">repositories {
    mavenRepo(name: '&lt;name of the repository&gt;', url: '&lt;URL&gt;')
}</pre></div><p class="calibre9">A secured Maven <a id="id226" class="calibre1"/>repository needs user credentials. Gradle provides the <code class="literal">credentials</code> keyword to pass user credentials. The following<a id="id227" class="calibre1"/> is an example of accessing a secured Maven repository:</p><div class="informalexample"><pre class="programlisting">repositories {
    maven(name: repository name') {
        credentials {
            username = 'username'
            password = 'password'
        }
        url = '&lt;URL&gt;'
    }
}</pre></div></div></li></ul></div></li><li class="listitem"><span class="strong"><strong class="calibre10">Ivy repository</strong></span>: This is a remote or local ivy repository. Gradle supports the same Maven methods<a id="id228" class="calibre1"/> for ivy. The following<a id="id229" class="calibre1"/> is an example of accessing an ivy<a id="id230" class="calibre1"/> repository and a secured ivy repository:<div class="informalexample"><pre class="programlisting">repositories {
    ivy(url: '&lt;URL&gt;', name: '&lt;Name&gt;')
    ivy {     
    credentials
     { 
        username = 'user name'
            password = 'password'
      }
        url = '&lt;URL&gt;'
    }
}</pre></div></li><li class="listitem"><span class="strong"><strong class="calibre10">Flat directory repository</strong></span>: This is a local or network<a id="id231" class="calibre1"/> directory. The following is an<a id="id232" class="calibre1"/> example of accessing<a id="id233" class="calibre1"/> a local directory:<div class="informalexample"><pre class="programlisting">repositories {
    flatDir(dir: '../thirdPartyFolder', name: '3rd party library')
    flatDir {
        dirs '../springLib', '../lib/apacheLib', '../lib/junit' 
        name = ' Configured libraries for spring, apache and JUnit'
    }
}</pre></div><p class="calibre15">Gradle uses <code class="literal">flatDir()</code> to locate a local or network-shared library folder. Here, <code class="literal">dir</code> is used to locate a single directory and <code class="literal">dirs</code> with directory locations separated by<a id="id234" class="calibre1"/> commas are used to locate distributed folders.</p></li></ul></div><p class="calibre9">In this section, we will create a Java project, write a test, execute the test, compile source or test files, and finally build<a id="id235" class="calibre1"/> a JAR file. Perform the <a id="id236" class="calibre1"/>following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a <code class="literal">build.gradle</code> build script file under <code class="literal">packt\chapter02\java</code>.</li><li class="listitem" value="2">Add Eclipse and Java plugin support using the following lines of code:<div class="informalexample"><pre class="programlisting">apply plugin: 'eclipse'
apply plugin: 'java'</pre></div></li><li class="listitem" value="3">We will write a JUnit test, so our project will be dependent on JUnit JARs. Create a <code class="literal">lib</code> directory under <code class="literal">packt\chapter02</code> and copy the  <code class="literal">hamcrest-core-1.3.jar</code> and <code class="literal">junit-4.11.jar</code> JARs (we downloaded these JARs in <a class="calibre1" title="Chapter 1. JUnit 4 – a Total Recall" href="part0014_split_000.html#page">Chapter 1</a>, <span class="strong"><em class="calibre11">JUnit 4 – a Total Recall</em></span>).</li><li class="listitem" value="4">In this example, we will<a id="id237" class="calibre1"/> use the flat directory repository. We created a <code class="literal">lib</code> directory for JUnit JARs. Add the following lines to the <code class="literal">build.gradle</code> file to configure our repository:<div class="informalexample"><pre class="programlisting">repositories {
    flatDir(dir: '../lib', name: 'JUnit Library')
}</pre></div><p class="calibre15">We have a single <code class="literal">lib</code> folder; so, we will use <code class="literal">flatDir</code> and <code class="literal">dir</code> conventions.</p><p class="calibre15">A repository can have numerous library files, but we may need only some of them. For example, source file compilation doesn't require the JUnit JARs but test files and test execution need them.</p><p class="calibre15">Gradle comes with dependency management. The dependencies keyword is used to define dependencies.</p><p class="calibre15">The closure dependencies support the following default types:</p><div class="book"><ul class="itemizedlist1"><li class="listitem"><span class="strong"><strong class="calibre10">Compile</strong></span>: These are the dependencies<a id="id238" class="calibre1"/> required to compile the source of the project.</li><li class="listitem"><span class="strong"><strong class="calibre10">Runtime</strong></span>: These dependencies<a id="id239" class="calibre1"/> are required by the production classes at runtime. By default, these also include the compile time dependencies.</li><li class="listitem"><span class="strong"><strong class="calibre10">testCompile</strong></span>: These dependencies <a id="id240" class="calibre1"/>are required to compile the test source of the project. By default, they also include the compiled production classes and the compile-time dependencies.</li><li class="listitem"><span class="strong"><strong class="calibre10">testRuntime</strong></span>: These dependencies <a id="id241" class="calibre1"/>are required to run the tests. By default, they also include the compile, runtime, and testCompile dependencies.</li></ul></div><p class="calibre15">Each dependency type needs a coordinate: a group, name, and version of a dependent JAR.</p><p class="calibre15">Some websites, such as <a class="calibre1" href="http://mvnrepository.com">mvnrepository.com</a>, can help us to come up with a ready-to-copy-paste <a id="id242" class="calibre1"/>dependency string, such as <a class="calibre1" href="http://mvnrepository.com/artifact/org.springframework/spring-aop/3.1.1.RELEASE">http://mvnrepository.com/artifact/org.springframework/spring-aop/3.1.1.RELEASE</a>.</p><div class="note" title="Note"><h3 class="title2"><a id="note10" class="calibre1"/>Note</h3><p class="calibre9">Suppose we<a id="id243" class="calibre1"/> need to include the <code class="literal">org.springframework.aop-3.1.1.RELEASE.jar</code> file in our classpath (here <code class="literal">org.springframework</code> is the group, <code class="literal">aop</code> is the name, and <code class="literal">3.1.1.RELEASE</code> is the version). We can simply write <code class="literal">org.springframework:aop:3.1.1.RELEASE</code> to identify <code class="literal">aop.jar</code>.</p></div></li><li class="listitem" value="5">Tests need JUnit JAR <a id="id244" class="calibre1"/>support. Add the following lines to our <code class="literal">build.gradle</code> file to add the JUnit dependency:<div class="informalexample"><pre class="programlisting">dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.11'
    testCompile group: '', name: 'hamcrest-core', version: '1.3'
}</pre></div><p class="calibre15">Or simply add the following lines to the file:</p><div class="informalexample"><pre class="programlisting">dependencies {
    testCompile 'junit:junit:4.11', ':hamcrest-core:1.3'
}</pre></div></li><li class="listitem" value="6">Generate an Eclipse project using the Eclipse plugin and issue the <code class="literal">gradle eclipse</code> command. The<a id="id245" class="calibre1"/> <code class="literal">eclipse</code> command will execute three tasks: <code class="literal">eclipseClasspath</code>, <code class="literal">eclipseJdt</code>, and <code class="literal">eclipseProject</code>.<p class="calibre15">Go to the <code class="literal">\chapter02\java </code>folder, and you will find a <code class="literal">.classpath</code> and a <code class="literal">.project</code> file. Open the <code class="literal">.classpath</code> file and check whether <code class="literal">junit-4.11</code> and <code class="literal">hamcrest-core-1.3.jar</code> have been added as <code class="literal">classpathentry</code>.</p><p class="calibre15">The following screenshot shows the <code class="literal">gradle eclipse</code> command output:</p><div class="mediaobject"><img src="../images/00020.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p><p class="calibre15">The following <a id="id246" class="calibre1"/>screenshot shows<a id="id247" class="calibre1"/> the content of the generated <code class="literal">.classpath</code> file:</p><div class="mediaobject"><img src="../images/00021.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="7">Launch Eclipse and import the project by navigating to <span class="strong"><strong class="calibre10">File</strong></span> | <span class="strong"><strong class="calibre10">Import</strong></span> | <span class="strong"><strong class="calibre10">Existing Projects into Workspace</strong></span>. Now browse to the <code class="literal">D:\Packt\chapter02\java</code> folder and import the project. Eclipse will open the <code class="literal">java</code> project—the Java community's best practice is to keep the test and source code files<a id="id248" class="calibre1"/> under the same package but in a different source folder. Java code files are stored under <code class="literal">src/main/java</code>, and test files are stored under <code class="literal">src/test/java</code>. Source resources are stored under <code class="literal">src/main/resources</code>.<p class="calibre15">We need to create the <code class="literal">src/main/java</code>, <code class="literal">src/main/resources</code>, and <code class="literal">src/test/java</code> folders directly under the Java project.</p><p class="calibre15">The following<a id="id249" class="calibre1"/> screenshot <a id="id250" class="calibre1"/>displays the folder structure:</p><div class="mediaobject"><img src="../images/00022.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="8">Right-click on the leaf <a id="id251" class="calibre1"/>folders (the <code class="literal">java</code> and <code class="literal">resources</code> folders under <code class="literal">src/main</code> and <code class="literal">src/test</code>, respectively); a pop-up menu will open. Now, go to <span class="strong"><strong class="calibre10">Build Path</strong></span> | <span class="strong"><strong class="calibre10">Use as Source Folder</strong></span>.<p class="calibre15">The following screenshot shows the action:</p><div class="mediaobject"><img src="../images/00023.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="9">We will create a Java class and unit test the behavior; the Java class will read from a properties file and return an <code class="literal">enum</code> type depending on the value provided in the properties file. Reading a file from the test is not recommended as I/O operations are unpredictable and slow; your test may fail to read the file and<a id="id252" class="calibre1"/> take time to slow down the test execution. We can use mock objects to stub the file read, but for simplicity, we will add two methods in the service class—one will take a <code class="literal">String</code> argument and return an <code class="literal">enum</code> type, and the other<a id="id253" class="calibre1"/> one will read from a properties file and call the first method with the value. From the test, we will call the first method with a string. The following are the <a id="id254" class="calibre1"/>steps to configure the project:<div class="book"><ol class="orderedlist1"><li class="listitem" value="1">Add an <code class="literal">environment.properties</code> properties file under <code class="literal">/java/src/main/resources</code> and add <code class="literal">env = DEV</code> in that file.</li><li class="listitem" value="2">Create an <code class="literal">enum</code> file in the <code class="literal">com.packt.gradle</code> package under the <code class="literal">/java/src/main/java</code> source package:<div class="informalexample"><pre class="programlisting">public enum EnvironmentType {
  DEV, PROD, TEST
}</pre></div></li><li class="listitem" value="3">Create a Java class to read the properties file as follows:<div class="informalexample"><pre class="programlisting">package com.packt.gradle;

import java.util.ResourceBundle;

public class Environment {
  public String getName() {
    ResourceBundle resourceBundle = ResourceBundle.getBundle("environment");
    return resourceBundle.getString("env");
  }
}</pre></div></li><li class="listitem" value="4">Create a <code class="literal">EnvironmentService</code> class to return an <code class="literal">enum</code> type depending on the environment setup as follows:<div class="informalexample"><pre class="programlisting">package com.packt.gradle;
public class EnvironmentService {

  public EnvironmentType getEnvironmentType() {
    return getEnvironmentType(new Environment().getName());
  }
  public EnvironmentType getEnvironmentType(String name) {
    if("dev".equals(name)) {
      return EnvironmentType.DEV;
    }else if("prod".equals(name)) {
      return EnvironmentType.PROD;
    }
    return null;
  }
}</pre></div><p class="calibre9">The <code class="literal">getEnvironmentType()</code> method <a id="id255" class="calibre1"/>calls the <code class="literal">Environment</code> class to read the properties file value and then calls the <code class="literal">getEnvironmentType(String name)</code> method with the read value to return an <code class="literal">enum</code> type.</p></li><li class="listitem" value="5">Add a test class<a id="id256" class="calibre1"/> under <code class="literal">/src/test/java</code> in the <code class="literal">com.packt.gradle </code>package. The following is the code:<div class="informalexample"><pre class="programlisting">package com.packt.gradle;
import static org.junit.Assert.*;
import static org.hamcrest.CoreMatchers.*;
import org.junit.Test;

public class EnvironmentServiceTest {
EnvironmentService service = new EnvironmentService();
@Test
public void returns_NULL_when_environment_not_configured(){
    assertNull(service.getEnvironmentType("xyz"));	}

@Test
public void production_environment_configured(){
    EnvironmentType environmentType = service.getEnvironmentType("prod");
    assertThat(environmentType, is(EnvironmentType.PROD));
  }
}</pre></div><p class="calibre9">Here, the <code class="literal">returns_NULL_when_environment_not_configured()</code> test passes <code class="literal">xyz</code> to the <code class="literal">getEnvironmentType</code> method and expects that the service will return <code class="literal">null</code>, assuming that there won't be any <code class="literal">xyz</code> environment. In another<a id="id257" class="calibre1"/> test, it passes the <code class="literal">prod</code> value to the <code class="literal">getEnvironmentType</code> method and expects that a type will be returned.</p></li></ol><div class="calibre17"/></div></li><li class="listitem" value="10">Now open the command prompt and run <code class="literal">gradle build</code>; it will compile the source and test files, execute<a id="id258" class="calibre1"/> the test, and finally create a JAR file.<p class="calibre15">To execute only the tests, run <code class="literal">gradle test</code>.</p><p class="calibre15">Open the <code class="literal">\chapter02\java\build</code> folder, and you will find three important folders:</p><div class="book"><ul class="itemizedlist1"><li class="listitem"><code class="literal">libs</code>: This folder contains the build output JARs—<code class="literal">Java.jar</code></li><li class="listitem"><code class="literal">reports</code>: This folder contains the HTML test results</li><li class="listitem"><code class="literal">test-results</code>: This folder contains the XML format test execution result and the time taken to execute each test</li></ul></div><p class="calibre15">The following <a id="id259" class="calibre1"/>screenshot shows the test execution result in the HTML format:</p><div class="mediaobject"><img src="../images/00024.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">Gradle is an intelligent build tool, and it supports incremental build. Rerun the <code class="literal">gradle build</code> command. It will just skip the tasks and say <code class="literal">UP-TO-DATE</code>. The following is a screenshot of the incremental build:</p><div class="mediaobject"><img src="../images/00025.jpeg" alt="The Java plugin" class="calibre12"/></div><p class="calibre13"> </p><p class="calibre9">If we make a change to the test class, only test tasks will be executed. The following are the test tasks: <code class="literal">compileTestJava</code>, <code class="literal">testClasses</code>, <code class="literal">test</code>, <code class="literal">check</code>, and <code class="literal">build</code>.</p><p class="calibre9">In next chapters, we will explore more on Gradle. Do you want to dive deep now? If so, you can visit <a class="calibre1" href="http://www.gradle.org/docs/current/userguide/userguide.html">http://www.gradle.org/docs/current/userguide/userguide.html</a>.</p></div></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests">
<div class="book" title="Continuous Integration">
<div class="book" title="Maven project management"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_4"><a id="ch02lvl2sec23" class="calibre1"/>Maven project management</h2></div></div></div><p class="calibre9">Maven is a project<a id="id260" class="calibre1"/> build tool. Using Maven, we can build a visible, reusable, and maintainable project infrastructure.</p><p class="calibre9">Maven provides plugins for <a id="id261" class="calibre1"/>visibility: the code quality/best practices is visible through the PMD/checkstyle plugin, the XDOC plugin generates project content information, the JUnit report plugin makes the failure/success story visible to the team, the project activity tracking plugins make the daily activity visible, the change log plugin generates the list of changes, and so on.</p><p class="calibre9">As a result, a developer knows what APIs or modules are available for use; so, he or she doesn't invent the wheel (rather, he or she reuses the existing APIs or modules). This reduces the duplication and allows a maintainable system to be created. </p><p class="calibre9">In this section, we will explore the Maven architecture and rebuild our Gradle project using Maven.</p><div class="book" title="Installation"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec24" class="calibre1"/>Installation</h3></div></div></div><p class="calibre9">A prerequisite for Maven is the <a id="id262" class="calibre1"/>
<span class="strong"><strong class="calibre10">Java Development Kit</strong></span> (<span class="strong"><strong class="calibre10">JDK</strong></span>). Make sure you have JDK installed on your computer.</p><p class="calibre9">The following <a id="id263" class="calibre1"/>are the <a id="id264" class="calibre1"/>steps to set up Maven:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Download the Maven media. Go to <a class="calibre1" href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a> to get the latest version of Maven.</li><li class="listitem" value="2">After downloading Maven, extract the archive to a folder; for example, I extracted it to <code class="literal">D:\Software\apache-maven-3.1.1</code>.</li><li class="listitem" value="3">For Windows OS, create an environment variable named <code class="literal">M2_HOME</code> and point it to the Maven installation folder. Modify the <code class="literal">PATH</code> variable and append <code class="literal">%M2_HOME%\bin</code>.</li><li class="listitem" value="4">For Linux, we need to export the <code class="literal">PATH</code> and <code class="literal">M2_HOME</code> environment variables to the <code class="literal">.bashrc</code> file. Open the <code class="literal">.bashrc</code> file and edit it with the following text:<div class="informalexample"><pre class="programlisting">export M2_HOME=/home/&lt;location of Maven installation&gt;
export PATH=${PATH}:${M2_HOME}/bin</pre></div></li><li class="listitem" value="5">For Mac, the <code class="literal">.bash_login</code> file needs to be modified with following text:<div class="informalexample"><pre class="programlisting">export M2_HOME=/usr/local/&lt;maven folder&gt;
export PATH=${PATH}:${M2_HOME}/bin</pre></div></li><li class="listitem" value="6">Check the installation and execute the  <code class="literal">mvn –version</code> command. This should print the Maven version. The following is a screenshot of the output:<div class="mediaobject"><img src="../images/00026.jpeg" alt="Installation" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">Maven is installed so we can start exploring Maven. Eclipse users with the <code class="literal">m2eclipse</code> plugin installed already have Maven, which they can directly use from Eclipse and they don't have to install Maven.</p></div><div class="book" title="The Archetype plugin"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec25" class="calibre1"/>The Archetype plugin</h3></div></div></div><p class="calibre9">In Maven, Archetype<a id="id265" class="calibre1"/> is a project-template generation plugin.</p><p class="calibre9">Maven allows us to create a project infrastructure from scratch from a list of predefined project types. The Maven command <code class="literal">mvn archetype:generate</code> generates a new project skeleton.</p><p class="calibre9">The <code class="literal">archetype:generate</code> command loads a catalog of available project types. It tries to connect to the central <a id="id266" class="calibre1"/>Maven repository at <a class="calibre1" href="http://repo1.maven.org/maven2">http://repo1.maven.org/maven2</a>, and downloads the archetype catalog.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip09" class="calibre1"/>Tip</h3><p class="calibre9">To get the latest catalog, you should be connected to the Internet.</p></div><p class="calibre9">Follow the ensuing steps to generate a Java<a id="id267" class="calibre1"/> project skeleton:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create a folder hierarchy <code class="literal">/Packt/chapter02/maven</code>, open the command prompt, and browse to the <code class="literal">/Packt/chapter02/maven</code> folder.</li><li class="listitem" value="2">Issue a <code class="literal">mvn archetype:generate</code> command; you will see a large list of archetypes being downloaded, each with a number, a name, and a short description.<p class="calibre15">It will prompt you to enter an archetype number. Type in the default <code class="literal">maven-archetype-quickstart</code> archetype. In my case, the number is 343.</p><p class="calibre15">The following screenshot shows you that the number <code class="literal">343</code> is default:</p><div class="mediaobject"><img src="../images/00027.jpeg" alt="The Archetype plugin" class="calibre12"/></div><p class="calibre16"> </p><div class="note" title="Note"><h3 class="title2"><a id="tip10" class="calibre1"/>Tip</h3><p class="calibre9">To get the entire catalog on Windows OS, enter the <code class="literal">mvn archetype:generate  &gt; archetype.txt</code> command. This will populate the text file with the project type list.</p></div></li><li class="listitem" value="3">Enter <code class="literal">343</code> or just hit <span class="strong"><em class="calibre11">Enter</em></span> to select the default. Next, it will prompt you to select a version. Hit <span class="strong"><em class="calibre11">Enter</em></span> to select the default.</li><li class="listitem" value="4">Now it will ask you to provide a <code class="literal">groupId</code>. A <code class="literal">groupId</code> is the root package for multiple projects, and <code class="literal">org.springframework</code> is the <code class="literal">groupId</code> for all Spring projects. Enter <code class="literal">org.packt</code> as <code class="literal">groupId</code>.</li><li class="listitem" value="5">Next, it will ask for <code class="literal">artifactId</code>. This is the project name and <code class="literal">aop</code> is the <code class="literal">artifactId</code> for <code class="literal">org.springframework.aop-3.1.1.RELEASE</code>. Enter <code class="literal">Demo</code> for the <code class="literal">artifactId</code>.</li><li class="listitem" value="6">Maven will ask for the version and the default is <code class="literal">1.0-SNAPSHOT</code>. The version is your project's version, and here <code class="literal">3.1.1.RELEASE</code> is the version for the <code class="literal">org.springframework.aop-3.1.1.RELEASE</code> project. We will accept the default. Hit <span class="strong"><em class="calibre11">Enter</em></span> to accept the default.</li><li class="listitem" value="7">Now you will be <a id="id268" class="calibre1"/>prompted to enter the package name. Enter <code class="literal">com.packt.edu</code> as package's name.</li><li class="listitem" value="8">Finally, it will show <a id="id269" class="calibre1"/>you what you entered. Review it and accept it as shown in the following screenshot:<div class="mediaobject"><img src="../images/00028.jpeg" alt="The Archetype plugin" class="calibre12"/></div><p class="calibre16"> </p><p class="calibre15">Open the <code class="literal">/Packt/chapter02/maven</code> folder; you will see the <code class="literal">Demo</code> project folder is created with the following file structure:</p><div class="mediaobject"><img src="../images/00029.jpeg" alt="The Archetype plugin" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">The Maven convention for the source Java file is <code class="literal">src/main/java</code> and the test source file is <code class="literal">src/test/java</code>.</p><p class="calibre9">Maven will automatically create a Java file <code class="literal">App.java</code> under <code class="literal">src/main/java/com/packt/edu</code> and a test file <code class="literal">AppTest</code> under <code class="literal">src/test/java/com/packt/edu</code>.</p><p class="calibre9">Also, it will create an XML file <code class="literal">pom.xml</code> directly under <code class="literal">Demo</code>. This file will be used for building the project. In the next<a id="id270" class="calibre1"/> section, we will read about the POM file.</p></div><div class="book" title="The Project Object Model (POM) file"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec26" class="calibre1"/>The Project Object Model (POM) file</h3></div></div></div><p class="calibre9">Every Maven project contains a <code class="literal">pom.xml</code> file, which is a project metadata file.</p><p class="calibre9">A POM file can contain the following sections:</p><div class="book"><ul class="itemizedlist"><li class="listitem">Project <a id="id271" class="calibre1"/>coordinates such as <code class="literal">&lt;groupId/&gt;</code>, <code class="literal">&lt;artifactId/&gt;</code>, <code class="literal">&lt;version/&gt;</code>, <code class="literal">&lt;dependency&gt;</code>, and inheritance through <code class="literal">&lt;modules/&gt;</code> and <code class="literal">&lt;parent/&gt;</code><p class="calibre15">Open the <code class="literal">pom.xml</code> file in the <code class="literal">Demo</code> folder; it contains the following coordinate details:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">  &lt;groupId&gt;</strong></span>org.packt&lt;/groupId&gt;
<span class="strong"><strong class="calibre10">  &lt;artifactId&gt;</strong></span>Demo&lt;/artifactId&gt;
<span class="strong"><strong class="calibre10">  &lt;version&gt;</strong></span>1.0-SNAPSHOT&lt;/version&gt;
<span class="strong"><strong class="calibre10">  &lt;packaging&gt;</strong></span>jar&lt;/packaging&gt;</pre></div></li><li class="listitem">The build details in <code class="literal">&lt;build&gt;</code> and <code class="literal">&lt;reporting&gt;</code></li><li class="listitem">Project visibility details such as <code class="literal">&lt;name&gt;</code>, <code class="literal">&lt;organization&gt;</code>, <code class="literal">&lt;developers&gt;</code>, <code class="literal">&lt;url&gt;</code>, and <code class="literal">&lt;contributors&gt;</code><p class="calibre15">Our generated <code class="literal">pom.xml</code> contains the following details:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">  &lt;name&gt;</strong></span>Demo&lt;/name&gt;
<span class="strong"><strong class="calibre10">  </strong></span>
<span class="strong"><strong class="calibre10">&lt;url&gt;</strong></span>http://maven.apache.org&lt;/url&gt;</pre></div></li><li class="listitem">Project environment details such as <code class="literal">&lt;scm&gt;</code>, <code class="literal">&lt;repository&gt;</code>, and <code class="literal">&lt;mailingList&gt;</code></li></ul></div></div><div class="book" title="Project dependency"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec27" class="calibre1"/>Project dependency</h3></div></div></div><p class="calibre9">In a multimodule project, a project can depend on many other projects. For example, say we depend on JUnit. Maven automatically discovers the required artifact dependencies. This is very useful as we depend on many open source projects. It's always useful, be it an open source or a close source project.</p><p class="calibre9">Do you remember the Gradle dependency closure? It has four default types for Compile, Runtime, testCompile, and testRuntime.</p><p class="calibre9">Similarly, Maven has the following dependency scopes:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre10">Compile</strong></span>: Code compile time classpath dependency; this is the default scope. If not, it is explicitly defined and<a id="id272" class="calibre1"/> then the compile time scope is set.</li><li class="listitem"><span class="strong"><strong class="calibre10">Runtime</strong></span>: This is required<a id="id273" class="calibre1"/> at runtime.</li><li class="listitem"><span class="strong"><strong class="calibre10">Test</strong></span>: This dependency is required for test code <a id="id274" class="calibre1"/>compilation and test execution. </li><li class="listitem"><span class="strong"><strong class="calibre10">Provided</strong></span>: The JDK or environment <a id="id275" class="calibre1"/>dependency at runtime.</li></ul></div><p class="calibre9">A parent project defines dependencies using the following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;<span class="strong"><strong class="calibre10">junit</strong></span>&lt;/groupId&gt;
      &lt;artifactId&gt;<span class="strong"><strong class="calibre10">junit</strong></span>&lt;/artifactId&gt;
      &lt;version&gt;<span class="strong"><strong class="calibre10">4.11</strong></span>&lt;/version&gt;
      &lt;scope&gt;<span class="strong"><strong class="calibre10">test</strong></span>&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies</pre></div><p class="calibre9">All child projects inherit the dependency by just adding the <code class="literal">&lt;dependency&gt;</code> tag as follows:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;<span class="strong"><strong class="calibre10">junit</strong></span>&lt;/groupId&gt;
  &lt;artifactId&gt;<span class="strong"><strong class="calibre10">junit</strong></span>&lt;/artifactId&gt;
&lt;/dependency&gt;</pre></div></div><div class="book" title="The build life cycle"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec28" class="calibre1"/>The build life cycle</h3></div></div></div><p class="calibre9">The build life cycle clearly defines the process of building and distributing a particular project artifact.</p><p class="calibre9">Maven has the following three<a id="id276" class="calibre1"/> built-in build life cycles:</p><div class="book"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong class="calibre10">Default</strong></span>: This life cycle<a id="id277" class="calibre1"/> handles the compile, test, packaging, deployment, and many more functions</li><li class="listitem"><span class="strong"><strong class="calibre10">Clean</strong></span>: This life cycle generally cleans<a id="id278" class="calibre1"/> the build artifacts generated by the previous build(s)</li><li class="listitem"><span class="strong"><strong class="calibre10">Site</strong></span>: This life cycle takes care of <a id="id279" class="calibre1"/>generation and deployment of the project's site documentation</li></ul></div><p class="calibre9">Now, we will compile and test our <code class="literal">Demo</code> project.</p><p class="calibre9">In this section, we will work with compile, test, and package targets of the default life cycle.</p><div class="book" title="Compiling the project"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec07" class="calibre1"/>Compiling the project</h4></div></div></div><p class="calibre9">Perform the following steps to <a id="id280" class="calibre1"/>compile the project:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the command prompt and browse to <code class="literal">\Packt\chapter02\maven\Demo</code>. Maven needs a <code class="literal">pom.xml</code> file to compile a project.</li><li class="listitem" value="2">Type in <code class="literal">mvn compile</code>; it will compile the project and create class files under <code class="literal">\Demo\target\classes</code>. The following screenshot shows the output:<div class="mediaobject"><img src="../images/00030.jpeg" alt="Compiling the project" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div></div><div class="book" title="Testing the project"><div class="book"><div class="book"><div class="book"><h4 class="title3"><a id="ch02lvl4sec08" class="calibre1"/>Testing the project</h4></div></div></div><p class="calibre9">To execute the tests in Demo, open the command prompt and type in <code class="literal">mvn test</code>; it will download JUnit JARs and <a id="id281" class="calibre1"/>surefire JARs for test compilation and test report generation respectively and then execute the test. The following screenshot shows the output:</p><div class="mediaobject"><img src="../images/00031.jpeg" alt="Testing the project" class="calibre12"/></div><p class="calibre13"> </p><div class="book" title="Packaging the project"><div class="book"><div class="book"><div class="book"><h5 class="title4"><a id="ch02lvl5sec01" class="calibre19"/>Packaging the project</h5></div></div></div><p class="calibre9">The <code class="literal">mvn package</code> command compiles source code, compiles tests, executes tests, and finally builds a JAR. It will generate <code class="literal">Demo-1.0-SNAPSHOT.jar</code> in <code class="literal">\Packt\chapter02\maven\Demo\target</code>.</p></div></div></div><div class="book" title="The clean life cycle"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec29" class="calibre1"/>The clean life cycle</h3></div></div></div><p class="calibre9">The <code class="literal">mvn clean</code> command <a id="id282" class="calibre1"/>removes the <code class="literal">target</code> folder and deletes all the content. Run the command<a id="id283" class="calibre1"/> and check that the <code class="literal">target</code> folder has been deleted from <code class="literal">\Packt\chapter02\maven\Demo\</code>.</p></div><div class="book" title="The site life cycle"><div class="book"><div class="book"><div class="book"><h3 class="title2"><a id="ch02lvl3sec30" class="calibre1"/>The site life cycle</h3></div></div></div><p class="calibre9">The <code class="literal">mvn site</code> command generates a<a id="id284" class="calibre1"/> detailed project report in the HTML format under the target or site. It includes About, Plugin Management, Distribution <a id="id285" class="calibre1"/>Management, Dependency Information, Source Repository, Mailing Lists, Issue Tracking, Continuous Integration, Project Plugins, Project License, Project Team, Project Summary, and Dependencies.</p><p class="calibre9">Refer to <a class="calibre1" href="http://maven.apache.org/guides/index.html">http://maven.apache.org/guides/index.html</a> to explore more on Maven.</p><p class="calibre9">The next section covers the Apache Ant.</p></div></div></div></div>

<div class="book" title="Chapter&#xA0;2.&#xA0;Automating JUnit Tests">
<div class="book" title="Continuous Integration">
<div class="book" title="Another neat tool (Ant)"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_5"><a id="ch02lvl2sec24" class="calibre1"/>Another neat tool (Ant)</h2></div></div></div><p class="calibre9">Ant is a Java-based build tool from the Apache Software Foundation. Ant's build files <a id="id286" class="calibre1"/>are written in XML. You need Java to execute an Ant task.</p><p class="calibre9">Download Apache Ant from <a class="calibre1" href="http://ant.apache.org/">http://ant.apache.org/</a>, extract the media, and <a id="id287" class="calibre1"/>create an <code class="literal">ANT_HOME</code> variable and set the value to the extracted location. Edit <code class="literal">PATH</code> and append <code class="literal">%ANT_HOME%\bin</code> in Windows. For Mac or Linux OS, you need to export <code class="literal">ANT_HOME</code> and <code class="literal">PATH</code> as described in the <span class="strong"><em class="calibre11">Installation</em></span> section of <span class="strong"><em class="calibre11">Maven project management</em></span> earlier in this chapter.</p><p class="calibre9">Ant needs a <code class="literal">build.xml</code> file to execute<a id="id288" class="calibre1"/> tasks. Ant supports the <code class="literal">–f</code> option to specify a build script; so the <code class="literal">ant –f myBuildFile.xml</code> command will work.</p><p class="calibre9">We will create a build script and execute the Maven project (<code class="literal">\Packt\chapter02\maven\Demo</code>) using Ant. Follow<a id="id289" class="calibre1"/> the ensuing steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Create an XML file <code class="literal">build.xml</code> in <code class="literal">\Packt\chapter02\maven\Demo</code>.</li><li class="listitem" value="2">Add the following lines in the <code class="literal">build.xml</code> file:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;<span class="strong"><strong class="calibre10">project name</strong></span>="Demo"  <span class="strong"><strong class="calibre10">basedir</strong></span>="."&gt;
  &lt;<span class="strong"><strong class="calibre10">property name</strong></span>="src.dir" <span class="strong"><strong class="calibre10">location</strong></span>="src/main/java" /&gt;
  &lt;property name="build.dir" location="bin" /&gt;
  &lt;property name="dist.dir" location="ant_output" /&gt;
&lt;/project&gt;</pre></div><p class="calibre15">The <code class="literal">&lt;project&gt;</code> tag is a defined tag in Ant. You can name your project, and  <code class="literal">Demo</code> is the name of the project. Next, we will set properties; a property can have a name and value or location. Here, <code class="literal">src.dir</code> is a property name, and this property can be accessed from any task using the <code class="literal">${src.dir}</code> syntax. The <code class="literal">location</code> attribute refers to a relative location from the <code class="literal">build.xml</code> file. Since <code class="literal">src/main/java</code> contains the source file, we set the location value to <code class="literal">src/main/java</code>. The other two properties, <code class="literal">build.dir</code> and <code class="literal">dist.dir</code>, will be used by the Java compiling task to compile class files and generate the JAR file.</p></li><li class="listitem" value="3">Do you remember the clean task in Maven? Ant doesn't provide default targets. We have to define a <code class="literal">clean</code> target to remove old build outputs, and we will call Ant's <code class="literal">&lt;delete&gt;</code> command to delete directories. Then, using the <code class="literal">&lt;mkdir&gt;</code> command, we will recreate the directories:<div class="informalexample"><pre class="programlisting">  &lt;target name="clean"&gt;
    &lt;delete dir="${build.dir}" /&gt;
    &lt;delete dir="${dist.dir}" /&gt;
  &lt;/target&gt;
  &lt;target name="makedir"&gt;
    &lt;mkdir dir="${build.dir}" /&gt;
    &lt;mkdir dir="${dist.dir}" /&gt;
  &lt;/target&gt;</pre></div><p class="calibre15">Note that we added two targets using the <code class="literal">&lt;target&gt;</code> tag. Each target is identified using a name. We will call the <code class="literal">clean</code> target to delete <code class="literal">build.dir</code> (generated <code class="literal">.class</code> files) and <code class="literal">dist.dir</code> (build output JARs).</p></li><li class="listitem" value="4">Compile task is inbuilt in Gradle/Maven, but Ant doesn't have any inbuilt compile targets; so, we will <a id="id290" class="calibre1"/>create a target to compile Java files as follows:<div class="informalexample"><pre class="programlisting">  &lt;target name="compile" depends="clean, makedir"&gt;
    &lt;javac srcdir="${src.dir}" destdir="${build.dir}"&gt;
    &lt;/javac&gt;
  &lt;/target&gt;</pre></div><p class="calibre15">Use the <code class="literal">&lt;javac&gt;</code> command to compile Java files. The <code class="literal">&lt;javac&gt;</code> command accepts <code class="literal">srcdir</code> and <code class="literal">destdir</code>. Compiler reads Java files from <code class="literal">srcdir</code> and generates class files to <code class="literal">destdir</code>.</p><p class="calibre15">A target may depend on another, and <code class="literal">depends</code> allows us to pass comma-separated target names. Here, compile target depends on <code class="literal">clean</code> and <code class="literal">makedir</code>.</p></li><li class="listitem" value="5">The compilation is done. Now, we will create <code class="literal">jar</code> from the class files using the <code class="literal">&lt;jar&gt;</code> command as follows:<div class="informalexample"><pre class="programlisting">&lt;target name="jar" depends="compile"&gt;
    &lt;jar destfile="${dist.dir}\${ant.project.name}.jar" basedir="${build.dir}"&gt;
    &lt;/jar&gt;
  &lt;/target&gt;</pre></div><p class="calibre15">The <code class="literal">jar</code> target needs to know the class file's location and destination. The <code class="literal">destfile</code> attribute refers to the destination JAR file name and location and <code class="literal">basedir</code> refers to the class file location. Check whether we used <code class="literal">${dist.dir}\${ant.project.name}.jar</code> to represent the destination JAR file name and folder. Here, <code class="literal">${dist.dir}</code> refers to the destination folder, and <code class="literal">${ant.project.name}.jar</code> represents the JAR name. <code class="literal">${ant.project.name}</code> is the name (<code class="literal">Demo</code>) we mentioned in the <code class="literal">&lt;project&gt;</code> tag.</p></li><li class="listitem" value="6">The Ant script is ready to compile and create a JAR. Open the command prompt, go to <code class="literal">\Packt\chapter02\maven\Demo</code> and issue an <code class="literal">ant jar</code> command. Here, <code class="literal">jar</code> depends on <code class="literal">compile</code> and <code class="literal">compile</code> depends on <code class="literal">clean</code> and <code class="literal">makedir</code>. So, the <code class="literal">jar</code> command will create two directories, <code class="literal">bin</code> and <code class="literal">ant_output</code>, compile the Java file and generate the<code class="literal">.class</code> file in the bin folder, and finally create a <code class="literal">Demo.jar</code> JAR in the <code class="literal">ant_output</code> folder.</li><li class="listitem" value="7">The compilation is done; now, it's time to execute the tests. Tests need JUnit JARs and generated <a id="id291" class="calibre1"/>source class files to compile and execute. We have created the <code class="literal">lib</code> directory for Gradle in \<code class="literal">Packt\chapter02\lib</code> and kept the JUnit 4 JARs in it. We will use this <code class="literal">lib</code>. Add three properties for the test source file directory, library directory, and test report as follows:<div class="informalexample"><pre class="programlisting">  &lt;property name="test.dir" location="src/test/java" /&gt;
  &lt;property name="lib.dir" location="../../lib" /&gt;
  &lt;property name="report.dir" location="${dist.dir}/report" /&gt;</pre></div><p class="calibre15">Check whether the <code class="literal">lib.dir</code> location is relative to the <code class="literal">build.xml</code> location. The <code class="literal">test.dir</code> attribute points to <code class="literal">src/test/main</code> and test reports will be generated inside <code class="literal">ant_output/report</code>.</p></li><li class="listitem" value="8">Path allows us to refer to a directory or to a file path. We will define a <code class="literal">jclass.path</code> path to refer to all JAR files under the <code class="literal">lib</code> directory and generated <code class="literal">.class</code> files as follows:<div class="informalexample"><pre class="programlisting">  &lt;path id="jclass.path"&gt;
    &lt;<span class="strong"><strong class="calibre10">fileset</strong></span> dir="${lib.dir}/"&gt;
      <span class="strong"><strong class="calibre10">&lt;include name="**/*" /&gt;</strong></span>
    &lt;/fileset&gt;
    &lt;<span class="strong"><strong class="calibre10">pathelement</strong></span> location="${build.dir}" /&gt;
  &lt;/path&gt;</pre></div><p class="calibre15">The <code class="literal">&lt;fileset&gt;</code> tag takes a directory location and <code class="literal">&lt;include&gt;</code> takes a file name or regular expression. The <code class="literal">**/*</code> value means all the directories and files are in <code class="literal">${lib.dir}</code>. The <code class="literal">pathelement</code> attribute refers to the <code class="literal">bin</code> directory where the compiled class files are put.</p></li><li class="listitem" value="9">Now, we need to compile test files. Add a <code class="literal">testcompile</code> target and use the <code class="literal">javac</code> command. Pass <code class="literal">test.dir</code> as <code class="literal">srcdir</code> for compilation. Add <code class="literal">&lt;classpath&gt;</code> to refer the <code class="literal">jclass.path</code> value. This will compile the test files. Consider the following code snippet:<div class="informalexample"><pre class="programlisting"> &lt;target name="testcompile" depends="compile"&gt;
    &lt;javac srcdir="${test.dir}" destdir="${build.dir}"&gt;
      &lt;classpath refid="jclass.path" /&gt;
    &lt;/javac&gt;
  &lt;/target&gt;</pre></div></li><li class="listitem" value="10">Add another target to execute the JUnit test. Ant has a <code class="literal">junit</code> command to run tests. Pass <code class="literal">jclass.path</code> to point the <code class="literal">lib</code> directory and generated files as follows:<div class="informalexample"><pre class="programlisting">  &lt;target name="test" depends="testcompile"&gt;
    &lt;junit printsummary="on" fork="true" haltonfailure="yes"&gt;
      &lt;classpath refid="jclass.path" /&gt;
      &lt;formatter type="xml" /&gt;
      &lt;batchtest todir="${report.dir}"&gt;
        &lt;fileset dir="${test.dir}"&gt;
          &lt;include name="**/*Test*.java" /&gt;
        &lt;/fileset&gt;
      &lt;/batchtest&gt;
    &lt;/junit&gt;
  &lt;/target&gt;</pre></div><p class="calibre15">Issue the <code class="literal">ant test</code> command. This command compiles and executes the tests.</p><p class="calibre15">We can set a default<a id="id292" class="calibre1"/> task in the <code class="literal">build.xml</code> file in the <code class="literal">&lt;project&gt;</code> tag. The syntax is <code class="literal">&lt;project name="Demo" default="task name" basedir="."&gt;</code>. Now, we don't have to specify a target name.</p></li></ol><div class="calibre17"/></div><p class="calibre9">Our Ant script is ready for compiling Java files, executing tests, and generating reports. In the next section, we will set up Jenkins and use the build scripts.</p><p class="calibre9">To explore more on how to compile web archives and learn advanced topics, go to <a class="calibre1" href="http://ant.apache.org/">http://ant.apache.org/</a>.</p></div></div></div>

<div id="page" style="height:0pt"/><div class="book" title="Jenkins"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec14" class="calibre1"/>Jenkins</h1></div></div></div><p class="calibre9">Jenkins is an open source CI tool written in Java. It runs on any web container compliant with Servlet Specification 2.4. The <a id="id293" class="calibre1"/>new Apache Tomcat server is an example of a web container with which Jenkins can be integrated as a Windows service.</p><p class="calibre9">Jenkins supports various source control platforms, such as CVS, SVN, Git, Mercurial, and ClearCase through the use of plugins.</p><p class="calibre9">It can execute automated builds on Ant and Maven projects. Jenkins is free (MIT license) and runs on many operating systems. Jenkins doesn't allow you to create a Gradle project, but you can create a free-style project and build Gradle projects.</p><p class="calibre9">To install Jenkins on your local<a id="id294" class="calibre1"/> machine, follow the instructions at <a class="calibre1" href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins">https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins</a>.</p><p class="calibre9">Once Jenkins is installed, we will perform the following steps to configure Jenkins:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Launch the Jenkins URL; from the home page go to <span class="strong"><strong class="calibre10">Manage Jenkins</strong></span> | <span class="strong"><strong class="calibre10">Configure system</strong></span>.</li><li class="listitem" value="2">Now you need to set up the JDK. Go to the <span class="strong"><strong class="calibre10">JDK</strong></span> section, click on <span class="strong"><strong class="calibre10">JDK installations</strong></span> and then click on <span class="strong"><strong class="calibre10">Add JDK</strong></span>. Uncheck the <span class="strong"><strong class="calibre10">Install automatically</strong></span> checkbox, and enter a <span class="strong"><strong class="calibre10">Name</strong></span> and <span class="strong"><strong class="calibre10">JAVA_HOME</strong></span> path. You can add as many JDKs as you want. <span class="strong"><strong class="calibre10">Name</strong></span> and <span class="strong"><strong class="calibre10">JAVA_HOME</strong></span> location uniquely identify the version of JDK. In your project, you can refer to the JDK you want to use. The following screenshot shows the installation of JDK:<div class="mediaobject"><img src="../images/00032.jpeg" alt="Jenkins" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="3">Now, set up Maven. Go to the <span class="strong"><strong class="calibre10">Maven</strong></span> section and click on <span class="strong"><strong class="calibre10">Maven installations</strong></span>. Now, click on <span class="strong"><strong class="calibre10">Add Maven</strong></span>, uncheck the <span class="strong"><strong class="calibre10">Install automatically</strong></span> checkbox, enter a <span class="strong"><strong class="calibre10">Name</strong></span>, and set it to <span class="strong"><strong class="calibre10">MAVEN_HOME</strong></span>.<p class="calibre15">In general, if the checkbox <span class="strong"><strong class="calibre10">Install automatically</strong></span> is checked, then Jenkins will ask you to select a version of the tool and download the version. You can install or add multiple versions of the software and just give a unique name. For example, you can add a name, <code class="literal">Maven3,</code> to refer to Maven Version 3.1.1 and add <code class="literal">Maven2</code> to refer to Version 2.2.1. In your build job, Jenkins will show you the list and select the appropriate version you need. The following screenshot shows the installation of Maven:</p><div class="mediaobject"><img src="../images/00033.jpeg" alt="Jenkins" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="4">Go to the <span class="strong"><strong class="calibre10">Ant</strong></span> section and <a id="id295" class="calibre1"/>click on <span class="strong"><strong class="calibre10">Ant installations</strong></span>. Then, click on <span class="strong"><strong class="calibre10">Add Ant</strong></span>, uncheck the <span class="strong"><strong class="calibre10">Install automatically</strong></span> checkbox, enter a <span class="strong"><strong class="calibre10">Name</strong></span>, and set it to <span class="strong"><strong class="calibre10">ANT_HOME</strong></span>.<div class="mediaobject"><img src="../images/00034.jpeg" alt="Jenkins" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">Our basic configuration is complete. Next, we will start building a Java project using Gradle.</p></div>

<div class="book" title="Jenkins">
<div class="book" title="The Gradle project"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_1"><a id="ch02lvl2sec25" class="calibre1"/>The Gradle project</h2></div></div></div><p class="calibre9">Jenkins doesn't come with Gradle. You need to install a plugin as follows:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Launch the Jenkins URL; from the home<a id="id296" class="calibre1"/> page, go to <span class="strong"><strong class="calibre10">Manage Jenkins</strong></span> | <span class="strong"><strong class="calibre10">Manage Plugins</strong></span>. Go to the <span class="strong"><strong class="calibre10">Available</strong></span> tab; in the <span class="strong"><strong class="calibre10">Filter</strong></span> textbox (located at the right top corner of the page), enter <code class="literal">gradle</code>. It will bring you <span class="strong"><strong class="calibre10">Gradle Plugin</strong></span>. Check the checkbox associated with <span class="strong"><strong class="calibre10">Gradle Plugin</strong></span> and click on <span class="strong"><strong class="calibre10">Install without restart</strong></span>.<p class="calibre15">This will install the <span class="strong"><strong class="calibre10">Gradle plugin</strong></span>. Jenkins will show you the progress of installation. Once the installation is over, you need to configure Gradle, like we did for Ant and Maven. Refer to the following screenshot to install <span class="strong"><strong class="calibre10">Gradle plugin</strong></span>:</p><div class="mediaobject"><img src="../images/00035.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="2">From the home page, go to <span class="strong"><strong class="calibre10">Manage Jenkins</strong></span> | <span class="strong"><strong class="calibre10">Configure System</strong></span>. Scroll down to the <span class="strong"><strong class="calibre10">Gradle</strong></span> section <a id="id297" class="calibre1"/>and click on Gradle installation. Then, click on <span class="strong"><strong class="calibre10">Add Gradle</strong></span>, uncheck the <span class="strong"><strong class="calibre10">Install automatically</strong></span> checkbox, enter a <span class="strong"><strong class="calibre10">Name</strong></span>, and set <span class="strong"><strong class="calibre10">GRADLE_HOME</strong></span>.<div class="mediaobject"><img src="../images/00036.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="3">Go back to the home page. The Jenkins convention for project building is <span class="strong"><strong class="calibre10">job</strong></span>. A job runs continuously, invokes scripts, and gives feedback. To set up an automated build process, the user has to configure a job. Click on the <span class="strong"><strong class="calibre10">create new jobs</strong></span> hyperlink to add a new project type. Jenkins supports several types of build jobs. Two most commonly used jobs are the free-style builds and the Maven 2/3 builds. The free-style projects allow you to configure any sort of build job; this job type is highly flexible and configurable. However, you can install plugins for other types.<p class="calibre15">The following screenshot displays how to create a <code class="literal">gradleProject</code> free-style job:</p><div class="mediaobject"><img src="../images/00037.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="4">The free-style project has several settings. In <span class="strong"><strong class="calibre10">Advance Project Options</strong></span>, you can set <span class="strong"><strong class="calibre10">Quiet period</strong></span> (time to wait after a build), <span class="strong"><strong class="calibre10">Retry Count</strong></span> (number of attempts to checkout from the repository), and so on. In <span class="strong"><strong class="calibre10">Source Code Management</strong></span>, you can choose a version control tool type. Version control is one of the most important<a id="id298" class="calibre1"/> things in CI. It keeps track of software versions, we can revert our changes at any point in time, look at file history, and much more. By default, Jenkins comes with the source code management tool plugins, CVS and SVN, but we can install plugins to support other types, such as Git and Rational ClearCase. We didn't configure any version control tool yet; so, choose <span class="strong"><strong class="calibre10">None,</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="../images/00038.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="5">Next is the <span class="strong"><strong class="calibre10">Build Trigger</strong></span> event, and the build trigger knows when to start a job. There are several types:<div class="book"><ul class="itemizedlist1"><li class="listitem"><span class="strong"><strong class="calibre10">Build after other projects are built</strong></span>: This implies that the job will be invoked after another job</li><li class="listitem"><span class="strong"><strong class="calibre10">Build periodically</strong></span>: This signifies the periodic schedule for cron expressions, that is, every 5 minutes or every 30 minutes and so on</li><li class="listitem"><span class="strong"><strong class="calibre10">Poll SCM</strong></span>: This implies polling the version control location after a specific time set in the <span class="strong"><strong class="calibre10">Schedule</strong></span> option</li></ul></div><p class="calibre15">We don't have other<a id="id299" class="calibre1"/> jobs or a version control tool, so choose <span class="strong"><strong class="calibre10">Build periodically</strong></span> and set <span class="strong"><strong class="calibre10">Schedule</strong></span> to <span class="strong"><strong class="calibre10">H/5****</strong></span> to execute the build every 5 minutes, as shown in the following screenshot:</p><div class="mediaobject"><img src="../images/00039.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="6">The next section is <span class="strong"><strong class="calibre10">Build</strong></span>. You can add several steps to a build. Click on <span class="strong"><strong class="calibre10">Add build step</strong></span>. It will show you a step; choose <span class="strong"><strong class="calibre10">Invoke Gradle script</strong></span> to call our Gradle project, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00040.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="7">Now click on the <span class="strong"><strong class="calibre10">Invoke Gradle</strong></span> radio button and choose the Gradle version we added. In the <span class="strong"><strong class="calibre10">Tasks</strong></span> field, enter <code class="literal">build</code> to invoke the build task; you can add multiple tasks here. In the <span class="strong"><strong class="calibre10">Build File</strong></span> field, enter<a id="id300" class="calibre1"/> the full path of your Gradle build file <code class="literal">\Packt\chapter02\java\build.gradle</code>, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00041.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="8">Now click on <span class="strong"><strong class="calibre10">Save</strong></span>. Jenkins will take you to the project's home page. Click on the <span class="strong"><strong class="calibre10">Build Now</strong></span> hyperlink. It will start building our first project. It will show you a build history table with a build number, such as <span class="strong"><strong class="calibre10">#1 Feb 4. 2014 09:18:45 PM</strong></span>. Click on the <span class="strong"><strong class="calibre10">build#</strong></span> hyperlink and then click on <span class="strong"><strong class="calibre10">Console Output</strong></span>. It will show you the build log. The following screenshot shows our Gradle build log:<div class="mediaobject"><img src="../images/00042.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="9">Now go back to the home page; it shows you the list of all builds and their status. It has a weather column—when all builds are failing, the weather shows a cloudy<a id="id301" class="calibre1"/> image, and when all builds are passing, the weather becomes sunny. You can invoke a build by clicking on the wheel symbol to the right of each build row. Refer to the following screenshot:<div class="mediaobject"><img src="../images/00043.jpeg" alt="The Gradle project" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">Our Gradle build configuration is complete. Automatically, after every five minutes, the build will be kicked off. We can configure a post build action to send an e-mail after each build. That way, if a build fails, then immediately a mail will be sent, and the concerned person can take care of the issue. So, the feedback cycle is faster.</p><p class="calibre9">In the next section, we will configure a Maven job.</p></div></div>

<div class="book" title="Jenkins">
<div class="book" title="The Maven project"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_2"><a id="ch02lvl2sec26" class="calibre1"/>The Maven project</h2></div></div></div><p class="calibre9">In this section, we will configure Jenkins<a id="id302" class="calibre1"/> to execute a Maven build job. Please perform the following steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Click on the <span class="strong"><strong class="calibre10">New Job</strong></span> hyperlink to add a new project type. Select <span class="strong"><strong class="calibre10">Build a maven2/3 project</strong></span> and enter a job name, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00044.jpeg" alt="The Maven project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="2">On the details page, choose <span class="strong"><strong class="calibre10">Source Code Management</strong></span> as <span class="strong"><strong class="calibre10">None</strong></span>, <span class="strong"><strong class="calibre10">Build Triggers</strong></span> as <span class="strong"><strong class="calibre10">Build periodically</strong></span>, and set <span class="strong"><strong class="calibre10">H/5****</strong></span> to execute the build in every 5 minutes.</li><li class="listitem" value="3">Next, go to the <span class="strong"><strong class="calibre10">Build</strong></span> section and set the <span class="strong"><strong class="calibre10">Root POM</strong></span> value; set the full file path location of your <code class="literal">pom.xml</code> file in the <code class="literal">Demo</code> project. You can leave the <span class="strong"><strong class="calibre10">Goals and options</strong></span> section blank. Gradle will issue the default <code class="literal">mvn install</code> command. Refer to the following screenshot:<div class="mediaobject"><img src="../images/00045.jpeg" alt="The Maven project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="4">Now click on <span class="strong"><strong class="calibre10">Save</strong></span>. Jenkins will take you to the project's home page. Click on the <span class="strong"><strong class="calibre10">Build Now</strong></span> hyperlink and it will start building our first project. It will show you a build history table with a build number such as <span class="strong"><strong class="calibre10">#1 Feb 4. 2014 09:18:45 PM</strong></span>. Click on the <span class="strong"><strong class="calibre10">build#</strong></span> hyperlink and then click on <span class="strong"><strong class="calibre10">Console Output</strong></span>. It will show you the following build log:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong class="calibre10">Executing Maven:  -B -f D:\Packt\chapter02\maven\Demo\pom.xml install</strong></span>
<span class="strong"><strong class="calibre10">[INFO] Scanning for projects...</strong></span>
<span class="strong"><strong class="calibre10"> </strong></span>
<span class="strong"><strong class="calibre10">[INFO] Building Demo 1.0-SNAPSHOT</strong></span>
<span class="strong"><strong class="calibre10"> [INFO] Downloading: http://repo.maven.apache.org/maven2/org/apache/maven/plugin</strong></span>
<span class="strong"><strong class="calibre10">(226 KB at 33.4 KB/sec)</strong></span>
<span class="strong"><strong class="calibre10">[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong class="calibre10"> [INFO] Total time: 2:28.150s</strong></span>
<span class="strong"><strong class="calibre10">[</strong></span>
<span class="strong"><strong class="calibre10"> [JENKINS] Archiving D:\Packt\chapter02\maven\Demo\pom.xml to org.packt/Demo/1.0-SNAPSHOT/Demo-1.0-SNAPSHOT.pom</strong></span>
<span class="strong"><strong class="calibre10">[JENKINS] Archiving D:\Packt\chapter02\maven\Demo\target\Demo-1.0-SNAPSHOT.jar to org.packt/Demo/1.0-SNAPSHOT/Demo-1.0-SNAPSHOT.jar</strong></span>
<span class="strong"><strong class="calibre10">channel stopped</strong></span>
<span class="strong"><strong class="calibre10">Finished: SUCCESS</strong></span>
</pre></div></li><li class="listitem" value="5">Check whether Jenkins<a id="id303" class="calibre1"/> issued the <code class="literal">mvn install</code> command, created the JAR, and installed the artifacts in the <code class="literal">.m2</code> repository.</li></ol><div class="calibre17"/></div></div></div>

<div class="book" title="Jenkins">
<div class="book" title="Building the Ant project"><div class="book"><div class="book"><div class="book"><h2 class="title1" id="calibre_pb_3"><a id="ch02lvl2sec27" class="calibre1"/>Building the Ant project</h2></div></div></div><p class="calibre9">We will set up a free-style <a id="id304" class="calibre1"/>software project to build using Ant. The following are the steps:</p><div class="book"><ol class="orderedlist"><li class="listitem" value="1">Open the Jenkins URL, click on <span class="strong"><strong class="calibre10">New Job,</strong></span> and select <span class="strong"><strong class="calibre10">Build a free-style software project</strong></span>. Enter the name, <code class="literal">ant,</code> and then click on <span class="strong"><strong class="calibre10">Ok</strong></span>.</li><li class="listitem" value="2">We don't have source code management, so skip this section. Go to <span class="strong"><strong class="calibre10">Build Triggers</strong></span> and set the <span class="strong"><strong class="calibre10">H/5 * * * *</strong></span> value to kick off build automatically in every 5 minutes.</li><li class="listitem" value="3">Go to the <span class="strong"><strong class="calibre10">Build</strong></span> section and add a <span class="strong"><strong class="calibre10">Invoke Ant</strong></span> build step, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00046.jpeg" alt="Building the Ant project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="4">Select an Ant version from the dropdown, set <code class="literal">jar</code> as <span class="strong"><strong class="calibre10">Targets</strong></span>; <code class="literal">jar</code> will invoke test and <a id="id305" class="calibre1"/>compile. In <span class="strong"><strong class="calibre10">Build File</strong></span>, browse to our <code class="literal">build.xml</code> file location and set the value, as shown in the following screenshot:<div class="mediaobject"><img src="../images/00047.jpeg" alt="Building the Ant project" class="calibre12"/></div><p class="calibre16"> </p></li><li class="listitem" value="5">Save the setting and the new job will be saved. Click on <span class="strong"><strong class="calibre10">Build Now</strong></span>. It will start building the <code class="literal">Demo</code> project we created earlier in this chapter. The following is a screenshot of <span class="strong"><strong class="calibre10">Console Output</strong></span>:<div class="mediaobject"><img src="../images/00048.jpeg" alt="Building the Ant project" class="calibre12"/></div><p class="calibre16"> </p></li></ol><div class="calibre17"/></div><p class="calibre9">You can read about<a id="id306" class="calibre1"/> securing Jenkins, the post-build action, broken build claim plugins, and the CI game from the Jenkins <a id="id307" class="calibre1"/>wiki at <a class="calibre1" href="http://jenkins-ci.org/">http://jenkins-ci.org/</a>.</p></div></div>
<div class="book" title="Summary"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch02lvl1sec15" class="calibre1"/>Summary</h1></div></div></div><p class="calibre9">This chapter covered the concept of CI, explored the build automation tools, and configured Jenkins to accomplish the CI.</p><p class="calibre9">The Gradle section covered the environment setup, Gradle tasks, daemons, dependency management, repository setup, Eclipse/Java plugins, and gradually explored the Gradle features. The Maven part demonstrated how to set up Maven, described the POM file, project dependency, and explored the default, clean, and site life cycles. The Ant section described how to write the Ant script to compile and execute JUnit tests. Jenkins covered the build automation setup as well as automated build using Gradle, Maven, and Ant.</p><p class="calibre9">By now, the reader will be able to write build scripts using Gradle, Maven, and Ant and configure Jenkins to execute the build scripts.</p><p class="calibre9">The next chapter provides an overview of test doubles and different test double types with examples, and includes topics such as dummy, stub, mock, spy, and fake.</p></div></body></html>