- en: Chapter 13. Build Automation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 13 章。构建自动化
- en: 'In this chapter, we will cover:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将介绍：
- en: Installing VirtualBox
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 VirtualBox
- en: Preparing SSH keys
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备 SSH 密钥
- en: Preparing VirtualBox machines with Linux
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备装有 Linux 的 VirtualBox 机器
- en: Preparing VirtualBox machines with Mac OS X
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备装有 Mac OS X 的 VirtualBox 机器
- en: Preparing VirtualBox machines with Windows
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 准备装有 Windows 的 VirtualBox 机器
- en: Automating builds
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自动化构建
- en: Building cross-platform installers
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建跨平台安装程序
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: Automated builds are widely used in cross-platform software development. *Build
    farm* with build machines for each supported operating systems is required to
    build projects remotely and run tests on all platforms. With the rising popularity
    of software virtualization tools, it became possible to deploy a *virtual build
    farm* using a single physical machine.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 自动化构建在跨平台软件开发中被广泛使用。需要一个 *构建农场*，其中包含每个支持的操作系统的构建机器，以远程构建项目和在所有平台上运行测试。随着软件虚拟化工具的日益流行，使用单个物理机器部署
    *虚拟构建农场* 变得可能。
- en: 'Besides the build environment in each OS, the essential part of an automated
    build is the communication between the *master* machine and the *build* machines.
    The following communication jobs might be required:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 除了每个操作系统的构建环境之外，自动化构建的关键部分是 *主* 机器和 *构建* 机器之间的通信。可能需要以下通信任务：
- en: The master should prepare and start the build machine
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主服务器应准备并启动构建机器
- en: The master should send the source code directly to the build machine or fire
    sources fetching process from the build machine itself
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主服务器应直接将源代码发送到构建机器，或者从构建机器本身启动源代码检索过程
- en: The master should start the build process
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主服务器应启动构建过程
- en: The build machine should send build logs to the master during the build
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建机器应在构建过程中将构建日志发送到主服务器
- en: The build machine should send result binaries to the master
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 构建机器应将结果二进制文件发送到主服务器
- en: The master should shut down the build machine
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主服务器应关闭构建机器
- en: In this chapter, we will prepare the OpenJDK build environment for Windows,
    Linux, and Mac OS X. This task can be done using a high-level build automation
    (or Continuous Integration) tool. However, such tools can be limited in functionality
    and inflexible for our task. While all such tools should do similar jobs (as listed
    previously), different tools can have different configurations and peculiarities,
    and the knowledge of one tool can be less useful for another. Also, such tools
    bring in an additional level of complexity with possible tool-specific problems.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将为 Windows、Linux 和 Mac OS X 准备 OpenJDK 构建环境。这项任务可以使用高级构建自动化（或持续集成）工具来完成。然而，这样的工具在功能上可能有限，并且对于我们的任务来说可能不够灵活。虽然所有这样的工具都应该执行类似的工作（如之前所列），但不同的工具可能有不同的配置和特性，对一种工具的了解可能对另一种工具不那么有用。此外，这样的工具还引入了一个额外的复杂性层次，可能会带来特定工具的问题。
- en: You will learn how to perform build automation using the most basic tools for
    a better understanding of the process. The bash shell is already used for OpenJDK
    builds on all platforms (natively on Linux/Mac and through Cygwin on Windows),
    so we will use bash scripts for setting up and starting to build virtual machines.
    For communication (sending commands and data), we will use the SSH protocol; implementation
    for this is usually preinstalled on Unix-like operating systems and can also be
    installed on Windows. For virtualization, we will use the popular VirtualBox tool
    from Oracle.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您将学习如何使用最基本的工具进行构建自动化，以便更好地理解这个过程。bash shell 已经在所有平台上用于 OpenJDK 构建（在 Linux/Mac
    上是原生的，在 Windows 上通过 Cygwin），因此我们将使用 bash 脚本来设置和启动构建虚拟机。对于通信（发送命令和数据），我们将使用 SSH
    协议；Unix-like 操作系统上通常预装了该协议的实现，也可以在 Windows 上安装。对于虚拟化，我们将使用来自甲骨文的流行工具 VirtualBox。
- en: Installing VirtualBox
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 VirtualBox
- en: VirtualBox is a popular virtualization toolbox from Oracle Corporation that
    allows us to run *virtual* instances of other operating systems on top of the
    *host* operating system. In this recipe, we will install VirtualBox and configure
    host network interfaces. Such a configuration will allow us to connect from host
    to guest and back during the automated builds.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: VirtualBox 是来自甲骨文公司的一个流行的虚拟化工具箱，它允许我们在宿主操作系统之上运行其他操作系统的 *虚拟* 实例。在本食谱中，我们将安装
    VirtualBox 并配置宿主网络接口。这样的配置将允许我们在自动化构建过程中从宿主连接到客户机，然后再返回。
- en: Getting ready
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will require the Ubuntu 12.04 amd64 operating system running.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个食谱，我们需要运行 Ubuntu 12.04 amd64 操作系统。
- en: How to do it...
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following procedure will help you to install VirtualBox:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助您安装 VirtualBox：
- en: Download the installation package from the VirtualBox website ([https://www.virtualbox.org/](https://www.virtualbox.org/))
    and install it.
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从VirtualBox网站（[https://www.virtualbox.org/](https://www.virtualbox.org/））下载安装包并安装。
- en: 'Install the virtual network interface package:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装虚拟网络接口包：
- en: '[PRE0]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Create a virtual interface `tap0` that will be used for connections to and
    from the guest machine:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个虚拟接口`tap0`，该接口将用于连接到和从客户机：
- en: '[PRE1]'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Configure the interface `tap0`:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置接口`tap0`：
- en: '[PRE2]'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Create an arbitrary VirtualBox machine using GUI forms.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用GUI表单创建任意VirtualBox机器。
- en: Navigate to **Settings** | **Network form** and check whether the **tap0** network
    interface is available in the interfaces drop-down list when the **Bridged Adapter**
    mode is used.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到**设置** | **网络表单**，当使用**桥接适配器**模式时，检查**tap0**网络接口是否在接口下拉列表中可用。
- en: How it works...
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: VirtualBox supports different networking options for guest machines. One of
    them—Bridged Adapter—allows us to connect from host to guest and back using static
    IP addresses. To set up this mode on the host side, we need an additional virtual
    network interface with a separate address. The `tunctl` utility that comes as
    part of the `uml-utilities` package allows us to create a virtual interface such
    as `tap0`.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: VirtualBox支持为虚拟机提供不同的网络选项。其中之一——桥接适配器——允许我们使用静态IP地址从主机连接到客户机并返回。要在主机端设置此模式，我们需要一个额外的虚拟网络接口和单独的地址。`uml-utilities`包中包含的`tunctl`实用程序允许我们创建一个如`tap0`这样的虚拟接口。
- en: There's more...
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: Multiple virtual interfaces can be created with different addresses to run multiple
    virtual machines simultaneously. Mac OS X can be used as a host machine, the `tuntaposx`
    kernel extensions are required to use the `tunctl` utility.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 可以创建多个具有不同地址的虚拟接口，以同时运行多个虚拟机。Mac OS X可以用作主机机器，需要`tuntaposx`内核扩展来使用`tunctl`实用程序。
- en: See also
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The Oracle VirtualBox user manual at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VirtualBox用户手册可在[https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)找到
- en: Preparing SSH keys
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备SSH密钥
- en: In this chapter, we will use virtual machines to build OpenJDK. During the build
    source code, control commands, logs, and result binaries should be sent between
    host and virtual machines. We will use the ubiquitous **Secure Shell** (**SSH**)
    protocol and its most popular implementation **OpenSSH** for these tasks.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用虚拟机来构建OpenJDK。在构建源代码、控制命令、日志和结果二进制文件时，应在主机和虚拟机之间发送。我们将使用无处不在的**安全外壳协议**（**SSH**）及其最流行的实现**OpenSSH**来完成这些任务。
- en: SSH allows us to send data between the machines and run the commands remotely.
    When the client performs an SSH connection, it should be authenticated against
    the server. Besides the user/password authentication, OpenSSH also supports authentication
    using asymmetric cryptography (RSA or similar) keys. With SSH keys configured,
    a client can connect to server without manual intervention. This eases the scripting
    for copying multiple files or running remote tasks.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: SSH允许我们在机器之间发送数据并远程运行命令。当客户端执行SSH连接时，它应通过服务器进行认证。除了用户/密码认证外，OpenSSH还支持使用非对称加密（RSA或类似）密钥进行认证。配置了SSH密钥后，客户端可以无需手动干预连接到服务器。这简化了复制多个文件或运行远程任务的脚本编写。
- en: In this recipe, we will prepare a set of public and private keys and use these
    on all virtual machines and on the host machine during the build.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们将准备一套公钥和私钥，并在构建过程中在所有虚拟机和主机机器上使用这些密钥。
- en: Getting ready
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will need a Unix-like operating system running with an OpenSSH
    server and client installed. For example, the Ubuntu 12.04 operating system can
    be used.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个配方，我们需要一个运行着OpenSSH服务器和客户端的类Unix操作系统。例如，可以使用Ubuntu 12.04操作系统。
- en: How to do it...
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following procedure will help us to install VirtualBox:'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助我们安装VirtualBox：
- en: 'Generate client RSA keys pairs for the host and guest machines:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为主机和客户机生成客户端RSA密钥对：
- en: '[PRE3]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Generate server RSA key pairs for the host and guest machines:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为主机和客户机生成服务器RSA密钥对：
- en: '[PRE4]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Create a new user on the host machine that will be used to manage builds, and
    login under this user:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上创建一个新用户，该用户将用于管理构建，并以此用户登录：
- en: '[PRE5]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Run VirtualBox and configure networking as described in the previous recipe,
    *Installing VirtualBox*, with the `192.168.42.2` host IP address and the `192.168.42.1`
    guest IP address.
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行VirtualBox，并按照上一配方“安装VirtualBox”中的说明配置网络，使用`192.168.42.2`的主机IP地址和`192.168.42.1`的客户机IP地址。
- en: 'Create a user with the same name on the guest machine and login under this
    user:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机机器上创建一个具有相同名称的用户，并以此用户登录：
- en: '[PRE6]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Check whether the `ping` command works successfully from host to guest and
    back from guest to host:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查`ping`命令是否可以从主机成功连接到虚拟机，并从虚拟机返回到主机：
- en: '[PRE7]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'On the host machine, set up the client keys:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上，设置客户端密钥：
- en: '[PRE8]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'On the guest machine, set up server keys:'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机机器上设置服务器密钥：
- en: '[PRE9]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'On the guest machine, set up the host client public key:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机机器上设置主机客户端公钥：
- en: '[PRE10]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'On the host machine, try to connect to the guest and confirm the new guest
    server key:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上，尝试连接到虚拟机并确认新的虚拟机服务器密钥：
- en: '[PRE11]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'On the host machine, save the obtained fingerprint of the guest server key:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上，保存获取的虚拟机服务器密钥指纹：
- en: '[PRE12]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'On the host machine, check whether we can now connect from host to guest without
    any passwords or additional confirmations:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上，检查我们是否现在可以从主机连接到虚拟机而无需任何密码或额外确认：
- en: '[PRE13]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Repeat steps 7 to 11, swapping host and guest sides to set up connections from
    guest to host.
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 重复步骤7到11，交换主机和虚拟机两端以设置从虚拟机到主机的连接。
- en: 'Save the following keys for use later during the builds:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存以下密钥以供构建过程中使用：
- en: '`vmhost__id_rsa`: This is the host client private key'
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmhost__id_rsa`: 这是主机客户端私钥'
- en: '`vmhost__id_rsa.pub`: This is the host client public key'
  id: totrans-75
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmhost__id_rsa.pub`: 这是主机客户端公钥'
- en: '`vmhost__ssh_host_rsa_key`: This is the host server private key'
  id: totrans-76
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmhost__ssh_host_rsa_key`: 这是主机服务器的私钥'
- en: '`vmhost__ssh_host_rsa_key.pub`: This is the host server public key'
  id: totrans-77
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmhost__ssh_host_rsa_key.pub`: 这是主机服务器的公钥'
- en: '`vmhost__known_hosts`: This is the guest server key fingerprint to be used
    on the host'
  id: totrans-78
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmhost__known_hosts`: 这是主机上要使用的虚拟机服务器密钥指纹'
- en: '`vmguest__id_rsa`: This is the guest client private key'
  id: totrans-79
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmguest__id_rsa`: 这是虚拟机客户端私钥'
- en: '`vmguest__id_rsa.pub`: This is the guest client private key'
  id: totrans-80
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmguest__id_rsa.pub`: 这是虚拟机客户端私钥'
- en: '`vmguest__ssh_host_rsa_key`: This is the guest server private key'
  id: totrans-81
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmguest__ssh_host_rsa_key`: 这是虚拟机服务器的私钥'
- en: '`vmguest__ssh_host_rsa_key.pub`: This is the guest server public key'
  id: totrans-82
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmguest__ssh_host_rsa_key.pub`: 这是虚拟机服务器的公钥'
- en: '`vmguest__known_hosts`: This is the host server key fingerprint to be used
    on guest'
  id: totrans-83
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`vmguest__known_hosts`: 这是虚拟机上要使用的主机服务器密钥指纹'
- en: How it works...
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: The `ssh-keygen` command generates a pair of asymmetric cryptography (in our
    example, RSA) keys.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '`ssh-keygen`命令生成一对非对称加密（在我们的例子中，RSA）密钥。'
- en: SSH supports passwordless authentication based on keys. We prepared the set
    of keys that can be loaded to host and guest side (for all guest machines) to
    allow seamless connections from host to guest and back. So, now we can a call
    script on the host machine that will connect (or send files) to the guest and
    will be able to connect back to the host from the same guest session.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: SSH支持基于密钥的无密码身份验证。我们准备了一套密钥，可以加载到主机和虚拟机端（对于所有虚拟机），以允许主机到虚拟机和虚拟机到主机的无缝连接。因此，现在我们可以在主机机器上调用一个脚本，该脚本将连接到（或发送文件）到虚拟机，并能够从相同的虚拟机会话连接回主机。
- en: All keys are deliberately generated with an empty passphrase to allow connections
    without manual passphrase input.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 所有密钥都是故意使用空密码生成的，以便无需手动输入密码即可建立连接。
- en: There's more...
  id: totrans-88
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: Connections over SSH are secure and this can be useful if you want to perform
    builds using remote machines instead of local virtual ones. If security is not
    required, then other protocols can be used. They do not require authentication
    or a keys setup, for example, some custom protocol over HTTP with support for
    commands and sending files.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: SSH连接是安全的，如果你想要使用远程机器而不是本地虚拟机进行构建，这可能会很有用。如果不需要安全，则可以使用其他协议。它们不需要身份验证或密钥设置，例如，一些支持命令和发送文件的HTTP自定义协议。
- en: The DSA or ECDSA keys can be used instead of the RSA keys.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用DSA或ECDSA密钥代替RSA密钥。
- en: A shell automation tool like `expect` can be used to set up automated connections
    with passwords instead of client keys.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用像`expect`这样的shell自动化工具设置带密码的自动连接，而不是客户端密钥。
- en: See also
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Installing VirtualBox* recipe
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装VirtualBox*说明'
- en: The OpenSSH manual on key generation that is available at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-94
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenSSH关于密钥生成的手册，可在[https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)找到
- en: Preparing VirtualBox machines with Linux
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备Linux虚拟机
- en: Many Linux-based operating systems have decent support for virtualization using
    VirtualBox. They also usually have an OpenSSH client and server preinstalled or
    available in the main packages repository.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 许多基于 Linux 的操作系统都支持使用 VirtualBox 进行虚拟化，并且它们通常在主要软件包仓库中预安装或提供 OpenSSH 客户端和服务器。
- en: In this recipe, we will set up an Ubuntu Linux virtual machine that can be used
    for automated OpenJDK builds.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将设置一个 Ubuntu Linux 虚拟机，它可以用于自动化 OpenJDK 构建。
- en: Getting ready
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will require the Ubuntu 12.04 amd64 operating system with
    VirtualBox installed and a virtual network interface configured.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个菜谱，我们需要安装了 VirtualBox 并配置了虚拟网络接口的 Ubuntu 12.04 amd64 操作系统。
- en: How to do it...
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'The following procedure will help us to prepare the Linux virtual machine:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 以下程序将帮助我们准备 Linux 虚拟机：
- en: Prepare the SSH keys as described in the recipe *Preparing SSH keys*.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照菜谱 *准备 SSH 密钥* 中所述准备 SSH 密钥。
- en: Download the Ubuntu 12.04 server amd64 image from the Ubuntu website ([http://www.ubuntu.com/](http://www.ubuntu.com/)).
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 Ubuntu 网站下载 Ubuntu 12.04 服务器 amd64 镜像（[http://www.ubuntu.com/](http://www.ubuntu.com/））。
- en: In VirtualBox, create a virtual machine instance using the IDE storage controller
    and default values for other settings.
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 VirtualBox 中，使用 IDE 存储控制器和其他设置的默认值创建一个虚拟机实例。
- en: Install Ubuntu on to the virtual machine, set up networking as described in
    the recipe, *Installing VirtualBox*, and boot the virtual machine.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在虚拟机上安装 Ubuntu，按照菜谱 *安装 VirtualBox* 中所述设置网络，并启动虚拟机。
- en: 'Create a user with the same name on the host machine, and login under this
    user:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上创建一个具有相同名称的用户，并在此用户下登录：
- en: '[PRE14]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Set up the client keys:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置客户端密钥：
- en: '[PRE15]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Set up the server keys:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置服务器密钥：
- en: '[PRE16]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Set up the host client public key:'
  id: totrans-112
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机客户端公钥：
- en: '[PRE17]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Set up the host key fingerprint:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机密钥指纹：
- en: '[PRE18]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Check whether the connection from host to guest and back works seamlessly:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查从主机到客户机和返回的连接是否无缝工作：
- en: '[PRE19]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Complete the manual build of OpenJDK using the recipe, *Building OpenJDK 8 Ubuntu
    Linux 12.04 LTS*, from [Chapter 4](ch04.html "Chapter 4. Building OpenJDK 8"),
    *Building OpenJDK 8*.
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用来自 [第 4 章](ch04.html "第 4 章。构建 OpenJDK 8") 的 *Building OpenJDK 8 Ubuntu Linux
    12.04 LTS* 菜谱完成 OpenJDK 的手动构建。
- en: How it works...
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this recipe, we created a virtual machine instance with Ubuntu Linux and
    configured SSH keys to enable seamless automated connections to it.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们创建了一个带有 Ubuntu Linux 的虚拟机实例，并配置了 SSH 密钥以实现到它的无缝自动化连接。
- en: The manual build was done on this VM to be ensure all environment the is correct.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在此 VM 上进行了手动构建，以确保所有环境都正确。
- en: There's more...
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Other Linux-based OSs can be used instead of Ubuntu 12.04\. Other protocols/tools
    can be used for interaction between the host and guest machine instead of OpenSSH.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用其他基于 Linux 的操作系统代替 Ubuntu 12.04。可以使用其他协议/工具代替 OpenSSH 在主机和客户机之间进行交互。
- en: See also
  id: totrans-124
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Building OpenJDK 8 Ubuntu Linux 12.04* *LTS* recipe from [Chapter 4](ch04.html
    "Chapter 4. Building OpenJDK 8"), *Building OpenJDK 8*
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自 [第 4 章](ch04.html "第 4 章。构建 OpenJDK 8") 的 *Building OpenJDK 8 Ubuntu Linux
    12.04 LTS* 菜谱，*Building OpenJDK 8*
- en: The *Installing VirtualBox* recipe
  id: totrans-126
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装 VirtualBox* 菜谱'
- en: The *Preparing SSH keys* recipe
  id: totrans-127
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备 SSH 密钥* 菜谱'
- en: The Oracle VirtualBox user manual at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-128
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VirtualBox 用户手册 [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
- en: Preparing VirtualBox machines with Mac OS X
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备带有 Mac OS X 的 VirtualBox 机器
- en: Modern versions of the Mac OS X operating system support run in a virtualized
    environment using VirtualBox. Instructions to prepare the Mac OS X image for virtualization
    might differ vastly depending on the Mac OS X version and the host operating system.
    Exact instructions lie outside the scope of this book and can be found on the
    Internet.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: Mac OS X 操作系统的现代版本支持在虚拟化环境中使用 VirtualBox 运行。准备 Mac OS X 镜像以进行虚拟化的说明可能因 Mac OS
    X 版本和主机操作系统而大相径庭。确切说明超出了本书的范围，可以在互联网上找到。
- en: Please note that running a guest Mac OS X on a non-Mac host operating system
    can violate your end user license agreement with Apple Inc., it's better to consult
    your lawyer about this.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，在非 Mac 主机操作系统上运行客户机 Mac OS X 可能违反您与 Apple Inc. 的最终用户许可协议，最好咨询您的律师。
- en: Mac OS X has an OpenSSH client and server preinstalled.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: Mac OS X 预装了 OpenSSH 客户端和服务器。
- en: Getting ready
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will require a ready-to-use Mac OS X image (for VirtualBox-VDI)
    Version 10.7 or later.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个菜谱，我们需要一个可用于 VirtualBox-VDI 的已准备好的 Mac OS X 镜像（版本 10.7 或更高）。
- en: How to do it...
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following procedure will help us to prepare the Mac OS X virtual machine:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助我们准备Mac OS X虚拟机：
- en: Prepare SSH keys as described in the *Preparing SSH keys* recipe in this chapter.
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中 *准备SSH密钥* 菜谱中的说明准备SSH密钥。
- en: In VirtualBox, create a virtual machine instance using at least 2048 RAM, PIIX3
    Chipset, disabled UEFI, single CPU, and IDE storage controller.
  id: totrans-138
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VirtualBox中，创建一个至少拥有2048 RAM、PIIX3芯片组、禁用UEFI、单CPU和IDE存储控制器的虚拟机实例。
- en: Set up networking as described in the *Installing VirtualBox* recipe in this
    chapter and boot the virtual machine.
  id: totrans-139
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中 *安装VirtualBox* 菜谱中的说明设置网络，并启动虚拟机。
- en: Create a user with the same name on the host machine and login under this user.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上创建一个具有相同名称的用户，并以此用户身份登录。
- en: 'Set up the client keys:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置客户端密钥：
- en: '[PRE20]'
  id: totrans-142
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Set up the server keys:'
  id: totrans-143
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置服务器密钥：
- en: '[PRE21]'
  id: totrans-144
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Set up the host client public key:'
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机客户端公钥：
- en: '[PRE22]'
  id: totrans-146
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Set up the host key fingerprint:'
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机密钥指纹：
- en: '[PRE23]'
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Check whether the connection from host to guest and back works seamlessly:'
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查从主机到客户机和返回的连接是否无缝工作：
- en: '[PRE24]'
  id: totrans-150
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Complete the manual build of OpenJDK using the *Building OpenJDK 8 on Mac OS
    X* recipe from [Chapter 4](ch04.html "Chapter 4. Building OpenJDK 8"), *Building
    OpenJDK 8*.
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用来自第4章 *在Mac OS X上构建OpenJDK 8* 的 *构建OpenJDK 8 on Mac OS X* 菜谱完成OpenJDK的手动构建。
- en: How it works...
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this recipe, we created a virtual machine instance with Mac OS X and configured
    SSH keys to enable seamless automated connections to it.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们创建了一个带有Mac OS X的虚拟机实例，并配置了SSH密钥以实现无缝的自动化连接。
- en: The manual build was done on this VM to ensure that the environment setup was
    correct.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 手动构建是在这个虚拟机上完成的，以确保环境设置正确。
- en: There's more...
  id: totrans-155
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: In some Mac OS X versions, the preinstalled OpenSSH might not support the ECDSA
    SSH keys. This won't prevent us from finishing this recipe as we have used the
    RSA SSH keys. However, if you want to use ECDSA keys you can update the OpenSSH
    installation relatively easily using the Homebrew packaging system and its system
    duplicates repository, `homebrew/dupes`.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些Mac OS X版本中，预装的OpenSSH可能不支持ECDSA SSH密钥。尽管如此，我们仍然可以使用RSA SSH密钥完成这个菜谱。但是，如果你想使用ECDSA密钥，你可以相对容易地使用Homebrew打包系统和其系统副本仓库
    `homebrew/dupes` 更新OpenSSH安装。
- en: Other protocols/tools can be used for interaction between the host and the guest
    machine instead of OpenSSH.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用其他协议/工具在主机和客户机之间进行交互，而不是OpenSSH。
- en: See also
  id: totrans-158
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 相关链接
- en: The *Building OpenJDK 8 on* *Mac OS X* recipe from [Chapter 4](ch04.html "Chapter 4. Building
    OpenJDK 8"), *Building OpenJDK 8*
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自第4章 *在Mac OS X上构建OpenJDK 8* 的 *构建OpenJDK 8 on Mac OS X* 菜谱 [Chapter 4](ch04.html
    "第4章。构建OpenJDK 8")，*构建OpenJDK 8*
- en: The *Installing VirtualBox* recipe
  id: totrans-160
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装VirtualBox* 菜谱'
- en: The *Preparing SSH keys* recipe
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备SSH密钥* 菜谱'
- en: The Oracle VirtualBox user manual at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VirtualBox用户手册，[https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
- en: Preparing VirtualBox machines with Windows
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备带有Windows的VirtualBox机器
- en: Popular virtualization tools have very good support for virtualizing Windows.
    The VirtualBox setup for Windows can be easier than with Mac OS X. However, the
    SSH protocol is less popular on Windows than on Unix-like operating systems, and
    the SSH server's setup on Windows might be complex.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 流行的虚拟化工具对Windows的虚拟化支持非常好。与Mac OS X相比，Windows的VirtualBox设置可能更容易。然而，在Unix-like操作系统上，SSH协议比在Windows上更受欢迎，Windows上的SSH服务器设置可能更复杂。
- en: In this recipe, you will learn how to set up a Windows virtual machine for automated
    builds. A set of in-depth instructions about configuration of free SSH servers
    on Windows will constitute a significant part of the recipe.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，你将学习如何设置Windows虚拟机以进行自动化构建。关于在Windows上配置免费SSH服务器的一套深入指导将构成菜谱的重要部分。
- en: Getting ready
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will require a Windows 7 virtual machine VirtualBox image.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个菜谱，我们需要一个Windows 7虚拟机VirtualBox镜像。
- en: How to do it...
  id: totrans-168
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following procedure will help us to prepare the Windows virtual machine:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助我们准备Windows虚拟机：
- en: Prepare the SSH keys as described in the *Preparing SSH keys* recipe in this
    chapter.
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中 *准备SSH密钥* 菜谱中的说明准备SSH密钥。
- en: 'Download the Copssh SSH server implementation Version 3.1.4\. Unfortunately,
    it was removed from public downloads by the authors, but still can be found on
    the Internet with these file details:'
  id: totrans-171
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 下载Copssh SSH服务器实现版本3.1.4。不幸的是，它已被作者从公共下载中移除，但仍然可以在互联网上找到，以下是一些文件详细信息：
- en: '[PRE25]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Install Copssh into any Windows instance using the default installation parameters
    and copy the installed files somewhere for later usage.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用默认安装参数将Copssh安装到任何Windows实例中，并将安装的文件复制到某处以供以后使用。
- en: In VirtualBox, create a virtual machine instance using the IDE storage controller
    and the default values for other settings.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在VirtualBox中，使用IDE存储控制器和其他设置的默认值创建虚拟机实例。
- en: Set up networking as described in the *Installing VirtualBox* recipe in this
    chapter and boot the virtual machine.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中*安装VirtualBox*配方中的说明设置网络，并启动虚拟机。
- en: Create a user with the same name on the host machine and login under this user
    (we will use the name `packt`).
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在主机机器上创建具有相同名称的用户，并在此用户下登录（我们将使用名称`packt`）。
- en: Download Windows Server 2003 Resource Kit Tools from the Microsoft website and
    extract `ntrights`, `instsrv`, and `srvany` utilities from it.
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从Microsoft网站下载Windows Server 2003资源工具包，并从中提取`ntrights`、`instsrv`和`srvany`实用程序。
- en: Copy the extracted Copssh files into the `c:\ssh` directory.
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将提取的Copssh文件复制到`c:\ssh`目录。
- en: 'Set up users and rights for the SSH service using the following script:'
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下脚本设置SSH服务的用户和权限：
- en: '[PRE26]'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Generate internal Copssh login and password information, and register Copssh
    as a Windows service:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成内部Copssh登录和密码信息，并将Copssh注册为Windows服务：
- en: '[PRE27]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Install the Cygwin tools and run the bash shell.
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装Cygwin工具并运行bash shell。
- en: 'Set up the client keys:'
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置客户端密钥：
- en: '[PRE28]'
  id: totrans-185
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Set up the server keys:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置服务器密钥：
- en: '[PRE29]'
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Set up the host client public key:'
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机客户端公钥：
- en: '[PRE30]'
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Set up the host key fingerprint:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置主机密钥指纹：
- en: '[PRE31]'
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Check whether the connection from host to guest and back works seamlessly:'
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 检查从主机到虚拟机以及返回的连接是否无缝工作：
- en: '[PRE32]'
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Register the Windows service that will be used to start the build process using
    the `instsrv` and `srvany` utilities:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`instsrv`和`srvany`实用程序注册将用于启动构建过程的Windows服务：
- en: '[PRE33]'
  id: totrans-195
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Configure the service to avoid starting automatically on OS boot:'
  id: totrans-196
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 配置服务以避免在操作系统启动时自动启动：
- en: '[PRE34]'
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Complete the manual build of OpenJDK using the *Building OpenJDK 8 on Windows
    7 SP1* recipe from [Chapter 4](ch04.html "Chapter 4. Building OpenJDK 8"), *Building
    OpenJDK 8*.
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用[第4章](ch04.html "第4章。在Windows 7 SP1上构建OpenJDK 8")中*在Windows 7 SP1上构建OpenJDK
    8*配方完成OpenJDK的手动构建。
- en: How it works...
  id: totrans-199
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In this recipe, we created a virtual machine instance with Windows and configured
    the SSH server to enable seamless automated connections to it.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 在此配方中，我们创建了一个带有Windows的虚拟机实例，并配置了SSH服务器以启用到它的无缝自动化连接。
- en: Binaries of Copssh SSH server Version 3.1.4 were released by the authors as
    free software under the terms of GNU General Public License Version 3\. This means
    that we can publish or use unchanged binaries for any purposes without additional
    licensing limitations.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: Copssh SSH服务器版本3.1.4的二进制文件由作者在GNU通用公共许可证版本3的条款下作为免费软件发布。这意味着我们可以为任何目的发布或使用未经更改的二进制文件，而无需额外的许可限制。
- en: Copssh uses the Cygwin environment and the OpenSSH server under the hood. It
    also provides integration with the Windows user rights system.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: Copssh使用Cygwin环境和OpenSSH服务器作为底层。它还提供了与Windows用户权限系统的集成。
- en: Authorization roles given to the SvcCOPSSH user are required to support the
    SSH key authentication.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 授予SvcCOPSSH用户的授权角色是支持SSH密钥认证所必需的。
- en: We used Cygwin to set up key files to support the proper setting of Cygwin file
    rights.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用Cygwin设置密钥文件以支持Cygwin文件权限的正确设置。
- en: Copssh uses parts of the old version of the Cygwin environment and we need the
    additional full Cygwin installation for the OpenJDK build process. Different Cygwin
    versions running on the same machine might interfere with each other causing errors.
    Although during heavy use of such a setup, I never observed any problems, it is
    better to keep this point in mind for instances of cryptic Cygwin/Copssh errors/crashes.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: Copssh使用了Cygwin环境的旧版本，我们需要额外的完整Cygwin安装来支持OpenJDK构建过程。同一台机器上运行的不同版本的Cygwin可能会相互干扰，导致错误。尽管在重用此类设置期间，我从未观察到任何问题，但最好记住这一点，以防出现神秘的Cygwin/Copssh错误/崩溃。
- en: Two additional Windows users for the SSH server (sshd and SvcCOPSSH) are used
    internally by Copssh.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: Copssh内部使用两个额外的Windows用户（sshd和SvcCOPSSH）用于SSH服务器。
- en: The `ntrighs` utility was used to assign additional roles to the SvcCOPSSH user.
    This utility is not officially supported in the newer versions of Windows but
    should work fine anyway.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`ntrighs`实用程序为SvcCOPSSH用户分配了额外的角色。此实用程序在新版本的Windows中未得到官方支持，但应该仍然可以正常工作。
- en: Windows service registration will be required for automated builds to start
    the actual build process over an SSH connection. For a proper environment setup,
    the build process on Windows should be started from the `cmd.exe` shell (usually
    running a batch file). It cannot be started directly from the SSH session that
    works in the guest Windows machine inside the Cygwin environment. The `instsrv`
    and `ntrighs` utilities allowed us to create a Windows service that will run the
    batch file (that in turn will start the actual build process) on a path preconfigured
    in the registry. This `packt_build` service can be started from the SSH session
    using the `net start` command, effectively starting the build process.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 对于自动化构建，需要 Windows 服务注册来通过 SSH 连接启动实际的构建过程。为了设置适当的环境，Windows 上的构建过程应该从 `cmd.exe`
    shell（通常运行批处理文件）启动。不能直接从在 Cygwin 环境中的客户机 Windows 机器内的 SSH 会话启动。`instsrv` 和 `ntrighs`
    工具允许我们创建一个 Windows 服务，该服务将在注册表中预先配置的路径上运行批处理文件（进而启动实际的构建过程）。这个 `packt_build` 服务可以通过
    `net start` 命令从 SSH 会话启动，从而有效地启动构建过程。
- en: The Manual build was done on this VM to ensure that the environment setup was
    correct.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个虚拟机上进行的手动构建是为了确保环境设置正确。
- en: There's more...
  id: totrans-210
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多...
- en: Other SSH servers can be used in theory, although I am not aware of other free
    (as in "free speech") SSH server implementations for Windows, which support key
    authentication.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上可以使用其他 SSH 服务器，尽管我不了解其他适用于 Windows 的免费（如“言论自由”）SSH 服务器实现，它支持密钥认证。
- en: Other protocols/tools can be used for interaction between the host and guest
    machine instead of OpenSSH.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 可以使用其他协议/工具来代替 OpenSSH 在主机和客户机之间进行交互。
- en: See also
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Building OpenJDK 8 on Windows 7 SP1* recipe from [Chapter 4](ch04.html
    "Chapter 4. Building OpenJDK 8"), *Building OpenJDK 8*
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自第4章 [Building OpenJDK 8](ch04.html "第4章。构建 OpenJDK 8") 的 *在 Windows 7 SP1
    上构建 OpenJDK 8* 脚本
- en: The *Installing Cygwin for Windows builds* recipe from [Chapter 2](ch02.html
    "Chapter 2. Building OpenJDK 6"), *Building OpenJDK 6*
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自第2章 [Building OpenJDK 6](ch02.html "第2章。构建 OpenJDK 6") 的 *为 Windows 构建 Cygwin
    的安装脚本*
- en: The *Installing VirtualBox* recipe
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装 VirtualBox* 脚本'
- en: The *Preparing SSH keys* recipe
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备 SSH 密钥* 脚本'
- en: The Oracle VirtualBox user manual at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VirtualBox 用户手册位于 [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
- en: The Copssh website at [https://www.itefix.net/copssh](https://www.itefix.net/copssh)
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Copssh 网站 [https://www.itefix.net/copssh](https://www.itefix.net/copssh)
- en: Automating builds
  id: totrans-220
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化构建
- en: This recipe joins together all the previous recipes in this chapter. Prepared
    virtual machine images and SSH with key authentication will allow us to build
    OpenJDK in fully automated mode using simple bash scripts without additional tools.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 这个脚本将本章中所有之前的脚本合并在一起。准备好的虚拟机镜像和带有密钥认证的 SSH 将允许我们使用简单的 bash 脚本在完全自动化的模式下构建 OpenJDK，而无需额外的工具。
- en: Getting ready
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, we will require a Linux or Mac OS host machine running.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个脚本，我们需要一个运行 Linux 或 Mac OS 的主机机器。
- en: How to do it...
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点...
- en: 'The following procedure will help us to prepare the Windows virtual machine:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助我们准备 Windows 虚拟机：
- en: Prepare SSH keys as described in the *Preparing SSH keys* recipe in this chapter.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中 *准备 SSH 密钥* 脚本所述准备 SSH 密钥。
- en: Set up the VirtualBox installation and its network settings as described in
    the *Installing VirtualBox* recipe in this chapter.
  id: totrans-227
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章中 *安装 VirtualBox* 脚本所述设置 VirtualBox 安装及其网络设置。
- en: Prepare the virtual machine images as described in the previous recipes in this
    chapter.
  id: totrans-228
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照本章之前 recipes 中所述准备虚拟机镜像。
- en: 'For each VM image, prepare a list of environment variables, which will be used
    by the build script (for example, Windows):'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对于每个 VM 映像，准备一个环境变量列表，这些变量将由构建脚本使用（例如，Windows）：
- en: '[PRE35]'
  id: totrans-230
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Add the snippets from the following steps (steps 6 to 12) to the main build
    script.
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将以下步骤（第6步至第12步）的片段添加到主构建脚本中。
- en: 'Create a virtual machine instance using the `VBoxManage` utility:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用 `VBoxManage` 工具创建虚拟机实例：
- en: '[PRE36]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Start up the virtual machine instance:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动虚拟机实例：
- en: '[PRE37]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Enable remote logging back to the host machine over SSH:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启用通过 SSH 将远程日志记录回主机机器：
- en: '[PRE38]'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Copy the OpenJDK sources into the build VM and start the build:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 OpenJDK 源代码复制到构建 VM 并开始构建：
- en: '[PRE39]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Poll the build machine periodically looking for the `build_finished.flag` file
    that should be created after the build is finished:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定期轮询构建机器，寻找在构建完成后应该创建的 `build_finished.flag` 文件：
- en: '[PRE40]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Copy the build results, stop the logger, shut down the virtual machine instance,
    and unregister it from VirtualBox:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制构建结果，停止记录器，关闭虚拟机实例，并在VirtualBox中注销它：
- en: '[PRE41]'
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'To start the build with the chosen virtual machine image, use the following
    commands:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要使用所选的虚拟机镜像启动构建，请使用以下命令：
- en: '[PRE42]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: After the build is finished, the OpenJDK binaries will be copied back to the
    host machine.
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建完成后，OpenJDK二进制文件将被复制回主机机器。
- en: How it works...
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: We use the low-level VBoxManage tool to manipulate virtual machine instances
    for better control over this process.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用低级VBoxManage工具来操作虚拟机实例，以便更好地控制此过程。
- en: To ensure that the virtual machine instance actually starts, we poll it periodically
    over SSH and stop polling after the first successful connection.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保虚拟机实例实际上启动了，我们通过SSH定期检查它，并在第一次成功连接后停止检查。
- en: For remote logging, we run the `tail -f` process on the build machine that sends
    its output back to the host machine immediately over SSH. We start this process
    with a connection from the host machine in the background using the `nohup` utility
    and write the host process `pid` to the `.pid` file to kill the process after
    the build.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 对于远程记录，我们在构建机器上运行`tail -f`进程，该进程立即通过SSH将输出发送回主机机器。我们使用`nohup`工具在主机机器的背景中使用连接启动此进程，并将主机进程`pid`写入`.pid`文件以在构建后终止进程。
- en: We use `scp` to copy sources to a build machine and commands over SSH to decompress
    the sources and start the build.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用`scp`将源代码复制到构建机器，并使用SSH命令解压缩源代码和启动构建。
- en: After the build is started, we poll the build machine periodically over SSH
    to look for the `build_finished.flag` file that should be created by the build
    script on the build machine.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 构建开始后，我们通过SSH定期检查构建机器，以查找构建脚本应在构建机器上创建的`build_finished.flag`文件。
- en: After the build is finished, we copy OpenJDK binaries back to the host machine
    and shut down the virtual machine instance gracefully before unregistering it.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 构建完成后，我们将OpenJDK二进制文件复制回主机机器，并在注销之前优雅地关闭虚拟机实例。
- en: Different virtual machine configuration and environment options are listed in
    the `.env` file for each virtual machine image. We use the "dot first" syntax
    to import variables from the `env` file to the current shell. This allows us to
    use a generic build script for all virtual machine images.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 每个虚拟机镜像的`.env`文件中列出了不同的虚拟机配置和环境选项。我们使用“点优先”语法从`env`文件导入变量到当前shell。这允许我们为所有虚拟机镜像使用通用的构建脚本。
- en: There's more...
  id: totrans-255
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: This recipe can be seen as a basic example of build automation. Different commands,
    tools, and protocols can be used to achieve the same goal.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 这个脚本可以被视为构建自动化的基本示例。不同的命令、工具和协议可以用来达到相同的目标。
- en: The `build_finished.flag` file (with custom content) can also be used to end
    the build prematurely after the error.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: '`build_finished.flag` 文件（包含自定义内容）也可以在出现错误后提前结束构建。'
- en: See also
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参见
- en: The *Installing VirtualBox* recipe
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*安装VirtualBox* 脚本'
- en: The *Preparing SSH keys* recipe
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备SSH密钥* 脚本'
- en: The *Preparing VirtualBox machines with Linux* recipe
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备带有Linux的VirtualBox机器* 脚本'
- en: The *Preparing VirtualBox machines with Mac OS X* recipe
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备带有Mac OS X的VirtualBox机器* 脚本'
- en: The *Preparing VirtualBox machines with Windows* recipe
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*准备带有Windows的VirtualBox机器* 脚本'
- en: '[Chapter 4](ch04.html "Chapter 4. Building OpenJDK 8"), *Building OpenJDK 8*'
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第4章](ch04.html "第4章。构建OpenJDK 8"), *构建OpenJDK 8*'
- en: The Oracle VirtualBox user manual at [https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Oracle VirtualBox用户手册，[https://www.virtualbox.org/manual/UserManual.html](https://www.virtualbox.org/manual/UserManual.html)
- en: Building cross-platform installers
  id: totrans-266
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建跨平台安装程序
- en: When cloud services became the ubiquitous way to install desktop software, classic
    GUI installers became almost obsolete. Cloud package repositories or stores can
    be much more convenient to install and, in the first place, update the desktop
    application.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 当云服务成为安装桌面软件的普遍方式时，经典的GUI安装程序几乎变得过时。云包仓库或商店可以安装和首先更新桌面应用程序更加方便。
- en: At the same time, GUI installers are still widely used for various free and
    commercial applications. Especially for cross-platform applications, GUI installers
    should show the same behavior on all supported platforms despite not being fully
    native on those platforms. Some applications require complex environment changes
    at the time of installation, for example, registering themselves as Windows services
    or setting environment variables.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，GUI安装程序在许多免费和商业应用程序中仍然被广泛使用。特别是对于跨平台应用程序，尽管在那些平台上不是完全本地的，GUI安装程序应该在所有支持的平台上显示相同的行为。一些应用程序在安装时需要复杂的环境更改，例如，将自己注册为Windows服务或设置环境变量。
- en: In this recipe, we will prepare a cross-platform installer for OpenJDK that
    will work on all supported platforms (Windows, Linux, and Mac OS X). We will use
    a popular open-source installation tool, `IzPack`, written in Java.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，我们将准备一个适用于所有支持平台（Windows、Linux和Mac OS X）的OpenJDK跨平台安装程序。我们将使用一个流行的开源安装工具`IzPack`，它是用Java编写的。
- en: Getting ready
  id: totrans-270
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe we will require the OpenJDK binaries (to wrap into the installer).
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个配方，我们将需要OpenJDK的二进制文件（用于包装到安装程序中）。
- en: How to do it...
  id: totrans-272
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'The following procedure will help us in preparing the installer:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤将帮助我们准备安装程序：
- en: Download IzPack compiler Version 4.3.5 from the IzPack website ([http://izpack.org/](http://izpack.org/))
    and install it.
  id: totrans-274
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从IzPack网站（[http://izpack.org/](http://izpack.org/)）下载IzPack编译器版本4.3.5并安装它。
- en: Download the sample installation config file from the documentation section
    of the Izpack website.
  id: totrans-275
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从Izpack网站的文档部分下载示例安装配置文件。
- en: Move the `jre` directory from the OpenJDK image one level up, next to the `openjdk`
    directory.
  id: totrans-276
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`jre`目录从OpenJDK镜像中上移一级，紧邻`openjdk`目录。
- en: 'Add the `jre` directory to the installer configuration as a "loose" pack using
    the following configuration snippet:'
  id: totrans-277
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下配置片段将`jre`目录添加到安装程序配置中，作为一个“松散”包：
- en: '[PRE43]'
  id: totrans-278
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'Add the `openjdk` directory (that now does not contain JRE) as a normal pack:'
  id: totrans-279
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`openjdk`目录（现在不包含JRE）作为一个普通包添加：
- en: '[PRE44]'
  id: totrans-280
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: Adjust labels, GUI forms, locale, and icons as you like.
  id: totrans-281
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 根据您的喜好调整标签、GUI表单、区域设置和图标。
- en: 'Run the IzPack compiler:'
  id: totrans-282
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行IzPack编译器：
- en: '[PRE45]'
  id: totrans-283
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Put the generated `install.jar` and `jre` directory in the `openjdk-installer`
    directory.
  id: totrans-284
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将生成的`install.jar`和`jre`目录放入`openjdk-installer`目录中。
- en: 'Add the bash/batch script to the `openjdk-installer` directory which will allow
    us to run the installer using the relative path to the `jre` directory:'
  id: totrans-285
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将bash/batch脚本添加到`openjdk-installer`目录中，这将允许我们使用`jre`目录的相对路径来运行安装程序：
- en: '[PRE46]'
  id: totrans-286
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Compress the `openjdk-installer` directory—it now contains the OpenJDK installer.
  id: totrans-287
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 压缩`openjdk-installer`目录——它现在包含OpenJDK安装程序。
- en: How it works...
  id: totrans-288
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: The main feature of our installer is that the installer itself runs on the same
    version of Java that it will install. The `loose="true"` configuration in the
    JRE pack instructs the installer to find this pack on a relative path outside
    of the main installation `.jar` file, without duplicating the contents of the
    `jre` directory.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 我们安装程序的主要特点是安装程序本身运行在它将要安装的相同版本的Java上。JRE包中的`loose="true"`配置指示安装程序在主安装`.jar`文件之外的相对路径上查找此包，而不复制`jre`目录的内容。
- en: There's more...
  id: totrans-290
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更多内容...
- en: The IzPack installer supports a lot of configuration options, we highlighted
    only the basic one in this recipe. Besides the GUI and installation forms customizations,
    the one feature that can be useful, especially for OpenJDK, is running scripts
    at installation time. We can prepare scripts to adjust the environment and add
    them to the corresponding packs using the executable configuration element. On
    simple Unix-like operating systems, such scripts can simply append the `PATH`
    variable changes to `~/.bashrc` or `~/.bash_profile` files. On Windows, utilities
    such as `pathman`, `setx`, and `reg` can be used to adjust the environment variables
    or the Windows Registry.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: IzPack安装程序支持许多配置选项，我们在此配方中仅突出显示了基本选项。除了GUI和安装表单的自定义之外，一个特别有用的功能，特别是对于OpenJDK，是在安装时运行脚本。我们可以准备脚本以调整环境，并使用可执行配置元素将它们添加到相应的包中。在简单的类Unix操作系统上，这样的脚本可以简单地将`PATH`变量更改追加到`~/.bashrc`或`~/.bash_profile`文件中。在Windows上，可以使用`pathman`、`setx`和`reg`等实用程序来调整环境变量或Windows注册表。
- en: Instead of running scripts at the time of installation, you can extend the IzPack
    itself (adding new forms, and so on) and perform environment registration directly
    from Java code.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装时运行脚本，而不是直接从Java代码中扩展IzPack本身（添加新表单等）并直接执行环境注册。
- en: See also
  id: totrans-293
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参考信息
- en: '[Chapter 2](ch02.html "Chapter 2. Building OpenJDK 6"), *Building OpenJDK 6*'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第2章](ch02.html "第2章. 构建OpenJDK 6"), *构建OpenJDK 6*'
- en: '[Chapter 3](ch03.html "Chapter 3. Building OpenJDK 7"), *Building OpenJDK 7*'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第3章](ch03.html "第3章. 构建OpenJDK 7"), *构建OpenJDK 7*'
- en: '[Chapter 4](ch04.html "Chapter 4. Building OpenJDK 8"), *Building OpenJDK 8*'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[第4章](ch04.html "第4章. 构建OpenJDK 8"), *构建OpenJDK 8*'
- en: The IzPack installer website at [http://izpack.org/](http://izpack.org/)
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: IzPack安装程序网站位于[http://izpack.org/](http://izpack.org/)
