<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Creating Step Definitions" id="aid-OPEK1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Creating Step Definitions</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Creating your first Step Definitions file</li><li class="listitem">Identifying duplicate and Ambiguous Step Definitions</li><li class="listitem">Using regular expressions to optimize Step Definitions</li><li class="listitem">Using Optional Capture/Noncapture groups</li><li class="listitem">Transforming Data Tables to parse the test data</li><li class="listitem">Implementing Data Table diffs to compare tables</li><li class="listitem">Using Doc Strings to parse big data as one chunk</li><li class="listitem">Combining Doc Strings and Scenario Outlines</li><li class="listitem">Defining String transformations for better conversions</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Introduction</h1></div></div></div><p>Sometimes people who are not that well versed in Cucumber argue that creating a Step Definitions file is an overhead as compared to the frameworks that do not have Cucumber. But what they don't realize is that Cucumber auto-generates these Step Definitions, so it's not an overhead. With the knowledge of the concepts covered in this chapter, you will be able to write very effective and efficient Step Definitions.</p><p>In this chapter, we will start with the basic concepts of Glue Code/Step Definitions in detail by covering the different types of Step Definitions, the usage of regular expressions, and so on. To come up with optimized and efficient Step Definitions, we will also elaborate upon advanced concepts of Doc Strings, Data Table transformations, and Capture groups.</p></div></div>
<div class="section" title="Creating your first Step Definitions file"><div class="titlepage" id="aid-PNV62"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Creating your first Step Definitions file</h1></div></div></div><p>Now let's<a id="id79" class="indexterm"/> assume you are an automation developer and you have to implement automated test cases for a Feature file. The next Step in this direction would be to write the Step Definitions for this Feature file. So, how do we write Step Definitions in a Cucumber project? Let's see how to do this in this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>How to do it…</h2></div></div></div><p>The easiest way to create Step Definitions is to let Cucumber take care of it. The Steps are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Here is the Feature file used in our previous chapter. Let's use this Feature file to create our first Step Definitions:<div class="informalexample"><pre class="programlisting">Feature: login Page
  In order to test login page
  As a Registered user
  I want to specify the login conditions

  Scenario: checking pre-condition, action and results
    Given user is on Application landing page
    When user clicks Sign in button
    Then user is on login screen</pre></div></li><li class="listitem">When you save the Feature file and run (either via Eclipse or via a Terminal), Cucumber is going to give errors for the missing Step Definition files along with suggestions for Step Definitions. An example of the errors shown in Eclipse is seen in the following screenshot:<div class="mediaobject"><img src="../Images/image00125.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Notice the suggestion given by Cucumber (highlighted in the preceding screenshot). As per Cucumber, all the Steps are in an <span class="strong"><strong>undefined</strong></span> state as of now.</li><li class="listitem">Copy the<a id="id80" class="indexterm"/> suggestions given by Cucumber and paste them to a default Step Definition file.<div class="note" title="Note"><h3 class="title"><a id="note10"/>Note</h3><p>Remember to give the path of the Step Definitions files to the Cucumber Options class.</p></div></li><li class="listitem">This is how our <code class="literal">LoginSteps.java</code> class will look:<div class="informalexample"><pre class="programlisting">package com.StepDefinitions;

import cucumber.api.PendingException;
import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class LoginSteps {

  @Given("^user is on Application landing page$")
  public void user_is_on_Application_landing_page() throws Throwable {
        /* Write code here that turns the phrase above into 
           concrete actions*/
    throw new PendingException();
  }

  @When("^user clicks Sign in button$")
  public void user_clicks_Sign_in_button() throws Throwable {
        /*Write code here that turns the phrase above into 
            concrete actions */
    throw new PendingException();
  }

  @Then("^user is on login screen$")
  public void user_is_on_login_screen() throws Throwable {
        /* Write code here that turns the phrase above into 
            concrete actions */
    throw new PendingException();
  }
}</pre></div></li><li class="listitem">Now, run the<a id="id81" class="indexterm"/> Feature file again and look at the Cucumber output:<div class="mediaobject"><img src="../Images/image00126.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now our Scenario state has changed from <span class="strong"><strong>undefined</strong></span> to <span class="strong"><strong>pending</strong></span>. Refer to the highlighted area in the preceding screenshot. Cucumber suggests that we add the implementation to the pending Steps.</li><li class="listitem">We will delete<a id="id82" class="indexterm"/> the throw statements from our class and replace them with some dummy code. You can call the actual automation code (either Selenium functions for websites or HTTPClient functions for <a id="id83" class="indexterm"/>service-oriented architecture (SOA) automation). Here is what our <code class="literal">LoginSteps.java</code> class looks like:<div class="informalexample"><pre class="programlisting">package com.StepDefinitions;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class LoginSteps {

  @Given("^user is on Application landing page$")
  public void user_is_on_Application_landing_page() throws Throwable {
    //sample code goes here
    System.out.println("Given");
  }

  @When("^user clicks Sign in button$")
  public void user_clicks_Sign_in_button() throws Throwable {
    //sample Code goes here
    System.out.println("When");
  }

  @Then("^user is on login screen$")
  public void user_is_on_login_screen() throws Throwable {
    //sample Code goes here
    System.out.println("Then");
  }
}</pre></div></li><li class="listitem">Now, execute the Feature file again and observe the Cucumber output:<div class="mediaobject"><img src="../Images/image00127.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Now the Cucumber output has changed and the status of our Steps has changed from <span class="strong"><strong>pending</strong></span> to <span class="strong"><strong>passed</strong></span>; also, the output of each function called in each Step has also <a id="id84" class="indexterm"/>been printed.<div class="note" title="Note"><h3 class="title"><a id="note11"/>Note</h3><p>Whether a Step Definitions was created with the annotations <code class="literal">@Given</code>, <code class="literal">@When</code>, or <code class="literal">@Then</code>, a Step Definitions will match any Gherkin Step as long as the regular expression matches the main text of the Step. For example, <code class="literal">Given I have 100 in my account</code> and <code class="literal">When I have 100 in my account</code> will be matched to <code class="literal">@Given("^I have (.*?) in my account$")</code>.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>How it works…</h2></div></div></div><p>Now let's understand each Step performed in the previous section in more detail to get a better understanding of the concept of Step Definitions:</p><div class="section" title="Step Definitions"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Step Definitions</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">When Cucumber starts execution, it looks for all classes on the Classpath that are in a specified glue package (or descendant).</li><li class="listitem">A Step Definitions is a small piece of code with a pattern attached to it. The pattern is used to link the Step Definitions to all the matching Steps, and the code is what Cucumber will execute when it sees a Gherkin Step.</li><li class="listitem">We use Cucumber annotations, such as <code class="literal">@Given</code>, <code class="literal">@When</code>, and <code class="literal">@Then</code> to create Step Definitions.</li><li class="listitem">In the Step <code class="literal">Given user is on Application landing page</code>, the text after the <code class="literal">Given</code> keyword (<code class="literal">user is on Application landing page</code>) is what Cucumber matches in the Step Definitions file <span class="strong"><strong>(@Given("^user is on Application landing page$"))</strong></span>. And when Cucumber finds a match, it executes the<a id="id85" class="indexterm"/> function mentioned within that Step.</li></ul></div></div><div class="section" title="Undefined Steps"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec05"/>Undefined Steps</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a id="id86" class="indexterm"/>When we first executed the Feature file, Cucumber did not find any matching Step Definitions, that's why Cucumber gave us <span class="strong"><strong>Undefined Steps Error</strong></span>.</li><li class="listitem">Cucumber will also give its own Suggestion for getting rid of Undefined Steps. All subsequent Steps after Undefined Step in the Scenario are skipped and Scenario is marked as Fail.</li></ul></div></div><div class="section" title="Pending Steps"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Pending Steps</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a id="id87" class="indexterm"/>When we use the code suggested by Cucumber in our Step Definition file, and we run the Feature file then we get Pending Steps Exception.</li><li class="listitem">Pending Steps Exception is because of following Code:<div class="informalexample"><pre class="programlisting">throw new PendingException();</pre></div></li><li class="listitem">When Cucumber encounters this statement, it understands that these Steps are still a work in progress Step.</li><li class="listitem">Status of the Scenario is pending, First Step having <code class="literal">PendingException()</code> will be marked as pending and all other Steps in that Scenario are skipped.</li></ul></div></div><div class="section" title="Implemented Steps"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec07"/>Implemented Steps</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">When we replace<a id="id88" class="indexterm"/> the throw command with functional code, the pending exception error goes away.</li><li class="listitem">Now, the status of the Steps will depend on the code being executed in that Step.</li></ul></div></div></div></div>
<div class="section" title="Identifying Duplicate and Ambiguous Step Definitions" id="aid-QMFO1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Identifying Duplicate and Ambiguous Step Definitions</h1></div></div></div><p>Sometimes when <a id="id89" class="indexterm"/>we are writing Cucumber Step Definitions<a id="id90" class="indexterm"/> files, we get either Duplicate Step Definitions errors or Ambiguous Step Definitions errors. Let's try and understand the reasons why these errors arise, and how we can remove them through this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>How to do it…</h2></div></div></div><p>We will use the same Feature file from previous recipe. Perform the following Steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's create <a id="id91" class="indexterm"/>one more class in the <code class="literal">StepDefinitions</code> package, called <code class="literal">DuplicateAmbiguous.java</code>, with the following content:<div class="informalexample"><pre class="programlisting">package com.StepDefinitions;

import cucumber.api.java.en.Given;

public class DuplicateAmbiguous {
  
  //Duplicate Steps
  @Given("^user is on Application landing page$")
  public void user_is_on_Application_landing_page_duplicate() throws Throwable {
    //sample code goes here
    System.out.println("Duplicate");
  }

}</pre></div><p>When you try<a id="id92" class="indexterm"/> to run the Feature file, observe the Cucumber output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Exception in thread "main" cucumber.runtime.DuplicateStepDefinitionException: Duplicate Step Definitions in com.StepDefinitions.DuplicateAmbiguous.user_is_on_Application_landing_page_duplicate() in file:/C:/Users/user/Documents/Xebia/Docs/cucumber/Book/Project/target/test-classes/ and com.StepDefinitions.LoginSteps.user_is_on_Application_landing_page() in file:/C:/Users/user/Documents/Xebia/Docs/cucumber/Book/Project/target/test-classes/</strong></span>
<span class="strong"><strong>  at cucumber.runtime.RuntimeGlue.addStepDefinition(RuntimeGlue.java:33)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.java.JavaBackend.addStepDefinition(JavaBackend.java:153)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.java.MethodScanner.scan(MethodScanner.java:68)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.java.MethodScanner.scan(MethodScanner.java:41)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.java.JavaBackend.loadGlue(JavaBackend.java:89)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.Runtime.&lt;init&gt;(Runtime.java:90)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.Runtime.&lt;init&gt;(Runtime.java:68)</strong></span>
<span class="strong"><strong>  at cucumber.runtime.Runtime.&lt;init&gt;(Runtime.java:64)</strong></span>
<span class="strong"><strong>  at cucumber.api.cli.Main.run(Main.java:35)</strong></span>
<span class="strong"><strong>  at cucumber.api.cli.Main.main(Main.java:18)</strong></span>
</pre></div></li><li class="listitem">Cucumber<a id="id93" class="indexterm"/> gives us a Duplicate Step Definitions error stating that there are two Step Definitions that are an exact match.</li><li class="listitem">Let's change<a id="id94" class="indexterm"/> the content of <code class="literal">DuplicateAmbiguous.java</code> to the following code:<div class="informalexample"><pre class="programlisting">package com.StepDefinitions;

import cucumber.api.java.en.Given;

public class DuplicateAmbiguous {
  
  //Ambiguous Steps
  @Given("^user is on (.*?) page$")
  public void user_is_on_Application_landing_page_ambiguous() throws Throwable {
      //sample code goes here
    System.out.println("Duplicate");
  }

}</pre></div></li><li class="listitem">Now run the Feature file and observe the Cucumber output:<div class="informalexample"><pre class="programlisting">  Scenario: checking pre-condition, action and results # C:/Users/user/Documents/Xebia/Docs/cucumber/Book/Project/src/test/java/com/features/login.feature:6
    Given user is on Application landing page          # DuplicateAmbiguous.user_is_on_Application_landing_page_ambiguous()
<span class="strong"><strong>      cucumber.runtime.AmbiguousStepDefinitionsException: ✽.Given user is on Application landing page(C:/Users/user/Documents/Xebia/Docs/cucumber/Book/Project/src/test/java/com/features/login.feature:7) matches more than one Step Definition:</strong></span>
<span class="strong"><strong>        ^user is on (.*?) page$ in DuplicateAmbiguous.user_is_on_Application_landing_page_ambiguous()</strong></span>
<span class="strong"><strong>        ^user is on Application landing page$ in LoginSteps.user_is_on_Application_landing_page()</strong></span>
<span class="strong"><strong>     </strong></span>
<span class="strong"><strong>        at cucumber.runtime.RuntimeGlue.stepDefinitionMatch(RuntimeGlue.java:71)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.Runtime.runStep(Runtime.java:265)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.model.StepContainer.runStep(StepContainer.java:44)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.model.StepContainer.runSteps(StepContainer.java:39)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.model.CucumberScenario.run(CucumberScenario.java:48)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.model.CucumberFeature.run(CucumberFeature.java:163)</strong></span>
<span class="strong"><strong>        at cucumber.runtime.Runtime.run(Runtime.java:120)</strong></span>
<span class="strong"><strong>        at cucumber.api.cli.Main.run(Main.java:36)</strong></span>
<span class="strong"><strong>        at cucumber.api.cli.Main.main(Main.java:18)</strong></span>

    When user clicks Sign in button                    # LoginSteps.user_clicks_Sign_in_button()
    Then user is on login screen                       # LoginSteps.user_is_on_login_screen()

1 Scenarios (1 failed)
3 Steps (1 failed, 2 skipped)
0m0.000s</pre></div></li><li class="listitem">Here, Cucumber<a id="id95" class="indexterm"/> throws the Ambiguous Steps error and is not able to decide which Step Definitions to use, as the two Step Definitions are a partial match.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How it works…</h2></div></div></div><p>Since Cucumber-JVM looks for all classes on the Classpath that are in a specified glue package (or descendant), so there are chances that we might have some duplication (partial/exact) in Step Definitions. Let's understand this in more detail<a id="id96" class="indexterm"/>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Duplicate Steps</strong></span>: When Cucumber encounters multiple Step Definitions that are exactly the same, it throws a Duplicate Step Definitions exception.</li><li class="listitem"><span class="strong"><strong>Ambiguous Steps</strong></span>: When Cucumber <a id="id97" class="indexterm"/>encounters multiple Step Definitions that are a partial match, it throws an Ambiguous Step Definitions exception.</li></ul></div><p>If Cucumber encounters duplicate/Ambiguous Steps, all the other Steps of such Scenarios are skipped and those Scenarios are marked as Fail.</p><p>Cucumber even specifies the two instances that are causing the error (refer to the highlighted code in the Cucumber output shown in Step 4 of this recipe).</p><p>In one execution, only the first two occurrences of the erroneous Steps are identified; if there are more duplicate occurrences of the same Step, then these will be identified in the next execution.</p><div class="note" title="Note"><h3 class="title"><a id="tip03"/>Tip</h3><p>To check that there are no errors or exceptions in the Step Definitions, run Feature files with <code class="literal">dryRun = true</code> and <code class="literal">strict=true</code> in the Cucumber Options class. This will only check the validity of the Step Definitions and will not execute the code within them. We will read about these options in detail in later chapters.</p></div></div></div>
<div class="section" title="Using Regular Expressions to optimize Step Definitions" id="aid-RL0A1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Using Regular Expressions to optimize Step Definitions</h1></div></div></div><p>Until now, we have created Step Definitions with one-to-one relations with Steps. But this way of writing Step Definitions can be cumbersome as we write more and more Feature files. So, we will write generic Step Definitions that will apply to all the Steps that follow a certain pattern, thus<a id="id98" class="indexterm"/> bringing down the number of Step Definitions required. Let's see how to do this in this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's assume we are writing Step Definitions for the following Scenario.<div class="informalexample"><pre class="programlisting">Scenario: login fail - wrong username
    Given user is displayed login screen
    When user enters <span class="strong"><strong>"wrongusername"</strong></span> in username field
    And user enters <span class="strong"><strong>"123456"</strong></span> in password field
    And user clicks Sign in button</pre></div></li><li class="listitem">Now run the<a id="id99" class="indexterm"/> Feature file, and <a id="id100" class="indexterm"/>copy and paste the Cucumber Step Definitions suggestions in the <code class="literal">LoginSteps.java</code> class. This is how <code class="literal">LoginSteps.java</code> looks:<div class="informalexample"><pre class="programlisting">package com.StepDefinitions;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.When;

public class LoginSteps {

  @Given("^user is displayed login screen$")
  public void user_is_displayed_login_screen()  {
  }

<span class="strong"><strong>  @When("^user enters \"(.*?)\" in username field$")</strong></span>
<span class="strong"><strong>  public void user_enters_in_username_field(String username) {</strong></span>
<span class="strong"><strong>    System.out.println(username);</strong></span>
<span class="strong"><strong>  }</strong></span>

<span class="strong"><strong>  @When("^user enters \"(.*?)\" in password field$")</strong></span>
<span class="strong"><strong>  public void user_enters_in_password_field(String password)  {</strong></span>
<span class="strong"><strong>    System.out.println(password);</strong></span>
<span class="strong"><strong>  }</strong></span>
  @When("^user clicks Sign in button$")
  public void user_clicks_Sign_in_button() {
  }
}</pre></div></li><li class="listitem">Focus on the Step Definitions mentioned in bold in the preceding code sample. We have used regular expressions and enabled a single Step Definitions to match various Steps, which matches the wildcard pattern mentioned.</li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>How it works…</h2></div></div></div><p>Cucumber allows us to use regular expressions to empower Step Definitions to match multiple Steps. Let's understand<a id="id101" class="indexterm"/> how this works:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>Capture groups:</strong></span><p>When <a id="id102" class="indexterm"/>you surround part of a regular expression with parentheses, it becomes a capture group. In a Cucumber Step Definitions, the text matched within each capture group is passed to the code block as an argument.</p><p>For example in 2nd Step Definition Capture group is <code class="literal">wrongusername</code> and it will be passed to variable username. Similarly in 3rd Step Definition Capture Group is <code class="literal">password</code> and it will be passed to variable password.</p><p>For statically typed languages, Cucumber will automatically transforms those Strings into the appropriate type. For dynamically typed languages, no transformation happens by default, as there is no type information.</p></li><li class="listitem">Cucumber also allows integers to be passed in Capture groups.<p>For example, consider the following Step:</p><div class="informalexample"><pre class="programlisting">Given I have 58 Dollars in my account</pre></div><p>For this Step, the Step Definitions will look like this (focus on the highlighted code):</p><div class="informalexample"><pre class="programlisting">@Given("I have <span class="strong"><strong>(\\d+)</strong></span> Dollars in my account")
  public void I_have_dollar_acnt(<span class="strong"><strong>int dollar</strong></span>) {
    // Do something with the dollars
  }</pre></div></li><li class="listitem">Cucumber also allows Lists to be passed in Capture groups.<p>For example, consider the following Step:</p><div class="informalexample"><pre class="programlisting">Given I am available on "Tuesday,Friday,Sunday"</pre></div><p>Step Definition will look like this, focus on the highlighted code:</p><div class="informalexample"><pre class="programlisting">@Given("^I am available on \"(.+)\"$")
public void i_am_available_on(List&lt;String&gt; days)  {
System.out.println(days.size());
}</pre></div></li></ul></div><p>The following are some<a id="id103" class="indexterm"/> types of regular expressions available in Cucumber:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>. Dot</strong></span> means match<a id="id104" class="indexterm"/> any single character.</li><li class="listitem"><span class="strong"><strong>* Star</strong></span>, a repetition modifier, takes a character and tells us how many times it can reappear.</li><li class="listitem"><span class="strong"><strong>+ Plus</strong></span>, a repetition modifier, takes a character and tells us that the character can be repeated at least once.</li><li class="listitem"><span class="strong"><strong>\d</strong></span> stands for diGitHub, or [0-9].</li><li class="listitem"><span class="strong"><strong>\w</strong></span> stands for a word character, specifically [A-Za-z0-9_].</li><li class="listitem"><span class="strong"><strong>\s</strong></span> stands for a whitespace character, including tab space or line break.<div class="note" title="Note"><h3 class="title"><a id="note12"/>Note</h3><p>You can also negate shorthand character classes by capitalizing them; for example, <code class="literal">\D</code> refers to any character except a diGitHub.</p></div></li></ul></div></div></div>
<div class="section" title="Using Optional Capture and Noncapture Groups" id="aid-SJGS1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Using Optional Capture and Noncapture Groups</h1></div></div></div><p>Until now, we have<a id="id105" class="indexterm"/> covered how to write Step Definitions for various keywords in Feature files. Now let's talk about how we can efficiently use Step Definitions for multiple Steps.</p><p>Think about a situation<a id="id106" class="indexterm"/> where we are testing a positive situation in one Step and a negative situation in some other Step—the only difference in both Steps is just the word "No", while the remaining sentence is same. Based on the knowledge that we have acquired so far, we will write two Step Definitions for these two Steps. But is there a better way of doing this? Let's see how we can do this better in this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this recipe, consider the following Scenarios and focus on the highlighted text:<div class="informalexample"><pre class="programlisting">Scenario: <span class="strong"><strong>Optional Capture Groups/Alternation</strong></span>
    #positive
    Then I <span class="strong"><strong>see</strong></span> following dollars in my account
    #negative
    Then I <span class="strong"><strong>do not see</strong></span> following dollars in my account
   
    Scenario: <span class="strong"><strong>Optional Non capture Groups</strong></span>
    Given <span class="strong"><strong>I have</strong></span> following dollars in my account
    Given <span class="strong"><strong>He has</strong></span> following dollars in my account
    Given <span class="strong"><strong>User has</strong></span> following dollars in my account</pre></div><p>Use the following<a id="id107" class="indexterm"/> Step Definitions for both Scenarios and focus on the code that is highlighted:</p><div class="informalexample"><pre class="programlisting">@Then("^I<span class="strong"><strong>( do not see| see)</strong></span> following dollars in my account$")
public void I_see_or_do_not_see_following_dollars_in_my_account(<span class="strong"><strong>String seeOrDoNotSee</strong></span>) {
    //print the value of capture group
System.out.println(<span class="strong"><strong>seeOrDoNotSee</strong></span>);
}
  
@Given<span class="strong"><strong>("^(?:I have|He has|User has)</strong></span> following dollars in my account$")
public void have_following_dollars_in_my_account() {
    
    // Non Capture groups are not captured in Step
}</pre></div></li><li class="listitem">Now run the Scenarios; you will see the following output:<div class="mediaobject"><img src="../Images/image00128.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works…</h2></div></div></div><p>An Optional Capture group eliminates the duplication of Step Definitions and can definitely improve the readability of Feature files. Using optional groups, the same Step Definitions can be used<a id="id108" class="indexterm"/> for both positive and negative assertions. Let's discuss this in more detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Optional Capture group/alternation:<p>The use of a pipe between parentheses creates an optional group (<code class="literal">Text1|Text 2</code>). Here, more than two options can also be grouped. In this example, Steps with either <code class="literal">Text1</code> or <code class="literal">Text2</code> will be accepted by this Step Definitions, and accordingly, <code class="literal">Text1</code> or <code class="literal">Text2</code> will be passed as the Capture value.</p></li><li class="listitem">Optional <a id="id109" class="indexterm"/>Noncapture group:<p>The addition of <code class="literal">?:</code> to the beginning of Optional Capture groups creates optional non-Capture groups. Having <code class="literal">?:</code> will treat the group as optional , but it<a id="id110" class="indexterm"/> will not be captured. So, you do not need to pass an argument as described earlier with optional captured groups.</p></li></ul></div></div></div>
<div class="section" title="Transforming Data Tables to parse the test data" id="aid-TI1E1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Transforming Data Tables to parse the test data</h1></div></div></div><p>In the previous <a id="id111" class="indexterm"/>chapter, we covered how Data Tables<a id="id112" class="indexterm"/> can be used to send large sets of data to a single Step. Now let's understand how to handle Data Tables in Step Definitions in this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's assume we are writing Step Definitions for the following Scenario:<div class="informalexample"><pre class="programlisting">Scenario: Existing user Verification
    Given user is displayed login screen
    Then we verify following user exists
      | Name    | Email           |
      | Shankar | sgarg@email.com |
      | Ram     | ram@email.com   |
      | Sham    | sham@email.org  |</pre></div></li><li class="listitem">Now run the Feature file, and copy paste the Cucumber Step Definitions suggestions in the <code class="literal">LoginSteps.java</code> class. These are the additional Steps in <code class="literal">LoginSteps.java</code>:<div class="informalexample"><pre class="programlisting">@Then("^we verify following user exists$")
public void we_verify_following_user_exists(<span class="strong"><strong>DataTable arg1</strong></span>) throws Throwable {
    /* Write code here that turns the phrase above into 
    concrete actions
    For automatic transformation, change DataTable to 
    one of List&lt;YourType&gt;, List&lt;List&lt;E&gt;&gt;, 
    List&lt;Map&lt;K,V&gt;&gt; or Map&lt;K,V&gt;.
    E,K,V must be a scalar (String, Integer, Date, 
    enum etc) */
    throw new PendingException();
  }</pre></div></li><li class="listitem">Here, Cucumber passed<a id="id113" class="indexterm"/> the table as <code class="literal">DataTable</code> to the Step argument. Focus on the suggestion given by Cucumber to convert the table to a List or a List of Lists and so<a id="id114" class="indexterm"/> on.</li><li class="listitem">Now, replace the code suggestion given by Cucumber with the following code:<div class="informalexample"><pre class="programlisting">@Then("^we verify following user exists$")
public void we_verify_following_user_exists(DataTable userDetails) {

  List&lt;List&lt;String&gt;&gt; details = userDetails.raw();

  for (int i = 0; i &lt; details.size(); i++) {
    for (int j = 0; j &lt; details.get(i).size(); j++) {
    System.out.println(details.get(i).get(j));
    }
  }
}</pre></div><p>Here, we have used the <code class="literal">raw()</code> method of the Cucumber DataTable API to convert the Data Table into a List of List of Strings. After that, we have used two <code class="literal">for</code> loops to traverse all the elements of the List of List of Strings. This is how the Cucumber output looks:</p><div class="mediaobject"><img src="../Images/image00129.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How it works…</h2></div></div></div><p>Data Tables are passed to the Step Definitions as the last argument. We need to import <code class="literal">cucumber.api.DataTable</code> into Java code. DataTable API's <code class="literal">raw()</code> method is used to convert a Data Table to a List of List of String.</p><p>We can also <a id="id115" class="indexterm"/>convert a Data Table to various types of Lists. Let's see what we can do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><span class="strong"><strong>A List of user-defined variables</strong></span>:<p>Let's define a custom class called <code class="literal">User</code>, which has name and email as data members. The header row is used to name fields in a generic List type:</p><div class="informalexample"><pre class="programlisting">public class User {
    public String name;
    public String email;
  }</pre></div><p>Now, its Step Definitions can be like this:</p><div class="informalexample"><pre class="programlisting">@Then("^we verify following user exists$")
public void we_verify_following_user_exists(List&lt;User&gt; userList) {
    for (User u : userList) {
      System.out.println(u.name);
    }
  }</pre></div><p>This Step Definitions will accept a List with objects as users (which is custom defined by us) and will print the names of users.</p></li><li class="listitem"><span class="strong"><strong>A List of maps</strong></span>:<p>Using the <code class="literal">User</code> class defined in the previous Step, the Step Definitions can be like this:</p><div class="informalexample"><pre class="programlisting">@Then("^we verify following user exists$")
public void we_verify_following_user_exists(List&lt;Map&lt;String, String&gt;&gt; userList) {
    for (Map&lt;String, String&gt; u : userList) {
      System.out.println(u.get("Name"));
    }
  }</pre></div><p>The Data Table is converted to the following List of maps:</p><div class="informalexample"><pre class="programlisting">{Name=Shankar, Email=sgarg@email.com}
{Name=Ram, Email=ram@email.com}
{Name=Sham, Email=sham@email.org}</pre></div><div class="note" title="Note"><h3 class="title"><a id="tip04"/>Tip</h3><p>If you're converting a Data Table into a map, it is usually advisable not to have a top row naming the columns in the Gherkin table.</p></div></li><li class="listitem"><span class="strong"><strong>List of List </strong></span><a id="id116" class="indexterm"/><span class="strong"><strong>of scalar:</strong></span><p>Using the <code class="literal">User</code> class defined in the previous Step, the Step Definitions can be<a id="id117" class="indexterm"/> presented as follows:</p><div class="informalexample"><pre class="programlisting">@Then("^we verify following user exists$")
public void we_verify_following_user_exists(List&lt;List&lt;String&gt;&gt; userList) {
    for (List&lt;String&gt; u : userList) {
      System.out.println(u);
    }
  }</pre></div><p>The Data Table is converted to the following Lists:</p><div class="informalexample"><pre class="programlisting">[Name, Email]
[Shankar, sgarg@email.com]
[Ram, ram@email.com]
[Sham, sham@email.org]</pre></div></li></ul></div></div></div>
<div class="section" title="Implementing data table diffs to compare tables" id="aid-UGI01"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Implementing data table diffs to compare tables</h1></div></div></div><p>Consider a situation where you need to<a id="id118" class="indexterm"/> verify an application response that is in the form of Table to another Data Table that we are sending in Feature file. This kind of verification is very common when we are testing REST services.</p><p>Based on what we <a id="id119" class="indexterm"/>have learned so far, we will break the Data Table down in the Feature file into a List of Lists, and then we will verify each element of those Lists with expected Lists (which we got after breaking the table). Let's understand how we can do this in an easier way.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this recipe, consider the following Scenario:<div class="informalexample"><pre class="programlisting">  Scenario: Table Diff
    Given user send a get request to "localhost:8080/e"
    Then user gets following response
      | username | age |
      | sham     | 25  |
      | ram      | 26  |</pre></div></li><li class="listitem">Now save the Feature file. After adding the following code to suggestions, this is how our<a id="id120" class="indexterm"/> Step Definitions <a id="id121" class="indexterm"/>will look:<div class="informalexample"><pre class="programlisting">@Given("^user send a get request to \"(.*?)\"$")
public void user_send_a_get_request_to(String arg1) {
    // lets assume user sends a get request
  }

@Then("^user gets following response$")
public void user_gets_following_response(DataTable expectedUsers) {
    
    /* lets create a table for system response 
    (actualUsers) */
    List&lt;List&lt;String&gt;&gt; actualUsers = new ArrayList&lt;List&lt;String&gt;&gt;();
    actualUsers.add( Arrays.asList("username", "age"));
    actualUsers.add( Arrays.asList("sham", "25"));
    actualUsers.add( Arrays.asList("ram", "26"));
    
    /* Use the diff method to differentiate two data 
    tables */
<span class="strong"><strong>    expectedUsers.diff(actualUsers);</strong></span>
  }</pre></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>How it works…</h2></div></div></div><p>We can compare a table argument (the actual result) to another table that we provide within the Step Definitions (the expected result).</p><p>Both the tables should be in a certain format for it to work properly. Both tables should be column-oriented, and the first row of both tables should represent the column names. The column names must be unique for each column and they must match.</p><p>If the tables are different, an exception is thrown, and the difference between the two tables is reported in the execution report. Its output will look like this:</p><div class="mediaobject"><img src="../Images/image00130.jpeg" alt="How it works…"/></div><p style="clear:both; height: 1em;"> </p><p>Rows that differ from<a id="id122" class="indexterm"/> what was expected will be printed twice—the first (preceded by a "<code class="literal">-</code>") is what was expected, followed by<a id="id123" class="indexterm"/> another (preceded by a "<code class="literal">+</code>"), which is what was actually returned.</p></div></div>
<div class="section" title="Using Doc Strings to parse big data as one chunk" id="aid-VF2I1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Using Doc Strings to parse big data as one chunk</h1></div></div></div><p>Now let's consider a situation where we have to specify a lot of text in multiple lines (not in the shape of a table)—something like a few lines from a blog or a book. So, how do we handle this in Step Definitions? This is called passing Doc Strings in test Steps. Based on what we have covered until now, we can use regular expressions; but this is helpful for the first line only, and the text in all the other lines will be missed. In this recipe, let's see how to handle this situation.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's consider the following Step in our Feature file for this exercise:<div class="informalexample"><pre class="programlisting">Given a book named "cucumber cookbook" with following body
<span class="strong"><strong>  """</strong></span>
<span class="strong"><strong>  Title – Cucumber cookbook</strong></span>
<span class="strong"><strong>  Author of this book is first time writer so please excuse the naïve mistakes. But he will definitely improve with chapters he writes.</strong></span>
<span class="strong"><strong>  """</strong></span>
</pre></div><p>Here, the highlighted text is the Doc String that we will be passing to the Step Definitions.</p></li><li class="listitem">Save and run the Feature file, and copy and paste the Cucumber suggestion for the missing Step Definitions. After adding the print statements, this is how our code will look:<div class="informalexample"><pre class="programlisting">@Given("^a book named \"(.*?)\" with following body$")
public void a_book_named_with_following_body(String arg1, String arg2) {
    //prints the regular expression
    System.out.println(arg1);

<span class="strong"><strong>    //prints the Doc String</strong></span>
<span class="strong"><strong>    System.out.println(arg2);</strong></span>
<span class="strong"><strong>  }</strong></span>
</pre></div></li><li class="listitem">This is the <a id="id124" class="indexterm"/>output of the preceding code:<div class="mediaobject"><img src="../Images/image00131.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>How it works…</h2></div></div></div><p>When writing Feature files, Doc Strings should be within three adjacent quotes <code class="literal">"""</code> at the beginning and three at the end.</p><p>In Step Definitions, you don't have to do anything special for Doc Strings, as the text within triple quotes (<code class="literal">"""</code>) will be passed as the last argument to the Step Definitions. In our code, we have also used one regular expression for the text <code class="literal">Cucumber Cookbook</code>, but not for the Doc String as the Doc String was passed to the last argument of the Step.</p><div class="note" title="Note"><h3 class="title"><a id="tip05"/>Tip</h3><p>Indentation of the opening """ is unimportant, although common practice is to put it two spaces in from the enclosing Step. Each line of the String passed in the Doc String will be realigned to the indentation of the opening """.</p></div></div></div>
<div class="section" title="Combining Doc Strings and Scenario Outlines" id="aid-10DJ41"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Combining Doc Strings and Scenario Outlines</h1></div></div></div><p>Now think of a situation where you are passing a Doc String but you have to combine that with a Scenario Outline. How does Cucumber behave in such a situation?</p><p>Let's think of a<a id="id125" class="indexterm"/> situation where we are specifying the requirements for the content of an e-mail, but the content is based on the role from which the e-mail is sent. So how do we specify such a requirement in a Feature file and how do we write<a id="id126" class="indexterm"/> the Step Definitions for it? Let's find out in this recipe.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this recipe, let's consider this Scenario:<div class="informalexample"><pre class="programlisting">Scenario Outline: E-mail content verification
<span class="strong"><strong>    Given I have a user account with &lt;Role&gt; rights</strong></span>
<span class="strong"><strong>    Then I should receive an email with the body:</strong></span>
<span class="strong"><strong>      """</strong></span>
<span class="strong"><strong>      Dear user,</strong></span>
<span class="strong"><strong>      You have been granted &lt;Role&gt; rights.  You are &lt;details&gt;. Please be    </strong></span>
<span class="strong"><strong>      responsible.</strong></span>
<span class="strong"><strong>      -The Admins</strong></span>
<span class="strong"><strong>      """</strong></span>

<span class="strong"><strong>    Examples:</strong></span>
<span class="strong"><strong>      | Role    | details                                       |</strong></span>
<span class="strong"><strong>      | Manager | now able to manage your employee accounts     |</strong></span>
<span class="strong"><strong>      | Admin   | able to manage any user account on system |</strong></span>
</pre></div></li><li class="listitem">Now run the Feature file; copy the Step Definitions suggestion given by Cucumber and replace it with the following Step Definitions:<div class="informalexample"><pre class="programlisting">@Given("^I have a user account with (.*?) rights$")
public void i_have_a_user_account_with_Manager_rights(String role) {
    
   //prints the role
  System.out.println(role);

}

<span class="strong"><strong>@Then("^I should receive an email with the body:$")</strong></span>
<span class="strong"><strong>public void i_should_receive_an_email_with_the_body(String docString) {</strong></span>
    
<span class="strong"><strong>  /* prints the content of Doc String with Scenario </strong></span>
<span class="strong"><strong>  outlineSubstitution */</strong></span>
<span class="strong"><strong>  System.out.println(docString);</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li><li class="listitem">When you<a id="id127" class="indexterm"/> run the Scenario, this is the<a id="id128" class="indexterm"/> output for the data substitution of Row 1:<div class="mediaobject"><img src="../Images/image00132.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><p>And this is the output for the data substitution of Row 2:</p><div class="mediaobject"><img src="../Images/image00133.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>How it works…</h2></div></div></div><p>In the preceding section, you learned how two basic concepts can be combined to come up with a solution for a complex problem. Two concepts that we used here are Doc Strings and Scenario Outline. Let's see how they work:</p><p>If you look closely, the highlighted text which is within <code class="literal">&lt;&gt;</code> in the <code class="literal">Then</code> Step of the Scenario Outline in Step 1 is the same as the text in the example table header row. (The text has been highlighted in Step 1). So, we are telling Cucumber that this text is just a placeholder, and during execution, its value will come from the example table.</p><p>As we have seen in the preceding recipe, we don't have to do anything special for Doc Strings in Step Definitions—they are automatically passed as the last argument. So we did not have to do <a id="id129" class="indexterm"/>anything special in Step 2.</p><p>Now in Step 3, you can see in the output of the first execution: the values of <code class="literal">&lt;Role&gt;</code> and <code class="literal">&lt;details&gt;</code> are<a id="id130" class="indexterm"/> replaced with the data from Data Row 1 of the example table, and in the second execution, the values are replaced with data from Data Row 2 of the example table.</p></div></div>
<div class="section" title="Defining String transformations for better conversions" id="aid-11C3M1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Defining String transformations for better conversions</h1></div></div></div><p>Think about a Scenario where <a id="id131" class="indexterm"/>you want to convert some Strings in test Steps to some specific Strings in your code. For example, the PO has mentioned "29-12-1986" in a Step and you want Cucumber to understand this text as a date. Further, in some countries this could be in the DD-MM-YYYY format, while in others, it could be in the MM-DD-YYYY format. So how do we standardize this conversion? Let's find out how we can do this in Cucumber.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>Getting ready</h2></div></div></div><p>Consider the following test Step for this problem:</p><div class="informalexample"><pre class="programlisting">Given My Birthday is on "29-12-1986"</pre></div><p>Now, we can use the <code class="literal">@Format</code> String transformer to convert text to date.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>How to do it…</h2></div></div></div><p>Import  <code class="literal">java.util.Date</code> into your Step Definitions file. This is how our Step Definitions will look:</p><div class="informalexample"><pre class="programlisting">@Given("^My Birthday is on \"(.*?)\"$")
  public void my_Birthday_is_on(<span class="strong"><strong>@Format("dd-MM-yyyy") Date bday</strong></span>) {
    //prints the text converted to Java.util.Date
    System.out.println(bday);
   
    //prints the class of bday to confirm it's a Date
    System.out.println(bday.getClass());
  }</pre></div><p>This is the output that appears after running the preceding Step:</p><div class="mediaobject"><img src="../Images/image00134.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>How it works…</h2></div></div></div><p>Cucumber-JVM allows converting Strings into various scalar types. A scalar type is a type that can be derived from a single String value. Some of Cucumber-JVM's built-in scalar types<a id="id132" class="indexterm"/> are <code class="literal">numbers</code>, <code class="literal">enums</code>, <code class="literal">java.util.Date</code>, <code class="literal">java.util.Calendar</code>, and so on. Transformation to <code class="literal">java.util.Date</code> and <code class="literal">java.util.Calendar</code> will work out-of-the-box as long as the String value matches one of the Short, Medium, Full, or Long formats defined by <code class="literal">java.util.DateFormat</code>.</p><p>
<code class="literal">29-12-1986</code> from our example doesn't match any of those formats, so we have to give Cucumber a hint by using <code class="literal">@Format</code>. We need to specify two things: First is the Format and second is the Data Type.</p><p>We can also write custom formatters if the formatting is not available in Cucumber-JVM by default. Further, we can even use String transformation for in cases other than date transformations.</p></div></div></body></html>