<html><head></head><body><div class="appendix" title="Appendix&#xA0;B.&#xA0;Deploying a Dropwizard Application"><div class="titlepage"><div><div><h1 class="title"><a id="appB"/>Appendix B. Deploying a Dropwizard Application</h1></div></div></div><p>Throughout this book, we have demonstrated and used the most important parts of a Dropwizard project. Our application is now ready, production ready. It is ready to be deployed on a server from where it can be accessed by everyone through the Internet.</p><div class="section" title="Preparing the application for deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec31"/>Preparing the application for deployment</h1></div></div></div><p>As you <a id="id275" class="indexterm"/>may have guessed, our application does not have<a id="id276" class="indexterm"/> many dependencies. Just check for your <code class="literal">pom.xml</code> file and look for the section where <code class="literal">maven-compiler-plugin</code> is declared.</p><div class="informalexample"><pre class="programlisting">&lt;project  
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.dwbook.phonebook&lt;/groupId&gt;
  &lt;artifactId&gt;dwbook-phonebook&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;dwbook-phonebook&lt;/name&gt;
  &lt;url&gt;http://maven.apache.org&lt;/url&gt;
  &lt;!-- Maven Repositories --&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
      &lt;name&gt;Sonatype Nexus Snapshots&lt;/name&gt;
&lt;url&gt;http://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;
  &lt;!-- Dependencies --&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-core&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;mysql&lt;/groupId&gt;
      &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
      &lt;version&gt;5.1.6&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-jdbi&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-client&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-auth&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-views-mustache&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-assets&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;io.dropwizard&lt;/groupId&gt;
      &lt;artifactId&gt;dropwizard-testing&lt;/artifactId&gt;
      &lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
      &lt;artifactId&gt;hamcrest-all&lt;/artifactId&gt;
      &lt;version&gt;1.3&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;!-- Build Configuration --&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.7&lt;/source&gt;
          &lt;target&gt;1.7&lt;/target&gt;
          &lt;encoding&gt;UTF-8&lt;/encoding&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.6&lt;/version&gt;
        &lt;configuration&gt;
          &lt;filters&gt;
            &lt;filter&gt;
              &lt;artifact&gt;*:*&lt;/artifact&gt;
                &lt;excludes&gt;
                  &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;
                  &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;
                  &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;
                &lt;/excludes&gt;
            &lt;/filter&gt;
          &lt;/filters&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
              &lt;goals&gt;
                &lt;goal&gt;shade&lt;/goal&gt;
              &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;transformers&gt;
                &lt;transformer
implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
                  &lt;mainClass&gt;com.dwbook.phonebook.App&lt;/mainClass&gt;
                &lt;/transformer&gt;
              &lt;/transformers&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div><p>All that <a id="id277" class="indexterm"/>should be present on the server is the<a id="id278" class="indexterm"/> Java Runtime Environment of the version that is equal or greater to the one specified in the <code class="literal">&lt;target&gt;</code> element of the build plugin's configuration section.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec75"/>How to do it…</h2></div></div></div><p>Once we confirm that our dependencies (the Java versions) are satisfied, we can upload the JAR file through an FTP and run the application in the same way as we already do:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ java -jar &lt;applicationFilename.jar&gt; server &lt;configFileName.yaml&gt;</strong></span>
</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec76"/>How it works…</h2></div></div></div><p>In our <code class="literal">pom.xml</code> file, we have all the required Maven parameters declared along with <code class="literal">maven-shade-plugin</code>, which allows us to build a single JAR file that includes all the third-party modules and libraries our application uses. Just remember to upload your config file on the server as well or create a new one with a possibly different setting, such as database connection details.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec77"/>There's more…</h2></div></div></div><p>There are many good reasons why you may wish to change the default port of your application from 8080 to something else.</p><p>This can be achieved with just a few additions to your configuration file: <code class="literal">config.yaml</code>. However, in order for these settings to work, we will need to add ServiceResourceTransformer in the build configuration by adding the following entry in the pom.xml file, within the <code class="literal">&lt;transformers&gt; section: &lt;transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/&gt;</code>.</p><p>Add the section <code class="literal">server</code> and configure its properties as shown in the following code:</p><div class="informalexample"><pre class="programlisting">server:
    applicationConnectors:
        - type: http
          # The port the application will listen on
          port: 8181
    adminConnectors:
        - type: http
          # The admin port
          port: 8282</pre></div><div class="section" title="Multiple configuration files"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec26"/>Multiple configuration files</h3></div></div></div><p>A <a id="id279" class="indexterm"/>good practice is to maintain different sets of <a id="id280" class="indexterm"/>configuration files (YAML) for your<a id="id281" class="indexterm"/> application per environment. For instance, you will probably be using different databases for test and production environments, and it's better to keep the connection information in different files. In addition, you may want to have a more verbose log level on your development or test environment than in production. Depending on the nature and the complexity of your application, there would for sure be many additional reasons that you and your application would benefit by. Luckily, Dropwizard offers many settings that can be tweaked to match your application's needs.</p></div></div></div></div></body></html>