<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Creating a Dropwizard Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Creating a Dropwizard Application</h1></div></div></div><p>Let's go through the processes required to create a new RESTful Web Services application based on Dropwizard. Firstly, we will need to create the application's structure, files, and folders, and also obtain the necessary libraries. Luckily, Maven will handle these tasks for us.</p><p>As soon as our application's structure is ready, we will modify the appropriate files, defining the application's dependencies on Dropwizard's modules and also configuring how the runnable package of our application should be produced. After that, we may proceed to coding our application.</p><div class="section" title="Generating a Maven-based project"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec10"/>Generating a Maven-based project</h1></div></div></div><p>Before<a id="id16" class="indexterm"/> we start with coding, we need to perform some tasks in order to properly create our project's structure. We are going to use Maven in order to generate a default, empty project, which we will then turn into a Dropwizard application.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec10"/>Getting ready</h2></div></div></div><p>Our project will be based on the <code class="literal">maven-archetype-quickstart</code> archetype. Archetypes are Maven project templates, and by using the <code class="literal">quick-start</code> archetype, we will have our project's structure (folders and files) prepared in no time.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec11"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the terminal (the command line in Windows) and navigate to the directory where you want your application to be created.</li><li class="listitem">Create a new Maven project by executing the following command (without the line breaks):<div class="informalexample"><pre class="programlisting">$ mvn archetype:generate-DgroupId=com.dwbook.phonebook-DartifactId=dwbook-phonebook-DarchetypeArtifactId=maven-archetype-quickstart-DinteractiveMode=false</pre></div></li></ol></div><p>This<a id="id17" class="indexterm"/> will create an empty Maven project in the <code class="literal">dwbook-phonebook</code> directory.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec12"/>How it works…</h2></div></div></div><p>Dropwizard is based on Maven, so we created a new Maven project in which we included Dropwizard's core dependency.</p><p>The structure of the <code class="literal">dwbook-phonebook</code> directory at this point is illustrated in the following screenshot:</p><div class="mediaobject"><img src="graphics/9530OS_02_01.jpg" alt="How it works…"/></div><p>The <code class="literal">src/</code> folder will hold our application's main classes, whereas all the test classes will be placed under the <code class="literal">test/</code> directory.</p><p>Notice that<a id="id18" class="indexterm"/> Maven has placed <code class="literal">pom.xml</code> on the application's root folder. The <span class="strong"><strong>Project Object Model</strong></span> (<span class="strong"><strong>POM</strong></span>) is an XML file that holds important information regarding our project's configuration and dependencies. This is the file we need to edit in order to add Dropwizard support for our project.</p></div></div></div>
<div class="section" title="Configuring Dropwizard dependencies and building the configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec11"/>Configuring Dropwizard dependencies and building the configuration</h1></div></div></div><p>We just<a id="id19" class="indexterm"/> created a sample application outline. The <a id="id20" class="indexterm"/>next thing we need to do is edit the project's configuration file, <code class="literal">pom.xml</code>, and define the Maven modules on which our application will depend on. We are building a Dropwizard application, and Dropwizard is based on Maven, so everything we need is available in the Maven Central Repository. This means that we just need to provide the modules' IDs, and Maven will take care of the download and inclusion of these modules in our project.</p><p>Next, we need to add build and package support to our project. We will use the <code class="literal">maven-shade</code> plugin, which will allow us to package our project completely, along with its dependencies, into <a id="id21" class="indexterm"/>a single standalone JAR file (Fat JAR) that <a id="id22" class="indexterm"/>can be distributed and executed as is.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec13"/>How to do it…</h2></div></div></div><p>Perform the following steps to configure Dropwizard dependencies and build the configuration:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We need to configure our POM by adding the Maven Repository where snapshots of all Dropwizard modules can be found. Maven will then be able to automatically fetch the required modules during the building of our project. Locate the <code class="literal">&lt;dependencies&gt;</code> section in <code class="literal">pom.xml</code> and add the following entries just before it:<div class="informalexample"><pre class="programlisting">&lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
            &lt;name&gt;Sonatype Nexus Snapshots&lt;/name&gt;
            &lt;url&gt;http://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;
        &lt;/repository&gt;
   &lt;/repositories&gt;</pre></div></li><li class="listitem">To define the dependencies, add the following code within the <code class="literal">&lt;dependencies&gt;</code> section:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;&lt;groupId&gt;io.dropwizard&lt;/groupId&gt;&lt;artifactId&gt;dropwizard-core&lt;/artifactId&gt;&lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;</pre></div></li><li class="listitem">To configure the build and package procedures, locate the <code class="literal">&lt;project&gt;</code> section in <code class="literal">pom.xml</code> and insert the following entries within it:<div class="informalexample"><pre class="programlisting">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;source&gt;1.7&lt;/source&gt;
          &lt;target&gt;1.7&lt;/target&gt;
          &lt;encoding&gt;UTF-8&lt;/encoding&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.6&lt;/version&gt;
        &lt;configuration&gt;
          &lt;filters&gt;
            &lt;filter&gt;
              &lt;artifact&gt;*:*&lt;/artifact&gt;
              &lt;excludes&gt;
                &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;
                &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;
                &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;
              &lt;/excludes&gt;
            &lt;/filter&gt;
          &lt;/filters&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;shade&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;transformers&gt;
                &lt;transformerimplementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"&gt;
            &lt;mainClass&gt;com.dwbook.phonebook.App&lt;/mainClass&gt;
                &lt;/transformer&gt;
              &lt;/transformers&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec14"/>How it works…</h2></div></div></div><p>We just<a id="id23" class="indexterm"/> told Maven everything it needs to know in order<a id="id24" class="indexterm"/> to build our application. Maven will fetch the Dropwizard core module from the Maven Central Repository and include it in the build path while packaging (as a result of the <code class="literal">mvn</code> package command) the application.</p><p>Moreover, we added build and package support with the <code class="literal">maven-shade</code> plugin and also specified our application's main class (the <code class="literal">&lt;mainClass&gt;</code> section in <code class="literal">pom.xml</code>), which facilitates the packaging of the Dropwizard application with its dependencies into a single JAR file. We also instructed the <code class="literal">maven-compiler-plugin</code> to build the application for Java <a id="id25" class="indexterm"/>Version 1.7 (check the target and source <a id="id26" class="indexterm"/>elements of the configuration section of <code class="literal">maven-compiler plugin</code>).</p><div class="section" title="The exclusion of digital signatures"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec04"/>The exclusion of digital signatures</h3></div></div></div><p>The <code class="literal">&lt;excludes&gt;</code> section<a id="id27" class="indexterm"/> in the <code class="literal">maven-shade</code> configuration instructs Maven to exclude the digital signatures of all the referenced signed JAR files. This is because Java would otherwise treat them as invalid during runtime, preventing the execution of our application.</p></div></div></div>
<div class="section" title="Hello World using Dropwizard"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec12"/>Hello World using Dropwizard</h1></div></div></div><p>Our <a id="id28" class="indexterm"/>project's dependencies are now set in the <code class="literal">pom.xml</code> file <a id="id29" class="indexterm"/>and we may start building our application. Maven has already created our application's entry point class, the <code class="literal">App</code> class, in the <code class="literal">App.java</code> file. However, its default contents are more suitable to a plain Java application and not a Dropwizard-based one.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>How to do it…</h2></div></div></div><p>Let's have a look at the steps we need to follow to print a <code class="literal">Hello World</code> message using Dropwizard:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the <code class="literal">App.java</code> file, add the following import clauses:<div class="informalexample"><pre class="programlisting">import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import io.dropwizard.Application;
import io.dropwizard.Configuration;
import io.dropwizard.setup.Bootstrap;
import io.dropwizard.setup.Environment;</pre></div></li><li class="listitem">Modify the definition of the <code class="literal">App</code> class as shown in the next step. This class needs to extend <code class="literal">Application &lt;Configuration&gt;</code>.</li><li class="listitem">Add a logger to our application by declaring it as a static final member of the <code class="literal">App</code> class after its definition:<div class="informalexample"><pre class="programlisting">public class App extends Application&lt;Configuration&gt; {
  private static final Logger LOGGER =LoggerFactory.getLogger(App.class);</pre></div></li><li class="listitem">Implement the abstract methods of the <code class="literal">Service</code> class, <code class="literal">initialize()</code> and <code class="literal">run()</code>, by adding the following code:<div class="informalexample"><pre class="programlisting">  @Override
  public void initialize(Bootstrap&lt;Configuration&gt; b) {}
  @Override
  public void run(Configuration c, Environment e) throwsException {
    LOGGER.info("Method App#run() called");
    System.out.println( "Hello world, by Dropwizard!" );
  }</pre></div></li><li class="listitem">Finally, modify<a id="id30" class="indexterm"/> the <code class="literal">main()</code> method, adding the necessary code to instantiate our Dropwizard service:<div class="informalexample"><pre class="programlisting">  public static void main( String[] args ) throws Exception{
        new App().run(args);
      }</pre></div></li><li class="listitem">Build the application by executing the following command in your terminal inside the <code class="literal">dwbook-phonebook</code> directory:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn package</strong></span>
</pre></div></li></ol></div><p>The output of this command will contain the <code class="literal">[INFO] BUILD SUCCESS</code> line, indicating that the <a id="id31" class="indexterm"/>project was successfully built, as shown in the <a id="id32" class="indexterm"/>following screenshot:</p><div class="mediaobject"><img src="graphics/9530OS_02_02.jpg" alt="How to do it…"/></div><p>Maven has produced (built) the executable Fat JAR using the shade plugin, and this can be located in the target/directory named <code class="literal">dwbook-phonebook-1.0-SNAPSHOT.jar</code>. Run it as you would with any executable JAR file using the <code class="literal">java -jar</code> command as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ java -jar target/dwbook-phonebook-1.0-SNAPSHOT.jar server</strong></span>
</pre></div><p>Normally, you should see a lot of entries in your terminal, including an error. The first line is the message in which we included the <code class="literal">#run()</code> method. This is followed by a warning<a id="id33" class="indexterm"/> message indicating that our application has no health checks configured, but this is something we will handle later on in this book.</p><p>The next logged entries indicate that the Jetty server embedded in our Dropwizard application is starting and listening for incoming requests on port 8080. Port 8081 is also used for administration purposes. You will also see an error stating that no resource classes could be located (the <code class="literal">ResourceConfig</code> instance does not contain any root resource classes), which is reasonable and absolutely normal, as we haven't created and configured any REST resources yet.</p><div class="mediaobject"><img src="graphics/9530OS_02_03.jpg" alt="How to do it…"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec16"/>How it works…</h2></div></div></div><p>What we<a id="id34" class="indexterm"/> just did was we added the  minimum <a id="id35" class="indexterm"/>amount of code required in a Dropwizard application. As you saw, our application's entry point class needs to extend the <code class="literal">io.dropwizard.Application</code> class and implement the <code class="literal">initialize(Bootstrap&lt;Configuration&gt;)</code> and <code class="literal">run(Configuration, Environment)</code> methods. The <code class="literal">initialize</code> method is tasked with bootstrapping, possibly loading additional <a id="id36" class="indexterm"/>components and generally preparing the runtime environment of the application.</p><p>We were going to just print a <code class="literal">Hello</code> message in this phase, so we included only a <code class="literal">println()</code> statement in <a id="id37" class="indexterm"/>the <code class="literal">run()</code> method.</p><p>The execution of the JAR file produced by the <code class="literal">mvn</code> package command resulted in the printing of the <span class="strong"><strong>Hello World!</strong></span> greeting by Dropwizard, as <code class="literal">public static void main</code> triggered the <a id="id38" class="indexterm"/>execution of the relevant code in the <code class="literal">public void run</code> method.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>There's more…</h2></div></div></div><p>For executing the JAR file, we add the <code class="literal">server</code> argument to the command. In <code class="literal">public static void main</code>, we called the <code class="literal">public void run</code> method, passing command-line arguments to it. Dropwizard has only one command preconfigured (although we're able to configure additional commands), the <code class="literal">server</code> command, which starts the embedded HTTP Server (Jetty) to run our service. In our case, following the execution of the code in the <code class="literal">run()</code> method, an error with an exception was displayed as Jetty couldn't locate any REST resources to serve.</p><div class="section" title="Logging"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec05"/>Logging</h3></div></div></div><p>Dropwizard is<a id="id39" class="indexterm"/> backed by Logback and provides an SLF4J implementation for our logging means. In the <code class="literal">App.java</code> file, we imported the necessary <code class="literal">Logger</code> and <code class="literal">LoggerFactory</code> classes in order to construct a <code class="literal">Logger</code> instance we could use for our logging needs.</p></div><div class="section" title="Default HTTP Ports"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec06"/>Default HTTP Ports</h3></div></div></div><p>Dropwizard's embedded Jetty server will try to bind to ports 8080 and 8081 by default. Port 8080 is used by the server in order to serve incoming HTTP requests to the application, while 8081 is used by Dropwizard's administration interface. In case there is another service running on your system that uses any of these ports, you will see a <code class="literal">java.net.BindException</code> when trying to run this example.</p><p>Later on, we will see how you can configure your application to use another port for incoming requests, but for now, just make sure this port is available to use.</p></div></div></div></body></html>