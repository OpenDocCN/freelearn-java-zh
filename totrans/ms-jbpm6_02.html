<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Building Your First BPM Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Building Your First BPM Application</h1></div></div></div><p>Let us now build our first BPM application by using the jBPM tool stack. This chapter will guide you through the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing the jBPM tool stack</li><li class="listitem" style="list-style-type: disc">Hacking the default installation configurations</li><li class="listitem" style="list-style-type: disc">Modeling and deploying a jBPM project</li><li class="listitem" style="list-style-type: disc">Embedding jBPM inside a standalone Java project</li></ul></div><p>A step towards the goal of this book, the chapter gives you the hands-on flexibility of the jBPM tool stack and provides information on hacking the configuration and playing around.</p><div class="section" title="Installing the jBPM tool stack"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Installing the jBPM tool stack</h1></div></div></div><p>A jBPM release comes<a id="id172" class="indexterm"/> with an installation zip file, which contains the essentials for the jBPM environment and tools for building a demo runtime for easy hands-on management of the jBPM runtime environment.</p><p>For downloading<a id="id173" class="indexterm"/> jBPM:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <a class="ulink" href="http://jboss.org/jbpm">http://jboss.org/jbpm</a> | <span class="strong"><strong>Download</strong></span> | <span class="strong"><strong>Download jBPM 6.2.0.Final</strong></span> | <span class="strong"><strong>jbpm-6.2.0.Final-installer-full.zip</strong></span>.<p>Use the latest stable version. The content of the book follows the 6.2.0 release.</p></li><li class="listitem">Unzip and extract the installer content and you will find an <code class="literal">install.html</code> file that contains the helper documentation for installing a demo jBPM runtime with inbuilt projects.</li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>jBPM installation needs JDK 1.6+ to be installed and set as <code class="literal">JAVA_HOME</code> and the tooling for installation is done using ANT scripts (ANT version 1.7+).</p></div></div><p>The tooling for installation is basically an ANT script, which is a straightforward method for installation and can be customized easily. To operate the tooling, the ANT script consists of the ANT targets that act as the commands for the tooling. The following figure will make it <a id="id174" class="indexterm"/>easy for you to understand the relevant ANT targets available in the script. Each box represents an ANT target and helps you to manage the environment. The basic targets available are for installing, starting, stopping, and cleaning the environment.</p><p>To run the <code class="literal">ANT</code> target, install ANT 1.7+, navigate to the installer folder (by using the shell or the command line tool available in your OS), and run the target by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ant &lt;targetname&gt;</strong></span>
</pre></div><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a> for all the Packt Publishing books that you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="mediaobject"><img src="graphics/9578OS_02_01.jpg" alt="Installing the jBPM tool stack"/></div><p>The jBPM installer <a id="id175" class="indexterm"/>comes with a default demo environment, which uses a basic H2 database as its persistence storage. The persistence of jBPM is done using Hibernate; this makes it possible for jBPM to support an array of popular databases including the databases in the following list:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Hibernate or Hibernate ORM is an object relational mapping framework and is used by jBPM to persist data to<a id="id176" class="indexterm"/> relation databases. For more<a id="id177" class="indexterm"/> details, see <a class="ulink" href="http://hibernate.org/">http://hibernate.org/</a>.</p></div></div><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Databases Supported</p>
</th><th style="text-align: left" valign="bottom">
<p>Details</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>DB2</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://www-01.ibm.com/software/in/data/db2/">http://www-01.ibm.com/software/in/data/db2/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Apache Derby</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://db.apache.org/derby/">https://db.apache.org/derby/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>H2</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://www.h2database.com/html/main.html">http://www.h2database.com/html/main.html</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>HSQL Database Engine</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://hsqldb.org/">http://hsqldb.org/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>MySQL</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://www.mysql.com/">https://www.mysql.com/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Oracle</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="https://www.oracle.com/database/">https://www.oracle.com/database/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>PostgreSQL</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://www.postgresql.org/">http://www.postgresql.org/</a>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Microsoft SQL Server Database</p>
</td><td style="text-align: left" valign="top">
<p>
<a class="ulink" href="http://www.microsoft.com/en-in/server-cloud/products/sql-server/">http://www.microsoft.com/en-in/server-cloud/products/sql-server/</a>
</p>
</td></tr></tbody></table></div><p>For installing the demo, use<a id="id178" class="indexterm"/> the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ant install.demo</strong></span>
</pre></div><p>The install command would <code class="literal">install</code> the web tooling and the Eclipse tooling, required for modeling and operating jBPM.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ant start.demo</strong></span>
</pre></div><p>This command will start the application server (JBoss) with the web tooling (the Kie workbench and dashboard) deployed in it and the eclipse tooling with all the plugins installed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>Refer <code class="literal">install.html</code>, the installation documentation included in the installer archive for common errors that can occur during installation; it guides you to the solutions. The installation document is quite elaborate; please refer to it for a more detailed understanding of the installation process.</p></div></div><p>That's it for the installation! Now, the JBoss application server should be running with the Kie workbench and dashboard builder deployed.</p><p>You can now access<a id="id179" class="indexterm"/> the Kie workbench demo environment by using the URL and log in by using the demo admin user called <code class="literal">admin</code> and the password <code class="literal">admin</code>:</p><p>
<code class="literal">http://localhost:8080/jbpm-console</code>.</p><div class="section" title="Customizing the installation"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>Customizing the installation</h2></div></div></div><p>The demo installation is a <a id="id180" class="indexterm"/>sandbox environment, which allows for an easy installation and reduces time between you getting the release and being able to play around by using the stack. Even though it is very necessary, when you get<a id="id181" class="indexterm"/> the initial stuff done and get serious about jBPM, you may want to install a jBPM environment, which will be closer to a production environment. We can customize the installer for this purpose. The following sections will guide you through the options available for customization.</p><div class="section" title="Changing the database vendor"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec09"/>Changing the database vendor</h3></div></div></div><p>The jBPM demo sandbox<a id="id182" class="indexterm"/> environment uses an embedded H2 database as the persistence storage. jBPM provides out of the box support for  more widely used databases such as MySQL, PostgreSQL, and so on. Follow these steps to achieve a jBPM installation with these databases:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update the <code class="literal">build.properties</code> file available in the root folder of the installation to choose the required database instead of H2. By default, configurations for MySQL and PostgreSQL are available. For the support of other databases, check the hibernate documentation before configuring.</li><li class="listitem">Update <code class="literal">db/jbpm-persistence-JPA2.xml</code>, and update the <code class="literal">hibernate.dialect</code> property with an appropriate Hibernate dialect for our database vendor.</li><li class="listitem">Install the corresponding JDBC driver in the application server where we intend to deploy jBPM web tooling.</li></ol></div></div><div class="section" title="Manually installing the database schema"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec10"/>Manually installing the database schema</h3></div></div></div><p>By default, the<a id="id183" class="indexterm"/> database schema is created automatically by using the Hibernate autogeneration capabilities. However, if we want to manually install the database schemas, the corresponding DDL scripts are available in <code class="literal">db\ddl-scripts</code> for all major database vendors.</p></div></div></div></div>
<div class="section" title="Creating your first jBPM project"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Creating your first jBPM project</h1></div></div></div><p>jBPM provides a <a id="id184" class="indexterm"/>very structured way of creating a project. The structure considers application creation and maintenance for large organizations with multiple departments. This structure is recommended for use as it is a clean and secure way of manning the business process artifacts. The following image details the organization of a project in jBPM web tooling (or the Kie workbench).</p><div class="mediaobject"><img src="graphics/9578OS_02_02.jpg" alt="Creating your first jBPM project"/></div><p>The jBPM workbench comes with an assumption of one business process management suite for an organization. An organization can have multiple organization units, which will internally contain multiple projects and form the root of the project, and as the name implies, it represents a fraction of an organization. This categorization can be visualized in any business organization and is sometimes referred as departments. In an ideal categorization, these organization units will be functionally different and thus, will contain different business processes. Using the workbench, we can create multiple organization units.</p><p>The next categorization is the repository. A repository is a storage of business model artifacts such as business processes, business rules, and data models. A repository can be mapped to a <a id="id185" class="indexterm"/>functional classification within an organization, and multiple repositories can be set up if these repositories run multiple projects; the handling of these project artifacts have to be kept secluded from each other (for example, for security).</p><p>Within a repository, we can create a project, and within a project, we can define and model business process artifacts. This structure and abstraction will be very useful to manage and maintain BPM-based applications.</p><p>Let us go through the steps in detail now.</p><p>After installation, you need to log into the Kie workbench. Now, as explained previously, we can create a project. Therefore, the first step is to create an organizational unit:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Click through the menu bars, and go to <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Organizational Units</strong></span> | <span class="strong"><strong>Manage Organizational Units</strong></span>.<p>This takes you to the Organizational Unit Manager screen; here, we can see a list of organizational units and repositories already present and their associations.</p></li><li class="listitem">Click <span class="strong"><strong>Add</strong></span> to create an organizational unit, and give the name of the organization unit and the user who is in charge of administering the projects in the organization unit.<div class="mediaobject"><img src="graphics/9578OS_02_03.jpg" alt="Creating your first jBPM project"/></div></li><li class="listitem">Now, we <a id="id186" class="indexterm"/>can add a repository, navigate through the menus, and go to <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Repositories</strong></span> | <span class="strong"><strong>New Repository</strong></span>.</li><li class="listitem">Now, provide a name for the repository, choose the organization unit, and create the repository.<div class="mediaobject"><img src="graphics/9578OS_02_04.jpg" alt="Creating your first jBPM project"/></div></li></ol></div><p>Creating the repository results in (internally) creating a Git repository. The default location of the <a id="id187" class="indexterm"/>Git repository in the workbench is <code class="literal">$WORKING_DIRECTORY/.niogit</code> and can be modified by using the following system property: <code class="literal">-Dorg.uberfire.nio.git.dir</code>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Now, we can create a project for the organization unit. Go to <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Project Authoring</strong></span> | <span class="strong"><strong>Project Explorer</strong></span>. Now, choose your organization unit (here, <span class="strong"><strong>Mastering-jBPM</strong></span>) from the bread crumb of project categorization.<div class="mediaobject"><img src="graphics/9578OS_02_05.jpg" alt="Creating your first jBPM project"/></div></li><li class="listitem">Click <span class="strong"><strong>New Item</strong></span> and choose <span class="strong"><strong>Project</strong></span>. Now, we can create a project by entering a relevant project name.<div class="mediaobject"><img src="graphics/9578OS_02_06.jpg" alt="Creating your first jBPM project"/></div></li><li class="listitem">This takes <a id="id188" class="indexterm"/>you to the new project wizard as shown in the following figure:<div class="mediaobject"><img src="graphics/9578OS_02_07.jpg" alt="Creating your first jBPM project"/></div></li><li class="listitem">This gives details<a id="id189" class="indexterm"/> like project name and a brief summary of the project, and more importantly, gives the group ID, artifact ID, and version ID for the project. Further, <span class="strong"><strong>Finish</strong></span> the creation of new project.</li></ol></div><p>Those of you who know Maven and its artifact structure, will now have got an insight on how a project is built. Yes! The project created is a Maven module and is deployed as one. We will get into the detail of this is in the coming chapters.</p><div class="section" title="Business Process Modeling"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>Business Process Modeling</h2></div></div></div><p>Therefore, we are ready<a id="id190" class="indexterm"/> to create our first business process model by using jBPM.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>New Item</strong></span> | <span class="strong"><strong>Business Process</strong></span>:<div class="mediaobject"><img src="graphics/9578OS_02_08.jpg" alt="Business Process Modeling"/></div><p>Provide the name for the business process; here, we are trying to create a very primitive process as an example.</p></li><li class="listitem">Now, the <a id="id191" class="indexterm"/>workbench will show you the process modeler for modeling the business process. Click the zoom button in the toolbar, if you think you need more real estate for modeling (highlighted in red in the following image):<div class="mediaobject"><img src="graphics/9578OS_02_09.jpg" alt="Business Process Modeling"/></div></li></ol></div><p>Basically, the workbench can be divided into five parts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Toolbar (on the top): It gives you a large set of tools for visual modeling and saving the model.</li><li class="listitem" style="list-style-type: disc">Object library (on the left side of the canvas): It gives you all the standard BPMN construct stencils, which you can drag and drop to create a model.</li><li class="listitem" style="list-style-type: disc">Workspace (on the center): You get a workspace or canvas on which you can draw the process models. The canvas is very intuitive; if you click on an object, it shows a tool set surrounding it to draw the next one or guide to the next object.</li><li class="listitem" style="list-style-type: disc">Properties (on the right side of the canvas): It gives the property values for all the attributes associated with the business process and each of its constructs.</li><li class="listitem" style="list-style-type: disc">Problems (on the bottom): It gives you the errors on the business process that you are <a id="id192" class="indexterm"/>currently modeling. The validations are done on save, and we have provisions to have autosave options.</li></ul></div><p>The following screenshot shows the process modeler with all the sections described:</p><div class="mediaobject"><img src="graphics/9578OS_02_10.jpg" alt="Business Process Modeling"/></div><p>Therefore, we can start modeling out first process. I assume the role of a business analyst who wants to model a simple process of content writing. This is a very simple process with just two tasks, one human task for writing and the other for reviewing.</p><p>We can attach the actor associated with the task by going to the <span class="strong"><strong>Properties</strong></span> panel and setting the actor. In this example, I have set it as<a id="id193" class="indexterm"/> <span class="strong"><strong>admin</strong></span>, the default user, for the sake of simplicity.</p><div class="mediaobject"><img src="graphics/9578OS_02_11.jpg" alt="Business Process Modeling"/></div><p>Now, we can save the project by using the <span class="strong"><strong>Save</strong></span> button; it asks for a check-in comment, which provides the comment for this version of the process that we have just saved. Process modeling<a id="id194" class="indexterm"/> is a continuous process, and if properly used, the check-in comment can helps us to keep track on the objectives of process updates.</p></div><div class="section" title="Building and deploying the project"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>Building and deploying the project</h2></div></div></div><p>Even though the project created is minuscular with just a sample project, this is fully functional! Yes, we<a id="id195" class="indexterm"/> have completed a business process, which will be very limited in functionality, but with its limited set of functionalities (if any), it can be<a id="id196" class="indexterm"/> deployed and operated.</p><p>Go to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Project Editor</strong></span>, and click <span class="strong"><strong>Build &amp; Deploy</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9578OS_02_12.jpg" alt="Building and deploying the project"/></div><p>To see the deployment listed, go to <span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Deployments</strong></span> to see <span class="strong"><strong>Deployment Units</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9578OS_02_13.jpg" alt="Building and deploying the project"/></div><p>This shows the<a id="id197" class="indexterm"/> effectiveness of jBPM as a rapid application builder<a id="id198" class="indexterm"/> using a business process. We can create, model, and deploy a project within a span of minutes.</p></div><div class="section" title="Running your first process"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>Running your first process</h2></div></div></div><p>Here, we start the operation management using jBPM. Now, we assume the role of an operational<a id="id199" class="indexterm"/> employee. We have deployed a process and have to create a process instance and run it.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>Process Management</strong></span> | <span class="strong"><strong>Process Definitions</strong></span>. We can see the details of the process definitions deployed in the following screenshot:<div class="mediaobject"><img src="graphics/9578OS_02_14.jpg" alt="Running your first process"/></div></li><li class="listitem">Click <span class="strong"><strong>New Instance</strong></span> and start the process. This will start a process instance.<div class="mediaobject"><img src="graphics/9578OS_02_15.jpg" alt="Running your first process"/></div></li><li class="listitem">Go to <span class="strong"><strong>Process Management</strong></span> | <span class="strong"><strong>Process Instances</strong></span> to view the process instance<a id="id200" class="indexterm"/> details and perform life cycle actions on process instances.<p>The example writing process consists of two human tasks. Upon the start of the process instance, the Write task is assigned to the admin. The assigned task can be managed by going to the task management functionality.</p></li><li class="listitem">Go to <span class="strong"><strong>Tasks</strong></span> | <span class="strong"><strong>Tasks List</strong></span>:<div class="mediaobject"><img src="graphics/9578OS_02_16.jpg" alt="Running your first process"/></div></li></ol></div><p>In <span class="strong"><strong>Tasks List</strong></span>, we can view the details of the human tasks and perform human task life cycle operations such <a id="id201" class="indexterm"/>as assigning, delegating, completing, and aborting a task.</p></div></div>
<div class="section" title="Embedding jBPM in a standalone Java application"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Embedding jBPM in a standalone Java application</h1></div></div></div><p>The core engine of jBPM is a set of lightweight libraries, which can be embedded in any Java standalone<a id="id202" class="indexterm"/> application. This gives the enterprise architects the flexibility to include jBPM inside their existing application and leverage the functionalities of BPM.</p><p>This section will cover how to programmatically start the runtime engine and start a process instance, and will guide you in writing automated tests for BPMN processes.</p><div class="section" title="Modeling the business process using Eclipse tooling"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>Modeling the business process using Eclipse tooling</h2></div></div></div><p>Upon running the installation<a id="id203" class="indexterm"/> script, jBPM installs the web tooling as well as the Eclipse tooling. The Eclipse tooling basically<a id="id204" class="indexterm"/> consists of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">jBPM project wizard: It helps you to create a jBPM project easily</li><li class="listitem" style="list-style-type: disc">jBPM runtime: An easy way of choosing the jBPM runtime version; this associates a set of libraries for the particular version of jBPM to the project</li><li class="listitem" style="list-style-type: disc">BPMN Modeler: It is used to model the BPMN process</li><li class="listitem" style="list-style-type: disc">Drools <a id="id205" class="indexterm"/>plugin: It gives you the debugging and operation management capabilities <a id="id206" class="indexterm"/>within Eclipse</li></ul></div></div><div class="section" title="Creating a jBPM project using Eclipse"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Creating a jBPM project using Eclipse</h2></div></div></div><p>The Eclipse web<a id="id207" class="indexterm"/> tooling is available in the<a id="id208" class="indexterm"/> installer root folder. Start Eclipse and create a new jBPM Maven project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Project</strong></span> | <span class="strong"><strong>jBPM Project</strong></span> (Maven).</li><li class="listitem">Provide the project name and location details; now, the jBPM project wizard will do the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a default jBPM project for you with the entire initial configuration setup</li><li class="listitem" style="list-style-type: disc">Attach all runtime libraries</li><li class="listitem" style="list-style-type: disc">Create a sample project</li><li class="listitem" style="list-style-type: disc">Set up a unit testing environment for the business process</li></ul></div></li><li class="listitem">The following screenshot shows the jBPM project wizard.<div class="mediaobject"><img src="graphics/9578OS_02_17.jpg" alt="Creating a jBPM project using Eclipse"/></div></li><li class="listitem">The Eclipse <a id="id209" class="indexterm"/>workbench is <a id="id210" class="indexterm"/>considerably similar to the web tooling workbench; a screenshot is shown as follows:<div class="mediaobject"><img src="graphics/9578OS_02_18.jpg" alt="Creating a jBPM project using Eclipse"/></div></li></ol></div><p>Similar to web<a id="id211" class="indexterm"/> tooling, it contains the toolbox, workspace, palette showing the BPMN construct stencils, and the property explorer.</p><p>We can create a new <a id="id212" class="indexterm"/>BPMN process by going to <span class="strong"><strong>New Project Wizard</strong></span> and selecting <span class="strong"><strong>jBPM</strong></span> | <span class="strong"><strong>BPMN2 Process</strong></span>. Give the process file name and click <span class="strong"><strong>Finish</strong></span>; this will create a default BPMN2 template file. The BPMN2 modeler helps to visually model the process by dragging and dropping BPMN constructs from the palette and connecting them using the tool set.</p></div><div class="section" title="Deploying the process programmatically"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>Deploying the process programmatically</h2></div></div></div><p>For deploying and running<a id="id213" class="indexterm"/> the business process programmatically, you have to follow these steps:</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>
<span class="strong"><strong>KIE</strong></span> is the abbreviation for<a id="id214" class="indexterm"/> <span class="strong"><strong>Knowledge Is Everything</strong></span>.</p></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Creating the knowledge base</strong></span>: Create the Kie Services, which is a hub giving access to the<a id="id215" class="indexterm"/> services provided by Kie:<div class="informalexample"><pre class="programlisting">KieServices ks = KieServices.Factory.get();</pre></div><p>Using the Kie Service, create Kie Container, which is the container for the knowledge base:</p><div class="informalexample"><pre class="programlisting">KieContainer kContainer = ks.getKieClasspathContainer();</pre></div><p>Create and return the knowledge base with the input name:</p><div class="informalexample"><pre class="programlisting">KieBase kbase = kContainer.getKieBase("kbase");</pre></div></li><li class="listitem"><span class="strong"><strong>Creating a runtime manager</strong></span>: The runtime manger manages the runtime build with knowledge<a id="id216" class="indexterm"/> sessions and Task Service to create an executable environment<a id="id217" class="indexterm"/> for processes and user tasks.<p>Create the JPA entity manager factory used for creating the persistence service, for communicating with the storage layer:</p><div class="informalexample"><pre class="programlisting">EntityManagerFactory emf = Persistence.createEntityManagerFactory(
"org.jbpm.persistence.jpa");</pre></div><p>Create the runtime builder, which is the <code class="literal">dsl</code> style helper to create the runtime environment:</p><div class="informalexample"><pre class="programlisting">RuntimeEnvironmentBuilder builder = RuntimeEnvironmentBuilder.Factory.get()
.newDefaultBuilder().entityManagerFactory(emf)
.knowledgeBase(kbase);</pre></div><p>Using the runtime environment, create the runtime manager:</p><div class="informalexample"><pre class="programlisting">RuntimeManager RuntimeManager = RuntimeManagerFactory.Factory.get()
.newSingletonRuntimeManager(builder.get(), "com.packt:introductory-sample:1.0");</pre></div></li><li class="listitem"><span class="strong"><strong>Creating the runtime engine</strong></span>: Using the runtime manager, creates the runtime engine that is fully<a id="id218" class="indexterm"/> initialized and ready for operation:<div class="informalexample"><pre class="programlisting">RuntimeEngine engine = manager.getRuntimeEngine(null);</pre></div></li><li class="listitem"><span class="strong"><strong>Starting the process</strong></span>: Using the runtime manager, create a knowledge session and start the process:<div class="informalexample"><pre class="programlisting">KieSession ksession = engine.getKieSession();
ksession.startProcess("com.sample.bpmn.hello");</pre></div><p>This creates and starts a process instance.</p><p>From the runtime<a id="id219" class="indexterm"/> manager, we can also access the human task service and interact with its API.</p><p>Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Show View</strong></span> | <span class="strong"><strong>Others</strong></span> | <span class="strong"><strong>Drools</strong></span> | <span class="strong"><strong>Process Instances</strong></span> to view the<a id="id220" class="indexterm"/> created process instances:</p><div class="mediaobject"><img src="graphics/9578OS_02_19.jpg" alt="Deploying the process programmatically"/></div></li></ol></div></div><div class="section" title="Writing automated test cases"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>Writing automated test cases</h2></div></div></div><p>jBPM runtime comes <a id="id221" class="indexterm"/>with a test utility, which serves as the unit testing framework for automated test cases. The unit testing framework uses and extends the capabilities of the JUnit testing framework and basically provides the JUnit life cycle methods and the jBPM runtime environment for testing and tearing down the runtime manager after test execution. Helper methods manage the knowledge base and the knowledge session, getting workitem handlers and assertions to assert process instances and various stages.</p><p>For creating a JUnit test case, create a class extending <code class="literal">org.jbpm.test.JbpmJUnitBaseTestCase</code>
</p><p>We can initialize the jBPM runtime by using the previous steps and assert using the helper methods provided by <code class="literal">org.jbpm.test.JbpmJUnitBaseTestCase</code>.</p><p>For example, we assert the completion of a process as follows:</p><div class="informalexample"><pre class="programlisting">assertProcessInstanceCompleted(processInstance.getId(), ksession);</pre></div><p>The code for the introductory <a id="id222" class="indexterm"/>sample project is attached with the downloads associated with this book.</p></div></div>
<div class="section" title="Change management &#x2013; updating deployed process definitions"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Change management – updating deployed process definitions</h1></div></div></div><p>We have modeled<a id="id223" class="indexterm"/> a business process and deployed it; the application end users will create process instances and fulfill their goals by using the business process. Now, as the organization evolves, we need a change in the process; for example, the organization has decided to add one more department. Therefore, we have to update the associated business processes.</p><p>Technically, in jBPM, we cannot have an update in an already deployed process definition; we need to have a workaround. jBPM suggests three strategies for a process migration.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Proceed</strong></span>: We will introduce the new process definition and retire the old definition. Retiring should be<a id="id224" class="indexterm"/> taken care of by the application so that all process instance calls for the process are redirected to the new process definition.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Abort</strong></span>: The existing process<a id="id225" class="indexterm"/> is aborted, and we can restart the process instance with the updated process definition. We have to be very careful in this approach if the changes are not compatible with the state of the process instances. This can show abrupt behaviors depending on how complex your process definition is.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Transfer</strong></span>: The process instance<a id="id226" class="indexterm"/> is migrated to the new process definition; that is, the states of the process instance and instances of activity should be mapped. The jBPM out-of-the-box support provides a generic process upgrade API, which can be used as an example.</li></ul></div><p>These strategies can be discussed in detail and illustrated in the following chapters.</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Summary</h1></div></div></div><p>This chapter would have given you the "Hello world" hands-on experience in jBPM. With your jBPM installation ready, we can now dive deep into the details of the functional components of jBPM.</p><p>With this chapter, we have come to an end to the introductory chapters of <span class="emphasis"><em>Mastering jBPM</em></span>. In the upcoming chapters, we will discuss the process designer, operation management, and core engine architecture in detail.</p></div></body></html>