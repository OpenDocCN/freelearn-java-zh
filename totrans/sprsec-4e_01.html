<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer017">
<h1 class="chapter-number" id="_idParaDest-16"><a id="_idTextAnchor015"/>1</h1>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/>Anatomy of an Unsafe Application</h1>
<p>Security is arguably one of the most critical architectural components of any web-based application written in the <em class="italic">21st</em> century. In an era where malware, criminals, and rogue employees are always present and actively testing software<a id="_idIndexMarker000"/> for <strong class="bold">exploits</strong>, smart and comprehensive use of security is a key element of any project for which you’ll <span class="No-Break">be responsible.</span></p>
<p>This book is written to follow a pattern of development that, we feel, provides a useful premise for tackling a complex subject—taking a web-based application with a Spring 6 foundation, and understanding the core concepts and strategies for securing it with Spring Security 6. We complement this approach by providing sample code for each chapter in the form of complete <span class="No-Break">web applications.</span></p>
<p>In this chapter, we will delve into an example scenario to highlight several prevalent security vulnerabilities. Our journey will commence by examining the fundamental principles of secure coding. We will then shift our focus to explore common vulnerabilities in <a id="_idIndexMarker001"/>the next chapters, such <a id="_idIndexMarker002"/>as SQL injection, <strong class="bold">Cross-Site Scripting</strong> (<strong class="bold">XSS</strong>), and <strong class="bold">Cross-Site Request </strong><span class="No-Break"><strong class="bold">Forgery</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">CSRF</strong></span><span class="No-Break">).</span></p>
<p>Whether you’re already using Spring Security or are interested in taking your basic use of the software to the next level of complexity, you’ll find something to help you in <span class="No-Break">this book.</span></p>
<p>During the course of this chapter, we will cover the <span class="No-Break">following topics:</span></p>
<ul>
<li>Exploring software <span class="No-Break">architecture styles</span></li>
<li>Understanding <span class="No-Break">security audit</span></li>
<li>Addressing the security <span class="No-Break">audit findings</span></li>
</ul>
<p>It is recommended to have a basic understanding of the Spring framework before delving deeper into the <span class="No-Break">subsequent sections.</span></p>
<p>By the end of this chapter, you will know how an application can be vulnerable to attack, and you will have mastered the core security mechanisms that can be used to protect <span class="No-Break">an application.</span></p>
<p>If you are already familiar with basic security terminology, you may skip to <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>,<em class="italic"> Getting Started with Spring Security</em>, where we start using the basic functionality of <span class="No-Break">t<a id="_idTextAnchor017"/>he framework.</span></p>
<h1 id="_idParaDest-18"><a id="_idTextAnchor018"/>Exploring software architecture styles</h1>
<p>Numerous <a id="_idIndexMarker003"/>businesses are acquiring computational capabilities from online cloud service platforms and embracing a primary reliance on the cloud for the development of most applications. This shift has prompted a transformation in the design <span class="No-Break">of applications.</span></p>
<div>
<div class="IMG---Figure" id="_idContainer008">
<img alt="Figure 1.1 – Monolithic versus layered versus SOA versus microservices" height="1462" src="image/B21757_01_1.jpg" width="1279"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – Monolithic versus layered versus SOA versus microservices</p>
<p>The selection<a id="_idIndexMarker004"/> of the most suitable application architecture is contingent upon your specific business requirements. We will explore four architectural options designed to facilitate digital transformation and tailored to meet general <span class="No-Break">business needs</span></p>
<h2 id="_idParaDest-19"><a id="_idTextAnchor019"/>Monolithic architecture</h2>
<p>A traditional <a id="_idIndexMarker005"/>architecture where the entire<a id="_idIndexMarker006"/> application is constructed as a unified and closely <span class="No-Break">integrated entity.</span></p>
<p>While it is easy to develop and deploy initially, scaling and maintaining it can pose challenges as the <span class="No-Break">project expands.</span></p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor020"/>N-Tier architecture (layered architecture)</h2>
<p>N-tier architecture, also<a id="_idIndexMarker007"/> known as a hierarchical structure with distinct layers, refers <a id="_idIndexMarker008"/>to a design approach for software systems that organizes the application into multiple layers, typically four: <em class="italic">Presentation</em>, <em class="italic">Business</em>, <em class="italic">Persistence</em>, and <em class="italic">Data</em>. This architectural model is commonly employed in enterprise applications to enhance maintainability by compartmentalizing and promoting modular development. Each layer has <span class="No-Break">specific responsibilities.</span></p>
<p>The <strong class="bold">Model-View-Controller</strong> (<strong class="bold">MVC</strong>) software design pattern<a id="_idIndexMarker009"/> separates an application into three interconnected components: Model (data and business logic), View (user interface), and Controller (handles user input and updates the Model and <span class="No-Break">View accordingly).</span></p>
<p>This segmentation facilitates scalability, ease of maintenance, and flexibility in adapting to changing <span class="No-Break">business requirements.</span></p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor021"/>SOA</h2>
<p>The <strong class="bold">service-oriented pattern</strong>, also known as <strong class="bold">Service-Oriented Architecture </strong>(<strong class="bold">SOA</strong>), is an <a id="_idIndexMarker010"/>architectural<a id="_idIndexMarker011"/> style that structures a software application as a collection of loosely coupled and independently <span class="No-Break">deployable services.</span></p>
<p>Before SOA came into use in the late 1990s, connecting an application to services housed in another system was a complex process involving <span class="No-Break">point-to-point integration.</span></p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor022"/>Microservices architecture</h2>
<p>Microservices derive<a id="_idIndexMarker012"/> from SOA, but SOA is<a id="_idIndexMarker013"/> different <span class="No-Break">from microservices.</span></p>
<p>This architecture involves fragmenting the application into small, autonomous services that communicate via APIs. It provides scalability, flexibility, and simplified maintenance, but introduces challenges in handling distributed <span class="No-Break">systems complexities.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">Historically, the emphasis was on functionality and statefulness, but now, the majority of consumer-oriented applications are transitioning<a id="_idIndexMarker014"/> to <strong class="bold">Software-as-a-Service</strong> (<strong class="bold">SaaS</strong>) and digital platforms. Presently, the focus in application design has shifted toward enhancing user experience, embracing statelessness, and <span class="No-Break">prioritizing agility.</span></p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor023"/>Choosing between traditional web applications and Single-Page Applications</h2>
<p>There are two primary approaches to constructing web applications in the contemporary landscape: conventional <a id="_idIndexMarker015"/>web applications, which execute most of the application logic on the server, and <strong class="bold">single-page applications</strong> (<strong class="bold">SPAs</strong>), which handle most of the user interface logic in a web browser and primarily communicate with the web server through web APIs. An alternative hybrid approach is feasible, wherein one or more feature-rich SPA-like sub-applications are hosted within a larger traditional <span class="No-Break">web application.</span></p>
<p>Select a <a id="_idIndexMarker016"/>traditional web application under the <span class="No-Break">following circumstances:</span></p>
<ul>
<li>Your application’s client-side requirements are straightforward or even limited to <span class="No-Break">read-only functionality</span></li>
<li>Your application needs to operate in browsers lacking <span class="No-Break">JavaScript support</span></li>
<li>Your application is publicly accessible and benefits from search engine visibility <span class="No-Break">and referrals</span></li>
</ul>
<p>Choose a <a id="_idIndexMarker017"/>SPA under the <span class="No-Break">following circumstances:</span></p>
<ul>
<li>Your application requires a sophisticated user interface with <span class="No-Break">numerous features</span></li>
<li>Your development team is well-versed in JavaScript, Angular, ReactJS, VueJS, TypeScript, <span class="No-Break">or WebAssembly</span></li>
<li>Your application already exposes an API for other clients, whether internal <span class="No-Break">or public</span></li>
</ul>
<p>The enhancements in user experience facilitated by the SPA approach should be carefully considered against <span class="No-Break">these factors.</span></p>
<p>In the next sections of the book, we will use a traditional Spring MVC application as an example to illustrate various <span class="No-Break">security principles.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">It’s important to note that these security principles apply to all the architectural styles discussed in <span class="No-Break">this chapter.</span></p>
<h1 id="_idParaDest-24"><a id="_idTextAnchor024"/>Understanding security audit</h1>
<p>It’s early in the morning at <a id="_idIndexMarker018"/>your job as a software developer for the <strong class="bold">Jim Bob Circle Pants Online Calendar</strong> (<strong class="source-inline">JBCPCalendar.com</strong>), and you’re halfway through your first cup of coffee when you get the following email from <span class="No-Break">your supervisor:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer009">
<img alt="Figure 1.2 – The email from the supervisor" height="561" src="image/B21757_01_2.jpg" width="1007"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – The email from the supervisor</p>
<p>What? You didn’t think about security when you designed the application? In fact, at this point, you are not even sure what<a id="_idIndexMarker019"/> a <strong class="bold">security audit</strong> is. Sounds like you’ll have a lot to learn from the security auditors! Later in this chapter, we will review what an audit is, along with the results of an audit. First, let’s spend a bit of time examining the applica<a id="_idTextAnchor025"/>tion that’s <span class="No-Break">under review.</span></p>
<h2 id="_idParaDest-25"><a id="_idTextAnchor026"/>Exploring the example application</h2>
<p>Although we’ll<a id="_idIndexMarker020"/> be working through a contrived scenario as we progress through this book, the design of the application and the changes that we’ll make to it are drawn from the real-world usage of Spring-based applications. The calendar application allows users to create and <span class="No-Break">view events:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<img alt="Figure 1.3 – The calendar application event information" height="579" src="image/B21757_01_3.jpg" width="543"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – The calendar application event information</p>
<p>After entering the details for a new event, you will be presented with the <span class="No-Break">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<img alt="Figure 1.4 – The calendar application summary" height="272" src="image/B21757_01_4.jpg" width="942"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – The calendar application summary</p>
<p>The application is designed to be simple to allow us to focus on the important aspects of security and not get tied up in the <a id="_idIndexMarker021"/>details of <strong class="bold">object-relational mapping </strong>(<strong class="bold">ORM</strong>) and complex UI techniques. We expect you to refer to other supplementary materials in the <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, <em class="italic">Additional Reference Material</em> (in the <em class="italic">Supplementary materials</em> section of this book) to cover some of the baseline functionality that is provided as part of the <span class="No-Break">example code.</span></p>
<p>The code is written in Spring and Spring Security 6, but it would be relatively easy to adapt many of the examples to other versions of Spring Security. Refer to the discussion about the detailed changes between Spring Security 4 and 6 in <a href="B21757_16.xhtml#_idTextAnchor512"><span class="No-Break"><em class="italic">Chapter 16</em></span></a>, <em class="italic">Migration to Spring Security 6</em>, for assistance in translating the examples to the Spring Security <span class="No-Break">6 syntax.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">Please don’t use this application as a baseline to build a real online calendar application. It has been purposely structured to be simple and to focus on the concepts a<a id="_idTextAnchor027"/>nd configurations that we illustrate in <span class="No-Break">this book.</span></p>
<p>In the next section, we will explore the <span class="No-Break">application architecture.</span></p>
<h2 id="_idParaDest-26"><a id="_idTextAnchor028"/>The JBCP calendar application architecture</h2>
<p>The web application follows a <a id="_idIndexMarker022"/>standard three-tier architecture consisting of a web, service, and data access layer, as indicated in the <span class="No-Break">following diagram:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<img alt="Figure 1.5 – JBCP calendar application architecture" height="701" src="image/B21757_01_5.jpg" width="671"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.5 – JBCP calendar application architecture</p>
<p>You can find additional material about MVC architectures in the <em class="italic">Supplementary materials</em> section of the <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, <em class="italic">Additional </em><span class="No-Break"><em class="italic">Reference Material</em></span><span class="No-Break">.</span></p>
<p>The web layer <a id="_idIndexMarker023"/>encapsulates MVC code and functionality. In this example application, we will use the Spring MVC framework, but we could just as easily<a id="_idIndexMarker024"/> use <strong class="bold">Spring Web Flow</strong> (<strong class="bold">SWF</strong>), <strong class="bold">Apache Struts</strong>, or <a id="_idIndexMarker025"/>even a <a id="_idIndexMarker026"/>Spring-friendly web stack, such as <span class="No-Break"><strong class="bold">Apache Wicket</strong></span><span class="No-Break">.</span></p>
<p>In a typical web application that uses Spring Security, the web layer is where much of the configuration and augmentation of code takes place. For example, the <strong class="source-inline">EventsController</strong> class is utilized to convert an HTTP request into the process of storing an event in the database. If you haven’t had a lot of experience with web applications and Spring MVC specifically, it would be wise to review the baseline code closely and make sure you understand it before we move on to more complex subjects. Again, we’ve tried to make the website as simple as possible, and the construction of a calendar application is used just to provide a sensible title and light structure to <span class="No-Break">the site.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">You can find detailed instructions on setting up the example application within the <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, <em class="italic">Additional </em><span class="No-Break"><em class="italic">Reference Material</em></span><span class="No-Break">.</span></p>
<p>The service layer <a id="_idIndexMarker027"/>encapsulates the business logic for the application. In our application, we use <strong class="source-inline">DefaultCalendarService</strong> as a very light facade over the data access layer to illustrate particular points about securing application service methods. The service layer is also used to operate on both Spring Security APIs and our Calendar APIs within a single method call. We will discuss this in greater detail in <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <span class="No-Break"><em class="italic">Custom Authentication</em></span><span class="No-Break">.</span></p>
<p>In a typical web application, the service layer incorporates business rule validation, composition and decomposition of business objects, and cross-cutting concerns such <span class="No-Break">as auditing.</span></p>
<p>The data access layer encapsulates the code responsible for manipulating the contents of database tables. In many Spring applications, this is where you would see an ORM, such as Hibernate or JPA. The data access layer exposes an object-based API to the service layer. In our application, we use basic JDBC functionality to achieve persistence in the in-memory H2 database. For example, <strong class="source-inline">JdbcEventDao</strong> is used to save event objects to <span class="No-Break">the database.</span></p>
<p>In a typical web application, a more comprehensive data access solution would be utilized. As ORM, and more generally data access, tends to be confusing for so<a id="_idTextAnchor029"/>me developers, this is an area we have chosen to simplify as much as possible <span class="No-Break">for clarity.</span></p>
<p>In the next section, we will review the <span class="No-Break">audit results.</span></p>
<h2 id="_idParaDest-27"><a id="_idTextAnchor030"/>Reviewing the audit results</h2>
<p>Let’s return to our email and <a id="_idIndexMarker028"/>see how the audit is progressing. Uh-oh… the results don’t <span class="No-Break">look good:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<img alt="Figure 1.6 – The email of the audit results" height="511" src="image/B21757_01_6.jpg" width="1007"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.6 – The email of the audit results</p>
<p><strong class="bold">APPLICATION AUDIT RESULTS</strong>: This application exhibits the following <span class="No-Break">insecure behavior:</span></p>
<ul>
<li>Inadvertent<a id="_idIndexMarker029"/> privilege escalation due to a lack of URL protection and <span class="No-Break">general authentication</span></li>
<li>Inappropriate or non-existent use <span class="No-Break">of authorization</span></li>
<li>Missing database <span class="No-Break">credential security</span></li>
<li>Personally identifiable or sensitive information is easily accessible <span class="No-Break">or unencrypted</span></li>
<li>Insecure transport-level protection due to lack of <span class="No-Break">SSL encryption</span></li>
</ul>
<p>The risk level is high. We recommend that this application should be taken offline until these issues can <span class="No-Break">be resolved.</span></p>
<p>Ouch! This result looks bad for our company. We’d better work to resolve these issues as quickly <span class="No-Break">as possible.</span></p>
<p>Third-party security specialists are often hired by companies (or their partners or customers) to audit the effectiveness of their software security through a combination of white hat hacking, source code review, and formal or informal conversations with application developers <span class="No-Break">and architects.</span></p>
<p><strong class="bold">White hat hacking</strong> or <strong class="bold">ethical hacking</strong> is done <a id="_idIndexMarker030"/>by professionals who are hired to instruct <a id="_idIndexMarker031"/>companies on how to protect themselves better, rather than with the intent to <span class="No-Break">be malicious.</span></p>
<p>Typically, the goal of <strong class="bold">security audits</strong> is to<a id="_idIndexMarker032"/> provide management or clients with the assurance that basic secure development practices have been followed to ensure the integrity and safety of the customer’s data and system functions. Depending on the industry the software is targeted at, the auditor may also test it using industry-specific standards or <span class="No-Break">compliance metrics.</span></p>
<p class="callout-heading">Important note</p>
<p class="callout">Two specific security standards that you’re<a id="_idIndexMarker033"/> likely to run into at some point in your career are the <strong class="bold">Payment Card Industry Data Security Standard</strong> (<strong class="bold">PCI DSS</strong>) and the <strong class="bold">Health Insurance Privacy and Accountability Act</strong> (<strong class="bold">HIPAA</strong>) privacy rules. Both these standards are intended to ensure the safety of specific <a id="_idIndexMarker034"/>sensitive information (such as credit card and medical information) through a combination of process and <span class="No-Break">software controls.</span></p>
<p class="callout">Many other industries and <a id="_idIndexMarker035"/>countries have similar rules about sensitive or <strong class="bold">Personally Identifiable Information</strong> (<strong class="bold">PII</strong>). Failure to follow these standards is not only bad practice but also something that could expose you or your company to significant liability (not to mention bad press) in the event of a <span class="No-Break">security breach.</span></p>
<p>Receiving the<a id="_idIndexMarker036"/> results of a <strong class="bold">security audit</strong> can be an eye-opening experience. Following through with the required software improvements can be the perfect opportunity for self-education and software improvement and can allow you to implement practices and policies that lead to <span class="No-Break">secure software.</span></p>
<p>In the next section, we will review the auditor’s findings and come up with a plan to address them <span class="No-Break">in detail.</span></p>
<h1 id="_idParaDest-28"><a id="_idTextAnchor031"/>Addressing the security audit findings</h1>
<p>In this section, we will <a id="_idIndexMarker037"/>meticulously examine the outcomes of our security audit, shedding light on the vulnerabilities and areas of concern within our application’s security landscape. We’ll dissect the audit results and embark on a journey to explore various effective strategies and patterns to secure and mitigate these identified risks. This chapter serves as a roadmap for enhancing the robustness of our application’s security, ensuring it stays resilient against potential threats <span class="No-Break">and vulnerabilities.</span></p>
<h2 id="_idParaDest-29"><a id="_idTextAnchor032"/>Authentication</h2>
<p>Authentication<a id="_idIndexMarker038"/> is one of two key security concepts that you must internalize when developing secure applications (the other being authorization). Authentication identifies who is attempting to request a resource. You may be familiar with authentication in your daily online and offline life, in very different contexts, <span class="No-Break">as follows:</span></p>
<ul>
<li><strong class="bold">Credential-based authentication</strong>: When you log in to your web-based email account, you most likely provide<a id="_idIndexMarker039"/> your username and password. The<a id="_idIndexMarker040"/> email provider matches your username with a known user in its database and verifies that your password matches what they have on record. These credentials are what the email system uses to validate that you are a valid user of the system. First, we’ll use this type of authentication to secure sensitive areas of the JBCP calendar application. Technically speaking, the email system can check credentials not only in the database but anywhere, for example, a corporate <a id="_idIndexMarker041"/>directory server such as <strong class="bold">Microsoft Active Directory</strong>. Several examples of this type of integration are covered throughout <span class="No-Break">this book.</span></li>
<li><strong class="bold">Two-factor authentication</strong>: When you <a id="_idIndexMarker042"/>withdraw money from your bank’s <a id="_idIndexMarker043"/>ATM, you swipe your ID card and enter your personal identification number before you are allowed to retrieve cash or conduct other transactions. This type of authentication is similar to username and password authentication, except that the username is encoded on the card’s magnetic strip. The combination of the physical card and user-entered PIN allows the bank to ensure that you have access to the account. The combination of a password and a physical device (your plastic ATM card) is a ubiquitous form of two-factor authentication. In a professional, security-conscious environment, it’s common to see these types of devices in regular use for access to highly secure systems, especially when dealing with finance information or PII. A hardware device, such<a id="_idIndexMarker044"/> as <strong class="bold">RSA SecurID</strong>, combines a time-based hardware device with server-based authentication software, making the environment <a id="_idIndexMarker045"/>extremely <a id="_idIndexMarker046"/>difficult <span class="No-Break">to compromise.</span></li>
<li><strong class="bold">Hardware authentication</strong>: When you <a id="_idIndexMarker047"/>start your car in the morning, you slip<a id="_idIndexMarker048"/> your metal key into the ignition and turn it to get the car started. Although it may not feel similar to the other two examples, the correct match of the bumps on the key and the tumblers in the ignition switch function as a form of <span class="No-Break">hardware authentication.</span></li>
</ul>
<p>There are literally dozens of forms of authentication that can be applied to the problem of software and hardware security, each with their own pros and cons. We’ll review some of these methods as they apply to Spring Security throughout the first half of this book. Our application lacks any type of authentication, which is why the audit included the risk of inadvertent <span class="No-Break">privilege escalation.</span></p>
<p>Typically, a software system will be divided into two <a id="_idIndexMarker049"/>high-level realms, such as unauthenticated (or anonymous) and authenticated, as shown in the <span class="No-Break">following screenshot:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<img alt="Figure 1.7 – High-level realms in a software system" height="435" src="image/B21757_01_7.jpg" width="1294"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.7 – High-level realms in a software system</p>
<p>Application <a id="_idIndexMarker050"/>functionality in the anonymous realm is the functionality that is independent of a user’s identity (think of a welcome page for an <span class="No-Break">online application).</span></p>
<p>Anonymous areas do not do <span class="No-Break">the following:</span></p>
<ul>
<li>Require a user to log in to the system or otherwise identify themselves to <span class="No-Break">be usable</span></li>
<li>Display sensitive information, such as names, addresses, credit cards, <span class="No-Break">and orders</span></li>
<li>Provide functionality to manipulate the overall state of the system or <span class="No-Break">its data</span></li>
</ul>
<p>Unauthenticated areas of the system are intended for use by everyone, even by users whom we haven’t specifically identified yet. However, it may be that additional functionality appears to identify users in these areas (for example, the ubiquitous <strong class="source-inline">Welcome {First Name}</strong> text). The selective displaying of content to authenticated users is fully supported through the use of the Spring Security tag library and is covered in <a href="B21757_11.xhtml#_idTextAnchor332"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Fine-Grained </em><span class="No-Break"><em class="italic">Access Control</em></span><span class="No-Break">.</span></p>
<p>We’ll resolve this finding and implement form-based authentication using the automatic configuration capability of Spring Security in <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>. Afterward, we will explore various other means of performing authentication (which usually revolves around system integration with enterprise or other external <span class="No-Break">authentication stores).</span></p>
<p>In the next section, we will <span class="No-Break">explore </span><span class="No-Break"><strong class="bold">authorization</strong></span><span class="No-Break">.</span></p>
<h2 id="_idParaDest-30"><a id="_idTextAnchor033"/>Authorization</h2>
<p>Authorization is the <a id="_idIndexMarker051"/>second of two core security concepts that are crucial in implementing and understanding application security. Authorization uses the information that was validated during authentication to determine whether access should be granted to a particular resource. Built around the authorization model for the application, authorization partitions the application functionality and data so that the availability of these items can be controlled by matching the combination of privileges, functionality, and data to users. Our application’s failure at this point of the audit indicates that the application’s functionality isn’t restricted by the user role. Imagine if you were running an e-commerce site and the ability to view, cancel, or modify orders and customer information was available to any user of <span class="No-Break">the site!</span></p>
<p>Authorization typically involves the following two separate aspects that combine to describe the accessibility of the <span class="No-Break">secured system:</span></p>
<ul>
<li>The first is the mapping of an <a id="_idIndexMarker052"/>authenticated principal to one or more authorities (often called <strong class="bold">roles</strong>). For example, a casual user of your website might be viewed as having visitor authority, while a site administrator might be assigned <span class="No-Break">administrative authority.</span></li>
<li>The second is the assignment of authority checks to secured resources in the system. This is typically done when the system is developed, either through an explicit declaration in code or through configuration parameters. For example, the screen that allows for the viewing of other users’ events should be made available only to those users with <span class="No-Break">administrative authority.</span></li>
</ul>
<p class="callout-heading">Important note</p>
<p class="callout">A secured resource may be any aspect of the system that should be conditionally available based on the authority of <span class="No-Break">the user.</span></p>
<p>Secured resources of a web-based application could be individual web pages, entire portions of the website, or portions of individual pages. Conversely, secured business resources might be method calls on classes or individual <span class="No-Break">business objects.</span></p>
<p>You might imagine an authority check that would examine the principal (the identity of the current user or system interacting with the application), look up its user account, and determine whether the principal is, in fact, an administrator. If this authority check determines that the principal who is attempting to access the secured area is, in fact, an administrator, then the request will succeed. If, however, the principal does not have sufficient authority, the request should <span class="No-Break">be denied.</span></p>
<p>Let’s take a closer look at <a id="_idIndexMarker053"/>an example of a particular secured resource, the <strong class="bold">All Events</strong> page. The <strong class="bold">All Events</strong> page requires administrative access (after all, we don’t want regular users viewing other users events), and as such, looks for a certain level of authority in the principal <span class="No-Break">accessing it.</span></p>
<p>If we think about how a decision might be made when a site administrator attempts to access the protected resource, we’d imagine that the examination of the actual authority versus the required authority might be expressed concisely in terms of the set theory. We might then choose to represent this decision as a <strong class="bold">Venn</strong> diagram for the <span class="No-Break">administrative user:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<img alt="Figure 1.8 – Venn diagram for the administrative user" height="849" src="image/B21757_01_8.jpg" width="1129"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.8 – Venn diagram for the administrative user</p>
<p>There is an intersection between <strong class="bold">User Authorities</strong> (users and administrators) and <strong class="bold">Required Authorities</strong> (administrators) for the page, so the user is provided <span class="No-Break">with access.</span></p>
<p>Contrast this with an unauthorized user, <span class="No-Break">as follows:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<img alt="Figure 1.9 – Venn diagram for the visiting (unauthorized) user" height="849" src="image/B21757_01_9.jpg" width="1126"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.9 – Venn diagram for the visiting (unauthorized) user</p>
<p>We have a <a id="_idIndexMarker054"/>Symmetric difference. The sets of authorities are disjointed and have no common elements. So, the user is denied access to the page. Thus, we have demonstrated the basic principle of the authorization of access <span class="No-Break">to resources.</span></p>
<p>In reality, there’s real code making this decision, with the consequence that the user is granted or denied access to the requested protected resource. We’ll address the basic authorization problem with the authorization infrastructure of Spring Security in <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, followed by more advanced authorization in <a href="B21757_12.xhtml#_idTextAnchor375"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, <em class="italic">Access Control Lists</em>, and <a href="B21757_13.xhtml#_idTextAnchor415"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>, <span class="No-Break"><em class="italic">Custom Authorization</em></span><span class="No-Break">.</span></p>
<p>Now that we have covered the concept of authorization, we will explore how it can be applied to <span class="No-Break">database security.</span></p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor034"/>Database credential security</h2>
<p>In Spring terminology, database <a id="_idIndexMarker055"/>credentials typically refer to the information required to establish a connection between a Spring application and a database. These credentials include <span class="No-Break">the following:</span></p>
<ul>
<li>Username: The username or user ID associated with the database account that the Spring application uses <span class="No-Break">to connect.</span></li>
<li>Password: The corresponding password for the specified username, providing authentication for access to <span class="No-Break">the database.</span></li>
<li>Database URL: The URL that specifies the location and details of the database. It includes information such as the host, port, and <span class="No-Break">database name.</span></li>
</ul>
<p>Through the examination of the application source code and configuration files, the auditors noted that user passwords were stored in plain text in the configuration files, making it very easy for a malicious user with access to the server to gain access to <span class="No-Break">the application.</span></p>
<p>As the application contains personal and financial data, a rogue user being able to access any data could expose the company to identity theft or tampering. Protecting access to the credentials used to access the application should be a top priority for us, and an important first step is ensuring that one point of failure in security does not compromise the <span class="No-Break">entire system.</span></p>
<p>We’ll examine the <a id="_idIndexMarker056"/>configuration of database access layers in Spring Security for credential storage, which requires <strong class="bold">JDBC connectivity</strong>, in <a href="B21757_04.xhtml#_idTextAnchor106"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">JDBC-</em><em class="italic">b</em><em class="italic">ased Authentication</em>. In the same <a id="_idIndexMarker057"/>chapter, we’ll also look at built-in <a id="_idTextAnchor035"/>techniques to increase the security of passwords stored in <span class="No-Break">the database.</span></p>
<p>After covering the database credential security, we will explore the sensitive information <span class="No-Break">audit finding.</span></p>
<h2 id="_idParaDest-32"><a id="_idTextAnchor036"/>Sensitive information</h2>
<p>Personally identifiable or sensitive information<a id="_idIndexMarker058"/> is easily accessible or unencrypted. The auditors noted that some significant and sensitive pieces of data were completely unencrypted or masked anywhere in the system. Fortunately, there are some simple design patterns and tools that allow<a id="_idIndexMarker059"/> us to protec<a id="_idTextAnchor037"/>t this information securely, with annotation-based <strong class="bold">Aspect-Oriented</strong><strong class="bold"> Programming</strong> (<strong class="bold">AOP</strong>) support in <span class="No-Break">Spring Security.</span></p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor038"/>Transport-level protection</h2>
<p>There is insecure transport-level protection<a id="_idIndexMarker060"/> due to the lack of <span class="No-Break">SSL encryption.</span></p>
<p>While, in the real world, it’s unthinkable that an online application containing private information would operate without SSL protection, unfortunately, the JBCP calendar is in just this situation. SSL protection ensures that communication between the browser client and the web application server is secure against many kinds of tampering <span class="No-Break">and snooping.</span></p>
<p>In the <em class="italic">HTTPS setup in Tomcat</em> section, in the <a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, <em class="italic">Additional Reference Material</em>, we’ll review the basic options for using transport-level security as part of the definition of the secured structure of <span class="No-Break">the application.</span></p>
<h2 id="_idParaDest-34"><a id="_idTextAnchor039"/>Using Spring Security 6 to address security concerns</h2>
<p><strong class="bold">Spring Security 6</strong> provides <a id="_idIndexMarker061"/>a wealth of resources that allow many common security practices to be declared or configured in a straightforward manner. In the coming chapters, we’ll apply a combination of source code and application configuration changes to address all of the concerns raised by the security auditors (and more) to give ourselves the confidence that our calendar application <span class="No-Break">is secure.</span></p>
<p>With Spring Security 6, we’ll be able to make the following changes to improve our <span class="No-Break">application’s security:</span></p>
<ul>
<li>Segment users of the system into <span class="No-Break">user classes</span></li>
<li>Assign levels of authorization to <span class="No-Break">user roles</span></li>
<li>Assign user roles to <span class="No-Break">user classes</span></li>
<li>Apply authentication rules globally across <span class="No-Break">application resources</span></li>
<li>Apply authorization rules at all levels of the <span class="No-Break">application architecture</span></li>
<li>Prevent common types of atta<a id="_idTextAnchor040"/>cks intended to manipulate or steal a <span class="No-Break">user’s session</span></li>
</ul>
<p>Spring Security exists to fill a gap in the universe of Java third-party libraries, much as the Spring Framework originally did when it was first introduced. Standards such as <strong class="bold">Java Authentication and Authorization Service</strong> (<strong class="bold">JAAS</strong>) or <strong class="bold">Jakarta EE Security</strong> do offer some<a id="_idIndexMarker062"/> ways of <a id="_idIndexMarker063"/>performing some of the same authentication and authorization functions, but Spring Security is a winner because it includes everything you need to implement a top-to-bottom application security solution concisely <span class="No-Break">and sensibly.</span></p>
<p>Additionally, Spring Security <a id="_idIndexMarker064"/>appeals to many because it offers out-of-the-box integration with many common enterprise authentication systems, so it’s adaptable to most situations with little effort (beyond configuration) on the part of the developer. It’s in wide use because there’s really no other mainstream framework quite <span class="No-Break">like it!</span></p>
<h1 id="_idParaDest-35"><a id="_idTextAnchor041"/>Technical requirements</h1>
<p>We have endeavored to make the application as easy to run as possible by focusing on some basic tools and technologies that almost every Spring developer would have on their development machine. Nevertheless, we have provided the <em class="italic">Getting started</em> section as supplementary information in the <em class="italic">Getting started with the JBCP calendar sample code </em>section<em class="italic"> </em>in the<em class="italic"> </em><a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a><em class="italic">, Additional </em><span class="No-Break"><em class="italic">Reference Material.</em></span></p>
<p>The primary method for integrating with the sample code is providing projects that are compatible with <strong class="bold">Gradle</strong> and <strong class="bold">Maven</strong>. Since many<a id="_idIndexMarker065"/> IDEs have rich integration with Gradle and <a id="_idIndexMarker066"/>Maven, users should be able to import the code into any IDE that supports either Gradle or Maven. As many developers use Gradle and Maven, we felt this was the most straightforward method of packaging the examples. Whatever development environment you are familiar with, hopefully, you will find a way to work through the examples in <span class="No-Break">this book.</span></p>
<p>Many IDEs provide Gradle or Maven tooling that can automatically download the Spring and Spring Security 6 Javadoc and source code for you. However, there may be times when this is not possible. In such cases, you’ll want to download the full releases of both Spring 6 and Spring Security 6. The Javadoc and source code are top-notch. If you get confused or want more information, the samples can provide an additional level of support or reassurance for your learning. Visit the <em class="italic">Supplementary materials</em> section in the<em class="italic"> </em><a href="B21757_20.xhtml#_idTextAnchor642"><em class="italic">Appendix</em></a>, <em class="italic">Additional Reference Material</em>, to find additional information about Gradle and Maven, including running the samples, and obtaining the source code <span class="No-Break">and Javadoc.</span></p>
<p>To run the sample application, you will need an <strong class="bold">Integrated Development Environments </strong>(<strong class="bold">IDEs</strong>) such as<a id="_idIndexMarker067"/> IntelliJ IDEA or Eclipse and build it with Gradle or Maven, which don’t have strict hardware requirements. However, these are some general recommendations to ensure a smooth <span class="No-Break">development experience:</span></p>
<ul>
<li><span class="No-Break">System requirements:</span><ul><li>A modern computer with at least 4GB of RAM (8GB or more <span class="No-Break">is recommended)</span></li><li>A multi-core processor for faster build <span class="No-Break">and development</span></li></ul></li>
<li>Operating system: Spring applications can be developed on Windows, macOS, or Linux. Choose the one that you are most <span class="No-Break">comfortable with.</span></li>
<li>IDE: IntelliJ IDEA and Eclipse are both popular choices for Spring development. Make sure your IDE is up <span class="No-Break">to date.</span></li>
<li><strong class="bold">Java Development Kit</strong> (<strong class="bold">JDK</strong>): Spring applications require a minimum of Java 17. Install the latest <a id="_idIndexMarker068"/>JDK version compatible with <span class="No-Break">your IDE.</span><p class="list-inset">Upon the publication of this book, all the code has been validated with Java 21, the most recent <strong class="bold">Long-Term Support</strong> (<span class="No-Break"><strong class="bold">LTS</strong></span><span class="No-Break">) version.</span></p></li>
<li>Disk space: You will need disk space for your project files, dependencies, and any databases you might use. At least 10 GB of free disk space <span class="No-Break">is advisable.</span></li>
<li>Network connection: A stable internet connection may be needed for downloading dependencies, plugins, and libraries during <span class="No-Break">project setup.</span></li>
</ul>
<p class="callout-heading">Important note</p>
<p class="callout">You can now look at the sample code of the JBCP calendar <span class="No-Break">application: </span><span class="No-Break"><strong class="source-inline">chapter01.00-calendar</strong></span><span class="No-Break">.</span></p>
<p class="callout">From <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Custom Authentication</em> onwards, we shift our emphasis to delve deeper into <strong class="source-inline">spring-security</strong>, particularly in conjunction with the <span class="No-Break"><strong class="source-inline">spring-boot</strong></span><span class="No-Break"> framework.</span></p>
<p>If <strong class="source-inline">Maven</strong> is your choice, run the following command with Maven from the <span class="No-Break">project directory:</span></p>
<pre class="console">
./mvnw package cargo:run</pre> <p>If you are using <strong class="source-inline">Gradle</strong>, run the following command from the <span class="No-Break">project directory:</span></p>
<pre class="console">
./gradlew tomcatRun</pre> <p>Then open a browser <span class="No-Break">at </span><span class="No-Break"><strong class="source-inline">http://localhost:8080/</strong></span><span class="No-Break">.</span></p>
<h1 id="_idParaDest-36"><a id="_idTextAnchor042"/>Summary</h1>
<p>In this chapter, we have reviewed the common points of risk in an unsecured web application and the basic architecture of our example application. We began by scrutinizing the audit results, highlighting the areas of concern and potential vulnerabilities. The chapter then branched into key security concepts, including <strong class="bold">authentication</strong>, <strong class="bold">authorization</strong>, and <strong class="bold">database credential security</strong>. We also discussed the strategies for securing the application based on the <span class="No-Break">spring framework.</span></p>
<p>In the next chapter, we’ll explore how to get <strong class="bold">Spring Security</strong> set up quickly and get a basic understanding of how <span class="No-Break">it works.</span></p>
</div>
</div></body></html>