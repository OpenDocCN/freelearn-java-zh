<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Understanding the Project Object Model (POM)"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Understanding the Project Object Model (POM)</h1></div></div></div><p>POM is at the heart of any Maven project. This chapter focuses on the core concepts and best practices related to POM in building a large-scale, multi-module Maven project.</p><p>As we proceed with this chapter, the following topics will be covered in detail:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The POM hierarchy, super POM, and parent POM</li><li class="listitem" style="list-style-type: disc">Extending and overriding POM files</li><li class="listitem" style="list-style-type: disc">Maven coordinates</li><li class="listitem" style="list-style-type: disc">Managing dependencies</li><li class="listitem" style="list-style-type: disc">Transitive dependencies</li><li class="listitem" style="list-style-type: disc">Dependency scopes and optional dependencies</li></ul></div><div class="section" title="Project Object Model (POM)"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Project Object Model (POM)</h1></div></div></div><p>Any Maven <a id="id58" class="indexterm"/>project must have a <code class="literal">pom.xml</code> file. POM is the Maven project descriptor just like the <code class="literal">web.xml</code> file in your Java EE web application, or the <code class="literal">build.xml</code> file in your Ant project. The following code lists out all the key elements in a Maven <code class="literal">pom.xml</code> file. As we proceed with the book, we will discuss how to use each element in the most effective manner:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;parent&gt;...&lt;/parent&gt;   

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;     
  &lt;groupId&gt;...&lt;/groupId&gt;   
  &lt;artifactId&gt;...&lt;/artifactId&gt;   
  &lt;version&gt;...&lt;/version&gt;   
  &lt;packaging&gt;...&lt;/packaging&gt;
   
  &lt;name&gt;...&lt;/name&gt;   
  &lt;description&gt;...&lt;/description&gt;   
  &lt;url&gt;...&lt;/url&gt;   
  &lt;inceptionYear&gt;...&lt;/inceptionYear&gt;   
  &lt;licenses&gt;...&lt;/licenses&gt;   
  &lt;organization&gt;...&lt;/organization&gt;   &lt;developers&gt;...&lt;/developers&gt;   
  &lt;contributors&gt;...&lt;/contributors&gt;    


  &lt;dependencies&gt;...&lt;/dependencies&gt;   
  &lt;dependencyManagement&gt;...&lt;/dependencyManagement&gt;
  &lt;modules&gt;...&lt;/modules&gt;   
  &lt;properties&gt;...&lt;/properties&gt;    

  &lt;build&gt;...&lt;/build&gt;   
  &lt;reporting&gt;...&lt;/reporting&gt; 
   
  &lt;issueManagement&gt;...&lt;/issueManagement&gt;   &lt;ciManagement&gt;...&lt;/ciManagement&gt;   &lt;mailingLists&gt;...&lt;/mailingLists&gt;   
  &lt;scm&gt;...&lt;/scm&gt;   
  &lt;prerequisites&gt;...&lt;/prerequisites&gt;     
  
  &lt;repositories&gt;...&lt;/repositories&gt;   &lt;pluginRepositories&gt;...&lt;/pluginRepositories&gt;   

  &lt;distributionManagement&gt;...&lt;/distributionManagement&gt;  

  &lt;profiles&gt;...&lt;/profiles&gt;
&lt;/project&gt;</pre></div><p>The following <a id="id59" class="indexterm"/>code shows a sample <code class="literal">pom.xml</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-scm-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9&lt;/version&gt;
        &lt;configuration&gt;
          &lt;connectionType&gt;connection&lt;/connectionType&gt;
        &lt;/configuration&gt;
	  &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
  
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
      &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
      &lt;version&gt;2.26&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;</pre></div></div></div>
<div class="section" title="POM hierarchy"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>POM hierarchy</h1></div></div></div><p>POM files maintain a <a id="id60" class="indexterm"/>parent-child relationship between them. A child POM file inherits all the configuration elements from its parent POM. Using this trick, Maven sticks to its design philosophy <span class="emphasis"><em>convention over configuration</em></span>. The minimal POM configuration for any Maven project is extremely simple, which is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;sample-one&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/project&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div></div>
<div class="section" title="Super POM"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Super POM</h1></div></div></div><p>Any POM file can <a id="id61" class="indexterm"/>point to its parent POM. In case the parent POM element is missing, there is a system wide POM file that is automatically treated as the <a id="id62" class="indexterm"/>parent POM. This POM file is well known as the <span class="strong"><strong>super POM</strong></span>. Ultimately, all the application POM files get extended from the super POM. The super POM file is at the top of the POM hierarchy and is bundled inside <code class="literal">MAVEN_HOME/lib/maven-model-builder-3.3.3.jar - org/apache/maven/model/pom-4.0.0.xml</code>. In Maven 2, this was bundled inside <code class="literal">maven-2.X.X-uber.jar</code>. All the default configurations are defined in the super POM file. Even the simplest form of a POM file will inherit all the configurations defined in the super POM file. Whatever configuration you need to override, you can do it by redefining the same section in your <a id="id63" class="indexterm"/>application POM file. The following lines of code show the super POM file configuration, which comes with Maven 3.3.3:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</pre></div><p>The Maven central is the only repository defined under the <span class="emphasis"><em>repositories</em></span> section. It will be inherited by all the Maven application modules. Maven uses these repositories defined under the <span class="emphasis"><em>repositories</em></span> section to download all the dependent artifacts during a Maven build. The following code <a id="id64" class="indexterm"/>snippet shows the configuration block in <code class="literal">pom.xml</code>, which is used to define repositories:</p><div class="informalexample"><pre class="programlisting">  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;central&lt;/id&gt;
      &lt;name&gt;Central Repository&lt;/name&gt;
      &lt;url&gt;http://repo.maven.apache.org/maven2&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
      &lt;/snapshots&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>There are two types of repositories in Maven: local and remote. The local repository is maintained in your local machine—by default at <code class="literal">USER_HOME/.m2/repository</code>. Anything that you build locally with <code class="literal">mvn install</code> will get deployed into the local repository. When you start with a fresh Maven repository, it will be empty. You need to download everything—from the simplest <code class="literal">maven-compiler-plugin</code> to all your project dependencies. A Maven build can either be an online or offline build. By default, it is an online build, unless you add <code class="literal">-o</code> into your Maven build command. If it's an offline build, Maven assumes that all the related artifacts are readily available in the local Maven repository; if not, it will complain. If it is an online build, Maven will download the artifacts from remote repositories and store them in the local repository. The Maven local repository location can be changed to a preferred location by editing <code class="literal">MAVEN_HOME/conf/settings.xml</code> to update the value of the <code class="literal">localRepository</code> element:</p><div class="informalexample"><pre class="programlisting">&lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</pre></div></div></div><p>Plugin repositories <a id="id65" class="indexterm"/>define where to find Maven plugins. We'll be talking about Maven plugins in <a class="link" href="ch04.html" title="Chapter 4. Maven Plugins">Chapter 4</a>, <span class="emphasis"><em>Maven Plugins</em></span>. The following code snippet shows the configuration related to the plugin repositories:</p><div class="informalexample"><pre class="programlisting">  &lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
      &lt;id&gt;central&lt;/id&gt;
      &lt;name&gt;Central Repository&lt;/name&gt;
      &lt;url&gt;http://repo.maven.apache.org/maven2&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
      &lt;/snapshots&gt;
      &lt;releases&gt;
        &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
      &lt;/releases&gt;
    &lt;/pluginRepository&gt;
  &lt;/pluginRepositories&gt;</pre></div><p>The <code class="literal">build</code> configuration section includes all the information required to build a project:</p><div class="informalexample"><pre class="programlisting">  &lt;build&gt;
    &lt;directory&gt;${project.basedir}/target&lt;/directory&gt;
    &lt;outputDirectory&gt;${project.build.directory}/classes
    &lt;/outputDirectory&gt;
    &lt;finalName&gt;${project.artifactId}-${project.version}
    &lt;/finalName&gt;
    &lt;testOutputDirectory&gt;${project.build.directory}/test-classes
    &lt;/testOutputDirectory&gt;
    &lt;sourceDirectory&gt;${project.basedir}/src/main/java
    &lt;/sourceDirectory&gt;
    &lt;scriptSourceDirectory&gt;${project.basedir}/src/main/scripts
    &lt;/scriptSourceDirectory&gt;
    &lt;testSourceDirectory&gt;${project.basedir}/src/test/java
    &lt;/testSourceDirectory&gt;

    &lt;resources&gt;
      &lt;resource&gt;
        &lt;directory&gt;${project.basedir}/src/main/resources
        &lt;/directory&gt;
      &lt;/resource&gt;
    &lt;/resources&gt;
    &lt;testResources&gt;
      &lt;testResource&gt;
        &lt;directory&gt;${project.basedir}/src/test/resources
        &lt;/directory&gt;
      &lt;/testResource&gt;
    &lt;/testResources&gt;

    &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
          &lt;version&gt;1.3&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.2-beta-5&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.8&lt;/version&gt;
        &lt;/plugin&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;
          &lt;version&gt;2.3.2&lt;/version&gt;
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/pluginManagement&gt;

  &lt;/build&gt;</pre></div><p>The <code class="literal">reporting</code> section includes the details of report plugins, which are used to generate reports and are later <a id="id66" class="indexterm"/>displayed on the site generated by Maven. The super POM only provides a default value for the output directory:</p><div class="informalexample"><pre class="programlisting">  &lt;reporting&gt;
    &lt;outputDirectory&gt;${project.build.directory}/site
    &lt;/outputDirectory&gt;
  &lt;/reporting&gt;</pre></div><p>The following code snippet defines the default build profile. When no profiles are defined at the application <a id="id67" class="indexterm"/>level, the default build profile will get executed. We will be talking about profiles in <a class="link" href="ch07.html" title="Chapter 7. Best Practices">Chapter 7</a>, <span class="emphasis"><em>Best Practices</em></span>:</p><div class="informalexample"><pre class="programlisting">  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;release-profile&lt;/id&gt;

      &lt;activation&gt;
        &lt;property&gt;
          &lt;name&gt;performRelease&lt;/name&gt;
          &lt;value&gt;true&lt;/value&gt;
        &lt;/property&gt;
      &lt;/activation&gt;

      &lt;build&gt;
        &lt;plugins&gt;
          &lt;plugin&gt;
            &lt;inherited&gt;true&lt;/inherited&gt;
            &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;attach-sources&lt;/id&gt;
                &lt;goals&gt;
                  &lt;goal&gt;jar&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
          &lt;plugin&gt;
            &lt;inherited&gt;true&lt;/inherited&gt;
            &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
            &lt;executions&gt;
              &lt;execution&gt;
                &lt;id&gt;attach-javadocs&lt;/id&gt;
                &lt;goals&gt;
                  &lt;goal&gt;jar&lt;/goal&gt;
                &lt;/goals&gt;
              &lt;/execution&gt;
            &lt;/executions&gt;
          &lt;/plugin&gt;
          &lt;plugin&gt;
            &lt;inherited&gt;true&lt;/inherited&gt;
            &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
            &lt;configuration&gt;
              &lt;updateReleaseInfo&gt;true&lt;/updateReleaseInfo&gt;
            &lt;/configuration&gt;
          &lt;/plugin&gt;
        &lt;/plugins&gt;
      &lt;/build&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
  
&lt;/project&gt;</pre></div><p>The following figure <a id="id68" class="indexterm"/>shows an abstract view of the super POM file with key configuration elements:</p><div class="mediaobject"><img src="graphics/B02157_02_01.jpg" alt="Super POM"/></div></div>
<div class="section" title="POM extending and overriding"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>POM extending and overriding</h1></div></div></div><p>Let's see how <a id="id69" class="indexterm"/>POM overriding works. In the <a id="id70" class="indexterm"/>following example, we extend the <code class="literal">repositories</code> section to add one more repository than what is defined in the Maven super POM:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;sample-one&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;

  &lt;repositories&gt;
<span class="strong"><strong>    &lt;repository&gt;</strong></span>
<span class="strong"><strong>      &lt;id&gt;wso2-nexus&lt;/id&gt;</strong></span>
<span class="strong"><strong>      &lt;name&gt;WSO2 internal Repository&lt;/name&gt; </strong></span>
<span class="strong"><strong>      &lt;url&gt;http://maven.wso2.org/nexus/content/</strong></span>
<span class="strong"><strong>                                       groups/wso2-public/</strong></span>
<span class="strong"><strong>      &lt;/url&gt;</strong></span>
<span class="strong"><strong>      &lt;releases&gt;</strong></span>
<span class="strong"><strong>        &lt;enabled&gt;true&lt;/enabled&gt;</strong></span>
<span class="strong"><strong>        &lt;updatePolicy&gt;daily&lt;/updatePolicy&gt;</strong></span>
<span class="strong"><strong>        &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;</strong></span>
<span class="strong"><strong>      &lt;/releases&gt;</strong></span>
<span class="strong"><strong>    &lt;/repository&gt;</strong></span>
  &lt;/repositories&gt;

&lt;/project&gt;</pre></div><p>Execute the following command from the directory where the above POM file is located:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn help:effective-pom</strong></span>
</pre></div><p>This will display the <a id="id71" class="indexterm"/>effective POM for the application, which <a id="id72" class="indexterm"/>combines all the default settings from the super POM file and the configuration defined in your application POM. In the following code snippet, you can see that the <code class="literal">&lt;repositories&gt;</code> section in the super POM file is being extended by your application-specific configuration. Now, the <code class="literal">&lt;repositories&gt;</code> section has the central repository defined in the super POM as well as your application-specific repository:</p><div class="informalexample"><pre class="programlisting">&lt;repositories&gt;
  &lt;repository&gt;
    &lt;releases&gt;
      &lt;enabled&gt;true&lt;/enabled&gt;
      &lt;updatePolicy&gt;daily&lt;/updatePolicy&gt;
      &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
    &lt;/releases&gt;
    &lt;id&gt;wso2-nexus&lt;/id&gt;
    &lt;name&gt;WSO2 internal Repository&lt;/name&gt;
    &lt;url&gt;
      http://maven.wso2.org/nexus/content/groups/wso2-public/
    &lt;/url&gt;
  &lt;/repository&gt;
  &lt;repository&gt;
    &lt;snapshots&gt;
      &lt;enabled&gt;false&lt;/enabled&gt;
    &lt;/snapshots&gt;
    &lt;id&gt;central&lt;/id&gt;
    &lt;name&gt;Central Repository&lt;/name&gt;
    &lt;url&gt;https://repo.maven.apache.org/maven2&lt;/url&gt;
  &lt;/repository&gt;
&lt;/repositories&gt;</pre></div><p>If you want to override any of the configuration elements corresponding to the Maven central repository inherited from the super POM file, then you have to define a repository in your application POM with the same repository <code class="literal">id</code> (as of the Maven central repository), and override the configuration element that you need.</p><p>One main advantage of the POM hierarchy in Maven is that you can extend as well as override the <a id="id73" class="indexterm"/>configuration inherited from the top. Say, for <a id="id74" class="indexterm"/>example, that you may need to keep all the plugins defined in the super POM, but just want to override the <code class="literal">version</code> of <code class="literal">maven-release-plugin</code>. The following configuration shows how to do it. By default, in the super POM, the <code class="literal">maven-release-plugin</code> version is 2.3.2, and here, we update it to 2.5 in our application POM. If you run <code class="literal">mvn help:effective-pom</code> again against the updated POM file, you will notice that the plugin <code class="literal">version</code> is updated, whereas the rest of the plugin configuration from the super POM remains unchanged:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;sample-one&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;

  &lt;build&gt;
    &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
          &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;
          <span class="strong"><strong>&lt;version&gt;2.5&lt;/version&gt;</strong></span>
        &lt;/plugin&gt;
      &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
  &lt;/build&gt;

&lt;/project&gt;</pre></div><p>To override the <a id="id75" class="indexterm"/>configuration of a given element or an <a id="id76" class="indexterm"/>artifact in the POM hierarchy, Maven should be able to uniquely identify the corresponding artifact. In the preceding scenario, the plugin was identified by its <code class="literal">artifactId</code>. In <a class="link" href="ch04.html" title="Chapter 4. Maven Plugins">Chapter 4</a>, <span class="emphasis"><em>Maven Plugins</em></span> we will further discuss how Maven locates plugins.</p></div>
<div class="section" title="Maven coordinates"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Maven coordinates</h1></div></div></div><p>Maven <a id="id77" class="indexterm"/>coordinates uniquely identify a project, dependency, or plugin defined in a POM. Each entity is uniquely identified by the combination of a group identifier, artifact identifier, and the version (and, of course, with the packaging and the classifier). The group identifier is a way of grouping different Maven artifacts. For example, a set of artifacts produced by a company can be grouped under the same group identifier. The artifact identifier is the way you identify an artifact, which could be a JAR, WAR, or any type of an artifact uniquely identified within a given group. The <code class="literal">version</code> element lets you keep the same artifact in different versions in the same repository.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>A valid Maven POM file must have <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">version</code>. The <code class="literal">groupId</code> and <code class="literal">version</code> elements can also be inherited from the parent POM.</p></div></div><p>All the three coordinates of a given Maven artifact are used to define its path in the Maven repository. If we take the following example, the corresponding JAR file is installed into the local repository with the path <code class="literal">M2_REPO/repository/com/packt/sample-one/1.0.0/</code>:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;com.packt&lt;/groupId&gt;
&lt;artifactId&gt;sample-one&lt;/artifactId&gt;
&lt;version&gt;1.0.0&lt;/version&gt;</pre></div><p>If you have gone through the elements of the super POM file carefully, you might have noticed that it does not have any of the previously mentioned elements—no <code class="literal">groupId</code>, <code class="literal">artifactId</code>, or <code class="literal">version</code>. Does this mean that the super POM file is not a valid POM? The super POM file is similar to an abstract class in Java. It does not work by itself; it must be inherited by a child POM. Another way to look at the super POM file is that it's the Maven's way of sharing default configurations.</p><p>Once again, if you look at the <code class="literal">&lt;pluginManagement&gt;</code> section of the super POM, as shown in the following code snippet, you will notice that a given plugin artifact is only identified by its <code class="literal">artifactId</code> and <code class="literal">version</code> elements. This contradicts what was mentioned before: a given artifact is uniquely identified by the combination of <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">version</code>. How is this possible?</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.3&lt;/version&gt;
&lt;/plugin&gt;</pre></div><p>There is an exception for <a id="id78" class="indexterm"/>plugins. You need not specify <code class="literal">groupId</code> for a plugin in the POM file—it is optional. By default, Maven uses <code class="literal">org.apache.maven.plugins</code> or <code class="literal">org.codehaus.mojo</code> as <code class="literal">groupId</code>. Have a look at the following section in <code class="literal">MAVEN_HOME/conf/settings.xml</code>. Everything that you define in this file will be globally applicable for all the Maven builds, which run in the corresponding machine. In case you want to keep the configuration at user level (in a multi-user environment), you can simply copy the <code class="literal">settings.xml</code> file from <code class="literal">MAVEN_HOME/conf</code> to <code class="literal">USER_HOME/.m2</code>. If you want to add the additional <code class="literal">groupId</code> elements for plugin lookup, you will have to uncomment the following section and add them there:</p><div class="informalexample"><pre class="programlisting">  &lt;!-- pluginGroups
   | This is a list of additional group identifiers that 
   | will be searched when resolving plugins by their prefix, i.e.
   | when invoking a command line like "mvn prefix:goal". 
   | Maven will automatically add the group identifiers
   | "org.apache.maven.plugins" and "org.codehaus.mojo" 
   | if these are not already contained in the list.
   |--&gt;
  &lt;pluginGroups&gt;
    &lt;!-- pluginGroup
     | Specifies a further group identifier to use for plugin
     | lookup.
    <span class="strong"><strong>&lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</strong></span>
    --&gt;
  &lt;/pluginGroups&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>We will be discussing Maven plugins in detail in <a class="link" href="ch04.html" title="Chapter 4. Maven Plugins">Chapter 4</a>, <span class="emphasis"><em>Maven Plugins</em></span>.</p></div></div></div>
<div class="section" title="The parent POM"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>The parent POM</h1></div></div></div><p>When we deal with <a id="id79" class="indexterm"/>hundreds of Maven modules, we need to structure the project to avoid any redundancies or duplicate configurations. If not, it will lead to a huge maintenance nightmare. Let's have a look at some popular open <a id="id80" class="indexterm"/>source projects.</p><p>The WSO2 Carbon Turing project, available at <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/</a>, has more than 1000 Maven modules. Anyone who downloads the source code from the root should be able to build it with all the components. The <code class="literal">pom.xml</code> file at the root acts as a module aggregating POM. It defines all the Maven modules that need to be built under the <code class="literal">&lt;modules&gt;</code> element. Each module element defines the relative path (from the root POM) to the corresponding Maven module. There needs to be another POM file under the defined relative path. The root POM in the WSO2 Carbon Turing project only acts as an aggregator module. It does not build any parent-child relationship with other Maven modules. The following code snippet shows the module configuration in the root <code class="literal">pom.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;modules&gt;
  &lt;module&gt;parent&lt;/module&gt;
  &lt;module&gt;dependencies&lt;/module&gt;
  &lt;module&gt;service-stubs&lt;/module&gt;
  &lt;module&gt;components&lt;/module&gt;
  &lt;module&gt;platform-integration/clarity-framework&lt;/module&gt;
  &lt;module&gt;features&lt;/module&gt;
  &lt;module&gt;samples/shopping-cart&lt;/module&gt;               
  &lt;module&gt;samples/shopping-cart-global&lt;/module&gt;               
&lt;/modules&gt;</pre></div><p>Now, let's have a look at the POM file inside the <code class="literal">parent</code> module. This POM file defines plugin repositories, a distribution repository, plugins, and a set of properties. This does not have any dependencies, and this is the POM file that acts as the parent for all the other Maven submodules. The parent POM file has the following coordinates:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;org.wso2.carbon&lt;/groupId&gt;
&lt;artifactId&gt;platform-parent&lt;/artifactId&gt;
&lt;version&gt;4.2.0&lt;/version&gt;
&lt;packaging&gt;pom&lt;/packaging&gt;</pre></div><p>If you look at the POM file inside the <code class="literal">components</code> module, it refers to <code class="literal">parent/pom.xml</code> as the parent Maven module. The value of the <code class="literal">relativePath</code> element, by default, refers to the <code class="literal">pom.xml</code> file a level above, that is, <code class="literal">../pom.xml</code>. However, in this case, it is not the parent POM; hence, the value of the element must be overridden and set to <code class="literal">../parent/pom.xml</code>, shown as follows:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;org.wso2.carbon&lt;/groupId&gt;
&lt;artifactId&gt;carbon-components&lt;/artifactId&gt;
&lt;version&gt;4.2.0&lt;/version&gt;
&lt;parent&gt;
  &lt;groupId&gt;org.wso2.carbon&lt;/groupId&gt;
  &lt;artifactId&gt;platform-parent&lt;/artifactId&gt;
  &lt;version&gt;4.2.0&lt;/version&gt;
  <span class="strong"><strong>&lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;</strong></span>
&lt;/parent&gt;</pre></div><p>If you go inside the <code class="literal">components</code> module and run <code class="literal">mvn help:effective-pom</code>, you will notice that an effective POM aggregates both the configurations defined in <code class="literal">parent/pom.xml</code> and <code class="literal">components/pom.xml</code>. Parent POM files help to propagate common configuration elements to downstream Maven modules, and it can go up to many levels. The <a id="id81" class="indexterm"/>
<code class="literal">components/pom.xml</code> file acts as the parent POM for Maven modules below its level. For example, let's have a look <a id="id82" class="indexterm"/>at the following <code class="literal">components/identity/pom.xml</code> file. It has a reference to the <code class="literal">components/pom.xml</code> file as its parent. Note that here we do not need to use the <code class="literal">relativePath</code> element, since the corresponding parent POM is at the default location:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;org.wso2.carbon&lt;/groupId&gt;
&lt;artifactId&gt;identity&lt;/artifactId&gt;
&lt;version&gt;4.2.0&lt;/version&gt;
&lt;parent&gt;
  &lt;groupId&gt;org.wso2.carbon&lt;/groupId&gt;
  &lt;artifactId&gt;carbon-components&lt;/artifactId&gt;
  &lt;version&gt;4.2.0&lt;/version&gt;
&lt;/parent&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note11"/>Note</h3><p>A complete <a id="id83" class="indexterm"/>list of elements in a POM file is explained in detail at <a class="ulink" href="http://maven.apache.org/ref/3.3.3/maven-model/maven.html">http://maven.apache.org/ref/3.3.3/maven-model/maven.html</a>.</p></div></div></div>
<div class="section" title="Managing POM dependencies"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Managing POM dependencies</h1></div></div></div><p>In a <a id="id84" class="indexterm"/>large-scale development project with hundreds of Maven modules, managing dependencies could be a hazardous task. There are two effective ways to manage dependencies: POM inheritance and dependency grouping. With POM inheritance, the parent POM has to define all the common dependencies used by its child modules under the <code class="literal">dependencyManagement</code> section. In this way, we can avoid all the duplicate dependencies. Also, if we have to update the version of a given dependency, then we only have to make changes in one place. Let's take the same example we discussed before using the WSO2 Carbon Turing project. Let's have a look at the <code class="literal">dependencyManagement</code> section of <code class="literal">parent/pom.xml</code> (only a part of the POM file is shown here):</p><div class="informalexample"><pre class="programlisting">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-transport-mail&lt;/artifactId&gt;
      &lt;version&gt;${axis2-transports.version}&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;                    
      &lt;groupId&gt;org.apache.ws.commons.axiom.wso2&lt;/groupId&gt;
      &lt;artifactId&gt;axiom&lt;/artifactId&gt;
      &lt;version&gt;${axiom.wso2.version}&lt;/version&gt;
     &lt;/dependency&gt;        
   &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>To know more about <a id="id85" class="indexterm"/>dependency management, refer to <span class="emphasis"><em>Introduction to the Dependency Mechanism</em></span>, available at <a class="ulink" href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a>.</p></div></div><p>Let's have a look at the <code class="literal">dependency</code> section of <code class="literal">identity/org.wso2.carbon.identity.core/4.2.3/pom.xml</code>, which extends from <code class="literal">components/pom.xml</code>. Here, you will only see <code class="literal">groupId</code> and <code class="literal">artifactId</code> of a given dependency, and not <code class="literal">version</code>. The version of each dependency is managed through the <code class="literal">dependencyManagement</code> section of the parent POM. In case any child Maven module wants to override the version of an inherited dependency, it can simply add the <code class="literal">version</code> element:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2.wso2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2&lt;/artifactId&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.ws.commons.axiom.wso2&lt;/groupId&gt;
   &lt;artifactId&gt;axiom&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><p>Another best practice to highlight here is the way dependency versions are specified in the parent POM file, which is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;version&gt;${axiom.wso2.version}&lt;/version&gt;</pre></div><p>Instead of specifying the version number inside the <code class="literal">dependency</code> element itself, here, we have taken it out and represented the version as a property. The value of the property is defined under the <code class="literal">properties</code> section of the parent POM, as shown in the following line of code. This <a id="id86" class="indexterm"/>makes POM maintenance extremely easy:</p><div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;axis2.wso2.version&gt;1.6.1.wso2v10&lt;/axis2.wso2.version&gt;
&lt;/properties&gt;</pre></div><p>The second approach to manage dependencies is through dependency grouping. All the common dependencies can be grouped into a single POM file. This approach is much better than POM inheritance. Here, you do not need to add references to individual dependencies. Let's go through a simple example. First, we need to logically group all the dependencies into a single POM file.</p><p>Apache Axis2 is an open source SOAP engine. To build an Axis2 client, you need to have all the following dependencies added to your project:</p><div class="informalexample"><pre class="programlisting">  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
    &lt;version&gt;1.6.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
    &lt;version&gt;1.6.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-transport-http&lt;/artifactId&gt;
    &lt;version&gt;1.6.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-transport-local&lt;/artifactId&gt;
    &lt;version&gt;1.6.2&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-xmlbeans&lt;/artifactId&gt;
    &lt;version&gt;1.6.2&lt;/version&gt;
  &lt;/dependency&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>If you have multiple Axis2 client modules, in each module, you need to duplicate all these <a id="id87" class="indexterm"/>dependencies. The complete source code of the Apache Axis2 project is available at <a class="ulink" href="http://svn.apache.org/viewvc/axis/axis2/java/core/trunk/modules/">http://svn.apache.org/viewvc/axis/axis2/java/core/trunk/modules/</a>.</p></div></div><p>To avoid <a id="id88" class="indexterm"/>dependency duplication, we can create a Maven module with all the previously mentioned five dependencies, as shown in the following project. Make sure to set the value of the <code class="literal">packaging</code> element to <code class="literal">pom</code>:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;axis2-client&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  <span class="strong"><strong>&lt;packaging&gt;pom&lt;/packaging&gt;</strong></span>

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
      &lt;version&gt;1.6.2&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
      &lt;version&gt;1.6.2&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-transport-http&lt;/artifactId&gt;
      &lt;version&gt;1.6.2&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-transport-local&lt;/artifactId&gt;
      &lt;version&gt;1.6.2&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-xmlbeans&lt;/artifactId&gt;
      &lt;version&gt;1.6.2&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>Now, in all <a id="id89" class="indexterm"/>of your Axis2 client projects, you only need to add a dependency to the <code class="literal">com.packt.axis2-client</code> module, shown as follows:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;my-axis2-client&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;axis2-client&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
      &lt;type&gt;pom&lt;type&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>Make sure <a id="id90" class="indexterm"/>to set the value of the <code class="literal">type</code> element to <code class="literal">pom</code> under the <code class="literal">dependency</code> element, as we are referring to a dependency of <code class="literal">pom</code> packaging here. In case it is skipped, Maven, by default, will look for an artifact with the <code class="literal">jar</code> packaging:</p></div></div><div class="section" title="Transitive dependencies"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Transitive dependencies</h2></div></div></div><p>The <a id="id91" class="indexterm"/>transitive dependency feature was introduced in Maven 2.0, which automatically identifies the dependencies of your project dependencies and gets all of them into the build path of your project. Let's take the following POM as an example. It only has a single dependency:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
      &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
      &lt;version&gt;2.26&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>If you try to create an Eclipse project from the previous POM file using the <code class="literal">mvn eclipse:eclipse</code> command, it will result in the following <code class="literal">.classpath</code> file. There you can see, in addition to the <code class="literal">nimbus-jose-jwt-2.26.jar</code> file, three more JARs have been added. These are the transitive dependencies of the <code class="literal">nimbus-jose-jwt</code> dependency:</p><div class="informalexample"><pre class="programlisting">&lt;classpath&gt;
  &lt;classpathentry kind="src" path="src/main/java" including="**/*.java"/&gt;
  &lt;classpathentry kind="output" path="target/classes"/&gt;
  &lt;classpathentry kind="con" path="org.eclipse.jdt.launching.JRE_CONTAINER"/&gt;
  &lt;classpathentry kind="var" path="M2_REPO/com/nimbusds/nimbus-jose-jwt/2.26/nimbus-jose-jwt-2.26.jar"/&gt;
  &lt;classpathentry kind="var" path="M2_REPO/net/jcip/jcip-annotations/1.0/jcip-annotations-1.0.jar"/&gt;
  &lt;classpathentry kind="var" path="M2_REPO/net/minidev/json-smart/1.1.1/json-smart-1.1.1.jar"/&gt;
  &lt;classpathentry kind="var" path="M2_REPO/org/bouncycastle/bcprov-jdk15on/1.50/bcprov-jdk15on-1.50.jar"/&gt;
&lt;/classpath&gt;</pre></div><p>If you look at the POM file of the <code class="literal">nimbus-jose-jwt</code> project, you will see that the previously mentioned transitive dependencies are defined there as dependencies. Maven does not define a limit for transitive dependencies. One transitive dependency may have a reference to another transitive dependency, and it can go on like that endlessly, given that there are no cyclic dependencies found.</p><p>Transitive <a id="id92" class="indexterm"/>dependencies can cause some pain too, if not used with care. If we take the same Maven module that we discussed before as an example, and have the following Java code inside the <code class="literal">src/main/java</code> directory, it will compile exquisitely with no errors. This only has a single dependency—<code class="literal">nimbus-jose-jwt-2.26.jar</code>. However, the <code class="literal">net.minidev.json.JSONArray</code> class comes from a transitive dependency, which is <code class="literal">json-smart-1.1.1.jar</code>. The build works fine, because Maven gets all the transitive dependencies into the project build path. Everything will work finely until, one fine day, you update the version of <code class="literal">nimbus-jose-jwt</code> and the new version has a reference to a new version of the <code class="literal">json-smart</code> JAR, which is not compatible with your code. This could easily break your build, or it may cause test cases to fail. This would create hazards, and it would be a nightmare to find out the root cause.</p><p>The following Java code uses the <code class="literal">JSONArray</code> class from <code class="literal">json-smart-1.1.1.jar</code>:</p><div class="informalexample"><pre class="programlisting">import net.minidev.json.JSONArray;
import com.nimbusds.jwt.JWTClaimsSet;

public class JOSEUtil {

    public static void main(String[] args) {

        JWTClaimsSet jwtClaims = new JWTClaimsSet();

        JSONArray jsonArray = new JSONArray();

        jsonArray.add("maven-book");

        jwtClaims.setIssuer("https://packt.com");

        jwtClaims.setSubject("john");

        jwtClaims.setCustomClaim("book", jsonArray);       

    }
}</pre></div><p>To avoid such a nightmare, you need to follow a simple rule of thumb. If you have any <code class="literal">import</code> statement in a Java class, you need to make sure that the dependency JAR file corresponding to this is being added to the project POM file.</p><p>The Maven dependency plugin helps you to find such inconsistencies in your Maven module. Run the following command and observe its output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn dependency:analyze</strong></span>
<span class="strong"><strong>[INFO] --- maven-dependency-plugin:2.8:analyze (default-cli) @ jose ---</strong></span>
<span class="strong"><strong>[WARNING] Used undeclared dependencies found:</strong></span>
<span class="strong"><strong>[WARNING] net.minidev:json-smart:jar:1.1.1:compile</strong></span>
</pre></div><p>Note the <a id="id93" class="indexterm"/>two warnings in the previous output. It clearly says that we have an undeclared dependency for <code class="literal">json-smart jar</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>The Maven <a id="id94" class="indexterm"/>dependency plugin has several goals to find out inconsistencies and possible loopholes in how you manage dependencies. For more details on this, refer to <a class="ulink" href="http://maven.apache.org/plugins/maven-dependency-plugin/">http://maven.apache.org/plugins/maven-dependency-plugin/</a>.</p></div></div></div><div class="section" title="Dependency scopes"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Dependency scopes</h2></div></div></div><p>Maven defines the <a id="id95" class="indexterm"/>following six scope types. If there is no <code class="literal">scope</code> element defined for a given dependency, the default scope—<code class="literal">compile</code> - will be applied.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">compile</code>: This is the default scope. Any dependency defined under the <code class="literal">compile</code> scope will be available in all the class paths. It will be packaged into the final artifact produced by the Maven project. If you are building a WAR type artifact, then the referred JAR files with the <code class="literal">compile</code> scope will be embedded into the WAR file itself.</li><li class="listitem" style="list-style-type: disc"><code class="literal">provided</code>: This scope would expect that, the corresponding dependency would be provided either by the JDK or a container that runs the application. The best example is the servlet API. Any dependency with the <code class="literal">provided</code> scope will be available in the build time class path, but it won't be packaged into the final artifact. If it's a WAR file, the servlet API will be available in the class path during build time, but won't get packaged into the WAR file. See the following example of the <code class="literal">provided</code> scope:<div class="informalexample"><pre class="programlisting">  &lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
    &lt;version&gt;3.0.1&lt;/version&gt;
    <span class="strong"><strong>&lt;scope&gt;provided&lt;/scope&gt;</strong></span>
  &lt;/dependency&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">runtime</code>: Dependencies defined under the <code class="literal">runtime</code> scope will be available only during the runtime, not in the build time class path. These dependencies will be packaged into the final artifact. You may have a web-based app that talks to a MySQL database in runtime. Your code does not have any hard dependency to the MySQL database driver. The code is written against the Java JDBC API, and it does not need the MySQL database driver at build time. However, during runtime, it needs the driver to talk to the MySQL database. For this, the driver should be packaged into the final artifact.</li><li class="listitem" style="list-style-type: disc"><code class="literal">test</code>: Dependencies are only needed for test compilation (for example, JUnit and TestNG), and execution must be defined under the <code class="literal">test</code> scope. These dependencies won't get packaged into the final artifact.</li><li class="listitem" style="list-style-type: disc"><code class="literal">system</code>: This is very much similar to the scope <code class="literal">provided</code>. The only difference is that with the <code class="literal">system</code> scope, you need to tell Maven how to find it. System dependencies are useful when you do not have the referred dependency in a Maven repository. With this you need to make sure that all the system dependencies are available to download with the source code itself. It is always recommended to avoid using system dependencies. The following code snippet shows how to define a system dependency:<div class="informalexample"><pre class="programlisting">  &lt;dependency&gt;
    &lt;groupId&gt;com.packt&lt;/groupId&gt;
    &lt;artifactId&gt;jose&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    <span class="strong"><strong>&lt;scope&gt;system&lt;/scope&gt;</strong></span>
<span class="strong"><strong>    &lt;systemPath&gt;${basedir}/lib/jose.jar&lt;/systemPath&gt;</strong></span>
  &lt;/dependency&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>
<code class="literal">basedir</code> is an inbuilt property defined in Maven to represent the directory, which has the corresponding POM file.</p></div></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">import</code>: This is <a id="id96" class="indexterm"/>only applicable for dependencies defined under the <code class="literal">dependencyManagement</code> section with the packaging type <code class="literal">pom</code>. Let's take the following POM file; it has the packaging type defined as <code class="literal">pom</code>:<div class="informalexample"><pre class="programlisting">   &lt;project&gt;
     &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
     &lt;groupId&gt;com.packt&lt;/groupId&gt;
     &lt;artifactId&gt;axis2-client&lt;/artifactId&gt;
     &lt;version&gt;1.0.0&lt;/version&gt;
     &lt;packaging&gt;pom&lt;/packaging&gt;

     &lt;dependencyManagement&gt;
       &lt;dependencies&gt;
         &lt;dependency&gt;
           &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
           &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
           &lt;version&gt;1.6.2&lt;/version&gt;
         &lt;/dependency&gt;
         &lt;dependency&gt;
           &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
           &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
           &lt;version&gt;1.6.2&lt;/version&gt;
         &lt;/dependency&gt;
       &lt;/dependencies&gt;
     &lt;/dependencyManagement&gt;
   &lt;/project&gt;</pre></div><p>Now, from a different Maven module, we add a dependency under the <code class="literal">dependencyManagement</code> section to the previous module, with the scope value set to <code class="literal">import</code> and the value of type set to <code class="literal">pom</code>:</p><div class="informalexample"><pre class="programlisting">  &lt;project&gt;

    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.packt&lt;/groupId&gt;
    &lt;artifactId&gt;my-axis2-client&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;

    &lt;dependencyManagement&gt;
      &lt;dependencies&gt;
        &lt;dependency&gt;
          &lt;groupId&gt;com.packt&lt;/groupId&gt;
          &lt;artifactId&gt;axis2-client&lt;/artifactId&gt;
          &lt;version&gt;1.0.0&lt;/version&gt;
          <span class="strong"><strong>&lt;type&gt;pom&lt;/type&gt;</strong></span>
<span class="strong"><strong>          &lt;scope&gt;import&lt;/scope&gt;</strong></span>
        &lt;/dependency&gt;
      &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
  &lt;project&gt;</pre></div><p>Now, if we <a id="id97" class="indexterm"/>run <code class="literal">mvn help:effective-pom</code> against the above POM file, we will see that the dependencies from the first are being imported as follows:</p><div class="informalexample"><pre class="programlisting">  &lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
        &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
        &lt;version&gt;1.6.2&lt;/version&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
        &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
        &lt;version&gt;1.6.2&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;</pre></div></li></ul></div></div><div class="section" title="Optional dependencies"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Optional dependencies</h2></div></div></div><p>Let's say that we <a id="id98" class="indexterm"/>have a Java project that has to work with two different OSGi runtimes. We have written almost all the code to the OSGi API, but there are certain parts in the code that consumes the OSGi runtime-specific APIs. When the application is running, only the code path related to the underneath OSGi runtime will get executed, not both. This raises the need to have both the OSGi runtime JARs at the build time. However, in runtime, we do not need both code execution paths, only the one related to the corresponding OSGi runtime. We can meet these requirements by optional dependencies, shown as follows:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;osgi.client&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
 
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.eclipse.equinox&lt;/groupId&gt;
      &lt;artifactId&gt;osgi&lt;/artifactId&gt;
      &lt;version&gt;3.1.1&lt;/version&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
      <span class="strong"><strong>&lt;optional&gt;true&lt;/optional&gt;</strong></span>
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.apache.phoenix&lt;/groupId&gt;
      &lt;artifactId&gt;phoenix-core&lt;/artifactId&gt;
      &lt;version&gt;3.0.0-incubating&lt;/version&gt;                     
      &lt;scope&gt;compile&lt;/scope&gt;
      <span class="strong"><strong>&lt;optional&gt;true&lt;/optional&gt;</strong></span>
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;project&gt;</pre></div><p>For any client project that needs <code class="literal">com.packt.osgi.client</code> to work in an Equinox OSGi runtime, it must <a id="id99" class="indexterm"/>explicitly add a dependency to the Equinox JAR file, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;my.osgi.client&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.eclipse.equinox&lt;/groupId&gt;
      &lt;artifactId&gt;osgi&lt;/artifactId&gt;
      &lt;version&gt;3.1.1&lt;/version&gt;
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;osgi.client&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;                     
      &lt;scope&gt;compile&lt;/scope&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><div class="section" title="Dependency exclusion"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec01"/>Dependency exclusion</h3></div></div></div><p>Dependency <a id="id100" class="indexterm"/>exclusion helps to avoid getting a selected set of transitive dependencies. Say, for example, that we have the following POM file with two dependencies: one for <code class="literal">nimbus-jose-jwt</code> and the other for the <code class="literal">json-smart</code> artifact:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
      &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
      &lt;version&gt;2.26&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;net.minidev&lt;/groupId&gt;
      &lt;artifactId&gt;json-smart&lt;/artifactId&gt;
      &lt;version&gt;1.0.9&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>If you try to run <code class="literal">mvn eclipse:eclipse</code> against the previous POM file, you will see the following <code class="literal">.classpath</code> file having a dependency on the <code class="literal">json-smart</code> file version 1.0.9, as rightly expected:</p><div class="informalexample"><pre class="programlisting">&lt;classpathentry kind="var" path="M2_REPO/net/minidev/json-smart/1.0.9/json-smart-1.0.9.jar"/&gt;</pre></div><p>Let's say that we have <a id="id101" class="indexterm"/>another project that refers the same <code class="literal">nimbus-jose-jwt</code> artifact, and a newer version of the <code class="literal">json-smart</code> JAR file:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose.ext&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
      &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
      &lt;version&gt;2.26&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;net.minidev&lt;/groupId&gt;
      &lt;artifactId&gt;json-smart&lt;/artifactId&gt;
      &lt;version&gt;1.1.1&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>If you try to run <code class="literal">mvn eclipse:eclipse</code> against the previous POM file, you will see the following <code class="literal">.classpath</code> file having a dependency on the <code class="literal">json-smart</code> artifact version 1.1.1:</p><div class="informalexample"><pre class="programlisting">&lt;classpathentry kind="var" path="M2_REPO/net/minidev/json-smart/1.1.1/json-smart-1.1.1.jar"/&gt;</pre></div><p>Still, we do not see a <a id="id102" class="indexterm"/>problem. Now, say that we build a WAR file having dependencies to both the previous Maven modules:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose.war&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;version&gt;war&lt;/version&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;jose&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;jose.ext&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>Once the WAR file is created inside <code class="literal">WEB-INF/lib</code>, we can only see version 1.1.1 of the <code class="literal">json-smart</code> JAR file. This comes as a transitive dependency of the <code class="literal">com.packt.jose.ext</code> project. There can be a case where the WAR file does not need version 1.1.1 in its runtime, but version 1.0.9. To achieve this, we need to exclude the version 1.1.1 of the <code class="literal">json-smart</code> JAR file from the <code class="literal">com.packt.jose.ext</code> project, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;jose.war&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;version&gt;war&lt;/version&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;jose&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;jose.ext&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
      <span class="strong"><strong>&lt;exclusions&gt;</strong></span>
<span class="strong"><strong>        &lt;exclusion&gt;</strong></span>
<span class="strong"><strong>          &lt;groupId&gt;net.minidev&lt;/groupId&gt;</strong></span>
<span class="strong"><strong>          &lt;artifactId&gt;json-smart&lt;/artifactId&gt;</strong></span>
<span class="strong"><strong>        &lt;/exclusion&gt;</strong></span>
<span class="strong"><strong>      &lt;/exclusions&gt;</strong></span>
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div><p>Now, if you <a id="id103" class="indexterm"/>look inside <code class="literal">WEB-INF/lib</code>, you will only see version 1.0.9 of the <code class="literal">json-smart</code> JAR file.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Summary</h1></div></div></div><p>In this chapter, we focused our discussion around Maven POM, and how to adhere to industry-wide accepted best practices to avoid maintenance nightmares. The key elements of a POM file, POM hierarchy and inheritance, managing dependencies, and related topics were covered here.</p><p>In the next chapter, we will have a look at Maven archetypes.</p></div></body></html>