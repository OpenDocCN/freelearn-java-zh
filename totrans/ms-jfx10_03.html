<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Using Java 8 Features with Selenium</h1>
                </header>
            
            <article>
                
<p>With Selenium 3.0 moving to Java 8, we can use some of the new features of Java 8, such as Stream API and Lambda or Anonymous functions to create scripts in a functional programming style. We do so by reducing the number of lines of code as well as reaping the benefits of the newer features of the language. In this chapter, we will cover these topics:</p>
<ul>
<li>Introducing Java 8 Stream API </li>
<li>Using Stream API to collect and filter data</li>
<li>Using Stream API with Selenium WebDriver</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introducing Java 8 Stream API</h1>
                </header>
            
            <article>
                
<p><span>The Stream API is a new addition to the Collections API in Java 8. The Stream API brings new ways to process collections of objects. A stream represents a sequence of elements and supports different kinds of operations (<span class="packt_screen">filter</span>, <span class="packt_screen">sort</span>, <span class="packt_screen">map</span>, and <span class="packt_screen">collect</span>) from a collection. We can chain these operations together to form a pipeline to query the data, as shown in this diagram:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9ed58994-fc57-43d5-81c7-f6c243f5353e.png" style=""/></div>
<p class="mce-root"/>
<p>We can obtain a Stream from a collection using the <kbd>.stream()</kbd> method. For example, we have a dropdown of languages supported by the sample web application displayed in the header section. Let's capture this in an <kbd>Array list</kbd>, as follows:</p>
<pre>List&lt;String&gt; languages = new ArrayList&lt;String&gt;();<br/>languages.add("English");<br/><span>languages.add("German");<br/></span><span>languages.add("French");</span></pre>
<p>If we have to print the list members, we will use a <kbd>for</kbd> loop in the following way:</p>
<pre><span>for</span>(String language : languages) {<br/>    System.<span>out</span>.println(language)<span>;<br/></span>}</pre>
<p><span>Using the streams <strong>API</strong> we can obtain the stream by calling the </span><kbd>.stream()</kbd><span> method on the </span><kbd>languages</kbd><span> array list </span>and print the members in the following way:</p>
<pre>languages.stream().forEach(System.<span>out</span>::println)<span>;</span></pre>
<p>After obtaining the stream, we called the <kbd>forEach()</kbd> method, passing the action we wanted to take on each element, that is, output the member value on the console, using the <kbd>System.out.println</kbd> method. </p>
<p>Once we have obtained a Stream from a collection, we can use that stream to process the elements or members of the collection.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.filter()</h1>
                </header>
            
            <article>
                
<p>We can filter a stream using the <kbd>filter()</kbd> method. Let's filter the stream obtained from the <kbd>languages</kbd> list to filter items starting with <strong>E</strong>, as shown in the following code:</p>
<pre>stream.filter( item -&gt; item.startsWith(<span>"E"</span>) )<span>;</span><span> </span></pre>
<p>The <kbd>filter()</kbd> method takes a Predicate as a parameter. The <kbd>predicate</kbd> <span>interface</span> contains a function called <kbd>boolean test(T t)</kbd> that <span>takes a single parameter and returns a </span><span>boolean. In the preceding example, we passed the lambda expression <kbd>item -&gt; item.startsWith("E")</kbd> to the <kbd>test()</kbd> function.</span></p>
<p>When the <kbd>filter()</kbd> method is called on a Stream<span>,</span> the filter passed as a parameter to the <kbd>filter()</kbd> function is stored internally. The items are not filtered immediately. </p>
<p class="mce-root"/>
<p>The parameter passed to the <kbd>filter()</kbd> function determines what items in the stream should be processed and what should be excluded. If the <kbd>Predicate.test()</kbd> function returns <span><kbd>true</kbd> for</span> an item<span>,</span> that means it should be processed. If <kbd><span>false</span></kbd> is returned<span>,</span> the item is not processed. In <span>the preceding </span>example, the <kbd>test()</kbd> function will return true for all items starting with the character <kbd>E</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.sort()</h1>
                </header>
            
            <article>
                
<p>We can sort a stream by calling the <kbd>sort()</kbd> function. Let's use the <kbd>sort()</kbd> function on the <kbd>languages</kbd> list, as shown in the following code:</p>
<pre>languages.stream().sorted()<span>;</span></pre>
<p>This will sort the elements in alphabetical order. We can provide a lambda expression to sort the elements using custom comparison logic.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.map()</h1>
                </header>
            
            <article>
                
<p>Streams provide a map() method to map the <span>elements of a stream into another form.</span> We can map the elements into a new object. Let's take the previous example and convert the elements of languages list to uppercase, as shown here:</p>
<pre>languages.stream().map(item -&gt; item.toUpperCase())<span>;</span></pre>
<p>This will map all elements that are strings in the language collection to their uppercase equivalents. Again<span>, this</span> doesn<span>'t actually perform the mapping; it only configures the stream for mapping. Once one of the stream processing methods is invoked, the mapping (and filtering) will be performed.</span></p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.collect()</h1>
                </header>
            
            <article>
                
<p>Streams provide the collect() method, among the other methods, for stream processing on the Stream <span>interface</span>. When <span>the collect() </span>method is invoked<span>,</span> filtering and mapping will take place, and the object resulting from those actions will be collected. Let's take the previous example and obtain a new list of languages in uppercase, as shown in the following code:</p>
<pre>List&lt;String&gt; upperCaseLanguages = languages.stream()<br/>        .map(item -&gt; item.toUpperCase())<br/>        .collect(Collectors.<span>toList</span>())<span>;<br/></span><span><br/></span>System.<span>out</span>.println(upperCaseLanguages)<span>;</span></pre>
<p>This example creates a stream<span>,</span> adds a map to convert the strings to uppercase<span>,</span> and collects all objects in a new list. We can also use the filter or sort method and collect the resulting list based on conditions applied in the filter method.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.min() and Stream.max()</h1>
                </header>
            
            <article>
                
<p>The Streams API provides <span>min</span>() and max() methodsâ€”stream processing for finding the minimum or maximum value in the stream respectively.</p>
<p>Let's take an example in the context of the sample application we're testing. We will create a simple Java class called <kbd>Product</kbd> that stores the name and price of products returned by the search. We want to find the product that has the minimum price and the one that has the maximum price. Our product class will have two members, as shown in the following code:</p>
<pre><span>class </span>Product {<br/>    String <span>name</span><span>;<br/></span><span>    </span>Double <span>price</span><span>;<br/></span><span><br/></span><span>    public </span><span>Product</span>(String name<span>, double </span>price) {<br/>        <span>this</span>.<span>name </span>= name<span>;<br/></span><span>        this</span>.<span>price </span>= price<span>;<br/></span><span>    </span>}<br/><br/>    <span>public </span>String <span>getName</span>() {<br/>        <span>return </span><span>name</span><span>;<br/></span><span>    </span>}<br/><br/>    <span>public </span>Double <span>getPrice</span>() {<br/>        <span>return </span><span>price</span><span>;<br/></span><span>    </span>}<br/>}</pre>
<p>Let's create a list of products returned by the search result, as shown here:</p>
<pre>List&lt;Product&gt; searchResult = <span>new </span>ArrayList&lt;&gt;()<span>;<br/></span>searchResult.add(<span>new </span>Product(<span>"MADISON OVEREAR HEADPHONES"</span><span>, </span><span>125.00</span>))<span>;<br/></span>searchResult.add(<span>new </span>Product(<span>"MADISON EARBUDS"</span><span>, </span><span>35.00</span>))<span>;<br/></span>searchResult.add(<span>new </span>Product(<span>"MP3 PLAYER WITH AUDIO"</span><span>, </span><span>185.00</span>))<span>;</span></pre>
<p>We can call the <kbd>.min()</kbd> function by passing the comparison attribute, in this case, price, using the <kbd>.getPrice()</kbd> method. The <kbd>.min()</kbd> function will use the price attribute and return the element that has the lowest price, as shown in this code:</p>
<pre>Product product = searchResult.stream()<br/>        .min(Comparator.<span>comparing</span>(item -&gt; item.getPrice()))<br/>        .get()<span>;<br/></span><span><br/></span>System.<span>out</span>.println(<span>"The product with lowest price is " </span>+ product.getName())<span>;</span></pre>
<p>The <kbd>get()</kbd> method will return the object returned by the <kbd>min()</kbd> function. We will store this in an instance of Product. The <kbd>min()</kbd> function finds <span class="packt_screen">MADISON EARBUDS</span> as the lowest-priced product, as shown in the following console output:</p>
<pre><strong>The product with lowest price is MADISON EARBUDS</strong></pre>
<p>As opposed to the <kbd>min()</kbd> function, the <kbd>max()</kbd>  function will return the product with the highest price, as shown in the following code:</p>
<pre>product = searchResult.stream()<br/>        .max(Comparator.<span>comparing</span>(item -&gt; item.getPrice()))<br/>        .get()<span>;</span><span><br/></span>System.<span>out</span>.println(<span>"The product with highest price is " </span>+ product.getName())<span>;</span></pre>
<p class="mce-root"><span> The </span><kbd>max()</kbd><span> function finds <span class="packt_screen">MP3 PLAYER WITH AUDIO</span></span><span> as the highest-priced product:</span></p>
<pre class="mce-root"><strong> The product with highest price is MP3 PLAYER WITH AUDIO</strong></pre>
<p>The <kbd><span>min</span>()</kbd> and <kbd>max()</kbd> functions <span>return</span> an optional instance, which has a <kbd>get()</kbd> method to obtain the object.  The <kbd>get()</kbd> method will <span>return null if the stream has no elements.</span></p>
<p>Both the functions take a comparator as a parameter. The <kbd>Comparator.comparing()</kbd> method creates a comparator based on the lambda expression passed to it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stream.count()</h1>
                </header>
            
            <article>
                
<p>The streams API provides a count method that returns the number of elements in the stream after filtering has been applied.  Let's take the previous example to get a count of Products from the MADISON brand:</p>
<pre>long count = searchResult.stream()<br/>        .filter(item -&gt; item.getName().startsWith("MADISON"))<br/>        .count()<span>;</span><span><br/></span>System.<span>out</span>.println(<span>"The number of products from MADISON are: " + count</span>)<span>;</span></pre>
<p>The <kbd>count()</kbd> method returns a <span><kbd>long</kbd>,</span> which is the count of elements matching with the filter criteria. In this example, the following output will be displayed on the console:</p>
<pre><strong>The number of products from MADISON are: 2</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Stream API with Selenium WebDriver</h1>
                </header>
            
            <article>
                
<p class="mce-root">Now that we have introduced Streams API and its various functions, let's see how we can use them in our tests.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Filtering and counting WebElements </h1>
                </header>
            
            <article>
                
<p>Let's start with a simple test to determine the links displayed on the home page of the sample application. We get all the links from the home page and print their count, followed by the count of links that are visible on the page, as shown in the following code:</p>
<pre><span>@Test<br/></span><span>public void </span>linksTest() {<br/><br/>    List&lt;WebElement&gt; links = <span>driver</span>.findElements(By.<span>tagName</span>(<span>"a"</span>));<br/>    System.<span>out</span>.println(<span>"Total Links : " </span>+ links.size());<br/><br/>    <strong><span>long </span>count = links.stream().filter(item -&gt; item.isDisplayed()).count();</strong><br/>    System.<span>out</span>.println(<span>"Total Link visible " </span>+ count);<br/>}</pre>
<p class="mce-root"/>
<p>In <span>the preceding </span>code, we used the <kbd>findElements()</kbd> method along with <kbd>By.tagName</kbd> to get all the links from the home page. However, for finding out the visible links out of them, we used the <kbd>filter()</kbd> function with a predicate to test whether the links are displayed. This is done by calling the <kbd>isDisplayed()</kbd> method of the <kbd>WebElement</kbd> interface. The <kbd>isDisplayed</kbd> method will return <kbd>true</kbd> if the link is displayed; otherwise it will return <kbd>false</kbd>. Finally, we called the <kbd>count()</kbd> method to get the count of links returned by the <kbd>filter()</kbd> function. This will show the following output on the console:</p>
<pre><strong>Total Links : 88</strong><br/><strong>Total Link visible 37</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Filtering element attributes</h1>
                </header>
            
            <article>
                
<p>In the example code, we will filter a list of images that have an empty <kbd>alt</kbd> attribute defined. This is useful if you want to check the accessibility of images displayed on the page. As per the accessibility guidelines, all images should have the <kbd>alt</kbd> attribute defined. This is done by filtering images, by testing the <kbd>getAttribute("alt")</kbd> method; it returns an empty string, as shown in the following code:</p>
<pre><span>@Test<br/></span><span>public void </span>imgAltTest() {<br/><br/>    List&lt;WebElement&gt; images = <span>driver</span>.findElements(By.<span>tagName</span>(<span>"img"</span>));<br/><br/>    System.<span>out</span>.println(<span>"Total Images : " </span>+ images.size());<br/><br/>    <strong>List&lt;WebElement&gt; imagesWithOutAlt = images.stream()</strong><br/><strong>            .filter(item -&gt; item.getAttribute(<span>"alt"</span>) == <span>""</span>)</strong><br/><strong>            .collect(Collectors.<span>toList</span>());</strong><br/>    <br/>    System.<span>out</span>.println(<span>"Total images without alt attribute " </span>+ imagesWithOutAlt);<br/>}</pre>
<p>The <kbd>filter()</kbd> function will return the list of all image elements that have an empty <kbd>alt</kbd> attribute defined.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using the Map function to get the text value from elements</h1>
                </header>
            
            <article>
                
<p>In this example, we will modify the search test we created in earlier chapters to test the results containing the list of expected products, as shown in the following code:</p>
<pre><span>@Test<br/></span><span>public void </span>searchProduct() {<br/><br/>    <span>// find search box and enter search string<br/></span><span>    </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>));<br/><br/>    searchBox.sendKeys(<span>"Phones"</span>);<br/><br/>    WebElement searchButton =<br/>            <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>));<br/><br/>    searchButton.click();<br/><br/>    <span>assertThat</span>(<span>driver</span>.getTitle())<br/>            .isEqualTo(<span>"Search results for: 'Phones'"</span>);<br/><br/><br/>    List&lt;WebElement&gt; searchItems = <span>driver<br/></span><span>            </span>.findElements(By.<span>cssSelector</span>(<span>"h2.product-name a"</span>));<br/><br/>    List&lt;String&gt; expectedProductNames =<br/>            Arrays.<span>asList</span>(<span>"MADISON EARBUDS"</span>,<br/>                    <span>"MADISON OVEREAR HEADPHONES"</span>,<br/>                    <span>"MP3 PLAYER WITH AUDIO"</span>);<br/><br/>    <strong>List&lt;String&gt; productNames = searchItems.stream()</strong><br/><strong>            .map(WebElement::getText)</strong><br/><strong>            .collect(Collectors.<span>toList</span>());</strong><br/><br/>    <span>assertThat</span>(productNames).<br/>            isEqualTo(expectedProductNames);<br/><br/>}</pre>
<p>In the <span>preceding </span>code, we created a list of all the matching products returned by the <kbd>findElements()</kbd> method. We then retrieved the text of each element by calling the <kbd>map()</kbd> function and mapped the return values to a list of strings. This is compared with the <kbd>expectedProductNames</kbd> list.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Filtering and performing actions on WebElements</h1>
                </header>
            
            <article>
                
<p>Let's further modify the search test and find a product matching with a given name. We will then click on the product to open the product details page, as shown in this code:</p>
<pre><span>@Test<br/></span><span> </span><span>public void </span>searchAndViewProduct() {<br/><br/>     <span>// find search box and enter search string<br/></span><span>     </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>));<br/><br/>     searchBox.sendKeys(<span>"Phones"</span>);<br/><br/>     WebElement searchButton =<br/>             <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>));<br/><br/>     searchButton.click();<br/><br/>     <span>assertThat</span>(<span>driver</span>.getTitle())<br/>             .isEqualTo(<span>"Search results for: 'Phones'"</span>);<br/><br/>     List&lt;WebElement&gt; searchItems = <span>driver<br/></span><span>             </span>.findElements(By.<span>cssSelector</span>(<span>"h2.product-name a"</span>));<br/><br/>     WebElement product = searchItems.stream()<br/>             .filter(item -&gt; item.getText().equalsIgnoreCase(<span>"MADISON EARBUDS"</span>))<br/>             .findFirst()<br/>             .get();<br/><br/>     product.click();<br/><br/>     <span>assertThat</span>(<span>driver</span>.getTitle())<br/>             .isEqualTo(<span>"Madison Earbuds"</span>);<br/>}</pre>
<p>In the <span>preceding </span>code, we used the <kbd>filter()</kbd> function to find a specific product from the list of WebElements. We retrieved the first matching product, using the <kbd>findFirst()</kbd> function. This will return a <kbd>WebElement</kbd> representing the link element. We then clicked on the element to open the product details page in the browser.</p>
<p>Thus, we can use Streams API in a number of ways to create functional, readable code with just a few lines.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this short chapter, we learned how to use Selenium 8 Stream API and Lambda functions to simplify the Selenium WebDriver code. This helps you to write code in a functional programming style, which is more fluent and readable. Streams are useful for working with the list of WebElements. We can collect and filter data with a stream easily.</p>
<p>In the next <a href="cba688c3-2ad8-4528-8ded-16f4981fc070.xhtml"/>chapter, we will explore the <span>features of WebDriver for taking screenshots, handling Windows and Frames, synchronization, and managing cookies.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li style="padding-left: 30px">Which version of Java Streams API is introduced?</li>
<li style="padding-left: 30px">Explain the filter function of Streams API.</li>
<li style="padding-left: 30px">Which method of Streams API will return the number of matching elements from the filter() function?</li>
<li style="padding-left: 30px">We can use the map() function to filter a list of WebElements by attribute values: True or false?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further information</h1>
                </header>
            
            <article>
                
<p><span>You can check out the following links for more information about the topics covered in thi</span><span>s chapter:</span></p>
<ul>
<li style="list-style-type: none">
<ul>
<li>Read more about Stream API at <a href="https://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html">https://www.oracle.com/technetwork/articles/java/ma14-java-se-8-streams-2177646.html</a> and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html</a></li>
<li><span>Read more about </span>Lambda expressions at <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html</a></li>
</ul>
</li>
</ul>


            </article>

            
        </section>
    </body></html>