<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Let's Dive Right in&#x2026;"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Let's Dive Right in…</h1></div></div></div><div class="blockquote"><table border="0" cellspacing="0" cellpadding="0" class="blockquote" summary="Block quote"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"It does not matter how slowly you go as long as you do not stop."</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td colspan="2" align="right" valign="top" style="text-align: center">--<span class="attribution"><span class="emphasis"><em>Confucius</em></span></span></td></tr></table></div><p>In this chapter, you will build a simple game where the player controls a character using the mouse to try to avoid oncoming enemies. As the game progresses, the enemies become harder to avoid. This game contains many of the basic elements needed to create interactive Greenfoot applications. Specifically, in this chapter, you will learn how to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Create introduction and game-over screens</li><li class="listitem">Display a user score</li><li class="listitem">Use the mouse to control the movement of an actor</li><li class="listitem">Play background music</li><li class="listitem">Dynamically spawn enemies and remove them when appropriate</li><li class="listitem">Create game levels</li></ul></div><p>Throughout this chapter, we'll learn basic programming concepts and gain familiarity with the Greenfoot development environment. As you proceed, think about the concepts presented and how you would use them in your own projects. If you are new to Java, or it's been a while since you've programmed in Java, be sure to take the time to look up things that may be confusing to you. Java is a well-established programming language, and there are endless online resources you can consult. Similarly, this book assumes a minimal understanding of<a id="id0" class="indexterm"/> Greenfoot. Be sure to look at the simple tutorials and documentation at <a class="ulink" href="http://www.greenfoot.org">www.greenfoot.org</a> when needed. <span class="emphasis"><em>Experiment with the code and try new things—you'll be glad you did</em></span>. In other words, follow the advice of Confucius, quoted in the first line of this chapter.</p><p>Many of the chapters in this book are independent; however, most are dependent on this chapter. This chapter provides the framework to create Greenfoot applications that we will continue to use, and refer to, in later chapters.</p><div class="section" title="The Avoider Game tutorial"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec08"/>The Avoider Game tutorial</h1></div></div></div><p>This tutorial is heavily <a id="id1" class="indexterm"/>based on <span class="emphasis"><em>AS3 Avoider Game Tutorial</em></span> by Michael <a id="id2" class="indexterm"/>James Williams (<a class="ulink" href="http://gamedev.michaeljameswilliams.com/as3-avoider-game-tutorial-base/">http://gamedev.michaeljameswilliams.com/as3-avoider-game-tutorial-base/</a>). In that tutorial, you build a game that creates smiley-faced enemies that rain down from the top of the screen. The goal for the player is to avoid these enemies. The longer you avoid them, the higher your score. We will build the same game in Greenfoot, instead of Flash and ActionScript. As with Michael James Williams' tutorial, we will start small and slowly layer on functionality. We will pause frequently to consider best practices and good programming practice. Enjoy these learning opportunities!</p><p>We will first build the basic components of the Avoider game, including the initial scenario, the game environment, the enemies, and the hero. Then, we will layer on additional functionality, such as scoring, introduction and game-over screens, and the notion of levels.</p><p>As mentioned in the preface, we'll assume you have downloaded Greenfoot<a id="id3" class="indexterm"/> and have it installed. If you still haven't, do so now. Go to <a class="ulink" href="http://www.greenfoot.org">www.greenfoot.org</a> for easy-to-follow instructions on downloading and installing Greenfoot. While you are there, make sure you <a id="id4" class="indexterm"/>are minimally familiar with all the tutorials provided on <a class="ulink" href="http://www.greenfoot.org/doc">http://www.greenfoot.org/doc</a>.</p></div></div>
<div class="section" title="Basic game elements"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec09"/>Basic game elements</h1></div></div></div><p>All games have an environment in <a id="id5" class="indexterm"/>which the game takes place and objects interact. In Greenfoot, the environment is represented by the <code class="literal">World</code> class, and objects that interact in the environment are represented by the <code class="literal">Actor</code> class. In this section of the chapter, we will create a world, add enemies to the world, and add a hero that will be controlled by the player.</p><div class="section" title="Creating a scenario"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec08"/>Creating a scenario</h2></div></div></div><p>Start Greenfoot and <a id="id6" class="indexterm"/>create a <a id="id7" class="indexterm"/>new scenario by clicking on <span class="strong"><strong>Scenario</strong></span> in Greenfoot's Menu bar and then clicking on <span class="strong"><strong>New…</strong></span>. You will see the window shown in <span class="emphasis"><em>Figure 1</em></span>. Type <code class="literal">AvoiderGame</code> as the name of the file, and then hit the <span class="strong"><strong>Create</strong></span> button.</p><div class="mediaobject"><img src="../Images/image00238.jpeg" alt="Creating a scenario"/><div class="caption"><p>Figure 1: Here's Greenfoot's New Scenario window</p></div></div><p style="clear:both; height: 1em;"> </p><div class="section" title="Creating our world"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec01"/>Creating our world</h3></div></div></div><p>Next, we need to<a id="id8" class="indexterm"/> create a world for our game. We do this by right-clicking (or ctrl-clicking on Mac) on the <span class="strong"><strong>World</strong></span> class in the scenario window (see <span class="emphasis"><em>Figure 2</em></span>) and choosing <span class="strong"><strong>New subclass...</strong></span> in the pop-up menu that appears.</p><div class="mediaobject"><img src="../Images/image00239.jpeg" alt="Creating our world"/><div class="caption"><p>Figure 2: This is about right-clicking on the World class in order to subclass it</p></div></div><p style="clear:both; height: 1em;"> </p><p>In the <span class="strong"><strong>New class</strong></span> pop-up window, name the class <code class="literal">AvoiderWorld</code>, select the <span class="strong"><strong>backgrounds</strong></span> image category, and then select the <code class="literal">space1.jpg</code> library image as the new class image. Once this is<a id="id9" class="indexterm"/> done, the pop-up window should resemble <span class="emphasis"><em>Figure 3</em></span>.</p><div class="note" title="Note"><h3 class="title"><a id="tip02"/>Tip</h3><p>Once you associate an image with a new <code class="literal">World</code> class or <code class="literal">Actor</code> class, that image will be copied to the <code class="literal">images</code> directory in your Greenfoot project. We will count on this in later chapters.</p></div><div class="mediaobject"><img src="../Images/image00240.jpeg" alt="Creating our world"/><div class="caption"><p>Figure 3: This shows the New class pop-up window</p></div></div><p style="clear:both; height: 1em;"> </p><p>Hit the <span class="strong"><strong>Ok</strong></span> button in the <span class="strong"><strong>New class</strong></span> pop-up window, and then, in the main scenario window, hit the <span class="strong"><strong>Compile</strong></span> button. You should now have a scenario that looks like that shown in <span class="emphasis"><em>Figure 4</em></span>.</p><div class="mediaobject"><img src="../Images/image00241.jpeg" alt="Creating our world"/><div class="caption"><p>Figure 4: This shows our AvoiderGame scenario after compiling the AvoiderWorld class</p></div></div><p style="clear:both; height: 1em;"> </p><p>We now have our own <a id="id10" class="indexterm"/>world, named <code class="literal">AvoiderWorld</code>, which we will soon populate with actors.</p><div class="note" title="Note"><h3 class="title"><a id="tip03"/>Tip</h3><p>Later in this chapter, we will add two subclasses of <code class="literal">World</code> to our game—one for our introduction screen and one for our game-over screen. Those instructions will be abbreviated. Be sure to refer back to this section if you need detailed instructions on subclassing the <code class="literal">World</code> class.</p></div></div><div class="section" title="Creating our hero"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec02"/>Creating our hero</h3></div></div></div><p>Let's create the character <a id="id11" class="indexterm"/>our players will control when they play our game. Greenfoot makes this really easy. We will just follow the same steps we used to create the <code class="literal">World</code> class earlier. Start by right-clicking on the <code class="literal">Actor</code> class in the scenario window (see <span class="emphasis"><em>Figure 5</em></span>) and choose the <span class="strong"><strong>New subclass...</strong></span> menu item.</p><div class="mediaobject"><img src="../Images/image00242.jpeg" alt="Creating our hero"/><div class="caption"><p>Figure 5: This shows right-clicking on the Actor class in order to subclass it</p></div></div><p style="clear:both; height: 1em;"> </p><p>In the <span class="strong"><strong>New class</strong></span> pop-up <a id="id12" class="indexterm"/>window, name the class <code class="literal">Avatar</code> and select <code class="literal">symbols-&gt;skull.png</code> as the new class image. In the main scenario window, hit the <span class="strong"><strong>Compile</strong></span> button.</p><p>Now, to create an enemy, you perform the same steps you just did for the hero, except choose <code class="literal">symbols-&gt;Smiley1.png</code> as the image and <code class="literal">Enemy</code> as the class name. Again, hit the <span class="strong"><strong>Compile</strong></span> button when this is done.</p><p>You should now have a scenario that looks like the one shown in <span class="emphasis"><em>Figure 6</em></span>.</p><div class="mediaobject"><img src="../Images/image00243.jpeg" alt="Creating our hero"/><div class="caption"><p>Figure 6: This shows the Avoider Game scenario after creating the world and adding two actors</p></div></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="What have we just done?"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec03"/>What have we just done?</h3></div></div></div><p>Greenfoot views a <a id="id13" class="indexterm"/>scenario as <code class="literal">World</code> that contains <code class="literal">Actor</code>. The main responsibilities of <code class="literal">World</code> is to add and remove <code class="literal">each Actor</code> from the screen and to periodically call the <code class="literal">act()</code> method of each <code class="literal">Actor</code>. It is the responsibility of each <code class="literal">Actor</code> to implement their <code class="literal">act()</code> method to describe their actions. Greenfoot provides you with the code that implements general <code class="literal">World</code> and <code class="literal">Actor</code> behavior. (You right-clicked on those implementations previously.) As a game programmer, you must code specific behaviors for <code class="literal">World</code> and <code class="literal">Actor</code>. You do this by subclassing the provided <code class="literal">World</code> and <code class="literal">Actor</code> classes to create new classes and writing code in them. You have already done the subclassing, and now it is time to add the code.</p><div class="note" title="Note"><h3 class="title"><a id="tip04"/>Tip</h3><p>Look at <a class="ulink" href="http://www.greenfoot.org/files/javadoc/">http://www.greenfoot.org/files/javadoc/</a> to learn more about the <code class="literal">World</code> and <code class="literal">Actor</code> classes.</p><p>Oracle provides an excellent overview of object-oriented programming concepts<a id="id14" class="indexterm"/> at <a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/concepts/">http://docs.oracle.com/javase/tutorial/java/concepts/</a>. If you are serious about learning Java and writing good Greenfoot scenarios, you should read that material.</p></div></div><div class="section" title="Adding our hero"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec04"/>Adding our hero</h3></div></div></div><p>Last, we need to add our <a id="id15" class="indexterm"/>hero to the game. To do this, right-click on the <code class="literal">Avatar</code> class, select <code class="literal">new Avatar()</code> from the pop-up menu, drag the picture of the skull that appears collocated with your mouse pointer to the center of the screen and then click the left mouse button. Now, right-click anywhere on the black space background (do not right-click on the skull) and choose <span class="strong"><strong>Save the world</strong></span> in the pop-up menu that appears.</p><p>Doing this will permanently add our hero to the game. If you hit the <span class="strong"><strong>Reset </strong></span>button on Greenfoot's scenario window, you should still see the skull you placed in the middle of the screen.</p></div><div class="section" title="Using the mouse as a game controller"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec05"/>Using the mouse as a game controller</h3></div></div></div><p>Let's add some code <a id="id16" class="indexterm"/>to the <code class="literal">Avatar</code> class that will allow <a id="id17" class="indexterm"/>us to control its movement using the mouse. Double-click on <code class="literal">Avatar</code> to pull up the code editor (You can also right-click on the class and select <span class="strong"><strong>Open editor</strong></span>).</p><p>You will see a code-editing window appear that looks as shown in <span class="emphasis"><em>Figure 7</em></span>.</p><div class="mediaobject"><img src="../Images/image00244.jpeg" alt="Using the mouse as a game controller"/><div class="caption"><p>Figure 7: This is the code for our Avatar class</p></div></div><p style="clear:both; height: 1em;"> </p><p>You can see the <code class="literal">act()</code> method<a id="id18" class="indexterm"/> we discussed earlier. Because <a id="id19" class="indexterm"/>there is no code in it, <code class="literal">Avatar</code> will not move or display any other behavior when we run our scenario. What we would like, is to have <code class="literal">Avatar</code> follow the mouse. Wouldn't it be nice if there was a <code class="literal">followMouse()</code> method we could use? <span class="emphasis"><em>Let's pretend there is!</em></span> Inside the <code class="literal">act()</code> method, type <code class="literal">followMouse();</code>. Your <code class="literal">act()</code> method should look like <span class="emphasis"><em>Figure 8</em></span>.</p><div class="mediaobject"><img src="../Images/image00245.jpeg" alt="Using the mouse as a game controller"/><div class="caption"><p>Figure 8: This shows the act() method with the followMouse() function added</p></div></div><p style="clear:both; height: 1em;"> </p><p>Just for fun, let's compile this and see what happens. What do you think will happen? Click the <span class="strong"><strong>Compile</strong></span> button to find out. Did you see something like what is shown in <span class="emphasis"><em>Figure 9</em></span>?</p><div class="mediaobject"><img src="../Images/image00246.jpeg" alt="Using the mouse as a game controller"/><div class="caption"><p>Figure 9: This is about viewing a compilation error in Greenfoot</p></div></div><p style="clear:both; height: 1em;"> </p><p>If you look at the bottom<a id="id20" class="indexterm"/> of the window in <span class="emphasis"><em>Figure 9</em></span>, you'll<a id="id21" class="indexterm"/> see that Greenfoot has provided us with a useful error message and has even highlighted the code that has the problem. As we know, we were pretending that the method <code class="literal">followMouse()</code> existed. Of course, it does not. We will, however, write it soon. Throughout the course of this manual (and during any Java coding), you are going to make errors. Sometimes, you'll make a "typo" and at other times, you'll use a symbol that doesn't exist (just as we did earlier). There are other common errors you will make as well.</p><div class="note" title="Note"><h3 class="title"><a id="note02"/>Note</h3><p><span class="strong"><strong>Help! I just made a programming error!</strong></span></p><p>Don't panic! There are a number of things you can do to remedy the situation. I will list some here. First and foremost, the process you use to code can greatly aid you in debugging code (finding errors). The process you should follow is called <span class="emphasis"><em>Incremental Development</em></span>. Simply follow these steps:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Code a couple of lines of code. <span class="emphasis"><em>(Really!! Don't code any more!)</em></span></li><li class="listitem">Save and compile.</li><li class="listitem">Run and test your code. <span class="emphasis"><em>(Really!! Try it out!)</em></span></li><li class="listitem">Repeat.</li></ul></div><p>Now, if you get an error, <span class="emphasis"><em>it has to be due to the last 2-5 lines of code</em></span> you just wrote. You know exactly where to look. Compare this to writing 30 lines of code and then testing them out. You will have compounding bugs that are hard to find. Here are some other debugging tips:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Very carefully read the error message you get. While they can be cryptic, they really do point you to the location of the bug (sometimes even giving line numbers).</li><li class="listitem">Sometimes, you get multiple, long error messages. Don't worry. Just go to the top and read and deal with only the first one. Often, by fixing the first one, many others will be taken care of too.</li><li class="listitem">If you just can't find it, have someone else read your code. It's amazing how fast someone else can spot your error.</li><li class="listitem">Print some information out. You can use <code class="literal">System.out.println()</code> to print out variables and check that the code you are looking at is actually running.</li><li class="listitem">Learn how to use a debugger. This is a very useful tool, but beyond the scope of this book. Learn what a debugger is and use it. <span class="emphasis"><em>Greenfoot has a nice, built-in debugger you can use.</em></span></li></ul></div><p>In the extremely rare <a id="id22" class="indexterm"/>case that there is an <a id="id23" class="indexterm"/>error in the <a id="id24" class="indexterm"/>Greenfoot program, report it by following the instructions found at <a class="ulink" href="http://www.greenfoot.org/support">http://www.greenfoot.org/support</a>.</p></div><div class="section" title="Creating the followMouse function"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec01"/>Creating the followMouse function</h4></div></div></div><p>Ok, let's get back to our <a id="id25" class="indexterm"/>hero. We last left <a id="id26" class="indexterm"/>our hero (the <code class="literal">Avatar</code> class) with an error, because there was actually no <code class="literal">followMouse()</code> method. Let's fix that. Add the method shown in the following code after the <code class="literal">act()</code> method in the <code class="literal">Avatar</code> class:</p><div class="informalexample"><pre class="programlisting">private void followMouse() {
  MouseInfo mi = Greenfoot.getMouseInfo();
  if( mi != null ) {
    setLocation(mi.getX(), mi.getY());
  }
}</pre></div><p>We now have an implementation of <code class="literal">followMouse()</code>. Save the file, compile the Greenfoot scenario, and try the code out. The picture of the skull should follow your mouse. If something went wrong, look closely at the debugging window (shown in Figure 9) to see the clues Java is giving you about your error. Did you mistype something? Verify that <a id="id27" class="indexterm"/>the code in your <code class="literal">Avatar</code> class<a id="id28" class="indexterm"/> looks exactly like the code in Figure 10. <span class="emphasis"><em>Follow the debugging tips provided earlier</em></span>.</p><div class="mediaobject"><img src="../Images/image00247.jpeg" alt="Creating the followMouse function"/><div class="caption"><p>Figure 10: This shows the Avatar class with completed followMouse() method</p></div></div><p style="clear:both; height: 1em;"> </p><p>Hey, wait! How did I come up with the code for the <code class="literal">followMouse()</code> method? Was I born with that information? No, I actually just looked over the <a id="id29" class="indexterm"/>Greenfoot documentation (<a class="ulink" href="http://www.greenfoot.org/files/javadoc/">http://www.greenfoot.org/files/javadoc/</a>) and saw there was a class named <code class="literal">MouseInfo</code>. I clicked on that and read about all of its methods.</p><div class="note" title="Note"><h3 class="title"><a id="tip05"/>Tip</h3><p>Go read the Greenfoot documentation now. It's actually pretty short. There are only seven classes and each only has around 20, or fewer, methods.</p></div></div><div class="section" title="Breaking down the code"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec02"/>Breaking down the code</h4></div></div></div><p>Let's break down this code. First, we get <a id="id30" class="indexterm"/>access to an object that represents mouse data via <code class="literal">Greenfoot.getMouseInfo()</code>. We then use that object to get the location of the mouse, via <code class="literal">getX()</code> and <code class="literal">getY()</code>, and then set the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> locations of our hero using <code class="literal">setLocation(x,y)</code>. How did I know to use <code class="literal">setLocation()</code>? Again, it is in the Greenfoot documentation for the <code class="literal">Actor</code> class. It is a method that Greenfoot provides for all actors. Last, we had to include the <code class="literal">if(mi != null)</code> part because if you accidentally move the mouse outside the Greenfoot window, there will be no mouse information, so trying to access it will cause an error (check out the comment in the code in <span class="emphasis"><em>Figure 10</em></span>, <span class="emphasis"><em>line 22</em></span>).</p><p>Since the <code class="literal">followMouse()</code> method is called in the <code class="literal">act()</code> method, our hero will continually be moved to the location of the mouse.</p><div class="note" title="Note"><h3 class="title"><a id="tip06"/>Tip</h3><p>When typing a method in Greenfoot, you can hit <span class="emphasis"><em>Ctrl</em></span> + space bar and Greenfoot will display a list of potential methods you may have been trying to write. Select a method from the list and Greenfoot will autocomplete the method for you, including space holders for method parameters.</p></div></div></div><div class="section" title="Adding enemies"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec06"/>Adding enemies</h3></div></div></div><p>We're going to<a id="id31" class="indexterm"/> add enemies to our game in two steps. First, we need to<a id="id32" class="indexterm"/> write the code for the <code class="literal">Enemy</code> class, and then we will add code to our world, <code class="literal">AvoiderWorld</code>, to create a never-ending army of enemies. Both steps are surprisingly simple.</p><div class="section" title="Enemy code"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec03"/>Enemy code</h4></div></div></div><p>Double-click on the <code class="literal">Enemy</code> class<a id="id33" class="indexterm"/> and change its <code class="literal">act()</code> method to look like the following code snippet:</p><div class="informalexample"><pre class="programlisting">public void act() {
  setLocation(getX(), getY() + 1);
}</pre></div><p>Remember using <code class="literal">setLocation()</code> earlier in the <code class="literal">Avatar</code> class? We use it again here to move an enemy down one pixel every time the <code class="literal">act()</code> method is called. In Greenfoot, the upper-left corner of the screen is the coordinate (0,0). The <span class="emphasis"><em>x</em></span> coordinate increases as you move to the right and the <span class="emphasis"><em>y</em></span> coordinate increases as you move down. That is why we set the <span class="emphasis"><em>x</em></span> location of the enemy to be its current <span class="emphasis"><em>x</em></span> coordinate value (we are not moving to the left or the right) and its <span class="emphasis"><em>y</em></span> location to be its current <span class="emphasis"><em>y</em></span> coordinate plus one (we are moving down one pixel.)</p><p>Save your <code class="literal">Enemy</code> class, and then compile your scenario. Run the scenario, right-click on the <code class="literal">Enemy</code> class, and choose <code class="literal">new Enemy()</code> in the pop-up menu. Add this enemy to the screen and watch it move down.</p></div><div class="section" title="Creating an army"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec04"/>Creating an army</h4></div></div></div><p>Now that we have <a id="id34" class="indexterm"/>completed our <code class="literal">Enemy</code> class, we can use it to create an army. To do this, we are going to add code to the <code class="literal">act()</code> method in our <code class="literal">AvoiderWorld</code> class. Open the editor for <code class="literal">AvoiderWorld</code> by double-clicking on it, or right-clicking on it and selecting <span class="strong"><strong>Open editor</strong></span> in the pop-up menu. If you look around the code for <code class="literal">AvoiderWorld</code>, you'll notice that Greenfoot does not automatically create an <code class="literal">act()</code> method for you. No problem, we'll just add it. Put the following code in <code class="literal">AvoiderWorld</code>:</p><div class="informalexample"><pre class="programlisting">public void act() {
  // Randomly add enemies to the world
  if( Greenfoot.getRandomNumber(1000) &lt; 20 ) {
    Enemy e = new Enemy();
    addObject(e, Greenfoot.getRandomNumber(getWidth()-20)+10, -30);
  }
}</pre></div><p>The <code class="literal">act()</code> method starts by checking whether a randomly generated number between 0 and 1000, including 0 but not 1000, was less than 20. In the long run, this code will run 2 percent of the times the <code class="literal">act()</code> method is called. Is this enough? Well, the <code class="literal">act()</code> method is typically called 50 times per second (ranges from 1 to 100, depending on the position of the speed slider bar), so 2 percent of 50 is 1. Therefore, on average one enemy will be created per second. This feels about right for the starting level of our game.</p><p>Inside the <code class="literal">if</code> statement, we create an enemy and place it at a specific location in the world using the method <code class="literal">addObject()</code>. The <code class="literal">addObject()</code> method takes three parameters: the object to add, the <span class="emphasis"><em>x</em></span> coordinate of the object, and the <span class="emphasis"><em>y</em></span> coordinate of the object. The <span class="emphasis"><em>y</em></span> coordinate is constant and chosen so that the newly created enemy starts off at the top of the screen and will appear as it slowly moves down. The <span class="emphasis"><em>x</em></span> coordinate is trickier. It is dynamically generated so that the enemy could appear on any valid <span class="emphasis"><em>x</em></span> coordinate on the screen. The following is the code we are talking about:</p><div class="informalexample"><pre class="programlisting">Greenfoot.getRandomNumber( (getWidth() – 20) + 10, -30);</pre></div><p><span class="emphasis"><em>Figure 11</em></span> demonstrates the range of <span class="emphasis"><em>x</em></span> coordinate values that are generated. In this figure, the rectangles represent the possible set of values for the <span class="emphasis"><em>x</em></span> coordinate for the given code. This method of generating ranges of values for screen coordinates is common in Greenfoot.</p><div class="mediaobject"><img src="../Images/image00248.jpeg" alt="Creating an army"/><div class="caption"><p>Figure 11: This is the range of x coordinate values generated by the code</p></div></div><p style="clear:both; height: 1em;"> </p><p>Compile and run the<a id="id35" class="indexterm"/> scenario; you should see a continuous stream of enemy hordes moving down the screen.</p></div></div><div class="section" title="Unbounding the world"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec07"/>Unbounding the world</h3></div></div></div><p>After running the scenario, you'll notice<a id="id36" class="indexterm"/> that the enemies end up piling up at the bottom of the screen. In Greenfoot, you can create worlds that are bounded (where actors are not allowed to go past the screen borders) and unbounded (where actors are allow to exit the screen.) By default, Greenfoot creates bounded worlds. However, changing the world to unbounded is extremely easy. Double-click on <code class="literal">AvoiderWorld</code> to open the code editor. Take this line of code:</p><div class="informalexample"><pre class="programlisting">super(600, 400, 1);</pre></div><p>Change the preceding code to the following line of code:</p><div class="informalexample"><pre class="programlisting">super(600, 400, 1, false);</pre></div><p>Looking at the Greenfoot documentation<a id="id37" class="indexterm"/> for the <code class="literal">World</code> class, we notice there are two constructors (see <a class="ulink" href="http://www.greenfoot.org/files/javadoc/greenfoot/World.html">http://www.greenfoot.org/files/javadoc/greenfoot/World.html</a> for detailed information on these constructors): one that takes three parameters and another that takes four. The constructor with four parameters has the same parameters as the one that takes three, plus one additional <code class="literal">boolean</code> parameter that indicates whether the world is bounded or not. Our code change added the fourth Boolean parameter and set it to <code class="literal">false</code> (no bounds in the world.)</p><p>Now, compile and run the scenario. The enemies fall off the bottom of the screen as required.</p><p>Where do all those <a id="id38" class="indexterm"/>enemies go? We'll deal with that next.</p></div><div class="section" title="Memory management"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec08"/>Memory management</h3></div></div></div><p>In Greenfoot <a id="id39" class="indexterm"/>applications, you'll create hundreds and thousands of actors. When we are done with an actor, such as when it is killed or goes off screen, we would like to remove that object and not have it consume any more system resources. Java manages memory resources via a method called <a id="id40" class="indexterm"/><span class="strong"><strong>garbage collection</strong></span>. With this method, Java tries to automatically determine whether you no longer need an actor, and if you don't, it deletes that actor and frees up all resources associated with it. In Greenfoot, you can let Java know you are done with the actor by removing it from <code class="literal">World</code> using the <code class="literal">removeObject()</code> method. This is what we want to do to an <code class="literal">Enemy</code> actor, after we have successfully avoided it and it has moved off the screen.</p><p>The most convenient place to remove an <code class="literal">Enemy</code>, after it has gone off the screen, is within the <code class="literal">Enemy</code> class itself. Add the following code as the last line of code inside the <code class="literal">act()</code> method in the <code class="literal">Enemy</code> class:</p><div class="informalexample"><pre class="programlisting">checkRemove();</pre></div><p>Now, we need to add the <code class="literal">checkRemove()</code> method. Put the definition of this method below the <code class="literal">act()</code> method. Here is the definition:</p><div class="informalexample"><pre class="programlisting">private void checkRemove() {
  World w = getWorld();
  if( getY() &gt; w.getHeight() + 30 ) {
    w.removeObject(this);
  }
}</pre></div><p>The code for your <code class="literal">Enemy</code> class should look like that shown in <span class="emphasis"><em>Figure 12</em></span>.</p><div class="mediaobject"><img src="../Images/image00249.jpeg" alt="Memory management"/><div class="caption"><p>Figure 12: This shows the adding of code to remove the enemy if it goes off the bottom of the screen</p></div></div><p style="clear:both; height: 1em;"> </p><p>Now, compile and<a id="id41" class="indexterm"/> run the scenario. The enemies fall of the bottom of the screen, as before, but you can feel good knowing that they are soon removed from the world and the garbage is collected.</p></div><div class="section" title="Your assignment"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec09"/>Your assignment</h3></div></div></div><p>Learning is not passive, and you really need to engage in the process. Before moving on to the next section of this chapter, you should:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure your version of our Avoider Game works, click on <span class="strong"><strong>Scenario</strong></span> in Greenfoot's main application menu, and then choose <span class="strong"><strong>Save as…</strong></span> to create an experimental copy of Avoider Game. Let's name this experimental copy <code class="literal">AvoiderGameIExperimentation</code>.</li><li class="listitem">Play around with your experimental copy. Change the spawn rates of the enemies. Change how fast the enemies descend.</li><li class="listitem">Add <code class="literal">turn(5);</code> to the <code class="literal">act()</code> method of the Enemy class. Compile and run. What's going on? Try different values instead of <code class="literal">5</code> as the input parameter to <code class="literal">turn()</code>.</li></ol><div style="height:10px; width: 1px"/></div><p>If things get too crazy, delete your experimental copy and make a new copy to play with from our original Avoider Game. There's no harm done, nor any foul.</p><div class="note" title="Note"><h3 class="title"><a id="tip07"/>Tip</h3><p>Throughout this book, take this approach of experimenting with the code. Much learning will happen during the playing. The very act of thinking about how to change the code provides your brain with a new way to process and understand it. Making mistakes in a controlled environment will better prepare you to handle mistakes later on. You will start to become familiar with Greenfoot's error messages.</p></div><div class="section" title="Next…"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec05"/>Next…</h4></div></div></div><p>Great work until now! We have built the basics of our game and will next add some things, such as an introduction screen, game-over screen, and a score, to make it look and feel more like a game.</p></div></div></div><div class="section" title="Making it a game"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec09"/>Making it a game</h2></div></div></div><p>In this section, we will add a <a id="id42" class="indexterm"/>game-over screen, an introduction screen, and some <a id="id43" class="indexterm"/>background music. But, before we do all that, we need to know when our hero touches one of the enemies. This will be our cue to end the game. The act of determining when two actors touch is called <span class="strong"><strong>collision detection</strong></span>. Collision detection is used to tell whether a bullet hit an enemy, whether the player landed on a platform after jumping, or to tell whether a falling leaf landed on a surface. We will discuss this important topic next and spend considerable time on it in the upcoming chapters.</p><div class="section" title="Detecting collisions"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec10"/>Detecting collisions</h3></div></div></div><p>Greenfoot provides <a id="id44" class="indexterm"/>several <code class="literal">Actor</code> methods <a id="id45" class="indexterm"/>you can use to determine whether you are touching another <code class="literal">Actor</code>. These methods, in no particular order, are: <code class="literal">getIntersectingObjects()</code>, <code class="literal">getNeighbors()</code>, <code class="literal">getObjectsAtOffset()</code>, <code class="literal">getObjectsInRange()</code>, <code class="literal">getOneIntersectingObject()</code>, and <code class="literal">getOneObjectAtOffset()</code>. They all provide slightly different ways of determining collision. For our game, we are going to use <code class="literal">getOneIntersectingObject()</code>. The prototype of this method is as follows:</p><div class="informalexample"><pre class="programlisting">protected Actor getOneIntersectingObject(java.lang.Class cls)</pre></div><p>This method takes one parameter, which is the class of the objects you want to check for collision. This method defines collision in terms of <a id="id46" class="indexterm"/><span class="strong"><strong>bounding boxes</strong></span>; a bounding box is the minimal rectangle that can surround all pixels in the graphic. This method is efficient and fast, but not the most accurate. In <span class="emphasis"><em>Figure 12</em></span>, we can see a picture of a skull<a id="id47" class="indexterm"/> and a picture of a smiley face. Even though the <a id="id48" class="indexterm"/>pixels of the two pictures are not overlapping, we can see that their bounding boxes are overlapping; therefore, <code class="literal">getOneIntersectingObject()</code> would report that these two actors are touching. In <a class="link" title="Chapter 3. Collision Detection" href="part0024.xhtml">Chapter 3</a>, <span class="emphasis"><em>Collision Detection</em></span>, we will explore more advanced methods of collision detection.</p><div class="mediaobject"><img src="../Images/image00250.jpeg" alt="Detecting collisions"/><div class="caption"><p>Figure 13: This shows the bounding boxes of two actors</p></div></div><p style="clear:both; height: 1em;"> </p><p>Armed with this new information, we are going to add collision detection to our <code class="literal">Avatar</code> class. We will remove our hero from the game if it touches one of the enemies. (Later in this chapter, we will display a game-over screen after removing our hero.) Double-click on the <code class="literal">Avatar</code> class to bring up its editing window. Change its <code class="literal">act()</code> method to this:</p><div class="informalexample"><pre class="programlisting">public void act() {
 followMouse();
 checkForCollisions();
}</pre></div><p>Then, add this <code class="literal">checkForCollisions()</code> method's definition under the <code class="literal">act()</code> method:</p><div class="informalexample"><pre class="programlisting">private void checkForCollisions() {
  Actor enemy = getOneIntersectingObject(Enemy.class);
  if( enemy != null ) {
    getWorld().removeObject(this);
    Greenfoot.stop();
  }
}</pre></div><p>The <code class="literal">Avatar</code> class<a id="id49" class="indexterm"/> should<a id="id50" class="indexterm"/> look like the code shown in Figure 14.</p><div class="mediaobject"><img src="../Images/image00251.jpeg" alt="Detecting collisions"/><div class="caption"><p>Figure 14: The Avatar class with collision detection added.</p></div></div><p style="clear:both; height: 1em;"> </p><p>Let's examine exactly what's going on in the <code class="literal">checkForCollisions()</code> method. The first thing we do is call <code class="literal">getOneIntersectionObject()</code> and save its return value in the variable <code class="literal">enemy</code>. This variable will be <code class="literal">null</code> if this object is not touching any enemies, in which case, the expression in the <code class="literal">if</code> statement will evaluate to <code class="literal">false</code>, and we will not execute the statements inside. Otherwise, we are touching an object of the type <code class="literal">Enemy</code> and do execute the contents of the <code class="literal">if</code> statement.</p><p>There are only two lines of code in the <code class="literal">if</code> statement. In the first line, we use the method <code class="literal">getWorld()</code>, implemented in the <code class="literal">Actor</code> class, to get a reference to the instance of the <code class="literal">World</code> we are in. Instead of saving the reference in a variable, we immediately invoke the <code class="literal">World</code> method <code class="literal">removeObject()</code> supplying the keyword <code class="literal">this</code> as the argument to remove our hero. Lastly, we use the <code class="literal">stop()</code> method in the <code class="literal">Greenfoot</code> utility class to pause our game.</p><p>Now, compile and <a id="id51" class="indexterm"/>run the scenario. Enemies should stream down from <a id="id52" class="indexterm"/>the top of the screen and exit out at the bottom. You should be able to control the hero, an instance of the <code class="literal">Avatar</code> class, by moving your mouse. If our hero touches one of the enemies, the game should stop.</p></div><div class="section" title="Adding a game-over screen"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec11"/>Adding a game-over screen</h3></div></div></div><p>First, you need to draw an <a id="id53" class="indexterm"/>entire game-over screen in your favorite <a id="id54" class="indexterm"/>graphic design/drawing program, such as GIMP, CorelDRAW, Inkscape, Greenfoot's built-in graphic editor, or even Windows Paint. I used Adobe Illustrator to create the screen shown in <span class="emphasis"><em>Figure 15</em></span>.</p><div class="mediaobject"><img src="../Images/image00252.jpeg" alt="Adding a game-over screen"/><div class="caption"><p>Figure 15: My AvoiderGame game-over screen; try designing your own.</p></div></div><p style="clear:both; height: 1em;"> </p><p>Whatever you use to <a id="id55" class="indexterm"/>draw your image, make sure you can save it in either <code class="literal">PNG</code> or <code class="literal">JPG</code> format. Its size should be 600 x 400 (the same size as your world). Save this image in the <code class="literal">images</code> folder in your <code class="literal">AvoiderGame</code> scenario.</p><p>Using the same steps that you used to create <code class="literal">AvoiderWorld</code> (<span class="emphasis"><em>The Avoider Game tutorial</em></span> section), create another world; call it <code class="literal">AvoiderGameOverWorld</code> and associate the image you created earlier with it. In the <span class="strong"><strong>World classes</strong></span> area of your scenario, you should see what is shown in <span class="emphasis"><em>Figure 16</em></span>.</p><div class="mediaobject"><img src="../Images/image00253.jpeg" alt="Adding a game-over screen"/><div class="caption"><p>Figure 16: The World classes section after adding AvoiderGameOverWorld</p></div></div><p style="clear:both; height: 1em;"> </p><div class="section" title="Switching scenes"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec06"/>Switching scenes</h4></div></div></div><p>Now, we want to display the game-over <a id="id56" class="indexterm"/>screen if our hero touches an enemy. To do this, we need to perform the following three steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Detect when we collide with an enemy and then tell (by calling a method) our world, <code class="literal">AvoiderWorld</code>, that the game is over.</li><li class="listitem">In our <code class="literal">AvoiderWorld</code> class, we need to implement the game-over method that the <code class="literal">Avatar</code> will use to signal the end of days.</li><li class="listitem">In our game-over method, set the world to be <code class="literal">AvoiderGameOverWorld</code>, instead of <code class="literal">AvoiderWorld</code>.</li></ol><div style="height:10px; width: 1px"/></div><p>Let's start with step 1. Previously, in the <span class="emphasis"><em>Detecting collisions</em></span> subsection of this section, you wrote code to remove the hero from the game if it touches one of the enemies. This code was contained in the method <code class="literal">checkForCollisions()</code>. To implement step 1, we need to change that method to the following method:</p><div class="informalexample"><pre class="programlisting">private void checkForCollisions() {
  Actor enemy = getOneIntersectingObject(Enemy.class);
  if( enemy != null ) {
    AvoiderWorld world = (AvoiderWorld) getWorld();
    world.endGame();
  }
}</pre></div><p>The only difference is the code inside the <code class="literal">if</code> statement. I hope it makes sense that we are now asking the world to end the game, as opposed to removing the hero object. The part that could be confusing is the substitution of <code class="literal">AvoiderWorld</code> for <code class="literal">World</code> and the addition of the <code class="literal">(AvoiderWorld)</code> part. The problem, is that we are going to implement <code class="literal">endGame()</code> in <code class="literal">AvoiderWorld</code>, not <code class="literal">World</code>. So, we need some way of specifying that the return value of <code class="literal">getWorld()</code> will be treated as <code class="literal">AvoiderWorld</code> and not just plain old ordinary <code class="literal">World</code>. In Java terms, this is called<a id="id57" class="indexterm"/> <span class="strong"><strong>casting</strong></span>.</p><p>Now, let's look at steps 2 and 3. Here's the code you need to add to <code class="literal">AvoiderWorld</code>.</p><div class="mediaobject"><img src="../Images/image00254.jpeg" alt="Switching scenes"/><div class="caption"><p>Figure 17: This shows the endGame() method added to AvoiderWorld</p></div></div><p style="clear:both; height: 1em;"> </p><p>We have changed, and <a id="id58" class="indexterm"/>added, a minimal amount of code, but if you have followed along carefully, you should be able to save, compile, and run the code. See the game-over screen when our hero touches an enemy? (If not, go back and retrace your steps. Something you typed in is wrong.)</p><div class="note" title="Note"><h3 class="title"><a id="note05"/>Note</h3><p><span class="strong"><strong>The three Ps: Plan, Plan, and Plan</strong></span></p><p>Coding is complicated stuff. When you have a problem to solve, you don't just want to sit down and start hacking away at the computer until you bang out a solution. You want to sit down with a stylus and ePad (used to be pen and paper in my day) and plan. I gave you a small example when I wrote out the three steps needed to display the game-over screen. One of the best methods to help you design a solution is a <a id="id59" class="indexterm"/><span class="strong"><strong>top-down design</strong></span> (also know as divide and conquer).</p><p>In the top-down design, you start thinking of a solution to a problem at a very high level and then repeatedly break down this solution into subsolutions until the subsolutions are small and manageable</p></div></div><div class="section" title="Adding a &quot;play again&quot; button"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec07"/>Adding a "play again" button</h4></div></div></div><p>The game-over screen is great <a id="id60" class="indexterm"/>and all, but we don't want to just stare at it all day. OK, so let's make it so that you can restart the game by clicking on the game-over screen. <code class="literal">AvoiderGameOverWorld</code> needs to keep checking whether the mouse has been clicked and then set the world back to <code class="literal">AvoiderWorld</code>, so that we can play the game again. Looking at the Greenfoot documentation, we can see the <code class="literal">mouseClicked()</code> function. Let's use that method in the <code class="literal">act()</code> method of <code class="literal">AvoiderGameOverWorld</code>, along with the change world code. Add the following code to <code class="literal">AvoiderGameOverWorld</code>:</p><div class="informalexample"><pre class="programlisting">public void act() {
  // Restart the game if the user clicks the mouse anywhere
  if( Greenfoot.mouseClicked(this) ) {
    AvoiderWorld world = new AvoiderWorld();
    Greenfoot.setWorld(world);
  }
}</pre></div><p>This code should look <a id="id61" class="indexterm"/>very familiar to you. The code inside the <code class="literal">if</code> statement is nearly identical to the code we added to the <code class="literal">endGame()</code> method in the <code class="literal">AvoiderWorld</code> class, except this time we are creating and switching to <code class="literal">AvoiderWorld</code>.</p><p>The new part is to check to see whether the user clicked the mouse anywhere on the screen. The <code class="literal">Greenfoot.mouseClicked()</code> method returns true if the user just clicked on the object supplied in its parameter. We supplied the <code class="literal">this</code> variable, which represents the whole instance of the <code class="literal">AvoiderGameOverWorld</code> world.</p><p>Compile and run. Great job! Our game is coming along nicely!</p></div></div><div class="section" title="Adding an introduction screen"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec12"/>Adding an introduction screen</h3></div></div></div><p>Adding an introduction screen is<a id="id62" class="indexterm"/> really easy, and we just need to <a id="id63" class="indexterm"/>perform many of the same steps we did in creating a game-over screen. First, we need to create an introduction screen image in whatever graphics editor program you want. The one I created is shown in <span class="emphasis"><em>Figure 18</em></span>.</p><div class="mediaobject"><img src="../Images/image00255.jpeg" alt="Adding an introduction screen"/><div class="caption"><p>Figure 18: The image of the introduction screen for our game.</p></div></div><p style="clear:both; height: 1em;"> </p><p>Make sure the image is <a id="id64" class="indexterm"/>either in PNG or JPG format and has a pixel size of 600 x 400. Save this image in the <code class="literal">images</code> folder in your <code class="literal">AvoiderGame</code> scenario.</p><p>Create a new world (by subclassing <code class="literal">World</code>), call it <code class="literal">AvoiderGameIntroScreen</code>, and associate the image you just created with it. When you are done with this, the <span class="strong"><strong>World classes</strong></span> area of your scenario should look like the screenshot shown in <span class="emphasis"><em>Figure 19</em></span>.</p><div class="mediaobject"><img src="../Images/image00256.jpeg" alt="Adding an introduction screen"/><div class="caption"><p>Figure 19: These are all the worlds you created in your AvoiderGame</p></div></div><p style="clear:both; height: 1em;"> </p><div class="section" title="Setting the initial screen"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec08"/>Setting the initial screen</h4></div></div></div><p>We obviously want our new<a id="id65" class="indexterm"/> introduction screen to display first when the player first starts the game. To select <code class="literal">AvoiderGameIntroScreen</code> world as our starting <code class="literal">World</code>, we need to right-click on it in the <span class="strong"><strong>World classes</strong></span> area and select the <code class="literal">new AvoiderGameIntroScreen()</code> menu option in the pop-up window that appears (see <span class="emphasis"><em>Figure 20</em></span>).</p><div class="mediaobject"><img src="../Images/image00257.jpeg" alt="Setting the initial screen"/><div class="caption"><p>Figure 20: This is about selecting our starting world</p></div></div><p style="clear:both; height: 1em;"> </p><p>Let's make sure everything is hooked up correctly. Compile and run your Greenfoot application. You should start with the introduction screen you just created, but can't do much else. We'll fix that now.</p></div><div class="section" title="Adding a &quot;play&quot; button"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec09"/>Adding a "play" button</h4></div></div></div><p>We are going to repeat <a id="id66" class="indexterm"/>exactly the same steps we did in implementing the restarting of the game from the game-over screen.</p><p>Add the following code to <code class="literal">AvoiderGameIntroScreen</code>:</p><div class="informalexample"><pre class="programlisting">public void act() {
  // Start the game if the user clicks the mouse anywhere 
  if( Greenfoot.mouseClicked(this) ) {
    AvoiderWorld world = new AvoiderWorld();
    Greenfoot.setWorld(world);
  }
}</pre></div><p>This code should look very familiar to you. This is exactly the same code we added to the <code class="literal">AvoiderGameOverWorld</code> class.</p><p>Compile and run. Have some fun. See how long you can last!</p><p>So far so good, but it is <a id="id67" class="indexterm"/>definitely missing some key gaming elements.</p></div></div><div class="section" title="Adding background music"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec13"/>Adding background music</h3></div></div></div><p>In this part of the tutorial, you need<a id="id68" class="indexterm"/> to search the Web for a song (<code class="literal">.mp3</code>) you <a id="id69" class="indexterm"/>would like to play during the game.</p><div class="note" title="Note"><h3 class="title"><a id="note06"/>Note</h3><p><span class="strong"><strong>Acquiring music</strong></span></p><p>Whenever you are adding assets (music or graphics) to your game, make sure you do so legally. There are many sites on the Internet that offer free use of the music or pictures provided. Never use proprietary music, and always cite the sources from which you acquired assets. I got the music I added to the game from <a class="ulink" href="http://newgrounds.com">newgrounds.com</a>, and I gave credit to the author in my code.</p></div><p>We only want the music to play when we start playing the game, not during the introduction or game-over screens. Therefore, we'll start the music when we display <code class="literal">AvoiderWorld</code> and turn it off before we display <code class="literal">AvoiderGameOverWorld</code>. We only want to start the music once, so we don't want to add the code to play the music in the <code class="literal">act()</code> method—imagine the noise from doing that! What we need is a method that is only called once at the creation of the object. That's what the <span class="strong"><strong>constructors</strong></span><a id="id70" class="indexterm"/> of a class provide. (If you need to review what a class and an object are, see the information box in the <span class="emphasis"><em>What have we just done?</em></span> section)</p><div class="note" title="Note"><h3 class="title"><a id="note07"/>Note</h3><p><span class="strong"><strong>What is a constructor?</strong></span></p><p>In programming in Java (and other object-oriented languages), we write code in classes. A <span class="strong"><strong>class</strong></span><a id="id71" class="indexterm"/> describes the methods and attributes of objects we want to create in our program. You can think of a class as a blueprint for building objects. For example, our <code class="literal">Enemy</code> class describes the behavior and attributes of every enemy object that appears in our Avoider Game. Each <span class="emphasis"><em>class</em></span> has a <span class="emphasis"><em>constructor</em></span> that performs all initialization needed for each object created. You can identify the constructor of a class easily. Constructors have exactly the same name as the class they are in and have no return type. As a quick test, find the constructor in our <code class="literal">AvoiderWorld</code> class. Found it?</p><p>We call the constructor every time we create a new object. In Greenfoot, right-click on the Enemy class and you'll see that the top-menu choice is <code class="literal">new Enemy()</code>. The <code class="literal">Enemy()</code> part is the constructor. The <code class="literal">new</code> keyword creates the new object and the <code class="literal">Enemy()</code> initializes that new object. Got it?</p><p>The following are some good resources you should read to learn more about <a id="id72" class="indexterm"/>constructor functions:</p><p><a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/javaOO/constructors.html">http://docs.oracle.com/javase/tutorial/java/javaOO/constructors.html</a></p><p><a class="ulink" href="http://java.about.com/od/workingwithobjects/a/constructor.htm">http://java.about.com/od/workingwithobjects/a/constructor.htm</a></p></div><div class="section" title="Writing the music code"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec10"/>Writing the music code</h4></div></div></div><p>Now that we know where to<a id="id73" class="indexterm"/> put the code (everyone say <code class="literal">constructor</code>), we need to know what code to write. Greenfoot provides a class for playing and managing music called <code class="literal">GreenfootSound</code>. This class makes playing music really easy. Before I show you the code to put in the constructor, you should take a look at the documentation for <code class="literal">GreenfootSound</code> and see if you can figure out what to write.</p><div class="note" title="Note"><h3 class="title"><a id="tip08"/>Tip</h3><p>No, really! Go read the documentation! Trying to do it on your own will really help you.</p></div><p>Here's the code you need to add to the constructor of <code class="literal">AvoiderWorld</code>.</p><div class="mediaobject"><img src="../Images/image00258.jpeg" alt="Writing the music code"/><div class="caption"><p>Figure 21: Here's the constructor for AvoiderWorld</p></div></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Analyzing the music code"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec11"/>Analyzing the music code</h4></div></div></div><p>Let's look at every<a id="id74" class="indexterm"/> line of code in the <code class="literal">AvoiderWorld</code> constructor. First, you have the call to the superclass's constructor, which is needed, as described earlier, to properly initialize your game world. Next, we have this line:</p><div class="informalexample"><pre class="programlisting">bkgMusic = new GreenfootSound("sounds/UFO_T-Balt.mp3");</pre></div><p>This creates a new <code class="literal">GreenfootSound</code> object and saves a reference to it in the <code class="literal">bkgMusic</code> variable. You need to change the preceding code, so that instead of <code class="literal">sounds/UFO_T-Balt.mp3</code>, you use a string that gives the name of the music file you downloaded to play (you need to save the music in your <code class="literal">sounds</code> folder in your Greenfoot project's folder). We also need to declare the <code class="literal">bkgMusic</code> variable we are using in the constructor. To do that, you need to add a variable declaration at the top of your class, as shown in <span class="emphasis"><em>Figure 22</em></span>. By declaring the variable at the top of your class, it will be accessible to all the methods in your class. This will be important when we add code to stop playing the music.</p><div class="mediaobject"><img src="../Images/image00259.jpeg" alt="Analyzing the music code"/><div class="caption"><p>Figure 22: This shows the variable declaration for bkgMusic in the AvoiderWorld class</p></div></div><p style="clear:both; height: 1em;"> </p><p>The next line of code we have to discuss is this one:</p><div class="informalexample"><pre class="programlisting">bkgMusic.playLoop();</pre></div><p>This line starts playing the music and will start it over once it finishes. If we would have only done <code class="literal">bkgMusic.play()</code>, then the song would have played through only once.</p><p>The last line in the constructor is a very important one, and it was added automatically by Greenfoot. Remember when, back in the <span class="emphasis"><em>Adding our hero</em></span> section of this chapter, I instructed you to place an instance of the <code class="literal">Avatar</code> class (our hero) in the center of the <span class="strong"><strong>screen</strong></span>, right-click, and choose the menu option <span class="strong"><strong>Save the World</strong></span>? When you did this, Greenfoot created this <code class="literal">prepare()</code> method. If you look at the contents of this method, you will see that it contains the code to create an <code class="literal">Avatar</code> object and add it to the <span class="strong"><strong>screen</strong></span>. Then, it added the call to use <code class="literal">prepare()</code> in the constructor. If you choose the menu option <span class="strong"><strong>Save the World</strong></span> again, this <code class="literal">prepare()</code> method will be updated.</p><p>OK, save, compile, and <a id="id75" class="indexterm"/>run. Did it work? If not, go back and find the typo.</p></div><div class="section" title="Stop the music"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec12"/>Stop the music</h4></div></div></div><p>If you ran your code, you<a id="id76" class="indexterm"/> had music during the game, but it did not turn off when you died and went to the game-over screen. We have to explicitly turn off the music before displaying <code class="literal">AvoiderGameOverWorld</code>. This is super easy! All we need to do is add the following line of code at the beginning of the <code class="literal">endGame()</code> method you added to <code class="literal">AvoiderWorld</code> earlier:</p><div class="informalexample"><pre class="programlisting">bkgMusic.stop();</pre></div><p>Now, save, compile, and run. It should all work according to plan.</p><div class="note" title="Note"><h3 class="title"><a id="note08"/>Note</h3><p><span class="strong"><strong>Private, Protected, and Public</strong></span></p><p>The Java keywords <code class="literal">private</code>, <code class="literal">protected</code>, and <code class="literal">public</code> modify how a variable, method, or class<a id="id77" class="indexterm"/> is accessed in Java. Good programming practice dictates that you make all of your class instance variables <code class="literal">private</code> and require access to that variable to only occur through methods. For methods, you want to make ones you only access within the <code class="literal">private</code> class; otherwise, make it <code class="literal">public</code>. The keyword <code class="literal">protected</code> is used to a method available to subclasses of the class but not to external classes. For more information, refer to the following links:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html">http://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html</a></li><li class="listitem"><a class="ulink" href="http://www.tutorialspoint.com/java/java_access_modifiers.htm">http://www.tutorialspoint.com/java/java_access_modifiers.htm</a></li></ul></div></div></div></div><div class="section" title="Your assignment"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec14"/>Your assignment</h3></div></div></div><p>Perform the following actions before continuing:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Once the game-over screen is displayed, play music. Are you going to make it peppy music to lift the spirits of your player or sad and morose to really rub it in? Make sure you turn it off before switching to <code class="literal">AvoiderWorld</code>.</li><li class="listitem">Our enemy's movements are pretty vanilla. Can you spice it up? Some ideas are to have the enemy characters have variable speed, drift left or right, or enter from the top or bottom. What will you come up with?</li></ul></div><p>Remember to create a backup copy of <code class="literal">AvoiderGame</code> before trying these challenges.</p></div><div class="section" title="Next…"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec15"/>Next…</h3></div></div></div><p>Almost done! We have built the basics of our game and will next add some things to make it challenging.</p></div></div><div class="section" title="Enhancing playability"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>Enhancing playability</h2></div></div></div><p>In the final section of this<a id="id78" class="indexterm"/> chapter, we will add code to increase the <a id="id79" class="indexterm"/>game's playability. First, we will add a score. Next, we need to increase the challenge of the game over time. As the player gets better at the game, we want to ramp up the challenge; we will add a leveling system to do this.</p><div class="section" title="Game scoring"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec16"/>Game scoring</h3></div></div></div><p>Our game is evolving; however, we<a id="id80" class="indexterm"/> need a way to judge how <a id="id81" class="indexterm"/>well we are doing in the game. There are many ways to judge game performance, for example, levels completed, time, progression, and so on—but the most common method is to assign the player a score. We are going to add a scoring system to the game that rewards players for the number of enemies they avoid.</p><div class="section" title="Adding the Counter class"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec13"/>Adding the Counter class</h4></div></div></div><p>Keeping a count of things <a id="id82" class="indexterm"/>and displaying that count is so common in games that Greenfoot provides you with a <span class="strong"><strong>Counter</strong></span> class. To get access to this class, you need to import it into your scenario. To do this, select <span class="strong"><strong>Edit</strong></span> in Greenfoot's main menu, and then select the <span class="strong"><strong>Import Class…</strong></span> submenu choice. You will see a window, like the one shown in <span class="emphasis"><em>Figure 23</em></span>. Make sure the <span class="strong"><strong>Counter</strong></span> box is selected on the left-hand side and then click on the <span class="strong"><strong>Import</strong></span> button.</p><div class="mediaobject"><img src="../Images/image00260.jpeg" alt="Adding the Counter class"/><div class="caption"><p>Figure 23: Here's Greenfoot's Import Class window</p></div></div><p style="clear:both; height: 1em;"> </p><p>This will add the <code class="literal">Counter</code> class to<a id="id83" class="indexterm"/> your list of <span class="strong"><strong>Actor classes</strong></span> available for use in our game as shown in <span class="emphasis"><em>Figure 24</em></span>.</p><div class="mediaobject"><img src="../Images/image00261.jpeg" alt="Adding the Counter class"/><div class="caption"><p>Figure 24: The Actor classes section of your scenario window now includes the Counter class</p></div></div><p style="clear:both; height: 1em;"> </p><p>We want the score to appear immediately in the game. In tutorial 4 (<a class="ulink" href="http://www.greenfoot.org/doc/tut-4">http://www.greenfoot.org/doc/tut-4</a>) on the Greenfoot site, you were introduced to "Saving the World" to have<a id="id84" class="indexterm"/> the <code class="literal">World</code> class automatically place <code class="literal">Actor</code> in your world. I'm going to describe how to place <code class="literal">Actor</code> in your world manually; specifically, you are going to add an instance of the <code class="literal">Counter</code> class to your <code class="literal">AvoiderWorld</code> world.</p><p>We discussed that Greenfoot already added the call to the <code class="literal">prepare()</code> method in your <code class="literal">AvoiderWorld()</code> constructor. Locate the definition of this method in the <code class="literal">AvoiderWorld</code> class. Change this method to look like the following code:</p><div class="informalexample"><pre class="programlisting">private void prepare() {
  Avatar avatar = new Avatar();
  addObject(avatar, 287, 232);
  scoreBoard = new Counter("Score: ");
  addObject(scoreBoard, 70, 20);
}</pre></div><p>The first two lines of this method were already present. The last two lines put a score display on our game screen. The <code class="literal">scoreBoard = new Counter("Score: ");</code> code creates a new Counter object with a label <code class="literal">Score:</code> and stores a reference to it in the <code class="literal">scoreBoard</code> variable (we haven't declared this variable yet, but will soon.) The next line of code adds our <code class="literal">Counter</code> to the upper-left corner of our game screen.</p><p>Lastly, we need to declare the <code class="literal">scoreBoard</code> variable at the top of our class. Add <code class="literal">private Counter scoreBoard;</code> above the constructor, as shown in <span class="emphasis"><em>Figure 25</em></span>.</p><div class="mediaobject"><img src="../Images/image00262.jpeg" alt="Adding the Counter class"/><div class="caption"><p>Figure 25: The declaration of the scoreBoard variable in the class AvoiderWorld.</p></div></div><p style="clear:both; height: 1em;"> </p><p>Compile, run, and test your scenario.</p></div><div class="section" title="Increasing the score over time"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec14"/>Increasing the score over time</h4></div></div></div><p>We need to do just one <a id="id85" class="indexterm"/>more thing. We need to call <code class="literal">setValue()</code> on our <code class="literal">scoreBoard</code> variable to increase our score over time. One place we could do this is where we create the enemies in <code class="literal">AvoiderWorld</code>. The thinking, is that you get some points for every enemy created, because you will ultimately have to avoid it. Here's how you should change the <code class="literal">act()</code> method in <code class="literal">AvoiderWorld</code>:</p><div class="informalexample"><pre class="programlisting">public void act() {
  // Randomly add enemies to the world
  if( Greenfoot.getRandomNumber(1000) &lt; 20) {
    Enemy e = new Enemy();
    addObject( e, Greenfoot.getRandomNumber(getWidth()-20)+10, -30);
    // Give us some points for facing yet another enemy
    scoreBoard.setValue(scoreBoard.getValue() + 1);
  }
}</pre></div><p>The only thing I changed was adding the comment about points and adding the call to <code class="literal">setValue()</code> on <code class="literal">scoreBoard</code>. This line of code retrieves the current score using <code class="literal">getValue()</code>, adds 1 to it, and then sets the new value using <code class="literal">setValue()</code>. The typical usage of the <code class="literal">Counter</code> class is also provided in a comment at the top of the <code class="literal">Counter</code> class. Check it out!</p><p>Compile your <code class="literal">AvoiderGame</code> scenario and try it out. Are you getting an increased score?</p></div></div><div class="section" title="Adding levels"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec17"/>Adding levels</h3></div></div></div><p>Our game isn't very <a id="id86" class="indexterm"/>challenging at this point. One thing we <a id="id87" class="indexterm"/>could do, is make the game become more challenging over time. To do this, we are going to add the notion of levels to Avoider Game. We are going to increase the challenge of the game by periodically increasing the rate at which enemies spawn and the speed at which they travel.</p><div class="section" title="Increasing spawn rates and enemy speed"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec15"/>Increasing spawn rates and enemy speed</h4></div></div></div><p>In <code class="literal">AvoiderWorld</code>, add<a id="id88" class="indexterm"/> two variables, <code class="literal">enemySpawnRate</code> and <code class="literal">enemySpeed</code>, and <a id="id89" class="indexterm"/>give them initial values; we will use these two variables to increase difficulty. The top of your <code class="literal">AvoiderWorld</code> class should look like <span class="emphasis"><em>Figure 26</em></span>.</p><div class="mediaobject"><img src="../Images/image00263.jpeg" alt="Increasing spawn rates and enemy speed"/><div class="caption"><p>Figure 26: This shows the variables in AvoiderWorld</p></div></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Increasing difficulty based on the score"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec16"/>Increasing difficulty based on the score</h4></div></div></div><p>Next, we need to add a <a id="id90" class="indexterm"/>method that increases the difficulty of the game based on the player's score. To do this, we need to add the following method to <code class="literal">AvoiderWorld</code>:</p><div class="informalexample"><pre class="programlisting">private void increaseLevel() {
  int score = scoreBoard.getValue();

  if( score &gt; nextLevel ) {
    enemySpawnRate += 2;
    enemySpeed++;
    nextLevel += 100;
  }
}</pre></div><p>We introduced a new variable, <code class="literal">nextLevel</code>, in <code class="literal">increaseLevel()</code>, and we need to add its declaration at the top of the <code class="literal">AvoiderWorld</code> class. Here is the declaration you need to add next to the variable declarations of <code class="literal">enemySpawnRate</code> and <code class="literal">enemySpeed</code>:</p><div class="informalexample"><pre class="programlisting">private int nextLevel = 100;</pre></div><p>As evident from the code in <code class="literal">increaseLevel()</code>, we increase both <code class="literal">enemySpawnRate</code> and <code class="literal">enemySpeed</code> as the player's score increases. The last thing we need to do is use the <code class="literal">enemySpawnRate</code> and <code class="literal">enemySpeed</code> variables in the creation of enemies and call <code class="literal">increaseLevel()</code> from the <code class="literal">act()</code> method in <code class="literal">AvoiderWorld</code>. Here is the new <code class="literal">act()</code> method:</p><div class="informalexample"><pre class="programlisting">public void act() {
  // Randomly add enemies to the world
  if( Greenfoot.getRandomNumber(1000) &lt; enemySpawnRate) {
    Enemy e = new Enemy();
    e.setSpeed(enemySpeed);
    addObject( e, Greenfoot.getRandomNumber(getWidth()-20)+10, -30);
    // Give us some points for facing yet another enemy
    scoreBoard.setValue(scoreBoard.getValue() + 1);
  }
  increaseLevel();
}</pre></div></div><div class="section" title="Implementing enemy speed increases"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl4sec17"/>Implementing enemy speed increases</h4></div></div></div><p>I'd love to yell <span class="emphasis"><em>compile and run!</em></span> at this point, but there is one last detail. In the <code class="literal">act()</code> method, we use the <a id="id91" class="indexterm"/>line <code class="literal">e.setSpeed(enemySpeed);</code> to change the speed of the enemy; however, we never have implemented that method in the <code class="literal">Enemy</code> class. In addition, we need to change the <code class="literal">Enemy</code> class a bit to use the newly set speed.</p><p><span class="emphasis"><em>Figure 27</em></span> gives the complete code for the <code class="literal">Enemy</code> class.</p><div class="mediaobject"><img src="../Images/image00264.jpeg" alt="Implementing enemy speed increases"/><div class="caption"><p>Figure 27: This shows the finished Enemy class</p></div></div><p style="clear:both; height: 1em;"> </p><p>As you can see, we <a id="id92" class="indexterm"/>made some really simple changes to the <code class="literal">Enemy</code> class. We added the <code class="literal">setSpeed()</code> method, which simply accepts an integer parameter and uses that value to set the <code class="literal">speed</code> variable that has been declared at the top of the class. In the <code class="literal">act()</code> method, we use the value of the <code class="literal">speed</code> variable in the <code class="literal">setLocation()</code> call; we continually add <code class="literal">speed</code> to the current <span class="emphasis"><em>y</em></span> coordinate.</p><p><span class="emphasis"><em>Compile and run and enjoy your new game!</em></span></p></div></div><div class="section" title="Your assignment"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec18"/>Your assignment</h3></div></div></div><p>Since this is the end of the Avoider Game instruction. I'm going to give you a few challenge assignments. Good luck! Try to implement the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Once the player's score is above 600, add a new enemy that spawns in addition to the enemies we have now. The new enemy should visually be very distinct from our existing enemies. If you are feeling up to it, have the new enemy move differently from the existing enemies too.</li><li class="listitem">Periodically, spawn a power-up that gives our hero a special ability. For example, the power-up could make our hero temporarily invincible, allow our hero to kill three enemies, or shrink the size of the avatar making it easier to avoid enemies.</li><li class="listitem">Display the player's final score on the game-over screen.</li></ul></div><p>These challenges will definitely take some time and you should not feel compelled to try them. I just wanted to give those who are really interested a way to continue working on the Avoider Game. You will not need to have completed these challenges to move on to the next chapter.</p></div><div class="section" title="Next…"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl3sec19"/>Next…</h3></div></div></div><p>Congratulations! You did it! Have fun. Play your new game.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Summary</h1></div></div></div><p>This chapter demonstrated how to make a fun and engaging game. We have mouse control, a hero, enemies, a score, and introduction and game-over screens.</p><p>As this book assumes you have some experience working in Greenfoot, this chapter also served the purpose of refreshing your memory of how to program in Greenfoot.</p><p>In the upcoming chapters, we'll look at advanced programming concepts in Greenfoot that will allow you to create fun, innovative, and engaging applications. These chapters will assume that you have mastered the material in this one.</p></div></body></html>