<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Managing Security"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Managing Security</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Enabling Spring Security</li><li class="listitem" style="list-style-type: disc">Authenticating users using the default login page</li><li class="listitem" style="list-style-type: disc">Authenticating users using a custom login page</li><li class="listitem" style="list-style-type: disc">Authenticating users using a database</li><li class="listitem" style="list-style-type: disc">Adding a logout link</li><li class="listitem" style="list-style-type: disc">Using public folders</li><li class="listitem" style="list-style-type: disc">Authorizing only users with a specific role to view some pages</li><li class="listitem" style="list-style-type: disc">Displaying page elements only to authenticated users in views</li><li class="listitem" style="list-style-type: disc">Using HTTPS with Tomcat</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec58"/>Introduction</h1></div></div></div><p>In this chapter, we'll cover the basics of managing the security of a Spring web application using <span class="strong"><strong>user authentication</strong></span>, <span class="strong"><strong>user authorization</strong></span>, and <span class="strong"><strong>HTTPS</strong></span>.</p><p>User authentication<a id="id266" class="indexterm"/> is all about identifying a user: usually through a username and a <a id="id267" class="indexterm"/>password. User authorization is about assigning roles to users. These roles are then used at runtime to determine whether a user is allowed to perform a given action or view some specific contents. User authentication and authorization are handled by Spring.</p><p>HTTPS is all <a id="id268" class="indexterm"/>about encrypting the communication between our web server and the <a id="id269" class="indexterm"/>user's browser using <span class="strong"><strong>Secure Sockets Layer</strong></span> (<span class="strong"><strong>SSL</strong></span>). HTTPS needs to be enabled at the server level. We'll see how to do this with Tomcat.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>The first recipe<span class="strong"><strong>,</strong></span> <span class="emphasis"><em>Enabling Spring Security</em></span>, is required for any of the other recipes to work.</p></div></div></div></div>
<div class="section" title="Enabling Spring Security"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec59"/>Enabling Spring Security</h1></div></div></div><p>To enable Spring Security, you need to add some Maven dependencies. You also need to create some <a id="id270" class="indexterm"/>configuration classes.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec127"/>How to do it…</h2></div></div></div><p>Here are the steps to enable Spring Security:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Maven dependencies for Spring Security in <code class="literal">pom.xml</code>. Note that the version number is different from Spring Core:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt; 
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; 
    &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt; 
    &lt;version&gt;3.2.5.RELEASE&lt;/version&gt; 
&lt;/dependency&gt; 
   
&lt;dependency&gt; 
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt; 
    &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt; 
    &lt;version&gt;3.2.5.RELEASE&lt;/version&gt; 
&lt;/dependency&gt; </pre></div></li><li class="listitem">Create a class for the Spring Security configuration:<div class="informalexample"><pre class="programlisting">@Configuration
<span class="strong"><strong>@EnableWebSecurity</strong></span>
public class SecurityConfig extends <span class="strong"><strong>WebSecurityConfigurerAdapter</strong></span> {
}</pre></div></li><li class="listitem">Declare the configuration class in the <code class="literal">ServletInitializer</code> class:<div class="informalexample"><pre class="programlisting">public class ServletInitializer extends AbstractAnnotationConfigDispatcherServletInitializer {
    
    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return new Class[] {<span class="strong"><strong>SecurityConfig</strong></span>.class};
    }
  
  ...</pre></div></li><li class="listitem">Add a class implementing <code class="literal">AbstractSecurityWebApplicationInitializer</code> to initialize Spring Security's servlet filter:<div class="informalexample"><pre class="programlisting">public class SecurityWebApplicationInitializer extends AbstractSecurityWebApplicationInitializer {
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec128"/>How it works…</h2></div></div></div><p><code class="literal">SecurityWebApplicationInitializer</code> registers, behind the scenes, a servlet filter, which will<a id="id271" class="indexterm"/> handle access to any URL of the web application.</p><p>The <code class="literal">SecurityConfig</code> class will be loaded at startup (because of its declaration in <code class="literal">ServletInitializer</code>). The Spring configuration code that we will write in the following recipes will go in the <code class="literal">SecurityConfig</code> class.</p></div></div>
<div class="section" title="Authenticating users using the default login page"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Authenticating users using the default login page</h1></div></div></div><p>Spring <a id="id272" class="indexterm"/>makes it easy to quickly add a login page<a id="id273" class="indexterm"/> to your web application; just define some user credentials (usernames and passwords) in the security configuration class. To access any page, the user will have to go through Spring's default login page first.</p><div class="mediaobject"><img src="graphics/5807OS_06_01.jpg" alt="Authenticating users using the default login page"/></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec129"/>How to do it…</h2></div></div></div><p>In your security configuration class, add a <code class="literal">configureUsers()</code> method containing the hardcoded user credentials:</p><div class="informalexample"><pre class="programlisting">@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Autowired
    public void configureUsers(AuthenticationManagerBuilder auth) throws Exception {
        auth.inMemoryAuthentication()
.withUser("<span class="strong"><strong>user1</strong></span>").password("<span class="strong"><strong>pwd</strong></span>").roles("USER")
    .and()
.withUser("<span class="strong"><strong>admin</strong></span>").password("<span class="strong"><strong>admin_pwd</strong></span>").roles("USER", "ADMIN");

    }
}</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec130"/>How it works…</h2></div></div></div><p>In <code class="literal">configureUsers()</code>, we told Spring to use the provided user credentials for user authentication. We assigned roles to each user. A role is an arbitrary <code class="literal">String</code> object. To use those roles for<a id="id274" class="indexterm"/> authorization, refer to the <span class="emphasis"><em>Authorizing only users with a specific role to view some pages,</em></span> recipe.</p><p>By <a id="id275" class="indexterm"/>default, the Spring's default login page will be used to protect all the pages of the web application. This is defined in the default <code class="literal">configure()</code> method of Spring Security:</p><div class="informalexample"><pre class="programlisting">protected void configure(HttpSecurity http) throws Exception { 
  http 
      .authorizeRequests() 
          .anyRequest().authenticated() 
      .and().formLogin()
      .and().httpBasic(); 
}</pre></div><p>We will override this method in the following recipe in order to define a custom login page.</p></div></div>
<div class="section" title="Authenticating users using a custom login page"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Authenticating users using a custom login page</h1></div></div></div><p>In this <a id="id276" class="indexterm"/>recipe, you'll learn how to build your <a id="id277" class="indexterm"/>own login form instead of using Spring's default login form.</p><div class="mediaobject"><img src="graphics/5807OS_06_02.jpg" alt="Authenticating users using a custom login page"/></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec131"/>How to do it…</h2></div></div></div><p>Here are <a id="id278" class="indexterm"/>the steps to define a custom<a id="id279" class="indexterm"/> login page:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Make sure that the JSTL Maven dependency is declared in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt; 
    &lt;groupId&gt;javax.servlet&lt;/groupId&gt; 
    &lt;artifactId&gt;jstl&lt;/artifactId&gt; 
    &lt;version&gt;1.2&lt;/version&gt; 
&lt;/dependency&gt; </pre></div></li><li class="listitem">Make sure that a JSP view resolver is declared in the <code class="literal">AppConfig</code> class:<div class="informalexample"><pre class="programlisting">@Bean 
public ViewResolver jspViewResolver(){ 
    InternalResourceViewResolver resolver = new InternalResourceViewResolver(); 
    resolver.setViewClass(JstlView.class); 
    resolver.setPrefix("/WEB-INF/jsp/"); 
    resolver.setSuffix(".jsp"); 
    return resolver; 
} </pre></div></li><li class="listitem">Add a controller method for the login page in a controller class:<div class="informalexample"><pre class="programlisting">@Controller
public class UserController {

  @RequestMapping("login") 
  public String login() { 
      return "login"; 
  }
… </pre></div></li><li class="listitem">Add a JSP for the login page:<div class="informalexample"><pre class="programlisting">&lt;%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;
&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;
&lt;%@ page isELIgnored="false" %&gt;

&lt;c:url var="loginUrl" value="/login" /&gt;
&lt;form action="${loginUrl}" method="post"&gt;      
    &lt;input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/&gt;

    &lt;c:if test="${param.error != null}"&gt;       
        &lt;p&gt;
            Invalid username and password.
        &lt;/p&gt;
    &lt;/c:if&gt;

    &lt;p&gt;
        &lt;label for="username"&gt;Username&lt;/label&gt;
        &lt;input type="text" id="username" name="username"/&gt; 
    &lt;/p&gt;

    &lt;p&gt;
        &lt;label for="password"&gt;Password&lt;/label&gt;
        &lt;input type="password" id="password" name="password"/&gt; 
    &lt;/p&gt;


    &lt;button type="submit"&gt;Log in&lt;/button&gt;
&lt;/form&gt;</pre></div></li><li class="listitem">In<a id="id280" class="indexterm"/> the <code class="literal">SecurityConfig</code> class, override the Spring's default <code class="literal">configure()</code> method. Declare <a id="id281" class="indexterm"/>the URL of your custom login page:<div class="informalexample"><pre class="programlisting">protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests().anyRequest().authenticated();
    http.formLogin().loginPage("<span class="strong"><strong>/login</strong></span>").permitAll();
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec132"/>How it works…</h2></div></div></div><p>In the <code class="literal">SecurityConfig</code> class, the <code class="literal">configure()</code> method:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Requires<a id="id282" class="indexterm"/> authentication<a id="id283" class="indexterm"/> for any URL: <code class="literal">anyRequest().authenticated()</code></li><li class="listitem" style="list-style-type: disc">Allows user authentication through the custom login page: <code class="literal">formLogin().loginPage("/login")</code></li><li class="listitem" style="list-style-type: disc">Allows anyone access to the login page: <code class="literal">loginPage("/login").permitAll();</code></li></ul></div></div></div>
<div class="section" title="Authenticating users using a database"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Authenticating users using a database</h1></div></div></div><p>In this <a id="id284" class="indexterm"/>recipe, you'll learn how to use user credentials (username and password) from a database for authentication.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec133"/>How to do it…</h2></div></div></div><p>Here are<a id="id285" class="indexterm"/> the steps to use user credentials in a database for authentication:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Spring JDBC Maven dependency in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt; 
    &lt;groupId&gt;org.springframework&lt;/groupId&gt; 
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; 
    &lt;version&gt;${spring.version}&lt;/version&gt; 
&lt;/dependency&gt; </pre></div></li><li class="listitem">In the database, create the <code class="literal">users</code> and <code class="literal">authorities</code> tables:<div class="informalexample"><pre class="programlisting">create table users(
  username varchar(50) not null,
  password varchar(50) not null,
  enabled boolean not null default true,
  primary key (username)
);

create table authorities (
    username varchar(50) not null,
    authority varchar(50) not null,
    constraint fk_authorities_users foreign key(username) references users(username)
);

create unique index ix_auth_username on authorities (username,authority);    </pre></div></li><li class="listitem">In the <a id="id286" class="indexterm"/>database, add users and their<a id="id287" class="indexterm"/> roles:<div class="informalexample"><pre class="programlisting">insert into users (username, password) values ('user1','pwd1');
insert into users (username, password) values ('user2','pwd2');
 
insert into authorities (username, authority) values ('user1', 'ADMIN');
insert into authorities (username, authority) values ('user2', 'ADMIN');</pre></div></li><li class="listitem">In the <code class="literal">SecurityConfig</code> class, add a <code class="literal">DataSource</code> bean with the database connection details:<div class="informalexample"><pre class="programlisting">@Bean 
public DataSource dataSource() { 
        DriverManagerDataSource dataSource = new DriverManagerDataSource(); 
         
dataSource.setDriverClassName("com.mysql.jdbc.Driver"); 
dataSource.setUrl("jdbc:mysql://localhost:3306/db1"); 
        dataSource.setUsername("user1"); 
        dataSource.setPassword("pass1"); 
          
        return dataSource; 
}</pre></div></li><li class="listitem">In the <code class="literal">SecurityConfig</code> class, add a <code class="literal">DataSourceTransactionManager</code> bean:<div class="informalexample"><pre class="programlisting">@Bean 
public DataSourceTransactionManager transactionManager() { 
    DataSourceTransactionManager transactionManager = new DataSourceTransactionManager(); 
    transactionManager.setDataSource(dataSource()); 
    return transactionManager; 
}</pre></div></li><li class="listitem">In the <code class="literal">SecurityConfig</code> class, override the Spring's <code class="literal">configure()</code> method:<div class="informalexample"><pre class="programlisting">@Autowired 
public void configure(AuthenticationManagerBuilder auth) throws Exception { 
    auth.jdbcAuthentication() 
            .dataSource(dataSource()) 
            .usersByUsernameQuery( 
                    "select username,password,enabled from users where username=?") 
            .authoritiesByUsernameQuery( 
                    "select username,authority from authorities where username=?"); 
} </pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec134"/>How it works…</h2></div></div></div><p>With <a id="id288" class="indexterm"/>the <code class="literal">configure()</code> method overridden, Spring Security<a id="id289" class="indexterm"/> will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use JDBC for authentication</li><li class="listitem" style="list-style-type: disc">Use the provided <code class="literal">DataSource</code> bean to connect to the database</li><li class="listitem" style="list-style-type: disc">Perform these SQL queries to get users and their roles</li></ul></div></div></div>
<div class="section" title="Adding a logout link"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Adding a logout link</h1></div></div></div><p>In this<a id="id290" class="indexterm"/> recipe, you'll learn how to add a URL <code class="literal">/logout</code> to let the user log out.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec135"/>How to do it…</h2></div></div></div><p>In the <code class="literal">SecurityConfig</code> class, in the <code class="literal">configure()</code> method, call the <code class="literal">logout()</code> method and the <code class="literal">logoutRequestMatcher()</code> method to declare a logout URL:</p><div class="informalexample"><pre class="programlisting">protected void configure(HttpSecurity http) throws Exception { 
  ...
  AntPathRequestMatcher pathRequestMatcher = new AntPathRequestMatcher("/logout");
  http.logout().logoutRequestMatcher(pathRequestMatcher); 
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Use <code class="literal">org.springframework.security.web.util.</code>
<span class="strong"><strong>matcher</strong></span>
<code class="literal">.AntPathRequestMatcher</code>, and not the deprecated <code class="literal">org.springframework.security.web.util.AntPathRequestMatcher</code> class.</p></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec136"/>How it works…</h2></div></div></div><p>While going to the URL <code class="literal">/logout</code>, the user will be logged out.</p></div></div>
<div class="section" title="Using public folders"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Using public folders</h1></div></div></div><p>Some folders need their contents to be accessible without authentication, for example, the folder containing CSS files, the folder containing JavaScript files, and the folder containing <a id="id291" class="indexterm"/>static images. None of these usually contain confidential information and some of their files may be necessary to display the login page and the public pages of the website properly.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec137"/>How to do it…</h2></div></div></div><p>In the security configuration class, override the <code class="literal">configure(WebSecurity web)</code> method to define the public folders:</p><div class="informalexample"><pre class="programlisting">@Override
public void configure(WebSecurity web) throws Exception {
    web
      .ignoring()
        .antMatchers("<span class="strong"><strong>/css</strong></span>/**")
        .antMatchers("<span class="strong"><strong>/js</strong></span>/**");
        .antMatchers("<span class="strong"><strong>/img</strong></span>/**");
}</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec138"/>There's more…</h2></div></div></div><p>It's also possible to define them in the standard <code class="literal">configure()</code> method:</p><div class="informalexample"><pre class="programlisting">protected void configure(HttpSecurity http) throws Exception { 
  http.authorizeRequests() 
      .antMatchers("<span class="strong"><strong>/css</strong></span>/**", "<span class="strong"><strong>/js</strong></span>/**", "<span class="strong"><strong>/img</strong></span>/**").permitAll()
      .anyRequest().authenticated(); 
}</pre></div><p>This enables public access to these folders, but requires authentication for any other request.</p></div></div>
<div class="section" title="Authorizing only users with a specific role to view some pages"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Authorizing only users with a specific role to view some pages</h1></div></div></div><p>There are <a id="id292" class="indexterm"/>pages that only a few users should be allowed to access. For example, admin pages should be accessible only to admin users. This is done by matching the URLs of these pages to user roles, which were defined when the users were created; refer to the <span class="emphasis"><em>Authenticating users using the default login page</em></span> and <span class="emphasis"><em>Authenticating users using a database</em></span> recipes.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec139"/>How to do it…</h2></div></div></div><p>In the <code class="literal">configure()</code> method, use the <code class="literal">hasRole()</code> method:</p><div class="informalexample"><pre class="programlisting">http.authorizeRequests() 
    .antMatchers("/admin/**").hasRole("ADMIN") 
    .anyRequest().authenticated(); </pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec140"/>How it works…</h2></div></div></div><p>This allows <a id="id293" class="indexterm"/>access to URLs starting with the <code class="literal">/admin</code> path only to users with the <code class="literal">ADMIN</code> role.</p></div></div>
<div class="section" title="Displaying page elements only to authenticated users in views"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Displaying page elements only to authenticated users in views</h1></div></div></div><p>In this recipe, you'll learn how to display some elements of a page only to authenticated users. For example, a <a id="id294" class="indexterm"/>summary box with the information<a id="id295" class="indexterm"/> about the account of the currently logged-in user.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec141"/>How to do it…</h2></div></div></div><p>Use the <code class="literal">&lt;sec:authorize&gt;</code> tag in the JSP file to add conditions for some content to be displayed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Maven dependency for the Spring Security JSP tags library in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
  &lt;artifactId&gt;spring-security-taglibs&lt;/artifactId&gt;
  &lt;version&gt;3.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem">In the JSP, declare the tag library and use <code class="literal">&lt;sec:authorize&gt;</code>:<div class="informalexample"><pre class="programlisting">&lt;%@ taglib prefix="<span class="strong"><strong>sec</strong></span>" uri="http://www.springframework.org/security/tags" %&gt;    

&lt;<span class="strong"><strong>sec:authorize access="isAuthenticated()"</strong></span>&gt;
  Username: &lt;sec:authentication property="principal.username" /&gt;
&lt;/sec:authorize&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec142"/>How it works…</h2></div></div></div><p>The text in the <code class="literal">sec:authorize</code> tag will be displayed only for authenticated users. We used the <code class="literal">sec:authentication</code> tag to display the username of the currently logged-in user.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec143"/>There's more…</h2></div></div></div><p>To display contents only to the not-authenticated users, use the <code class="literal">isAnonymous()</code> function:</p><div class="informalexample"><pre class="programlisting">&lt;sec:authorize access="isAnonymous()"&gt;
  This will be shown only to not-authenticated users.
&lt;/sec:authorize&gt;</pre></div><p>To display contents only to the users with the <code class="literal">ADMIN</code> role, use the <code class="literal">hasRole()</code> function.</p><div class="informalexample"><pre class="programlisting">&lt;sec:authorize access="hasRole('ADMIN')"&gt;
  This will be shown only to users who have the "ADMIN" authority.
&lt;/sec:authorize&gt;</pre></div><p>To display contents to the users with the <code class="literal">ADMIN</code> role or the <code class="literal">WARRIOR</code> role, use the hasAnyRole() function.</p><div class="informalexample"><pre class="programlisting">&lt;sec:authorize access="hasAnyRole('ADMIN', 'WARRIOR')"&gt;
  This will be shown only to users who have the "ADMIN" or the "WARRIOR" authority.
&lt;/sec:authorize&gt;</pre></div><p>A full list of all the <a id="id296" class="indexterm"/>Spring expressions is available at:</p><p><a class="ulink" href="http://docs.spring.io/spring-security/site/docs/3.0.x/reference/el-access.html">http://docs.spring.io/spring-security/site/docs/3.0.x/reference/el-access.html</a>.</p></div></div>
<div class="section" title="Using HTTPS with Tomcat"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Using HTTPS with Tomcat</h1></div></div></div><p>To use HTTPS URLs, no Spring configuration is required, but you need to enable HTTPS on <a id="id297" class="indexterm"/>your server. In this recipe, we'll cover how to do <a id="id298" class="indexterm"/>this for Tomcat (on a Mac OS or Linux) using a self-generated SSL certificate. For production, remember to use a real commercial SSL certificate.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec144"/>How to do it…</h2></div></div></div><p>Here are the steps to enable HTTPS for Tomcat:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To generate an SSL certificate, open a Terminal and use the <code class="literal">keytool</code> command to create <code class="literal">certificate.bin</code>. In this example, the certificate user name is <code class="literal">admin</code> and the password is <code class="literal">adminpass</code>:<div class="informalexample"><pre class="programlisting">keytool -genkey -alias admin -keypass adminpass -keystore certificate.bin -storepass adminpass</pre></div></li><li class="listitem">Accept the default values, except for the last question whose answer should be <code class="literal">yes</code>:<div class="informalexample"><pre class="programlisting">What is your first and last name?
  [Unknown]:  
What is the name of your organizational unit?
  [Unknown]:  
What is the name of your organization?
  [Unknown]:  
What is the name of your City or Locality?
  [Unknown]:  
What is the name of your State or Province?
  [Unknown]:  
What is the two-letter country code for this unit?
  [Unknown]:  
Is CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown correct?
  [no]:  <span class="strong"><strong>yes</strong></span>
</pre></div></li><li class="listitem">Move <code class="literal">certificate.bin</code> to the root of Tomcat's folder.</li><li class="listitem">In <code class="literal">&lt;tomcat_folder&gt;/conf/server.xml</code>, uncomment the definition starting <a id="id299" class="indexterm"/>with <code class="literal">&lt;Connector port="8443"</code> and <a id="id300" class="indexterm"/>add the <code class="literal">keystoreFile</code> and <code class="literal">keystorePass</code> attributes:<div class="informalexample"><pre class="programlisting">&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
           maxThreads="150" scheme="https" secure="true"
           clientAuth="false" sslProtocol="TLS"
           <span class="strong"><strong>keystoreFile="certificate.bin"</strong></span> <span class="strong"><strong>keystorePass="adminpass"</strong></span> /&gt;</pre></div></li><li class="listitem">Restart Tomcat and make sure that your web application is available via HTTPS on the <code class="literal">8443</code> port: <code class="literal">https://localhost:8443</code>.</li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec145"/>How it works…</h2></div></div></div><p>We configured Tomcat to accept incoming HTTPS requests on the <code class="literal">8443</code> port using a self-signed SSL certificate. Most web browsers will display a security warning before displaying the page because the SSL certificate is self-signed.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec146"/>There's more…</h2></div></div></div><p>The <code class="literal">certificate.bin</code> file can be anywhere on the machine, just use an absolute path in <code class="literal">server.xml</code>.</p><p>It's possible<a id="id301" class="indexterm"/> to change the port number <code class="literal">8443</code> to anything <a id="id302" class="indexterm"/>else.</p><p>It's possible to use HTTPS exclusively by disabling access via plain HTTP; comment out the non-SSL connector in <code class="literal">server.xml</code>.</p><p>For more information <a id="id303" class="indexterm"/>about Tomcat and HTTPS/SSL, go to <a class="ulink" href="https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html">https://tomcat.apache.org/tomcat-8.0-doc/ssl-howto.html</a>.</p></div></div></body></html>