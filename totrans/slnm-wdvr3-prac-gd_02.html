<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Different Available WebDrivers</h1>
                </header>
            
            <article>
                
<p>The previous chapter introduced the Selenium WebDriver architecture and WebDriver interface. We used Google Chrome with ChromeDriver to create a simple test. In this chapter, we will explore the WebDriver implementation for Mozilla Firefox, Microsoft Internet Explorer, Microsoft Edge, and Safari. With WebDriver becoming a W3C specification, all of the major browser vendors now support WebDriver natively. In this chapter, we will look at the following:</p>
<ul>
<li>Using driver-specific implementations for Mozilla Firefox, Google Chrome, Microsoft Internet Explorer and Edge, and Apple Safari</li>
<li>Using the browser options class to execute tests in headless mode and use custom profiles</li>
<li>Using mobile emulation with Google Chrome</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Firefox Driver</h1>
                </header>
            
            <article>
                
<p>The implementation of Firefox Driver has been changed in Selenium 3.0. Starting with Firefox version 47.0+, we need to use <span>separate a driver that will interact with the Firefox browser similarly to ChromeDriver. The new driver for Firefox is called Geckodriver. </span></p>
<p><span>The Geckodriver provides the HTTP API described by the W3C WebDriver Protocol </span><span>to communicate with Gecko browsers, such as Firefox. It translates calls into the Firefox Remote Protocol (Marionette) </span><span> by acting as a proxy between the local and remote ends.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using GeckoDriver</h1>
                </header>
            
            <article>
                
<p>In this section, we will see how to configure and use <strong>Geckodriver</strong> for Firefox in our tests. First of all, we need to download the <strong>Geckodriver</strong> executable from  <a href="https://github.com/mozilla/geckodriver/releases">https://github.com/mozilla/geckodriver/releases</a></p>
<p class="mce-root"/>
<p><span>Download the appropriate version of <strong>Geckodriver</strong> based on the Firefox version installed on your computer as well as the operating system. Copy the executable file into the <kbd>/src/test/resources/drivers</kbd> folder.</span></p>
<p>We will use the Search Test we created in Chapter 1 and modify the test to use the <strong>Geckodriver</strong>. For this, we need to modify the <kbd>setup()</kbd> method, provide the path of the <strong>Geckodriver</strong> binary in the <span><kbd>webdriver.gecko.driver</kbd> property, and instantiate the <kbd>FirefoxDriver</kbd> class:</span></p>
<pre><span>public class </span>SearchTest {<br/><br/>    WebDriver <span>driver</span><span>;<br/></span><span><br/></span><span>    </span><span>@BeforeMethod<br/></span><span>    </span><span>public void </span><span>setup</span>() {<br/><br/><strong>        System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/geckodriver.exe"</span>)</strong><span><strong>;</strong><br/></span><span><br/></span><strong><span>        </span><span>driver </span>= <span>new </span>FirefoxDriver()<span>;<br/></span><span>        </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)</strong><span><strong>;</strong><br/></span><span>    </span>}<br/><br/>    <span>@Test<br/></span><span>    </span><span>public void </span><span>searchProduct</span>() {<br/><br/>        <span>// find search box and enter search string<br/></span><span>        </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchBox.sendKeys(<span>"Phones"</span>)<span>;<br/></span><span><br/></span><span>        </span>WebElement searchButton =<br/>                <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchButton.click()<span>;<br/></span><span><br/></span><span>        </span><span>assertThat</span>(<span>driver</span>.getTitle())<br/>                .isEqualTo(<span>"Search results for: 'Phones'"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@AfterMethod<br/></span><span>    </span><span>public void </span><span>tearDown</span>() {<br/>        <span>driver</span>.quit()<span>;<br/></span><span>    </span>}<br/>}   </pre>
<p class="mce-root"/>
<p>Now execute the test, and you will see <strong>Geckodriver</strong> running in the console:</p>
<pre>1532165868138 geckodriver INFO geckodriver 0.21.0<br/>1532165868147 geckodriver INFO Listening on 127.0.0.1:36466</pre>
<p>It will launch a new Firefox window and execute the test. The Firefox window will be closed at the end of the execution.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Headless Mode</h1>
                </header>
            
            <article>
                
<p><span>Headless mode is a very useful way to run Firefox for automated testing with Selenium WebDriver. In headless mode, Firefox runs as normal only you don't see the UI components. This makes Firefox faster and tests run more efficiently, especially in the CI (Continuous Integration) environment. </span></p>
<p>We can run Selenium tests in headless mode by configuring the <kbd>FirefoxOptions</kbd> class, as shown in the following code snippet:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() {<br/><br/><br/>    System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>            </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><strong><span>    </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>    </span>firefoxOptions.setHeadless(<span>true</span>)<span>;<br/></span><span><br/></span><span>    </span><span>driver </span>= <span>new </span>FirefoxDriver(firefoxOptions)<span>;<br/></span></strong><span><br/></span><span>    </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span>}</pre>
<p>In the preceding code, we first created an instance of the <kbd>FirefoxOptions</kbd> class, called the <kbd>setHeadless()</kbd> method, that passes the value as <kbd>true</kbd> to launch the Firefox browser in headless mode. You will see a long message indicating the browser instance has been launched in headless mode, as shown in the following console output:</p>
<pre>1532194389309 geckodriver INFO geckodriver 0.21.0<br/>1532194389317 geckodriver INFO Listening on 127.0.0.1:21734<br/>1532194390907 mozrunner::runner INFO Running command: "/Applications/Firefox.app/Contents/MacOS/firefox-bin" "-marionette" "-headless" "-foreground" "-no-remote" "-profile" "/var/folders/zr/rdwhsjk54k5bj7yr34rfftrh0000gn/T/rust_mozprofile.DmJCQRKVVRs6"<br/> *** You are running in headless mode.</pre>
<p>During the execution, you will not see the Firefox window on the screen but the test will be executed in headless mode.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding the Firefox profile</h1>
                </header>
            
            <article>
                
<p>A Firefox profile is a folder that the Firefox browser uses to store all your passwords, bookmarks, settings, and other user data. A Firefox user can create any number of profiles with different custom settings and use it accordingly. According to Mozilla, the following are the different attributes that can be stored in the profiles:</p>
<ul>
<li>Bookmarks and browsing history</li>
<li>Passwords</li>
<li>Site-specific preferences</li>
<li>Search engines</li>
<li>A personal dictionary</li>
<li>Autocomplete history</li>
<li>Download history</li>
<li>Cookies</li>
<li>DOM Storage</li>
<li>Security certificate settings</li>
<li>Security device settings</li>
<li>Download actions</li>
<li>Plugin MIME types</li>
<li>Stored sessions</li>
<li>Toolbar customizations</li>
<li>User styles</li>
</ul>
<p>To create, rename, or delete a profile, you have to perform the following steps:</p>
<ol>
<li>Open the Firefox profile manager. To do that, in the command prompt terminal, navigate to the install directory of Firefox; typically, it is in <strong>Program Files</strong> if you are on Windows. Navigate to the location where you can find the <kbd>firefox</kbd> binary file, and execute the following command:</li>
</ol>
<pre>      /path/to/firefox -p</pre>
<p style="padding-left: 90px">It will open the profile manager, which will look like the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/815a8608-1f1e-44f5-af70-4bd26616b2a4.png" style="width:26.67em;height:23.58em;"/></p>
<p style="padding-left: 90px">Note<span> that before executing the preceding command, you need to make sure you close all your currently-running Firefox instances.</span></p>
<ol start="2">
<li>Use the <span class="packt_screen">Create Profile...</span> button to create another profile, the <span class="packt_screen">Rename Profile...</span> button to rename an existing profile, and the <span class="packt_screen">Delete Profile...</span> button to delete one.</li>
</ol>
<p>So, coming back to our WebDriver, whenever we create an instance of <kbd>FirefoxDriver</kbd>, a temporary profile is created and used by the WebDriver. To see the profile that is currently being used by a Firefox instance, navigate to <span class="packt_screen">Help | Troubleshooting</span> <span class="packt_screen">Information</span>.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p>This will launch all the details of the particular Firefox instance of which the profile is a part. It will look similar to the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/6fb35369-ad22-460e-a2dc-03d7a43c4555.png"/></p>
<p class="mce-root"/>
<p>The highlighted oval in the preceding screenshot shows the profile folder. Click on the <span class="packt_screen">Show Folder</span> button; it should open the location of the profile corresponding to that of your current Firefox instance. Now, let's launch a Firefox browser instance using our FirefoxDriver, and verify its profile location.</p>
<p>Let's launch a Firefox browser using the following code:</p>
<pre><span>public class </span>FirefoxProfile { <br/> <span>public static void </span><span>main</span>(String... args) {<br/> System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span> </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span> </span>FirefoxDriver driver = <span>new </span>FirefoxDriver()<span>; <br/></span><span> </span>driver.get(<span>"http://www.google.com"</span>)<span>; <br/></span><span> </span>}<br/>}</pre>
<p>This will launch a browser instance. Now, navigate to <span class="packt_screen">Help | Troubleshooting</span> <span class="packt_screen">Information</span>, and once the info is launched, click the <span class="packt_screen">Show Folder</span> button. This will open the current WebDriver's profile directory. Every time you launch a Firefox instance using Firefox Driver, it will create a new profile for you. If you go one level above this directory, you will see the profiles created by your <span class="packt_screen">FirefoxDriver</span>, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/3db28be6-cd39-48b5-9436-2acde675b3d3.png"/></p>
<p>All the preceding folders correspond to each of the Firefox instances launched by the FirefoxDriver.</p>
<p>So far, we have seen what Firefox profiles are and how WebDriver creates one every time it launches the browser. Now, let's see how we can create our own custom profiles using WebDriver APIs. The following is the code example to create your own Firefox profile using the WebDriver library and set the options you want your browser to have, overriding what FirefoxDriver gives you:</p>
<pre><span>public class </span>FirefoxCustomProfile {<br/>    <span>public static void </span><span>main</span>(String... args) {<br/><br/>        System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><span>        </span><strong>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span></strong><span><br/></span><strong><span>        </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>        </span>firefoxOptions.setProfile(profile)<span>;<br/></span></strong><span><br/></span><strong><span>        </span>FirefoxDriver driver = <span>new </span>FirefoxDriver(firefoxOptions)</strong><span><strong>;</strong><br/></span><span>        try </span>{<br/>            driver.get(<span>"http://www.google.com"</span>)<span>;<br/></span><span>        </span>} <span>finally </span>{<br/>            driver.quit()<span>;<br/></span><span>        </span>}<br/>    }<br/>}</pre>
<p>In the preceding code, <kbd>FirefoxProfile</kbd> is the class that has been instantiated to create a custom profile for the Firefox browser launched from the test. Now, having an instance of that class, we can set various options and preferences in it, which we will discuss shortly. First, there are two overloaded versions of constructors for <kbd>FirefoxProfile</kbd>. One creates an empty profile and moulds it according to requirements. This is seen in the preceding code. The second version creates a profile instance from an existing profile directory, as follows:</p>
<pre>public FirefoxProfile(java.io.File profileDir)</pre>
<p>Here, the <kbd>profileDir</kbd> input parameter is the directory location of an existing profile. The profile directory is the one we saw in the preceding screenshot. Let's discuss some interesting customizations that we can do to our Firefox browser using Firefox profiles.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding the extension to Firefox</h1>
                </header>
            
            <article>
                
<p>In this section, we will see how we can extend our Firefox browser with some additional capabilities using Profiles. Whenever WebDriver launches a new Firefox browser, it creates a new profile on the disk, and this profile doesn't contain any of the installed Firefox extensions in it.  We will add an extension using the Profiles every time WebDriver creates an instance of the Firefox browser.</p>
<p>Now, let's change the profile using the <kbd>addExtension()</kbd> method provided by <kbd>FirefoxProfile</kbd>. This method is used to add extensions to the Firefox browser.</p>
<p>The following is the API syntax for the method:</p>
<pre>public void addExtension(java.io.File extensionToInstall) throws java.io.IOException</pre>
<p>The input parameter is the XPI file that has to be installed on the Firefox browser. If WebDriver doesn't find the file in the specified location, it will raise <kbd>IOException</kbd>. The following is the code to override the default profile and extend the Firefox browser to have an extension named Xpath Finder:</p>
<pre><span>public class </span>FirefoxCustomProfile {<br/>    <span>public static void </span><span>main</span>(String... args) {<br/><br/>        System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><span>        </span>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span><span>        </span><strong>profile.addExtension(</strong><br/><strong>                <span>new </span>File(<span>"./src/test/resources/extensions/xpath_finder.xpi"</span>))</strong><span><strong>;</strong><br/></span><span><br/></span><span>        </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>        </span>firefoxOptions.setProfile(profile)<span>;<br/></span><span><br/></span><span>        </span>FirefoxDriver driver = <span>new </span>FirefoxDriver(firefoxOptions)<span>;<br/></span><span>        try </span>{<br/>            driver.get(<span>"http://www.google.com"</span>)<span>;<br/></span><span>        </span>} <span>finally </span>{<br/>            <span>//driver.quit();<br/></span><span>        </span>}<br/>    }<br/>}</pre>
<p>Now, if you see the Firefox browser that is launched by the FirefoxDriver, you will find the Xpath Finder extension installed on it. In the console log, you will see a message indicating the extension has been added to the browser:</p>
<p><strong>1532196699704 addons.xpi-utils DEBUG New add-on xPathFinder@0.9.3 installed in app-profile</strong></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Storing and retrieving a profile</h1>
                </header>
            
            <article>
                
<p>We can also write the profile information of the browser to the JSON file and later instantiate new browsers with the same profile. The <kbd>FirefoxProfile</kbd> class provides a method to export the profile information as JSON. The following is its API syntax:</p>
<pre>public String toJson()</pre>
<p>The output or return type is a String, which contains the JSON information in it.</p>
<p>Now, to create a browser with the same profile, the <kbd>FirefoxProfile</kbd> class provides a static method that takes the JSON string as the input. The following is the API syntax:</p>
<pre>public static FirefoxProfile fromJson(java.lang.String json) throws java.io.IOException</pre>
<p>This is a static method in the <kbd>FirefoxProfile</kbd> class that takes the JSON string to create a profile from. The following is the code example for that:</p>
<pre>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span>profile.addExtension(<br/>        <span>new </span>File(<span>"./src/test/resources/extensions/xpath_finder.xpi"</span>))<span>;<br/></span>String json = profile.toJson()<span>;<br/></span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span>firefoxOptions.setProfile(FirefoxProfile.<span>fromJson</span>(json))<span>;<br/></span></pre>
<p>In the preceding code, we have exported the profile as a JSON string. In your test case, you can write that JSON information to a file and store it. Later, you can read the JSON file using <kbd>FirefoxOptions</kbd> and create <kbd>FirefoxDriver</kbd> from that.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Dealing with Firefox preferences</h1>
                </header>
            
            <article>
                
<p>So far, we have learned about Firefox profiles, and how we can create our own customized profiles for Firefox Driver. Now, let's see how we can set our preferences in the profiles we create and where FirefoxDriver stores them.</p>
<p class="mce-root"/>
<p>According to Mozilla, a Firefox Preference is any value or defined behavior that can be set by a user. These values are saved to the preference files. If you open the profile directory by navigating to <span class="packt_screen">Help | Troubleshooting</span> <span class="packt_screen">Information</span> and clicking on the <span class="packt_screen">Show Folder</span> button, you will see two preference files: <kbd>prefs.js</kbd> and <kbd>user.js</kbd>. All the user preferences are written to the <kbd>prefs.js</kbd> file by the Firefox application during the launch. A user can override those values for their chosen values, and they are stored in the <kbd>user.js</kbd> file. The value in <kbd>user.js</kbd> for a preference takes precedence over all the other values set for that particular preference. So, your FirefoxDriver overwrites all the default preferences of Firefox in the <kbd>user.js</kbd> file for you. When you add a new preference, FirefoxDriver writes that to the <kbd>user.js</kbd> preference file, and the Firefox browser behaves accordingly.</p>
<p>Open the <kbd>user.js</kbd> file in the profile directory. The following are the list of all the preferences that FirefoxDriver sets for you by default:</p>
<pre>user_pref(<span>"app.normandy.api_url"</span><span>, </span><span>""</span>)<span>;<br/></span>user_pref(<span>"app.update.auto"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"app.update.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.EULA.3.accepted"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"browser.EULA.override"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"browser.displayedE10SNotice"</span><span>, </span><span>4</span>)<span>;<br/></span>user_pref(<span>"browser.dom.window.dump.enabled"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"browser.download.manager.showWhenStarting"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.laterrun.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.link.open_external"</span><span>, </span><span>2</span>)<span>;<br/></span>user_pref(<span>"browser.link.open_newwindow"</span><span>, </span><span>2</span>)<span>;<br/></span>user_pref(<span>"browser.newtab.url"</span><span>, </span><span>"about:blank"</span>)<span>;<br/></span>user_pref(<span>"browser.newtabpage.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.offline"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.reader.detectedFirstArticle"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.blockedURIs.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.downloads.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.malware.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.passwords.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.safebrowsing.phishing.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.search.update"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.selfsupport.url"</span><span>, </span><span>""</span>)<span>;<br/></span>user_pref(<span>"browser.sessionstore.resume_from_crash"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.shell.checkDefaultBrowser"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.showQuitWarning"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.snippets.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.snippets.firstrunHomepage.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.snippets.syncPromo.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.startup.homepage"</span><span>, </span><span>"about:blank"</span>)<span>;<br/></span>user_pref(<span>"browser.startup.homepage_override.mstone"</span><span>, </span><span>"ignore"</span>)<span>;<br/></span>user_pref(<span>"browser.startup.page"</span><span>, </span><span>0</span>)<span>;<br/></span>user_pref(<span>"browser.tabs.closeWindowWithLastTab"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.tabs.warnOnClose"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.tabs.warnOnOpen"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.uitour.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"browser.usedOnWindows10.introURL"</span><span>, </span><span>"about:blank"</span>)<span>;<br/></span>user_pref(<span>"browser.warnOnQuit"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.about.reportUrl"</span><span>, </span><span>"http://%(server)s/dummy/abouthealthreport/"</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.documentServerURI"</span><span>, </span><span>"http://%(server)s/dummy/healthreport/"</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.logging.consoleEnabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.service.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.service.firstRun"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.healthreport.uploadEnabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.policy.dataSubmissionEnabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.policy.dataSubmissionPolicyAccepted"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"datareporting.policy.dataSubmissionPolicyBypassNotification"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"devtools.errorconsole.enabled"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"dom.disable_open_during_load"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"dom.ipc.reportProcessHangs"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"dom.max_chrome_script_run_time"</span><span>, </span><span>30</span>)<span>;<br/></span>user_pref(<span>"dom.max_script_run_time"</span><span>, </span><span>30</span>)<span>;<br/></span>user_pref(<span>"dom.report_all_js_exceptions"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"extensions.autoDisableScopes"</span><span>, </span><span>10</span>)<span>;<br/></span>user_pref(<span>"extensions.blocklist.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"extensions.checkCompatibility.nightly"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"extensions.enabledScopes"</span><span>, </span><span>5</span>)<span>;<br/></span>user_pref(<span>"extensions.installDistroAddons"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"extensions.logging.enabled"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"extensions.shield-recipe-client.api_url"</span><span>, </span><span>""</span>)<span>;<br/></span>user_pref(<span>"extensions.showMismatchUI"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"extensions.update.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"extensions.update.notifyUser"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"focusmanager.testmode"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"general.useragent.updates.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"geo.provider.testing"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"geo.wifi.scan"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"hangmonitor.timeout"</span><span>, </span><span>0</span>)<span>;<br/></span>user_pref(<span>"javascript.enabled"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"javascript.options.showInConsole"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"marionette.log.level"</span><span>, </span><span>"INFO"</span>)<span>;<br/></span>user_pref(<span>"marionette.port"</span><span>, </span><span>51549</span>)<span>;<br/></span>user_pref(<span>"network.captive-portal-service.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"network.http.phishy-userpass-length"</span><span>, </span><span>255</span>)<span>;<br/></span>user_pref(<span>"network.manage-offline-status"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"network.sntp.pools"</span><span>, </span><span>"%(server)s"</span>)<span>;<br/></span>user_pref(<span>"offline-apps.allow_by_default"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"plugin.state.flash"</span><span>, </span><span>0</span>)<span>;<br/></span>user_pref(<span>"prompts.tab_modal.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"security.csp.enable"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"security.fileuri.origin_policy"</span><span>, </span><span>3</span>)<span>;<br/></span>user_pref(<span>"security.fileuri.strict_origin_policy"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"services.settings.server"</span><span>, </span><span>"http://%(server)s/dummy/blocklist/"</span>)<span>;<br/></span>user_pref(<span>"signon.rememberSignons"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"startup.homepage_welcome_url"</span><span>, </span><span>""</span>)<span>;<br/></span>user_pref(<span>"startup.homepage_welcome_url.additional"</span><span>, </span><span>"about:blank"</span>)<span>;<br/></span>user_pref(<span>"toolkit.networkmanager.disable"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"toolkit.startup.max_resumed_crashes"</span><span>, </span>-<span>1</span>)<span>;<br/></span>user_pref(<span>"toolkit.telemetry.enabled"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"toolkit.telemetry.prompted"</span><span>, </span><span>2</span>)<span>;<br/></span>user_pref(<span>"toolkit.telemetry.rejected"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"toolkit.telemetry.server"</span><span>, </span><span>"https://%(server)s/dummy/telemetry/"</span>)<span>;<br/></span>user_pref(<span>"webdriver_accept_untrusted_certs"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"webdriver_assume_untrusted_issuer"</span><span>, </span><span>true</span>)<span>;<br/></span>user_pref(<span>"xpinstall.signatures.required"</span><span>, </span><span>false</span>)<span>;<br/></span>user_pref(<span>"xpinstall.whitelist.required"</span><span>, </span><span>false</span>)<span>;<br/></span></pre>
<p>This Firefox Driver treats them as <kbd>Frozen Preferences</kbd> and doesn't allow the test-script developer to change them. However, there are a few preferences in the preceding list that FirefoxDriver allows you to change, which we will see shortly.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting preferences</h1>
                </header>
            
            <article>
                
<p>Now we will learn how to set our own preferences. As an example, we will see how to change the user agent of your browser. These days, many web applications have a main site as well as a mobile site/m. site. The application will validate the user agent of the incoming request and decide whether to act as a server for a normal site or mobile site. So, in order to test your mobile site from your laptop or desktop browser, you just have to change your user agent. Let's see a code example where we can change the user-agent preference of our Firefox browser using FirefoxDriver, and send a request to the Facebook homepage. But before that, let's see the <kbd>setPreference()</kbd> method provided by the FirefoxProfile class:</p>
<pre>public void setPreference(java.lang.String key, String value)</pre>
<p>The input parameters are <kbd>key</kbd>, which is a string and represents your preference, and <kbd>value</kbd>, which has to be set to the preference.</p>
<p class="mce-root"/>
<p>There are two other overloaded versions of the preceding method shown; one of which is as follows:</p>
<pre>public void setPreference(java.lang.String key, int value)</pre>
<p>Here is the other overloaded version:</p>
<pre>public void setPreference(java.lang.String key,boolean value)</pre>
<p>Now, using the preceding <kbd>setPreference()</kbd> method, we will try to change the user agent of our browser using the following code:</p>
<pre><span>public class </span>SettingPreferences {<br/>    <span>public static void </span><span>main</span>(String... args) {<br/><br/>        System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><span>        </span>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span><span>        </span><strong>profile.setPreference(<span>"general.useragent.override"</span><span>,<br/></span><span>         </span><span>"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) " </span>+ </strong><br/><strong>         <span>"AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 " </span>+ </strong><br/><strong>         <span>"Mobile/15A356 Safari/604.1"</span>)</strong><span><strong>;</strong><br/></span><span>        </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>        </span>firefoxOptions.setProfile(profile)<span>;<br/></span><span>        </span>FirefoxDriver driver = <span>new </span>FirefoxDriver(firefoxOptions)<span>;<br/></span><span>        </span>driver.get(<span>"http://facebook.com"</span>)<span>;<br/></span><span>    </span>}<br/>}</pre>
<p>In the preceding code for the <kbd>setPreference()</kbd> method, <kbd>general.useragent.override</kbd> is set as the name of the preference, and the second parameter is the value for that preference, which represents the iPhone user agent. Now open the <kbd>user.js</kbd> file for this particular Firefox instance, and you will see the entry for this preference. You should use the following preference in your <kbd>user.js</kbd> file:</p>
<pre>user_pref(<span>"general.useragent.override"</span><span>, </span><span>"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A356 Safari/604.1"</span>)<span>;</span></pre>
<p>Apart from this, you will observe that the mobile version of the Facebook homepage has been served to you.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding frozen preferences</h1>
                </header>
            
            <article>
                
<p>Now, let's go back to the big list of frozen preferences that <kbd>user.js</kbd> contains, which we saw earlier. The Firefox Driver thinks that a test-script developer doesn't have to deal with them and doesn't allow those values to be changed. Let's pick one frozen preference and try to change its values in our code. Let's consider the <kbd>browser.shell.checkDefaultBrowser</kbd> preference, whose value FirefoxDriver implementers thought should be set to <kbd>false</kbd> so that the Firefox browser does not ask you whether to make Firefox your default browser, if it is not already, when you are busy executing your test cases. Ultimately, you don't have to deal with the pop-up itself in your test scripts. Apart from setting the preference value to <kbd>false</kbd>, the implementers of FirefoxDriver also thought of freezing this value so that users don't alter these values. That is the reason these preferences are called frozen preferences. Now, what happens if you try to modify these values in your test scripts? Let's see a code example:</p>
<pre><span>public class </span>FirefoxFrozenPreferences {<br/>    <span>public static void </span><span>main</span>(String... args) {<br/><br/>        System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><span>        </span>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span><span>        </span><strong>profile.setPreference(<span>"browser.shell.checkDefaultBrowser"</span><span>, true</span>)</strong><span><strong>;</strong><br/></span><span>        <br/></span><span>        </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>        </span>firefoxOptions.setProfile(profile)<span>;<br/></span><span>        <br/></span><span>        </span>FirefoxDriver driver = <span>new </span>FirefoxDriver(firefoxOptions)<span>;<br/></span><span>        </span>driver.get(<span>"http://facebook.com"</span>)<span>;<br/></span><span>    </span>}<br/>}</pre>
<p>Now when you execute your code, you will immediately see an exception saying you're not allowed to override these values. The following is the exception stack trace you will see:</p>
<pre>Exception in thread "main" java.lang.IllegalArgumentException: Preference browser.shell.checkDefaultBrowser may not be overridden: frozen value=false, requested value=true</pre>
<p>This is how FirefoxDriver mandates a few preferences that are not to be touched. However, there are a few preferences of the frozen list that FirefoxDriver allows to alter through code. For that, it explicitly exposes methods in the FirefoxProfile class. Those exempted preferences are for dealing with SSL certificates and native events. Here, we will see how we can override the SSL certificates' preferences.</p>
<p class="mce-root"/>
<p>Let's use a code example that tries to override the default Firefox behavior to handle SSL certificates. The <kbd>FirefoxProfile</kbd> class has two methods to handle the SSL certificates; the first one is as follows:</p>
<pre>public void setAcceptUntrustedCertificates(boolean acceptUntrustedSsl)</pre>
<p>This lets Firefox know whether to accept SSL certificates that are untrusted. By default, it is set to true, that is, Firefox accepts SSL certificates that are untrusted. The second method is as follows:</p>
<pre>public void setAssumeUntrustedCertificateIssuer(boolean untrustedIssuer)</pre>
<p>This lets Firefox assume that the untrusted certificates are issued by untrusted or self-signed certification agents. Firefox, by default, assumes the issuer to be untrusted. That assumption is particularly useful when you test an application in the test environment while using the certificate from the production environment.</p>
<p>The preferences, <kbd>webdriver_accept_untrusted_certs</kbd> and <kbd>webdriver_assume_ untrusted_issuer</kbd>, are the ones related to the SSL certificates. Now, let's create a Java code to modify the values for these two values. By default, the values are set to true, as seen in the <kbd>user.js</kbd> file. Let's mark them as false with the following code:</p>
<pre><span>public static void </span><span>main</span>(String... args) {<br/><br/>    System.<span>setProperty</span>(<span>"webdriver.gecko.driver"</span><span>,<br/></span><span>            </span><span>"./src/test/resources/drivers/geckodriver 2"</span>)<span>;<br/></span><span><br/></span><span>    </span>FirefoxProfile profile = <span>new </span>FirefoxProfile()<span>;<br/></span><span><br/></span><strong><span>    </span>profile.setAssumeUntrustedCertificateIssuer(<span>false</span>)<span>;<br/></span><span>    </span>profile.setAcceptUntrustedCertificates(<span>false</span>)</strong><span><strong>;</strong><br/></span><span>    <br/></span><span>    </span>FirefoxOptions firefoxOptions = <span>new </span>FirefoxOptions()<span>;<br/></span><span>    </span>firefoxOptions.setProfile(profile)<span>;<br/></span><span><br/></span><span>    </span>FirefoxDriver driver = <span>new </span>FirefoxDriver(firefoxOptions)<span>;<br/></span><span>    </span>driver.get(<span>"http://facebook.com"</span>)<span>;<br/></span>}</pre>
<p>Here, we have set the values to false, and now if we open the <kbd>user.js</kbd> file in the profile directory of this instance of Firefox, you will see the values set to false, as follows:</p>
<pre>user_pref("webdriver_accept_untrusted_certs", false);<br/><span>user_pref("webdriver_assume_untrusted_issuer", false);</span></pre>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Chrome Driver</h1>
                </header>
            
            <article>
                
<p>The ChromeDriver works similar to the Geckodriver and implements the W3C WebDriver protocol. We saw how to set up and use ChromeDriver in Chapter 1. In this section, we will focus on the ChromeDriver options to run tests in headless mode, use mobile emulation, and use custom profiles.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Headless Mode</h1>
                </header>
            
            <article>
                
<p><span>Similar to Firefox, we can run tests in headless mode with ChromeDriver. This makes Chrome tests run faster and tests run more efficiently, especially in the CI (Continuous Integration) environment. </span></p>
<p>We can run Selenium tests in headless mode by configuring the <kbd>ChromeOptions</kbd><span> </span>class as shown in the following code snippet:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() {<br/> System.<span>setProperty</span>(<span>"webdriver.chrome.driver"</span><span>,<br/></span><span> </span><span>"./src/test/resources/drivers/chromedriver"</span>)<span>;<br/></span><span><br/> </span><strong>ChromeOptions chromeOptions = <span>new </span>ChromeOptions()<span>;<br/></span><span> </span>chromeOptions.setHeadless(<span>true</span>)<span>;<br/></span></strong><span><br/> </span><span>driver </span>= <span>new </span>ChromeDriver(chromeOptions)<span>;<br/></span><span><br/> </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span><br/></span>}</pre>
<p>In the preceding code, we first created an instance of the<span> </span><kbd>ChromeOptions</kbd> class, called the<span> </span><kbd>setHeadless()</kbd><span> </span>method, that passes the value as<span> </span><kbd>true</kbd><span> </span>to launch the Chrome browser in headless mode. During the execution, you will not see the Chrome window on the screen but the test will be executed in headless mode.</p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using Mobile Emulation for testing mobile web applications</h1>
                </header>
            
            <article>
                
<p><span>The Chrome browser allows users to emulate Chrome on mobile devices, such as Pixel 2, Nexus 7, iPhone, or iPad, from the desktop version of Chrome via DevTools. The following screenshot shows how our sample application will be seen in Chrome for iPhone.</span><span> We can start the mobile emulation in Chrome browser with the following steps:</span></p>
<ol>
<li>Navigate to the sample web application in the Chrome Browser:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/27c36572-adde-4ab4-b430-176504f1d470.png"/></p>
<ol start="2">
<li>Open the Developer Tools. Select the blue Mobile device icon and then select the device. In this example, we selected iPhone X. The Chrome browser will reload according to the selected device:</li>
</ol>
<p class="CDPAlignCenter CDPAlign"><img src="assets/dc360086-3bc6-4f3b-a555-3f5af073d5cb.png"/></p>
<p><span>The mobile-emulation feature allows developers and testers to quickly test how a website will be displayed on a mobile device, without requiring a real device and speed up the development process.</span></p>
<p>We can also use mobile emulation with our Selenium WebDriver tests by configuring ChromeOptions. Let's modify the search test to test on Google Pixel 2:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() {<br/><br/>    System.<span>setProperty</span>(<span>"webdriver.chrome.driver"</span><span>,<br/></span><span>            </span><span>"./src/test/resources/drivers/chromedriver"</span>)<span>;<br/></span><span><br/></span><span>    </span>Map&lt;String<span>, </span>Object&gt; deviceMetrics = <span>new </span>HashMap&lt;&gt;()<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"width"</span><span>, </span><span>411</span>)<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"height"</span><span>, </span><span>823</span>)<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"pixelRatio"</span><span>, </span><span>3.0</span>)<span>;<br/></span><span><br/></span><span><br/></span><span>    </span>Map&lt;String<span>, </span>Object&gt; mobileEmulation = <span>new </span>HashMap&lt;&gt;()<span>;<br/></span><span>    </span>mobileEmulation.put(<span>"deviceMetrics"</span><span>, </span>deviceMetrics)<span>;<br/></span><span>    </span>mobileEmulation.put(<span>"userAgent"</span><span>, </span><span>"Mozilla/5.0 (Linux; Android 8.0.0;" </span>+<br/>            <span>"Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) " </span>+<br/>            <span>"Chrome/67.0.3396.99 Mobile Safari/537.36"</span>)<span>;<br/></span><span><br/></span><span>    </span>ChromeOptions chromeOptions = <span>new </span>ChromeOptions()<span>;<br/></span><span>    </span>chromeOptions.setExperimentalOption(<span>"mobileEmulation"</span><span>, </span>mobileEmulation)<span>;<br/></span><span><br/></span><span>    </span><span>driver </span>= <span>new </span>ChromeDriver(chromeOptions)<span>;<br/></span><span>    </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span><br/></span>}</pre>
<p>The preceding code will enable the Mobile emulation in Chrome during the execution, and will load the mobile version of the Website. This is done by first configuring the Device metrics, such as width and height, using a Java HashMap. In this example, we configured the <kbd>deviceMetrics</kbd> hashmap as shown in the following code:</p>
<pre>Map&lt;String<span>, </span>Object&gt; deviceMetrics = <span>new </span>HashMap&lt;&gt;()<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"width"</span><span>, </span><span>411</span>)<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"height"</span><span>, </span><span>823</span>)<span>;<br/></span><span>    </span>deviceMetrics.put(<span>"pixelRatio"</span><span>, </span><span>3.0</span>)<span>;<br/></span></pre>
<p>Next, we need to create another Hashmap, named <kbd>mobileEmulation</kbd>, that will hold the <kbd>deviceMetrics</kbd> and <kbd>userAgent</kbd> Strings. The <kbd>userAgent</kbd> string specifies which Mobile device should be used, such as Pixel 2 XL, and the rendering engine versions:</p>
<pre><span> </span>Map&lt;String<span>, </span>Object&gt; mobileEmulation = <span>new </span>HashMap&lt;&gt;()<span>;<br/></span><span>    </span>mobileEmulation.put(<span>"deviceMetrics"</span><span>, </span>deviceMetrics)<span>;<br/></span><span>    </span>mobileEmulation.put(<span>"userAgent"</span><span>, </span><span>"Mozilla/5.0 (Linux; Android 8.0.0;" </span>+<br/>            <span>"Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) " </span>+<br/>            <span>"Chrome/67.0.3396.99 Mobile Safari/537.36"</span>)<span>;</span></pre>
<p>Finally, we need to pass the <kbd>mobileEmulation</kbd> hashmap to the ChromeOptions class, and call the <kbd>setExperimentalOption()</kbd> method that passes the <kbd>mobileEmulation</kbd> hashmap:</p>
<pre>ChromeOptions chromeOptions = <span>new </span>ChromeOptions()<span>;<br/></span><strong>chromeOptions.setExperimentalOption(<span>"mobileEmulation"</span><span>, </span>mobileEmulation)</strong><span><strong>;</strong><br/></span><span><br/>driver </span>= <span>new </span>ChromeDriver(chromeOptions)<span>;</span></pre>
<p class="mce-root"/>
<p>This will load the mobile version of the application and Selenium will run the test as usual.</p>
<p>We can get the <kbd>userAgent</kbd> string after configuring the mobile device. Go to the <span class="packt_screen">Network</span> tab in the Chrome Developer tools.  Reload the page, select the first request from the list, and copy the value of the <span class="packt_screen">User-Agent</span> key from the <span class="packt_screen">Headers</span> tab, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/89c2b814-e359-4cd3-9cd7-f45e210724af.png"/></p>
<div class="packt_tip">We can set a number of Chrome preferences using the <kbd>setExperimentalOptions()</kbd> method and the <kbd>ChromeOptions</kbd> class.</div>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding ChromeExtensions</h1>
                </header>
            
            <article>
                
<p>Similar to Firefox, we can add extensions to the Chrome browser by specifying the location of the extension. We can add <strong>Packed</strong> (.crx file) or <strong>Unpacked</strong> (folder) extensions using the ChromeOptions class. </p>
<p>To add a <strong>Packed</strong> extension, we need to call the <kbd>addExtension()</kbd> method:</p>
<pre>ChromeOptions <span>chromeOptions </span>= <span>new </span>ChromeOptions()<span>;<br/></span>chromeOptions.addExtensions(<span>new </span>File(<span>"/path/to/extension.crx"</span>))<span>;</span><span><br/></span>ChromeDriver driver = <span>new </span>ChromeDriver(chromeOptions)<span>;</span></pre>
<p>To add an Unpacked extension, we need to use the <kbd>addArguments()</kbd> method, which will load the extension reading the specified folder while launching the Chrome binary. This is done as follows:</p>
<pre>ChromeOptions <span>chromeOptions </span>= <span>new </span>ChromeOptions()<span>;<br/></span>chromeOptions.addArguments(<span>"load-extension=/path/to/extension"</span>)<span>;</span><span><br/></span>ChromeDriver driver = <span>new </span>ChromeDriver(chromeOptions)<span>;<br/></span></pre>
<p>Similarly, you can use Chrome options to add more extensions, arguments, and Binaries to your Chrome browser.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">InternetExplorerDriver</h1>
                </header>
            
            <article>
                
<p>In order to execute your test scripts on the Internet Explorer browser, you need WebDriver's InternetExplorerDriver. <span>Similar to Google Chrome and Firefox, we need to download the </span><strong>IEDriver Server</strong><span> executable from <a href="https://www.seleniumhq.org/download/">https://www.seleniumhq.org/download/</a>  for Internet Explorer.</span></p>
<p>The IEDriver server then uses its IEThreadExplorer class, which is written in C++, to drive the IE browser using the Component Object Model framework.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Writing your first test script for the IE browser</h1>
                </header>
            
            <article>
                
<p>Now you are all set to write test scripts that run on the Internet Explorer browser. The following is the code that instantiates InternetExplorerDriver:</p>
<pre><span>public class </span>SearchTest {<br/><br/>    WebDriver <span>driver</span><span>;<br/></span><span><br/></span><span>    </span><span>@BeforeMethod<br/></span><span>    </span><span>public void </span><span>setup</span>() {<br/><br/><strong>        System.<span>setProperty</span>(<span>"webdriver.ie.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/IEDriverServer.exe"</span>)<span>;<br/></span><span><br/></span><span>        </span><span>driver </span>= <span>new </span>InternetExplorerDriver()</strong><span><strong>;</strong><br/></span><span>        </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@Test<br/></span><span>    </span><span>public void </span><span>searchProduct</span>() {<br/><br/>        <span>// find search box and enter search string<br/></span><span>        </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchBox.sendKeys(<span>"Phones"</span>)<span>;<br/></span><span><br/></span><span>        </span>WebElement searchButton =<br/>                <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchButton.click()<span>;<br/></span><span><br/></span><span>        </span><span>assertThat</span>(<span>driver</span>.getTitle())<br/>                .isEqualTo(<span>"Search results for: 'Phones'"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@AfterMethod<br/></span><span>    </span><span>public void </span><span>tearDown</span>() {<br/>        <span>driver</span>.quit()<span>;<br/></span><span>    </span>}<br/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding IEDriver capabilities</h1>
                </header>
            
            <article>
                
<p>In this section, we will discuss some of the important capabilities of InternetExplorerDriver. This is where we have set the IEDriver capability to ignore the security domains. The code is as follows:</p>
<pre>DesiredCapabilities ieCapabilities = DesiredCapabilities .internetExplorer(); ieCapabilities.setCapability(InternetExplorerDriver.INTRODUCE_FLAK INESS_BY_IGNORING_SECURITY_DOMAINS,true);</pre>
<p class="mce-root"/>
<p>Similar to <kbd>INTRODUCE_FLAKINESS_BY_IGNORING_SECURITY_DOMAINS</kbd>, IEDriver has many other capabilities. The following is a list with an explanation on why it is used:</p>
<table border="1" style="border-collapse: collapse;width: 100%">
<tbody>
<tr>
<td class="CDPAlignCenter CDPAlign" style="width: 28.3747%"><strong>Capability</strong></td>
<td class="CDPAlignCenter CDPAlign" style="width: 25.3444%"><strong>Value to be Set</strong></td>
<td class="CDPAlignCenter CDPAlign" style="width: 45.0413%"><strong>Purpose</strong></td>
</tr>
<tr>
<td style="width: 28.3747%">INITIAL_BROWSER_URL</td>
<td style="width: 25.3444%">URL, for example, <a href="http://www.%20google.com">http://www. google.com</a></td>
<td style="width: 45.0413%">This capability is set with the URL value that the driver should navigate the browser to as soon as it opens up.</td>
</tr>
<tr>
<td style="width: 28.3747%">INTRODUCE_ FLAKINESS_BY_ IGNORING_SECURITY_ DOMAINS</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">This defines whether the IEDriverServer should ignore the browser security domain settings.</td>
</tr>
<tr>
<td style="width: 28.3747%">NATIVE_EVENTS</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">This tells the IEDriver server whether to use native events or JavaScript events for executing mouse or keyboard actions.</td>
</tr>
<tr>
<td style="width: 28.3747%">REQUIRE_WINDOW_ FOCUS</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">If the value is set to True, the IE browser window will get the focus. This is especially useful when executing native events.</td>
</tr>
<tr>
<td style="width: 28.3747%">ENABLE_PERSISTENT_ HOVERING</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">If set to True, IEDriver will persistently fire a mouse-hovering event. This is especially important in overcoming issues with how IE handles mouse-over events.</td>
</tr>
<tr>
<td style="width: 28.3747%">IE_ENSURE_CLEAN_ SESSION</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">If True, it clears all the cookies, cache, history, and saved form data of all the instances of IE.</td>
</tr>
<tr>
<td style="width: 28.3747%">IE_SET_PROXY_BY_ SERVER</td>
<td style="width: 25.3444%">True or False</td>
<td style="width: 45.0413%">If True, the proxy server settings for the IEDriver server is used. If False, WindowsProxyManager is used to determine the proxy server.</td>
</tr>
</tbody>
</table>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Edge Driver</h1>
                </header>
            
            <article>
                
<p>Microsoft Edge is the latest web browser launched with Microsoft Windows 10. Microsoft Edge was one of the first browsers to implement the W3C WebDriver standard and provides built-in support for Selenium WebDriver.</p>
<p>Similar to Internet Explorer, in order to execute test scripts on the Microsoft Edge browser, we need to use the EdgeDriver class and a standalone Microsoft WebDriver Server executable. The Microsoft WebDriver Server is maintained by the Microsoft Edge development team. You can find more information at <a href="https://docs.microsoft.com/en-gb/microsoft-edge/webdriver">https://docs.microsoft.com/en-gb/microsoft-edge/webdriver</a></p>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Writing your first test script for the Edge browser</h1>
                </header>
            
            <article>
                
<p>Let's set up the Microsoft WebDriver Server and create a test for testing the search feature on Microsoft Edge. We need to download and install Microsoft WebDriver Server on Windows 10 (<a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/">https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/</a>):</p>
<pre><span>public class </span>SearchTest {<br/><br/>    WebDriver <span>driver</span><span>;<br/></span><span><br/></span><span>    </span><span>@BeforeMethod<br/></span><span>    </span><span>public void </span><span>setup</span>() {<br/><br/>        <strong>System.<span>setProperty</span>(<span>"webdriver.edge.driver"</span><span>,<br/></span><span>                </span><span>"./src/test/resources/drivers/MicrosoftWebDriver.exe"</span>)<span>;<br/></span><span><br/></span><span>        </span>EdgeOptions options = <span>new </span>EdgeOptions()<span>;<br/></span><span>        </span>options.setPageLoadStrategy(<span>"eager"</span>)<span>;<br/></span><span>        <br/></span><span>        </span><span>driver </span>= <span>new </span>EdgeDriver(options)</strong><span><strong>;</strong><br/></span><span>        <br/></span><span>        </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@Test<br/></span><span>    </span><span>public void </span><span>searchProduct</span>() {<br/><br/>        <span>// find search box and enter search string<br/></span><span>        </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchBox.sendKeys(<span>"Phones"</span>)<span>;<br/></span><span><br/></span><span>        </span>WebElement searchButton =<br/>                <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchButton.click()<span>;<br/></span><span><br/></span><span>        </span><span>assertThat</span>(<span>driver</span>.getTitle())<br/>                .isEqualTo(<span>"Search results for: 'Phones'"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@AfterMethod<br/></span><span>    </span><span>public void </span><span>tearDown</span>() {<br/>        <span>driver</span>.quit()<span>;<br/></span><span>    </span>}<br/>}</pre>
<p>The Microsoft WebDriver Server is a standalone server executable that implements WebDriver's JSON-wire protocol, which works as a glue between the test script and the Microsoft Edge browser. In the preceding code, we need to specify the path of the executable using the <kbd>webdriver.edge.driver</kbd> property similarly to other browser configurations we saw earlier in the chapter. </p>
<p class="mce-root">We also set the Page Load Strategy to eager, using the <kbd>EdgeOptions</kbd> class:</p>
<pre>EdgeOptions <span>options </span>= <span>new </span>EdgeOptions()<span>;<br/></span>options.setPageLoadStrategy(<span>"eager"</span>)<span>;</span></pre>
<p>When navigating to a new page URL, Selenium WebDriver, by default, waits <span>until the page has fully loaded before passing the control to the next command. This works well in most cases but can cause long wait times on pages that have to load a large number of third-party resources. Using the <kbd>eager</kbd> page-load strategy can make test execution faster. The eager page-load strategy will wait until the <kbd>DOMContentLoaded</kbd> event is complete, that is, the HTML content is downloaded and parsed only, but other resources, such as images, may still be loading. </span><span>However, this may introduce flakiness where elements are dynamically loaded.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Safari Driver</h1>
                </header>
            
            <article>
                
<p>With Selenium 3.0 and WebDriver becoming the W3C standard, Apple now provides SafariDriver built into the browser. We do not have to download it separately. However, in order to work it with Selenium WebDriver, we have to set a <span class="packt_screen">Develop | Allow Remote Automation</span> option from Safari's main menu, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img src="assets/50c0aef4-03f9-4a5b-b0a7-2089e82270db.png" style="width:17.33em;height:37.92em;"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">Allowing remote automation</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Writing your first test script for the Safari browser</h1>
                </header>
            
            <article>
                
<p>This is as straight forward. The following is the test script using the Safari Driver:</p>
<pre><span>public class </span>SearchTest {<br/><br/>    WebDriver <span>driver</span><span>;<br/></span><span><br/></span><span>    </span><span>@BeforeMethod<br/></span><span>    </span><span>public void </span><span>setup</span>() {<br/><br/>        <strong><span>driver </span>= <span>new </span>SafariDriver()</strong><span><strong>;</strong><br/></span><span>        </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@Test<br/></span><span>    </span><span>public void </span><span>searchProduct</span>() {<br/><br/>        <span>// find search box and enter search string<br/></span><span>        </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchBox.sendKeys(<span>"Phones"</span>)<span>;<br/></span><span><br/></span><span>        </span>WebElement searchButton =<br/>                <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchButton.click()<span>;<br/></span><span><br/></span><span>        </span><span>assertThat</span>(<span>driver</span>.getTitle())<br/>                .isEqualTo(<span>"Search results for: 'Phones'"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@AfterMethod<br/></span><span>    </span><span>public void </span><span>tearDown</span>() {<br/>        <span>driver</span>.quit()<span>;<br/></span><span>    </span>}<br/>}</pre>
<p>In the preceding code, we created an instance of the <kbd>SafariDriver</kbd> class to launch and execute tests on the Safari browser.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, you have seen some of the major implementations of WebDriver that are widely used in the industry.  We looked at some of the key configuration options for each browser and how to use them for custom profiles and mobile emulation. The underlying technology for every driver is JSONWire Protocol, which is fundamental for all the implementations. In the next chapter, we will learn how to use the Java 8 Stream API and Lambda functions with the Selenium WebDriver API.</p>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<p class="mce-root"/>
<ol>
<li>What is the significance of WebDriver becoming W3C Specification?</li>
<li>True or False: WebDriver is an interface?</li>
<li>Which browsers support Headless testing?</li>
<li>How can we test mobile websites with Chrome?</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further information</h1>
                </header>
            
            <article>
                
<p>You can check out the following links for more information about the topics covered in this chapter:</p>
<ul>
<li>Read the WebDriver Specification at <a href="https://www.w3.org/TR/webdriver/">https://www.w3.org/TR/webdriver/</a></li>
<li>You can find more details about GeckoDriver and its capabilities at <a href="https://github.com/mozilla/geckodriver">https://github.com/mozilla/geckodriver</a></li>
<li>Read more about the ChromeDriver capabilities at <a href="http://chromedriver.chromium.org/capabilities">http://chromedriver.chromium.org/capabilities</a> and mobile emulation at <a href="http://chromedriver.chromium.org/capabilities">http://chromedriver.chromium.org/capabilities</a></li>
<li>Read more about EdgeDriver capabilities at <a href="https://docs.microsoft.com/en-gb/microsoft-edge/webdriver">https://docs.microsoft.com/en-gb/microsoft-edge/webdriver</a></li>
</ul>


            </article>

            
        </section>
    </body></html>