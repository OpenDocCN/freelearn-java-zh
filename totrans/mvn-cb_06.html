<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Code Quality Plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Code Quality Plugins</h1></div></div></div><p>In this chapter, we will review some of the available tools for the Java language and how to use them in the context of Maven. We will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Analyzing code coverage with the Maven JaCoCo plugin</li><li class="listitem" style="list-style-type: disc">Analyzing code coverage with the Maven Cobertura plugin</li><li class="listitem" style="list-style-type: disc">Analyzing code with the Maven PMD plugin</li><li class="listitem" style="list-style-type: disc">Analyzing code with the Maven Checkstyle plugin</li><li class="listitem" style="list-style-type: disc">Analyzing code with the Maven FindBugs plugin</li><li class="listitem" style="list-style-type: disc">Generating source references with the Maven JXR plugin</li><li class="listitem" style="list-style-type: disc">Analyzing code with the Maven SonarQube plugin</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec60"/>Introduction</h1></div></div></div><p>It is one thing to write code and another to write good code. The subjectivity of code quality is greatly reduced by having coding guidelines/standards. Whether a developer follows coding standards or not can be verified by subjecting the code to a code review. On the other hand, there are tools that automatically perform these reviews against defined standards.</p><p>In addition to code quality, programming best practices also recommend writing automated unit tests for the code. The line and branch coverage achieved by these unit tests can also be quantitatively measured by tools.</p></div></div>
<div class="section" title="Analyzing code coverage with the Maven JaCoCo plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec61"/>Analyzing code coverage with the Maven JaCoCo plugin</h1></div></div></div><p>JaCoCo<a id="id324" class="indexterm"/> is a free Java code coverage tool. This is essentially the successor to Emma, and it has been developed by the EclEmma team as an Eclipse project.</p><p>JaCoCo offers line and branch coverage.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec145"/>Getting ready</h2></div></div></div><p>Maven is set up on your system and is verified to work. To do this, refer to the first three recipes of <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec146"/>How to do it...</h2></div></div></div><p>Use the following steps to analyze the code <a id="id325" class="indexterm"/>coverage with the <a id="id326" class="indexterm"/>Maven JaCoCo plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the pom file of a project that has unit tests (for instance, <code class="literal">project-with-tests</code>).</li><li class="listitem">Add the following code:<div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
  &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;0.7.2.201409121644&lt;/version&gt;
  &lt;executions&gt;
     &lt;execution&gt;
       &lt;id&gt;default-prepare-agent&lt;/id&gt;
       &lt;goals&gt;
         &lt;goal&gt;prepare-agent&lt;/goal&gt;
       &lt;/goals&gt;
     &lt;/execution&gt;
     &lt;execution&gt;
       &lt;id&gt;default-report&lt;/id&gt;
       &lt;phase&gt;prepare-package&lt;/phase&gt;
       &lt;goals&gt;
         &lt;goal&gt;report&lt;/goal&gt;
       &lt;/goals&gt;
     &lt;/execution&gt;
   &lt;/executions&gt;
 &lt;/plugin&gt;</pre></div></li><li class="listitem">Run the following command from the command prompt:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn package</strong></span>
</pre></div></li><li class="listitem">Note the output for the preceding command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- jacoco-maven-plugin:0.7.2.201409121644:prepare-agent (default-prepare-agent) @ project-with-tests ---</strong></span>
<span class="strong"><strong>[INFO] argLine set to -javaagent:C:\\software\\maven\\org\\jacoco\\org.jacoco.agent\\0.7.2.201409121644\\org.jacoco.agent-0.7.2.201409121644-runtime.jar=destfile=C:\\projects\\apache-maven-cookbook\\project-with-tests\\target\\jacoco.exec</strong></span>
<span class="strong"><strong>[INFO] --- jacoco-maven-plugin:0.7.2.201409121644:report (default-report) @ project-with-tests ---</strong></span>
<span class="strong"><strong>[INFO] Analyzed bundle 'Project with Tests with 1 classes</strong></span>
</pre></div></li><li class="listitem">Open the <code class="literal">index.html</code> file <a id="id327" class="indexterm"/>generated in<a id="id328" class="indexterm"/> the <code class="literal">target/site/jacoco</code> folder:<div class="mediaobject"><img src="graphics/6124OS_06_01.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec147"/>How it works...</h2></div></div></div><p>In the pom file, we instruct Maven to run the following two goals of the Maven JaCoCo plugin:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">prepare-agent</code>: This is <a id="id329" class="indexterm"/>bound by default to the <code class="literal">initialize</code> phase of the Maven default lifecycle. The goal runs and prepares the agent that does the analysis.</li><li class="listitem" style="list-style-type: disc"><code class="literal">report</code>: This agent<a id="id330" class="indexterm"/> gathers test coverage information when the tests are run and creates the report as part of the prepare-package phase (which we have explicitly specified).</li></ul></div><p>The report gives information about the test coverage. Green indicates lines that are covered by tests and red indicates lines that are not covered by tests. In the preceding example, <span class="strong"><strong>12 of 19</strong></span> instructions are not covered by tests.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec148"/>There's more...</h2></div></div></div><p>You could subject the project to code coverage and generate the same report without making any changes to the pom file. To do this, run the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn jacoco:prepare-agent test jacoco:report</strong></span>
</pre></div><p>Now, you may get the following error:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[ERROR] No plugin found for prefix 'jacoco' in the current project and in the plugin groups [org.apache.maven.plugins] available from the repositories [local (C:\software\maven), central (https://repo.maven.apache.org/maven2)] -&gt; [Help 1]</strong></span>
</pre></div><p>To fix this, specify<a id="id331" class="indexterm"/> the <code class="literal">groupId</code> and <code class="literal">artifactId</code> <a id="id332" class="indexterm"/>parameters of the plugin explicitly. In the <span class="emphasis"><em>Configuring Maven to search for plugins</em></span> recipe of <a class="link" href="ch08.html" title="Chapter 8. Handling Typical Build Requirements">Chapter 8</a>, <span class="emphasis"><em>Handling Typical Build Requirements</em></span>, we will see an alternate way to address this.</p><p>In the following code, what what we will be doing is explicitly calling the relevant goals that we saw getting executed earlier. So, first <code class="literal">prepare-agent</code> will run, followed by <code class="literal">test</code>, and then the <code class="literal">report</code> goal:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn org.jacoco:jacoco-maven-plugin:prepare-agent test org.jacoco:jacoco-maven-plugin:report</strong></span>
</pre></div><p>How about failing the build if the code coverage is below a threshold value? To do this, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following execution block to the plugin configuration in the <code class="literal">build</code> section specified earlier:<div class="informalexample"><pre class="programlisting">&lt;execution&gt;
    &lt;id&gt;default-check&lt;/id&gt;
    &lt;phase&gt;prepare-package&lt;/phase&gt;
    &lt;goals&gt;
        &lt;goal&gt;check&lt;/goal&gt;
    &lt;/goals&gt;
    &lt;configuration&gt;
        &lt;rules&gt;
            &lt;rule&gt;
                &lt;element&gt;BUNDLE&lt;/element&gt;
                &lt;limits&gt;
                    &lt;limit&gt;
                        &lt;counter&gt;COMPLEXITY&lt;/counter&gt;
                        &lt;value&gt;COVEREDRATIO&lt;/value&gt;
                        &lt;minimum&gt;0.60&lt;/minimum&gt;
                    &lt;/limit&gt;
                &lt;/limits&gt;
            &lt;/rule&gt;
        &lt;/rules&gt;
    &lt;/configuration&gt;
&lt;/execution&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn package</strong></span>
</pre></div></li><li class="listitem">Observe the <a id="id333" class="indexterm"/>result as shown in following <a id="id334" class="indexterm"/>screenshot:<div class="mediaobject"><img src="graphics/6124OS_06_02.jpg" alt="There's more..."/></div></li></ol></div></div></div>
<div class="section" title="Analyzing code coverage with the Maven Cobertura plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec62"/>Analyzing code coverage with the Maven Cobertura plugin</h1></div></div></div><p>Cobertura is<a id="id335" class="indexterm"/> another popular Java tool that calculates the percentage of code accessed by tests. It is based on <span class="strong"><strong>jcoverage</strong></span>. There are many ways to use Cobertura, including standalone, through Ant script, and Maven. Let us use the Maven Cobertura plugin.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec149"/>How to do it...</h2></div></div></div><p>Use the following<a id="id336" class="indexterm"/> steps to analyze the code coverage with the <a id="id337" class="indexterm"/>Maven Cobertura plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a Maven project that has unit tests (for instance, <code class="literal">project-with-tests</code>).</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn cobertura:cobertura</strong></span>
</pre></div></li><li class="listitem">Observe the<a id="id338" class="indexterm"/> following <a id="id339" class="indexterm"/>output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] &lt;&lt;&lt; cobertura-maven-plugin:2.6:cobertura (default-cli) &lt; [cobertura]test@ project-with-tests &lt;&lt;&lt;</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- cobertura-maven-plugin:2.6:cobertura (default-cli) @ project-with-tests ---</strong></span>
<span class="strong"><strong>[INFO] Cobertura 2.0.3 - GNU GPL License (NO WARRANTY) - See COPYRIGHT file</strong></span>
<span class="strong"><strong>Report time: 165ms</strong></span>
<span class="strong"><strong>[ERROR] Nov 15, 2014 5:06:25 PM</strong></span>
<span class="strong"><strong>net.sourceforge.cobertura.coveragedata.CoverageDataFileHandler loadCoverageData</strong></span>
<span class="strong"><strong>INFO: Cobertura: Loaded information on 1 classes.</strong></span>
</pre></div></li><li class="listitem">See the report generated:<div class="mediaobject"><img src="graphics/6124OS_06_03.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec150"/>How it works...</h2></div></div></div><p>JaCoCo instruments the code online when the tests are running and hence,it needs to have the agent running. On the other hand, Cobertura instruments the bytecode during compilation offline. The <code class="literal">cobertura</code> goal of the Cobertura Maven plugin instruments the project, runs the tests, and generates the report.</p><p>There are separate goals to <code class="literal">instrument</code> and <code class="literal">check</code> results, if required.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec151"/>There's more...</h2></div></div></div><p>What if we want to <a id="id340" class="indexterm"/>fail the build if the code coverage is <a id="id341" class="indexterm"/>below a threshold level? We can set up Cobertura to do this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following to the pom file:<div class="informalexample"><pre class="programlisting">     &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;cobertura-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.6&lt;/version&gt;
        &lt;configuration&gt;
          &lt;check&gt;
            &lt;branchRate&gt;85&lt;/branchRate&gt;
            &lt;lineRate&gt;85&lt;/lineRate&gt;
            &lt;haltOnFailure&gt;true&lt;/haltOnFailure&gt;
          &lt;/check&gt;
        &lt;/configuration&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;check&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn cobertura:check</strong></span>
</pre></div></li><li class="listitem">Observe the output as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_06_04.jpg" alt="There's more..."/></div></li></ol></div><p>The build has failed<a id="id342" class="indexterm"/> because, in the pom file, we <a id="id343" class="indexterm"/>specified that the build should be halted if the coverage is less than 85%.</p></div></div>
<div class="section" title="Analyzing code with the Maven PMD plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec63"/>Analyzing code with the Maven PMD plugin</h1></div></div></div><p>PMD<a id="id344" class="indexterm"/> is a source code analyzer. It finds common programming flaws such as unused variables, empty catch blocks, and unnecessary object creation. It also includes the <span class="strong"><strong>Copy/Paste Detector</strong></span> (<span class="strong"><strong>CPD</strong></span>) <a id="id345" class="indexterm"/>that finds duplicated code.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec152"/>How to do it...</h2></div></div></div><p>Use the following steps to <a id="id346" class="indexterm"/>run PMD on a Maven project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven <a id="id347" class="indexterm"/>project for which you want to do a PMD analysis (for instance, <code class="literal">project-with-violations</code>).</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn pmd:pmd pmd:cpd</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-pmd-plugin:3.2:pmd (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[WARNING] Unable to locate Source XRef to link to – DISABLED</strong></span>
<span class="strong"><strong>[INFO] --- maven-pmd-plugin:3.2:cpd (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[WARNING] Unable to locate Source XRef to link to - DISABLED</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
</pre></div></li><li class="listitem">Check the<a id="id348" class="indexterm"/> contents <a id="id349" class="indexterm"/>of the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_06_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Open the <code class="literal">pmd.xml</code> report:<div class="mediaobject"><img src="graphics/6124OS_06_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Open the <code class="literal">cpd.html</code> file in the <code class="literal">site</code> folder:<div class="mediaobject"><img src="graphics/6124OS_06_07.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec153"/>How it works...</h2></div></div></div><p>The <code class="literal">pmd</code> or <code class="literal">cpd</code> <a id="id350" class="indexterm"/>goals of the Maven PMD plugin are not bound to any <a id="id351" class="indexterm"/>phase. Also, they analyze the Java source and thus, do not need any other Maven phase or goal to be run.</p><p>When the <code class="literal">pmd</code> goal is run, it generates a PMD site report using default rulesets and the configuration set in the plugin. It also generates a pmd output file in the XML format.</p><p>You can also define your own customized ruleset. To do this, add the following code in the <code class="literal">configuration</code> section of the pom file:</p><div class="informalexample"><pre class="programlisting">&lt;reporting&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-pmd-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.4&lt;/version&gt;
        &lt;configuration&gt;
          &lt;rulesets&gt;
            &lt;!-- Two rule sets that come bundled with PMD --&gt;
            &lt;ruleset&gt;/rulesets/java/braces.xml&lt;/ruleset&gt;
            &lt;ruleset&gt;/rulesets/java/naming.xml&lt;/ruleset&gt;
            &lt;!-- Custom local file system rule set --&gt;
            &lt;ruleset&gt;d:\rulesets\strings.xml&lt;/ruleset&gt;
            &lt;!-- Custom remote rule set accessed via a URL --&gt;
            &lt;ruleset&gt;http://localhost/design.xml&lt;/ruleset&gt;
          &lt;/rulesets&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/reporting&gt;</pre></div><p>Likewise, when <a id="id352" class="indexterm"/>the <code class="literal">cpd</code> goal is run, it generates a similar report <a id="id353" class="indexterm"/>for duplicated code. By default, the minimum token count that it considers to report that code is duplicated is 100 tokens (which is typically 10 lines of code).</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec154"/>There's more...</h2></div></div></div><p>The plugin can be made to fail the build by using the check goal in the following way:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to the pom file of <code class="literal">project-with-violations</code>:<div class="informalexample"><pre class="programlisting">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-pmd-plugin&lt;/artifactId&gt;
      &lt;version&gt;3.4&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;goals&gt;
            &lt;goal&gt;check&lt;/goal&gt;
            &lt;goal&gt;cpd-check&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn verify</strong></span>
</pre></div></li><li class="listitem">Observe the <a id="id354" class="indexterm"/>output as shown in the following<a id="id355" class="indexterm"/> screenshot:<div class="mediaobject"><img src="graphics/6124OS_06_08.jpg" alt="There's more..."/></div></li></ol></div></div></div>
<div class="section" title="Analyzing code with the Maven Checkstyle plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec64"/>Analyzing code with the Maven Checkstyle plugin</h1></div></div></div><p>Checkstyle<a id="id356" class="indexterm"/> is a tool that helps programmers follow coding standards. It automates the process of checking if defined coding standards are followed. It can support any coding standards by suitable configuration. Like other tools, it can be run standalone as well as integrated with Maven.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec155"/>How to do it...</h2></div></div></div><p>Use the following<a id="id357" class="indexterm"/> steps to analyze code with the Maven <a id="id358" class="indexterm"/>Checkstyle plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project for which you want to do a Checkstyle analysis (for instance, <code class="literal">project-with-violations</code>).</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn checkstyle:checkstyle</strong></span>
</pre></div></li><li class="listitem">Observe the output as shown in the following screenshot:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- maven-checkstyle-plugin:2.13:checkstyle (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] There are 29 checkstyle errors.</strong></span>
<span class="strong"><strong>[WARNING] Unable to locate Source XRef to link to - DISABLED</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
</pre></div></li><li class="listitem">Open the <code class="literal">checkstyle-result.xml</code> report in the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_06_09.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec156"/>How it works...</h2></div></div></div><p>Unlike the <code class="literal">pmd</code>, <code class="literal">checkstyle</code> goal of Maven, the Checkstyle plugin is not bound to any phase.</p><p>When the <code class="literal">checkstyle</code> <a id="id359" class="indexterm"/>goal is run, it <a id="id360" class="indexterm"/>generates a Checkstyle site report using default rulesets and the configuration set in the plugin. It also generates a Checkstyle output file in the XML format.</p><p>The Maven Checkstyle plugin supports several configuration options to customize the rules, exclude files from being checked, and so on. Let's briefly discuss the examples that show usage of Maven Checkstyle plugin in some advanced usecases:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Checkstyle rules can be specified inline in the <code class="literal">configuration</code> section of the plugin:<div class="informalexample"><pre class="programlisting">&lt;configuration&gt;
  &lt;checkstyleRules&gt;
    &lt;module name="Checker"&gt;
      &lt;module name="TreeWalker"&gt;
        &lt;module name="FinalLocalVariable"&gt;
          &lt;property name="tokens" value="VARIABLE_DEF,PARAMETER_DEF"/&gt;
        &lt;/module&gt;
      &lt;/module&gt;
    &lt;/module&gt;
  &lt;/checkstyleRules&gt;
&lt;/configuration&gt;</pre></div></li><li class="listitem">They can also be specified in an external file and referred using the <code class="literal">configLocation</code> element:<div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.14&lt;/version&gt;
  &lt;configuration&gt;
    &lt;configLocation&gt;checkstyle.xml&lt;/configLocation&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div></li><li class="listitem">A Suppressions<a id="id361" class="indexterm"/> filter can be created to tell Checkstyle not to report violations on specific files and specific sections of the files:<div class="informalexample"><pre class="programlisting">&lt;suppressions&gt;
  &lt;suppress checks="JavadocStyleCheck"
             files="GeneratedObject.java"
             lines="50-9999"/&gt;
  &lt;suppress checks="MagicNumberCheck"
             files="LegacyDatasetConvertor.java"
             lines="221,250-295"/&gt;
&lt;/suppressions&gt;</pre></div></li></ol></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec157"/>There's more...</h2></div></div></div><p>As in the case of PMD, we<a id="id362" class="indexterm"/> can configure the Maven Checkstyle plugin such that it fails a build in case of errors:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to the pom file of <code class="literal">project-with-violations</code>:<div class="informalexample"><pre class="programlisting">&lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.14&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;verify-style&lt;/id&gt;
            &lt;phase&gt;process-sources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;check&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;      
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn verify</strong></span>
</pre></div></li><li class="listitem">Observe the <a id="id363" class="indexterm"/>output as shown in the following <a id="id364" class="indexterm"/>screenshot:<div class="mediaobject"><img src="graphics/6124OS_06_10.jpg" alt="There's more..."/></div></li></ol></div></div></div>
<div class="section" title="Analyzing code with the Maven FindBugs plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec65"/>Analyzing code with the Maven FindBugs plugin</h1></div></div></div><p>FindBugs <a id="id365" class="indexterm"/>is another tool that uses static analysis to inspect Java bytecode for bugs in a Java code. It is based on the concept of bug patterns. A bug pattern is a code snippet that is often an error.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec158"/>How to do it...</h2></div></div></div><p>Let us see how we can use the <a id="id366" class="indexterm"/>Maven FindBugs plugin to analyze and<a id="id367" class="indexterm"/> identify defects in our code:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project for which you want to do the FindBugs analysis.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean compile findbugs:findbugs</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-compiler-plugin:3.1:compile (default-compile) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[INFO] Changes detected - recompiling the module!</strong></span>
<span class="strong"><strong>[INFO] Compiling 1 source file to C:\projects\apache-maven cookbook\project-with-violations\target\classes</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- findbugs-maven-plugin:3.0.0:findbugs (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[INFO] Fork Value is true</strong></span>
<span class="strong"><strong>[java] Warnings generated: 3</strong></span>
<span class="strong"><strong>[INFO] Done FindBugs Analysis....</strong></span>
</pre></div></li><li class="listitem">Open the generated <a id="id368" class="indexterm"/>XML file <code class="literal">findbugsXml.xml</code> in<a id="id369" class="indexterm"/> the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_06_11.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec159"/>How it works...</h2></div></div></div><p>When the <code class="literal">findbugs</code> goal of the FindBugs plugin is run, it analyzes the bytecode and reports errors to an output file in the XML format. Unlike Checkstyle and the PMD plugins, it does not generate a default site report unless configured differently.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>As FindBugs works on bytecode, the project needs to be compiled before the FindBugs analysis can be run. Otherwise, you will not find any FindBugs defects!</p></div></div><p>FindBugs also<a id="id370" class="indexterm"/> provides several options that allow you<a id="id371" class="indexterm"/> to specify the classes to be included/excluded from analysis, specify the rules to be run, and to fail when errors crop up during the build. Let's briefly discuss some examples that describe the basic usage of the FindBugs plugin:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Filter bugs to report: This plugin allows us to specify classes and methods that can be included or excluded from reporting:<div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;findbugs-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.1-SNAPSHOT&lt;/version&gt;
        &lt;configuration&gt;
          &lt;excludeFilterFile&gt;findbugs exclude.xml&lt;/excludeFilterFile&gt;
          &lt;includeFilterFile&gt;findbugs-include.xml&lt;/includeFilterFile&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Bug detectors to run: We can also specify which detectors to run. This can be done in the following manner:<div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;findbugs-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.0.1-SNAPSHOT&lt;/version&gt;
        &lt;configuration&gt;
&lt;visitors&gt;FindDeadLocalStores,UnreadFields&lt;/visitors&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;</pre></div></li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec160"/>There's more...</h2></div></div></div><p>You can also launch the FindBugs GUI to view the report in a graphical format:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To do this, run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn compile findbugs:findbugs findbugs:gui</strong></span>
</pre></div></li><li class="listitem">Observe the FindBugs screen:<div class="mediaobject"><img src="graphics/6124OS_06_12.jpg" alt="There's more..."/></div></li></ol></div></div></div>
<div class="section" title="Generating source references with the Maven JXR plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec66"/>Generating source references with the Maven JXR plugin</h1></div></div></div><p>You may have observed<a id="id372" class="indexterm"/> the following warnings when<a id="id373" class="indexterm"/> running the PMD or Checkstyle plugin:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-pmd-plugin:3.2:pmd (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[WARNING] Unable to locate Source XRef to link to – DISABLED</strong></span>
<span class="strong"><strong>[INFO] --- maven-checkstyle-plugin:2.13:checkstyle (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] There are 36 checkstyle errors.</strong></span>
<span class="strong"><strong>[WARNING] Unable to locate Source XRef to link to – DISABLED</strong></span>
</pre></div><p>The plugins attempt to link the violation to the specific lines in the cross-reference of the source. As they are unable to find this cross-reference, they display the warning.</p><p>To generate this cross-reference, we need to use the Maven JXR plugin.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec161"/>How to do it...</h2></div></div></div><p>Use the following <a id="id374" class="indexterm"/>steps to generate source <a id="id375" class="indexterm"/>references with the Maven JXR plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the project for which you want to run the cross-reference.</li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn jxr:jxr</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- maven-jxr-plugin:2.5:jxr (default-cli) @ project-with-violations ---</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
</pre></div></li><li class="listitem">Browse the <code class="literal">target/site</code> folder.<div class="mediaobject"><img src="graphics/6124OS_06_13.jpg" alt="How to do it..."/></div></li><li class="listitem">Open the contents of the <code class="literal">xref</code> folder in the browser:<div class="mediaobject"><img src="graphics/6124OS_06_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec162"/>How it works...</h2></div></div></div><p>When the <code class="literal">jxr</code> <a id="id376" class="indexterm"/>goal of the Maven JXR plugin is run, it <a id="id377" class="indexterm"/>generates a cross-reference of all the source files of the project. The format is similar to Javadoc, but on clicking on the class, you get to see the source code with the line numbers:</p><div class="mediaobject"><img src="graphics/6124OS_06_15.jpg" alt="How it works..."/></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec163"/>There's more...</h2></div></div></div><p>Once the <a id="id378" class="indexterm"/>cross-reference exists, code quality tools, such<a id="id379" class="indexterm"/> as PMD and Checkstyle, link to this reference automatically by using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn jxr:jxr checkstyle:checkstyle</strong></span>
</pre></div></li><li class="listitem">Open the Checkstyle report in the browser:<div class="mediaobject"><img src="graphics/6124OS_06_16.jpg" alt="There's more..."/></div></li></ol></div><p>You can now see the line numbers against each of the violations, with the link to the line number in the cross-referenced source code.</p></div></div>
<div class="section" title="Analyzing code with the Maven SonarQube plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec67"/>Analyzing code with the Maven SonarQube plugin</h1></div></div></div><p>Each of the code analysis<a id="id380" class="indexterm"/> tools we have seen in the previous sections identify <a id="id381" class="indexterm"/>specific issues in the code. While Checkstyle looks for violations in coding guidelines, PMD identifies common coding errors, and FindBugs detects bug patterns.</p><p>You could have your project configured to run all the three. In addition, you could also run plugins to identify coverage. You could also do all these and more by doing a SonarQube analysis of the project.</p><p>SonarQube is a platform to manage code quality. It is a web-based application, where rules, alerts, thresholds, and other metrics can be configured. It provides various ways to analyze code. The results of the analysis can then be viewed in a web application. SonarQube also provides several paid plugins, such as <span class="strong"><strong>SQALE</strong></span>, and for specific languages, such as Cobol and C++.</p><div class="section" title="Getting ready..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec164"/>Getting ready...</h2></div></div></div><p>Let's briefly discuss some basic requirements for using the Maven SonarQube plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Visit the <a id="id382" class="indexterm"/>download page for <a id="id383" class="indexterm"/>SonarQube at <a class="ulink" href="http://www.sonarqube.org/downloads/">http://www.sonarqube.org/downloads/</a>.</li><li class="listitem">Download the<a id="id384" class="indexterm"/> latest release.</li><li class="listitem">Unzip the ZIP file to a folder of your choice.</li><li class="listitem">Based on the platform, start the server by following the instructions.</li><li class="listitem">Confirm that the server is running by visiting the web page at <code class="literal">http://localhost:9000/</code> (assuming it's a default installation).</li></ol></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec165"/>How to do it...</h2></div></div></div><p>Use the following steps to analyze the code with the Maven SonarQube plugin:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project for which you want to do SonarQube analysis.</li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn sonar:sonar</strong></span>
</pre></div></li><li class="listitem">Observe the output as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_06_17.jpg" alt="How to do it..."/></div></li><li class="listitem">Visit the Sonar web <a id="id385" class="indexterm"/>page at <code class="literal">http://localhost:9000</code>:<div class="mediaobject"><img src="graphics/6124OS_06_18.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the<a id="id386" class="indexterm"/> project link:<div class="mediaobject"><img src="graphics/6124OS_06_19.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec166"/>How it works...</h2></div></div></div><p>The <code class="literal">sonar</code> goal of the <a id="id387" class="indexterm"/>Maven SonarQube plugin sets in<a id="id388" class="indexterm"/> motion a series of steps to do various analyses of the project. Based on the configuration, the Sonar plugin performs Checkstyle analysis, FindBugs analysis  and PMD analysis, as well as detects code coverage, code duplication, design issues and code complexity.</p><p>It sends the output to a database and generates reports that can be viewed from the web page by the user.</p><p>As you can see from the dashboard, it has generated the unit test report along with coverage information. Clicking on the link will take the user to details of the coverage.</p><div class="mediaobject"><img src="graphics/6124OS_06_20.jpg" alt="How it works..."/></div><p>Similarly, clicking on <a id="id389" class="indexterm"/>
<span class="strong"><strong>Issues</strong></span> gives details of the various <a id="id390" class="indexterm"/>violations:</p><div class="mediaobject"><img src="graphics/6124OS_06_21.jpg" alt="How it works..."/></div><p>Each of these <a id="id391" class="indexterm"/>issues can be drilled down to the line-level details, and <a id="id392" class="indexterm"/>Sonar provides the details, including fix suggestions.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec167"/>There's more...</h2></div></div></div><p>SonarQube provides several configuration options to specify rules to be included/excluded, source files to be included/excluded, and so on. The configuration can be done through the web interface, and in some cases, by means of properties, either in the Maven's settings file or through the command line.</p><p>In addition, SonarQube provides plugins for Eclipse and IntelliJ. Once installed and configured, these plugins report violations directly in the IDE in the specific lines. As this is not specific to Maven, its details are outside the scope of this section.</p></div></div></body></html>