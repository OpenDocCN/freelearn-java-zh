<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;The User Interface &#x2013; Views"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. The User Interface – Views</h1></div></div></div><p>Our web service client fetches information regarding a contact and presents it to the user as plain text. We are going to use Mustache, a template engine that is part of the <code class="literal">dropwizard-views-mustache</code> module, in order to create HTML views.</p><div class="section" title="Building a user interface for the web service client"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec28"/>Building a user interface for the web service client</h1></div></div></div><p>We <a id="id237" class="indexterm"/>will build a user interface for the web<a id="id238" class="indexterm"/> service client that consists of an HTML page that will be used to render a contact's details within a table.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec65"/>Getting ready</h2></div></div></div><p>Not surprisingly, the first thing we need to do is to add the <code class="literal">dropwizard-views</code> and <code class="literal">dropwizard-assets</code> dependencies in our <code class="literal">pom.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;&lt;groupId&gt;io.dropwizard&lt;/groupId&gt;&lt;artifactId&gt;dropwizard-views-mustache&lt;/artifactId&gt;&lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;
&lt;dependency&gt;&lt;groupId&gt;io.dropwizard&lt;/groupId&gt;&lt;artifactId&gt;dropwizard-assets&lt;/artifactId&gt;&lt;version&gt;0.7.0-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt;</pre></div><p>Also, we will need to create a folder where we will store our template files. Create the <code class="literal">[ProjectRoot]/src/main/resources/views</code> folder as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9530OS_10_01.jpg" alt="Getting ready"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec66"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Enable <a id="id239" class="indexterm"/>the <code class="literal">Views</code> bundle by<a id="id240" class="indexterm"/> adding it to your application's bootstrap in the <code class="literal">#initialize()</code> method of the <code class="literal">App</code> class. During the<a id="id241" class="indexterm"/> initialization phase (that is, when the <code class="literal">#initialize()</code> method is executed), we can use the bootstrap object to register additional modules with our application, such as bundles or commands. This has to be done before the service is actually started (that is, before<a id="id242" class="indexterm"/> the <code class="literal">#run()</code> method gets called). You will need to import <code class="literal">io.dropwizard.views.ViewBundle</code>:<div class="informalexample"><pre class="programlisting">@Override
public void initialize(Bootstrap&lt;PhonebookConfiguration&gt; b) {
      b.addBundle(new ViewBundle());
    }</pre></div></li><li class="listitem">Create a new package called <code class="literal">com.dwbook.phonebook.views</code> with the <code class="literal">ContactView</code> class in it. The class must extend <code class="literal">View</code> and its constructor will expect a <code class="literal">Contact</code> instance. Also, you must call the superclass's constructor specifying the template file for this class (in this case, <code class="literal">contact.mustache</code>, which is stored in the directory we created before). You can reference the <code class="literal">view</code> file using an absolute path, where the root is the <code class="literal">[ProjectRoot]/src/main/resources/views</code> folder. A getter for the contact object is needed so that it can be accessed by the template engine:<div class="informalexample"><pre class="programlisting">  package com.dwbook.phonebook.views;

  import com.dwbook.phonebook.representations.Contact;
  import io.dropwizard.views.View;

  public class ContactView extends View {
    private final Contact contact;
  
    public ContactView(Contact contact) {
      super("/views/contact.mustache");
      this.contact = contact;
    }
  
    public Contact getContact() {
      return contact;
    }
  }</pre></div></li><li class="listitem">Now, let's create our template, <code class="literal">contact.moustache</code>, which will be a plain HTML file that renders a table with a contact's details. Remember to store it inside<a id="id243" class="indexterm"/> the <code class="literal">views</code> folder we<a id="id244" class="indexterm"/> created at the beginning. Take a look at the following code snippet:<div class="informalexample"><pre class="programlisting">    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Contact&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;table border="1"&gt;
          &lt;tr&gt;
            &lt;th colspan="2"&gt;Contact ({{contact.id}})&lt;/th&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
            &lt;td&gt;First Name&lt;/td&gt;
            &lt;td&gt;{{contact.firstName}}&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
            &lt;td&gt;Last Name&lt;/td&gt;
            &lt;td&gt;{{contact.lastName}}&lt;/td&gt;
          &lt;/tr&gt;
          &lt;tr&gt;
            &lt;td&gt;Phone&lt;/td&gt;
            &lt;td&gt;{{contact.phone}}&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/table&gt;
      &lt;/body&gt;
    &lt;/html&gt;</pre></div><p>The Mustache tags, that is, the double-curly-braces-wrapped text, will be replaced with the actual values of the contact object's properties on runtime automatically. Mustache provides many tag types that you can use in your template, such as <code class="literal">conditionals</code> and <code class="literal">loops</code>. You may refer to <a class="ulink" href="http://mustache.github.io/mustache.5.html">http://mustache.github.io/mustache.5.html</a> for detailed information about Mustache's tag types and advanced usage.</p></li><li class="listitem">Let's modify the <code class="literal">ClientResource</code> class now by changing the <code class="literal">@Produces</code> annotation<a id="id245" class="indexterm"/> so that it uses the <code class="literal">View</code> class to generate HTML instead of plain text:<div class="informalexample"><pre class="programlisting">@Produces(MediaType.TEXT_HTML)</pre></div></li><li class="listitem">Modify<a id="id246" class="indexterm"/> the <code class="literal">#showContact </code>method<a id="id247" class="indexterm"/> so that it returns a <code class="literal">ContactView</code> instance initialized with<a id="id248" class="indexterm"/> the contact representation fetched using the Jersey client. Import <code class="literal">com.dwbook.phonebook.views.ContactView</code> first:<div class="informalexample"><pre class="programlisting">  @GET
  @Path("showContact")
  public ContactView showContact(@QueryParam("id") int id) {
      WebResource contactResource = client.resource("http://localhost:8080/contact/"+id);
      Contact c = contactResource.get(Contact.class);
      return new ContactView(c);
  }</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec67"/>How it works…</h2></div></div></div><p>Let's test the UI. Rebuild the application, run it, and point your browser to <code class="literal">http://localhost:8080/client/showContact?id=2</code>. Instead of seeing the plain text response of the client, we now see an HTML table being rendered with the details of the contact with an ID equal to 2, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9530OS_10_02.jpg" alt="How it works…"/></div><p>When<a id="id249" class="indexterm"/> we access the client's URL, it fetches<a id="id250" class="indexterm"/> the data by calling the appropriate service. The data is then passed as a <code class="literal">Contact</code> instance to the <code class="literal">ContactView</code> class that extends View, which uses the template engine to parse the designated template file, <code class="literal">contact.mustache</code>, and generate the HTML markup. The file extension indicates the template engine that shall be used.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec68"/>There's more…</h2></div></div></div><p>Mustache is not the only template engine supported by Dropwizard; there's also Freemarker. We chose Mustache over Freemarker to demonstrate Dropwizard's template capabilities since Mustache is a more logicless, agnostic programming language, and has implementations available for many programming languages.</p><p>On the other hand, Freemarker is Java-bound, has more programming capabilities, and can perform more complex tasks such as sanitizing the produced output.</p><p>If we were using Freemarker instead of Mustache for the previous example, the main table of the template would be the following:</p><div class="informalexample"><pre class="programlisting">&lt;table border="1"&gt;
&lt;tr&gt;
  &lt;th colspan="2"&gt;Contact (${contact.id})&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;First Name&lt;/td&gt;
  &lt;td&gt;${contact.firstName?html}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;Last Name&lt;/td&gt;
  &lt;td&gt;{contact.lastName?html}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
  &lt;td&gt;Phone&lt;/td&gt;
  &lt;td&gt;${contact.phone?html}&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;</pre></div><p>As you can see, the syntax of both template engines is similar. Note that while Mustache escapes <a id="id251" class="indexterm"/>variables by default, with Freemarker, <a id="id252" class="indexterm"/>you have to instruct the processor to sanitize the output by suffixing the variables with <code class="literal">?html</code>.</p><div class="section" title="Serving static assets"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl3sec25"/>Serving static assets</h3></div></div></div><p>There are <a id="id253" class="indexterm"/>cases where along with the HTML-based views, you need to serve static assets, such as CSS stylesheets, JavaScript files, or any other file that may be used by your application.</p><p>To do so, you may add an <code class="literal">AssetsBundle</code> instance on the <code class="literal">#bootstrap()</code> method, specifying the folder<a id="id254" class="indexterm"/> from where you can serve static files and also the URI that this folder will be mapped to. We will first need to import <code class="literal">io.dropwizard.assets.AssetsBundle</code> and modify the <code class="literal">pom.xml</code> file accordingly, declaring a dependency to the artifact dropwizard-assets.</p><p>For instance, if you want to serve a static stylesheet file named <code class="literal">stylesheet.css</code>, you'll have to store it under <code class="literal">src/main/java/resources/assets</code>.</p><div class="informalexample"><pre class="programlisting">b.addBundle(new AssetsBundle());</pre></div><p>The <code class="literal">stylesheet.css</code> file would now be accessible from the <code class="literal">http://localhost:8080/assets/stylesheet.css</code> URL. </p></div></div></div></div></body></html>