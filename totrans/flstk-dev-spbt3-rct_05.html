<html><head></head><body>
  <div id="_idContainer095" class="Basic-Text-Frame">
    <h1 class="chapterNumber">4</h1>
    <h1 id="_idParaDest-48" class="chapterTitle">Creating a RESTful Web Service with Spring Boot</h1>
    <p class="normal">Web services are applications that communicate over the internet using the HTTP protocol. There are many different types of web service architectures, but the principal idea across all designs is the same. In this book, we will create a RESTful web service: nowadays, a really popular design.</p>
    <p class="normal">In this chapter, we will first create a <strong class="keyWord">RESTful web service</strong> using a controller class. Then, we will use <strong class="keyWord">Spring Data REST</strong> to create a RESTful web service that also provides all CRUD functionalities automatically, and document it with <strong class="keyWord">OpenAPI 3</strong>. After you have created a RESTful API for your application, you can implement the frontend using a JavaScript library such as React. We will be using the database application that we created in the previous chapter as a starting point.</p>
    <p class="normal">In this chapter, we will cover the following topics:</p>
    <ul>
      <li class="bulletList">Basics of REST</li>
      <li class="bulletList">Creating a RESTful web service with Spring Boot</li>
      <li class="bulletList">Using Spring Data REST</li>
      <li class="bulletList">Documenting a RESTful API</li>
    </ul>
    <h1 id="_idParaDest-49" class="heading-1">Technical requirements</h1>
    <p class="normal">The Spring Boot application created in the previous chapters is required.</p>
    <p class="normal">You will also need Postman, cURL, or another suitable tool for transferring data using various HTTP methods.</p>
    <p class="normal">The following GitHub link will be required: <a href="https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter04"><span class="url">https://github.com/PacktPublishing/Full-Stack-Development-with-Spring-Boot-3-and-React-Fourth-Edition/tree/main/Chapter04</span></a>.</p>
    <h1 id="_idParaDest-50" class="heading-1">Basics of REST</h1>
    <p class="normal"><strong class="keyWord">Representational State Transfer</strong> (<strong class="keyWord">REST</strong>) is<a id="_idIndexMarker130"/> an architectural style for creating web services. REST is neither language- nor platform-dependent; different clients like mobile apps, browsers, and other services can communicate with each other. RESTful services can be scaled easily to fulfill increased demand.</p>
    <p class="normal">REST is not a standard but a set of constraints, defined by Roy Fielding. The constraints are as follows:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Stateless</strong>: The<a id="_idIndexMarker131"/> server shouldn’t hold any information about the client state.</li>
      <li class="bulletList"><strong class="keyWord">Client-server independence</strong>: The client and server should act independently. The<a id="_idIndexMarker132"/> server should not send any information without a request from the client.</li>
      <li class="bulletList"><strong class="keyWord">Cacheable</strong>: Many clients often request the same resources; therefore, caching should <a id="_idIndexMarker133"/>be applied to resources in order to improve performance.</li>
      <li class="bulletList"><strong class="keyWord">Uniform interface</strong>: Requests from different clients should look the same. Clients may<a id="_idIndexMarker134"/> include, for example, a browser, a Java application, and a mobile application.</li>
      <li class="bulletList"><strong class="keyWord">Layered system</strong>: Components can be added or modified without affecting the entire <a id="_idIndexMarker135"/>service. This constraint affects scalability.</li>
      <li class="bulletList"><strong class="keyWord">Code on demand</strong>: This is an optional constraint. Most of the time, the server sends static <a id="_idIndexMarker136"/>content in the form of JSON or XML. This constraint allows the server to send executable code if needed.</li>
    </ul>
    <p class="normal">The <a id="_idIndexMarker137"/>uniform interface constraint is important, and it means that every REST architecture should have the following elements:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Identification of resources</strong>: Resources should be identified by unique identifiers, for example, URIs in web-based REST services. REST resources should expose easily understood directory structure URIs. Therefore, a good resource-naming strategy is very important.</li>
      <li class="bulletList"><strong class="keyWord">Resource manipulation through representation</strong>: When making a request to a resource, the server should respond with a representation of the resource. Typically, the format of the representation is JSON or XML.</li>
      <li class="bulletList"><strong class="keyWord">Self-descriptive messages</strong>: Messages should contain enough information that the server knows how to process them.</li>
      <li class="bulletList"><strong class="keyWord">Hypermedia as the Engine of Application State</strong> (<strong class="keyWord">HATEOAS</strong>): Responses should contain links to other <a id="_idIndexMarker138"/>areas of the service.</li>
    </ul>
    <p class="normal">The RESTful web service that we are going to develop in the next sections follows the REST architectural principles above.</p>
    <h1 id="_idParaDest-51" class="heading-1">Creating a RESTful web service with Spring Boot</h1>
    <p class="normal">In Spring Boot, all HTTP requests are handled<a id="_idIndexMarker139"/> by <strong class="keyWord">controller classes</strong>. To be able to create a RESTful web service, first, we have to create a controller class. We will <a id="_idIndexMarker140"/>create our own Java package for the <a id="_idIndexMarker141"/>controller:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Activate the root package in the Eclipse <strong class="screenText">Project Explorer</strong> and right-click. Select <strong class="screenText">New | Package</strong> from the menu. We will name our new package <code class="inlineCode">com.packt.cardatabase.web</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_04_01.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.1: New Java package</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Next, we<a id="_idIndexMarker142"/> will create a new <code class="inlineCode">controller</code> class <a id="_idIndexMarker143"/>in a new web package. Activate the <code class="inlineCode">com.packt.cardatabase.web</code> package in the Eclipse<strong class="screenText"> Project Explorer</strong>. Right-click and select <strong class="screenText">New | Class</strong> from the menu; we will name our class <code class="inlineCode">CarController</code>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_04_02.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.2: New Java class</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Now, your<a id="_idIndexMarker144"/> project structure should<a id="_idIndexMarker145"/> look like the following screenshot:
    <figure class="mediaobject"><img src="../Images/B19818_04_03.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.3: Project structure</p>
    <div class="packt_tip">
      <p class="normal">If you<a id="_idIndexMarker146"/> create classes in the <a id="_idIndexMarker147"/>wrong package accidentally, you can drag and drop the files between packages in the Project Explorer. Sometimes, the Project Explorer view might not be rendered correctly when you make some changes. Refreshing the Project Explorer helps (activate the Project Explorer and press <em class="keystroke">F5</em>).</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Open your controller class in the editor window and add the <code class="inlineCode">@RestController</code> annotation before the class definition. Refer to the following source code. The <code class="inlineCode">@RestController</code> annotation identifies that this class will be the controller for the RESTful web service:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase.web;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> org.springframework.web.bind.annotation.RestController;</strong></span>
<span class="code-highlight"><strong class="hljs-meta-slc">@RestController</strong></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CarController</span> {
}
</code></pre>
      </li>
      <li class="numberedList">Next, we add a new method inside our controller class. The method is annotated with the <code class="inlineCode">@GetMapping</code> annotation, which defines the endpoint that the method is mapped to. In the following code snippet, you can see the sample source code. In this example, when a user makes a <code class="inlineCode">GET</code> request to the <code class="inlineCode">/cars</code> endpoint, the <code class="inlineCode">getCars()</code> method is executed:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase.web;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> org.springframework.web.bind.annotation.GetMapping;</strong></span>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="code-highlight"><strong class="hljs-keyword-slc">import </strong><strong class="hljs-slc">com.packt.cardatabase.domain.Car;</strong></span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CarController</span> {
    <span class="code-highlight"><strong class="hljs-meta-slc">@GetMapping("/cars")</strong></span>
    <span class="code-highlight"><strong class="hljs-keyword-slc">public</strong><strong class="hljs-slc"> Iterable&lt;Car&gt; </strong><strong class="hljs-title-slc">getCars</strong><strong class="hljs-slc">() {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">//Fetch and return cars</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
}
</code></pre>
    <p class="normal">The <code class="inlineCode">getCars()</code> method<a id="_idIndexMarker148"/> returns all the car<a id="_idIndexMarker149"/> objects, which are then <a id="_idIndexMarker150"/>marshaled to JSON objects automatically by the <strong class="keyWord">Jackson</strong> library (<span class="url">https://github.com/FasterXML/jackson</span>).</p>
    <p class="normal">Now, the <code class="inlineCode">getCars()</code> method handles only <code class="inlineCode">GET</code> requests from the <code class="inlineCode">/cars</code> endpoint because we are using the <code class="inlineCode">@GetMapping</code> annotation. There are other annotations for the different HTTP methods, such as <code class="inlineCode">@GetMapping</code>, <code class="inlineCode">@PostMapping</code>, <code class="inlineCode">@DeleteMapping</code>, and so on.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">To be able to return cars from the database, we have to inject <code class="inlineCode">CarRepository</code> into the controller. Then, we can use the <code class="inlineCode">findAll()</code> method that the repository provides to fetch all cars. Due to the <code class="inlineCode">@RestController</code> annotation, the data is now serialized to JSON format in the response. The following source code shows the controller code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase.web;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="hljs-keyword">import</span> com.packt.cardatabase.domain.Car;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> com.packt.cardatabase.domain.CarRepository;</strong></span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CarController</span> {
    <span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-keyword-slc"> final</strong><strong class="hljs-slc"> CarRepository repository;</strong></span>
    <span class="code-highlight"><strong class="hljs-keyword-slc">public</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">CarController</strong><strong class="hljs-slc">(CarRepository repository) {</strong></span>
        <span class="code-highlight"><strong class="hljs-built_in-slc">this</strong><strong class="hljs-slc">.repository = repository;</strong></span>
    <span class="code-highlight"><strong class="hljs-slc">}</strong></span>
    <span class="hljs-meta">@GetMapping("/cars")</span>
    <span class="hljs-keyword">public</span> Iterable&lt;Car&gt; <span class="hljs-title">getCars</span><span class="hljs-params">()</span> {
        <span class="code-highlight"><strong class="hljs-keyword-slc">return</strong><strong class="hljs-slc"> repository.findAll();</strong></span>
    }
}
</code></pre>
      </li>
      <li class="numberedList">Now, we <a id="_idIndexMarker151"/>are ready to run our<a id="_idIndexMarker152"/> application and navigate to <code class="inlineCode">localhost:8080/cars</code>. We can see that there is something wrong, and the application seems to be in an infinite loop. This happens on account of our one-to-many relationship between the car and owner tables. So, what happens in practice? First, the car is serialized, and it contains an owner who is then serialized, and that, in turn, contains cars that are then serialized, and so on. There are different solutions for avoiding this. One way is to use the <code class="inlineCode">@JsonIgnore</code> annotation on the <code class="inlineCode">cars</code> field in the <code class="inlineCode">Owner</code> class, which ignores the <code class="inlineCode">cars</code> field in the serialization process. You can also solve this by avoiding bidirectional mapping if it is not needed. We will also use the <code class="inlineCode">@JsonIgnoreProperties</code> annotation to ignore fields that are generated by Hibernate:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment">// Owner.java</span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> com.fasterxml.jackson.annotation.JsonIgnore;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</strong></span>
<span class="hljs-meta">@Entity</span>
<span class="code-highlight"><strong class="hljs-meta-slc">@JsonIgnoreProperties({"hibernateLazyInitializer","handler"})</strong></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Owner</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy=GenerationType.AUTO)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> ownerid;
    <span class="hljs-keyword">private</span> String firstname, lastname;
    <span class="hljs-keyword">public</span> <span class="hljs-title">Owner</span><span class="hljs-params">()</span> {}
    <span class="hljs-keyword">public</span> <span class="hljs-title">Owner</span><span class="hljs-params">(String firstname, String lastname)</span> {
        <span class="hljs-built_in">super</span>();
        <span class="hljs-built_in">this</span>.firstname = firstname;
        <span class="hljs-built_in">this</span>.lastname = lastname;
    }
    <span class="code-highlight"><strong class="hljs-meta-slc">@JsonIgnore</strong></span>
    <span class="hljs-meta">@OneToMany(cascade=CascadeType.ALL, mappedBy="owner")</span>
    <span class="hljs-keyword">private</span> List&lt;Car&gt; cars;
</code></pre>
      </li>
      <li class="numberedList">Now, when <a id="_idIndexMarker153"/>you run the application<a id="_idIndexMarker154"/> and navigate to <code class="inlineCode">localhost:8080/cars</code>, everything should go as expected and you will get all the cars from the database in JSON format, as shown in the following screenshot:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B19818_04_04.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.4: GET request to http://localhost:8080/cars</p>
    <div class="note">
      <p class="normal">Your output might differ from the screenshot due to browser differences. In this book, we are using the Chrome browser and the <strong class="keyWord">JSON Viewer</strong> extension, which makes JSON output more readable. JSON Viewer<a id="_idIndexMarker155"/> can be downloaded from the Chrome Web Store for free.</p>
    </div>
    <p class="normal">We have written our first RESTful web service. By leveraging the capabilities of Spring Boot, we were able to quickly implement a service that returns all the cars in our database. However, this is just the beginning of what Spring Boot has to offer for creating robust and efficient RESTful web services, and we will continue to explore its capabilities in the next section.</p>
    <h1 id="_idParaDest-52" class="heading-1">Using Spring Data REST</h1>
    <p class="normal"><strong class="keyWord">Spring Data REST</strong> (<span class="url">https://spring.io/projects/spring-data-rest</span>) is part of the Spring Data project. It<a id="_idIndexMarker156"/> offers an easy and fast way to implement RESTful web services with<a id="_idIndexMarker157"/> Spring. Spring Data REST provides <strong class="keyWord">HATEOAS</strong> (<strong class="keyWord">Hypermedia as the Engine of Application State</strong>) support, an architectural principle that allows<a id="_idIndexMarker158"/> clients to navigate the REST API dynamically using hypermedia links. Spring Data REST also provides events that you can use to customize the business logic of your REST API endpoints.</p>
    <div class="note">
      <p class="normal">You can read more about events in the Spring Data REST<a id="_idIndexMarker159"/> documentation: <span class="url">https://docs.spring.io/spring-data/rest/docs/current/reference/html/#events</span>.</p>
    </div>
    <p class="normal">To start using Spring<a id="_idIndexMarker160"/> Data REST, you have to add the following dependency to the <code class="inlineCode">build.gradle</code> file:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">dependencies</span> {
    implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-web'</span>
    implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
    <span class="code-highlight"><strong class="hljs-slc">implementation </strong><strong class="hljs-string-slc">'org.springframework.boot:spring-boot-starter-data-rest'</strong></span>
    developmentOnly <span class="hljs-string">'org.springframework.boot:spring-boot-devtools'</span>
    runtimeOnly <span class="hljs-string">'org.mariadb.jdbc:mariadb-java-client'</span>
    testImplementation <span class="hljs-string">'</span><span class="hljs-string">org.springframework.boot:spring-boot-starter-test'</span>
}
</code></pre>
    <div class="packt_tip">
      <p class="normal">Refresh your Gradle project from Eclipse after you have modified the <code class="inlineCode">build.gradle</code> file. Select the project in Eclipse’s Project Explorer and right-click to open the context menu. Then, select <strong class="screenText">Gradle | Refresh Gradle Project</strong>.</p>
    </div>
    <p class="normal">By default, Spring Data REST finds all public repositories from the application and creates RESTful web services for your entities automatically. In our case, we have two repositories: <code class="inlineCode">CarRepository</code> and <code class="inlineCode">OwnerRepository</code>; therefore, Spring Data REST creates RESTful web services automatically for those repositories.</p>
    <p class="normal">You can define the endpoint of the service in your <code class="inlineCode">application.properties</code> file as follows. You might need to restart your application for the changes to take effect:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">spring.data.rest.basePath</span>=<span class="hljs-string">/api</span>
</code></pre>
    <p class="normal">Now, you can <a id="_idIndexMarker161"/>access the RESTful web service from the <code class="inlineCode">localhost:8080/api</code> endpoint. By calling the root endpoint of the service, it returns the resources that are available. Spring Data REST returns JSON data in the <strong class="keyWord">Hypertext Application Language</strong> (<strong class="keyWord">HAL</strong>) format. The<a id="_idIndexMarker162"/> HAL format provides a set of conventions for expressing hyperlinks in JSON and it makes your RESTful web service easier to use for frontend developers:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_05.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.5: Spring Boot Data REST resources</p>
    <p class="normal">We can see that there are links to the car and owner entity services. The Spring Data REST service path name is derived from the entity class name. The name will then be pluralized and uncapitalized. For example, the entity <code class="inlineCode">Car</code> service path name will become <code class="inlineCode">cars</code>. The <code class="inlineCode">profile</code> link is generated by Spring Data REST and contains application-specific metadata. If you want to use different path naming, you can use the <code class="inlineCode">@RepositoryRestResource</code> annotation in your repository class, as shown in the next example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase.domain;
<span class="hljs-keyword">import</span> org.springframework.data.repository.CrudRepository;
<span class="hljs-keyword">import</span> org.springframework.data.rest.core.annotation.RepositoryRestResource;
<span class="code-highlight"><strong class="hljs-meta-slc">@RepositoryRestResource(path="vehicles")</strong></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">CarRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;Car, Long&gt; {
}
</code></pre>
    <p class="normal">Now, if you call the<a id="_idIndexMarker163"/> endpoint <code class="inlineCode">localhost:8080/api</code>, you can see that the endpoint has been changed from <code class="inlineCode">/cars</code> to <code class="inlineCode">/vehicles</code>.</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_06.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.6: Spring Boot Data REST resources</p>
    <p class="normal">You can remove the different naming, and we will continue with the default endpoint name, <code class="inlineCode">/cars</code>.</p>
    <p class="normal">Now, we’ll start to examine different services more carefully. There are multiple tools available <a id="_idIndexMarker164"/>for testing and consuming RESTful web services. In this book, we are using the <strong class="keyWord">Postman</strong> (<span class="url">https://www.postman.com/downloads/</span>) desktop app, but you can use tools that you are familiar with, such <a id="_idIndexMarker165"/>as <strong class="keyWord">cURL</strong>. Postman can be acquired as a desktop application or as a browser plugin. cURL is also available for Windows by using <a id="_idIndexMarker166"/>Windows Ubuntu Bash (<strong class="keyWord">Windows Subsystem for Linux</strong>, <strong class="keyWord">WSL</strong>).</p>
    <p class="normal">If you make a <a id="_idIndexMarker167"/>request to the <code class="inlineCode">/cars</code> endpoint (<code class="inlineCode">http://localhost:8080/api/cars</code>) using the <code class="inlineCode">GET</code> method (note: you can use a web browser for <code class="inlineCode">GET</code> requests), you will get a list of all the cars, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_07.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.7: Fetch cars</p>
    <p class="normal">In the JSON response, you can see that there is an array of cars, and each car contains car-specific data. All the cars also have the <code class="inlineCode">_links</code> attribute, which is a collection of links, and with these links, you can access the car itself or get the owner of the car. To access one specific car, the path will be <code class="inlineCode">http://localhost:8080/api/cars/{id}</code>.</p>
    <p class="normal">The <code class="inlineCode">GET</code> request to <code class="inlineCode">http://localhost:8080/api/cars/3/owner</code> returns the owner of the car with <code class="inlineCode">id</code> 3. The response now contains owner data, a link to the owner, and links to the owner’s other cars.</p>
    <p class="normal">The Spring Data REST<a id="_idIndexMarker168"/> service provides all CRUD operations. The following table shows which HTTP methods you can use for different CRUD operations:</p>
    <table id="table001-2" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">HTTP method</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">CRUD</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">GET</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Read</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">POST</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Create</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">PUT/PATCH</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Update</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode">DELETE</code></p>
          </td>
          <td class="table-cell">
            <p class="normal">Delete</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 4.1: Spring Data REST operations</p>
    <p class="normal">Next, we will look at how to delete a car from the database by using our RESTful web service. In a delete operation, you have to use the <code class="inlineCode">DELETE</code> method and the link to the car that will be deleted (<code class="inlineCode">http://localhost:8080/api/cars/{id}</code>).</p>
    <p class="normal">The following screenshot shows how you can delete one car with <code class="inlineCode">id</code> 3 by using the Postman desktop app. In Postman, you have to select the correct HTTP method from the drop-down list, enter the request URL, and then click the<strong class="screenText"> Send</strong> button:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_08.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.8: DELETE request to delete car</p>
    <p class="normal">If everything goes correctly, you will see the response status <strong class="screenText">200 OK</strong> in Postman. After the successful <code class="inlineCode">DELETE</code> request, you will also see that there are now two cars left in the database if you make a <code class="inlineCode">GET</code> request to the <code class="inlineCode">http://localhost:8080/api/cars/</code> endpoint. If you got the <strong class="screenText">404 Not Found</strong> status in the <code class="inlineCode">DELETE</code> response, check that you are using a car ID that exists in the database.</p>
    <p class="normal">When we want to <a id="_idIndexMarker169"/>add a new car to the database, we have to use the <code class="inlineCode">POST</code> method, and the request URL is <code class="inlineCode">http://localhost:8080/api/cars</code>. The header must contain the <code class="inlineCode">Content-Type</code> field with the value <code class="inlineCode">application/json</code>, and the new car object will be embedded in the request body in JSON format.</p>
    <p class="normal">Here is one car example:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Toyota"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Corolla"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"silver"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"</span><span class="hljs-attr">registrationNumber"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"BBA-3122"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"modelYear"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2023</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span><span class="hljs-number">38000</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">If you click the <strong class="screenText">Body</strong> tab and select <strong class="screenText">raw</strong> in Postman, you can type a new car JSON string under the <strong class="screenText">Body</strong> tab. Also select JSON from the drop-down list, as shown in the following screenshot:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_09.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.9: POST request to add a new car</p>
    <p class="normal">You also have to set a header by clicking the <strong class="screenText">Headers</strong> tab in Postman, as shown in the following screenshot. Postman adds some headers automatically based on your request selections. Check that the <code class="inlineCode">Content-Type</code> header is in the list and the value is correct (<code class="inlineCode">application/json</code>). If it doesn’t exist, you should add it manually. Automatically added headers might be hidden by default, but you can see these by clicking the <strong class="screenText">hidden</strong> button. Finally, you <a id="_idIndexMarker170"/>can press the <strong class="screenText">Send</strong> button:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_10.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.10: POST request headers</p>
    <p class="normal">The<a id="_idIndexMarker171"/> response will send a newly created <code class="inlineCode">car</code> object back and the status of the response will be <strong class="screenText">201 Created</strong> if everything went correctly. Now, if you make a <code class="inlineCode">GET</code> request again to the <code class="inlineCode">http://localhost:8080/api/cars</code> path, you will see that the new car exists in the database.</p>
    <p class="normal">To update entities, we can use the <code class="inlineCode">PATCH</code> method and the link to the car that we want to update (<code class="inlineCode">http://localhost:8080/api/cars/{id}</code>). The header must contain the <code class="inlineCode">Content-Type</code> field with the value <code class="inlineCode">application/json</code>, and the <code class="inlineCode">car</code> object with edited data will be given inside the request body.</p>
    <div class="packt_tip">
      <p class="normal">If you are using <code class="inlineCode">PATCH</code>, you have to send only fields that are updated. If you are using <code class="inlineCode">PUT</code>, you have to include all fields in the request body.</p>
    </div>
    <p class="normal">Let’s edit the car that we created in the previous example, changing the color to white. We are using <code class="inlineCode">PATCH</code>, so the payload contains only the <code class="inlineCode">color</code> property:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"white"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">The Postman request is shown in the following screenshot (note: we set the header as in the <code class="inlineCode">POST</code> example and use the car <code class="inlineCode">id</code> in the URL):</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_11.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.11: PATCH request to update existing car</p>
    <p class="normal">If the update succeeded, the response status is <strong class="screenText">200 OK</strong>. If you now fetch the updated car using a <code class="inlineCode">GET</code> request, you will see that the color has been updated.</p>
    <p class="normal">Next, we will add an owner to the new car that we just created. We can use the <code class="inlineCode">PUT</code> method and the <code class="inlineCode">http://localhost:8080/api/cars/{id}/owner</code> path. In this example, the ID of the new car is <code class="inlineCode">4</code>, so the link is <code class="inlineCode">http://localhost:8080/api/cars/4/owner</code>. The content of the <a id="_idIndexMarker172"/>body is now linked to an owner, for example, <code class="inlineCode">http://localhost:8080/api/owners/1</code>.</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_12.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.12: PUT request to update owner</p>
    <p class="normal">The <code class="inlineCode">Content-Type</code> value of the headers should be <code class="inlineCode">text/uri-list</code> in this case. If you can’t modify the automatically added header, you can disable it by unchecking it. Then, add a new one, like shown in the next image, and press the <strong class="screenText">Send</strong> button:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_13.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.13: PUT request headers</p>
    <p class="normal">Finally, you can make a <code class="inlineCode">GET</code> request for the car’s owner, and you should now see that the owner is linked to the car.</p>
    <p class="normal">In the previous <a id="_idIndexMarker173"/>chapter, we created queries for our repository. These queries can also be included in our service. To include queries, you have to add the <code class="inlineCode">@RepositoryRestResource</code> annotation to the repository class. Query parameters are annotated with the <code class="inlineCode">@Param</code> annotation. The following source code shows <code class="inlineCode">CarRepository</code> with these annotations:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase.domain;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> org.springframework.data.repository.CrudRepository;
<span class="hljs-keyword">import</span> org.springframework.data.repository.query.Param;
<span class="hljs-keyword">import</span> org.springframework.data.rest.core.annotation RepositoryRestResource;
<span class="code-highlight"><strong class="hljs-meta-slc">@RepositoryRestResource</strong></span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">CarRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CrudRepository</span>&lt;Car, Long&gt; {
    <span class="hljs-comment">// Fetch cars by brand</span>
    <span class="code-highlight"><strong class="hljs-slc">List&lt;Car&gt; </strong><strong class="hljs-title-slc">findByBrand</strong><strong class="hljs-slc">(</strong><strong class="hljs-meta-slc">@Param("brand")</strong><strong class="hljs-slc"> String brand);</strong></span>
    <span class="hljs-comment">// Fetch cars by color</span>
    <span class="code-highlight"><strong class="hljs-slc">List&lt;Car&gt; </strong><strong class="hljs-title-slc">findByColor</strong><strong class="hljs-slc">(</strong><strong class="hljs-meta-slc">@Param("color")</strong><strong class="hljs-slc"> String color);</strong></span>
}
</code></pre>
    <p class="normal">Now, when you make a <code class="inlineCode">GET</code> request to the <code class="inlineCode">http://localhost:8080/api/cars</code> path, you can see that there is a new endpoint called <code class="inlineCode">/search</code>. Calling the <code class="inlineCode">http://localhost:8080/api/cars/search</code> path returns the following response:</p>
    <figure class="mediaobject"><img src="../Images/B19818_04_14.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.14: REST queries</p>
    <p class="normal">From the response, you can see that both queries are now available in our service. The following URL demonstrates how to fetch cars by brand: <code class="inlineCode">http://localhost:8080/api/cars/search/findByBrand?brand=Ford</code>. The output will only contain cars with the brand Ford.</p>
    <p class="normal">At the <a id="_idIndexMarker174"/>beginning of this chapter, we introduced the REST principles, and we can see that our RESTful API fulfills several aspects of the REST specification. It is stateless and requests from different clients look the same (uniform interface). The response contains links that can be used to navigate between related resources. Our RESTful API provides a URI structure that reflects the data model and relationship between resources.</p>
    <p class="normal">We have now created the RESTful API for our backend, and we will consume it later with our React frontend.</p>
    <h1 id="_idParaDest-53" class="heading-1">Documenting a RESTful API</h1>
    <p class="normal">A RESTful API <a id="_idIndexMarker175"/>should be properly documented so that developers who are consuming it understand its functionality and behavior. The documentation should include what endpoints are available, what data formats are accepted, and how to interact with the API.</p>
    <p class="normal">In this book, we will use <a id="_idIndexMarker176"/>the <strong class="keyWord">OpenAPI 3</strong> library for Spring Boot (<span class="url">https://springdoc.org</span>) to generate documentation automatically. The <strong class="keyWord">OpenAPI Specification</strong> (formerly Swagger Specification) is an API description format for RESTful APIs. There are other<a id="_idIndexMarker177"/> alternatives, such as<a id="_idIndexMarker178"/> RAML (<span class="url">https://raml.org/</span>), that can be used as well. You can also document your REST API using some other documentation tools, which provide flexibility but require more manual work. The use of the OpenAPI library automates this work, allowing you to focus on development.</p>
    <p class="normal">The following steps demonstrate how you can generate documentation for your RESTful API:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, we have to add the OpenAPI library to our Spring Boot application. Add the following dependency to your <code class="inlineCode">build.gradle</code> file:
        <pre class="programlisting code"><code class="hljs-code">implementation <span class="hljs-keyword">group</span>: <span class="hljs-string">'</span><span class="hljs-string">org.springdoc'</span>, name: <span class="hljs-string">'springdoc-openapi-starter-webmvc-ui'</span>, version: <span class="hljs-string">'2.0.2'</span>
</code></pre>
      </li>
      <li class="numberedList">Next, we create a configuration class for our documentation. Create a new class called <code class="inlineCode">OpenApiConfig</code> in the <code class="inlineCode">com.packt.cardatabase</code> package of your application. Below is the code for the configuration class where we can configure, for example, the REST API title, description, and version. We can use the <code class="inlineCode">info()</code> method to define these values:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">package</span> com.packt.cardatabase;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.models.OpenAPI;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.models.info.Info;
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OpenApiConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> OpenAPI <span class="hljs-title">carDatabaseOpenAPI</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">OpenAPI</span>()
            .info(<span class="hljs-keyword">new</span> <span class="hljs-title">Info</span>()
            .title(<span class="hljs-string">"Car REST API"</span>)
            .description(<span class="hljs-string">"My car stock"</span>)
            .version(<span class="hljs-string">"1.0"</span>));
    }
}
</code></pre>
      </li>
      <li class="numberedList">In the <code class="inlineCode">application.properties</code> file, we can define the path for our documentation. We can also enable <strong class="keyWord">Swagger UI,</strong> a user-friendly tool for visualizing RESTful APIs that are <a id="_idIndexMarker179"/>documented using the OpenAPI Specification (<span class="url">https://swagger.io/tools/swagger-ui</span><span class="url">/</span>). Add the following settings to your <code class="inlineCode">application.properties</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">springdoc.api-docs.path</span>=<span class="hljs-string">/api-docs</span>
<span class="hljs-attr">springdoc.swagger-ui.path</span>=<span class="hljs-string">/swagger-ui.html</span>
<span class="hljs-attr">springdoc.swagger-ui.enabled</span>=<span class="hljs-string">true</span>
</code></pre>
      </li>
      <li class="numberedList">Now, we are<a id="_idIndexMarker180"/> ready to run our project. When your application is running, navigate to <code class="inlineCode">http://localhost:8080/swagger-ui.html</code> and you will see the documentation in Swagger UI, as shown in the following screenshot:
    <figure class="mediaobject"><img src="../Images/B19818_04_15.png" alt="" role="presentation"/></figure>
    <p class="packt_figref">Figure 4.15: Car RESTful API documentation</p>
    <p class="normal">You can see all the endpoints that are available in your RESTful API. If you open any of the endpoints, you can even try them out by pressing the <strong class="screenText">Try it out</strong> button. The<a id="_idIndexMarker181"/> documentation is also available in JSON format at <code class="inlineCode">http://localhost:8080/api-docs</code>.</p></li>
    </ol>
    <p class="normal">Now that you have provided documentation for your RESTful API, it is much easier for developers to consume it.</p>
    <div class="note">
      <p class="normal">In the next chapter, we will secure our RESTful API, which will break access to Swagger UI. You can allow access again by modifying your security configuration (allow the <code class="inlineCode">"/api-docs/**"</code> and <code class="inlineCode">"/swagger-ui/**"</code> paths). You can also use Spring Profiles, but that is out of scope for this book.</p>
    </div>
    <h1 id="_idParaDest-54" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we created a RESTful web service with Spring Boot. First, we created a controller and one method that returns all cars in JSON format. Next, we used Spring Data REST to get a fully functional web service with all CRUD functionalities. We covered different types of requests that are needed to use the CRUD functionalities of the service that we created. We also included our queries in the RESTful web service. Finally, we learned how to document our API properly with OpenAPI 3.</p>
    <p class="normal">We will use this RESTful web service with our frontend later in this book, and now you can also easily implement a REST API for your own needs.</p>
    <p class="normal">In the next chapter, we will secure our backend using Spring Security. We will learn how to secure our data by implementing authentication. Then, only authenticated users will be able to access the RESTful API’s resources.</p>
    <h1 id="_idParaDest-55" class="heading-1">Questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">What is REST?</li>
      <li class="numberedList">How can you create a RESTful web service with Spring Boot?</li>
      <li class="numberedList">How can you fetch items using our RESTful web service?</li>
      <li class="numberedList">How can you delete items using our RESTful web service?</li>
      <li class="numberedList">How can you add items using our RESTful web service?</li>
      <li class="numberedList">How can you update items using our RESTful web service?</li>
      <li class="numberedList">How can you use queries with our RESTful web service?</li>
      <li class="numberedList">What is the OpenAPI Specification?</li>
      <li class="numberedList">What is Swagger UI?</li>
    </ol>
    <h1 id="_idParaDest-56" class="heading-1">Further reading</h1>
    <p class="normal">Packt has other resources available for learning about Spring Boot RESTful web services:</p>
    <ul>
      <li class="bulletList"><em class="italic">Postman Tutorial: Getting Started with API Testing [Video]</em> by Praveenkumar Bouna (<a href="https://www.packtpub.com/product/postman-tutorial-getting-started-with-api-testing-video/9781803243351"><span class="url">https://www.packtpub.com/product/postman-tutorial-getting-started-with-api-testing-video/9781803243351</span></a>)</li>
      <li class="bulletList"><em class="italic">Hands-On RESTful API Design Patterns and Best Practices</em> by Harihara Subramanian J and Pethuru Raj (<a href="https://www.packtpub.com/product/hands-on-restful-api-design-patterns-and-best-practices/9781788992664"><span class="url">https://www.packtpub.com/product/hands-on-restful-api-design-patterns-and-best-practices/9781788992664</span></a>)</li>
    </ul>
    <h1 class="heading-1">Learn more on Discord</h1>
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask the author questions, and learn about new releases – follow the QR code below:</p>
    <p class="normal"><a href="https://packt.link/FullStackSpringBootReact4e"><span class="url">https://packt.link/FullStackSpringBootReact4e</span></a></p>
    <p class="normal"><img src="../Images/QR_Code10796108009382640.png" alt="" role="presentation"/></p>
  </div>
</body></html>