<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer004">
<h1 id="_idParaDest-5"><a id="_idTextAnchor004"/>Preface</h1>
<p>Knowing that experienced hackers are itching to test your skills makes security one of the most difficult and high-pressured concerns of creating an application. The complexity of properly securing an application is compounded when you must also integrate this factor with existing code, new technologies, and other frameworks. Use this book to easily secure your Java application with the tried and trusted <strong class="bold">Spring Security</strong> framework, a powerful and highly customizable authentication and <span class="No-Break">access-control framework.</span></p>
<p>The book starts by integrating a variety of authentication mechanisms. It then demonstrates how to properly restrict access to your application. It also covers tips on integrating with some of the more popular web frameworks. An example of how Spring Security defends against session fixation, moves into concurrency control, and how you can utilize session management for administrative functions is <span class="No-Break">also included.</span></p>
<p>It concludes with advanced security scenarios for RESTful web services and microservices, detailing the issues surrounding stateless authentication, and demonstrates a concise, step-by-step approach to solving <span class="No-Break">those issues.</span></p>
<h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Who this book is for</h1>
<p>If you are a Java Web and/or RESTful web service developer and have a basic understanding of creating Java 17/21, Java Web and/or RESTful web service applications, XML, and the Spring Security framework, this book is <span class="No-Break">for you.</span></p>
<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>What this book covers</h1>
<p><a href="B21757_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Anatomy of an Unsafe Application</em>, covers a hypothetical security audit of our calendar application, illustrating common issues that can be resolved through the proper application of Spring Security. You will learn about some basic security terminology and review some prerequisites for getting the sample application up <span class="No-Break">and running.</span></p>
<p><a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, demonstrates the <strong class="source-inline">"Hello World"</strong> installation of Spring Security. After that, the chapter walks you through some of the most common customizations of <span class="No-Break">Spring Security.</span></p>
<p><a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Custom Authentication</em>, incrementally explains Spring Security’s authentication architecture by customizing key pieces of the authentication infrastructure to address real-world problems. Through these customizations, you will gain an understanding of how Spring Security authentication works and how you can integrate with existing and new <span class="No-Break">authentication mechanisms.</span></p>
<p><a href="B21757_04.xhtml#_idTextAnchor106"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">JDBC-based Authentication</em>, covers authenticating against a database using Spring Security’s built-in <strong class="bold">Java Database Connectivity</strong> (<strong class="bold">JDBC</strong>) support. We then discuss how we can secure our passwords using Spring Security’s new <span class="No-Break">cryptography module.</span></p>
<p><a href="B21757_05.xhtml#_idTextAnchor150"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Authentication with Spring Data</em>, looks at the Spring Data project, and how to leverage <strong class="bold">Jakarta Persistence</strong> (<strong class="bold">JPA</strong>) to perform authentication against a relational database. We will also explore how to perform authentication against a document database <span class="No-Break">using MongoDB.</span></p>
<p><a href="B21757_06.xhtml#_idTextAnchor180"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">LDAP Directory Services</em>, will review the <strong class="bold">Lightweight Directory Access Protocol</strong> (<strong class="bold">LDAP</strong>) and learn how it can be integrated into a Spring-Security-enabled application to provide authentication, authorization, and user information services to <span class="No-Break">interested constituents.</span></p>
<p><a href="B21757_07.xhtml#_idTextAnchor220"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Remember-me Services</em>, demonstrates the use of the remember-me feature in Spring Security and how to configure it. We also explore additional considerations to bear in mind when using it. We’ll add the ability for an application to remember a user even after their session has expired and the browser <span class="No-Break">is closed.</span></p>
<p><a href="B21757_08.xhtml#_idTextAnchor261"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Client Certificate Authentication with TLS</em>, demonstrates that, although username and password authentication is extremely common, as we discussed in <a href="B21757_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Anatomy of an Unsafe Application</em>, and in <a href="B21757_02.xhtml#_idTextAnchor043"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Getting Started with Spring Security</em>, forms of authentication exist that allow users to present different types of credentials. Spring Security caters to these requirements as well. In this chapter, we’ll move beyond form-based authentication to explore authentication using trusted <span class="No-Break">client-side certificates.</span></p>
<p><a href="B21757_09.xhtml#_idTextAnchor295"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Opening up to OAuth 2</em>, explains that OAuth 2 is a very popular form of trusted identity management that allows users to manage their identity through a single trusted provider. This convenient feature provides users with the security of storing their password and personal information with the trusted OAuth 2 provider, optionally disclosing personal information upon request. Additionally, the OAuth-2-enabled website offers the confidence that the users providing OAuth 2 credentials are who they say <span class="No-Break">they are.</span></p>
<p><a href="B21757_10.xhtml#_idTextAnchor314"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">SAML 2 Support</em>, will deep dive into the world of <strong class="bold">Security Assertion Markup Language</strong> (<strong class="bold">SAML 2.0</strong>) support and how it can be seamlessly integrated into their Spring Security applications. SAML 2.0 is an XML-based standard for exchanging authentication and authorization data between <strong class="bold">identity providers</strong> (<strong class="bold">IdPs</strong>) and <strong class="bold">service </strong><span class="No-Break"><strong class="bold">providers</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">SPs</strong></span><span class="No-Break">).</span></p>
<p><a href="B21757_11.xhtml#_idTextAnchor332"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Fine-Grained Access Control</em>, will first examine two ways to implement fine-grained authorization—authorization that may affect portions of a page of the application. Next, we will look at Spring Security’s approach to securing the business tier through method annotation and the use of interface-based proxies to accomplish <strong class="bold">Aspect-Oriented</strong><strong class="bold"> Programming</strong> (<strong class="bold">AOP</strong>). Then, we will review an interesting capability of annotation-based security that allows for role-based filtering on collections of data. Last, we will look at how class-based proxies differ from <span class="No-Break">interface-based proxies.</span></p>
<p><a href="B21757_12.xhtml#_idTextAnchor375"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, <em class="italic">Access Control Lists</em>, will address the complex topic of <strong class="bold">Access Control Lists</strong> (<strong class="bold">ACLs</strong>), which can provide a rich model of domain object instance-level authorization. Spring Security ships with a robust, but complicated, ACL module that can serve the needs of small- to medium-sized implementations <span class="No-Break">reasonably well.</span></p>
<p><a href="B21757_13.xhtml#_idTextAnchor415"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>, <em class="italic">Custom Authorization</em>, will include some custom implementations for Spring Security’s key authorization APIs. Once we have done this, we will use the understanding of the custom implementations to understand how Spring Security’s authorization <span class="No-Break">architecture works.</span></p>
<p><a href="B21757_14.xhtml#_idTextAnchor445"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">Session Management</em>, discusses how Spring Security manages and secures user sessions. The chapter starts by explaining session fixation attacks and how Spring Security defends against them. It then discusses how you can manage logged-in users and restrict the number of concurrent sessions a single user has. Finally, we describe how Spring Security associates a user with <strong class="source-inline">HttpSession</strong> and how to customize <span class="No-Break">this behavior.</span></p>
<p><a href="B21757_15.xhtml#_idTextAnchor479"><span class="No-Break"><em class="italic">Chapter 15</em></span></a>, <em class="italic">Additional Spring Security Features</em>, covers other Spring Security features, including common security vulnerabilities such as <strong class="bold">cross-site scripting</strong> (<strong class="bold">XSS</strong>), <strong class="bold">cross-site request forgery</strong> (<strong class="bold">CSRF</strong>), <strong class="bold">synchronizer tokens</strong>, and <strong class="bold">clickjacking</strong>, and how to protect <span class="No-Break">against them.</span></p>
<p><a href="B21757_16.xhtml#_idTextAnchor512"><span class="No-Break"><em class="italic">Chapter 16</em></span></a>, <em class="italic">Migration to Spring Security 6</em>, provides a migration path from Spring Security 5, including notable configuration changes, class and package migrations, and important new features, including Java 17 support and new authentication mechanisms with <span class="No-Break">OAuth 2.1.</span></p>
<p>It also highlights the new features that can be found in Spring Security 6.1 and provides references to examples of the features in <span class="No-Break">the book.</span></p>
<p><a href="B21757_17.xhtml#_idTextAnchor537"><span class="No-Break"><em class="italic">Chapter 17</em></span></a>, <em class="italic">Microservice Security with OAuth 2 and JSON Web Tokens</em>, looks at microservices-based architectures and how OAuth 2 with <strong class="bold">JSON Web Tokens</strong> (<strong class="bold">JWT</strong>) plays a role in securing microservices in a <span class="No-Break">Spring-based application.</span></p>
<p><a href="B21757_18.xhtml#_idTextAnchor591"><span class="No-Break"><em class="italic">Chapter 18</em></span></a>, <em class="italic">Single Sign-On with the Central Authentication Service</em>, shows how integrating with a <strong class="bold">Central Authentication Service</strong> (<strong class="bold">CAS</strong>) can provide single sign-on and single logout support to your <span class="No-Break">Spring-Security-enabled applications.</span></p>
<p><a href="B21757_19.xhtml#_idTextAnchor625"><span class="No-Break"><em class="italic">Chapter 19</em></span></a>, <em class="italic">Build GraalVM Native Images</em>, looks at Spring Security 6 support for building native images using GraalVM. This can be a great way to improve the performance and security of your Spring <span class="No-Break">Security applications.</span></p>
<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>To get the most out of this book</h1>
<p>The primary method for integrating with the sample code is providing <strong class="bold">Gradle</strong>- and <strong class="bold">Maven</strong>-compatible projects. Since many <strong class="bold">Integrated Development Environments </strong>(<strong class="bold">IDEs</strong>). have rich integration with Gradle and Maven, users should be able to import the code into any IDE that supports either Gradle or Maven. As many developers use Gradle and Maven, we felt this was the most straightforward method of packaging the examples. Whatever development environment you are familiar with, hopefully, you will find a way to work through the examples in <span class="No-Break">this book.</span></p>
<p>Many IDEs provide Gradle or Maven tooling that can automatically download the Spring and <strong class="bold">Spring Security 6</strong> Javadoc and source code for you. However, there may be times when this is not possible. In such cases, you’ll want to download the full releases of both <strong class="bold">Spring 6</strong> and Spring Security 6. The Javadoc and source code are top notch. If you get confused or want more information, the samples can provide an additional level of support or reassurance for <span class="No-Break">your learning.</span></p>
<p>To run the sample application, you will need an IDE such as <strong class="bold">IntelliJ IDEA</strong> or <strong class="bold">Eclipse</strong> and build it with <strong class="bold">Gradle</strong> or <strong class="bold">Maven</strong>, which don’t have strict hardware requirements. However, these are some general recommendations to ensure a smooth <span class="No-Break">development experience:</span></p>
<ol>
<li><span class="No-Break">System Requirements:</span><ul><li>A modern computer with at least 4GB of RAM (8GB or more is recommended).</li><li>A multi-core processor for faster build and development.</li></ul></li>
<li><span class="No-Break">Operating System:</span><ul><li>Spring applications can be developed on Windows, macOS, or Linux. Choose the one that you are most comfortable with.</li></ul></li>
<li><span class="No-Break">Disk Space:</span><ul><li>You will need disk space for your project files, dependencies, and any databases you might use. At least 10GB of free disk space is advisable.</li></ul></li>
<li><span class="No-Break">Network Connection:</span><ul><li>A stable internet connection may be needed for downloading dependencies, plugins, and libraries during project setup.</li></ul></li>
</ol>
<table class="No-Table-Style" id="table001">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold">Software/hardware covered in </strong><span class="No-Break"><strong class="bold">the book</strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold">Operating </strong><span class="No-Break"><strong class="bold">system requirements</strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>IntelliJ IDEA and Eclipse are both popular choices for <span class="No-Break">Spring development</span></p>
</td>
<td class="No-Table-Style">
<p>Windows, macOS, <span class="No-Break">or Linux</span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>JDK versions: 17 <span class="No-Break">or 21</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Spring- <span class="No-Break">Security 6.</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p>Spring- <span class="No-Break">Boot 3.</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break">Thymeleaf 6.</span></p>
</td>
<td class="No-Table-Style"/>
</tr>
</tbody>
</table>
<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting </strong><span class="No-Break"><strong class="bold">of code.</strong></span></p>
<p>From <a href="B21757_03.xhtml#_idTextAnchor068"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Custom Authentication</em> onwards, the book shifts its emphasis to delve deeper into Spring Security, particularly in conjunction with the Spring <span class="No-Break">Boot framework.</span></p>
<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>Download the example code files</h1>
<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/Spring-Security-Fourth-Edition/">https://github.com/PacktPublishing/Spring-Security-Fourth-Edition/</a>. If there’s an update to the code, it will be updated in the <span class="No-Break">GitHub repository.</span></p>
<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check <span class="No-Break">them out!</span></p>
<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Code in Action</h1>
<p>The Code in Action videos for this book can be viewed <span class="No-Break">at </span><a href="https://packt.link/Om1ow"><span class="No-Break">https://packt.link/Om1ow</span></a><span class="No-Break">.</span></p>
<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Conventions used</h1>
<p>There are a number of text conventions used throughout <span class="No-Break">this book.</span></p>
<p><strong class="source-inline">Code in text</strong>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “We are loading the <strong class="source-inline">calendar.ldif</strong> file from <strong class="source-inline">classpath</strong>, and using it to populate the <span class="No-Break">LDAP server.”</span></p>
<p>A block of code is set <span class="No-Break">as follows:</span></p>
<pre class="source-code">
//src/main/java/com/packtpub/springsecurity/configuration/SecurityConfig.java
@Bean public SecurityFilterChain filterChain(HttpSecurity http,        PersistentTokenRepository persistentTokenRepository, RememberMeServices rememberMeServices) throws Exception {    http.authorizeHttpRequests( authz -&gt; authz                 .requestMatchers("/webjars/**").permitAll()
…
    // Remember Me     http.rememberMe(httpSecurityRememberMeConfigurer -&gt; httpSecurityRememberMeConfigurer           .key("jbcpCalendar")          .rememberMeServices(rememberMeServices)          .tokenRepository(persistentTokenRepository));        return http.build();}</pre> <p>The first line, <strong class="source-inline">//src/main/java/com/packtpub/springsecurity/configuration/SecurityConfig.java</strong>, indicates the location of the file to <span class="No-Break">be modified.</span></p>
<p>Any command-line input or output is written <span class="No-Break">as follows:</span></p>
<pre class="console">
X-Content-Security-Policy: default-src 'self' X-WebKit-CSP: default-src 'self'</pre> <p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “Right-click on <strong class="bold">World</strong> and <span class="No-Break">select </span><span class="No-Break"><strong class="bold">Search</strong></span><span class="No-Break">.”</span></p>
<p class="callout-heading">Tips or important notes</p>
<p class="callout">Appear like this.</p>
<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Get in touch</h1>
<p>Feedback from our readers is <span class="No-Break">always welcome.</span></p>
<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a> and mention the book title in the subject of <span class="No-Break">your message.</span></p>
<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in <span class="No-Break">the form.</span></p>
<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packtpub.com">copyright@packtpub.com</a> with a link to <span class="No-Break">the material.</span></p>
<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please <span class="No-Break">visit </span><a href="http://authors.packtpub.com"><span class="No-Break">authors.packtpub.com</span></a><span class="No-Break">.</span></p>
<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Share Your Thoughts</h1>
<p>Once you’ve read <em class="italic">Spring Security</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1-835-46050-X">click here to go straight to the Amazon review page</a> for this book and share <span class="No-Break">your feedback.</span></p>
<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent <span class="No-Break">quality content.</span></p>
<h1 id="_idParaDest-14"><a id="_idTextAnchor013"/>Download a free PDF copy of this book</h1>
<p>Thanks for purchasing <span class="No-Break">this book!</span></p>
<p>Do you like to read on the go but are unable to carry your print <span class="No-Break">books everywhere?</span></p>
<p>Is your eBook purchase not compatible with the device of <span class="No-Break">your choice?</span></p>
<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at <span class="No-Break">no cost.</span></p>
<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application. </p>
<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your <span class="No-Break">inbox daily</span></p>
<p>Follow these simple steps to get <span class="No-Break">the benefits:</span></p>
<ol>
<li value="1">Scan the QR code or visit the <span class="No-Break">link </span><span class="No-Break">below:</span></li>
</ol>
<p class="IMG---Figure"> </p>
<div>
<div class="IMG---Figure" id="_idContainer003">
<img alt="" height="200" role="presentation" src="image/B21757_QR_Free_PDF.jpg" width="200"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781835460504">https://packt.link/free-ebook/9781835460504</a></p>
<ol>
<li value="2">Submit your proof <span class="No-Break">of purchase</span></li>
<li>That’s it! We’ll send your free PDF and other benefits to your <span class="No-Break">email directly</span></li>
</ol>
</div>
</div>

<div id="sbo-rt-content"><div class="Content" id="_idContainer005">
<h1 id="_idParaDest-15" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor014"/>Part 1: Fundamentals of Application Security</h1>
<p>This part delves into the foundational aspects of application security, laying the groundwork for understanding potential vulnerabilities. We embark on a comprehensive exploration of application security using Spring Security. This part introduces you to the process of conducting a security audit on a hypothetical calendar application. Through this audit, we uncover common security vulnerabilities and lay the groundwork for implementing robust <span class="No-Break">security measures.</span></p>
<p>Building upon this foundation, this part guides you through the installation and configuration of Spring Security. We start with a basic <strong class="source-inline">"Hello World"</strong> example, gradually customizing Spring Security to suit the specific needs of <span class="No-Break">our application.</span></p>
<p>We will also delve deeper into the authentication process within Spring Security. By customizing key components of the authentication infrastructure, we address real-world authentication challenges and gain a comprehensive understanding of Spring Security’s authentication mechanisms. Through practical examples and hands-on exercises, we learn how to integrate custom authentication solutions seamlessly into <span class="No-Break">our applications.</span></p>
<p>This part has the <span class="No-Break">following chapters:</span></p>
<ul>
<li><a href="B21757_01.xhtml#_idTextAnchor015"><em class="italic">Chapter 1</em></a>, <em class="italic">Anatomy of an Unsafe Application</em></li>
<li><a href="B21757_02.xhtml#_idTextAnchor043"><em class="italic">Chapter 2</em></a>, <em class="italic">Getting Started with Spring Security</em></li>
<li><a href="B21757_03.xhtml#_idTextAnchor068"><em class="italic">Chapter 3</em></a>, <em class="italic">Custom Authentication</em></li>
</ul>
</div>
<div>
<div id="_idContainer006">
</div>
</div>
<div>
<div class="Basic-Graphics-Frame" id="_idContainer007">
</div>
</div>
</div></body></html>