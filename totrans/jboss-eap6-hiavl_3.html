<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Setting Up a JBoss EAP6 Cluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Setting Up a JBoss EAP6 Cluster</h1></div></div></div><p>In the previous chapter, we have learned how to use the management console to deploy projects into JBoss EAP6 in<a id="id145" class="indexterm"/> both the standalone mode and domain mode. We also saw that the domain mode has helped us a lot when we needed to manage multiple servers. It achieved this goal by centralizing the management task into a domain controller.</p><p>The domain mode provided by EAP6 is a good support to help us set up our cluster, but it's still not the cluster itself. As we have seen in <a class="link" href="ch02.html" title="Chapter 2. Using JBoss EAP6">Chapter 2</a>, <span class="emphasis"><em>Using JBoss EAP6</em></span>, though servers are managed in a server group, they do not form a cluster. For the servers to form a cluster, we need to perform the following two tasks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Setting up the EAP6 servers properly to make sure the components related with clustering are all running in correct status</li><li class="listitem" style="list-style-type: disc">Setting up a load balancer so that user requests can be dispatched to the different EAP6 servers contained in the cluster</li></ul></div><p>In this chapter, we'll focus on the first task.</p><div class="section" title="Designing a cluster"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Designing a cluster</h1></div></div></div><p>In the previous <a id="id146" class="indexterm"/>chapter, we have seen that EAP6 has provided two server groups in <code class="literal">domain.xml</code>. One is called <span class="strong"><strong>main-server-group</strong></span> and the other is called <span class="strong"><strong>other-server-group</strong></span>. In this chapter, we'll use the other-server-group to set the cluster, because it's using the <code class="literal">full-ha</code> profile, and this profile contains all the components we'll use to set up the cluster.</p><p>With a cluster, we can distribute the request load to multiple servers. With the EAP6 domain management function, we can deploy a project into multiple EAP6 servers in the management console of the domain controller.</p><p>We will use three machines to set up a cluster in this book. Two of them will be used to run the EAP6 servers, and one of them will be used to run the load balancer. In this chapter, we will use two machines to run the EAP6 servers.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>You can also use virtualization to have all of them running in a single physical box. Just make sure they have independent IP addresses that can communicate with one another, and the firewalls are turned off.</p></div></div><p>The deployment process is shown in following diagram:</p><div class="mediaobject"><img src="graphics/2432_03_02.jpg" alt="Designing a cluster"/></div><p>In this chapter, we'll use two machines and install EAP6 on both of them, and we'll talk about the load <a id="id147" class="indexterm"/>balancer in the next chapter. The deployment diagram of two EAP6 servers is shown in the following diagram:</p><div class="mediaobject"><img src="graphics/2432_03_01.jpg" alt="Designing a cluster"/></div><p>The two machines are called <span class="strong"><strong>master</strong></span> and <span class="strong"><strong>slave</strong></span>. I have put the IP addresses of these two servers into the<a id="id148" class="indexterm"/> diagram for your reference. These addresses are used in my local environment. In the diagram, the EAP6 server on <span class="strong"><strong>master</strong></span> will be configured as a domain controller, and the EAP6 server running on <span class="strong"><strong>slave</strong></span> will accept the management of <span class="strong"><strong>master</strong></span>.</p><p>In <code class="literal">domain/configuration/host.xml</code>, EAP6 has provided us with a default server that belongs to other-server-group. We'll rename this server on <span class="strong"><strong>master</strong></span> as <code class="literal">master-server</code>, and rename the one on <span class="strong"><strong>slave</strong></span> as <code class="literal">slave-server</code>.</p><p>In the EAP6 domain mode, each server instance is running in its own JVM process. The following are the processes that will be running on <span class="strong"><strong>master</strong></span>:</p><div class="informalexample"><pre class="programlisting">/usr/bin/java -D[Process Controller]
/usr/bin/java -D[Host Controller]
/usr/bin/java -D[Server:master-server]</pre></div><p>The following are the processes that will be running on <span class="strong"><strong>slave</strong></span>:</p><div class="informalexample"><pre class="programlisting">/usr/bin/java -D[Process Controller]
/usr/bin/java -D[Host Controller]
/usr/bin/java -D[Server:slave-server]</pre></div><p>The host controller running on <span class="strong"><strong>master</strong></span> will act as the domain controller; the host controller running on <span class="strong"><strong>slave</strong></span> will accept the management from the domain controller. In addition, both master-server and slave-server belong to other-server-group. When we deploy a project into other-server-group, the project will be deployed to both the servers, because they belong to the same server group, even though they are running on different machines and with different JVMs.</p></div></div>
<div class="section" title="Setting up a server group"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Setting up a server group</h1></div></div></div><p>In this <a id="id149" class="indexterm"/>section we'll start doing some configurations in EAP6. As<a id="id150" class="indexterm"/> we know, there are two server groups already set up for us in JBoss EAP6:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">main-server-group</li><li class="listitem" style="list-style-type: disc">other-server-group</li></ul></div><p>And in <a class="link" href="ch02.html" title="Chapter 2. Using JBoss EAP6">Chapter 2</a>, <span class="emphasis"><em>Using JBoss EAP6</em></span>, we have played with main-server-group. In this chapter we'll use other-server-group.</p><div class="section" title="The main-server-group versus other-server-group"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec30"/>The main-server-group versus other-server-group</h2></div></div></div><p>The major <a id="id151" class="indexterm"/>difference is that they are using two different profiles. You can see this in <code class="literal">domain.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server-group name="main-server-group" profile="full"&gt;...
&lt;server-group name="other-server-group" profile="full-ha"&gt;...</pre></div><p>As shown in<a id="id152" class="indexterm"/> the preceding configuration, we don't define different profiles into different configuration files in the domain mode. Instead it's defined in different profile sections in <code class="literal">domain</code>
<code class="literal">.xml</code>.</p></div><div class="section" title="Server configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec31"/>Server configuration</h2></div></div></div><p>Now let's start <a id="id153" class="indexterm"/>configuring our server group. <a id="id154" class="indexterm"/>Because we need to configure two EAP6 instances on two different machines, let's go through them one by one. Let's start with <span class="strong"><strong>master</strong></span>.</p><div class="section" title="Setting up master"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec11"/>Setting up master</h3></div></div></div><p>The EAP6 on <a id="id155" class="indexterm"/>
<span class="strong"><strong>master</strong></span> <a id="id156" class="indexterm"/>will be used as a domain controller. Let's start configuring it.</p><div class="section" title="Configuring host.xml"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec04"/>Configuring host.xml</h4></div></div></div><p>The first <a id="id157" class="indexterm"/>thing we should do is set the host name in <code class="literal">domain/configuration/host.xml</code>. Let's set the hostname to <code class="literal">master</code>:</p><div class="informalexample"><pre class="programlisting">&lt;host name="master" &gt;</pre></div><p>Then let's set the server group and server. Because we don't need to use main-server-group and its servers in this chapter, it's better to turn them off to save some system resources. Open <code class="literal">host.xml</code> and set the <code class="literal">auto-start</code> option of <span class="strong"><strong>server-one</strong></span> and <span class="strong"><strong>server-two</strong></span> to <code class="literal">false</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server name="server-one" group="main-server-group" auto-start="false"&gt;...
&lt;server name="server-two" group="main-server-group" auto-start="false"&gt;...</pre></div><p>The next<a id="id158" class="indexterm"/> time we start the EAP6 in the domain mode, these two servers won't start. Then let's rename <code class="literal">server-three</code> as <code class="literal">master-server</code> and set its <code class="literal">auto-start</code> to <code class="literal">true</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server name="master-server" group="other-server-group" auto-start="true"&gt;
  &lt;socket-bindings port-offset="250"/&gt;
&lt;/server&gt;</pre></div><p>Please note that the port offset of <code class="literal">master-server</code> is <code class="literal">250</code>, and we'll use it to calculate the serving ports of <code class="literal">master-server</code>. The next thing we should do is to change the binding addresses of multiple sockets to public IP addresses. Because we'll use two EAP6 servers on two different machines to form a server group, we need to bind sockets to proper addresses to make sure they can communicate with each other.</p><div class="informalexample"><pre class="programlisting">&lt;interfaces&gt;
  &lt;interface name="management"&gt;
  &lt;inet-address value="${jboss.bind.address.management:10.0.1.13}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="public"&gt;
    &lt;inet-address value="${jboss.bind.address:10.0.1.13}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="unsecure"&gt;
  &lt;inet-address value="${jboss.bind.address.unsecure:10.0.1.13}"/&gt;
  &lt;/interface&gt;
&lt;/interfaces&gt;</pre></div><p>Please note that the <span class="strong"><strong>slave</strong></span> server will connect to the master's management interface to accept its management, so it should also be bound to public address as shown in the previous code snippet. We'll cover <span class="strong"><strong>slave</strong></span> configuration in later sections.</p><p>The public address here means the IP address other than the loopback address. It should be an internal IP address only accessible from LAN. In a real-world scenario, the management interface won't be public. They would use only an internal network because of security reasons. So we usually put all the EAP6 servers in a LAN, and only open the load balancer to the public, and let it proxy user requests to the internal network. We'll discuss this in the next chapter.</p></div><div class="section" title="Adding a user account for slave server"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec05"/>Adding a user account for slave server</h4></div></div></div><p>The two servers (master-server and slave-server) will be managed by the domain, and we need to <a id="id159" class="indexterm"/>use host controllers to connect to the domain. The communication between the two host controllers needs to be authenticated. If slave-server wants to connect to the domain controller, we need to set up a user account for the connection, which is enforced by the security requirement of JBoss EAP6.</p><p>We'll use <code class="literal">add-user.sh</code> in the <code class="literal">bin</code> directory to create a user for slave. The process is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2432_03_09.jpg" alt="Adding a user account for slave server"/></div><p>The following is the summary of the user we've created:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The type of user is <span class="strong"><strong>Management User</strong></span></li><li class="listitem" style="list-style-type: disc">The user name is <span class="strong"><strong>slave</strong></span></li><li class="listitem" style="list-style-type: disc">The user password is set to <span class="strong"><strong>@packt000</strong></span></li><li class="listitem" style="list-style-type: disc">The user belongs to <span class="strong"><strong>ManagementRealm</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Is this new user going to be used for one AS process to connect to another AS process</strong></span> is set to <span class="strong"><strong>yes</strong></span></li></ul></div><p>The last point is important; we have set this user to be used for the AS process connection, and a secret value is generated for this user:</p><div class="informalexample"><pre class="programlisting">&lt;secret value="QHBhY2t0MDAw" /&gt;</pre></div><p>This is the secret value that we'll need for <code class="literal">slave-server</code> to connect to <code class="literal">master-server</code>. We need to enter <a id="id160" class="indexterm"/>this secret value into <span class="strong"><strong>slave</strong></span> EAP6<a id="id161" class="indexterm"/>. Another important thing is that the username here must be the same as the <code class="literal">name</code> attribute in <code class="literal">host.xml</code> of <span class="strong"><strong>slave</strong></span> EAP6. If you don't follow this rule, you will receive the following error message when you try to start EAP6 on <span class="strong"><strong>slave</strong></span>:</p><div class="informalexample"><pre class="programlisting">    [Host Controller] 22:31:40,341 DEBUG [org.jboss.remoting.remote.client] (Remoting "slave:MANAGEMENT" read-1) Client received authentication rejected for mechanism DIGEST-MD5
    [Host Controller] 22:31:40,344 ERROR [org.jboss.remoting.remote.connection] (Remoting "slave:MANAGEMENT" read-1) JBREM000200: Remote connection failed: javax.security.sasl.SaslException: Authentication failed: all available authentication mechanisms failed</pre></div><p>So this rule is enforced by EAP6.</p></div><div class="section" title="Setting up HornetQ"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec06"/>Setting up HornetQ</h4></div></div></div><p>There <a id="id162" class="indexterm"/>is<a id="id163" class="indexterm"/> one more step to configure the <span class="strong"><strong>master</strong></span> server. Open <code class="literal">domain.xml</code> and find the security setting of <span class="strong"><strong>HornetQ</strong></span>:</p><div class="informalexample"><pre class="programlisting">&lt;profile name="full-ha"&gt;
  &lt;subsystem &gt;
    &lt;hornetq-server&gt;
    &lt;cluster-password&gt;${jboss.messaging.cluster.password:CHANGE ME!!}
&lt;/cluster-password&gt;
...</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Both the <code class="literal">full-ha</code> and <code class="literal">full</code> profiles in <code class="literal">domain.xml</code> contains the settings of <code class="literal">hornetq-server</code>. Please make sure you are editing the configuration under the <code class="literal">full-ha</code> profile.</p></div></div><p>Change the preceding setting to the following:</p><div class="informalexample"><pre class="programlisting">&lt;hornetq-server&gt;
  &lt;cluster-user&gt;foo&lt;/cluster-password&gt;
  &lt;cluster-password&gt;bar&lt;/cluster-password&gt;
&lt;/hornetq-server&gt;</pre></div><p>If you feel this is not very useful, you can also disable it:</p><div class="informalexample"><pre class="programlisting">&lt;hornetq-server&gt;
  &lt;security-enabled&gt;false&lt;/security-enabled&gt;
&lt;/hornetq-server&gt;</pre></div><p>We won't cover the topics of HornetQ in this book. We just configure it properly to make sure the EAP6 server could start correctly.</p></div></div><div class="section" title="Setting up slave"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec12"/>Setting up slave</h3></div></div></div><p>Now let's <a id="id164" class="indexterm"/>configure EAP6 on <span class="strong"><strong>slave</strong></span>. Because it will accept the management from <span class="strong"><strong>master</strong></span> EAP6<a id="id165" class="indexterm"/>, <code class="literal">domain.xml</code> on this server becomes useless. We just need to configure <code class="literal">host.xml</code>. Now let's have a look at it.</p><div class="section" title="Configuring host.xml"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec07"/>Configuring host.xml</h4></div></div></div><p>Similar <a id="id166" class="indexterm"/>to the configuration on <span class="strong"><strong>master</strong></span> EAP6, we first need to configure the name of the host:</p><div class="informalexample"><pre class="programlisting">&lt;host name="slave" &gt;</pre></div><p>As noted in the <span class="emphasis"><em>Configuring host.xml</em></span> section of <span class="emphasis"><em>Setting up a master</em></span>, the name here must be the same as the username of the account we have added in <span class="strong"><strong>master</strong></span> EAP6. Then we need to assign the secret value to <code class="literal">ManagementRealm</code>:</p><div class="informalexample"><pre class="programlisting">&lt;security-realm name="ManagementRealm"&gt;
  &lt;server-identities&gt;
    &lt;secret value="QHBhY2t0MDAw"/&gt;
  &lt;/server-identities&gt;
  ...
&lt;/security-realm name="ManagementRealm"&gt;</pre></div><p>Then host controller of <span class="strong"><strong>slave</strong></span> will use this secret value for authentication. The next step is to set up <code class="literal">domain-controller</code>:</p><div class="informalexample"><pre class="programlisting">&lt;domain-controller&gt;
  &lt;remote host="10.0.1.13" port="9999" security-realm="ManagementRealm"/&gt;
&lt;/domain-controller&gt;</pre></div><p>As shown before, the <span class="strong"><strong>slave</strong></span> EAP6 will connect to the <span class="strong"><strong>master</strong></span> EAP6 and use it as the domain controller.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>Remember that <code class="literal">10.0.1.13</code> is the IP address of <span class="strong"><strong>master</strong></span>, while <code class="literal">10.0.1.19</code> is the address of <span class="strong"><strong>slave</strong></span>.</p></div></div><p>The next step is to bind the interfaces of <span class="strong"><strong>slave</strong></span> EAP6 to proper IP addresses so that the <span class="strong"><strong>master</strong></span> EAP6 can communicate with it:</p><div class="informalexample"><pre class="programlisting">&lt;interfaces&gt;
  &lt;interface name="management"&gt;
    &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="public"&gt;
    &lt;inet-address value="${jboss.bind.address:10.0.1.19}"/&gt;
  &lt;/interface&gt;
  &lt;interface name="unsecure"&gt;
    &lt;inet-address value="${jboss.bind.address.unsecure:10.0.1.19}"/&gt;
  &lt;/interface&gt;
&lt;/interfaces&gt;</pre></div><p>Please note<a id="id167" class="indexterm"/> that we didn't change the binding for the <code class="literal">management</code> interface. Because the domain controller will undertake the management work, the local management on <span class="strong"><strong>slave</strong></span> won't be used. So let's just leave it unchanged.</p><p>Next we also turn off <code class="literal">server-one</code> and <code class="literal">server-two</code> to save some resources:</p><div class="informalexample"><pre class="programlisting">&lt;server name="server-one" group="main-server-group" auto-start="false"&gt;
&lt;server name="server-two" group="main-server-group" auto-start="false"&gt;</pre></div><p>Finally let's rename <code class="literal">server-three</code> as <code class="literal">slave-server</code> and set <code class="literal">auto-start</code> to <code class="literal">true</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server name="slave-server" group="other-server-group" auto-start="true"&gt;</pre></div><p>That's all we need to configure for slave EAP6.</p></div><div class="section" title="Configuring domain.xml on slave"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl4sec08"/>Configuring domain.xml on slave</h4></div></div></div><p>The<a id="id168" class="indexterm"/> <code class="literal">domain.xml</code> on <span class="strong"><strong>slave</strong></span> EAP6 is not used because the <span class="strong"><strong>master</strong></span> EAP6 is acting as a domain controller and it will take the management tasks.</p></div></div></div></div>
<div class="section" title="Testing the server group"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Testing the server group</h1></div></div></div><p>Now that<a id="id169" class="indexterm"/> we have properly set up the <span class="strong"><strong>master</strong></span> and <span class="strong"><strong>slave</strong></span> EAP6, it's time to run them for testing.</p><div class="section" title="Running master"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec32"/>Running master</h2></div></div></div><p>First<a id="id170" class="indexterm"/> let's run the following command on <span class="strong"><strong>master</strong></span> EAP6:</p><div class="informalexample"><pre class="programlisting">$ ./domain.sh</pre></div><p>After the master server starts, let's check the server output shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2432_03_10.jpg" alt="Running master"/></div><p>In the preceding screenshot we can see that <code class="literal">master-server</code> has started. Then we can see that the management<a id="id171" class="indexterm"/> interface and admin console have also started. The log output is shown in the following screenshot.</p><div class="mediaobject"><img src="graphics/2432_03_11.jpg" alt="Running master"/></div><p>Now we can see that the multiple components related with cluster have started:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The JGroups subsystem has started.</li><li class="listitem" style="list-style-type: disc">The AJP connector has started. Load balancers will use it for proxy requests. We'll cover this topic in the next chapter.</li><li class="listitem" style="list-style-type: disc">The HTTP connector has started. Because the port offset for <code class="literal">master-server</code> is <code class="literal">250</code> and the HTTP port is bound to <code class="literal">8080</code>, 8080+250 = <code class="literal">8330</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">mod_cluster</code> has started. We'll learn about <code class="literal">mod_cluster</code> in <a class="link" href="ch05.html" title="Chapter 5. Load Balancing with mod_cluster">Chapter 5</a>, <span class="emphasis"><em>Load Balancing with mod_cluster</em></span>.</li></ul></div><p>The described process is shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2432_03_12.jpg" alt="Running master"/></div></div><div class="section" title="Running slave"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec33"/>Running slave</h2></div></div></div><p>Now let's start<a id="id172" class="indexterm"/> the <span class="strong"><strong>slave</strong></span> server by using <code class="literal">domain.sh</code>. Its host controller will try to connect to the remote domain controller on <span class="strong"><strong>master</strong></span>. After the <span class="strong"><strong>slave</strong></span> server starts, we could check the console output from <span class="strong"><strong>master</strong></span> EAP6 to confirm that the <span class="strong"><strong>slave</strong></span> has been registered:</p><div class="informalexample"><pre class="programlisting">[Host Controller] 01:22:48,527 INFO  [org.jboss.as.domain] (slave-request-threads - 1) JBAS010918: Registered remote slave host "slave", JBoss EAP 6.1.0.GA (AS 7.2.0.Final-redhat-8)</pre></div></div><div class="section" title="Checking the server status"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec34"/>Checking the server status</h2></div></div></div><p>Now let's<a id="id173" class="indexterm"/> access the web manage console on <span class="strong"><strong>master</strong></span> EAP6 at <code class="literal">http://master:9990</code>.</p><p>After logging in with the account <code class="literal">jbossadmin</code>, we can check the status of <code class="literal">master-server</code> and <code class="literal">slave-server</code>. Here is their status:</p><div class="mediaobject"><img src="graphics/2432_03_03.jpg" alt="Checking the server status"/></div><p>As shown in the screenshots, both <span class="strong"><strong>master</strong></span> and <span class="strong"><strong>slave</strong></span> are shown in the management console. That means the domain controller is managing all the servers. Now let's go to <span class="strong"><strong>slave</strong></span> and try to access its management console. The result is as follows:</p><div class="mediaobject"><img src="graphics/2432_03_05.jpg" alt="Checking the server status"/></div><p>We can see<a id="id174" class="indexterm"/> that <span class="strong"><strong>slave</strong></span> EAP6 is now under the management of the domain controller.</p></div></div>
<div class="section" title="Project deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Project deployment</h1></div></div></div><p>Now <a id="id175" class="indexterm"/>let's <a id="id176" class="indexterm"/>deploy <code class="literal">cluster-demo1</code> into <code class="literal">other-server-group</code>.</p><div class="section" title="Deploying a project to other-server-group"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Deploying a project to other-server-group</h2></div></div></div><p>In the<a id="id177" class="indexterm"/> previous chapter we already learned how to deploy a project into the server group, so I will briefly describe the process here:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Log in to the management console of <span class="strong"><strong>master</strong></span> EAP6.</li><li class="listitem">Click on <span class="strong"><strong>Manage Deployments</strong></span> in the sidebar.</li><li class="listitem">Click on <span class="strong"><strong>Add</strong></span> under the <span class="strong"><strong>Content Repository</strong></span> tab and add <span class="strong"><strong>cluster-demo1.war</strong></span>.</li><li class="listitem">Follow the instructions and save the deployment.</li><li class="listitem">Click on the <span class="strong"><strong>Server Groups</strong></span> tab.</li><li class="listitem">Click on <span class="strong"><strong>View</strong></span> of <span class="strong"><strong>other-server-group</strong></span>.</li><li class="listitem">Click on <span class="strong"><strong>Assign</strong></span> and select <span class="strong"><strong>cluster-demo1.war</strong></span>.</li><li class="listitem">Save the deployment and click on <span class="strong"><strong>En/Disable</strong></span> to start the <span class="strong"><strong>cluster-demo1.war</strong></span> file.</li></ol></div><p>If everything goes fine, you should see the server output from both <span class="strong"><strong>master</strong></span> and <span class="strong"><strong>slave</strong></span>. The following is the output on master:</p><div class="informalexample"><pre class="programlisting">[Server:master-server] 23:31:58,223 INFO  [org.jboss.as.server] (host-controller-connection-threads - 3) JBAS018559: Deployed "cluster-demo1.war" (runtime-name : "cluster-demo1.war")</pre></div><p>The following is the output on <span class="strong"><strong>slave</strong></span>:</p><div class="informalexample"><pre class="programlisting">[Server:slave-server] 23:31:58,246 INFO  [org.jboss.as.server] (host-controller-connection-threads - 3) JBAS018559: Deployed "cluster-demo1.war" (runtime-name : "cluster-demo1.war")</pre></div><p>With<a id="id178" class="indexterm"/> the help of the domain mode, the project is deployed into two servers that belong to the same group. Now we can verify that the project has been deployed to these two servers by using <span class="strong"><strong>cURL</strong></span>:</p><div class="mediaobject"><img src="graphics/2432_03_13.jpg" alt="Deploying a project to other-server-group"/></div></div><div class="section" title="Clustering with the standalone mode"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Clustering with the standalone mode</h2></div></div></div><p>In the preceding <a id="id179" class="indexterm"/>sections we saw that the domain mode provides us a central place to manage our servers. The question is, do we need to use the domain mode to build an EAP6 cluster? The answer is, not necessarily.</p><p>Using the standalone mode to build a cluster is perfectly fine. We just need to enable the relative subsystems<a id="id180" class="indexterm"/> that are needed for building the cluster. And EAP6 has provided us a set of configurations in the standalone mode. The <code class="literal">*-ha.xml</code> files contain the profiles for clustering. We can use them during the startup. The following is the command:</p><div class="informalexample"><pre class="programlisting">$ ./standalone.sh -c standalone-full-ha.xml</pre></div><p>Here are some disadvantages of using the standalone mode in the clustering environment:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We have to configure each EAP6 server separately</li><li class="listitem" style="list-style-type: disc">There is no centralized point to manage these servers</li></ul></div><p>That means we must deploy the project to each EAP6 server separately, and make sure they are in sync during redeployment. In addition, if we run multiple standalone EAP6 servers on the same machine, we have to carefully set the offset for all the ports to prevent them from conflicting with one another. Apart from these disadvantages, there are some advantages of the standalone mode for clustering:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can configure each server independently. For example, we can turn off the HornetQ subsystem on server A, and enable it on servers B and C.</li><li class="listitem" style="list-style-type: disc">The server running in the standalone mode can be debugged easily. In the domain mode, EAP6 will spawn multiple processes: a process-controller process, a host-controller process, and multiple server processes (each server instance runs in its own JVM space), and it will add some difficulties for debugging.</li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Summary</h1></div></div></div><p>In this chapter we have looked at the configuration of the EAP6 cluster, and we have set up two EAP6 servers running in the domain mode to form a server group. Nevertheless, we haven't finished all the work of building a cluster: Now we have two EAP6 servers running independently, and we still need a load balancer to dispatch user requests to these two servers. In the next chapter, let's focus on setting up a load balancer.</p></div></body></html>