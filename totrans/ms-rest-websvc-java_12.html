<html><head></head><body>
  <div id="_idContainer083">
   <h1 class="chapterNumber">
    <a id="_idTextAnchor240">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     9
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-226">
    <a id="_idTextAnchor241">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Monitoring and Observability
    </span>
   </h1>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.3.1">
      Monitoring
     </span>
    </strong>
    <span class="koboSpan" id="kobo.4.1">
     and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.5.1">
      observability
     </span>
    </strong>
    <span class="koboSpan" id="kobo.6.1">
     are fundamental to ensuring that RESTful services operate reliably, efficiently, and securely.
    </span>
    <span class="koboSpan" id="kobo.6.2">
     In distributed systems, where requests often pass through multiple services
    </span>
    <a id="_idIndexMarker686">
    </a>
    <span class="koboSpan" id="kobo.7.1">
     and components, having proper observability practices in place is critical.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     Without them, diagnosing performance bottlenecks, identifying the root causes of errors, and optimizing
    </span>
    <a id="_idIndexMarker687">
    </a>
    <span class="koboSpan" id="kobo.8.1">
     service behavior becomes incredibly challenging.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.9.1">
     In this chapter, we will guide you through the essential practices and tools needed to achieve effective observability for RESTful services.
    </span>
    <span class="koboSpan" id="kobo.9.2">
     We will begin by discussing
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.10.1">
      logging
     </span>
    </strong>
    <span class="koboSpan" id="kobo.11.1">
     best practices, explaining how structured logging and correlation IDs can simplify troubleshooting.
    </span>
    <span class="koboSpan" id="kobo.11.2">
     We will then delve into distributed tracing, demonstrating how trace information such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.12.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.13.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.14.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.15.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.16.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.17.1">
     helps map the lifecycle of a request as it flows across multiple services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.18.1">
     We will introduce
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.19.1">
      Micrometer Tracing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     , a powerful
    </span>
    <a id="_idIndexMarker688">
    </a>
    <span class="koboSpan" id="kobo.21.1">
     observability framework integrated into Spring Boot 3.x, which automatically instruments applications to capture trace data.
    </span>
    <span class="koboSpan" id="kobo.21.2">
     Additionally, we will explore OpenTelemetry, a vendor-neutral framework that extends observability by collecting and correlating logs, metrics, and traces for a holistic view of distributed systems.
    </span>
    <span class="koboSpan" id="kobo.21.3">
     By the end of this chapter, you will understand how to implement logging and tracing effectively, configure Spring Boot applications for observability, and visualize your data in tools like Zipkin and Jaeger.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.22.1">
     This chapter provides practical examples, step-by-step guidance, and best practices to ensure you can successfully monitor and debug your RESTful services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.23.1">
     In this chapter, we will be covering the following topics:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.24.1">
      Importance of logging in REST APIs
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.25.1">
      Logging best practices for API troubleshooting
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.26.1">
      Logging basics with SLF4J
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.27.1">
      Implementing a central logging filter
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.28.1">
      Implementing service tracing in distributed systems
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.29.1">
      Implementing tracing using Micrometer
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.30.1">
      Metrics from tracing data
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.31.1">
      OpenTelemetry for monitoring and observability
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.32.1">
      Best practices for end-to-end observability
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-227">
    <a id="_idTextAnchor242">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.34.1">
     In this chapter, we will enhance our existing APIs—the Product API and the Order Management API—to be able to trace requests between them.
    </span>
    <span class="koboSpan" id="kobo.34.2">
     To be able to follow along and use the code examples as they are printed in the book, you should have the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.35.1">
      Intermediate knowledge of the Java language and platform
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.36.1">
      At least a basic knowledge of Spring Boot or a similar framework
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.37.1">
      Java 21 and Maven 3.9.0 installed
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.38.1">
      Docker 27.3.1 or higher installed
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.39.1">
     You can access the code for this chapter on GitHub at
    </span>
    <a href="https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter9">
     <span class="url">
      <span class="koboSpan" id="kobo.40.1">
       https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter9
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.41.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-228">
    <span class="koboSpan" id="kobo.42.1">
     Importance of logging in REST AP
    </span>
    <a id="_idTextAnchor243">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     Is
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.44.1">
     Logging is the foundational element of observability in any system.
    </span>
    <span class="koboSpan" id="kobo.44.2">
     Logs are essentially records of
    </span>
    <a id="_idIndexMarker689">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     events that happen while your application runs.
    </span>
    <span class="koboSpan" id="kobo.45.2">
     They are the first source of information when trying to troubleshoot an issue in any environment, especially in production.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.46.1">
     Logs act as
    </span>
    <a id="_idIndexMarker690">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     the system’s memory, providing insights into what went wrong or how certain processes behaved.
    </span>
    <span class="koboSpan" id="kobo.47.2">
     For a REST API, logs can show the path of each request, which is crucial for understanding failures or slow performance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.48.1">
     For instance, suppose your API returns a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.49.1">
      500
     </span>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.50.1">
      Internal Server Error
     </span>
    </code>
    <span class="koboSpan" id="kobo.51.1">
     to a user.
    </span>
    <span class="koboSpan" id="kobo.51.2">
     Without logs, you would have no way of knowing what caused the error.
    </span>
    <span class="koboSpan" id="kobo.51.3">
     However, with logs, you could see that a database query failed because the server ran out of connections, helping you fix the problem.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.52.1">
     In the next sections, we are going to cover an effective logging design that will empower our applications significantly when troubleshooting is needed.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-229">
    <a id="_idTextAnchor244">
    </a>
    <span class="koboSpan" id="kobo.53.1">
     Common logging pitfalls
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.54.1">
     Despite the
    </span>
    <a id="_idIndexMarker691">
    </a>
    <span class="koboSpan" id="kobo.55.1">
     importance of logging, many developers struggle with using logs effectively.
    </span>
    <span class="koboSpan" id="kobo.55.2">
     Common mistakes include:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.56.1">
       Over-logging
      </span>
     </strong>
     <span class="koboSpan" id="kobo.57.1">
      : Logging too much information can make it hard to find key details.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.58.1">
       Under-logging
      </span>
     </strong>
     <span class="koboSpan" id="kobo.59.1">
      : Insufficient logging might leave out key data needed for troubleshooting.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.60.1">
       Logging sensitive information
      </span>
     </strong>
     <span class="koboSpan" id="kobo.61.1">
      : Mistakenly logging things like user passwords or credit card numbers, which should never happen due to security and compliance concerns (e.g., GDPR or PCI DSS).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.62.1">
     A balance needs to be struck between logging enough to troubleshoot issues and not overwhelming the system with unnecessary data.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-230">
    <a id="_idTextAnchor245">
    </a>
    <span class="koboSpan" id="kobo.63.1">
     Effective log design
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.64.1">
     Designing logs
    </span>
    <a id="_idIndexMarker692">
    </a>
    <span class="koboSpan" id="kobo.65.1">
     properly is crucial for them to be useful.
    </span>
    <span class="koboSpan" id="kobo.65.2">
     Each log entry should include relevant metadata:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.66.1">
       Timestamp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.67.1">
      : When the log entry was created.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.68.1">
       Log level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.69.1">
      : Severity of the log (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.70.1">
       INFO
      </span>
     </code>
     <span class="koboSpan" id="kobo.71.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.72.1">
       DEBUG
      </span>
     </code>
     <span class="koboSpan" id="kobo.73.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.74.1">
       ERROR
      </span>
     </code>
     <span class="koboSpan" id="kobo.75.1">
      ).
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.76.1">
       Service name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.77.1">
      : The name of the service generating the log.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.78.1">
       Correlation ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.79.1">
      : A unique ID that allows you to track a request through multiple services (more on this below).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.80.1">
     For example, a well-structured log entry in JSON might look like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.81.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.82.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.83.1">timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.84.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.85.1">"2024-10-23T10:20:30Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.86.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.87.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.88.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.89.1">"ERROR"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.90.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.91.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.92.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.93.1">"user-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.94.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.95.1">"correlationId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.96.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.97.1">"abc123"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.98.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.99.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.100.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.101.1">"Database connection timed out"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.102.1">}</span></span>
</code></pre>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.103.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.104.1">
      Correlation IDs
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.105.1">
      In microservices, a request might pass through multiple services.
     </span>
     <span class="koboSpan" id="kobo.105.2">
      To track the entire request path, it is essential to attach a correlation ID to each request.
     </span>
     <span class="koboSpan" id="kobo.105.3">
      The correlation ID is a unique identifier that stays with the request as it moves through the system.
     </span>
     <span class="koboSpan" id="kobo.105.4">
      This allows you to correlate logs from different services to see how a single request was handled end to end.
     </span>
     <span class="koboSpan" id="kobo.105.5">
      For example, a user request to retrieve profile information might go through an API gateway, then hit the authentication service, and finally query the user database.
     </span>
     <span class="koboSpan" id="kobo.105.6">
      With a correlation ID, you can trace each step of the process across all services involved.
     </span>
     <span class="koboSpan" id="kobo.105.7">
      Spring makes it easy to generate and propagate correlation IDs.
     </span>
     <span class="koboSpan" id="kobo.105.8">
      You can generate a correlation ID at the start of a request and pass it along with HTTP headers between services.
     </span>
     <span class="koboSpan" id="kobo.105.9">
      This will help you diagnose where issues occur in a chain of services.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.106.1">
     Next, we will learn
    </span>
    <a id="_idIndexMarker693">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     about the best logging practices, understand the different log levels and their structure, and what should and should not be logged to avoid security issues.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-231">
    <a id="_idTextAnchor246">
    </a>
    <span class="koboSpan" id="kobo.108.1">
     Logging best practices for API troubleshooting
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.109.1">
     Effective logging is essential for troubleshooting, especially when working with distributed systems
    </span>
    <a id="_idIndexMarker694">
    </a>
    <span class="koboSpan" id="kobo.110.1">
     or cloud-native architectures.
    </span>
    <span class="koboSpan" id="kobo.110.2">
     Here are some best practices to ensure your logging strategy is robust.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-232">
    <a id="_idTextAnchor247">
    </a>
    <span class="koboSpan" id="kobo.111.1">
     Choosing the right log level
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.112.1">
     Logs should
    </span>
    <a id="_idIndexMarker695">
    </a>
    <span class="koboSpan" id="kobo.113.1">
     be written at the appropriate log level, which indicates the severity of the event:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.114.1">
       TRACE
      </span>
     </code>
     <span class="koboSpan" id="kobo.115.1">
      : Used for very fine-grained details, primarily for debugging low-level operations like recording the internal state of loops, method entry/exit points, or interactions between components in detail.
     </span>
     <span class="koboSpan" id="kobo.115.2">
      Should be turned off in production due to the huge amount of logs that are generated at this level.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.116.1">
       DEBUG
      </span>
     </code>
     <span class="koboSpan" id="kobo.117.1">
      : Used for low-level information that helps in debugging issues, such as details of an HTTP request.
     </span>
     <span class="koboSpan" id="kobo.117.2">
      Logs provide detailed information that helps during development or debugging, focusing on application-specific logic or operations.
     </span>
     <span class="koboSpan" id="kobo.117.3">
      Also, this level should be turned off in production due to the huge amount of logs that are generated at this level.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.118.1">
       INFO
      </span>
     </code>
     <span class="koboSpan" id="kobo.119.1">
      : Used for general application flow information, such as when a service starts up or shuts down.
     </span>
     <span class="koboSpan" id="kobo.119.2">
      These logs are less verbose than
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.120.1">
       DEBUG
      </span>
     </code>
     <span class="koboSpan" id="kobo.121.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.122.1">
       TRACE
      </span>
     </code>
     <span class="koboSpan" id="kobo.123.1">
      and are typically enabled in production.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.124.1">
       WARN
      </span>
     </code>
     <span class="koboSpan" id="kobo.125.1">
      : Indicates something unusual but not necessarily an error.
     </span>
     <span class="koboSpan" id="kobo.125.2">
      For example, a service might temporarily run out of resources but recover.
     </span>
     <span class="koboSpan" id="kobo.125.3">
      These logs are a warning for potential future issues.
     </span>
     <span class="koboSpan" id="kobo.125.4">
      For example:
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.126.1">
       ERROR
      </span>
     </code>
     <span class="koboSpan" id="kobo.127.1">
      : Used when something has gone wrong, like an exception being thrown or a critical failure in a database connection.
     </span>
     <span class="koboSpan" id="kobo.127.2">
      These logs often indicate that the system requires attention or intervention.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.128.1">
       FATAL
      </span>
     </code>
     <span class="koboSpan" id="kobo.129.1">
      : Indicates a critical error that causes the application or service to crash or become unusable.
     </span>
     <span class="koboSpan" id="kobo.129.2">
      These logs are extremely rare and signify the most severe issues that require immediate attention.
     </span>
     <span class="koboSpan" id="kobo.129.3">
      Note that this level is not present universally in libraries like SLF4J or Logback and is often represented by the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.130.1">
       ERROR
      </span>
     </code>
     <span class="koboSpan" id="kobo.131.1">
      level; however, it is present in Log4J and Log4J2 logging libraries, which will not be covered by this chapter.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.132.1">
     In a
    </span>
    <a id="_idIndexMarker696">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     REST API, a failed user login attempt due to incorrect credentials might be logged at the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.134.1">
      WARN
     </span>
    </code>
    <span class="koboSpan" id="kobo.135.1">
     level:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.136.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.137.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.138.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.139.1">"2024-10-23T11:15:30Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.140.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.141.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.142.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.143.1">"WARN"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.144.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.145.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.146.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.147.1">"auth-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.148.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.149.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.150.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.151.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.152.1">Failed login attempt for user john.doe@example.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.153.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.154.1">"error"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.155.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.156.1">"AuthenticationException"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.157.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.158.1">
     Meanwhile, a database outage that causes the entire service to fail should be logged at the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.159.1">
      ERROR
     </span>
    </code>
    <span class="koboSpan" id="kobo.160.1">
     level or as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.161.1">
      FATAL
     </span>
    </code>
    <span class="koboSpan" id="kobo.162.1">
     if available:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.163.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.164.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.165.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.166.1">"2024-10-23T11:20:30Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.167.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.168.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.169.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.170.1">"ERROR"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.171.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.172.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.173.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.174.1">"user-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.175.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.176.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.177.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.178.1">"Failed to connect to database"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.179.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.180.1">"error"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.181.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.182.1">"TimeoutException"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.183.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.184.1">
     Choosing the right level ensures that you can quickly filter out non-critical logs when troubleshooting.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-233">
    <a id="_idTextAnchor248">
    </a>
    <span class="koboSpan" id="kobo.185.1">
     Structured logging
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.186.1">
     Structured logging refers
    </span>
    <a id="_idIndexMarker697">
    </a>
    <span class="koboSpan" id="kobo.187.1">
     to logging in a consistent, machine-readable
    </span>
    <a id="_idIndexMarker698">
    </a>
    <span class="koboSpan" id="kobo.188.1">
     format, such as JSON.
    </span>
    <span class="koboSpan" id="kobo.188.2">
     This allows logs to be easily parsed and queried by logging tools (like ELK Stack or Splunk), making it easier to filter, aggregate, and analyze logs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.189.1">
     Rather than logging a simple message like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.190.1">User john.doe@example.com failed to log in
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.191.1">
     You should log the event in a structured format:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.192.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.193.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.194.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.195.1">"2024-10-23T12:00:00Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.196.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.197.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.198.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.199.1">"WARN"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.200.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.201.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.202.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.203.1">"auth-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.204.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.205.1">"user"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.206.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.207.1">"john.doe@example.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.208.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.209.1">"event"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.210.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.211.1">"login-failure"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.212.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.213.1">"reason"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.214.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.215.1">"incorrect-password"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.216.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.217.1">
     Now, you can
    </span>
    <a id="_idIndexMarker699">
    </a>
    <span class="koboSpan" id="kobo.218.1">
     easily search for all login failures or group them by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.219.1">
      user
     </span>
    </code>
    <span class="koboSpan" id="kobo.220.1">
     field.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-234">
    <a id="_idTextAnchor249">
    </a>
    <span class="koboSpan" id="kobo.221.1">
     Avoiding sensitive data in logs
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.222.1">
     Sensitive information such as passwords, credit card numbers, or personal identifiers should never be logged.
    </span>
    <span class="koboSpan" id="kobo.222.2">
     If this
    </span>
    <a id="_idIndexMarker700">
    </a>
    <span class="koboSpan" id="kobo.223.1">
     data is accidentally exposed in logs, it can lead to serious security breaches.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.224.1">
     For example, if a login attempt fails, it is okay to log the username, but never log the password.
    </span>
    <span class="koboSpan" id="kobo.224.2">
     A log message like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.225.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.226.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.227.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.228.1">"2024-10-23T12:05:00Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.229.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.230.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.231.1">level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.232.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.233.1">"ERROR"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.234.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.235.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.236.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.237.1">"Login failed for user john.doe@example.com with password 'secretpassword'"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.238.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.239.1">
     is dangerous.
    </span>
    <span class="koboSpan" id="kobo.239.2">
     Instead, log something like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.240.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.241.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.242.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.243.1">"2024-10-23T12:05:00Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.244.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.245.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.246.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.247.1">"ERROR"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.248.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.249.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.250.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.251.1">"Login failed for user john.doe@example.com"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.252.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.253.1">
     You can use Jackson’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.254.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.255.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.256.1">
      @JsonProperty(access = Access.WRITE_ONLY)
     </span>
    </code>
    <span class="koboSpan" id="kobo.257.1">
     annotations to prevent sensitive data from being serialized into logs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.258.1">
     Jackson is a widely used Java library for processing JSON data.
    </span>
    <span class="koboSpan" id="kobo.258.2">
     It provides powerful capabilities for serializing Java objects into JSON and deserializing JSON into Java objects, making it a crucial tool in RESTful web services where data is often exchanged in JSON format.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.259.1">
     In a Spring Boot application, Jackson is the default JSON processor and is commonly used to automatically transform request and response payloads, making API interactions seamless.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.260.1">
     It allows developers to customize JSON output using annotations like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.261.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.262.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.263.1">
      @JsonProperty
     </span>
    </code>
    <span class="koboSpan" id="kobo.264.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.265.1">
      @JsonInclude
     </span>
    </code>
    <span class="koboSpan" id="kobo.266.1">
     , ensuring that only the necessary fields are exposed while sensitive or unnecessary data is excluded.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.267.1">
     This is particularly
    </span>
    <a id="_idIndexMarker701">
    </a>
    <span class="koboSpan" id="kobo.268.1">
     useful when logging requests or response objects, as it ensures that sensitive information (like passwords or credit card details) does not get exposed in log entries.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.269.1">
     When to use each annotation?
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.270.1">
       @JsonIgnore
      </span>
     </code>
     <span class="koboSpan" id="kobo.271.1">
      : Use when you want to prevent a field from ever being included in serialized output, such as responses and logs, and deserialized input from requests.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.272.1">
       @JsonProperty(access = Access.WRITE_ONLY)
      </span>
     </code>
     <span class="koboSpan" id="kobo.273.1">
      : Use when you need to accept the field as input but want to exclude it from all serialized output, making it suitable for fields that should remain private (e.g., passwords) during logging or API responses.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.274.1">
     Let us go through an example to demonstrate how to use these annotations in a RESTful service.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.275.1">
     Suppose you have a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.276.1">
      User
     </span>
    </code>
    <span class="koboSpan" id="kobo.277.1">
     class with fields like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.278.1">
      username
     </span>
    </code>
    <span class="koboSpan" id="kobo.279.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.280.1">
      email
     </span>
    </code>
    <span class="koboSpan" id="kobo.281.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.282.1">
      password
     </span>
    </code>
    <span class="koboSpan" id="kobo.283.1">
     .
    </span>
    <span class="koboSpan" id="kobo.283.2">
     When logging this
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.284.1">
      User
     </span>
    </code>
    <span class="koboSpan" id="kobo.285.1">
     object, we want to ensure that the password field is not included in the serialized output.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-235">
    <a id="_idTextAnchor250">
    </a>
    <span class="koboSpan" id="kobo.286.1">
     Completely exclude the field from serialization/deserialization
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.287.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.288.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.289.1">
     annotation completely omits a field from deserialization and serialization, meaning
    </span>
    <a id="_idIndexMarker702">
    </a>
    <span class="koboSpan" id="kobo.290.1">
     it will not be included in the input or the output JSON at all.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.291.1">
     When you use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.292.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.293.1">
     on a field, it is completely ignored by Jackson both during serialization (when converting an object to JSON) and deserialization (when converting JSON to an object).
    </span>
    <span class="koboSpan" id="kobo.293.2">
     This means that if you mark a field with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.294.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.295.1">
     , Jackson will neither include it in the output JSON nor allow it as an input in the JSON request body.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.296.1">
     This is useful when you want to ensure that sensitive information (e.g., passwords or tokens) is never exposed in any serialized output, including logs.
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.297.1">import</span></span><span class="koboSpan" id="kobo.298.1"> com.</span><span class="hljs-property"><span class="koboSpan" id="kobo.299.1">fasterxml</span></span><span class="koboSpan" id="kobo.300.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.301.1">jackson</span></span><span class="koboSpan" id="kobo.302.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.303.1">annotation</span></span><span class="koboSpan" id="kobo.304.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.305.1">JsonIgnore</span></span><span class="koboSpan" id="kobo.306.1">;
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.307.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.308.1">User</span></span><span class="koboSpan" id="kobo.309.1"> {
         private </span><span class="hljs-title"><span class="koboSpan" id="kobo.310.1">String</span></span><span class="koboSpan" id="kobo.311.1"> username;
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.312.1">String</span></span><span class="koboSpan" id="kobo.313.1"> email;
         @</span><span class="hljs-title"><span class="koboSpan" id="kobo.314.1">JsonIgnore</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.315.1">// This will prevent the password from being</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.316.1">                     //serialized or deserialized into JSON</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.317.1">    private String password;</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.318.1">    // Constructors, getters, setters omitted for brevity</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.319.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.320.1">
     With
    </span>
    <a id="_idIndexMarker703">
    </a>
    <span class="koboSpan" id="kobo.321.1">
     this setup, if you log the User object using Jackson for serialization, the password field will be omitted:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.322.1">import</span></span><span class="koboSpan" id="kobo.323.1"> com.</span><span class="hljs-property"><span class="koboSpan" id="kobo.324.1">fasterxml</span></span><span class="koboSpan" id="kobo.325.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.326.1">jackson</span></span><span class="koboSpan" id="kobo.327.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.328.1">databind</span></span><span class="koboSpan" id="kobo.329.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.330.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.331.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.332.1">import</span></span><span class="koboSpan" id="kobo.333.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.334.1">slf4j</span></span><span class="koboSpan" id="kobo.335.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.336.1">Logger</span></span><span class="koboSpan" id="kobo.337.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.338.1">import</span></span><span class="koboSpan" id="kobo.339.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.340.1">slf4j</span></span><span class="koboSpan" id="kobo.341.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.342.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.343.1">;
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.344.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.345.1">UserService</span></span><span class="koboSpan" id="kobo.346.1"> {
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.347.1">static</span></span><span class="koboSpan" id="kobo.348.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.349.1">Logger</span></span><span class="koboSpan" id="kobo.350.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.351.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.352.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.353.1">getLogger</span></span><span class="koboSpan" id="kobo.354.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.355.1">UserService</span></span><span class="koboSpan" id="kobo.356.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.357.1">class</span></span><span class="koboSpan" id="kobo.358.1">);
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.359.1">static</span></span><span class="koboSpan" id="kobo.360.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.361.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.362.1"> objectMapper = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.363.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.364.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.365.1">();
    public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.366.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.367.1">logUserDetails</span></span><span class="koboSpan" id="kobo.368.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.369.1">User user</span></span><span class="koboSpan" id="kobo.370.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.371.1">try</span></span><span class="koboSpan" id="kobo.372.1"> {
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.373.1">String</span></span><span class="koboSpan" id="kobo.374.1"> userJson = objectMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.375.1">writeValueAsString</span></span><span class="koboSpan" id="kobo.376.1">(user);
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.377.1">info</span></span><span class="koboSpan" id="kobo.378.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.379.1">"User details: {}"</span></span><span class="koboSpan" id="kobo.380.1">, userJson);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.381.1">catch</span></span><span class="koboSpan" id="kobo.382.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.383.1">Exception</span></span><span class="koboSpan" id="kobo.384.1"> e) {
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.385.1">error</span></span><span class="koboSpan" id="kobo.386.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.387.1">"Error serializing user details"</span></span><span class="koboSpan" id="kobo.388.1">, e);
        }
    }
}
</span></code></pre>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.389.1">
      Output log (password is excluded)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.390.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.391.1">{</span></span>  <span class="hljs-attr"><span class="koboSpan" id="kobo.392.1">"username"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.393.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.394.1">"john.doe"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.395.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.396.1">"email"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.397.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.398.1">"john.doe@example.com"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.399.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.400.1">
     In this example, the
    </span>
    <a id="_idIndexMarker704">
    </a>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.401.1">
      password
     </span>
    </code>
    <span class="koboSpan" id="kobo.402.1">
     field is completely omitted from the log output because of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.403.1">
      @JsonIgnore
     </span>
    </code>
    <span class="koboSpan" id="kobo.404.1">
     annotation.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.405.1">
     Now that you know how to exclude fields from serialization and deserialization, let us see how to allow a field to be deserialized from JSON input but excluded from serialization, such as in logs or API responses.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-236">
    <a id="_idTextAnchor251">
    </a>
    <span class="koboSpan" id="kobo.406.1">
     Allowing data input deserialization but excluding it from output serialization
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.407.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.408.1">
      @JsonProperty(access = Access.WRITE_ONLY)
     </span>
    </code>
    <span class="koboSpan" id="kobo.409.1">
     annotation is useful when you want a field to
    </span>
    <a id="_idIndexMarker705">
    </a>
    <span class="koboSpan" id="kobo.410.1">
     be deserialized (e.g., when receiving input from a user) but not serialized (e.g., when logging or sending data as a response).
    </span>
    <span class="koboSpan" id="kobo.410.2">
     This is common for fields like passwords in user registration forms:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.411.1">import</span></span><span class="koboSpan" id="kobo.412.1"> com.</span><span class="hljs-property"><span class="koboSpan" id="kobo.413.1">fasterxml</span></span><span class="koboSpan" id="kobo.414.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.415.1">jackson</span></span><span class="koboSpan" id="kobo.416.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.417.1">annotation</span></span><span class="koboSpan" id="kobo.418.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.419.1">JsonProperty</span></span><span class="koboSpan" id="kobo.420.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.421.1">import</span></span><span class="koboSpan" id="kobo.422.1"> com.</span><span class="hljs-property"><span class="koboSpan" id="kobo.423.1">fasterxml</span></span><span class="koboSpan" id="kobo.424.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.425.1">jackson</span></span><span class="koboSpan" id="kobo.426.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.427.1">annotation</span></span><span class="koboSpan" id="kobo.428.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.429.1">JsonProperty</span></span><span class="koboSpan" id="kobo.430.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.431.1">Access</span></span><span class="koboSpan" id="kobo.432.1">;
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.433.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.434.1">User</span></span><span class="koboSpan" id="kobo.435.1"> {
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.436.1">String</span></span><span class="koboSpan" id="kobo.437.1"> username;
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.438.1">String</span></span><span class="koboSpan" id="kobo.439.1"> email;
         @</span><span class="hljs-title"><span class="koboSpan" id="kobo.440.1">JsonProperty</span></span><span class="koboSpan" id="kobo.441.1">(access = </span><span class="hljs-title"><span class="koboSpan" id="kobo.442.1">Access</span></span><span class="koboSpan" id="kobo.443.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.444.1">WRITE_ONLY</span></span><span class="koboSpan" id="kobo.445.1">)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.446.1">// Allows input but   </span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.447.1">                                       //prevents serialization into JSON</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.448.1">    private String password;</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.449.1">    // Constructors, getters, setters omitted for brevity</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.450.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.451.1">
     With
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.452.1">
      @JsonProperty(access = Access.WRITE_ONLY)
     </span>
    </code>
    <span class="koboSpan" id="kobo.453.1">
     , you can still accept the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.454.1">
      password
     </span>
    </code>
    <span class="koboSpan" id="kobo.455.1">
     field in incoming JSON requests, but it will be excluded from any serialized output, including logs.
    </span>
   </p>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.456.1">
      Example usage:
     </span>
    </strong>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.457.1">import</span></span><span class="koboSpan" id="kobo.458.1"> com.</span><span class="hljs-property"><span class="koboSpan" id="kobo.459.1">fasterxml</span></span><span class="koboSpan" id="kobo.460.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.461.1">jackson</span></span><span class="koboSpan" id="kobo.462.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.463.1">databind</span></span><span class="koboSpan" id="kobo.464.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.465.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.466.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.467.1">import</span></span><span class="koboSpan" id="kobo.468.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.469.1">slf4j</span></span><span class="koboSpan" id="kobo.470.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.471.1">Logger</span></span><span class="koboSpan" id="kobo.472.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.473.1">import</span></span><span class="koboSpan" id="kobo.474.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.475.1">slf4j</span></span><span class="koboSpan" id="kobo.476.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.477.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.478.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.479.1">import</span></span><span class="koboSpan" id="kobo.480.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.481.1">springframework</span></span><span class="koboSpan" id="kobo.482.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.483.1">web</span></span><span class="koboSpan" id="kobo.484.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.485.1">bind</span></span><span class="koboSpan" id="kobo.486.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.487.1">annotation</span></span><span class="koboSpan" id="kobo.488.1">.*;
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.489.1">RestController</span></span><span class="koboSpan" id="kobo.490.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.491.1">RequestMapping</span></span><span class="koboSpan" id="kobo.492.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.493.1">"/users"</span></span><span class="koboSpan" id="kobo.494.1">)
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.495.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.496.1">UserController</span></span><span class="koboSpan" id="kobo.497.1"> {
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.498.1">static</span></span><span class="koboSpan" id="kobo.499.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.500.1">Logger</span></span><span class="koboSpan" id="kobo.501.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.502.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.503.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.504.1">getLogger</span></span><span class="koboSpan" id="kobo.505.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.506.1">UserController</span></span><span class="koboSpan" id="kobo.507.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.508.1">class</span></span><span class="koboSpan" id="kobo.509.1">);
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.510.1">static</span></span><span class="koboSpan" id="kobo.511.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.512.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.513.1"> objectMapper = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.514.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.515.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.516.1">();
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.517.1">PostMapping</span></span><span class="koboSpan" id="kobo.518.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.519.1">"/register"</span></span><span class="koboSpan" id="kobo.520.1">)
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.521.1">String</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.522.1">registerUser</span></span><span class="koboSpan" id="kobo.523.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.524.1">@RequestBody User user</span></span><span class="koboSpan" id="kobo.525.1">) {
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.526.1">// Log user details without exposing password</span></span>
        <span class="hljs-keyword"><span class="koboSpan" id="kobo.527.1">try</span></span><span class="koboSpan" id="kobo.528.1"> {
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.529.1">String</span></span><span class="koboSpan" id="kobo.530.1"> userJson = objectMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.531.1">writeValueAsString</span></span><span class="koboSpan" id="kobo.532.1">(user);
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.533.1">info</span></span><span class="koboSpan" id="kobo.534.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.535.1">"Received user registration request: {}"</span></span><span class="koboSpan" id="kobo.536.1">,
                         userJson);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.537.1">catch</span></span><span class="koboSpan" id="kobo.538.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.539.1">Exception</span></span><span class="koboSpan" id="kobo.540.1"> e) {
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.541.1">error</span></span><span class="koboSpan" id="kobo.542.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.543.1">"Error serializing user details"</span></span><span class="koboSpan" id="kobo.544.1">, e);
        }
                 </span><span class="hljs-comment"><span class="koboSpan" id="kobo.545.1">// Proceed with user registration logic</span></span>
        <span class="hljs-keyword"><span class="koboSpan" id="kobo.546.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.547.1">"User registered successfully!"</span></span><span class="koboSpan" id="kobo.548.1">;
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.549.1">
     When a
    </span>
    <a id="_idIndexMarker706">
    </a>
    <span class="koboSpan" id="kobo.550.1">
     new user registration request comes in, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.551.1">
      password
     </span>
    </code>
    <span class="koboSpan" id="kobo.552.1">
     field will be available for processing, but it will not be logged.
    </span>
   </p>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.553.1">
      Incoming request
     </span>
    </strong>
    <span class="koboSpan" id="kobo.554.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.555.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.556.1">"username"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.557.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.558.1">"john.doe"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.559.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.560.1">"email"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.561.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.562.1">"john.doe@example.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.563.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.564.1">"password"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.565.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.566.1">"mysecretpassword"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.567.1">}</span></span>
</code></pre>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.568.1">
      Output log (password is excluded from the log)
     </span>
    </strong>
    <span class="koboSpan" id="kobo.569.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.570.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.571.1">"username"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.572.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.573.1">"john.doe"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.574.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.575.1">"email"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.576.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.577.1">"john.doe@example.com"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.578.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.579.1">
     With
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.580.1">
      @JsonProperty(access = Access.WRITE_ONLY)
     </span>
    </code>
    <span class="koboSpan" id="kobo.581.1">
     , the password is received by the application but is excluded from logs or other serialized JSON output, ensuring that sensitive data is protected.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.582.1">
     By using these annotations strategically, you can control sensitive data exposure in logs, which is an essential part of security best practices for RESTful APIs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.583.1">
     Now, let’s get back to the last best practice for logging
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-237">
    <a id="_idTextAnchor252">
    </a>
    <span class="koboSpan" id="kobo.584.1">
     Capturing contextual information
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.585.1">
     To make logs more useful, include contextual information about each request, such as:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.586.1">
      HTTP method (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.587.1">
       GET
      </span>
     </code>
     <span class="koboSpan" id="kobo.588.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.589.1">
       POST
      </span>
     </code>
     <span class="koboSpan" id="kobo.590.1">
      , etc.)
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.591.1">
      Endpoint (e.g.,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.592.1">
       /api/v1/users/123
      </span>
     </code>
     <span class="koboSpan" id="kobo.593.1">
      )
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.594.1">
      Response status (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.595.1">
       200
      </span>
     </code>
     <span class="koboSpan" id="kobo.596.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.597.1">
       404
      </span>
     </code>
     <span class="koboSpan" id="kobo.598.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.599.1">
       500
      </span>
     </code>
     <span class="koboSpan" id="kobo.600.1">
      , etc.)
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.601.1">
      Request headers and payloads (but be careful to exclude sensitive data)
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.602.1">
     This information
    </span>
    <a id="_idIndexMarker707">
    </a>
    <span class="koboSpan" id="kobo.603.1">
     will allow you to better understand what happened during an API request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.604.1">
     For example, a request log might look like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.605.1">{</span></span>   <span class="hljs-attr"><span class="koboSpan" id="kobo.606.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.607.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.608.1">"2024-10-23T12:10:00Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.609.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.610.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.611.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.612.1">"INFO"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.613.1">,</span></span>   <span class="hljs-attr"><span class="koboSpan" id="kobo.614.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.615.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.616.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.617.1">user-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.618.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.619.1">"method"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.620.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.621.1">"GET"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.622.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.623.1">"endpoint"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.624.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.625.1">"/api/v1/users/123"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.626.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.627.1">"status"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.628.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.629.1">200</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.630.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.631.1">
     By capturing such details, you can correlate issues with specific requests and quickly pinpoint where things went wrong.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.632.1">
     Next, we will dive into one of the most famous logging libraries in the market, SLF4J, and how to create logs from our application.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-238">
    <a id="_idTextAnchor253">
    </a>
    <span class="koboSpan" id="kobo.633.1">
     Logging basics with SLF4J
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.634.1">
     This section introduces how to add logging points into your own Java code using SLF4J.
    </span>
    <span class="koboSpan" id="kobo.634.2">
     This is crucial since
    </span>
    <a id="_idIndexMarker708">
    </a>
    <span class="koboSpan" id="kobo.635.1">
     you need to add loggers throughout your entire application to be able to generate logs from its flow that will help you troubleshoot it when it is deployed, especially in production.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.636.1">
     In Spring Boot, SLF4J (Simple Logging Facade for Java) is commonly used as a logging API that can work
    </span>
    <a id="_idIndexMarker709">
    </a>
    <span class="koboSpan" id="kobo.637.1">
     with different logging frameworks (such as Logback, Log4j2, etc.).
    </span>
    <span class="koboSpan" id="kobo.637.2">
     Spring Boot uses SLF4J by default and integrates it seamlessly, so all we need to do is inject the logger and start logging messages.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.638.1">
     Also, if you are not using Spring Boot, you can just add the SLF4J dependency to your Maven POM dependencies file or Gradle dependencies file to use it if the framework that you are using does not already include it.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.639.1">
     Let us start with a simple example of how to log a Spring Boot application using SLF4J.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     Here is a User Creation service that uses SLF4J to log messages at different log levels (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.640.1">
      INFO
     </span>
    </code>
    <span class="koboSpan" id="kobo.641.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.642.1">
      WARN
     </span>
    </code>
    <span class="koboSpan" id="kobo.643.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.644.1">
      ERROR
     </span>
    </code>
    <span class="koboSpan" id="kobo.645.1">
     ):
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.646.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.647.1">Service</span></span><span class="koboSpan" id="kobo.648.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.649.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.650.1">UserService</span></span><span class="koboSpan" id="kobo.651.1"> {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.652.1">// Initialize the logger</span></span><span class="koboSpan" id="kobo.653.1">
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.654.1">static</span></span><span class="koboSpan" id="kobo.655.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.656.1">Logger</span></span><span class="koboSpan" id="kobo.657.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.658.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.659.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.660.1">getLogger</span></span><span class="koboSpan" id="kobo.661.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.662.1">UserService</span></span><span class="koboSpan" id="kobo.663.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.664.1">class</span></span><span class="koboSpan" id="kobo.665.1">);
    public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.666.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.667.1">createUser</span></span><span class="koboSpan" id="kobo.668.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.669.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.670.1"> username</span></span><span class="koboSpan" id="kobo.671.1">) {
        logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.672.1">info</span></span><span class="koboSpan" id="kobo.673.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.674.1">"Creating a new user with username: {}"</span></span><span class="koboSpan" id="kobo.675.1">, username);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.676.1">try</span></span><span class="koboSpan" id="kobo.677.1"> {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.678.1">// Simulate some business logic</span></span>
            <span class="hljs-keyword"><span class="koboSpan" id="kobo.679.1">if</span></span><span class="koboSpan" id="kobo.680.1"> (username == </span><span class="hljs-literal"><span class="koboSpan" id="kobo.681.1">null</span></span><span class="koboSpan" id="kobo.682.1">) {
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.683.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.684.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.685.1">IllegalArgumentException</span></span><span class="koboSpan" id="kobo.686.1">(
</span><span class="hljs-keyword">                    </span><span class="hljs-string"><span class="koboSpan" id="kobo.687.1">"Username cannot be null"</span></span><span class="koboSpan" id="kobo.688.1">);
            }
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.689.1">// Simulate a successful operation</span></span><span class="koboSpan" id="kobo.690.1">
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.691.1">info</span></span><span class="koboSpan" id="kobo.692.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.693.1">"User {} created successfully"</span></span><span class="koboSpan" id="kobo.694.1">, username);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.695.1">catch</span></span><span class="koboSpan" id="kobo.696.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.697.1">Exception</span></span><span class="koboSpan" id="kobo.698.1"> e) {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.699.1">// Log the exception as an error</span></span><span class="koboSpan" id="kobo.700.1">
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.701.1">error</span></span><span class="koboSpan" id="kobo.702.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.703.1">"Error creating user: {}"</span></span><span class="koboSpan" id="kobo.704.1">, e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.705.1">getMessage</span></span><span class="koboSpan" id="kobo.706.1">(), e);
        }
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.707.1">
     In this
    </span>
    <a id="_idIndexMarker710">
    </a>
    <span class="koboSpan" id="kobo.708.1">
     example:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.709.1">
      We log informational messages with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.710.1">
       logger.info()
      </span>
     </code>
     <span class="koboSpan" id="kobo.711.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.712.1">
      We log an error with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.713.1">
       logger.error()
      </span>
     </code>
     <span class="koboSpan" id="kobo.714.1">
      , including the exception stack trace.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.715.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.716.1">
       LoggerFactory.getLogger(UserService.class)
      </span>
     </code>
     <span class="koboSpan" id="kobo.717.1">
      creates a logger specifically for the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.718.1">
       UserService
      </span>
     </code>
     <span class="koboSpan" id="kobo.719.1">
      class.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.720.1">
     For successful user creation, we would have a log output like this:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.721.1">2024-10-23T12:00:00.123 INFO  [UserService] Creating a new user with username: john_doe
2024-10-23T12:00:00.456 INFO  [UserService] User john_doe created successfully
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.722.1">
     Or, for a failed user creation, for example, trying to create a null user, the output would be:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.723.1">2024-10-23T12:01:00.123 INFO  [UserService] Creating a new user with username: null
2024-10-23T12:01:00.125 ERROR [UserService] Error creating user: Username cannot be null
java.lang.IllegalArgumentException: Username cannot be null
    at com.example.service.UserService.createUser(UserService.java:12)...
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.724.1">
     Using SLF4J
    </span>
    <a id="_idIndexMarker711">
    </a>
    <span class="koboSpan" id="kobo.725.1">
     with different log levels helps organize and filter log messages, making it easier to troubleshoot and debug.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.726.1">
     In the next section, let us look at how we can automate some of the logging in our application to reduce the burden of having tons of logging everywhere in your code, by implementing a central logging filter.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-239">
    <a id="_idTextAnchor254">
    </a>
    <span class="koboSpan" id="kobo.727.1">
     Implementing a central logging filter
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.728.1">
     To improve observability in a RESTful application, we can implement a central logging component
    </span>
    <a id="_idIndexMarker712">
    </a>
    <span class="koboSpan" id="kobo.729.1">
     that logs all incoming HTTP requests and responses.
    </span>
    <span class="koboSpan" id="kobo.729.2">
     A filter is an effective choice for this as it allows you to intercept requests before they reach the controller layer, enabling you to log key requests and response details in one place.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.730.1">
     In this example, we will implement a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.731.1">
      RequestLoggingFilter
     </span>
    </code>
    <span class="koboSpan" id="kobo.732.1">
     that logs incoming requests, following best practices such as structured logging, adding correlation IDs, and avoiding sensitive information.
    </span>
    <span class="koboSpan" id="kobo.732.2">
     This filter will log essential request metadata, such as HTTP method, URL, status code, and processing time, in a structured JSON format:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.733.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.734.1">Component</span></span><span class="koboSpan" id="kobo.735.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.736.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.737.1">RequestLoggingFilter</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.738.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.739.1">OncePerRequestFilter</span></span><span class="koboSpan" id="kobo.740.1"> {
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">static</span></span><span class="koboSpan" id="kobo.742.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.743.1">Logger</span></span><span class="koboSpan" id="kobo.744.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.745.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.746.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.747.1">getLogger</span></span><span class="koboSpan" id="kobo.748.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.749.1">RequestLoggingFilter</span></span><span class="koboSpan" id="kobo.750.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.751.1">class</span></span><span class="koboSpan" id="kobo.752.1">);
    public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.753.1">static</span></span><span class="koboSpan" id="kobo.754.1"> final </span><span class="hljs-title"><span class="koboSpan" id="kobo.755.1">String</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.756.1">X_CORRELATION_ID_HEADER</span></span><span class="koboSpan" id="kobo.757.1"> =
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.758.1">"X-Correlation-Id"</span></span><span class="koboSpan" id="kobo.759.1">;
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.760.1">Override</span></span><span class="koboSpan" id="kobo.761.1">
    protected </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.762.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.763.1">doFilterInternal</span></span><span class="koboSpan" id="kobo.764.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.765.1">HttpServletRequest</span></span><span class="koboSpan" id="kobo.766.1"> request,
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.767.1">HttpServletResponse</span></span><span class="koboSpan" id="kobo.768.1"> response, </span><span class="hljs-title"><span class="koboSpan" id="kobo.769.1">FilterChain</span></span><span class="koboSpan" id="kobo.770.1"> filterChain)
            throws </span><span class="hljs-title"><span class="koboSpan" id="kobo.771.1">ServletException</span></span><span class="koboSpan" id="kobo.772.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.773.1">IOException</span></span><span class="koboSpan" id="kobo.774.1"> {
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.775.1">// Generate or retrieve a unique correlation ID</span></span>
        <span class="hljs-title"><span class="koboSpan" id="kobo.776.1">String</span></span><span class="koboSpan" id="kobo.777.1"> correlationId = request.</span><span class="hljs-title"><span class="koboSpan" id="kobo.778.1">getHeader</span></span><span class="koboSpan" id="kobo.779.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.780.1">X_CORRELATION_ID_HEADER</span></span><span class="koboSpan" id="kobo.781.1">);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.782.1">if</span></span><span class="koboSpan" id="kobo.783.1"> (correlationId == </span><span class="hljs-literal"><span class="koboSpan" id="kobo.784.1">null</span></span><span class="koboSpan" id="kobo.785.1">) {
            correlationId = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.786.1">UUID</span></span><span class="koboSpan" id="kobo.787.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.788.1">randomUUID</span></span><span class="koboSpan" id="kobo.789.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.790.1">toString</span></span><span class="koboSpan" id="kobo.791.1">();
        }
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.792.1">MDC</span></span><span class="koboSpan" id="kobo.793.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.794.1">put</span></span><span class="koboSpan" id="kobo.795.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.796.1">"correlationId"</span></span><span class="koboSpan" id="kobo.797.1">, correlationId);
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.798.1">// Capture the request start time</span></span><span class="koboSpan" id="kobo.799.1">
        long startTime = </span><span class="hljs-title"><span class="koboSpan" id="kobo.800.1">System</span></span><span class="koboSpan" id="kobo.801.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.802.1">currentTimeMillis</span></span><span class="koboSpan" id="kobo.803.1">();
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.804.1">try</span></span><span class="koboSpan" id="kobo.805.1"> {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.806.1">// Proceed with the request</span></span><span class="koboSpan" id="kobo.807.1">
            filterChain.</span><span class="hljs-title"><span class="koboSpan" id="kobo.808.1">doFilter</span></span><span class="koboSpan" id="kobo.809.1">(request, response);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.810.1">finally</span></span><span class="koboSpan" id="kobo.811.1"> {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.812.1">// Capture the request end time</span></span><span class="koboSpan" id="kobo.813.1">
            long duration = </span><span class="hljs-title"><span class="koboSpan" id="kobo.814.1">System</span></span><span class="koboSpan" id="kobo.815.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.816.1">currentTimeMillis</span></span><span class="koboSpan" id="kobo.817.1">() - startTime;
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.818.1">// Log the structured request information</span></span>
            <span class="hljs-title"><span class="koboSpan" id="kobo.819.1">logRequestDetails</span></span><span class="koboSpan" id="kobo.820.1">(request, response, duration);
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.821.1">// Clean up MDC after the request</span></span>
            <span class="hljs-variable"><span class="koboSpan" id="kobo.822.1">MDC</span></span><span class="koboSpan" id="kobo.823.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.824.1">clear</span></span><span class="koboSpan" id="kobo.825.1">();
        }
    }
    private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.826.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.827.1">logRequestDetails</span></span><span class="koboSpan" id="kobo.828.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.829.1">HttpServletRequest request,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.830.1">        HttpServletResponse response, long duration</span></span><span class="koboSpan" id="kobo.831.1">) {
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.832.1">// Extracting useful metadata for structured logging</span></span>
        <span class="hljs-title"><span class="koboSpan" id="kobo.833.1">String</span></span><span class="koboSpan" id="kobo.834.1"> httpMethod = request.</span><span class="hljs-title"><span class="koboSpan" id="kobo.835.1">getMethod</span></span><span class="koboSpan" id="kobo.836.1">();
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.837.1">String</span></span><span class="koboSpan" id="kobo.838.1"> requestUri = request.</span><span class="hljs-title"><span class="koboSpan" id="kobo.839.1">getRequestURI</span></span><span class="koboSpan" id="kobo.840.1">();
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.841.1">String</span></span><span class="koboSpan" id="kobo.842.1"> queryString = request.</span><span class="hljs-title"><span class="koboSpan" id="kobo.843.1">getQueryString</span></span><span class="koboSpan" id="kobo.844.1">() !=
            </span><span class="hljs-literal"><span class="koboSpan" id="kobo.845.1">null</span></span><span class="koboSpan" id="kobo.846.1"> ? </span><span class="hljs-string"><span class="koboSpan" id="kobo.847.1">"?"</span></span><span class="koboSpan" id="kobo.848.1"> + request.</span><span class="hljs-title"><span class="koboSpan" id="kobo.849.1">getQueryString</span></span><span class="koboSpan" id="kobo.850.1">() : </span><span class="hljs-string"><span class="koboSpan" id="kobo.851.1">""</span></span><span class="koboSpan" id="kobo.852.1">;
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.853.1">String</span></span><span class="koboSpan" id="kobo.854.1"> correlationId = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.855.1">MDC</span></span><span class="koboSpan" id="kobo.856.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.857.1">get</span></span><span class="koboSpan" id="kobo.858.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.859.1">"correlationId"</span></span><span class="koboSpan" id="kobo.860.1">);
        int statusCode = response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.861.1">getStatus</span></span><span class="koboSpan" id="kobo.862.1">();
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.863.1">// Structured JSON log example</span></span>
        <span class="hljs-keyword"><span class="koboSpan" id="kobo.864.1">try</span></span><span class="koboSpan" id="kobo.865.1"> {
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.866.1">String</span></span><span class="koboSpan" id="kobo.867.1"> logEntryJson = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.868.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.869.1">ObjectMapper</span></span><span class="koboSpan" id="kobo.870.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.871.1">writeValueAsString</span></span><span class="koboSpan" id="kobo.872.1">(
                    </span><span class="hljs-title"><span class="koboSpan" id="kobo.873.1">createLogEntry</span></span><span class="koboSpan" id="kobo.874.1">(correlationId, httpMethod,
                    requestUri + queryString, statusCode, duration)
            );
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.875.1">info</span></span><span class="koboSpan" id="kobo.876.1">(logEntryJson);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.877.1">catch</span></span><span class="koboSpan" id="kobo.878.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.879.1">JsonProcessingException</span></span><span class="koboSpan" id="kobo.880.1"> e) {
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.881.1">error</span></span><span class="koboSpan" id="kobo.882.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.883.1">"Failed to convert log entry to JSON"</span></span><span class="koboSpan" id="kobo.884.1">, e);
        }
    }
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.885.1">Map</span></span><span class="koboSpan" id="kobo.886.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.887.1">String</span></span><span class="koboSpan" id="kobo.888.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.889.1">Object</span></span><span class="koboSpan" id="kobo.890.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.891.1">createLogEntry</span></span><span class="koboSpan" id="kobo.892.1">(
</span><span class="hljs-params">        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.893.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.894.1"> correlationId, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.895.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.896.1"> method, </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.897.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.898.1"> url, int status,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.899.1">        long duration</span></span><span class="koboSpan" id="kobo.900.1">) {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.901.1">Map</span></span><span class="koboSpan" id="kobo.902.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.903.1">String</span></span><span class="koboSpan" id="kobo.904.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.905.1">Object</span></span><span class="koboSpan" id="kobo.906.1">&gt; logEntry = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.908.1">HashMap</span></span><span class="koboSpan" id="kobo.909.1">&lt;&gt;();
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.910.1">put</span></span><span class="koboSpan" id="kobo.911.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.912.1">"timestamp"</span></span><span class="koboSpan" id="kobo.913.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.914.1">Instant</span></span><span class="koboSpan" id="kobo.915.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.916.1">now</span></span><span class="koboSpan" id="kobo.917.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.918.1">toString</span></span><span class="koboSpan" id="kobo.919.1">());
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.920.1">put</span></span><span class="koboSpan" id="kobo.921.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.922.1">"level"</span></span><span class="koboSpan" id="kobo.923.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.924.1">"INFO"</span></span><span class="koboSpan" id="kobo.925.1">);
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.926.1">put</span></span><span class="koboSpan" id="kobo.927.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.928.1">"correlationId"</span></span><span class="koboSpan" id="kobo.929.1">, correlationId);
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.930.1">put</span></span><span class="koboSpan" id="kobo.931.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.932.1">"method"</span></span><span class="koboSpan" id="kobo.933.1">, method);
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.934.1">put</span></span><span class="koboSpan" id="kobo.935.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.936.1">"url"</span></span><span class="koboSpan" id="kobo.937.1">, url);
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.938.1">put</span></span><span class="koboSpan" id="kobo.939.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.940.1">"status"</span></span><span class="koboSpan" id="kobo.941.1">, status);
        logEntry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.942.1">put</span></span><span class="koboSpan" id="kobo.943.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.944.1">"duration"</span></span><span class="koboSpan" id="kobo.945.1">, duration + </span><span class="hljs-string"><span class="koboSpan" id="kobo.946.1">"ms"</span></span><span class="koboSpan" id="kobo.947.1">);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.948.1">return</span></span><span class="koboSpan" id="kobo.949.1"> logEntry;
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.950.1">
     So,
    </span>
    <a id="_idTextAnchor255">
    </a>
    <span class="koboSpan" id="kobo.951.1">
     what is
    </span>
    <a id="_idIndexMarker713">
    </a>
    <span class="koboSpan" id="kobo.952.1">
     this filter doing?
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.953.1">
       Choosing the right log level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.954.1">
      : The filter logs complete requests at the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.955.1">
       INFO
      </span>
     </code>
     <span class="koboSpan" id="kobo.956.1">
      level, which is appropriate for general application flow information.
     </span>
     <span class="koboSpan" id="kobo.956.2">
      If a request encounters an error, it could be logged at
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.957.1">
       ERROR
      </span>
     </code>
     <span class="koboSpan" id="kobo.958.1">
      in other components, such as exception handlers.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.959.1">
       Structured logging
      </span>
     </strong>
     <span class="koboSpan" id="kobo.960.1">
      : The filter uses structured logging to log information in JSON format, including fields like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.961.1">
       correlationId
      </span>
     </code>
     <span class="koboSpan" id="kobo.962.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.963.1">
       method
      </span>
     </code>
     <span class="koboSpan" id="kobo.964.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.965.1">
       url
      </span>
     </code>
     <span class="koboSpan" id="kobo.966.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.967.1">
       status
      </span>
     </code>
     <span class="koboSpan" id="kobo.968.1">
      , and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.969.1">
       duration
      </span>
     </code>
     <span class="koboSpan" id="kobo.970.1">
      .
     </span>
     <span class="koboSpan" id="kobo.970.2">
      Structured logging allows for easier parsing, searching, and aggregating in centralized logging tools.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.971.1">
       Avoiding sensitive data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.972.1">
      : The filter avoids logging the request body directly, which could contain sensitive information like passwords.
     </span>
     <span class="koboSpan" id="kobo.972.2">
      If needed, further filtering can exclude or mask sensitive data in headers or query parameters.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.973.1">
       Capturing contextual information
      </span>
     </strong>
     <span class="koboSpan" id="kobo.974.1">
      : The filter captures relevant metadata for each request, including the HTTP method, URL, status code, and duration.
     </span>
     <span class="koboSpan" id="kobo.974.2">
      This provides valuable context for debugging and performance analysis.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.975.1">
       Using correlation IDs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.976.1">
      : The filter generates a correlation ID (if one is not already present) and stores
     </span>
     <a id="_idIndexMarker714">
     </a>
     <span class="koboSpan" id="kobo.977.1">
      it in the
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.978.1">
       Mapped Diagnostic Context (MDC)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.979.1">
      .
     </span>
     <span class="koboSpan" id="kobo.979.2">
      This ensures that the correlation ID is added to all subsequent logs within the request’s lifecycle, enabling end-to-end tracking across services.
     </span>
    </li>
   </ul>
   <div class="packt_tip">
    <div>
     <span class="koboSpan" id="kobo.980.1">
      <img alt="img" src="../Images/lightbulb1.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.981.1">
      Mapped Diagnostic Context (MDC)
     </span>
    </p>
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.982.1">
       Mapped Diagnostic Context (MDC)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.983.1">
      is a feature in logging frameworks like SLF4J (with Logback) and Log4j that allows developers to store and retrieve contextual information per thread.
     </span>
     <span class="koboSpan" id="kobo.983.2">
      This context information is automatically included in log messages, making it easier to track related logs across different parts of an application.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.984.1">
     With this logging filter in place, here is an example of what a log entry might look like:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.985.1">{
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.986.1">"duration"</span></span><span class="koboSpan" id="kobo.987.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.988.1">"157ms"</span></span><span class="koboSpan" id="kobo.989.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.990.1">"method"</span></span><span class="koboSpan" id="kobo.991.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.992.1">"POST"</span></span><span class="koboSpan" id="kobo.993.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.994.1">"level"</span></span><span class="koboSpan" id="kobo.995.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.996.1">"INFO"</span></span><span class="koboSpan" id="kobo.997.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.998.1">"correlationId"</span></span><span class="koboSpan" id="kobo.999.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1000.1">"71ef4140-f3a6-488f-ba30-b2a31ac507df"</span></span><span class="koboSpan" id="kobo.1001.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1002.1">"url"</span></span><span class="koboSpan" id="kobo.1003.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1004.1">"/orders"</span></span><span class="koboSpan" id="kobo.1005.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1006.1">"timestamp"</span></span><span class="koboSpan" id="kobo.1007.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1008.1">"2024-12-09T18:08:00.719019511Z"</span></span><span class="koboSpan" id="kobo.1009.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1010.1">"status"</span></span><span class="koboSpan" id="kobo.1011.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.1012.1">201</span></span><span class="koboSpan" id="kobo.1013.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1014.1">
     But to have the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1015.1">
      correlationId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1016.1">
     spread to other services and enable the power of tracking the request across
    </span>
    <a id="_idIndexMarker715">
    </a>
    <span class="koboSpan" id="kobo.1017.1">
     multiple services, we need to update the header with the proper newly generated value from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1018.1">
      correlationId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1019.1">
     , adding it before the request is sent.
    </span>
    <span class="koboSpan" id="kobo.1019.2">
     We will do it using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1020.1">
      BeanPostProcessor
     </span>
    </code>
    <span class="koboSpan" id="kobo.1021.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1022.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1023.1">Component</span></span><span class="koboSpan" id="kobo.1024.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1025.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1026.1">ProductsApiBeanPostProcessor</span></span><span class="koboSpan" id="kobo.1027.1"> implements </span><span class="hljs-title"><span class="koboSpan" id="kobo.1028.1">BeanPostProcessor</span></span><span class="koboSpan" id="kobo.1029.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1030.1">Override</span></span><span class="koboSpan" id="kobo.1031.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1032.1">Object</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1033.1">postProcessBeforeInitialization</span></span><span class="koboSpan" id="kobo.1034.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1035.1">Object</span></span><span class="koboSpan" id="kobo.1036.1"> bean,
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1037.1">String</span></span><span class="koboSpan" id="kobo.1038.1"> beanName) throws </span><span class="hljs-title"><span class="koboSpan" id="kobo.1039.1">BeansException</span></span><span class="koboSpan" id="kobo.1040.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1041.1">if</span></span><span class="koboSpan" id="kobo.1042.1"> (bean </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1043.1">instanceof</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1044.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1045.1">) {
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1046.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1047.1"> productsApi = (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1048.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1049.1">) bean;
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1050.1">ApiClient</span></span><span class="koboSpan" id="kobo.1051.1"> apiClient = productsApi.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1052.1">getApiClient</span></span><span class="koboSpan" id="kobo.1053.1">();
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1054.1">String</span></span><span class="koboSpan" id="kobo.1055.1"> correlationId = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1056.1">MDC</span></span><span class="koboSpan" id="kobo.1057.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1058.1">get</span></span><span class="koboSpan" id="kobo.1059.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1060.1">"correlationId"</span></span><span class="koboSpan" id="kobo.1061.1">);
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1062.1">if</span></span><span class="koboSpan" id="kobo.1063.1"> (correlationId != </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1064.1">null</span></span><span class="koboSpan" id="kobo.1065.1">) {
                apiClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1066.1">addDefaultHeader</span></span><span class="koboSpan" id="kobo.1067.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1068.1">"X-Correlation-Id"</span></span><span class="koboSpan" id="kobo.1069.1">,
                    correlationId);
            }
            productsApi.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1070.1">setApiClient</span></span><span class="koboSpan" id="kobo.1071.1">(apiClient);
        }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1072.1">return</span></span><span class="koboSpan" id="kobo.1073.1"> bean;
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1074.1">
     As an example, in the Order Management API, before calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1075.1">
      productsApi
     </span>
    </code>
    <span class="koboSpan" id="kobo.1076.1">
     into the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1077.1">
      ProductsQueryUseCaseImpl
     </span>
    </code>
    <span class="koboSpan" id="kobo.1078.1">
     implementation, we will make a call to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1079.1">
      beanPostProcessor
     </span>
    </code>
    <span class="koboSpan" id="kobo.1080.1">
     to have the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1081.1">
      ApiClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1082.1">
     bean updated with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1083.1">
      correlationId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1084.1">
     set in the header from the request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1085.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1086.1">
      ApiClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1087.1">
     is the REST client
    </span>
    <a id="_idIndexMarker716">
    </a>
    <span class="koboSpan" id="kobo.1088.1">
     that was generated by the OpenAPI plugin using the Product
    </span>
    <a id="_idIndexMarker717">
    </a>
    <span class="koboSpan" id="kobo.1089.1">
     API specification and will be used for every call to the Product API from the Order Management API.
    </span>
    <span class="koboSpan" id="kobo.1089.2">
     Here is the updated version of the class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1090.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1091.1">Service</span></span><span class="koboSpan" id="kobo.1092.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1093.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1094.1">ProductsQueryUseCaseImpl</span></span><span class="koboSpan" id="kobo.1095.1"> implements </span><span class="hljs-title"><span class="koboSpan" id="kobo.1096.1">ProductsQueryUseCase</span></span><span class="koboSpan" id="kobo.1097.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1098.1">Logger</span></span><span class="koboSpan" id="kobo.1099.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1100.1">LoggerFactory</span></span><span class="koboSpan" id="kobo.1101.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1102.1">getLogger</span></span><span class="koboSpan" id="kobo.1103.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1104.1">ProductsQueryUseCaseImpl</span></span><span class="koboSpan" id="kobo.1105.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1106.1">class</span></span><span class="koboSpan" id="kobo.1107.1">);
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1108.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1109.1"> productsApi;
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1110.1">ProductsApiBeanPostProcessor</span></span><span class="koboSpan" id="kobo.1111.1"> beanPostProcessor;
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1112.1">ProductsQueryUseCaseImpl</span></span><span class="koboSpan" id="kobo.1113.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1114.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1115.1"> productsApi,
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1116.1">ProductsApiBeanPostProcessor</span></span><span class="koboSpan" id="kobo.1117.1"> beanPostProcessor) {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1118.1">this</span></span><span class="koboSpan" id="kobo.1119.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1120.1">productsApi</span></span><span class="koboSpan" id="kobo.1121.1"> = productsApi;
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1122.1">this</span></span><span class="koboSpan" id="kobo.1123.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1124.1">beanPostProcessor</span></span><span class="koboSpan" id="kobo.1125.1"> = beanPostProcessor;
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1126.1">Override</span></span><span class="koboSpan" id="kobo.1127.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1128.1">ProductDetails</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1129.1">getProductById</span></span><span class="koboSpan" id="kobo.1130.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1131.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1132.1"> productId</span></span><span class="koboSpan" id="kobo.1133.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1134.1">try</span></span><span class="koboSpan" id="kobo.1135.1"> {
            beanPostProcessor.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1136.1">postProcessBeforeInitialization</span></span><span class="koboSpan" id="kobo.1137.1">(productsApi,
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.1138.1">"productsApi"</span></span><span class="koboSpan" id="kobo.1139.1">);
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1140.1">ProductOutputDto</span></span><span class="koboSpan" id="kobo.1141.1"> product = productsApi.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1142.1">getProductById</span></span><span class="koboSpan" id="kobo.1143.1">(
                productId);
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1144.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1145.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1146.1">ProductDetails</span></span><span class="koboSpan" id="kobo.1147.1">(product.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1148.1">getSku</span></span><span class="koboSpan" id="kobo.1149.1">(),
                product.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1150.1">getPrice</span></span><span class="koboSpan" id="kobo.1151.1">());
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1152.1">catch</span></span><span class="koboSpan" id="kobo.1153.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1154.1">Exception</span></span><span class="koboSpan" id="kobo.1155.1"> ex) {
            logger.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1156.1">error</span></span><span class="koboSpan" id="kobo.1157.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1158.1">"Error getting product with id {}"</span></span><span class="koboSpan" id="kobo.1159.1">, productId,
                          ex);
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1160.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1161.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1162.1">EntityNotFoundException</span></span><span class="koboSpan" id="kobo.1163.1">(
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.1164.1">"Product not found with id "</span></span><span class="koboSpan" id="kobo.1165.1"> + productId);
        }
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1166.1">
     This ensures that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1167.1">
      correlationId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1168.1">
     is propagated with every service request.
    </span>
    <span class="koboSpan" id="kobo.1168.2">
     The filter in the called service will read the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1169.1">
      correlationId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1170.1">
     and include it in the logs, enabling you to uniquely track requests across the services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1171.1">
     Additional functionality can be added to the filter to capture even more detailed logging information:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1172.1">
       Log-specific headers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1173.1">
      : Capture headers like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1174.1">
       User-Agent
      </span>
     </code>
     <span class="koboSpan" id="kobo.1175.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1176.1">
       Authorization
      </span>
     </code>
     <span class="koboSpan" id="kobo.1177.1">
      , but exclude or mask sensitive details.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1178.1">
       Conditional logging for error responses
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1179.1">
      : Modify the filter to log
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1180.1">
       4xx
      </span>
     </code>
     <span class="koboSpan" id="kobo.1181.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1182.1">
       5xx
      </span>
     </code>
     <span class="koboSpan" id="kobo.1183.1">
      responses at
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1184.1">
       WARN
      </span>
     </code>
     <span class="koboSpan" id="kobo.1185.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1186.1">
       ERROR
      </span>
     </code>
     <span class="koboSpan" id="kobo.1187.1">
      levels for easier error tracking.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1188.1">
       Error handling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1189.1">
      : Combine this filter with a global exception handler to capture and log unhandled exceptions, leveraging the correlation ID to tie error logs to their originating requests.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1190.1">
     This logging filter
    </span>
    <a id="_idIndexMarker718">
    </a>
    <span class="koboSpan" id="kobo.1191.1">
     implements best practices and creates consistent, structured logs across the application, making it easier to monitor, troubleshoot, and analyze incoming API requests.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1192.1">
     And to effectively track requests across multiple services, implementing tracing is essential.
    </span>
    <span class="koboSpan" id="kobo.1192.2">
     It helps maintain a clear trace and simplifies troubleshooting in distributed systems.
    </span>
    <span class="koboSpan" id="kobo.1192.3">
     In the next section, we will explore how to achieve this.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-240">
    <a id="_idTextAnchor256">
    </a>
    <span class="koboSpan" id="kobo.1193.1">
     Implementing service tracing in distributed systems
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1194.1">
     In distributed systems, where a request might span multiple services,
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1195.1">
      distributed tracing
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1196.1">
     provides
    </span>
    <a id="_idIndexMarker719">
    </a>
    <span class="koboSpan" id="kobo.1197.1">
     visibility into how a request moves
    </span>
    <a id="_idIndexMarker720">
    </a>
    <span class="koboSpan" id="kobo.1198.1">
     through various components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1199.1">
     Let’s begin by understanding what we mean by distributed tracing.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-241">
    <a id="_idTextAnchor257">
    </a>
    <span class="koboSpan" id="kobo.1200.1">
     What is distributed tracing?
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1201.1">
     Distributed tracing allows you to follow the lifecycle of a request as it flows from one service to another.
    </span>
    <span class="koboSpan" id="kobo.1201.2">
     This helps
    </span>
    <a id="_idIndexMarker721">
    </a>
    <span class="koboSpan" id="kobo.1202.1">
     you see where delays or errors occur.
    </span>
    <span class="koboSpan" id="kobo.1202.2">
     In tracing terminology, each step in the request’s journey is called a span, and a trace is the entire set of spans associated with a request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1203.1">
     For example, imagine a request comes into your system to create a new user.
    </span>
    <span class="koboSpan" id="kobo.1203.2">
     This request might touch on the following services:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1204.1">
      API gateway
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1205.1">
      Authentication service
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1206.1">
      User service (to create the user in the database)
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1207.1">
      Notification service (to send a welcome email)
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1208.1">
     Each of these steps is a span, and all the spans together form a trace.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1209.1">
     Distributed tracing tools, such as Zipkin or Jaeger, can visualize the trace and highlight which services or steps are causing delays.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1210.1">
     Next, we will understand how each trace is identified uniquely by adding a trace ID to each request.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-242">
    <a id="_idTextAnchor258">
    </a>
    <span class="koboSpan" id="kobo.1211.1">
     Using trace IDs for end-to-end request tracking
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1212.1">
     Just like correlation IDs help in logs, trace IDs are unique identifiers attached to each request, allowing
    </span>
    <a id="_idIndexMarker722">
    </a>
    <span class="koboSpan" id="kobo.1213.1">
     for end-to-end request tracking” you to track that request across multiple services.
    </span>
    <span class="koboSpan" id="kobo.1213.2">
     The difference is that trace IDs are automatically managed by tracing systems and include timing information.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1214.1">
     In Spring, the Micrometer Tracing library automatically generates trace IDs for each request and propagates them across service boundaries.
    </span>
    <span class="koboSpan" id="kobo.1214.2">
     These IDs are included in the logs and tracing systems, allowing you to correlate logs and traces for detailed troubleshooting.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1215.1">
     In a Spring Boot application, Micrometer Tracing generates the following log message:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1216.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1217.1">"timestamp"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1218.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1219.1">"2024-10-23T13:00:00Z"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1220.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1221.1">"traceId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1222.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1223.1">"b8e3fbe5cd34fbe5"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1224.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1225.1">"spanId"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1226.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1227.1">"af18fbe5cd34ab23"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1228.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1229.1">"level"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1230.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1231.1">"INFO"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1232.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1233.1">"service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1234.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1235.1">"user-service"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1236.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1237.1">"message"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1238.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1239.1">"Created new user with ID 123"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1240.1">}</span></span>
</code></pre>
   <p class="normal">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1241.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1242.1">
     helps you connect this event to other related events across different services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1243.1">
     Now, let us learn how to implement the tracing feature with Micrometer.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-243">
    <a id="_idTextAnchor259">
    </a>
    <span class="koboSpan" id="kobo.1244.1">
     Implementing tracing using Micrometer
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1245.1">
     With the release of Spring Boot 3.x, Spring Cloud Sleuth has been replaced by Micrometer Tracing for
    </span>
    <a id="_idIndexMarker723">
    </a>
    <span class="koboSpan" id="kobo.1246.1">
     tracing support.
    </span>
    <span class="koboSpan" id="kobo.1246.2">
     Micrometer
    </span>
    <a id="_idIndexMarker724">
    </a>
    <span class="koboSpan" id="kobo.1247.1">
     Tracing is fully compatible with Spring Boot 3.x and offers a more modern, flexible way to implement distributed tracing in your applications.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1248.1">
     In this section, we will walk through how to implement distributed tracing in a Spring Boot application using Micrometer Tracing, enabling you to track requests across services and get detailed insights into their performance.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-244">
    <a id="_idTextAnchor260">
    </a>
    <span class="koboSpan" id="kobo.1249.1">
     Setting up Micrometer Tracing in Spring Boot
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1250.1">
     To implement
    </span>
    <a id="_idIndexMarker725">
    </a>
    <span class="koboSpan" id="kobo.1251.1">
     tracing in a Spring Boot application
    </span>
    <a id="_idIndexMarker726">
    </a>
    <span class="koboSpan" id="kobo.1252.1">
     using Micrometer Tracing, follow these steps:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1253.1">
       Add Micrometer Tracing dependencies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1254.1">
      :
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1255.1">
     Micrometer Tracing is part of the Micrometer ecosystem, and it integrates easily with Spring Boot 3.x.
    </span>
    <span class="koboSpan" id="kobo.1255.2">
     To enable Micrometer Tracing in your project, add the necessary dependencies to your
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1256.1">
      pom.xml
     </span>
    </code>
    <span class="koboSpan" id="kobo.1257.1">
     (if using Maven):
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1258.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1259.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1260.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1261.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1262.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1263.1">&gt;</span></span><span class="koboSpan" id="kobo.1264.1">io.micrometer</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1265.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1266.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1267.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1268.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1269.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1270.1">&gt;</span></span><span class="koboSpan" id="kobo.1271.1">micrometer-observation</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1272.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1273.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1274.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1275.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1276.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1277.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1278.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1279.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1280.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1281.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1282.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1283.1">&gt;</span></span><span class="koboSpan" id="kobo.1284.1">io.micrometer</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1285.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1286.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1287.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1288.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1289.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1290.1">&gt;</span></span><span class="koboSpan" id="kobo.1291.1">micrometer-tracing-bridge-brave</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1292.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1293.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1294.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1295.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1296.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1297.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1298.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1299.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1300.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1301.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1302.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1303.1">&gt;</span></span><span class="koboSpan" id="kobo.1304.1">org.springframework.boot</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1305.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1306.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1307.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1308.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1309.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1310.1">&gt;</span></span><span class="koboSpan" id="kobo.1311.1">spring-boot-starter-actuator</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1312.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1313.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1314.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1315.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1316.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1317.1">&gt;</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1318.1">
     Here is what these dependencies are used for:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1319.1">
       micrometer-observation
      </span>
     </code>
     <span class="koboSpan" id="kobo.1320.1">
      : Provides the core Observation API that serves as a facade for metrics, logging, and tracing.
     </span>
     <span class="koboSpan" id="kobo.1320.2">
      It allows you to instrument code once and get multiple observability benefits, focusing on what you want to observe rather than how to implement it.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1321.1">
       micrometer-tracing-bridge-brave
      </span>
     </code>
     <span class="koboSpan" id="kobo.1322.1">
      : Bridges the Micrometer Observation API to Brave, enabling distributed tracing capabilities.
     </span>
     <span class="koboSpan" id="kobo.1322.2">
      This dependency is responsible for creating and propagating trace and span IDs across service boundaries, which is what adds the trace context to your logs.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1323.1">
       spring-boot-starter-actuator
      </span>
     </code>
     <span class="koboSpan" id="kobo.1324.1">
      : Provides production-ready features to help monitor and manage your application.
     </span>
     <span class="koboSpan" id="kobo.1324.2">
      It includes endpoints for health checks, metrics, and other operational data.
     </span>
     <span class="koboSpan" id="kobo.1324.3">
      This starter automatically configures the observability infrastructure when combined with the Micrometer dependencies.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1325.1">
     Together, these dependencies enable comprehensive observability with metrics, tracing, and health monitoring in a Spring Boot microservices architecture.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="2">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1326.1">
       Configure Micrometer Tracing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1327.1">
      :
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1328.1">
     Once you’ve added the dependencies, Micrometer Tracing is automatically configured in Spring
    </span>
    <a id="_idIndexMarker727">
    </a>
    <span class="koboSpan" id="kobo.1329.1">
     Boot.
    </span>
    <span class="koboSpan" id="kobo.1329.2">
     By default, Micrometer
    </span>
    <a id="_idIndexMarker728">
    </a>
    <span class="koboSpan" id="kobo.1330.1">
     will instrument your HTTP requests, generating trace IDs and span IDs for each incoming request.
    </span>
    <span class="koboSpan" id="kobo.1330.2">
     These IDs are propagated across service boundaries.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1331.1">
     To enable tracing fully, you may need to configure how traces are exported.
    </span>
    <span class="koboSpan" id="kobo.1331.2">
     For example, to export traces to Zipkin, add the following configuration to your
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1332.1">
      application.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.1333.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1334.1">management:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1335.1">tracing:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1336.1">enabled:</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1337.1">true</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1338.1">sampling:</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.1339.1">probability:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1340.1">1.0</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1341.1"># Enables 100% sampling of traces</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1342.1">zipkin:</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.1343.1">enabled:</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1344.1">true</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.1345.1">endpoint:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1346.1">http://localhost:9411/api/v2/spans</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1347.1">logging:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1348.1">pattern:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1349.1">level:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1350.1">'%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]'</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1351.1">
     In this configuration, we have the following parameters:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1352.1">
       management.tracing.enabled=true
      </span>
     </code>
     <span class="koboSpan" id="kobo.1353.1">
      : Enables tracing for the application.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1354.1">
       management.tracing.sampling.probability=1.0
      </span>
     </code>
     <span class="koboSpan" id="kobo.1355.1">
      : Ensures that all requests are traced (for production, you might want to adjust this for performance reasons).
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1356.1">
       management.tracing.zipkin.enabled=true
      </span>
     </code>
     <span class="koboSpan" id="kobo.1357.1">
      : Enables exporting traces to Zipkin.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1358.1">
       management.tracing.zipkin.endpoint
      </span>
     </code>
     <span class="koboSpan" id="kobo.1359.1">
      : Specifies the URL of your Zipkin server for trace collection.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1360.1">
       logging.pattern.level
      </span>
     </code>
     <span class="koboSpan" id="kobo.1361.1">
      : Specifies a pattern on which each log will be presented.
     </span>
     <span class="koboSpan" id="kobo.1361.2">
      Here, we are setting it to log as follows: application name, traceId, spanId.
     </span>
     <span class="koboSpan" id="kobo.1361.3">
      Note that the format for getting the values in the logs for the trace ID and the span Id can differ from library to library.
     </span>
    </li>
   </ul>
   <ol>
    <li class="numberedList" value="3">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1362.1">
       Configuring RestClient for tracing
      </span>
     </strong>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1363.1">
     To guarantee that the generated trace is propagated through the called services, you need to
    </span>
    <a id="_idIndexMarker729">
    </a>
    <span class="koboSpan" id="kobo.1364.1">
     configure your HTTP client to
    </span>
    <a id="_idIndexMarker730">
    </a>
    <span class="koboSpan" id="kobo.1365.1">
     propagate the trace context.
    </span>
    <span class="koboSpan" id="kobo.1365.2">
     This is done by configuring
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1366.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1367.1">
     to use the one that is created by Spring, using the dependencies and configurations done in steps 1 and 2.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1368.1">
     Since we are using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1369.1">
      OpenAPI
     </span>
    </code>
    <span class="koboSpan" id="kobo.1370.1">
     in this book to generate the client that queries the Products API from the Order Management API, you need to override the generated
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1371.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1372.1">
     from OpenAPI with the one from instantiated in Spring.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1373.1">
     To do that, you need to properly set the beans in the configuration.
    </span>
    <span class="koboSpan" id="kobo.1373.2">
     In the Order Management API, these configurations are done on the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1374.1">
      ProductsApiConfiguration
     </span>
    </code>
    <span class="koboSpan" id="kobo.1375.1">
     class, under the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1376.1">
      adapter.outbound.rest
     </span>
    </code>
    <span class="koboSpan" id="kobo.1377.1">
     package:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1378.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1379.1">Configuration</span></span><span class="koboSpan" id="kobo.1380.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1381.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1382.1">ProductsApiConfiguration</span></span><span class="koboSpan" id="kobo.1383.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1384.1">Bean</span></span><span class="koboSpan" id="kobo.1385.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1386.1">ProductsApi</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1387.1">getProductsApi</span></span><span class="koboSpan" id="kobo.1388.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1389.1">ApiClient apiClient</span></span><span class="koboSpan" id="kobo.1390.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1391.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1392.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1393.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1394.1">(apiClient);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1395.1">Bean</span></span><span class="koboSpan" id="kobo.1396.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1397.1">ApiClient</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1398.1">getApiClient</span></span><span class="koboSpan" id="kobo.1399.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1400.1">RestClient restClient</span></span><span class="koboSpan" id="kobo.1401.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1402.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1403.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1404.1">ApiClient</span></span><span class="koboSpan" id="kobo.1405.1">(restClient);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1406.1">Bean</span></span><span class="koboSpan" id="kobo.1407.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1408.1">RestClient</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1409.1">getRestClient</span></span><span class="koboSpan" id="kobo.1410.1">(
        </span><span class="hljs-params"><span class="koboSpan" id="kobo.1411.1">ObservationRegistry observationRegistry,   </span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1412.1">        RestClientBuilderConfigurer configurer</span></span><span class="koboSpan" id="kobo.1413.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1414.1">return</span></span><span class="koboSpan" id="kobo.1415.1"> configurer.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1416.1">configure</span></span><span class="koboSpan" id="kobo.1417.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1418.1">RestClient</span></span><span class="koboSpan" id="kobo.1419.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1420.1">builder</span></span><span class="koboSpan" id="kobo.1421.1">())
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1422.1">requestFactory</span></span><span class="koboSpan" id="kobo.1423.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1424.1">customClientHttpRequestFactory</span></span><span class="koboSpan" id="kobo.1425.1">())
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1426.1">observationRegistry</span></span><span class="koboSpan" id="kobo.1427.1">(observationRegistry)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1428.1">build</span></span><span class="koboSpan" id="kobo.1429.1">();
    }
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.1430.1">ClientHttpRequestFactory customClientHttpRequestFactory</span></span><span class="koboSpan" id="kobo.1431.1">() {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1432.1">Duration</span></span><span class="koboSpan" id="kobo.1433.1"> duration = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1434.1">Duration</span></span><span class="koboSpan" id="kobo.1435.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1436.1">ofSeconds</span></span><span class="koboSpan" id="kobo.1437.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1438.1">6</span></span><span class="koboSpan" id="kobo.1439.1">);
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1440.1">ClientHttpRequestFactorySettings</span></span><span class="koboSpan" id="kobo.1441.1"> settings = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1442.1">ClientHttpRequestFactorySettings</span></span><span class="koboSpan" id="kobo.1443.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1444.1">DEFAULTS</span></span><span class="koboSpan" id="kobo.1445.1">
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1446.1">withConnectTimeout</span></span><span class="koboSpan" id="kobo.1447.1">(duration)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1448.1">withReadTimeout</span></span><span class="koboSpan" id="kobo.1449.1">(duration);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1450.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1451.1">ClientHttpRequestFactories</span></span><span class="koboSpan" id="kobo.1452.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1453.1">get</span></span><span class="koboSpan" id="kobo.1454.1">(settings);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1455.1">Bean</span></span><span class="koboSpan" id="kobo.1456.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1457.1">SpanHandler</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1458.1">logSpanHandler</span></span><span class="koboSpan" id="kobo.1459.1">(){
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1460.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1461.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1462.1">LogSpanHandler</span></span><span class="koboSpan" id="kobo.1463.1">();
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1464.1">static</span></span><span class="koboSpan" id="kobo.1465.1"> final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1466.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1467.1">LogSpanHandler</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1468.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1469.1">SpanHandler</span></span><span class="koboSpan" id="kobo.1470.1"> {
        final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1471.1">Logger</span></span><span class="koboSpan" id="kobo.1472.1"> logger = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1473.1">Logger</span></span><span class="koboSpan" id="kobo.1474.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1475.1">getLogger</span></span><span class="koboSpan" id="kobo.1476.1">(
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1477.1">ProductsApiConfiguration</span></span><span class="koboSpan" id="kobo.1478.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1479.1">class</span></span><span class="koboSpan" id="kobo.1480.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1481.1">getName</span></span><span class="koboSpan" id="kobo.1482.1">());
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1483.1">LogSpanHandler</span></span><span class="koboSpan" id="kobo.1484.1">() {
        }
        public boolean </span><span class="hljs-title"><span class="koboSpan" id="kobo.1485.1">end</span></span><span class="koboSpan" id="kobo.1486.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1487.1">TraceContext context, MutableSpan span,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1488.1">            SpanHandler.Cause cause</span></span><span class="koboSpan" id="kobo.1489.1">) {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1490.1">if</span></span><span class="koboSpan" id="kobo.1491.1"> (!</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1492.1">this</span></span><span class="koboSpan" id="kobo.1493.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1494.1">logger</span></span><span class="koboSpan" id="kobo.1495.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1496.1">isLoggable</span></span><span class="koboSpan" id="kobo.1497.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1498.1">Level</span></span><span class="koboSpan" id="kobo.1499.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1500.1">INFO</span></span><span class="koboSpan" id="kobo.1501.1">)) {
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1502.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1503.1">false</span></span><span class="koboSpan" id="kobo.1504.1">;
            } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1505.1">else</span></span><span class="koboSpan" id="kobo.1506.1"> {
                </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1507.1">this</span></span><span class="koboSpan" id="kobo.1508.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1509.1">logger</span></span><span class="koboSpan" id="kobo.1510.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1511.1">info</span></span><span class="koboSpan" id="kobo.1512.1">(span.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1513.1">toString</span></span><span class="koboSpan" id="kobo.1514.1">());
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1515.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1516.1">true</span></span><span class="koboSpan" id="kobo.1517.1">;
            }
        }
        public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1518.1">String</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1519.1">toString</span></span><span class="koboSpan" id="kobo.1520.1">() {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1521.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1522.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1523.1">LogSpanHandler{name="</span></span><span class="koboSpan" id="kobo.1524.1"> + </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1525.1">this</span></span><span class="koboSpan" id="kobo.1526.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1527.1">logger</span></span><span class="koboSpan" id="kobo.1528.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1529.1">getName</span></span><span class="koboSpan" id="kobo.1530.1">() + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1531.1">"}"</span></span><span class="koboSpan" id="kobo.1532.1">;
        }
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1533.1">
     This code
    </span>
    <a id="_idIndexMarker731">
    </a>
    <span class="koboSpan" id="kobo.1534.1">
     configures the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1535.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1536.1">
     bean with a custom
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1537.1">
      ClientHttpRequestFactory
     </span>
    </code>
    <span class="koboSpan" id="kobo.1538.1">
     and an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1539.1">
      ObservationRegistry
     </span>
    </code>
    <span class="koboSpan" id="kobo.1540.1">
     from the imported
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1541.1">
      micrometer-observation
     </span>
    </code>
    <span class="koboSpan" id="kobo.1542.1">
     dependency.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1543.1">
     Then, it adds
    </span>
    <a id="_idIndexMarker732">
    </a>
    <span class="koboSpan" id="kobo.1544.1">
     the configured
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1545.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1546.1">
     bean into the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1547.1">
      ApiClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1548.1">
     bean, followed by the configured
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1549.1">
      ApiClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1550.1">
     bean into the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1551.1">
      ProductsApi
     </span>
    </code>
    <span class="koboSpan" id="kobo.1552.1">
     bean.
    </span>
    <span class="koboSpan" id="kobo.1552.2">
     We use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1553.1">
      ProductsApi
     </span>
    </code>
    <span class="koboSpan" id="kobo.1554.1">
     bean to call the external Products API from the Order Management API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1555.1">
     This is how we ensure that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1556.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1557.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1558.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1559.1">
     values are generated and that
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1560.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1561.1">
     is properly propagated over all the services that we call from the Order Management API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1562.1">
     But also, after that, we are configuring a custom
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1563.1">
      SpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1564.1">
     with a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1565.1">
      LogSpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1566.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1566.2">
     That is used to log useful information from the trace context into the application logs.
    </span>
    <span class="koboSpan" id="kobo.1566.3">
     Information like the duration, the request origin, its timestamp, and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1567.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1568.1">
     give us various data to monitor and troubleshoot the application in production.
    </span>
    <span class="koboSpan" id="kobo.1568.2">
     In the next section, you will see a real example logged by this
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1569.1">
      SpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1570.1">
     .
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.1571.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.1572.1">
      What are beans?
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1573.1">
      In Spring, beans are
     </span>
     <a id="_idIndexMarker733">
     </a>
     <span class="koboSpan" id="kobo.1574.1">
      simply Java objects that are created, managed, and configured by the Spring
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1575.1">
       IoC (Inversion of Control)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1576.1">
      container.
     </span>
     <span class="koboSpan" id="kobo.1576.2">
      Think of them as the building blocks of your application.
     </span>
     <span class="koboSpan" id="kobo.1576.3">
      When you
     </span>
     <a id="_idIndexMarker734">
     </a>
     <span class="koboSpan" id="kobo.1577.1">
      define a class as a bean, you’re telling Spring to take responsibility for instantiating it, handling its dependencies, and managing its lifecycle.
     </span>
     <span class="koboSpan" id="kobo.1577.2">
      You can define beans using annotations like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1578.1">
       @Component
      </span>
     </code>
     <span class="koboSpan" id="kobo.1579.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1580.1">
       @Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1581.1">
      , or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1582.1">
       @Bean
      </span>
     </code>
     <span class="koboSpan" id="kobo.1583.1">
      , or through XML configuration.
     </span>
     <span class="koboSpan" id="kobo.1583.2">
      Once registered, these beans can be automatically “wired” together, meaning Spring will inject dependencies between them without you having to manually create and connect objects.
     </span>
     <span class="koboSpan" id="kobo.1583.3">
      This approach makes your code more modular, easier to test, and less coupled.
     </span>
    </p>
   </div>
   <h2 class="heading-2" id="_idParaDest-245">
    <a id="_idTextAnchor261">
    </a>
    <span class="koboSpan" id="kobo.1584.1">
     Viewing trace data
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1585.1">
     Once your application is instrumented with Micrometer Tracing, you can view the trace data in a distributed
    </span>
    <a id="_idIndexMarker735">
    </a>
    <span class="koboSpan" id="kobo.1586.1">
     tracing tool like Zipkin or Jaeger.
    </span>
    <span class="koboSpan" id="kobo.1586.2">
     These tools allow you to visualize traces and spans, helping you diagnose performance bottlenecks or failures across services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1587.1">
     Just to understand the difference between traces and spans:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1588.1">
      The trace would
     </span>
     <a id="_idIndexMarker736">
     </a>
     <span class="koboSpan" id="kobo.1589.1">
      include multiple spans representing the various services and operations involved in a request.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1590.1">
      Each span
     </span>
     <a id="_idIndexMarker737">
     </a>
     <span class="koboSpan" id="kobo.1591.1">
      includes timing data, enabling you to identify slow services or problematic operations.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1592.1">
     When Micrometer Tracing is implemented in a Spring Boot application, the logs will include additional fields such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1593.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1594.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1595.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1596.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1596.2">
     These fields help you correlate logs across services in a distributed system.
    </span>
    <span class="koboSpan" id="kobo.1596.3">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1597.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1598.1">
     remains the same for the entire lifecycle of a request across different services, while each service or operation within a service gets its own
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1599.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1600.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1601.1">
     Here is an
    </span>
    <a id="_idIndexMarker738">
    </a>
    <span class="koboSpan" id="kobo.1602.1">
     example of how the logs will look with Micrometer Tracing enabled and properly configured, calling the Products API from the Order Management API.
    </span>
    <span class="koboSpan" id="kobo.1602.2">
     It follows the logging pattern that we defined in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1603.1">
      applications.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.1604.1">
     file:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1605.1">2025-03-19T16:45:39.207-03:00  INFO [order-management-api,67db1edfd85f42d21368a69936519fd1,1368a69936519fd1] 24477 --- [order-management-api] [nio-8090-exec-1] [67db1edfd85f42d21368a69936519fd1-1368a69936519fd1] c.p.o.a.o.rest.ProductsQueryUseCaseImpl  : Getting product with id AA00001
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1606.1">
     These are the elements contained in this log:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1607.1">
       2025-03-19T16:45:39.207-03:00
      </span>
     </code>
     <span class="koboSpan" id="kobo.1608.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1609.1">
       Timestamp
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1610.1">
      – When this log entry was created
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1611.1">
       INFO
      </span>
     </code>
     <span class="koboSpan" id="kobo.1612.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1613.1">
       Log level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1614.1">
      – Indicates an informational message (not an error)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1615.1">
       [order-management-api,67db1edfd85f42d21368a69936519fd1,1368a69936519fd1]
      </span>
     </code>
     <span class="koboSpan" id="kobo.1616.1">
      : Defined pattern logging, containing:
     </span>
     <ul>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1617.1">
         Service name
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1618.1">
        – Identifies which microservice generated the log
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1619.1">
         Trace Id
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1620.1">
        – Unique identifier tracking the request across all services
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1621.1">
         Span Id
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1622.1">
        – Identifies this specific operation within the trace
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1623.1">
       24477
      </span>
     </code>
     <span class="koboSpan" id="kobo.1624.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1625.1">
       Process ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1626.1">
      – The operating system’s identifier for this application instance
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1627.1">
       ---
      </span>
     </code>
     <span class="koboSpan" id="kobo.1628.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1629.1">
       Separator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1630.1">
      – Visual divider in the log format
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1631.1">
       [order-management-api]
      </span>
     </code>
     <span class="koboSpan" id="kobo.1632.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1633.1">
       Application name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1634.1">
      – Repeats the service name for readability
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1635.1">
       [nio-8090-exec-1]
      </span>
     </code>
     <span class="koboSpan" id="kobo.1636.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1637.1">
       Thread name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1638.1">
      – The specific execution thread handling this request
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1639.1">
       [67db1edfd85f42d21368a69936519fd1-1368a69936519fd1]
      </span>
     </code>
     <span class="koboSpan" id="kobo.1640.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1641.1">
       Correlation ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1642.1">
      – Combined
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1643.1">
       traceId-spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1644.1">
      for easy request tracking
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1645.1">
       c.p.o.a.o.rest.ProductsQueryUseCaseImpl
      </span>
     </code>
     <span class="koboSpan" id="kobo.1646.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1647.1">
       Logger name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1648.1">
      – The class that generated this log (shortened)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1649.1">
       Getting product with id AA00001
      </span>
     </code>
     <span class="koboSpan" id="kobo.1650.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1651.1">
       Log message
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1652.1">
      – Simple text description of the operation being performed, showing the product ID being requested
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1653.1">
     This is how Micrometer Tracing enables the logs in the application to make it possible to track requests between applications.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1654.1">
     But if you want
    </span>
    <a id="_idIndexMarker739">
    </a>
    <span class="koboSpan" id="kobo.1655.1">
     to have even more details in your logs, you will get them from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1656.1">
      LogSpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1657.1">
     that we configured along with the beans in the configuration section.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1658.1">
     Let us look at a specific log generated by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1659.1">
      LogSpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1660.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-number"><span class="koboSpan" id="kobo.1661.1">2025-03-19T16:33:01.897-03:00</span></span>  <span class="hljs-string"><span class="koboSpan" id="kobo.1662.1">INFO</span></span><span class="koboSpan" id="kobo.1663.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1664.1">order-management-api</span></span><span class="koboSpan" id="kobo.1665.1">,</span><span class="hljs-string"><span class="koboSpan" id="kobo.1666.1">67db1beb2f77ede88c04d7187d10b32c</span></span><span class="koboSpan" id="kobo.1667.1">,</span><span class="hljs-string"><span class="koboSpan" id="kobo.1668.1">8c04d7187d10b32c</span></span><span class="koboSpan" id="kobo.1669.1">] </span><span class="hljs-number"><span class="koboSpan" id="kobo.1670.1">22620</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1671.1">---</span></span><span class="koboSpan" id="kobo.1672.1"> [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1673.1">order-management-api</span></span><span class="koboSpan" id="kobo.1674.1">] [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1675.1">nio-8090-exec-1</span></span><span class="koboSpan" id="kobo.1676.1">] [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1677.1">67db1beb2f77ede88c04d7187d10b32c-8c04d7187d10b32c</span></span><span class="koboSpan" id="kobo.1678.1">] </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1679.1">c.p.o.a.o.rest.ProductsApiConfiguration  :</span></span><span class="koboSpan" id="kobo.1680.1">
{
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1681.1">"traceId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1682.1">"67db1beb2f77ede88c04d7187d10b32c"</span></span><span class="koboSpan" id="kobo.1683.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1684.1">"parentId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1685.1">"8c04d7187d10b32c"</span></span><span class="koboSpan" id="kobo.1686.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1687.1">"id":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1688.1">"b362a6315dcb8bd9"</span></span><span class="koboSpan" id="kobo.1689.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1690.1">"kind":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1691.1">"CLIENT"</span></span><span class="koboSpan" id="kobo.1692.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1693.1">"name":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1694.1">"http get"</span></span><span class="koboSpan" id="kobo.1695.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1696.1">"timestamp":</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1697.1">1742412781886860</span></span><span class="koboSpan" id="kobo.1698.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1699.1">"duration":</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1700.1">9204</span></span><span class="koboSpan" id="kobo.1701.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1702.1">"localEndpoint":</span></span><span class="koboSpan" id="kobo.1703.1"> {
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1704.1">"serviceName":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1705.1">"order-management-api"</span></span><span class="koboSpan" id="kobo.1706.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1707.1">"ipv4":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1708.1">"192.168.96.1"</span></span><span class="koboSpan" id="kobo.1709.1">
    },
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1710.1">"tags":</span></span><span class="koboSpan" id="kobo.1711.1"> {
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1712.1">"application":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1713.1">"order-management-api"</span></span><span class="koboSpan" id="kobo.1714.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1715.1">"client.name":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1716.1">"localhost"</span></span><span class="koboSpan" id="kobo.1717.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1718.1">"exception":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1719.1">"none"</span></span><span class="koboSpan" id="kobo.1720.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1721.1">"http.url":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1722.1">"http://localhost:8080/api/products/AA00001"</span></span><span class="koboSpan" id="kobo.1723.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1724.1">"method":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1725.1">"GET"</span></span><span class="koboSpan" id="kobo.1726.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1727.1">"outcome":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1728.1">"SUCCESS"</span></span><span class="koboSpan" id="kobo.1729.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1730.1">"status":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1731.1">"200"</span></span><span class="koboSpan" id="kobo.1732.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1733.1">"uri":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1734.1">"/api/products/{productId}"</span></span><span class="koboSpan" id="kobo.1735.1">
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1736.1">
     This specific log is the one generated by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1737.1">
      LogSpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1738.1">
     configuration that adds all the information from the trace context.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1739.1">
     The beginning of this log follows the same structure defined in the logging pattern shown previously, but what differs here is the information contained in its body, which is in JSON format.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1740.1">
     Let us understand
    </span>
    <a id="_idIndexMarker740">
    </a>
    <span class="koboSpan" id="kobo.1741.1">
     each of the elements inside of this JSON body generated by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1742.1">
      LogSpanHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1743.1">
     and how they can help us in the observability of our applications:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1744.1">
       traceId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1745.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1746.1">
       Distributed trace identifier
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1747.1">
      – Links all spans across services for this request
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1748.1">
       parentId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1749.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1750.1">
       Parent span ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1751.1">
      – This field identifies the parent span from which the current span originated.
     </span>
     <span class="koboSpan" id="kobo.1751.2">
      If the current service or operation was triggered by another service, the parent span ID helps trace the hierarchy of calls between services.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1752.1">
       id
      </span>
     </code>
     <span class="koboSpan" id="kobo.1753.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1754.1">
       Span ID
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1755.1">
      – Unique identifier for this specific operation
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1756.1">
       kind
      </span>
     </code>
     <span class="koboSpan" id="kobo.1757.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1758.1">
       Span type
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1759.1">
      –
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1760.1">
       "CLIENT"
      </span>
     </code>
     <span class="koboSpan" id="kobo.1761.1">
      means the outbound request to another service
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1762.1">
       name
      </span>
     </code>
     <span class="koboSpan" id="kobo.1763.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1764.1">
       Operation name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1765.1">
      – Describes what action was performed
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1766.1">
       timestamp
      </span>
     </code>
     <span class="koboSpan" id="kobo.1767.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1768.1">
       Start time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1769.1">
      – When this operation began (in microseconds)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1770.1">
       duration
      </span>
     </code>
     <span class="koboSpan" id="kobo.1771.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1772.1">
       Execution time
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1773.1">
      – How long the operation took (6.246ms)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1774.1">
       localEndpoint
      </span>
     </code>
     <span class="koboSpan" id="kobo.1775.1">
      :
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1776.1">
       Service information
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1777.1">
      – Details about the originating service
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1778.1">
       tags
      </span>
     </code>
     <span class="koboSpan" id="kobo.1779.1">
      : Contextual metadata containing
     </span>
     <ul>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1780.1">
         Application name
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1781.1">
        – Service identifier
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1782.1">
         Client name
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1783.1">
        – Target server hostname
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1784.1">
         Exception
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1785.1">
        – Error status (none means successful)
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1786.1">
         HTTP URL
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1787.1">
        – Full URL that was called
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1788.1">
         Method
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1789.1">
        – HTTP verb used (
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1790.1">
         GET
        </span>
       </code>
       <span class="koboSpan" id="kobo.1791.1">
        )
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1792.1">
         Outcome
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1793.1">
        – Result category (
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1794.1">
         SUCCESS
        </span>
       </code>
       <span class="koboSpan" id="kobo.1795.1">
        )
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1796.1">
         Status
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1797.1">
        – HTTP response code (
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1798.1">
         200 = OK
        </span>
       </code>
       <span class="koboSpan" id="kobo.1799.1">
        )
       </span>
      </li>
      <li class="bulletList">
       <strong class="keyWord">
        <span class="koboSpan" id="kobo.1800.1">
         URI
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1801.1">
        – Request path pattern with path variables
       </span>
      </li>
     </ul>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1802.1">
     If you noticed, we talked about
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1803.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1804.1">
     in this example.
    </span>
    <span class="koboSpan" id="kobo.1804.2">
     Let us understand better how this relates to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1805.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1806.1">
     and how this can be useful in monitoring the performance of distributed systems.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-246">
    <a id="_idTextAnchor262">
    </a>
    <span class="koboSpan" id="kobo.1807.1">
     Understanding parentSpanId and spanId
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1808.1">
     In distributed
    </span>
    <a id="_idIndexMarker741">
    </a>
    <span class="koboSpan" id="kobo.1809.1">
     tracing, every
    </span>
    <a id="_idIndexMarker742">
    </a>
    <span class="koboSpan" id="kobo.1810.1">
     request generates
    </span>
    <a id="_idIndexMarker743">
    </a>
    <span class="koboSpan" id="kobo.1811.1">
     a trace, which consists of
    </span>
    <a id="_idIndexMarker744">
    </a>
    <span class="koboSpan" id="kobo.1812.1">
     multiple spans.
    </span>
    <span class="koboSpan" id="kobo.1812.2">
     A span represents a single unit of work, such as a service call, database query, or a specific business process within a service.
    </span>
    <span class="koboSpan" id="kobo.1812.3">
     Each span includes a unique identifier, called the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1813.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1814.1">
     , and a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1815.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1816.1">
     that links it to the span from which it originated.
    </span>
    <span class="koboSpan" id="kobo.1816.2">
     This parent-child relationship helps to visualize how requests pro
    </span>
    <a id="_idTextAnchor263">
    </a>
    <span class="koboSpan" id="kobo.1817.1">
     pagate through different services in a distributed system.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1818.1">
     In sum, a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1819.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1820.1">
     is a unique
    </span>
    <a id="_idIndexMarker745">
    </a>
    <span class="koboSpan" id="kobo.1821.1">
     identifier for the current operation or service, and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1822.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1823.1">
     is the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1824.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1825.1">
     of the
    </span>
    <a id="_idIndexMarker746">
    </a>
    <span class="koboSpan" id="kobo.1826.1">
     calling operation or service.
    </span>
    <span class="koboSpan" id="kobo.1826.2">
     This field links spans together, showing which service called another.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1827.1">
     Using these IDs, tracing tools like Zipkin or Jaeger can display a complete timeline of the trace, revealing the
    </span>
    <a id="_idIndexMarker747">
    </a>
    <span class="koboSpan" id="kobo.1828.1">
     structure and timing of each request across services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1829.1">
     To visualize
    </span>
    <a id="_idIndexMarker748">
    </a>
    <span class="koboSpan" id="kobo.1830.1">
     the relationship between
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1831.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1832.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1833.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1834.1">
     , let’s walk through an example trace for a user registration request in an e-commerce application, where each service involved in the trace has its own
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1835.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1836.1">
     and, if applicable, a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1837.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1838.1">
     .
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1839.1">
      An API gateway receives the initial request and generates a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1840.1">
       traceId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1841.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1842.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1843.1">
      .
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.1844.1">
        The
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1845.1">
         User
        </span>
       </code>
       <span class="koboSpan" id="kobo.1846.1">
        service handles the user registration, with a span linked to the API gateway’s
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1847.1">
         spanId
        </span>
       </code>
       <span class="koboSpan" id="kobo.1848.1">
        as its
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1849.1">
         parentSpanId
        </span>
       </code>
       <span class="koboSpan" id="kobo.1850.1">
        .
       </span>
      </li>
     </ul>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1851.1">
      A
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1852.1">
       Notification
      </span>
     </code>
     <span class="koboSpan" id="kobo.1853.1">
      service sends a welcome email to the user.
     </span>
     <span class="koboSpan" id="kobo.1853.2">
      This service’s span has the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1854.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1855.1">
      of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1856.1">
       User
      </span>
     </code>
     <span class="koboSpan" id="kobo.1857.1">
      service as its
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1858.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1859.1">
      .
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1860.1">
     Below is a simplified visualization of what this trace might look like in a tool like Jaeger:
    </span>
   </p>
   <table class="table-container" id="table001-1">
    <tbody>
     <tr>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1861.1">
          Span Name
         </span>
        </strong>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1862.1">
          Service
         </span>
        </strong>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1863.1">
          spanId
         </span>
        </strong>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1864.1">
          parentSpanId
         </span>
        </strong>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1865.1">
          Start Time
         </span>
        </strong>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <strong class="keyWord">
         <span class="koboSpan" id="kobo.1866.1">
          Duration
         </span>
        </strong>
       </p>
      </td>
     </tr>
     <tr>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1867.1">
          register_user
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1868.1">
         API Gateway
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1869.1">
          span1
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1870.1">
         -
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1871.1">
         0ms
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1872.1">
         15ms
        </span>
       </p>
      </td>
     </tr>
     <tr>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1873.1">
          create_user_record
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1874.1">
         User
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1875.1">
          span2
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1876.1">
          span1
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1877.1">
         5ms
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1878.1">
         40ms
        </span>
       </p>
      </td>
     </tr>
     <tr>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1879.1">
          send_email
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1880.1">
         Notification
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1881.1">
          span3
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <code class="inlineCode">
         <span class="koboSpan" id="kobo.1882.1">
          span2
         </span>
        </code>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1883.1">
         25ms
        </span>
       </p>
      </td>
      <td class="table-cell">
       <p class="normal">
        <span class="koboSpan" id="kobo.1884.1">
         30ms
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="normal">
    <span class="koboSpan" id="kobo.1885.1">
     In this visualization:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1886.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1887.1">
       register_user
      </span>
     </code>
     <span class="koboSpan" id="kobo.1888.1">
      span from the API gateway is the root of the trace.
     </span>
     <span class="koboSpan" id="kobo.1888.2">
      It has no
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1889.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1890.1">
      because it starts the trace.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1891.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1892.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1893.1">
      span (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1894.1">
       create_user_record
      </span>
     </code>
     <span class="koboSpan" id="kobo.1895.1">
      ) is a child of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1896.1">
       API Gateway
      </span>
     </code>
     <span class="koboSpan" id="kobo.1897.1">
      span, so it references
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1898.1">
       span1
      </span>
     </code>
     <span class="koboSpan" id="kobo.1899.1">
      as its
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1900.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1901.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1902.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1903.1">
       Notification
      </span>
     </code>
     <span class="koboSpan" id="kobo.1904.1">
      service span (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1905.1">
       send_email
      </span>
     </code>
     <span class="koboSpan" id="kobo.1906.1">
      ) is a child of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1907.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1908.1">
      span and has
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1909.1">
       span2
      </span>
     </code>
     <span class="koboSpan" id="kobo.1910.1">
      as its
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1911.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.1912.1">
      , indicating it was triggered by the user creation process.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1913.1">
     The tracing
    </span>
    <a id="_idIndexMarker749">
    </a>
    <span class="koboSpan" id="kobo.1914.1">
     tool displays the parent-child hierarchy as a timeline to
    </span>
    <a id="_idIndexMarker750">
    </a>
    <span class="koboSpan" id="kobo.1915.1">
     visualize request propagation.
    </span>
    <span class="koboSpan" id="kobo.1915.2">
     Below is a diagram that matches
    </span>
    <a id="_idIndexMarker751">
    </a>
    <span class="koboSpan" id="kobo.1916.1">
     this hierarchy, showing
    </span>
    <a id="_idIndexMarker752">
    </a>
    <span class="koboSpan" id="kobo.1917.1">
     how each service relates in time:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1918.1">0ms        15ms         40ms           70ms
|-----------|------------|--------------|
| API       | User       | Notification |
| Gateway   | Service    | Service      |
| register_ | create_    | send_        |
| user      | user       | email        |
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1919.1">
     In a trace visualization tool:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1920.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1921.1">
       API Gateway
      </span>
     </code>
     <span class="koboSpan" id="kobo.1922.1">
      span (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1923.1">
       span1
      </span>
     </code>
     <span class="koboSpan" id="kobo.1924.1">
      ) initiates the request.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1925.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1926.1">
      (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1927.1">
       span2
      </span>
     </code>
     <span class="koboSpan" id="kobo.1928.1">
      ) begins shortly after
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1929.1">
       API Gateway
      </span>
     </code>
     <span class="koboSpan" id="kobo.1930.1">
      , and it takes more time as it performs operations like database insertion, for example.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1931.1">
       Notification Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1932.1">
      (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1933.1">
       span3
      </span>
     </code>
     <span class="koboSpan" id="kobo.1934.1">
      ) starts after
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1935.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1936.1">
      completes the user creation.
     </span>
     <span class="koboSpan" id="kobo.1936.2">
      The duration of each span indicates how long each operation took.
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-247">
    <a id="_idTextAnchor264">
    </a>
    <span class="koboSpan" id="kobo.1937.1">
     Parent-child hierarchy insights
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1938.1">
     This trace
    </span>
    <a id="_idIndexMarker753">
    </a>
    <span class="koboSpan" id="kobo.1939.1">
     hierarchy is useful for:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1940.1">
       Identifying bottlenecks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1941.1">
      : If
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1942.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1943.1">
      took unusually long, it would appear as a longer
     </span>
     <a id="_idIndexMarker754">
     </a>
     <span class="koboSpan" id="kobo.1944.1">
      bar in the timeline, prompting an investiga
     </span>
     <a id="_idTextAnchor265">
     </a>
     <span class="koboSpan" id="kobo.1945.1">
      tion.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1946.1">
       Tracing errors
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1947.1">
      : If an error occurred in
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1948.1">
       Notification Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1949.1">
      , you could see it in the trace and quickly trace it back to the originating request from
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1950.1">
       User Service
      </span>
     </code>
     <span class="koboSpan" id="kobo.1951.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1952.1">
       Understanding dependencies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1953.1">
      : By looking at the parent-child structure, you can see how each service depends on others and the sequence of operations.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1954.1">
     This visualization and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1955.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1956.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1957.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1958.1">
     relationship allow software engineers, architects, and system analysts to understand the flow and timeline of each request across multiple services, helping optimize performance, troubleshoot issues, and gain insights into the system’s behavior.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-248">
    <a id="_idTextAnchor266">
    </a>
    <span class="koboSpan" id="kobo.1959.1">
     Logs across multiple services
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1960.1">
     When a request flows through multiple services in a distributed system, each service logs its part of the
    </span>
    <a id="_idIndexMarker755">
    </a>
    <span class="koboSpan" id="kobo.1961.1">
     request independently.
    </span>
    <span class="koboSpan" id="kobo.1961.2">
     By correlating these logs through unique identifiers like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1962.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1963.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1964.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1965.1">
     , we can connect individual logs across services to form a complete picture of the request’s journey.
    </span>
    <span class="koboSpan" id="kobo.1965.2">
     This end-to-end visibility is crucial for understanding how services interact, identifying bottlenecks, and troubleshooting errors.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1966.1">
     In this example, a User Registration request passes through three services:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1967.1">
       API Gateway
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1968.1">
      : Receives the initial request and routes it to the appropriate backend service.
     </span>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1969.1">
       User Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1970.1">
      : Processes the registration by creating a user record in the database.
     </span>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1971.1">
       Notification Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1972.1">
      : Sends a welcome email to the user upon successful registration.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1973.1">
     Each service logs its part of the request using the same
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1974.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1975.1">
     to correlate logs.
    </span>
    <span class="koboSpan" id="kobo.1975.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1976.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1977.1">
     is unique within each service, while the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1978.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1979.1">
     links it back to the calling service.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1980.1">
     The diagram below shows how the request moves through each service, with corresponding logs identified by numbers that correlate to the example logs below:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1981.1">           +------------------------+
           |     API Gateway        |
           | traceId: A, spanId: 1  |
           +------------------------+
                      |
                      | parentSpanId: -
                      |
           +----------v-------------+
           |      User Service      |
           | traceId: A, spanId: 2  |
           | parentSpanId: 1        |
           +------------------------+
                      |
                      | parentSpanId: 2
                      |
           +----------v-------------+
           | Notification Service   |
           | traceId: A, spanId: 3  |
           | parentSpanId: 2        |
           +------------------------+
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1982.1">
     Each log entry shown below is marked with a number corresponding to the steps in the diagram above.
    </span>
    <span class="koboSpan" id="kobo.1982.2">
     By following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1983.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1984.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1985.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1986.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1987.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1988.1">
     , we can see how each service is connected within the trace, enabling us to reconstruct the request’s journey.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1989.1">
     Next, let us see examples of logs on each service this trace is going through.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-249">
    <a id="_idTextAnchor267">
    </a>
    <span class="koboSpan" id="kobo.1990.1">
     API Gateway log
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1991.1">
     When the
    </span>
    <a id="_idIndexMarker756">
    </a>
    <span class="koboSpan" id="kobo.1992.1">
     API gateway receives the request, it generates
    </span>
    <a id="_idIndexMarker757">
    </a>
    <span class="koboSpan" id="kobo.1993.1">
     a new
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1994.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1995.1">
     (A) and its own
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1996.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.1997.1">
     (1).
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1998.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1999.1">"timestamp":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2000.1">"2024-10-23T10:00:00Z"</span></span><span class="koboSpan" id="kobo.2001.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2002.1">"level":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2003.1">"INFO"</span></span><span class="koboSpan" id="kobo.2004.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2005.1">"service":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2006.1">"API Gateway"</span></span><span class="koboSpan" id="kobo.2007.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2008.1">"traceId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2009.1">"A"</span></span><span class="koboSpan" id="kobo.2010.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2011.1">"spanId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2012.1">"1"</span></span><span class="koboSpan" id="kobo.2013.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2014.1">"parentSpanId":</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2015.1">null</span></span><span class="koboSpan" id="kobo.2016.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2017.1">"message":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2018.1">"Received request for user registration"</span></span><span class="koboSpan" id="kobo.2019.1">
}
</span></code></pre>
   <h3 class="heading-3" id="_idParaDest-250">
    <a id="_idTextAnchor268">
    </a>
    <span class="koboSpan" id="kobo.2020.1">
     User Service log
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.2021.1">
     The User
    </span>
    <a id="_idIndexMarker758">
    </a>
    <span class="koboSpan" id="kobo.2022.1">
     Service processes the registration, using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2023.1">
      traceId (A)
     </span>
    </code>
    <span class="koboSpan" id="kobo.2024.1">
     to connect
    </span>
    <a id="_idIndexMarker759">
    </a>
    <span class="koboSpan" id="kobo.2025.1">
     it to the original request.
    </span>
    <span class="koboSpan" id="kobo.2025.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2026.1">
      User Service
     </span>
    </code>
    <span class="koboSpan" id="kobo.2027.1">
     log entry has a unique
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2028.1">
      spanId (2)
     </span>
    </code>
    <span class="koboSpan" id="kobo.2029.1">
     and references the API Gateway’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2030.1">
      spanId (1)
     </span>
    </code>
    <span class="koboSpan" id="kobo.2031.1">
     as its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2032.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2033.1">
     .
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2034.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2035.1">"timestamp":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2036.1">"2024-10-23T10:00:05Z"</span></span><span class="koboSpan" id="kobo.2037.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2038.1">"level":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2039.1">"INFO"</span></span><span class="koboSpan" id="kobo.2040.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2041.1">"service":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2042.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2043.1">User Service"</span></span><span class="koboSpan" id="kobo.2044.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2045.1">"traceId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2046.1">"A"</span></span><span class="koboSpan" id="kobo.2047.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2048.1">"spanId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2049.1">"2"</span></span><span class="koboSpan" id="kobo.2050.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2051.1">"parentSpanId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2052.1">"1"</span></span><span class="koboSpan" id="kobo.2053.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2054.1">"message":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2055.1">"Processing user registration"</span></span><span class="koboSpan" id="kobo.2056.1">
}
</span></code></pre>
   <h3 class="heading-3" id="_idParaDest-251">
    <a id="_idTextAnchor269">
    </a>
    <span class="koboSpan" id="kobo.2057.1">
     Notification Service log
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.2058.1">
     After the
    </span>
    <a id="_idIndexMarker760">
    </a>
    <span class="koboSpan" id="kobo.2059.1">
     User Service completes the user creation, it triggers the Notification
    </span>
    <a id="_idIndexMarker761">
    </a>
    <span class="koboSpan" id="kobo.2060.1">
     Service to send a welcome email.
    </span>
    <span class="koboSpan" id="kobo.2060.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2061.1">
      Notification Service
     </span>
    </code>
    <span class="koboSpan" id="kobo.2062.1">
     log entry includes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2063.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2064.1">
     (A) to maintain continuity, generates its own
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2065.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2066.1">
     (3), and uses the User Service’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2067.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2068.1">
     (2) as its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2069.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2070.1">
     .
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2071.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2072.1">"timestamp":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2073.1">"2024-10-23T10:00:10Z"</span></span><span class="koboSpan" id="kobo.2074.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2075.1">"level":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2076.1">"INFO"</span></span><span class="koboSpan" id="kobo.2077.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2078.1">"service":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2079.1">"Notification Service"</span></span><span class="koboSpan" id="kobo.2080.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2081.1">"traceId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2082.1">"A"</span></span><span class="koboSpan" id="kobo.2083.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2084.1">"spanId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2085.1">"3"</span></span><span class="koboSpan" id="kobo.2086.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2087.1">"parentSpanId":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2088.1">"2"</span></span><span class="koboSpan" id="kobo.2089.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2090.1">"message":</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2091.1">"Sending welcome email"</span></span><span class="koboSpan" id="kobo.2092.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2093.1">
     In this example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2094.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2095.1">
     (A) remains the same across all services, linking the logs together to represent
    </span>
    <a id="_idIndexMarker762">
    </a>
    <span class="koboSpan" id="kobo.2096.1">
     the entire request flow.
    </span>
    <span class="koboSpan" id="kobo.2096.2">
     Each log’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2097.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2098.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2099.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2100.1">
     establish a parent-child relationship, showing how each service is
    </span>
    <a id="_idIndexMarker763">
    </a>
    <span class="koboSpan" id="kobo.2101.1">
     connected in the sequence.
    </span>
    <span class="koboSpan" id="kobo.2101.2">
     Here’s how these logs work together:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2102.1">
       Log 1 (API Gateway)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2103.1">
      : Initiates the request with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2104.1">
       traceId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2105.1">
      (A) and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2106.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2107.1">
      (1).
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2108.1">
       Log 2 (User Service)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2109.1">
      : Continues the request, referencing the API Gateway’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2110.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2111.1">
      (1) with its
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2112.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2113.1">
      and creating a new
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2114.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2115.1">
      (2) for itself.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2116.1">
       Log 3 (Notification Service)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2117.1">
      : Completes the flow by linking back to the User Service’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2118.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2119.1">
      (2) and creating its own
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2120.1">
       spanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2121.1">
      (3).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2122.1">
     Using the combination of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2123.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2124.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2125.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2126.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2127.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2128.1">
     , we can follow the lifecycle of the user registration request as it moves from service to service, providing a clear and structured view of the request’s journey.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2129.1">
     The logs are useful in the following ways:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2130.1">
       End-to-end traceability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2131.1">
      : By searching for logs with the same
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2132.1">
       traceId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2133.1">
      , you can trace a request across different services (API Gateway, User Service, and Notification Service) and see how the request was handled at each step.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2134.1">
       Service dependencies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2135.1">
      : The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2136.1">
       parentSpanId
      </span>
     </code>
     <span class="koboSpan" id="kobo.2137.1">
      helps you understand how services are connected.
     </span>
     <span class="koboSpan" id="kobo.2137.2">
      In the example above, the Notification service was called by the User service, which was triggered by the API Gateway.
     </span>
     <span class="koboSpan" id="kobo.2137.3">
      The logs show the hierarchy of calls.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2138.1">
       Performance insights
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2139.1">
      : Comparing the timestamps across spans can give you insights into performance bottlenecks.
     </span>
     <span class="koboSpan" id="kobo.2139.2">
      For instance, you can measure how much time each service took to handle the request by comparing the timestamps.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2140.1">
     Micrometer Tracing enriches your logs with essential trace and span data that allows you to track requests across distributed systems.
    </span>
    <span class="koboSpan" id="kobo.2140.2">
     This traceability simplifies troubleshooting and helps you visualize the flow of requests, making it easier to detect performance issues or service failures.
    </span>
    <span class="koboSpan" id="kobo.2140.3">
     By integrating this data with tools like Zipkin or Jaeger, you can also visualize traces in real time, further enhancing your observability strategy.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-252">
    <a id="_idTextAnchor270">
    </a>
    <span class="koboSpan" id="kobo.2141.1">
     Visualizing traces with Zipkin
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2142.1">
     To be able
    </span>
    <a id="_idIndexMarker764">
    </a>
    <span class="koboSpan" id="kobo.2143.1">
     to run a local Zipkin instance on your machine, create the
    </span>
    <a id="_idIndexMarker765">
    </a>
    <span class="koboSpan" id="kobo.2144.1">
     following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2145.1">
      docker-compose.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.2146.1">
     file, which will automatically download and configure your local Zipkin instance with the following content:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.2147.1">services:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2148.1">zipkin:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2149.1">image:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2150.1">ghcr.io/openzipkin/zipkin-slim:${TAG:-latest}</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2151.1">container_name:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2152.1">zipkin</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2153.1">environment:</span></span>
      <span class="hljs-bullet"><span class="koboSpan" id="kobo.2154.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2155.1">STORAGE_TYPE=mem</span></span>
      <span class="hljs-bullet"><span class="koboSpan" id="kobo.2156.1">-</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2157.1">MYSQL_HOST=mysql</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2158.1">ports:</span></span>
      <span class="hljs-bullet"><span class="koboSpan" id="kobo.2159.1">-</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2160.1">9411</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2161.1">:9411</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2162.1">
     This file defines from where we are getting the Docker image and the version, that is the latest available.
    </span>
    <span class="koboSpan" id="kobo.2162.2">
     Also, we will run this at memory, using the default port
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2163.1">
      9411
     </span>
    </code>
    <span class="koboSpan" id="kobo.2164.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2165.1">
     To run this container, you need Docker installed on your system.
    </span>
    <span class="koboSpan" id="kobo.2165.2">
     Once it is installed, open a console in the same directory where this file is saved and run the following command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2166.1">docker compose up
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2167.1">
     Once the application is running, go to your local running Zipkin’s UI (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2168.1">
      http://localhost:9411
     </span>
    </code>
    <span class="koboSpan" id="kobo.2169.1">
     ) to view the traces.
    </span>
    <span class="koboSpan" id="kobo.2169.2">
     You should see a graphical representation of the trace, showing the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2170.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2171.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2172.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2173.1">
     , and the parent-child relationships across services.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2174.1">
     <img alt="Figure 9.1 – Complete trace journey in Zipkin dashboard with Micrometer" src="../Images/B21843_09_1.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2175.1">
     Figure 9.1 – Complete trace journey in Zipkin dashboard with Micrometer
    </span>
   </p>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2176.1">
     Adding custom spans
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2177.1">
     In addition to the automatic tracing of HTTP requests, you may want to create custom spans to trace
    </span>
    <a id="_idIndexMarker766">
    </a>
    <span class="koboSpan" id="kobo.2178.1">
     specific operations within your services.
    </span>
    <span class="koboSpan" id="kobo.2178.2">
     For example, you can
    </span>
    <a id="_idIndexMarker767">
    </a>
    <span class="koboSpan" id="kobo.2179.1">
     trace important business logic or database queries.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2180.1">
     To create custom spans, inject the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2181.1">
      Tracer
     </span>
    </code>
    <span class="koboSpan" id="kobo.2182.1">
     into your service and use it to manually create and manage spans:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2183.1">import</span></span><span class="koboSpan" id="kobo.2184.1"> io.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2185.1">micrometer</span></span><span class="koboSpan" id="kobo.2186.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2187.1">tracing</span></span><span class="koboSpan" id="kobo.2188.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2189.1">Tracer</span></span><span class="koboSpan" id="kobo.2190.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2191.1">import</span></span><span class="koboSpan" id="kobo.2192.1"> io.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2193.1">micrometer</span></span><span class="koboSpan" id="kobo.2194.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2195.1">tracing</span></span><span class="koboSpan" id="kobo.2196.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2197.1">Span</span></span><span class="koboSpan" id="kobo.2198.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2199.1">import</span></span><span class="koboSpan" id="kobo.2200.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2201.1">springframework</span></span><span class="koboSpan" id="kobo.2202.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2203.1">beans</span></span><span class="koboSpan" id="kobo.2204.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2205.1">factory</span></span><span class="koboSpan" id="kobo.2206.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2207.1">annotation</span></span><span class="koboSpan" id="kobo.2208.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2209.1">Autowired</span></span><span class="koboSpan" id="kobo.2210.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2211.1">import</span></span><span class="koboSpan" id="kobo.2212.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2213.1">springframework</span></span><span class="koboSpan" id="kobo.2214.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2215.1">stereotype</span></span><span class="koboSpan" id="kobo.2216.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2217.1">Service</span></span><span class="koboSpan" id="kobo.2218.1">;
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.2219.1">Service</span></span><span class="koboSpan" id="kobo.2220.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2221.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2222.1">UserService</span></span><span class="koboSpan" id="kobo.2223.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.2224.1">Autowired</span></span><span class="koboSpan" id="kobo.2225.1">
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.2226.1">Tracer</span></span><span class="koboSpan" id="kobo.2227.1"> tracer;
    public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2228.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2229.1">createUser</span></span><span class="koboSpan" id="kobo.2230.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2231.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2232.1"> userId</span></span><span class="koboSpan" id="kobo.2233.1">) {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.2234.1">Span</span></span><span class="koboSpan" id="kobo.2235.1"> newUserSpan = tracer.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2236.1">nextSpan</span></span><span class="koboSpan" id="kobo.2237.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.2238.1">name</span></span><span class="koboSpan" id="kobo.2239.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2240.1">"createUser"</span></span><span class="koboSpan" id="kobo.2241.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2242.1">start</span></span><span class="koboSpan" id="kobo.2243.1">();
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.2244.1">try</span></span><span class="koboSpan" id="kobo.2245.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.2246.1">Tracer</span></span><span class="koboSpan" id="kobo.2247.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2248.1">SpanInScope</span></span><span class="koboSpan" id="kobo.2249.1"> ws = tracer.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2250.1">withSpan</span></span><span class="koboSpan" id="kobo.2251.1">(newUserSpan.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2252.1">start</span></span><span class="koboSpan" id="kobo.2253.1">())) {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2254.1">// Business logic for creating a user</span></span>
            <span class="hljs-comment"><span class="koboSpan" id="kobo.2255.1">// Simulate a process that takes time, e.g., a database call</span></span>
            <span class="hljs-title"><span class="koboSpan" id="kobo.2256.1">Thread</span></span><span class="koboSpan" id="kobo.2257.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2258.1">sleep</span></span><span class="koboSpan" id="kobo.2259.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2260.1">1000</span></span><span class="koboSpan" id="kobo.2261.1">);
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.2262.1">System</span></span><span class="koboSpan" id="kobo.2263.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2264.1">out</span></span><span class="koboSpan" id="kobo.2265.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2266.1">println</span></span><span class="koboSpan" id="kobo.2267.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2268.1">"User created with ID: "</span></span><span class="koboSpan" id="kobo.2269.1"> + userId);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2270.1">catch</span></span><span class="koboSpan" id="kobo.2271.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.2272.1">Exception</span></span><span class="koboSpan" id="kobo.2273.1"> e) {
            newUserSpan.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2274.1">error</span></span><span class="koboSpan" id="kobo.2275.1">(e);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2276.1">finally</span></span><span class="koboSpan" id="kobo.2277.1"> {
            newUserSpan.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2278.1">end</span></span><span class="koboSpan" id="kobo.2279.1">();
        }
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2280.1">
     In this example, we use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2281.1">
      Tracer
     </span>
    </code>
    <span class="koboSpan" id="kobo.2282.1">
     to create a custom span called
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2283.1">
      createUser
     </span>
    </code>
    <span class="koboSpan" id="kobo.2284.1">
     , which tracks the execution of
    </span>
    <a id="_idIndexMarker768">
    </a>
    <span class="koboSpan" id="kobo.2285.1">
     the user creation process.
    </span>
    <span class="koboSpan" id="kobo.2285.2">
     The span is manually
    </span>
    <a id="_idIndexMarker769">
    </a>
    <span class="koboSpan" id="kobo.2286.1">
     started with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2287.1">
      start()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2288.1">
     and completed with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2289.1">
      end()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2290.1">
     .
    </span>
    <span class="koboSpan" id="kobo.2290.2">
     We also ensure that any exceptions are captured in the span by calling
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2291.1">
      newUserSpan.error(e)
     </span>
    </code>
    <span class="koboSpan" id="kobo.2292.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2293.1">
     Next, let us understand how we can extract metrics from the tracing data and how this can help us monitor the whole application environment behavior.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-253">
    <a id="_idTextAnchor271">
    </a>
    <span class="koboSpan" id="kobo.2294.1">
     Metrics from tracing data
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2295.1">
     Metrics for RESTful web services are essential for evaluating and optimizing the performance of these services.
    </span>
    <span class="koboSpan" id="kobo.2295.2">
     These
    </span>
    <a id="_idIndexMarker770">
    </a>
    <span class="koboSpan" id="kobo.2296.1">
     metrics provide insights into how efficiently APIs handle requests, process data, and deliver responses.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2297.1">
     This helps
    </span>
    <a id="_idIndexMarker771">
    </a>
    <span class="koboSpan" id="kobo.2298.1">
     in ensuring that RESTful web services operate smoothly, providing a better user experience and meeting business objectives.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2299.1">
     With Micrometer Tracing in place, you can extract meaningful metrics from your trace data.
    </span>
    <span class="koboSpan" id="kobo.2299.2">
     Metrics give you quantitative insights into your API’s performance and health.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2300.1">
     Metrics like latency, throughput, and error rates are key to understanding how your REST API performs under load.
    </span>
    <span class="koboSpan" id="kobo.2300.2">
     These metrics help detect slow services, overloaded endpoints, or frequent errors that need to be addressed.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-254">
    <a id="_idTextAnchor272">
    </a>
    <span class="koboSpan" id="kobo.2301.1">
     Types of metrics to monitor
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2302.1">
     Some
    </span>
    <a id="_idIndexMarker772">
    </a>
    <span class="koboSpan" id="kobo.2303.1">
     common metrics to track in REST APIs include:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2304.1">
       Request duration
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2305.1">
      : How long does it take for the API to respond?
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2306.1">
       Request count
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2307.1">
      : The number of requests served over a period.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2308.1">
       Success/failure rate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2309.1">
      : Percentage of successful vs.
     </span>
     <span class="koboSpan" id="kobo.2309.2">
      failed requests.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2310.1">
       HTTP error codes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2311.1">
      : Count of
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2312.1">
       4xx
      </span>
     </code>
     <span class="koboSpan" id="kobo.2313.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2314.1">
       5xx
      </span>
     </code>
     <span class="koboSpan" id="kobo.2315.1">
      responses.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2316.1">
     You can configure Micrometer to track these metrics automatically.
    </span>
    <span class="koboSpan" id="kobo.2316.2">
     For example, to track request duration, add the following configuration:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2317.1">management.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2318.1">metrics</span></span><span class="koboSpan" id="kobo.2319.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2320.1">web</span></span><span class="koboSpan" id="kobo.2321.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2322.1">server</span></span><span class="koboSpan" id="kobo.2323.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2324.1">request</span></span><span class="koboSpan" id="kobo.2325.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2326.1">autotime</span></span><span class="koboSpan" id="kobo.2327.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2328.1">enabled</span></span><span class="koboSpan" id="kobo.2329.1">=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2330.1">true</span></span>
</code></pre>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.2331.1">
      Metrics examples
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2332.1">
     :
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2333.1">
       Latency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2334.1">
      : Average time it takes for a request to complete (e.g., 200ms).
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2335.1">
       Throughput
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2336.1">
      : The system processes an average of 150 requests per second during peak hours.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2337.1">
       Error Rate
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2338.1">
      : Percentage of requests that fail (e.g., 5% of requests return a 500 error).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2339.1">
     Metrics can
    </span>
    <a id="_idIndexMarker773">
    </a>
    <span class="koboSpan" id="kobo.2340.1">
     help identify performance bottlenecks.
    </span>
    <span class="koboSpan" id="kobo.2340.2">
     For instance, if one of your API endpoints consistently has a higher latency than others, it might indicate a need to optimize database queries, improve caching, or refactor code.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2341.1">
     For example, if the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2342.1">
      /api/v1/users
     </span>
    </code>
    <span class="koboSpan" id="kobo.2343.1">
     endpoint shows an average response time of 500ms, but other endpoints respond in under 100ms, you can use tracing data to find out where the delay occurs (e.g., in a database query or a third-party API call).
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-255">
    <a id="_idTextAnchor273">
    </a>
    <span class="koboSpan" id="kobo.2344.1">
     Viewing metrics with Micrometer
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2345.1">
     Micrometer integrates with Prometheus and Grafana to visualize your metrics in real-time dashboards.
    </span>
    <span class="koboSpan" id="kobo.2345.2">
     This
    </span>
    <a id="_idIndexMarker774">
    </a>
    <span class="koboSpan" id="kobo.2346.1">
     allows you to create custom views and alerts based on the performance of your API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2347.1">
     For example, in Grafana, you can create a dashboard that visualizes the latency of your API endpoints
    </span>
    <a id="_idIndexMarker775">
    </a>
    <span class="koboSpan" id="kobo.2348.1">
     over time using time series graphs.
    </span>
    <span class="koboSpan" id="kobo.2348.2">
     These graphs help you spot trends and optimize performance by highlighting periods of increased latency, which might indicate bottlenecks or resource constraints.
    </span>
    <span class="koboSpan" id="kobo.2348.3">
     For instance, you can use a line chart to display how the average response time of a specific endpoint changes over time, making it easier to identify patterns or anomalies.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2349.1">
     Additionally, Grafana supports a variety of other visualizations that can be used to display metrics such as request counts, success/failure rates, and HTTP error codes.
    </span>
    <span class="koboSpan" id="kobo.2349.2">
     For example, you can use bar charts to compare the number of successful versus failed requests over a given period, or pie charts to show the distribution of different HTTP status codes returned by your API.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2350.1">
     <img alt="Figure 9.2 – Metrics displayed in a Grafana dashboard" src="../Images/B21843_09_2.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2351.1">
     Figure 9.2 – Metrics displayed in a Grafana dashboard
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2352.1">
     Now that
    </span>
    <a id="_idIndexMarker776">
    </a>
    <span class="koboSpan" id="kobo.2353.1">
     we have mastered Micrometer, let us look at another
    </span>
    <a id="_idIndexMarker777">
    </a>
    <span class="koboSpan" id="kobo.2354.1">
     option for monitoring and observability, which is also open source and widely used in the market, OpenTelemetry.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-256">
    <a id="_idTextAnchor274">
    </a>
    <span class="koboSpan" id="kobo.2355.1">
     OpenTelemetry for monitoring and observability
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2356.1">
     OpenTelemetry is an
    </span>
    <a id="_idIndexMarker778">
    </a>
    <span class="koboSpan" id="kobo.2357.1">
     open-source, vendor-neutral observability framework that provides tools to collect telemetry data (logs, metrics, and traces) from your applications.
    </span>
    <span class="koboSpan" id="kobo.2357.2">
     It is
    </span>
    <a id="_idIndexMarker779">
    </a>
    <span class="koboSpan" id="kobo.2358.1">
     a comprehensive standard designed to provide
    </span>
    <a id="_idIndexMarker780">
    </a>
    <span class="koboSpan" id="kobo.2359.1">
     deep insights into distributed systems and is widely supported across languages and platforms.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2360.1">
     OpenTelemetry unifies logs, metrics, and traces into one framework, providing a standardized way to instrument your services.
    </span>
    <span class="koboSpan" id="kobo.2360.2">
     It works with a variety of backends (like Prometheus, Jaeger, Zipkin, and Grafana) and supports distributed tracing across microservices.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2361.1">
     OpenTelemetry helps you track the complete lifecycle of a request as it moves through multiple services, providing valuable insights into service performance, latency, and bottlenecks.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2362.1">
     OpenTelemetry
    </span>
    <a id="_idIndexMarker781">
    </a>
    <span class="koboSpan" id="kobo.2363.1">
     consists of the following components:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2364.1">
       Traces
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2365.1">
      : Monitor the journey of requests across multiple services.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2366.1">
       Metrics
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2367.1">
      : Collect quantitative data on service performance, such as response times and error rates.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2368.1">
       Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2369.1">
      : Record discrete events within the system, such as errors or warnings.
     </span>
    </li>
   </ul>
   <h2 class="heading-2" id="_idParaDest-257">
    <a id="_idTextAnchor275">
    </a>
    <span class="koboSpan" id="kobo.2370.1">
     Using OpenTelemetry in Spring Boot
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2371.1">
     OpenTelemetry provides a standardized way to collect, process, and export telemetry data (logs, metrics, and traces) from your application.
    </span>
    <span class="koboSpan" id="kobo.2371.2">
     In a Spring Boot application, OpenTelemetry can be
    </span>
    <a id="_idIndexMarker782">
    </a>
    <span class="koboSpan" id="kobo.2372.1">
     integrated to automatically capture tracing data
    </span>
    <a id="_idIndexMarker783">
    </a>
    <span class="koboSpan" id="kobo.2373.1">
     across your services.
    </span>
    <span class="koboSpan" id="kobo.2373.2">
     Once integrated, this data can be exported to observability tools like Jaeger, Zipkin, or Grafana to visualize and monitor the flow of requests in real time.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2374.1">
     In this section, we’ll go through the steps to set up OpenTelemetry in a Spring Boot application, validate that tracing is working, and review sample logs showing the output after implementing OpenTelemetry.
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2375.1">
       Add OpenTelemetry dependencies
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2376.1">
      : To integrate OpenTelemetry with Spring Boot, you’ll need the OpenTelemetry SDK along with specific instrumentation dependencies for Spring and HTTP clients.
     </span>
     <span class="koboSpan" id="kobo.2376.2">
      Add the following dependencies to your
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2377.1">
       pom.xml
      </span>
     </code>
     <span class="koboSpan" id="kobo.2378.1">
      :
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.2379.1">
     Under the dependency management tag:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2380.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2381.1">dependencyManagement</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2382.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2383.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2384.1">dependencies</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2385.1">&gt;</span></span>
        <span class="hljs-tag"><span class="koboSpan" id="kobo.2386.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2387.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2388.1">&gt;</span></span>
            <span class="hljs-tag"><span class="koboSpan" id="kobo.2389.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2390.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2391.1">&gt;</span></span><span class="koboSpan" id="kobo.2392.1">io.opentelemetry.instrumentation</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2393.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2394.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2395.1">&gt;</span></span>
            <span class="hljs-tag"><span class="koboSpan" id="kobo.2396.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2397.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2398.1">&gt;</span></span><span class="koboSpan" id="kobo.2399.1">opentelemetry-instrumentation-bom</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2400.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2401.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2402.1">&gt;</span></span>
            <span class="hljs-tag"><span class="koboSpan" id="kobo.2403.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2404.1">version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2405.1">&gt;</span></span><span class="koboSpan" id="kobo.2406.1">2.14.0</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2407.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2408.1">version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2409.1">&gt;</span></span>
            <span class="hljs-tag"><span class="koboSpan" id="kobo.2410.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2411.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2412.1">&gt;</span></span><span class="koboSpan" id="kobo.2413.1">pom</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2414.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2415.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2416.1">&gt;</span></span>
            <span class="hljs-tag"><span class="koboSpan" id="kobo.2417.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2418.1">scope</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2419.1">&gt;</span></span><span class="koboSpan" id="kobo.2420.1">import</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2421.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2422.1">scope</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2423.1">&gt;</span></span>
        <span class="hljs-tag"><span class="koboSpan" id="kobo.2424.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2425.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2426.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2427.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2428.1">dependencies</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2429.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2430.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2431.1">dependencyManagement</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2432.1">&gt;</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2433.1">
     After that, proceed to add the following dependencies under the dependencies tag:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.2434.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2435.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2436.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2437.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2438.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2439.1">&gt;</span></span><span class="koboSpan" id="kobo.2440.1">io.micrometer</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2441.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2442.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2443.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2444.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2445.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2446.1">&gt;</span></span><span class="koboSpan" id="kobo.2447.1">micrometer-tracing-bridge-otel</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2448.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2449.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2450.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2451.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2452.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2453.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2454.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2455.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2456.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2457.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2458.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2459.1">&gt;</span></span><span class="koboSpan" id="kobo.2460.1">org.springframework.boot</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2461.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2462.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2463.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2464.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2465.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2466.1">&gt;</span></span><span class="koboSpan" id="kobo.2467.1">spring-boot-starter-actuator</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2468.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2469.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2470.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2471.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2472.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2473.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2474.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2475.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2476.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2477.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2478.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2479.1">&gt;</span></span><span class="koboSpan" id="kobo.2480.1">io.opentelemetry.instrumentation</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2481.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2482.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2483.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2484.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2485.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2486.1">&gt;</span></span><span class="koboSpan" id="kobo.2487.1">opentelemetry-spring-boot-starter</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2488.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2489.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2490.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2491.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2492.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2493.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2494.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2495.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2496.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2497.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2498.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2499.1">&gt;</span></span><span class="koboSpan" id="kobo.2500.1">io.opentelemetry</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2501.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2502.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2503.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.2504.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2505.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2506.1">&gt;</span></span><span class="koboSpan" id="kobo.2507.1">opentelemetry-exporter-otlp</span><span class="hljs-tag"><span class="koboSpan" id="kobo.2508.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2509.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2510.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.2511.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2512.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2513.1">&gt;</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2514.1">
     Let us
    </span>
    <a id="_idIndexMarker784">
    </a>
    <span class="koboSpan" id="kobo.2515.1">
     understand what each of these dependencies
    </span>
    <a id="_idIndexMarker785">
    </a>
    <span class="koboSpan" id="kobo.2516.1">
     are used for:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2517.1">
       opentelemetry-instrumentation-bom
      </span>
     </code>
     <span class="koboSpan" id="kobo.2518.1">
      :
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2519.1">
        A Bill of Materials (BOM) that ensures version alignment across all OpenTelemetry dependencies.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2520.1">
        Helps manage compatible versions between OpenTelemetry components and their transitive dependencies.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2521.1">
        Must be imported before other BOMs (like spring-boot-dependencies) when using Maven like we are doing here.
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2522.1">
       micrometer-tracing-bridge-otel
      </span>
     </code>
     <span class="koboSpan" id="kobo.2523.1">
      :
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2524.1">
        Bridges Micrometer’s Observation API to OpenTelemetry’s tracing system.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2525.1">
        Facilitates the propagation of trace context and spans between Micrometer and OpenTelemetry.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2526.1">
        Essential component for enabling distributed tracing with OpenTelemetry in Spring Boot applications.
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2527.1">
       opentelemetry-spring-boot-starter
      </span>
     </code>
     <span class="koboSpan" id="kobo.2528.1">
      :
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2529.1">
        Provides auto-configuration for OpenTelemetry in Spring Boot applications
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2530.1">
        Includes built-in instrumentation for many Spring Boot features
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2531.1">
        Simplifies the process of instrumenting a Spring Boot application with minimal configuration
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2532.1">
        Particularly useful for Spring Boot Native image applications or when seeking reduced startup overhead compared to the Java agent approach
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2533.1">
       opentelemetry-exporter-otlp
      </span>
     </code>
     <span class="koboSpan" id="kobo.2534.1">
      :
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2535.1">
        Implements
       </span>
       <a id="_idIndexMarker786">
       </a>
       <span class="koboSpan" id="kobo.2536.1">
        the OpenTelemetry Protocol (OTLP) exporter for sending telemetry data
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2537.1">
        Allows
       </span>
       <a id="_idIndexMarker787">
       </a>
       <span class="koboSpan" id="kobo.2538.1">
        applications to export collected tracing data to OpenTelemetry Collectors or other backends
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2539.1">
        Supports standardized telemetry data delivery between observability tools
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2540.1">
        Can be configured to use either HTTP or gRPC transport protocols
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2541.1">
       spring-boot-starter-actuator
      </span>
     </code>
     <span class="koboSpan" id="kobo.2542.1">
      :
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2543.1">
        Adds production-grade monitoring and management features to Spring Boot applications.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2544.1">
        Provides dependency management and auto-configuration for Micrometer (metrics and tracing)
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2545.1">
        Required foundation for both metrics and tracing capabilities in Spring Boot.
       </span>
       <span class="koboSpan" id="kobo.2545.2">
        This is mandatory for any tracing, either only with Micrometer or along with OpenTelemetry
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2546.1">
      Exposes endpoints for application health, metrics, and other operational data
     </span>
    </li>
   </ul>
   <ol>
    <li class="numberedList" value="2">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2547.1">
       Configuring OpenTelemetry into the application
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2548.1">
      : Let us have the following properties in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2549.1">
       application.yml
      </span>
     </code>
     <span class="koboSpan" id="kobo.2550.1">
      .
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2551.1">
        First, we are going to define the URL where OpenTelemetry will send the traces, and in this case, this is the path and exposed port from Jaeger that we are going to run from the
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2552.1">
         docker-compose
        </span>
       </code>
       <span class="koboSpan" id="kobo.2553.1">
        file that you will define next.
       </span>
       <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.2554.1">tracing:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2555.1">url:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2556.1">http://localhost:4318/v1/traces</span></span>
</code></pre>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2557.1">
        Under the
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2558.1">
         otel
        </span>
       </code>
       <span class="koboSpan" id="kobo.2559.1">
        tag, we are setting OpenTelemetry to not export logs or metrics, only traces.
       </span>
       <span class="koboSpan" id="kobo.2559.2">
        It will also work without these configurations but will throw multiple exceptions in the application log because Jaeger only reads traces, not logs or metrics.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2560.1">
        If you are
       </span>
       <a id="_idIndexMarker788">
       </a>
       <span class="koboSpan" id="kobo.2561.1">
        going to use another backend
       </span>
       <a id="_idIndexMarker789">
       </a>
       <span class="koboSpan" id="kobo.2562.1">
        tool like Grafana that consumes the logs and the metrics, instead of setting it to none, you should add the proper configuration for the backend that you are going to use.
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2563.1">
        Since OpenTelemetry is compatible with a wide variety of backends, you should refer to the documentation to see how to configure it for the logs and metrics backend that you will be using.
       </span>
       <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.2564.1">otel:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2565.1">logs:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2566.1">exporter:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2567.1">none</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2568.1">metrics:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2569.1">exporter:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2570.1">none</span></span>
</code></pre>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2571.1">
        Next, under the management tag, you have the same configuration as shown in the Micrometer section.
       </span>
       <span class="koboSpan" id="kobo.2571.2">
        The configuration needs to contain tracing enabled and the sampling probability at 1.0 in order to generate as many traces as possible for our testing purposes.
       </span>
       <span class="koboSpan" id="kobo.2571.3">
        In production environments, you should configure that with a smaller value to avoid unneeded tracing.
       </span>
       <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.2572.1">management:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2573.1">endpoints:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2574.1">web:</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.2575.1">exposure:</span></span>
        <span class="hljs-attr"><span class="koboSpan" id="kobo.2576.1">exclude:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2577.1">"*"</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2578.1">tracing:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2579.1">enabled:</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2580.1">true</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2581.1">sampling:</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.2582.1">probability:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2583.1">1.0</span></span>
</code></pre>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2584.1">
        Finally, be aware that the logging pattern with OpenTelemetry changes.
       </span>
       <span class="koboSpan" id="kobo.2584.2">
        Using pure Micrometer with Brave, as shown in the section Implementing tracing using Micrometer, registers the trace and the span as
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2585.1">
         traceId
        </span>
       </code>
       <span class="koboSpan" id="kobo.2586.1">
        and
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2587.1">
         spanId
        </span>
       </code>
       <span class="koboSpan" id="kobo.2588.1">
        in the MDC (Mapped Diagnostic Context), that is, from where the pattern gets its values.
       </span>
       <span class="koboSpan" id="kobo.2588.2">
        But OpenTelemetry registers them as
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2589.1">
         trace_id
        </span>
       </code>
       <span class="koboSpan" id="kobo.2590.1">
        and
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2591.1">
         span_id
        </span>
       </code>
       <span class="koboSpan" id="kobo.2592.1">
        .
       </span>
       <span class="koboSpan" id="kobo.2592.2">
        This is a slight change but if you do not take this into consideration, you will not see the tracing in your application logs.
       </span>
       <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.2593.1">logging:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.2594.1">pattern:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.2595.1">level:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2596.1">'%5p [${spring.application.name:},%X{trace_id:-},%X{span_id:-}]'</span></span>
</code></pre>
      </li>
     </ul>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2597.1">
       Configuring OpenTelemetry exporter
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2598.1">
      : Create an OpenTelemetry configuration class in
     </span>
     <a id="_idIndexMarker790">
     </a>
     <span class="koboSpan" id="kobo.2599.1">
      your Spring Boot application to export
     </span>
     <a id="_idIndexMarker791">
     </a>
     <span class="koboSpan" id="kobo.2600.1">
      the traces to the defined tracing URL.
     </span>
     <span class="koboSpan" id="kobo.2600.2">
      This setup is generally handled automatically when using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2601.1">
       opentelemetry-spring-boot-starter
      </span>
     </code>
     <span class="koboSpan" id="kobo.2602.1">
      , but you can add further customization to initialize it as a bean in Spring, like we are doing here.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.2603.1">
     This will export the traces directly to be collected by the backend, which in our example will be Jaeger this time.
    </span>
    <span class="koboSpan" id="kobo.2603.2">
     To achieve that, we are going to use the OtlpHttpSpanExporter class from the OpenTelemetry library imported earlier:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2604.1">import</span></span><span class="koboSpan" id="kobo.2605.1"> io.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2606.1">opentelemetry</span></span><span class="koboSpan" id="kobo.2607.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2608.1">exporter</span></span><span class="koboSpan" id="kobo.2609.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2610.1">otlp</span></span><span class="koboSpan" id="kobo.2611.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2612.1">http</span></span><span class="koboSpan" id="kobo.2613.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2614.1">trace</span></span><span class="koboSpan" id="kobo.2615.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2616.1">OtlpHttpSpanExporter</span></span><span class="koboSpan" id="kobo.2617.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2618.1">import</span></span><span class="koboSpan" id="kobo.2619.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2620.1">springframework</span></span><span class="koboSpan" id="kobo.2621.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2622.1">beans</span></span><span class="koboSpan" id="kobo.2623.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2624.1">factory</span></span><span class="koboSpan" id="kobo.2625.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2626.1">annotation</span></span><span class="koboSpan" id="kobo.2627.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2628.1">Value</span></span><span class="koboSpan" id="kobo.2629.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2630.1">import</span></span><span class="koboSpan" id="kobo.2631.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2632.1">springframework</span></span><span class="koboSpan" id="kobo.2633.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2634.1">context</span></span><span class="koboSpan" id="kobo.2635.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2636.1">annotation</span></span><span class="koboSpan" id="kobo.2637.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2638.1">Bean</span></span><span class="koboSpan" id="kobo.2639.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2640.1">import</span></span><span class="koboSpan" id="kobo.2641.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2642.1">springframework</span></span><span class="koboSpan" id="kobo.2643.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2644.1">context</span></span><span class="koboSpan" id="kobo.2645.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2646.1">annotation</span></span><span class="koboSpan" id="kobo.2647.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2648.1">Configuration</span></span><span class="koboSpan" id="kobo.2649.1">;
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.2650.1">Configuration</span></span><span class="koboSpan" id="kobo.2651.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2652.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2653.1">OtlpConfiguration</span></span><span class="koboSpan" id="kobo.2654.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.2655.1">Bean</span></span>
    <span class="hljs-title"><span class="koboSpan" id="kobo.2656.1">OtlpHttpSpanExporter</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2657.1">otlpHttpSpanExporter</span></span><span class="koboSpan" id="kobo.2658.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2659.1">@Value(</span></span>
<span class="hljs-params">        </span><span class="hljs-string"><span class="koboSpan" id="kobo.2660.1">"${tracing.url}"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2661.1">) </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2662.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2663.1"> url</span></span><span class="koboSpan" id="kobo.2664.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2665.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2666.1">OtlpHttpSpanExporter</span></span><span class="koboSpan" id="kobo.2667.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2668.1">builder</span></span><span class="koboSpan" id="kobo.2669.1">()
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2670.1">setEndpoint</span></span><span class="koboSpan" id="kobo.2671.1">(url)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2672.1">build</span></span><span class="koboSpan" id="kobo.2673.1">();
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2674.1">
     With this configuration, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2675.1">
      OtlpHttpSpanExporter
     </span>
    </code>
    <span class="koboSpan" id="kobo.2676.1">
     will export the traces directly into the defined tracing URL from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2677.1">
      applications.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.2678.1">
     , so Jaeger can read our traces directly.
    </span>
    <span class="koboSpan" id="kobo.2678.2">
     By default, OpenTelemetry will automatically instrument HTTP and Spring MVC requests.
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2679.1">
       Validate tracing in the application
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2680.1">
      : To validate that OpenTelemetry tracing is working, we can:
     </span>
     <ul>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2681.1">
        Check
       </span>
       <a id="_idIndexMarker792">
       </a>
       <span class="koboSpan" id="kobo.2682.1">
        traces in the exported tool: Start your
       </span>
       <a id="_idIndexMarker793">
       </a>
       <span class="koboSpan" id="kobo.2683.1">
        Spring Boot application and use Jaeger (or the chosen backend) to view the traces.
       </span>
       <span class="koboSpan" id="kobo.2683.2">
        Each incoming request should appear in the tracing tool as a new trace with a unique
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2684.1">
         traceId
        </span>
       </code>
       <span class="koboSpan" id="kobo.2685.1">
        .
       </span>
      </li>
      <li class="bulletList">
       <span class="koboSpan" id="kobo.2686.1">
        Observe logs with trace and span IDs: After setting up OpenTelemetry, logs should contain
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2687.1">
         traceId
        </span>
       </code>
       <span class="koboSpan" id="kobo.2688.1">
        and
       </span>
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.2689.1">
         spanId
        </span>
       </code>
       <span class="koboSpan" id="kobo.2690.1">
        , allowing you to correlate log entries across services.
       </span>
      </li>
     </ul>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2691.1">
       Verify logs and trace visualization
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2692.1">
      : After implementing OpenTelemetry, you should see enhanced logs with traceId and spanId for each request.
     </span>
     <span class="koboSpan" id="kobo.2692.2">
      Additionally, the tracing backend (Zipkin, in this case) will provide a visual representation of the trace.
     </span>
    </li>
   </ol>
   <h2 class="heading-2" id="_idParaDest-258">
    <a id="_idTextAnchor276">
    </a>
    <span class="koboSpan" id="kobo.2693.1">
     Logs with OpenTelemetry Tracing
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2694.1">
     Below is an example log output from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2695.1">
      order-management-api
     </span>
    </code>
    <span class="koboSpan" id="kobo.2696.1">
     calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2697.1">
      product-api
     </span>
    </code>
    <span class="koboSpan" id="kobo.2698.1">
     after
    </span>
    <a id="_idIndexMarker794">
    </a>
    <span class="koboSpan" id="kobo.2699.1">
     implementing OpenTelemetry.
    </span>
    <span class="koboSpan" id="kobo.2699.2">
     Notice the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2700.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2701.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2702.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2703.1">
     added to each log entry, following the defined logging pattern into the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2704.1">
      application.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.2705.1">
     file:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2706.1">2025-04-01T19:10:56.485-03:00  INFO [order-management-api,e809af87a330f1ab03ccfa395e5d5864,d01a9ecf8f4e570b] 10441 --- [order-management-api] [io-8090-exec-10] [                                                 ] c.p.o.a.o.rest.ProductsQueryUseCaseImpl  : Getting product with id AA00001
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2707.1">
     It follows the same structure described in the section Viewing trace data, but here these traces and spans are being generated by OpenTelemetry.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2708.1">
     We can also see the logs on the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2709.1">
      product-api
     </span>
    </code>
    <span class="koboSpan" id="kobo.2710.1">
     side, which receives the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2711.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2712.1">
     from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2713.1">
      order-management-api
     </span>
    </code>
    <span class="koboSpan" id="kobo.2714.1">
     and generates its own
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2715.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2716.1">
     :
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2717.1">2025-04-01T19:10:56.488-03:00  INFO [product-api,e809af87a330f1ab03ccfa395e5d5864,38cb8ed93e944e69] 10609 --- [product-api] [io-8080-exec-10] [                                                 ] c.p.p.a.o.d.ProductsQueryUseCaseImpl     : Getting product by id: AA00001
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2718.1">
     With these IDs, each log
    </span>
    <a id="_idIndexMarker795">
    </a>
    <span class="koboSpan" id="kobo.2719.1">
     entry can be correlated to a specific request and its journey across multiple services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2720.1">
     Next, we will learn how to run a local Jaeger instance to see the whole tracing in action.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-259">
    <a id="_idTextAnchor277">
    </a>
    <span class="koboSpan" id="kobo.2721.1">
     Visualization example with Jaeger
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2722.1">
     To be able to run a local Jaeger instance on your machine, create the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2723.1">
      docker-compose.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.2724.1">
     file, which
    </span>
    <a id="_idIndexMarker796">
    </a>
    <span class="koboSpan" id="kobo.2725.1">
     will automatically download and configure your local Jaeger instance with the following content:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2726.1">services:
  jaeger:
    image: jaegertracing/jaeger:${JAEGER_VERSION:-latest}
    container_name: jaeger
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    ports:
      - 4318:4318
      - 16686:16686
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2727.1">
     This file defines to get the latest Docker image for Jaeger.
    </span>
    <span class="koboSpan" id="kobo.2727.2">
     Also, here we are allocating port
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2728.1">
      4318
     </span>
    </code>
    <span class="koboSpan" id="kobo.2729.1">
     for tracing and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2730.1">
      16686
     </span>
    </code>
    <span class="koboSpan" id="kobo.2731.1">
     for the Jaeger UI interface.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2732.1">
     The property
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2733.1">
      COLLECTOR_OTLP_ENABLED=true
     </span>
    </code>
    <span class="koboSpan" id="kobo.2734.1">
     is optional on Jaeger v2 since its default is always true and mandatory on Jaeger v1.
    </span>
    <span class="koboSpan" id="kobo.2734.2">
     At the time of this writing, you should get above v2 while running this
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2735.1">
      docker-compose.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.2736.1">
     file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2737.1">
     To run this container, you need Docker installed on your system.
    </span>
    <span class="koboSpan" id="kobo.2737.2">
     Once it is installed, open a console in the same directory as where this file is saved and run the following command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2738.1">docker compose up
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2739.1">
     Once the application is running, go to your local running Jaeger’s UI (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2740.1">
      http://localhost:16686
     </span>
    </code>
    <span class="koboSpan" id="kobo.2741.1">
     ) to view the traces.
    </span>
    <span class="koboSpan" id="kobo.2741.2">
     You should see a graphical representation of the trace, showing the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2742.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2743.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2744.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2745.1">
     , and the parent-child relationships across services, and even showing deeper details like database
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2746.1">
      INSERT
     </span>
    </code>
    <span class="koboSpan" id="kobo.2747.1">
     and durations, giving a broad view of the trace.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2748.1">
     <img alt="Figure 9.3 – Complete trace journey in Jaeger dashboard with OpenTelemetry" src="../Images/B21843_09_3.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2749.1">
     Figure 9.3 – Complete trace journey in Jaeger dashboard with OpenTelemetry
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2750.1">
     In the case
    </span>
    <a id="_idIndexMarker797">
    </a>
    <span class="koboSpan" id="kobo.2751.1">
     of any error, it will highlight what happened and where it happened:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2752.1">
     <img alt="Figure 9.4 – Successful and error traces in Jaeger dashboard" src="../Images/B21843_09_4.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2753.1">
     Figure 9.4 – Successful and error traces in Jaeger dashboard
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2754.1">
     Feel free to refer to this chapter repository to get the working code version and replicate the same behavior on your local machine.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2755.1">
     By examining both the logs in the application and the trace visualization in Jaeger, you can validate that OpenTelemetry is successfully capturing traces, correlating logs with tracing data, and providing a full view of the request’s journey through your distributed system.
    </span>
    <span class="koboSpan" id="kobo.2755.2">
     This setup not only helps troubleshoot issues but also provides insights into optimizing performance across services with the goal of monitoring distributed services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2756.1">
     Let us take a look at how to create custom spans with OpenTelemetry.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-260">
    <a id="_idTextAnchor278">
    </a>
    <span class="koboSpan" id="kobo.2757.1">
     Creating custom spans
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2758.1">
     While OpenTelemetry automatically instruments HTTP requests, you can also create custom spans to
    </span>
    <a id="_idIndexMarker798">
    </a>
    <span class="koboSpan" id="kobo.2759.1">
     monitor specific operations.
    </span>
    <span class="koboSpan" id="kobo.2759.2">
     Here’s an example in which a span is manually created for a user registration process:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2760.1">import</span></span><span class="koboSpan" id="kobo.2761.1"> io.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2762.1">opentelemetry</span></span><span class="koboSpan" id="kobo.2763.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2764.1">api</span></span><span class="koboSpan" id="kobo.2765.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2766.1">trace</span></span><span class="koboSpan" id="kobo.2767.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2768.1">Span</span></span><span class="koboSpan" id="kobo.2769.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2770.1">import</span></span><span class="koboSpan" id="kobo.2771.1"> io.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2772.1">opentelemetry</span></span><span class="koboSpan" id="kobo.2773.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2774.1">api</span></span><span class="koboSpan" id="kobo.2775.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2776.1">trace</span></span><span class="koboSpan" id="kobo.2777.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2778.1">Tracer</span></span><span class="koboSpan" id="kobo.2779.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2780.1">import</span></span><span class="koboSpan" id="kobo.2781.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2782.1">springframework</span></span><span class="koboSpan" id="kobo.2783.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2784.1">beans</span></span><span class="koboSpan" id="kobo.2785.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2786.1">factory</span></span><span class="koboSpan" id="kobo.2787.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2788.1">annotation</span></span><span class="koboSpan" id="kobo.2789.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2790.1">Autowired</span></span><span class="koboSpan" id="kobo.2791.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2792.1">import</span></span><span class="koboSpan" id="kobo.2793.1"> org.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2794.1">springframework</span></span><span class="koboSpan" id="kobo.2795.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2796.1">stereotype</span></span><span class="koboSpan" id="kobo.2797.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2798.1">Service</span></span><span class="koboSpan" id="kobo.2799.1">;
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.2800.1">Service</span></span><span class="koboSpan" id="kobo.2801.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2802.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2803.1">UserService</span></span><span class="koboSpan" id="kobo.2804.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.2805.1">Autowired</span></span><span class="koboSpan" id="kobo.2806.1">
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.2807.1">Tracer</span></span><span class="koboSpan" id="kobo.2808.1"> tracer;
    public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2809.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2810.1">registerUser</span></span><span class="koboSpan" id="kobo.2811.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2812.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2813.1"> username</span></span><span class="koboSpan" id="kobo.2814.1">) {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.2815.1">Span</span></span><span class="koboSpan" id="kobo.2816.1"> span = tracer.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2817.1">spanBuilder</span></span><span class="koboSpan" id="kobo.2818.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2819.1">"UserService.registerUser"</span></span><span class="koboSpan" id="kobo.2820.1">)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2821.1">setAttribute</span></span><span class="koboSpan" id="kobo.2822.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2823.1">"username"</span></span><span class="koboSpan" id="kobo.2824.1">, username)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2825.1">startSpan</span></span><span class="koboSpan" id="kobo.2826.1">();
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2827.1">try</span></span><span class="koboSpan" id="kobo.2828.1"> {
            </span><span class="hljs-comment"><span class="koboSpan" id="kobo.2829.1">// Simulate registration logic</span></span>
            <span class="hljs-title"><span class="koboSpan" id="kobo.2830.1">Thread</span></span><span class="koboSpan" id="kobo.2831.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2832.1">sleep</span></span><span class="koboSpan" id="kobo.2833.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2834.1">100</span></span><span class="koboSpan" id="kobo.2835.1">);
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.2836.1">System</span></span><span class="koboSpan" id="kobo.2837.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2838.1">out</span></span><span class="koboSpan" id="kobo.2839.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2840.1">println</span></span><span class="koboSpan" id="kobo.2841.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2842.1">"User registered: "</span></span><span class="koboSpan" id="kobo.2843.1"> + username);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2844.1">catch</span></span><span class="koboSpan" id="kobo.2845.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.2846.1">InterruptedException</span></span><span class="koboSpan" id="kobo.2847.1"> e) {
            span.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2848.1">recordException</span></span><span class="koboSpan" id="kobo.2849.1">(e);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2850.1">finally</span></span><span class="koboSpan" id="kobo.2851.1"> {
            span.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2852.1">end</span></span><span class="koboSpan" id="kobo.2853.1">();
        }
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2854.1">
     In this example, a custom span named “
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2855.1">
      UserService.registerUser
     </span>
    </code>
    <span class="koboSpan" id="kobo.2856.1">
     " is created, and a username attribute is added.
    </span>
    <span class="koboSpan" id="kobo.2856.2">
     The span is started with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2857.1">
      .startSpan()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2858.1">
     and ended with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2859.1">
      .end()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2860.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2861.1">
     Now that you have mastered the usage of OpenTelemetry as well, let us focus on some of the best practices for observability that you should be aware of.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-261">
    <a id="_idTextAnchor279">
    </a>
    <span class="koboSpan" id="kobo.2862.1">
     Best practices for end-to-end observability
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2863.1">
     Observability is an ongoing process that involves logs, metrics, and traces working together to provide full
    </span>
    <a id="_idIndexMarker799">
    </a>
    <span class="koboSpan" id="kobo.2864.1">
     visibility into your REST API’s performance and behavior.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2865.1">
     Preparing your environment to be completely covered by observability and monitoring is not an easy task, and you must consider the following topics:
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-262">
    <a id="_idTextAnchor280">
    </a>
    <span class="koboSpan" id="kobo.2866.1">
     Combining logs, metrics, and traces
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2867.1">
     Logs, metrics, and traces complement each other to give you a holistic view of your application:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2868.1">
       Logs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2869.1">
      : Provide
     </span>
     <a id="_idIndexMarker800">
     </a>
     <span class="koboSpan" id="kobo.2870.1">
      detailed
     </span>
     <a id="_idIndexMarker801">
     </a>
     <span class="koboSpan" id="kobo.2871.1">
      information about specific events.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2872.1">
       Metrics
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2873.1">
      : Offer a
     </span>
     <a id="_idIndexMarker802">
     </a>
     <span class="koboSpan" id="kobo.2874.1">
      quantitative summary of performance
     </span>
     <a id="_idIndexMarker803">
     </a>
     <span class="koboSpan" id="kobo.2875.1">
      over time.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2876.1">
       Traces
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2877.1">
      : Show the
     </span>
     <a id="_idIndexMarker804">
     </a>
     <span class="koboSpan" id="kobo.2878.1">
      lifecycle of individual requests
     </span>
     <a id="_idIndexMarker805">
     </a>
     <span class="koboSpan" id="kobo.2879.1">
      across services.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2880.1">
     By using these tools together, you can quickly diagnose issues and optimize performance.
    </span>
    <span class="koboSpan" id="kobo.2880.2">
     For example, you might use tracing to find a slow request, logs to determine why it’s slow, and metrics to track how often the issue occurs.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-263">
    <a id="_idTextAnchor281">
    </a>
    <span class="koboSpan" id="kobo.2881.1">
     Alarms and notifications
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2882.1">
     With observability tools in place, you can set up alarms to notify your team when something goes wrong.
    </span>
    <span class="koboSpan" id="kobo.2882.2">
     For example, you can configure Prometheus to send alerts when the error rate exceeds a
    </span>
    <a id="_idIndexMarker806">
    </a>
    <span class="koboSpan" id="kobo.2883.1">
     certain threshold or when response times spike.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2884.1">
     In the context of RESTful microservices, AWS CloudWatch offers comprehensive monitoring capabilities that transform raw operational data into readable, near-real-time metrics stored for up to 15 months.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2885.1">
     For example, when implementing API Gateway as the front door to your microservices architecture, CloudWatch can monitor key performance indicators such as IntegrationLatency to measure backend responsiveness, overall latency to assess API call efficiency, and cache performance metrics to optimize resource utilization.
    </span>
    <span class="koboSpan" id="kobo.2885.2">
     API Gateway logging, which feeds into CloudWatch Logs, provides valuable visibility into consumer access behaviors, allowing teams to understand common customer locations, analyze request patterns that might impact database partitioning, identify abnormal behavior that could indicate security concerns, and optimize configurations by tracking errors, latency, and cache performance.
    </span>
    <span class="koboSpan" id="kobo.2885.3">
     This monitoring framework creates a secure, easily maintainable environment that scales with growing business needs while providing actionable intelligence to continuously improve service delivery.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-264">
    <a id="_idTextAnchor282">
    </a>
    <span class="koboSpan" id="kobo.2886.1">
     Continuous improvement
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2887.1">
     Observability
    </span>
    <a id="_idIndexMarker807">
    </a>
    <span class="koboSpan" id="kobo.2888.1">
     is an ongoing process.
    </span>
    <span class="koboSpan" id="kobo.2888.2">
     As your system evolves, regularly review and refine your logging, tracing, and metrics collection to ensure you are capturing the most useful data.
    </span>
    <span class="koboSpan" id="kobo.2888.3">
     Use tools like Prometheus, Grafana, Zipkin, and OpenTelemetry to continually monitor and improve your system’s performance.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-265">
    <a id="_idTextAnchor283">
    </a>
    <span class="koboSpan" id="kobo.2889.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2890.1">
     In this chapter, we explored the core components and best practices for achieving effective monitoring and observability in RESTful services.
    </span>
    <span class="koboSpan" id="kobo.2890.2">
     Beginning with logging, we discussed the importance of structured logging for API troubleshooting, log levels to indicate severity, and correlation IDs to link requests across services.
    </span>
    <span class="koboSpan" id="kobo.2890.3">
     By implementing these logging practices centrally, such as with a filter in Spring Boot, we ensured consistent and secure logging across the application.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2891.1">
     We then introduced distributed tracing, explaining how
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2892.1">
      traceId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2893.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2894.1">
      spanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2895.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2896.1">
      parentSpanId
     </span>
    </code>
    <span class="koboSpan" id="kobo.2897.1">
     create a parent-child relationship among services, allowing developers to track the journey of requests through a system.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2898.1">
     Micrometer Tracing was covered as a key tool in Spring Boot 3.x for enabling and managing distributed tracing.
    </span>
    <span class="koboSpan" id="kobo.2898.2">
     It automatically instruments Spring Boot applications, capturing trace and span information for each request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2899.1">
     Micrometer Tracing integrates with multiple exporters, including Prometheus, Zipkin, and Jaeger, to send trace data to external observability platforms.
    </span>
    <span class="koboSpan" id="kobo.2899.2">
     With its configurable sampling and tagging, Micrometer Tracing provides granular visibility into each service, enabling efficient troubleshooting and performance optimization.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2900.1">
     Building on tracing, we explored OpenTelemetry as a vendor-neutral observability framework that collects and correlates traces, metrics, and logs in distributed systems.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2901.1">
     OpenTelemetry integrates smoothly with Spring Boot to provide out-of-the-box tracing for HTTP and Spring MVC requests, with added flexibility to create custom spans.
    </span>
    <span class="koboSpan" id="kobo.2901.2">
     We covered how to configure OpenTelemetry, validate its functionality through logging and visualization in tools like Zipkin, and observe end-to-end traces across services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2902.1">
     By combining logging, tracing, and OpenTelemetry with tools like Zipkin or Jaeger for visualization, we can gain a comprehensive view of each request across services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2903.1">
     This chapter provided foundational strategies for implementing robust observability, allowing for effective monitoring, faster troubleshooting, and insights to optimize the performance of RESTful APIs in complex, distributed environments.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2904.1">
     In the next chapter, you will learn about scaling and performance optimization techniques, to be able to make the best out of your applications.
    </span>
   </p>
  </div>
 </body></html>