<html><head></head><body>
		<div id="_idContainer123">
			<h1 class="chapter-number" id="_idParaDest-293"><a id="_idTextAnchor303"/>16</h1>
			<h1 id="_idParaDest-294"><a id="_idTextAnchor304"/>Packaging Backend and Frontend with Maven</h1>
			<p>In the previous chapter, we learned what Cypress is and its benefits. We also learned how to write Cypress end-to-end tests and how to run them. Finally, we learned how to intercept HTTP requests to <span class="No-Break">mock responses.</span></p>
			<p>This chapter will teach you how to combine your Angular and Spring Boot applications and then run them on your <span class="No-Break">local machine.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>What <span class="No-Break">is frontend-maven-plugin?</span></li>
				<li>Adding configurations to Spring Boot and <span class="No-Break">Angular’s integration</span></li>
				<li>Packaging <span class="No-Break">Spring Boot</span></li>
				<li>Running the <span class="No-Break">JAR file</span></li>
			</ul>
			<h1 id="_idParaDest-295"><a id="_idTextAnchor305"/>Technical requirements</h1>
			<p>The following link will take you to the finished version of code for this <span class="No-Break">chapter: </span><a href="https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-16/superheroes"><span class="No-Break">https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-16/superheroes</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-296"><a id="_idTextAnchor306"/>What is frontend-maven-plugin?</h1>
			<p>Okay – before I answer the question of what <strong class="source-inline">frontend-maven-plugin</strong> is, let’s see how we can package our<a id="_idIndexMarker1195"/> application. We can build Spring Boot to generate a JAR file and create a production build of Angular <span class="No-Break">as well.</span></p>
			<p>But what if we can create a JAR file for Spring Boot that will also contain the production build of Angular inside it? The approach of putting the frontend and the backend in a single JAR file will provide us with an easier way to deploy the application to test and <span class="No-Break">production environments.</span></p>
			<p>It will allow us to manage a single path for the API and the frontend application. To do this, we will require a Maven plugin called <strong class="source-inline">frontend-maven-plugin</strong> (<a href="https://github.com/eirslett/frontend-maven-plugin">https://github.com/eirslett/frontend-maven-plugin</a>), which will help us create a JAR file that contains both our backend <span class="No-Break">and frontend.</span></p>
			<p>Some requirements ensure <a id="_idIndexMarker1196"/>that our backend and frontend will work together. In the next section, we’ll find out what configurations we need in our backend <span class="No-Break">and frontend.</span></p>
			<h1 id="_idParaDest-297"><a id="_idTextAnchor307"/>Adding configurations to Spring Boot and Angular’s integration</h1>
			<p>In this section, we will write some <a id="_idIndexMarker1197"/>configurations in the Spring Boot application and the Angular application to ensure that Spring Boot will run in production and that Angular will render the web application’s <span class="No-Break">user interface.</span></p>
			<p>First, let’s move the Angular app to the directory of our Spring <span class="No-Break">Boot application.</span></p>
			<h2 id="_idParaDest-298"><a id="_idTextAnchor308"/>Adding the Angular app to the Spring Boot project</h2>
			<p>In this section, we will <a id="_idIndexMarker1198"/>move the Angular app to the Spring Boot project. By doing this, there<a id="_idIndexMarker1199"/> will be an Angular project inside the Spring <span class="No-Break">Boot project.</span></p>
			<p>To start, create a new folder named <strong class="source-inline">frontend</strong> inside the Spring Boot project. Move all the files and folders of the Angular application inside the <strong class="source-inline">frontend</strong> folder, <span class="No-Break">like so:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer119">
					<img alt="Figure 16.1 – The frontend folder inside the Spring Boot project" src="image/B18159_16_01.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.1 – The frontend folder inside the Spring Boot project</p>
			<p><span class="No-Break"><em class="italic">Figure 16</em></span><em class="italic">.1</em> shows all the Angular files and folders inside the <strong class="source-inline">frontend</strong> folder, which is inside the Spring <span class="No-Break">Boot project.</span></p>
			<p>You can name the <strong class="source-inline">frontend</strong> folder whatever you want, so long as you map the path of the <strong class="source-inline">frontend</strong> folder to the <strong class="source-inline">workingDirectory</strong> property of <strong class="bold">Frontend Mavin Plugin</strong> and the <strong class="source-inline">fileset</strong> property of <strong class="bold">Apache Maven AntRun Plugin</strong>, which allows you to run Ant tasks from <span class="No-Break">within</span><span class="No-Break"><a id="_idIndexMarker1200"/></span><span class="No-Break"> Maven.</span></p>
			<p>Let’s use the two Maven <a id="_idIndexMarker1201"/>plugins, <strong class="source-inline">frontend-maven-plugin</strong> and <strong class="source-inline">maven-antrun-plugin</strong>, which we need in the <span class="No-Break">next section.</span></p>
			<h2 id="_idParaDest-299"><a id="_idTextAnchor309"/>Using frontend-maven-plugin</h2>
			<p>In this section, we will<a id="_idIndexMarker1202"/> use <strong class="source-inline">frontend-maven-plugin</strong>, which will install npm and Node.js locally. It will also run the <strong class="source-inline">npm build</strong> command in the <strong class="source-inline">frontend</strong> folder and copy the build files that <strong class="source-inline">npm build</strong> <span class="No-Break">has generated.</span></p>
			<p>So, <span class="No-Break">let’s start:</span></p>
			<ol>
				<li>Go to your <strong class="source-inline">pom.xml</strong> file and insert the following code as one of the build plugins in your Maven <span class="No-Break"><strong class="source-inline">pom</strong></span><span class="No-Break"> file:</span><pre class="console">
&lt;plugin&gt;</pre><pre class="console">
   &lt;groupId&gt;com.github.eirslett&lt;/groupId&gt;</pre><pre class="console">
   &lt;artifactId&gt;frontend-maven-plugin&lt;/artifactId&gt;</pre><pre class="console">
   &lt;version&gt;1.12.1&lt;/version&gt;</pre><pre class="console">
   &lt;configuration&gt;</pre><pre class="console">
      &lt;workingDirectory&gt;frontend&lt;/workingDirectory&gt;</pre><pre class="console">
      &lt;installDirectory&gt;target&lt;/installDirectory&gt;</pre><pre class="console">
   &lt;/configuration&gt;</pre><pre class="console">
…</pre><pre class="console">
// See full code on https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-16/superheroes</pre><pre class="console">
&lt;plugin&gt;</pre></li>
			</ol>
			<p>The preceding markup<a id="_idIndexMarker1203"/> shows that, while building the Spring Boot application, the plugin will install <strong class="source-inline">Node.js v16.17.0</strong> and <strong class="source-inline">npm CLI 8.19.1</strong> in the <strong class="source-inline">frontend</strong> working directory. It will also execute the <strong class="source-inline">npm install</strong> command to download all dependency packages of the <span class="No-Break">Angular application.</span></p>
			<p>After performing all the necessary installations, the next thing that the plugin will execute is the <strong class="source-inline">npm run build</strong> command, which will create a production build of the <span class="No-Break">Angular application.</span></p>
			<ol>
				<li value="2">Next, we must edit the <strong class="source-inline">npm build</strong> script in the <strong class="source-inline">package.json</strong> file of the Angular application using the <span class="No-Break">following code:</span><pre class="console">
"build": "ng build --configuration production",</pre></li>
			</ol>
			<p>The preceding code tells Angular that <strong class="source-inline">npm run build</strong> is for a <span class="No-Break">production build.</span></p>
			<ol>
				<li value="3">We also have to edit the <strong class="source-inline">environment.prod.ts</strong> file inside the environment folder of Angular. Change the code <span class="No-Break">to this:</span><pre class="console">
export const environment = {</pre><pre class="console">
  production: true,</pre><pre class="console">
  apiURL: "http://localhost:8080/api/v1",</pre><pre class="console">
  authURL: "http://localhost:8080"</pre><pre class="console">
};</pre></li>
			</ol>
			<p><strong class="source-inline">apiURL</strong> and <strong class="source-inline">authURL</strong> are just temporary. We will change them and use the real API URL and Auth URL properties in the real deployment of the application. We need to add the preceding code because we are using <strong class="source-inline">apiURL</strong> and <strong class="source-inline">authURL</strong> in our app for development, but we are missing the values for the <span class="No-Break">production environment.</span></p>
			<p>When the app builds for the production environment, the Angular app will collect the values from <strong class="source-inline">environment.prod.ts</strong> instead of using the <span class="No-Break"><strong class="source-inline">environment.ts</strong></span><span class="No-Break"> file.</span></p>
			<p>Now, let’s learn<a id="_idIndexMarker1204"/> about <strong class="source-inline">maven-antrun-plugin</strong> and configure our <strong class="source-inline">.pom</strong> <span class="No-Break">file again.</span></p>
			<h2 id="_idParaDest-300"><a id="_idTextAnchor310"/>Using maven-antrun-plugin</h2>
			<p>This section will use <strong class="source-inline">maven-antrun-plugin</strong> in the <a id="_idIndexMarker1205"/>Spring Boot application. Open up your <strong class="source-inline">pom.xml</strong> file and insert the following code into one of the plugins in the <strong class="source-inline">build</strong> block of the markup. Put it below the markup <span class="No-Break">of </span><span class="No-Break"><strong class="source-inline">frontend-maven-plugin</strong></span><span class="No-Break">:</span></p>
			<pre class="source-code">
&lt;plugin&gt;
   &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
   &lt;executions&gt;
      &lt;execution&gt;
         &lt;phase&gt;generate-resources&lt;/phase&gt;
         &lt;configuration&gt;
            &lt;target&gt;
               &lt;copy todir="${
                 project.build.directory}/classes/public"&gt;
                  &lt;fileset dir="${project.basedir}/
                    frontend/dist/superheroes"/&gt;
               &lt;/copy&gt;
            &lt;/target&gt;
         &lt;/configuration&gt;
         &lt;goals&gt;
            &lt;goal&gt;run&lt;/goal&gt;
         &lt;/goals&gt;
      &lt;/execution&gt;
   &lt;/executions&gt;
&lt;/plugin&gt;</pre>
			<p>Here, <strong class="source-inline">maven-antrum-plugin</strong> is a configuration that copies the files and folders of the <strong class="source-inline">"${project.basedir}/frontend/dist/superheroes"</strong> path and pastes them into the <strong class="source-inline">todir="${project.build.directory}/classes/public"</strong> path before running the task. This <a id="_idIndexMarker1206"/>will copy the frontend app and put it in the root folder of the JAR file of <span class="No-Break">Spring Boot.</span></p>
			<p>Now, let’s configure the Spring MVC configuration of <span class="No-Break">our app.</span></p>
			<h2 id="_idParaDest-301"><a id="_idTextAnchor311"/>Implementing WebMvcConfigurer</h2>
			<p>In this section, we will make the <a id="_idIndexMarker1207"/>Spring Boot application a host for the Angular application by adding a configuration file. To do this, we must add a configuration class to the config directory of our Spring Boot application and name <span class="No-Break">it </span><span class="No-Break"><strong class="source-inline">MvcConfig</strong></span><span class="No-Break">.</span></p>
			<p>After creating the <strong class="source-inline">MvcConfig</strong> class, add the <strong class="source-inline">WebMvcConfigurer</strong> interface to the file, <span class="No-Break">like so:</span></p>
			<pre class="source-code">
@Configuration
public class MvcConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry
      registry) {
… //See full code on https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-16/superheroes
    }
}</pre>
			<p>The preceding code can also be found in the GitHub repository for <span class="No-Break">this chapter.</span></p>
			<p>The <strong class="source-inline">MvcConfig</strong> class implements <strong class="source-inline">WebMvcConfigurer</strong> and overrides the <span class="No-Break"><strong class="source-inline">addResourceHandlers</strong></span><span class="No-Break"> method.</span></p>
			<p>Pass the <strong class="source-inline">"/**"</strong> argument into <strong class="source-inline">addResourceHandler</strong>, <span class="No-Break">like so:</span></p>
			<pre class="source-code">
addResourceHandler("/**")</pre>
			<p>This will make the <a id="_idIndexMarker1208"/>configuration affect all project routes. This part belongs to the external-facing URI of <span class="No-Break">the application.</span></p>
			<p>Then, map the external-facing URI path to the directory where the resources are located, <span class="No-Break">like so:</span></p>
			<pre class="source-code">
addResourceLocations("classpath:/public/")</pre>
			<p>Finally, add <strong class="source-inline">new ClassPathResource("/public/index.html")</strong>. This redirects requests that are not handled by the Spring Boot application that are going to the Angular application or the <span class="No-Break">frontend application.</span></p>
			<p>We are close to packaging both applications into one. We’ll learn how to do this in the <span class="No-Break">next section.</span></p>
			<h1 id="_idParaDest-302"><a id="_idTextAnchor312"/>Packaging Spring Boot</h1>
			<p>In this section, we will package the Spring <a id="_idIndexMarker1209"/>Boot application and the Angular application. The idea is to combine the two applications, giving you one single JAR file to deploy. Let’s learn how to <span class="No-Break">do this.</span></p>
			<p>After all the configurations we did, now, it’s a matter of running the following Maven commands in the <span class="No-Break">same order:</span></p>
			<pre class="console">
mvn clean
mvn package</pre>
			<p>The <strong class="source-inline">mvn clean</strong> command cleans the Maven project by deleting the target directory, whereas the <strong class="source-inline">mvn package</strong> command builds the Maven project and creates an executable <span class="No-Break">JAR file.</span></p>
			<p>These two Maven commands are enough to create an executable JAR file with the Spring Boot and Angular packages inside it; see <span class="No-Break"><em class="italic">Figure 16</em></span><span class="No-Break"><em class="italic">.2</em></span><span class="No-Break">:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer120">
					<img alt="Figure 16.2 – Target folder with the JAR file inside" src="image/B18159_16_02.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.2 – Target folder with the JAR file inside</p>
			<p>Packaging the applications is simple since we already did all the hard work configuring the Angular and Spring <span class="No-Break">Boot applications.</span></p>
			<p>Now, we have the JAR<a id="_idIndexMarker1210"/> file. In the next section, we will run the JAR file using a Java command to see if everything <span class="No-Break">is fine.</span></p>
			<h1 id="_idParaDest-303"><a id="_idTextAnchor313"/>Running the JAR file</h1>
			<p>In this section, we will run the JAR file <a id="_idIndexMarker1211"/>we have packaged and see that the Angular application communicates with the Spring Boot application. Follow <span class="No-Break">these steps:</span></p>
			<ol>
				<li value="1">To run the application, you can either use the <strong class="bold">Run</strong> button via IntelliJ IDEA or use the following <span class="No-Break"><strong class="source-inline">java</strong></span><span class="No-Break"> command:</span><pre class="console">
<strong class="bold">java -jar superheroes-0.0.1-SNAPSHOT.jar</strong></pre></li>
			</ol>
			<p>The preceding Java CLI command will run an executable JAR file. In the CLI, you will see that the Tomcat <a id="_idIndexMarker1212"/>web server has started on <span class="No-Break">port </span><span class="No-Break"><strong class="source-inline">8080</strong></span><span class="No-Break">.</span></p>
			<ol>
				<li value="2">Go to <strong class="source-inline">http://localhost:8080</strong>; you will be redirected to <strong class="source-inline">http://localhost:8080/login</strong>, which consists of a login form. <span class="No-Break"><em class="italic">Figure 16</em></span><em class="italic">.3</em> shows this <span class="No-Break">login form:</span></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer121">
					<img alt="Figure 16.3 – Login form" src="image/B18159_16_03.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.3 – Login form</p>
			<ol>
				<li value="3">Try to log in and navigate to the anti-heroes page, where you can create new heroes or villains using <span class="No-Break">the form:</span></li>
			</ol>
			<div>
				<div class="IMG---Figure" id="_idContainer122">
					<img alt="Figure 16.4 – Anti-heroes form" src="image/B18159_16_04.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 16.4 – Anti-heroes form</p>
			<p><span class="No-Break"><em class="italic">Figure 16</em></span><em class="italic">.4</em> shows that everything is working on the anti-heroes form, from signing in to using <span class="No-Break">CRUD operations.</span></p>
			<p>With that, we have finished <a id="_idIndexMarker1213"/>packaging the Spring Boot and Angular applications. Now, let’s summarize what we <span class="No-Break">have learned.</span></p>
			<h1 id="_idParaDest-304"><a id="_idTextAnchor314"/>Summary</h1>
			<p>In this chapter, you learned that the <strong class="source-inline">frontend-maven-plugin</strong> and <strong class="source-inline">antrun-maven-plugin</strong> plugins can help you package your web client and Spring Boot application as one executable JAR file to make the deployment easy. You also learned how to run a JAR file on your local machine that helps you prepare your application <span class="No-Break">for deployment.</span></p>
			<p>In the next chapter, you will learn how to use GitHub Actions to prepare the applications for deployment. You will also learn how to use Heroku to create an instance of the database for the application and then deploy the application <span class="No-Break">to Heroku.</span></p>
		</div>
	</body></html>