<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;Information Fragments"><div class="titlepage"><div><div><h1 class="title"><a id="appA"/>Appendix A. Information Fragments</h1></div></div></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec99"/>Introduction</h1></div></div></div><p>This appendix contains various bits of code and procedures that are too generic to appear in regular chapters. They are used across several chapters but are presented here to avoid repetition.</p><p>This appendix covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Downloading the plugins</li><li class="listitem" style="list-style-type: disc">Enabling nightly builds</li><li class="listitem" style="list-style-type: disc">Adding Bullet physics to the application</li><li class="listitem" style="list-style-type: disc">Jaime animation frames for phonemes</li><li class="listitem" style="list-style-type: disc">The <code class="literal">AnimationEvent</code> patch</li><li class="listitem" style="list-style-type: disc">The <code class="literal">ImageGenerator</code> class</li><li class="listitem" style="list-style-type: disc">The <code class="literal">CellUtil</code> class</li></ul></div></div></div>
<div class="section" title="Downloading the plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec100"/>Downloading the plugins</h1></div></div></div><p>Go to <a id="id682" class="indexterm"/>the <span class="strong"><strong>Tools</strong></span> menu and select <span class="strong"><strong>Plugins</strong></span>. In the <span class="strong"><strong>Available Plugins </strong></span>tab, look for the plugin you would like to install, check the box next to it, and select <span class="strong"><strong>Install</strong></span>.</p></div>
<div class="section" title="Enabling nightly builds"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec101"/>Enabling nightly builds</h1></div></div></div><p>Nightly builds <a id="id683" class="indexterm"/>will give you the latest updates from the jMonkeyEngine repository, but it should be mentioned that these are unstable. From time to time, functions may be broken, and there is no guarantee at all that they can be built. To enable nightly builds, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the SDK, go to the <span class="strong"><strong>Tools</strong></span> menu and select <span class="strong"><strong>Plugins</strong></span>.</li><li class="listitem">Go to the <span class="strong"><strong>Settings</strong></span> tab and check the <span class="strong"><strong>jMonkeyEngine SDK Nightly (Breaks!)</strong></span> checkbox.</li><li class="listitem">To look for updates, go to the <span class="strong"><strong>Help</strong></span> menu and select <span class="strong"><strong>Check for updates</strong></span>.</li></ol></div></div>
<div class="section" title="Adding Bullet physics to the application"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec102"/>Adding Bullet physics to the application</h1></div></div></div><p>This <a id="id684" class="indexterm"/>section provides a description of the basic steps<a id="id685" class="indexterm"/> to add bullet physics to an application.</p><p>In the <code class="literal">simple InitApp</code> method of the application, add the following lines of code:</p><div class="informalexample"><pre class="programlisting">BulletAppState bulletAppState = new BulletAppState();
stateManager.attach(bulletAppState);</pre></div><p>To get a basic ground and some items to play with, add the following code:</p><div class="informalexample"><pre class="programlisting">PhysicsTestHelper.createPhysicsTestWorldSoccer(rootNode, assetManager, bulletAppState.getPhysicsSpace());</pre></div><p>Objects that require physics should both be attached to the scene graph and have a <code class="literal">RigidBodyControl</code> object, which is added to <code class="literal">physicsSpace</code> of <code class="literal">bulletAppState</code>.</p></div>
<div class="section" title="Jaime animation frames for phonemes"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec103"/>Jaime animation frames for phonemes</h1></div></div></div><p>The<a id="id686" class="indexterm"/> following list provides a number of <a id="id687" class="indexterm"/>frames found among Jaime's animations that are suitable for use as phonemes. They can be useful for those who wish to build up a library:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">To find the AAAH phoneme, use frame 30 of the Punches animation</li><li class="listitem" style="list-style-type: disc">To find the EEH phoneme, use frame 4 of the Wave animation</li><li class="listitem" style="list-style-type: disc">To find the I phoneme, use frame 9 of the Wave animation</li><li class="listitem" style="list-style-type: disc">To find the OH phoneme, use frame 22 of the Taunt animation</li><li class="listitem" style="list-style-type: disc">To find the OOOH phoneme, use frame 15 of the Wave animation</li><li class="listitem" style="list-style-type: disc">To find the FUH phoneme, use frame 7 of the Taunt animation</li><li class="listitem" style="list-style-type: disc">To find the MMM phoneme, use frame 1 of the Wave animation</li><li class="listitem" style="list-style-type: disc">To find the LUH phoneme, use frame 21 of the Punches animation</li><li class="listitem" style="list-style-type: disc">To find the EES phoneme, use frame 22 of the Wave animation</li><li class="listitem" style="list-style-type: disc">To find the RESET phoneme, use frame 0 of the Wave animation</li></ul></div></div>
<div class="section" title="The AnimationEvent patch"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec104"/>The AnimationEvent patch</h1></div></div></div><p>The following <a id="id688" class="indexterm"/>code snippet shows the patch needed for the <span class="emphasis"><em>Lip syncing and facial expressions</em></span> recipe of <a class="link" href="ch04.html" title="Chapter 4. Mastering Character Animations">Chapter 4</a>, <span class="emphasis"><em>Mastering Character Animations</em></span>. Apply this to the file in your project. If you're applying it manually, the constructor must be added to <code class="literal">AnimationEvent</code>, and the following lines of code have to go into the <code class="literal">initEvent</code> method just after <code class="literal">cinematic.putEventData(MODEL_CHANNELS, model, s);</code>:</p><div class="informalexample"><pre class="programlisting">int numChannels = model.getControl(AnimControl.class).getNumChannels();
for(int i = 0; i &lt; numChannels; i++){
  ((HashMap&lt;Integer, AnimChannel&gt;)s).put(i, model.getControl(AnimControl.class).getChannel(i));
}</pre></div><p>The full patch is:</p><div class="informalexample"><pre class="programlisting">Index: AnimationEvent.java
===================================================================
— AnimationEvent.java    (revision 11001)
+++ AnimationEvent.java    (working copy)
@@ -221,6 +221,24 @@
 initialDuration = model.getControl(AnimControl.class).getAnimationLength(animationName);
 this.channelIndex = channelIndex;
}
+
+/**
+ * creates an animation event
+ *
+ * @param model the model on which the animation will be played
+ * @param animationName the name of the animation to play
+ * @param channelIndex the index of the channel default is 0. Events on the
+ * @param blendTime the time during the animation are going to be blended
+ * same channelIndex will use the same channel.
+ */
+public AnimationEvent(Spatial model, String animationName, LoopMode loopMode, int channelIndex, float blendTime) {
+this.model = model;
+this.animationName = animationName;
+this.loopMode = loopMode;
+initialDuration = model.getControl(AnimControl.class).getAnimationLength(animationName);
+this.channelIndex = channelIndex;
+this.blendTime = blendTime;
+}

/**
* creates an animation event
@@ -264,11 +282,16 @@
Object s = cinematic.getEventData(MODEL_CHANNELS, model);
if (s == null) {
s = new HashMap&lt;integer , AnimChannel&gt;();
+int numChannels = model.getControl(AnimControl.class).getNumChannels();
+for(int i = 0; i &lt; numChannels; i++){
+ ((HashMap&lt;Integer, AnimChannel&gt;)s).put(i, model.getControl(AnimControl.class).getChannel(i));
+}
cinematic.putEventData(MODEL_CHANNELS, model, s);
 }

Map&lt;/integer&gt;&lt;integer , AnimChannel&gt; map = (Map&lt;/integer&gt;&lt;integer , AnimChannel&gt;) s;
this.channel = map.get(channelIndex);
+
if (this.channel == null) {
if (model == null) {
                     //the model is null we try to find it according to the name</pre></div></div>
<div class="section" title="The ImageGenerator class"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec105"/>The ImageGenerator class</h1></div></div></div><p>The <code class="literal">ImageGenerator</code> class<a id="id689" class="indexterm"/> is used in the <span class="emphasis"><em>Using noise to generate a terrain</em></span> recipe of <a class="link" href="ch03.html" title="Chapter 3. World Building">Chapter 3</a>, <span class="emphasis"><em>World Building</em></span>. The code to create this class is as follows:</p><div class="informalexample"><pre class="programlisting">public class ImageGenerator {

  public static void generateImage(float[][] terrain){
    int size = terrain.length;
    int grey;

    BufferedImage img = new BufferedImage(size, size, BufferedImage.TYPE_INT_RGB);
    for(int y = 0; y &lt; size; y++){
      for(int x = 0; x &lt; size; x++){
        double result = terrain[x][y];

        grey = (int) (result * 255);
        int color = (grey &lt;&lt; 16) | (grey &lt;&lt; 8) | grey;
        img.setRGB(x, y, color);

      }
    }

    try {
      ImageIO.write(img, "png", new File("assets/Textures/heightmap.png"));
    } catch (IOException ex) {
          Logger.getLogger(NoiseMapGenerator.class.getName()).log(Level.SEVERE, null, ex);
      }
    }
}</pre></div></div>
<div class="section" title="The CellUtil class"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec106"/>The CellUtil class</h1></div></div></div><p>The <code class="literal">CellUtil</code> class <a id="id690" class="indexterm"/>is used in the <span class="emphasis"><em>Flowing water with cellular automata</em></span> recipe of <a class="link" href="ch03.html" title="Chapter 3. World Building">Chapter 3</a>, <span class="emphasis"><em>World Building</em></span>. The code to create this class is as follows:</p><div class="informalexample"><pre class="programlisting">public class CellUtil {

  private static int[][] directions = new int[][]{{0,-1},{1,-1},{1,0},{1,1},{0,1},{-1,1},{-1,0},{-1,-1}};
  public static int getDirection(int x, int y){
    witch(x){
      case 1:
      switch(y){
        case -1:
        return 1;
        case 0:
        return 2;
        case 1:
        return 3;
      }
      break;
      case -1:
      switch(y){
        case -1:
        return 7;
        case 0:
        return 6;
        case 1:
        return 5;
      }
      break;
      case 0:
      switch(y){
        case -1:
        return 0;
        case 0:
        return -1;
        case 1:
        return 4;
      }
      break;
    }
    return -1;
  }

  public static int[] getDirection(int dir){
   return directions[dir];
  }
}</pre></div></div></body></html>