- en: Chapter 5. RESTful Web Services by Example
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The APIs and technologies introduced and discussed in the previous chapters
    are suitable for different types of projects and use cases. This chapter covers
    how these APIs and technologies can fit into solutions and case-oriented software
    systems.
  prefs: []
  type: TYPE_NORMAL
- en: After a brief introduction of what the application is supposed to do, we will
    break it down and focus on every component and technology used. So bring on the
    extra cup of mocha and join the fun.
  prefs: []
  type: TYPE_NORMAL
- en: 'This chapter will cover the following two samples:'
  prefs: []
  type: TYPE_NORMAL
- en: Event notification application showing Server-sent Events, **Async Servlet**,
    JSON-P API, and JAX-RS based on the **Twitter Search API**
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Library application showing JAX-RS API, WebSockets, JSON-P API, and asynchronous
    JAX-RS resources to form an end-to-end solution
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Event notification application
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Twitter-based application is the first sample application that will demonstrate
    a HTML5-based application developed on top of Server-sent Events, JAX-RS 2.0 API,
    Asynchronous Servlet, and the Twitter Search API together, to dynamically update
    a page with more search results periodically.
  prefs: []
  type: TYPE_NORMAL
- en: The build system used for the sample application is **Maven** and the sample
    can be deployed in any Java EE 7-compatible application server notably GlassFish
    v4.0, an open source reference implementation of the Java EE 7 specification.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Apache Maven is a build management tool. More information about Maven can be
    found at [http://maven.apache.org](http://maven.apache.org) and more information
    about GlassFish can be found at [https://glassfish.java.net/](http:// https://glassfish.java.net/)
  prefs: []
  type: TYPE_NORMAL
- en: The project's layout
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The project''s directory layout follows the standard Maven structure, which
    is briefly explained in the following table:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Source code | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `src/main/java` | This directory contains all the sources required by the
    library application. |'
  prefs: []
  type: TYPE_TB
- en: '| `src/main/webapp` | This directory contains the JavaScript files, html files,
    and `WEB-INF/web.xml` file. |'
  prefs: []
  type: TYPE_TB
- en: The event notification GUI
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The event notification application consists of one screen, which serves as
    the vehicle for showing dynamic updates based on the Twitter feeds. The screen
    is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The event notification GUI](img/8125EN_05_01.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The application is a basic sample showing updates as the events carrying the
    updates happen and are received. This could be a newer tweet coming in, or Facebook
    friends' updates, or any other type of events consumable by any of the Java EE-managed
    components. The key point is, once the channel of communication is established
    with the server, it is up to the server to keep sending updates as they occur.
    The client does not poll for updates.
  prefs: []
  type: TYPE_NORMAL
- en: In this sample, when the servlet is loaded there is an **EJB timer**, which
    is run every 10 seconds and activates a CDI bean that uses the Twitter Search
    API to get new tweets. The Twitter Search API returns the tweets in JSON format.
    This tweet information is then sent to the client using Server-sent Events support
    with JAX-RS. On the client side the JSON data is parsed to display certain information
    on the screen.
  prefs: []
  type: TYPE_NORMAL
- en: A detailed look at the event notification application
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After an initial introduction to what the application is supposed to do, let's
    dissect it further and study each individual component that builds this application.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is the order in which the details of the application will be covered:'
  prefs: []
  type: TYPE_NORMAL
- en: The `web.xml`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The implementation of the Application class
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The JAX-RS resource used in the application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Asynchronous Servlet client used by the application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The EJB that interacts with the Twitter Search API
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The web.xml
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To set up the application, configure the servlet deployment descriptor `web.xml`
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '`MyApplication` is a subclass of `javax.ws.rs.Application`. It is used to register
    the JAX-RS resource so that it is known the JAX-RS API.'
  prefs: []
  type: TYPE_NORMAL
- en: The `async-supported` element is set to `true` to indicate that the servlet
    supports asynchronous processing.
  prefs: []
  type: TYPE_NORMAL
- en: The implementation of the Application class
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here is the implementation of the `Application` subclass:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'The `getClasses()` method is overridden to return the:'
  prefs: []
  type: TYPE_NORMAL
- en: '`ServerSentEventsResource.class`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SseFeature.class`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `ServerSentEventsResource` class is a simple JAX-RS that sends the JSON
    data from the Twitter Search API as Server-sent Events. We shall look at the`ServerSentEventsResource`
    in more detail in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: The `SseFeature.class` is an implementation provided by **Jersey** to support
    the `ServerSentEvents` feature. It will ensure the data is of the media type `"text/event-stream"`.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To enable Server-sent Events feature, add `SseFeatures.class` to the list of
    classes returned by the `getClasses()` method in the implementation of the `javax.ws.rs.Application`.
  prefs: []
  type: TYPE_NORMAL
- en: The JAX-RS resource used by the application
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Here is the source code of the `ServerSentEventsResource.java`. This is a simple
    POJO, annotated with `@Path` to identify the URI of the resource.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: The `EventOutput` class is a channel that provides the outbound Server-sent
    Events. When we return the `EventOutput` object from the `getMessage()` method,
    the Jersey implementation keeps the connection open so that the Server-sent Events
    can be sent. One instance of this class corresponds with exactly one HTTP connection.
  prefs: []
  type: TYPE_NORMAL
- en: The `sendMessage()` method writes the message using the `eventOutput.write()`
    method. To write Server-sent Events, we use the `OutboundEvent.Builder()` method.
    A name `"custom-message"` is passed to this `OutboundEvent.Builder()` method and
    then we pass the message object to the `build()` method. The message object contains
    the tweets-related information for our sample.
  prefs: []
  type: TYPE_NORMAL
- en: Additionally, `OutboundEvent.Builder().id(id)` can be used to associate an ID
    with a Server-sent Event which is not covered previously.
  prefs: []
  type: TYPE_NORMAL
- en: The Asynchronous Servlet client used by the application
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In normal request response scenarios, a thread is kept running for each request
    till the response becomes available. This turns into a bottleneck in cases when
    the backend is taking a long time to process the requests, and the thread processing
    the request waits for the backend to finish preparing the required response and
    thus cannot take on any new incoming request.
  prefs: []
  type: TYPE_NORMAL
- en: One way to solve this would be to save the request in a centralized queue and
    send the request as the threads are available to process the request. Calling
    the `startAsync()` method stores the request/response pair in a queue, the `doGet()`
    method returns, and the calling thread can be recycled.
  prefs: []
  type: TYPE_NORMAL
- en: The following section discusses these concepts of asynchronous request processing
    with servlets.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the code of the Servlet client for the application:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: This is a Servlet with `urlPatterns={"/TestClient"}` and the `async-supported`
    attribute set to true. The `async-supported` attribute instructs the container
    that this servlet process the incoming requests asynchronously and thus the container
    should make the necessary modification in request allocation of the processing
    threads.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next snippet shows the implementation of the `service()` method that can
    handle the `GET` and `POST` requests:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: In the preceding snippet, an instance of the `AsyncContext` object is obtained
    by invoking the `request.startAsync()` method.
  prefs: []
  type: TYPE_NORMAL
- en: The `asyncContext.setTimeout(60000)` method indicates a timeout in milliseconds
    for the asynchronous operations of the servlet.
  prefs: []
  type: TYPE_NORMAL
- en: An implementation of an `AsyncListener` interface is added to the asynchronous
    context using the `asyncContext.addListener()` method.
  prefs: []
  type: TYPE_NORMAL
- en: After the `startAsync()` method is called on the request, an `AsyncEvent` object
    is sent to the implementation of the `AsyncListener` interface as the operation
    completes, there is an error, or the operation times out. As shown previously,
    we have an implementation of the `AsyncListener` interface that can implement
    the following methods `onComplete()`, `onError()`, `onTimeOut()`, or `onStartAsync()`.
  prefs: []
  type: TYPE_NORMAL
- en: The `AsyncRequestProcessor` class shown in the following code is the `Runnable`
    instance of the thread, which does the actual work. The `AsyncRequestProcessor`
    class registers the `EventSource` object to listen for the Server-sent Events,
    which are sent by the JAX-RS `ServerSentEventsResource.java`, covered earlier.
    As events occur the `onEvent()` callback is triggered and JSONP is used to parse
    the events.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: As seen in the preceding code, we use the **JSR 353 Java API for JSON Processing**
    to create a `JSonReader` object from the `inboundEvent#getData()` method. The
    `JSONArray` object is returned by the `jsonReader.readArray()` method. The `JsnObject`
    objects are read from the array and the tweet information is displayed.
  prefs: []
  type: TYPE_NORMAL
- en: The EJB that interacts with the Twitter Search API
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Here is the code for the EJB that will invoke the Twitter Search API. This EJB
    has a timer that will periodically call the Twitter Search API to get tweets for
    GlassFish and get the results in the JSON format.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: The `@Stateless` annotation indicates this is a stateless session bean.
  prefs: []
  type: TYPE_NORMAL
- en: '**Twitter v1.1 API** uses **OAuth** to provide authorized access to its API.
    Twitter offers applications the ability to issue authenticated requests on behalf
    of the application itself (as opposed to on behalf of a specific user). For more
    on **OAuth** please check [https://dev.twitter.com/docs/api/1.1/overview](https://dev.twitter.com/docs/api/1.1/overview).'
  prefs: []
  type: TYPE_NORMAL
- en: 'To run this demo, you will need to have a Twitter account and create an application
    based on information specified in this following link: [https://dev.twitter.com/docs/auth/oauth](https://dev.twitter.com/docs/auth/oauth).
    Please see the `Readme.txt` with the sample for instructions on how to run the
    sample.'
  prefs: []
  type: TYPE_NORMAL
- en: The following code uses the **twitter4j** API from [http://twitter4j.org/en/index.html](http://twitter4j.org/en/index.html)
    to integrate Java and the Twitter API.
  prefs: []
  type: TYPE_NORMAL
- en: Here is the code that will connect to `SEARCH_URL` and get the tweets
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: The preceding code reads the `twitter4j.properties` and creates a `ConfigurationBuilder`
    object with the `consumerKey`, `consumerSecret`, `accessToken`, and `accessTokenSecret`
    keys. Using the `TwitterFactory` API an instance of Twitter object is created.
    A `Query` object to send the search request to Twitter with the keyword `"glassfish"`
    is created. The `twitter.search` returns tweets that match a specified query.
    This method calls [http://search.twitter.com/search.json](http://search.twitter.com/search.json).
  prefs: []
  type: TYPE_NORMAL
- en: Once the `QueryResult` object is obtained, the `JsonArrayBuilder` object is
    used to build the JSON object containing the results. For more information on
    twitter4j API please check [http://twitter4j.org/oldjavadocs/3.0.0/index.html](http://twitter4j.org/oldjavadocs/3.0.0/index.html).
  prefs: []
  type: TYPE_NORMAL
- en: The EJB bean has an additional method that will invoke the **EJB timer**. Here
    is the EJB Timer code that will send these tweets, which are obtained from the
    Twitter Search API, to the REST Endpoint `ServerSentEventsResource` using the
    `POST` method.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: The `@Schedule` annotation is used to schedule fetching tweets every 10 seconds.
    The EJB specification has more details on usages of `@Schedule`. The `JsonArray`
    object statuses get the feeds from the `getFeedData()` method that was covered
    in the earlier section.
  prefs: []
  type: TYPE_NORMAL
- en: '`WebTarget` is created with the `TARGET_URI` that is the URL `http://localhost:8080/jersey-sse-twitter-sample`
    where the application is deployed.'
  prefs: []
  type: TYPE_NORMAL
- en: The `webTarget.path("twittersse")` method points to the location of the `ServerSentEventsResource`
    class covered earlier that is the REST resource.
  prefs: []
  type: TYPE_NORMAL
- en: Using the `request().post(Entity.text(message))` method the tweets that are
    obtained from the Twitter Search API are sent as a Text Entity.
  prefs: []
  type: TYPE_NORMAL
- en: 'This is the sequence of events:'
  prefs: []
  type: TYPE_NORMAL
- en: The user deploys the application and invokes the Servlet client from this URL
    `http://localhost:8080/jersey-sse-twitter-sample`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The EJB timer gets scheduled every 10 seconds.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The EJB timer will invoke the Twitter Search API to get the tweets for `"glassfish"`
    in JSON format.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The EJB timer sends the data obtained in step to the JAX-RS `ServerSentEventsResource`
    class using the `POST` request.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The JAX-RS resource `ServerSentEventsResource` opens the `EventOutput` channel,
    which is the outbound channel for the Server-sent Events.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Servlet client in step 1 has the `EventSource` object open that is listening
    for the Server-sent Events.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The Servlet client uses JSON-P API to parse the Twitter feeds.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally the tweets are shown in the browser.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The library application
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The library application is a simple, self-contained, real-life-based application
    that demonstrates HTML5 technologies such as WebSockets and shows how to use JAX-RS
    verbs, how to write data using JSON-P API, and how to take advantage of the asynchronous
    aspect of processing the resources. To stay on track the application contains
    the components that describe the preceding technologies using a simple GUI and
    does not have fancy dialog boxes or very complicated business logic.
  prefs: []
  type: TYPE_NORMAL
- en: How the application is deployed
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The build system used for the sample application is Maven and the sample can
    be deployed in any Java EE 7-compatible application server, notably GlassFish
    v4.0, which is an open source reference implementation of Java EE specification.
  prefs: []
  type: TYPE_NORMAL
- en: The project's layout
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The project''s directory layout follows the standard Maven structure, which
    is briefly explained in the following table:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Source code | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `src/main/java` | This directory contains all the sources required by the
    library application. |'
  prefs: []
  type: TYPE_TB
- en: '| `src/main/webapp` | This directory contains the JavaScript files, HTML files,
    and the `WEB-INF/web.xml` file. |'
  prefs: []
  type: TYPE_TB
- en: The library application GUI
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The library application consists of one screen that serves as the vehicle for
    showing different rendering of the data and forms for gathering inputs. The screen
    is shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![The library application GUI](img/8125EN_05_02.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Using the screen, a user can do the following operations:'
  prefs: []
  type: TYPE_NORMAL
- en: Browse the collection of books.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Search for a book.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Checkout a book.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Return a book.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Place hold on a book.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following table shows the action taken by a user, the details of what happens
    behind the scenes, and the API and technologies involved in processing the requests:'
  prefs: []
  type: TYPE_NORMAL
- en: '| Action | API and technology used |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Browse the collection of books | This task uses the JAX-RS `GET` verb to
    get the collection of books in the library. It uses the JSON-P API to write the
    data in JSON format. We use an implementation of JAX-RS `MessageBodyWriter` class,
    which knows how to serialize a custom class to JSON output. |'
  prefs: []
  type: TYPE_TB
- en: '| Borrow a book | When a book is checked out from the library it reduces from
    the collection of books, which the library has. This task demonstrates the use
    of the JAX-RS verb `DELETE` and deletes the book from the collection. |'
  prefs: []
  type: TYPE_TB
- en: '| Return a book | When a book is returned to the library it will be added to
    the collection of books that the library has. This task demonstrates the use of
    the JAX-RS verb `POST` and adds the book to the collection. |'
  prefs: []
  type: TYPE_TB
- en: '| Place hold on a book | When a book is placed on hold, the library application
    should notify other users currently having the book to return it. Once the book
    is returned, a notification should be sent to the user requesting the book. This
    is an asynchronous operation. This task demonstrates the use of asynchronous processing
    of the JAX-RS resources. |'
  prefs: []
  type: TYPE_TB
- en: Application interaction monitoring
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is a pane that will show what is the query, which was sent to the endpoint.
    Additionally, we will show the output returned by the endpoint.
  prefs: []
  type: TYPE_NORMAL
- en: A detailed look at the library application
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After an initial introduction to what the application is supposed to do, let's
    dissect it further and study each individual component that builds this application.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following is the order in which the details of the application will be
    covered:'
  prefs: []
  type: TYPE_NORMAL
- en: The `web.xml`
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `Application` subclass implementation in our application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The JAX-RS Entity Providers used in our application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The HTML page
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'JavaScript snippets and JAX-RS resource methods for the following functions:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Browsing the collection of books
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Searching for a book
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Checking out a book
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Returning a book
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Placing a hold on the book
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The web.xml
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To set up the application, configure the servlet deployment descriptor `web.xml`
    as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: In the preceding snippet, we defined a servlet to take the subclass of the JAX-RS
    Application `BookApplication`. The URL pattern is `/app/*`.
  prefs: []
  type: TYPE_NORMAL
- en: The Application subclass
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Here is the snippet of the `BookApplication` class, which is mentioned in the
    `web.xml` description.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'The `BookApplication` class extends the JAX-RS `Application` class. In the
    `getClasses()` method implementation, the following are registered:'
  prefs: []
  type: TYPE_NORMAL
- en: '`BookResource.class`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BookCollectionWriter.class`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`BookWriter.class`'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `BookResource` class is covered in detail in the next few sections, with
    every function of the JavaScript; the corresponding method of the `BookResource`
    class will be explained.
  prefs: []
  type: TYPE_NORMAL
- en: The `BookCollectionWriter` class is an implementation of a `MessageBodyWriter`
    interface, which takes a `List<Book>` object and serializes it to the JSON format.
    To produce the `application/json` encoded output, the `BookCollectionWriter` class
    uses JSON-P API.
  prefs: []
  type: TYPE_NORMAL
- en: The `BookWriter` class provides the facility to serialize the user-defined `Book`
    class, which is shown in the following section. The `Book` class has fields such
    as name of the book, author, and ISBN. Using this `BookWriter` class it is possible
    to convert this `Book` class into a format specified in the resource, for example,
    `"text/plain"` or `"application/json"`.
  prefs: []
  type: TYPE_NORMAL
- en: 'JAX-RS Entity Provider: BookCollectionWriter'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Similar to the `BookWriter` class covered in the earlier section there is a
    class called `BookCollectionWriter` in the sample; this is used to serialize a
    list of books. Here is an implementation of the `writeTo()` method in the `BookCollectionWriter`
    class:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: The preceding code does media type filtering; if the `mediaType` parameter equals
    `MediaType.APPLICATION_JSON_TYPE`, then it uses the JSON-P API to create a `JsonGenerator`
    object. Using the `writeStartArray()` and `writeStartObject()` methods of `JsonGenerator`
    class, the array of JSON objects is written.
  prefs: []
  type: TYPE_NORMAL
- en: If the `mediaType` parameter equals `MediaType.TEXT_PLAIN_TYPE`, then a String
    representation of the books is returned.
  prefs: []
  type: TYPE_NORMAL
- en: The HTML page
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As you may recall, when the application is launched in the browser, you will
    see the `index.html` screen. Let''s take a peek at the source code of the `index.html`
    file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'This is standard HTML, which uses an external JavaScript file called `main.js`
    to import the following functionalities:'
  prefs: []
  type: TYPE_NORMAL
- en: Browsing the collection of books
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Searching for a book
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Checking out a book
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returning a book
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Placing hold on a book
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The highlighted `div` elements `query` and `output` show the JAX-RS query and
    the output on the page. Every button has an `onclick()` event associated with
    it that calls a function in JavaScript. Each function shall be covered in detail
    in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Browsing the collection of books
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When a user clicks on the **Browse Collection** button on the HTML page, the
    input is checked and then the `sendBrowseRequest()` function is called in the
    JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Using JavaScript
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet of the `sendBrowseRequest()`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: The `createRequest()` function is used to create an `XMLHttpRequest` object
    as covered in [Chapter 2](ch02.html "Chapter 2. WebSockets and Server-sent Events"),
    *WebSockets and Server-sent Events*. The request, which is sent to the JAX-RS
    resource, is a `GET` request with the URI `/app/library/books` (we shall cover
    the JAX-RS resource in the next section). When the value of the `XMLHttpRequest`
    object's `readyState` is `4`, it means that the response is complete and we can
    get the data. In our sample, we display the `responseText` using the snippet `document.getElementById("output").innerHTML=req.responseText;`.
  prefs: []
  type: TYPE_NORMAL
- en: The JAX-RS resource method for the GET request
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet for the `GET` request:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: This is a very simple method that will use the `BookCollectionWriter` class
    that we covered earlier to output the `List<Book>` objects in JSON format or in
    the plain text format.
  prefs: []
  type: TYPE_NORMAL
- en: Searching for a book
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When a user clicks on the **Search** button on the HTML page, the `sendSearchWSRequest()`
    function is called in the JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Using JavaScript
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'The `sendSearchWSRequest()` function demonstrates the WebSockets functionality
    in our application. A WebSocket URI is initializing in the JavaScript as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: The `sendSearchWSRequest()` function uses the WebSocket JavaScript API to send
    the string `book` name to the `BookWebSocket` class shown in the following section.
  prefs: []
  type: TYPE_NORMAL
- en: The WebSockets endpoint
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet for the WebSockets''s `ServerEndpoint` annotated class
    `BookWebSocket`:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: The `BookWebSocket` is a POJO that is annotated with `@ServerEndpoint` and initialized
    to a URI of `/app/websockets`. The `@OnMessage` annotation on the `searchBook()`
    method will cause this method to be invoked when the WebSockets server endpoint
    receives the message. The WebSockets endpoint simply returns back a string with
    the name of the book for the case of simplicity of the sample.
  prefs: []
  type: TYPE_NORMAL
- en: Checking out a book
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When a user clicks on the **Checkout** button on the HTML page, the input is
    checked and then the `sendCheckoutRequest()` function is called in the JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Using JavaScript
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet of the `sendCheckoutRequest()` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: The request, which is sent to the JAX-RS resource, is a `DELETE` request placed
    on the `/app/library/book/` URI. We will cover the JAX-RS resource in the next
    section.
  prefs: []
  type: TYPE_NORMAL
- en: The JAX-RS resource method for the DELETE request
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the code snippet for the `DELETE` request:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: This is a very simple method that will delete the book if it exists in the collection
    and send back the book details using the `BookWriter` class covered earlier.
  prefs: []
  type: TYPE_NORMAL
- en: Returning a book
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When a user clicks on the **Return** button on the HTML page, the input is checked
    and then the `sendReturnRequest()` function is called in the JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Using JavaScript
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet of the `sendReturnRequest()` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: The request, which is sent to the JAX-RS resource, is a `POST` request with
    `app/library/book/` as the target URI.
  prefs: []
  type: TYPE_NORMAL
- en: The JAX-RS resource method for the POST request
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the code snippet for the `POST` request:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Placing a hold on a book
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: When a user clicks on the **Hold** button on the HTML page, the input is checked
    and then the `sendHoldRequest()` function is called in the JavaScript.
  prefs: []
  type: TYPE_NORMAL
- en: Using JavaScript
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the snippet of the `sendHoldRequest()` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: A `POST` request is sent to the JAX-RS resource located at the `app/library/hold/`
    URI. The resource is described in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: The JAX-RS resource method for the asynchronous POST request
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Here is the JAX-RS resource method that places a hold on a book. This is an
    asynchronous resource, which is covered in [Chapter 4](ch04.html "Chapter 4. JSON
    and Asynchronous Processing"), *JSON and Asynchronous Processing*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: The parameter `ar` of type `AsyncResponse` is similar to the `AsyncContext`
    class in the Servlet 3.0 specification and facilitates asynchronous request execution.
    In this example the request is suspended for a specific duration and the response
    is pushed to the client with the `AsyncResponse.resume()` method.
  prefs: []
  type: TYPE_NORMAL
- en: The Singleton EJB BookService
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Here is the code for the Singleton EJB, which stores the details about the
    books:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: Thus, we have seen a detailed view of the library application, which uses the
    different JAX-RS 2.0, WebSockets, and JSON-P APIs.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This chapter covered two real life examples of RESTful Web Services. At the
    beginning, using the event notification sample, we demonstrated how to use Server-sent
    Events with asynchronous processing of servlets and how the server can push data
    to the clients as and when the events occur.
  prefs: []
  type: TYPE_NORMAL
- en: Continued on, in the library application we covered the JAX-RS API and also
    the custom message body readers, writers. We also demonstrated the use of JSON-P
    API. The library application showed how to use WebSockets from a JavaScript client
    and send messages to WebSockets endpoints.
  prefs: []
  type: TYPE_NORMAL
