<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Publishing to an Ivy Repository" id="aid-1ENBI1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Publishing to an Ivy Repository</h1></div></div></div><p>You learned in a previous chapter how we can publish our project artifacts to a Maven repository. In this chapter, we are going to use an Ivy repository to which we can publish.</p><p>Just as with publishing to a Maven repository, we are going to use the new and incubating publishing feature in Gradle to publish to an Ivy repository.</p><div class="section" title="Defining publications"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec43"/>Defining publications</h1></div></div></div><p>We must add the <code class="literal">ivy-publish</code> plugin to our project to be able to publish our artifacts to an Ivy repository. The <a id="id248" class="indexterm"/>plugin allows us to use the Ivy format to describe our artifacts that need to be published.</p><p>The <code class="literal">ivy-publish</code> plugin is based on the general <code class="literal">publishing</code> plugin. The <code class="literal">publishing</code> plugin adds a new <code class="literal">publishing</code> extension to our project. We can use a <code class="literal">publications</code> configuration block in our build script to configure the artifacts we want to publish and the repositories we want to deploy to. The <code class="literal">publications</code> extension has the <code class="literal">PublishingExtension</code> type in the <code class="literal">org.gradle.api.publish</code> package. The plugin also adds a general life cycle <code class="literal">publish</code> task to the project. Other tasks can be added as task dependencies to this task, so with a single <code class="literal">publish</code> task, all the project's publications can be published.</p><p>The <code class="literal">ivy-publish</code> plugins also adds some extra task rules to the project. There is a task to generate an Ivy descriptor file to each publication in the project. The plugins also add a task rule based on a combination of the publication and the repository to publish a publication to the specified repository.</p><p>Let's create an example build file and apply the <code class="literal">ivy-publish</code> plugin to see the new task:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'</pre></div><p>Now, we will invoke the <code class="literal">tasks</code> task from the command line:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle tasks</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Publishing tasks</strong></span>
<span class="strong"><strong>----------------</strong></span>
<span class="strong"><strong>publish - Publishes all publications produced by this project.</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 4.589 secs</strong></span>
</pre></div><p>In the output, we see the <code class="literal">publish</code> task. The dynamic task rules to publish single publications to repositories are not shown.</p><p>To configure our publications, we must first add a <code class="literal">publishing</code> configuration block. Inside the block, we will define the <code class="literal">publications</code> configuration block. In this block, we define a publication. A publication defines what needs to be published. The <code class="literal">ivy-publish</code> plugin expects <a id="id249" class="indexterm"/>that a publication of the <code class="literal">IvyPublication</code> type is found in the <code class="literal">org.gradle.api.publish.ivy</code> package. Besides the artifacts that need to be published, we can also define details for the generated Ivy descriptor file.</p></div></div>
<div class="section" title="Defining publication artifacts" id="aid-1FLS41"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec44"/>Defining publication artifacts</h1></div></div></div><p>A publication <a id="id250" class="indexterm"/>we define must have a unique name in our project. We can add multiple publications with their own name inside a <code class="literal">publications</code> configuration block. To add an artifact, we can use the <code class="literal">artifact</code> method in the publication definition. We can also use the <code class="literal">artifacts</code> property to directly set all artifacts.</p><p>We can define the artifact with the <code class="literal">artifact</code> method in the ways described in the following table:</p><div class="informaltable"><table border="1"><colgroup><col/><col/></colgroup><thead><tr><th valign="bottom">
<p>Type</p>
</th><th valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td valign="top">
<p>
<code class="literal">AbstractArchiveTask</code>
</p>
</td><td valign="top">
<p>The information for the artifact is extracted from the archive task. The artifact is an instance of <code class="literal">PublishArtifact</code> in the <code class="literal">org.gradle.api.artifacts</code> package.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">File</code>
</p>
</td><td valign="top">
<p>The information for the artifact is extracted from the filename.</p>
</td></tr><tr><td valign="top">
<p>
<code class="literal">Map</code>
</p>
</td><td valign="top">
<p>This is another way to define artifacts. The map must contain a <code class="literal">source</code> key referencing a file or archive task and other properties we can use, such as <code class="literal">classifier</code> and <code class="literal">extension</code>, to further configure the artifact.</p>
</td></tr></tbody></table></div></div>
<div class="section" title="Using archive task artifacts" id="aid-1GKCM1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec45"/>Using archive task artifacts</h1></div></div></div><p>In the <a id="id251" class="indexterm"/>following example <a id="id252" class="indexterm"/>build file, we define a new publication with the <code class="literal">publishJar</code> name and we define the output of the <code class="literal">jar</code> archive task as an artifact:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

// Configuration block for publishing
// artifacts from the project.
publishing {

  // Define publications with what
  // needs to be published.
  publications {

    // Name of this publication
    // is publishJar.
    publishJar(IvyPublication) {

      // Use output of jar task
      // as the artifact for
      // the publication.
      artifact jar

      // Alternatively we can use
      // a Map notation:
      // artifact source: jar
    }

  }
}</pre></div><p>Next, we run the <code class="literal">tasks</code> task, and in the output, we see new generated tasks to publish this publication:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle tasks</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Publishing tasks</strong></span>
<span class="strong"><strong>----------------</strong></span>
<span class="strong"><strong>generateDescriptorFileForPublishJarPublication - Generates the Ivy Module Descriptor XML file for publication 'publishJar'.</strong></span>
<span class="strong"><strong>publish - Publishes all publications produced by this project.</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 4.215 secs</strong></span>
</pre></div><p>Notice the extra task, <code class="literal">generateDescriptorFileForPublishJarPublication</code>. The name of the <code class="literal">publishJar</code> publication is used for this task. Gradle uses the following pattern for a task to generate an Ivy descriptor XML file for a <code class="literal">generateDescriptorFileFor&lt;publicationName&gt;Publication</code> publication. We cannot yet invoke the task because we also need to set the <code class="literal">group</code> and <code class="literal">version</code> project properties, but we will see this in the section about generating an Ivy descriptor file. We will now focus on defining the artifacts for a publication in this section.</p><p>We are not restricted to one artifact for a publication; we can add more by invoking the <code class="literal">artifact</code> method multiple times. We can even use the <code class="literal">artifacts</code> property to assign multiple artifacts. It is important that each artifact has unique <code class="literal">classifier</code> and <code class="literal">extension</code> property <a id="id253" class="indexterm"/>values for <a id="id254" class="indexterm"/>a single publication. Gradle will check this before we can invoke any tasks, so we immediately get an error message when the artifacts don't have a unique combination of <code class="literal">classifier</code> and <code class="literal">extensions</code> property values.</p><p>In the following example build file, we add two extra artifacts to our publication with the <code class="literal">artifact</code> method:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

task sourcesJar(type: Jar) {
  from sourceSets.main.allJava
  classifier = 'sources'
}

task javadocJar(type: Jar) {
  from javadoc
}

publishing {

  publications {

    publishJar(IvyPublication) {

      artifact jar

      // Add output of sourcesJar task
      // as an artifacts. In the task
      // the classifier is already
      // set to sources.
      artifact sourcesJar

      artifact javadocJar {
        // Each artifact must have
        // a unique classifier.
        // We can set the classifier
        // via the task as in sourcesJar
        // or here in the artifact configuration.
        classifier = 'javadoc'
      }

      // Or with a Map notation we
      // can write:
      // artifact source: javadocJar, classifier: 'javadoc'

    }

  }
}</pre></div><p>Instead of using the <code class="literal">artifact</code> method, we can also use the <code class="literal">artifacts</code> property and assign multiple artifacts. Each of the artifacts we assign must have a unique combination of <code class="literal">classifier</code> <a id="id255" class="indexterm"/>and <code class="literal">extension</code> <a id="id256" class="indexterm"/>property values. In the next example build file, we will use the same artifacts as in the previous example, but this time, we will assign them to the <code class="literal">artifacts</code> property:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

task sourcesJar(type: Jar) {
  from sourceSets.main.allJava
  classifier = 'sources'
}

task javadocJar(type: Jar) {
  from javadoc
  classifier = 'javadoc'
}

publishing {

  publications {

    publishJar(IvyPublication) {

      // Use artifacts property to
      // define the artifacts.
      // The classifier for each of
      // these artifacts must be
      // unique.
      artifacts = [
        jar,
        sourcesJar,
        javaDocJar]

    }

  }
}</pre></div><div class="section" title="Using file artifacts"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec42"/>Using file artifacts</h2></div></div></div><p>Instead of an <a id="id257" class="indexterm"/>archive task, we can also use a file as an artifact. Gradle tries to extract the <code class="literal">extension</code> and <code class="literal">classifier</code> <a id="id258" class="indexterm"/>properties from the filename. We can also configure these properties ourselves when we add the file as a publication artifact.</p><p>In the following example build file, we use the <code class="literal">src/files/README</code> and <code class="literal">src/files/COPYRIGHT</code> files as a publication artifact:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'

publishing {
  publications {
    documentation(IvyPublication) {

      // Use file name as a publication artifact.
      artifact 'src/files/README'

      artifact('src/files/COPYRIGHT') {
        // Each file artifact must have a
        // unique classifier and extension.
        classifier = 'metaInformation'
      }

      // Alternative syntax is with
      // the Map notation:
      // artifact source: 'src/files/README'
      // artifact source: 'src/files/COPYRIGHT',
      //          extension: 'metaInformation'

    }
  }
}</pre></div></div><div class="section" title="Using software components"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec43"/>Using software components</h2></div></div></div><p>Besides the <a id="id259" class="indexterm"/>
<code class="literal">artifact</code> method and the <code class="literal">artifacts</code> property, we can also use the <code class="literal">from</code> method inside a <code class="literal">publications</code> configuration block. We specify a Gradle <code class="literal">SoftwareComponent</code> object as an argument to the <code class="literal">from</code> method. The <code class="literal">java</code> plugin adds a <code class="literal">SoftwareComponent</code> object with the name <code class="literal">java</code>, and it includes the <code class="literal">jar</code> artifact and all runtime dependencies. The <code class="literal">war</code> plugin adds the <code class="literal">war</code> artifact as a <code class="literal">SoftwareComponent</code> object.</p><p>In the next <a id="id260" class="indexterm"/>example build file, we will apply the <code class="literal">war</code> plugin to our project. The <code class="literal">war</code> plugin extends the <code class="literal">java</code> plugin, so we will also implicitly apply the <code class="literal">java</code> plugin to our project. We will also define two publications, with each using the <code class="literal">SoftwareComponent</code> object from both plugins:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'war'


publishing {

  publications {

    // First publication with
    // the name javaJar, contains
    // the artifact created by the
    // jar task.
    javaJar(IvyPublication) {
      from components.java
    }

    // Second publication with
    // the name webWar, contains
    // the artifact created by
    // the war task.
    webWar(IvyPublication) {
      from components.web
    }

  }

}</pre></div></div></div>
<div class="section" title="Generating Ivy descriptor files"><div class="titlepage" id="aid-1HIT82"><div><div><h1 class="title"><a id="ch07lvl1sec46"/>Generating Ivy descriptor files</h1></div></div></div><p>An <a id="id261" class="indexterm"/>important part of an Ivy <a id="id262" class="indexterm"/>publication is the descriptor file. We already saw that Gradle added a <code class="literal">generateDescriptorFile&lt;publicationName&gt;</code> task to our project. Furthermore, we can define some properties of the descriptor file inside a publication configuration. Gradle also offers a hook to customize the generated descriptor file even further.</p><p>Gradle uses the project's <code class="literal">version</code>, <code class="literal">group</code>, <code class="literal">name</code>, and <code class="literal">status</code> properties for the <code class="literal">info</code> element in the Ivy descriptor file generated. We will create a new example build file where we define the project properties, so they will be included in the file:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

// Defined project properties, that are
// used in the generated descriptor file.
// The name of the project is by default
// the directory name, but we can
// change it via a settings.gradle file
// and the rootProject.name property.
version = '2.1.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(IvyPublication) {
      from components.java
    }
  }
}</pre></div><p>Now, we execute the <code class="literal">generateDescriptorFileForSamplePublication</code> task. An <code class="literal">ivy.xml</code> file is created in the <code class="literal">build/publications/sample</code> directory. If we open the file, we can see that the <code class="literal">info</code> element attributes are filled with the values from our Gradle build file. The <a id="id263" class="indexterm"/>following code shows this:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ivy-module version="2.0"&gt;
  &lt;info organisation="book.gradle" module="sample" revision="2.1.RELEASE" status="integration" publication="20150424051601"/&gt;
  &lt;configurations&gt;
    &lt;conf name="default" visibility="public" extends="runtime"/&gt;
    &lt;conf name="runtime" visibility="public"/&gt;
  &lt;/configurations&gt;
  &lt;publications&gt;
    &lt;artifact name="sample" type="jar" ext="jar" conf="runtime"/&gt;
  &lt;/publications&gt;
  &lt;dependencies&gt;
    &lt;dependency org="org.springframework" name="spring-context" rev="4.1.4.RELEASE" conf="runtime-&amp;gt;default"/&gt;
  &lt;/dependencies&gt;
&lt;/ivy-module&gt;</pre></div><p>We can override the values for <code class="literal">organisation</code>, <code class="literal">module</code>, <code class="literal">revision</code>, <code class="literal">status</code>, and <code class="literal">branch</code> inside a publication configuration. We need to set the properties in the configuration block of <code class="literal">IvyPublication</code>. The <code class="literal">status</code> and <code class="literal">branch</code> properties need to be set via the <a id="id264" class="indexterm"/>
<code class="literal">descriptor</code> property. Via the <code class="literal">descriptor</code> property, we can also add new child elements to the <code class="literal">info</code> element in the Ivy descriptor file. In the next example build file, we will use these methods to set the values:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.DEVELOPMENT'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(IvyPublication) {
      organisation = 'book.sample.gradle'
      module ='bookSample'
      version = '2.1'
      descriptor.status = 'published'
      descriptor.branch = 'n/a'

      // Add extra element as child
      // for info.
      descriptor.extraInfo '', 'ivyauthor', 'Hubert Klein Ikkink'

      from components.java
    }
  }
}</pre></div><p>We execute the <code class="literal">generateDescriptorFileForSamplePublication</code> task again, as shown in the <a id="id265" class="indexterm"/>following code, and we see the new values in the generated Ivy descriptor file:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ivy-module version="2.0"&gt;
  &lt;info organisation="book.sample.gradle" module="bookSample" branch="n/a" revision="2.1.DEVELOPMENT" status="published" publication="20150424053039"&gt;
    &lt;ns:ivyauthor xmlns:ns=""&gt;Hubert Klein Ikkink&lt;/ns:ivyauthor&gt;
  &lt;/info&gt;
  &lt;configurations&gt;
    &lt;conf name="default" visibility="public" extends="runtime"/&gt;
    &lt;conf name="runtime" visibility="public"/&gt;
  &lt;/configurations&gt;
  &lt;publications&gt;
    &lt;artifact name="bookSample" type="jar" ext="jar" conf="runtime"/&gt;
  &lt;/publications&gt;
  &lt;dependencies&gt;
    &lt;dependency org="org.springframework" name="spring-context" rev="4.1.4.RELEASE" conf="runtime-&amp;gt;default"/&gt;
  &lt;/dependencies&gt;
&lt;/ivy-module&gt;</pre></div><p>The dependencies <a id="id266" class="indexterm"/>of our project are added as dependencies in the generated descriptor file. This happens because we use the <code class="literal">from</code> method with the <code class="literal">components.java</code> value inside our publication configuration. The Java software component not only adds the <code class="literal">jar</code> archive tasks as an artifact, but also turns the project dependencies into dependencies in the descriptor file. If we use an archive task to define an artifact, the <code class="literal">dependencies</code> element is not added to the file.</p><p>In the following example build file, we use the <code class="literal">artifact</code> method to define the publication:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

// Defined project properties, that are
// used in the generated descriptor file.
// The name of the project is by default
// the directory name, but we can
// change it via a settings.gradle file
// and the rootProject.name property.
version = '2.1.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(IvyPublication) {
      artifact jar
    }
  }
}</pre></div><p>When we run <a id="id267" class="indexterm"/>the <code class="literal">generateDescriptorFileForSamplePublication</code> task from the command line, the Ivy descriptor file is generated. The contents of the file are now as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ivy-module version="2.0"&gt;
  &lt;info organisation="book.gradle" module="sample" revision="2.1.RELEASE" status="integration" publication="20150424053351"/&gt;
  &lt;configurations/&gt;
  &lt;publications&gt;
    &lt;artifact name="sample" type="jar" ext="jar"/&gt;
  &lt;/publications&gt;
  &lt;dependencies/&gt;
&lt;/ivy-module&gt;</pre></div><p>In the next <a id="id268" class="indexterm"/>section, you will learn <a id="id269" class="indexterm"/>how we can customize the descriptor using the <code class="literal">withXml</code> method of the <code class="literal">descriptor</code> property. We can then, for example, also change the dependency scope of our project dependencies.</p><div class="section" title="Customizing the descriptor file"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec44"/>Customizing the descriptor file</h2></div></div></div><p>To add <a id="id270" class="indexterm"/>extra elements to the generated file, we must use the <code class="literal">descriptor</code> property that is part of <code class="literal">IvyPublication</code>. This returns an <code class="literal">IvyModuleDescriptorSpec</code> object, and we will invoke the <code class="literal">withXml</code> method from this object to add extra elements to the descriptor file. We use a closure with the <code class="literal">withXml</code> method to access an <code class="literal">XmlProvider</code> object. With the <code class="literal">XmlProvider</code> object, we can get a reference to a DOM element with the <code class="literal">asElement</code> method, a Groovy node object with the <code class="literal">asNode</code> method, or a <code class="literal">StringBuilder</code> object with the <code class="literal">asString</code> method to extend the descriptor XML.</p><p>In the following example build file, we add the <code class="literal">description</code> and <code class="literal">issueMangement</code> elements to the generated descriptor file:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(IvyPublication) {
      from components.java

      // Customize generated descriptor XML.
      descriptor.withXml {

        asNode()
          .appendNode('description', 
                'Sample Gradle project')

        asNode()
          .appendNode('issueManagement')
          .with {
            appendNode('system', 'Jenkins')
            appendNode('url', 'http://buildserver/')
          }
      }
    }
  }
}</pre></div><p>If we <a id="id271" class="indexterm"/>generate the Ivy descriptor file, we can see our newly created elements in the XML version:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ivy-module version="2.0"&gt;
  &lt;info organisation="book.gradle" module="sample" revision="2.1.RELEASE" status="integration" publication="20150424053914"/&gt;
  &lt;configurations&gt;
    &lt;conf name="default" visibility="public" extends="runtime"/&gt;
    &lt;conf name="runtime" visibility="public"/&gt;
  &lt;/configurations&gt;
  &lt;publications&gt;
    &lt;artifact name="sample" type="jar" ext="jar" conf="runtime"/&gt;
  &lt;/publications&gt;
  &lt;dependencies&gt;
    &lt;dependency org="org.springframework" name="spring-context" rev="4.1.4.RELEASE" conf="runtime-&amp;gt;default"/&gt;
  &lt;/dependencies&gt;
  &lt;description&gt;Sample Gradle project&lt;/description&gt;
  &lt;issueManagement&gt;
    &lt;system&gt;Jenkins&lt;/system&gt;
    &lt;url&gt;http://buildserver/&lt;/url&gt;
  &lt;/issueManagement&gt;
&lt;/ivy-module&gt;</pre></div><p>In the previous section, you already learned that if we use the <code class="literal">from</code> method with the <code class="literal">components.java</code> value, all project dependencies are added as runtime dependencies in the generated descriptor file. This might not be what we always want. Using the <code class="literal">withXml</code> method, we can not only add new elements, but also change values.</p><p>Let's add a hook where we change the module attribute of the info element. In the next build file, we will implement this:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.RELEASE'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {
  publications {
    sample(IvyPublication) {
      from components.java

      descriptor.withXml {
        // Replace value for module attribute
        // in info element.
        new StringBuilder(
          asString()
            .replaceAll(
              /module="sample"/,
              'module="ivyChapter"'))
      }
    }
  }
}</pre></div><p>The generated <a id="id272" class="indexterm"/>descriptor file now has the following contents:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ivy-module version="2.0"&gt;
  &lt;info organisation="book.gradle" module="ivyChapter" revision="2.1.RELEASE" status="integration" publication="20150424055754"/&gt;
  &lt;configurations&gt;
    &lt;conf name="default" visibility="public" extends="runtime"/&gt;
    &lt;conf name="runtime" visibility="public"/&gt;
  &lt;/configurations&gt;
  &lt;publications&gt;
    &lt;artifact name="sample" type="jar" ext="jar" conf="runtime"/&gt;
  &lt;/publications&gt;
  &lt;dependencies&gt;
    &lt;dependency org="org.springframework" name="spring-context" rev="4.1.4.RELEASE" conf="runtime-&amp;gt;default"/&gt;
  &lt;/dependencies&gt;
&lt;/ivy-module&gt;</pre></div></div></div>
<div class="section" title="Defining repositories"><div class="titlepage" id="aid-1IHDQ2"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Defining repositories</h1></div></div></div><p>We must <a id="id273" class="indexterm"/>configure an Ivy repository to publish our configured publication. We can choose a local directory or a repository manager, such as Artifactory or Nexus.</p><div class="section" title="Publishing to a local directory"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec45"/>Publishing to a local directory</h2></div></div></div><p>If we have a <a id="id274" class="indexterm"/>directory where we <a id="id275" class="indexterm"/>want to publish our publications, we must add it to the <code class="literal">publishing</code> configuration block. Inside the block, we add a <code class="literal">repositories</code> configuration block containing one or more named repositories. For the combination of each publication and repository, Gradle creates a task with the <code class="literal">publish&lt;publicationName&gt;To&lt;repositoryName&gt;Repository</code> name pattern.</p><p>We define a simple directory repository in the next example build file with the name <code class="literal">localRepo</code>:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.DEVELOPMENT'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {

  publications {
    publishJar(IvyPublication) {
      module = 'sample'

      from components.java
    }
  }

  // Add a local director as repository
  // for the publications.
  repositories {
    ivy {
      name = 'localRepo'
      url = "$buildDir/localRepo"
    }
  }
}</pre></div><p>First, we run the <code class="literal">tasks</code> task to see which task is added to the <code class="literal">Publishing tasks</code> group:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle tasks</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Publishing tasks</strong></span>
<span class="strong"><strong>----------------</strong></span>
<span class="strong"><strong>generateDescriptorFileForPublishJarPublication - Generates the Ivy Module Descriptor XML file for publication 'publishJar'.</strong></span>
<span class="strong"><strong>publish - Publishes all publications produced by this project.</strong></span>
<span class="strong"><strong>publishPublishJarPublicationToLocalRepoRepository - Publishes Ivy publication 'publishJar' to Ivy repository 'localRepo'.</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 11.514 secs</strong></span>
</pre></div><p>To publish our <a id="id276" class="indexterm"/>project's artifact, we <a id="id277" class="indexterm"/>can execute the <code class="literal">publishPublishJarPublicationToLocalRepoRepository</code> or <code class="literal">publish</code> tasks. The following output shows the tasks that are executed:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle publish</strong></span>
<span class="strong"><strong>:generateDescriptorFileForPublishJarPublication</strong></span>
<span class="strong"><strong>:compileJava</strong></span>
<span class="strong"><strong>:processResources UP-TO-DATE</strong></span>
<span class="strong"><strong>:classes</strong></span>
<span class="strong"><strong>:jar</strong></span>
<span class="strong"><strong>:publishPublishJarPublicationToLocalRepoRepository</strong></span>
<span class="strong"><strong>:publish</strong></span>

<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 6.383 secs</strong></span>
</pre></div><p>Once the task <a id="id278" class="indexterm"/>has been run, we get the <a id="id279" class="indexterm"/>following files in the <code class="literal">build/localRepo</code> directory:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>build/localRepo/</strong></span>
<span class="strong"><strong>└── book.gradle</strong></span>
<span class="strong"><strong>    └── sample</strong></span>
<span class="strong"><strong>        └── 2.1.DEVELOPMENT</strong></span>
<span class="strong"><strong>            ├── ivy-2.1.DEVELOPMENT.xml</strong></span>
<span class="strong"><strong>            ├── ivy-2.1.DEVELOPMENT.xml.sha1</strong></span>
<span class="strong"><strong>            ├── sample-2.1.DEVELOPMENT.jar</strong></span>
<span class="strong"><strong>            └── sample-2.1.DEVELOPMENT.jar.sha1</strong></span>
</pre></div></div><div class="section" title="Publishing to Artifactory"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec46"/>Publishing to Artifactory</h2></div></div></div><p>To publish our <a id="id280" class="indexterm"/>publications to an Artifactory repository, we only have to configure the repository in the <code class="literal">publications.repositories</code> configuration block. We can set the <code class="literal">url</code> property, a <code class="literal">name</code>, and <a id="id281" class="indexterm"/>optional security credentials.</p><p>In the next example build file, we will use an Artifactory repository to publish the publication to:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.DEVELOPMENT'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {

  publications {
    publishJar(IvyPublication) {
      module = 'sample'

      from components.java
    }
  }

  // Add a Artifactory repository for
  // the publications with Maven layout.
  repositories {
    ivy {
      name = 'artifactory'
      url = "http://localhost:8081/artifactory/libs-release-local"

      // Username and password should be
      // saved outside build file in
      // real life, eg. in gradle.properties.
      credentials {
        username = 'user'
        password = 'passw0rd'
      }
    }
  }
}</pre></div><p>Gradle creates a new task, <code class="literal">publishPublishJarPublicationToArtifactoryRepository</code>, based on the publication name <a id="id282" class="indexterm"/>and the repository <a id="id283" class="indexterm"/>name. When we invoke the task, we can see that the publication is deployed to the Artifactory repository, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle publishPublishJarPublicationToArtifactoryRepository</strong></span>
<span class="strong"><strong>:generateDescriptorFileForPublishJarPublication</strong></span>
<span class="strong"><strong>:compileJava UP-TO-DATE</strong></span>
<span class="strong"><strong>:processResources UP-TO-DATE</strong></span>
<span class="strong"><strong>:classes UP-TO-DATE</strong></span>
<span class="strong"><strong>:jar UP-TO-DATE</strong></span>
<span class="strong"><strong>:publishPublishJarPublicationToArtifactoryRepository</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/artifactory/libs-release-local/book.gradle/sample/2.1.DEVELOPMENT/sample-2.1.DEVELOPMENT.jar</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/artifactory/libs-release-local/book.gradle/sample/2.1.DEVELOPMENT/sample-2.1.DEVELOPMENT.jar.sha1</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/artifactory/libs-release-local/book.gradle/sample/2.1.DEVELOPMENT/ivy-2.1.DEVELOPMENT.xml</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/artifactory/libs-release-local/book.gradle/sample/2.1.DEVELOPMENT/ivy-2.1.DEVELOPMENT.xml.sha1</strong></span>

<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 12.214 secs</strong></span>
</pre></div><p>When we open the Artifactory web application in a web browser, we can see that our project is now part <a id="id284" class="indexterm"/>of the repository, as <a id="id285" class="indexterm"/>shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00139.jpeg" alt="Publishing to Artifactory"/></div><p style="clear:both; height: 1em;"> </p></div><div class="section" title="Publishing to Nexus"><div class="titlepage"><div><div><h2 class="title"><a id="ch07lvl2sec47"/>Publishing to Nexus</h2></div></div></div><p>Another <a id="id286" class="indexterm"/>repository manager is Nexus. To <a id="id287" class="indexterm"/>publish to a Nexus repository manager is not much different from publishing to Artifactory or the local directory. We only have to change the <code class="literal">url</code> property to reference the repository and set the correct optional security credentials.</p><p>In the following example build file, we use a Nexus repository manager:</p><div class="informalexample"><pre class="programlisting">apply plugin: 'ivy-publish'
apply plugin: 'java'

version = '2.1.DEVELOPMENT'
group = 'book.gradle'

repositories {
  jcenter()
}

dependencies {
  compile 'org.springframework:spring-context:4.1.4.RELEASE'
}

publishing {

  publications {
    publishJar(IvyPublication) {
      module = 'sample'

      from components.java
    }
  }

  // Add a Nexus repository for
  // the publications.
  repositories {
    ivy {
      name = 'nexus'
      url = "http://localhost:8081/nexus/content/repositories/releases"
      credentials {
        username = 'admin'
        password = 'admin123'
      }
    }
  }
}</pre></div><p>This time, the <code class="literal">publishPublishJarPublicationToNexusRepository</code> task is created. The task is also <a id="id288" class="indexterm"/>added as a task dependency <a id="id289" class="indexterm"/>to the <code class="literal">publish</code> task. The following code shows this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gradle publishPublishJarPublicationToNexusRepository</strong></span>
<span class="strong"><strong>:generateDescriptorFileForPublishJarPublication</strong></span>
<span class="strong"><strong>:compileJava UP-TO-DATE</strong></span>
<span class="strong"><strong>:processResources UP-TO-DATE</strong></span>
<span class="strong"><strong>:classes UP-TO-DATE</strong></span>
<span class="strong"><strong>:jar UP-TO-DATE</strong></span>
<span class="strong"><strong>:publishPublishJarPublicationToNexusRepository</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/nexus/content/repositories/releases/book.gradle/sample/2.1.DEVELOPMENT/sample-2.1.DEVELOPMENT.jar</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/nexus/content/repositories/releases/book.gradle/sample/2.1.DEVELOPMENT/sample-2.1.DEVELOPMENT.jar.sha1</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/nexus/content/repositories/releases/book.gradle/sample/2.1.DEVELOPMENT/ivy-2.1.DEVELOPMENT.xml</strong></span>
<span class="strong"><strong>Upload http://localhost:8081/nexus/content/repositories/releases/book.gradle/sample/2.1.DEVELOPMENT/ivy-2.1.DEVELOPMENT.xml.sha1</strong></span>

<span class="strong"><strong>BUILD SUCCESSFUL</strong></span>

<span class="strong"><strong>Total time: 5.746 secs</strong></span>
</pre></div><p>When we take a look at the Nexus web application inside the repository, we can see that our project is <a id="id290" class="indexterm"/>added to the repository, as <a id="id291" class="indexterm"/>shown in the following screenshot:</p><div class="mediaobject"><img src="../Images/image00140.jpeg" alt="Publishing to Nexus"/></div><p style="clear:both; height: 1em;"> </p></div></div>
<div class="section" title="Summary" id="aid-1JFUC1"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Summary</h1></div></div></div><p>In this chapter, you learned how to use the new and incubating <code class="literal">ivy-publish</code> plugin. You saw how we can declare our publications with the <code class="literal">publications</code> configuration block. Gradle will automatically create new tasks based on what we have declared as publications.</p><p>You also learned how to customize the Ivy descriptor file that is generated by Gradle publishing tasks.</p><p>Finally, you saw how we can configure repositories to deploy our publications to. We used a local directory using the <code class="literal">file</code> protocol, and we used the Artifactory and Nexus repository managers.</p><p>In this book, we saw how we can define the dependencies we need in our project. You learned how to customize the dependency resolution and how to define the repositories that store the dependencies.</p><p>Then, you learned how we can deploy our project as dependencies for others. We saw how we can publish to a Maven repository, including Bintray, and an Ivy repository. You now have the knowledge to manage dependencies in your Java projects with Gradle.</p></div></body></html>