<html><head></head><body><div class="chapter" title="Chapter&#xA0;11.&#xA0;WildFly, OpenShift, and Cloud Computing"><div class="titlepage"><div><div><h1 class="title"><a id="ch11"/>Chapter 11. WildFly, OpenShift, and Cloud Computing</h1></div></div></div><p>Since the terminology used within the realm of cloud computing can be a source of confusion, the first section of this chapter will provide an overview of the basic concepts of cloud computing. We will then discuss the OpenShift project and the benefits it will bring to your organization.</p><div class="section" title="Introduction to cloud computing"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec63"/>Introduction to cloud computing</h1></div></div></div><p>What is cloud computing? We <a id="id1325" class="indexterm"/>hear this term everywhere, but what does it really mean? We have all used the cloud knowingly or unknowingly. If you use Gmail, Hotmail, or any other popular e-mail service, you have used the cloud. Simply put, cloud computing is a set of pooled computing resources and services delivered over the Web.</p><p>Client computing is not a new concept in the computer industry. Those of you who have been in the IT business for a decade or two will remember that the first type of client-server applications were the mainframe and terminal applications. At that time, storage and CPU was very expensive, and the mainframe pooled both types of resources and served them to thin-client terminals.</p><p>With the advent of the PC revolution, which brought mass storage and cheap CPUs to the average corporate desktop, the file server gained popularity as a way to enable document sharing and archiving. True to its name, the file server served storage resources to the clients in an enterprise, while the CPU cycles needed to do productive work were all produced and consumed within the confines of the PC client. </p><p>In the early 1990s, the budding Internet finally had enough computers attached to it that academic institutions began seriously thinking about how to connect those machines together to create massive, shared pools of storage and computational power that would be much larger than what any individual institution could ever afford to build. This is when the idea of <span class="emphasis"><em>the grid</em></span> began to take shape.</p><div class="section" title="Cloud computing versus grid computing"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec121"/>Cloud computing versus grid computing</h2></div></div></div><p>In general, the<a id="id1326" class="indexterm"/> terms "grid" and "cloud" seem to <a id="id1327" class="indexterm"/>be converging due to some similarities; however, there are a list of important differences between them that are often not understood, generating confusion and clutter within the marketplace. Grid computing requires the resources of many computers to solve a single problem, at the same time. Hence, it may or may not be in the cloud, depending on the type of use you make of it. One concern about the grid is that if one piece of the software on a node fails, other pieces of the software on other nodes may fail, too. This is alleviated if that component has a failover component on another node, but problems can still arise if the components rely on other pieces of software to accomplish one or more grid computing tasks. Have a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_11_01.jpg" alt="Cloud computing versus grid computing"/></div><p>Cloud computing evolves from grid computing and allows on-demand provisioning of resources. With cloud computing, companies can scale up to massive capacities in an instant, without having to invest in a new infrastructure, train new personnel, or license new software.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note83"/>Note</h3><p>
<span class="strong"><strong>Grid and cloud – similarities and differences</strong></span>
</p><p>The difference between the grid and the cloud lies in the way the tasks are computed. In a computational grid, one large job is divided into many small portions and executed on multiple machines. This characteristic is fundamental to a grid.</p><p>Cloud computing is intended to allow the user to avail of various services without investing in the underlying architecture. Cloud services include the delivery of software, infrastructure, and storage over the Internet either as separate components or as a complete platform.</p></div></div></div><div class="section" title="Advantages of cloud computing"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec122"/>Advantages of cloud computing</h2></div></div></div><p>We just <a id="id1328" class="indexterm"/>went through the basics of cloud computing, and now we will outline some of the benefits you may get if you move over to using the cloud services:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>On-demand service provisioning</strong></span>: Using <a id="id1329" class="indexterm"/>self-service provisioning, customers can have access to cloud services quickly and easily with no hassle. The customer simply requests a number of computing, storage, software, processes, or other resources from the service provider.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Elasticity</strong></span>: This<a id="id1330" class="indexterm"/> means that customers no longer need to predict traffic but can promote their sites aggressively and spontaneously. Engineering for peak traffic becomes a thing of the past.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Cost reduction</strong></span>: By<a id="id1331" class="indexterm"/> purchasing just the right amount of IT resources on demand, an organization can avoid purchasing unnecessary equipment. For SMEs, using the cloud may also reduce the need for in-house IT administrators.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Application programming interfaces (APIs)</strong></span>: APIs <a id="id1332" class="indexterm"/>make it possible for an organization's software to interact with cloud services. This means system administrators can interact with their cloud model. Cloud computing systems typically use REST-based APIs.</li></ul></div><p>Although cloud computing brings many advantages, there are some disadvantages<a id="id1333" class="indexterm"/> or potential risks that you must account for. The most compelling threat is that sensitive data processed outside the enterprise brings with it an inherent level of risk. This is because outsourced services bypass the physical, logical, and personnel controls a software house exerts over in-house programs. In addition, when you use the cloud, you probably won't know exactly where your data is hosted. In fact, you might not even know what country it will be stored in, leading to potential issues with local jurisdiction.</p><p>As <a id="id1334" class="indexterm"/>Gartner Group (<a class="ulink" href="http://www.gartner.com">http://www.gartner.com</a>) suggests, you should always ask providers to supply specific information on the hiring and oversight of privileged administrators. Besides this, the cloud provider should provide evidence that encryption schemes are designed and tested by experienced specialists. It is also important to understand whether the providers will make a contractual commitment to obey local privacy requirements on behalf of their customers.</p></div><div class="section" title="Cloud computing options"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec123"/>Cloud computing options</h2></div></div></div><p>Cloud computing<a id="id1335" class="indexterm"/> can be divided into the following three possible forms, depending on where the cloud is hosted, each option bringing a different level of security and management overhead:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Public</strong></span> <span class="strong"><strong>cloud</strong></span>: This <a id="id1336" class="indexterm"/>option is used when services <a id="id1337" class="indexterm"/>and infrastructure are provided off-site and often shared across multiple organizations. Public clouds are generally managed by an external service provider.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Private</strong></span> <span class="strong"><strong>cloud</strong></span>: This <a id="id1338" class="indexterm"/>option provides IT cloud resources<a id="id1339" class="indexterm"/> that are dedicated to a single organization and offered on demand. A private cloud infrastructure is maintained on a private network.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Hybrid</strong></span> <span class="strong"><strong>cloud</strong></span>: This <a id="id1340" class="indexterm"/>option is a mix of private and <a id="id1341" class="indexterm"/>public clouds managed as a single entity, allowing you to keep aspects of your business in the most efficient environment.</li></ul></div><p>The decision to adopt one among the different kinds of cloud computing options is a matter of discussion between experts, and it generally depends on several key factors. For example, as far as security is concerned, although public clouds offer a secure environment, private clouds offer an inherent level of security that meets even the highest of standards. In addition, you can add security services, such an <span class="strong"><strong>Intrusion Detection System</strong></span> (<span class="strong"><strong>IDS</strong></span>)<a id="id1342" class="indexterm"/> and dedicated firewalls. A private cloud might be the right choice for a large organization carrying a well-run data-center with a lot of spare capacity. It is more expensive to use a public cloud even if you have to add new software to transform that data center into a cloud.</p><p>On the other hand, as far as scalability is concerned, one negative aspect of private clouds is that their performance is limited to the number of machines in your cloud cluster. Should you max out your computing power, another physical server will need to be added. Besides this, public clouds typically deliver a <span class="emphasis"><em>pay-as-you-go</em></span> model, where you pay by the hour for the computing resources you use. This kind of utility pricing is economical if you're spinning up and tearing down development servers on a regular basis.</p><p>So, the majority of public cloud deployments are generally used for web servers or development systems where security and compliance requirements of larger organizations and their customers are not an issue. Private clouds are generally preferred by mid-size and large enterprises because they meet the stricter security and compliance requirements. The downside of private clouds is that the organizations implementing them need dedicated, high-performance <a id="id1343" class="indexterm"/>hardware. Have a look at the following diagram:</p><div class="mediaobject"><img src="graphics/6232OS_11_02.jpg" alt="Cloud computing options"/></div></div><div class="section" title="Types of cloud services"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec124"/>Types of cloud services</h2></div></div></div><p>Cloud computing services<a id="id1344" class="indexterm"/> can be broadly classified into the<a id="id1345" class="indexterm"/> following three types. These types are also known as cloud service models or SPI service models.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Infrastructure as a Service (IaaS)</strong></span>: This <a id="id1346" class="indexterm"/>service allows you to spin up computers on demand. For each server, you <a id="id1347" class="indexterm"/>will be able to select the amount of RAM, the number of processors, the amount of hard disk space, and the operating system. It allows you to do all this in a matter of minutes, making the acquisition of hardware easier, cheaper, and quicker. Well-known providers of this service include Amazon EC2, Google Compute Engine, Rackspace, and DigitalOcean.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note84"/>Note</h3><p>DigitalOcean is<a id="id1348" class="indexterm"/> relatively new to the market. You can spin up a server instance in less than 60 seconds! The major selling point of DigitalOcean is the simplicity of the interface, which means there will be no more crawling through pages and pages of documentation. In addition to this, it is very reasonably priced. If you are considering an IaaS provider, DigitalOcean should definitely be added to your list.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Platform</strong></span> <span class="strong"><strong>as</strong></span> <span class="strong"><strong>a</strong></span> <span class="strong"><strong>Service</strong></span> <span class="strong"><strong>(PaaS)</strong></span>: This <a id="id1349" class="indexterm"/>service <a id="id1350" class="indexterm"/>offers a development platform for developers. The end users write their own code, and the PaaS provider uploads that code and presents it on the Web.<p>By using PaaS, you don't need to invest money to get that project environment ready for your developers. The PaaS provider will deliver the platform on the Web, and in most cases, you can consume the platform using your browser. There is no need to download any software. This combination of simplicity and cost-efficiency empowers small and medium-sized companies, and even individual developers, to launch their own cloud SaaS.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note85"/>Note</h3><p>Examples of PaaS providers are Facebook and OpenShift. Facebook is a social application platform where third parties can write new applications that are made available to end users. OpenShift allows developers to deploy their WildFly web or enterprise applications to the cloud as simply as issuing a <code class="literal">git push</code> command.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Software</strong></span> <span class="strong"><strong>as</strong></span> <span class="strong"><strong>a</strong></span> <span class="strong"><strong>Service</strong></span> <span class="strong"><strong>(SaaS)</strong></span>: This <a id="id1351" class="indexterm"/>service <a id="id1352" class="indexterm"/>is based on the concept of renting software from a service provider instead of buying it. The software is usually accessed via the browser. Also known as <span class="emphasis"><em>software on demand</em></span>, it is currently the most popular type of cloud computing because of its high flexibility, great services, enhanced scalability, and low maintenance. Examples of SaaS are Zoho, Google Docs, and the SalesForce CRM application. Have a look at the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_11_03.jpg" alt="Types of cloud services"/></div></li></ul></div><p>You might wonder whether<a id="id1353" class="indexterm"/> it is possible for some providers to be defined both as a <span class="emphasis"><em>platform</em></span> and as <span class="emphasis"><em>software</em></span>. The answer is yes! For example, Facebook can be defined as both a platform (because services and applications can be can be delivered via the Facebook API) and as software (as it is used by millions of end users).</p><p>Red Hat originally developed the<a id="id1354" class="indexterm"/> OpenShift platform to deploy and manage Java EE applications on JBoss/WildFly servers running on the cloud.</p><p>OpenShift offers three <a id="id1355" class="indexterm"/>versions of the software, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Online</strong></span>: This <a id="id1356" class="indexterm"/>version is a free, cloud-based platform used to deploy new and existing Java EE, Ruby, PHP, Node.js, Perl, and Python applications on the cloud in a matter of minutes.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Origin</strong></span>: This <a id="id1357" class="indexterm"/>version is a free and open source version of the software. It only comes with community support. To run this, you need your own infrastructure. This version is beyond the scope of this book, so it will not be covered.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Enterprise</strong></span>: This <a id="id1358" class="indexterm"/>version can be downloaded and run anywhere you want, including Amazon, Rackspace, or your own infrastructure. It is packaged with Red Hat Enterprise Linux, is stable, and comes with full support from Red Hat.</li></ul></div></div></div></div>
<div class="section" title="Getting started with OpenShift Online"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec64"/>Getting started with OpenShift Online</h1></div></div></div><p>OpenShift <a id="id1359" class="indexterm"/>allows you to create, deploy, and manage applications within the cloud. It provides disk space, CPU resources, memory, and network connectivity. You can choose from a range of web cartridges, including Tomcat, WildFly, Jenkins, and many more. You can also plug in database cartridges, such as MySQL. Depending on the type of application you are building, you also have access to a template filesystem layout for that type (for example, PHP, WSGI, and Rack/Rails). OpenShift also generates a limited DNS for you.</p><p>To get started with OpenShift Online, the first thing you need to do is create an account. Go to OpenShift's <a id="id1360" class="indexterm"/>home page at <a class="ulink" href="https://www.openshift.com/">https://www.openshift.com/</a>, and select <span class="strong"><strong>SIGN UP</strong></span>. Complete the online registration and verify your e-mail address.</p><p>Before you can create an application, you need to create a<a id="id1361" class="indexterm"/> <span class="strong"><strong>domain</strong></span>. OpenShift uses non-strict domains (that is, there is no preceding period).</p><p>Log in to <a id="id1362" class="indexterm"/>your OpenShift account and navigate to the <span class="strong"><strong>Settings</strong></span> tab. Enter your domain name and click on <span class="strong"><strong>Save</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_11_04.jpg" alt="Getting started with OpenShift Online"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note86"/>Note</h3><p>Each account can only support a single domain. Should you wish to use more than one domain, you need to create a separate account with a different username.</p></div></div><div class="section" title="Installing OpenShift client tools"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec125"/>Installing OpenShift client tools</h2></div></div></div><p>Installing <a id="id1363" class="indexterm"/>OpenShift client tools is a simple process. The following guide shows you how to install the tools in Ubuntu 14.04. If you want to install them in a different flavor of Linux or in a different operating system, refer to the <a id="id1364" class="indexterm"/>Red Hat documentation at <a class="ulink" href="https://access.redhat.com/documentation/en-US/OpenShift_Online/2.0/html/Client_Tools_Installation_Guide/chap-OpenShift_Client_Tools.html">https://access.redhat.com/documentation/en-US/OpenShift_Online/2.0/html/Client_Tools_Installation_Guide/chap-OpenShift_Client_Tools.html</a>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, ensure that you have the latest package list by executing the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get update</strong></span>
</pre></div></li><li class="listitem">You will then need to install the required dependencies, <code class="literal">ruby</code>, <code class="literal">rubygems</code>, and <code class="literal">git</code>, by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ sudo apt-get install ruby-full rubygems-integration git-core</strong></span>
</pre></div></li><li class="listitem">We can now install the client tools by running the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ gem install rhc</strong></span>
</pre></div><p>After running this command, you should see something like the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Fetching: net-ssh-2.9.1.gem (100%)</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Fetching: rhc-1.28.5.gem (100%)</strong></span>
<span class="strong"><strong>==========================================================</strong></span>
<span class="strong"><strong>If this is your first time installing the RHC tools, please run 'rhc setup'</strong></span>
<span class="strong"><strong>==========================================================</strong></span>
<span class="strong"><strong>Successfully installed net-ssh-2.9.1</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Successfully installed rhc-1.28.5</strong></span>
<span class="strong"><strong>10 gems installed</strong></span>
<span class="strong"><strong>Installing ri documentation for net-ssh-2.9.1...</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>Installing RDoc documentation for rhc-1.28.5...</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note87"/>Note</h3><p>It is important that you run the setup wizard before using the client tools. Failing to do so might cause problems later on.</p></div></div></li><li class="listitem">To run the setup, type the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>rhc setup</strong></span>
</pre></div></li></ol></div><p>The setup<a id="id1365" class="indexterm"/> will require you to enter data for the following queries in the order they appear onscreen:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Enter the server hostname</strong></span>, just press <span class="emphasis"><em>Enter</em></span> to use the default value, which is the server used for OpenShift Online.</li><li class="listitem" style="list-style-type: disc">For <span class="strong"><strong>Enter username and password</strong></span>, enter your account username and password.</li><li class="listitem" style="list-style-type: disc">If there are no SSH keys on your system, one will be generated. You will be asked if you want to upload the key to the server. Type <code class="literal">yes</code>.</li><li class="listitem" style="list-style-type: disc">If you did not create a domain earlier, you will be prompted to add a domain now.</li></ul></div></div><div class="section" title="Accessing your OpenShift account from a different computer"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec126"/>Accessing your OpenShift account from a different computer</h2></div></div></div><p>Communication<a id="id1366" class="indexterm"/> between your computer and OpenShift happens over SSH using secure keys. In order to use your domain from a different machine, simply download and install the OpenShift client tools to your other computer. When you run the tools setup, the key for your computer will be added to your keys on the server.</p><p>To revoke access, you will need to delete the key for that computer. You can do this by logging in to OpenShift, navigating to <span class="strong"><strong>Settings</strong></span>, and scrolling down until you reach <span class="strong"><strong>Public Keys</strong></span>. Now, delete the key that relates to the computer you want to revoke access from.</p></div></div>
<div class="section" title="Creating our first OpenShift application"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec65"/>Creating our first OpenShift application</h1></div></div></div><p>Before <a id="id1367" class="indexterm"/>we develop an application to run on OpenShift, we should first define some OpenShift terms:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Application</strong></span>: This<a id="id1368" class="indexterm"/> is obviously the application you will deploy to OpenShift.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Gear</strong></span>: This is <a id="id1369" class="indexterm"/>the container that contains your server, along with the various resources required to run your application, such as RAM, the processor, and hard disk space.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Cartridge</strong></span>: A <a id="id1370" class="indexterm"/>cartridge is a plugin that provides a specific functionality. For example, you can select a WildFly cartridge and a database cartridge to be added to your gear.</li></ul></div><div class="section" title="Installing your first cartridge"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec127"/>Installing your first cartridge</h2></div></div></div><p>To view all <a id="id1371" class="indexterm"/>available cartridges, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc cartridge list</strong></span>
</pre></div><p>The syntax to create an application is as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc app create app_name cartridge_name</strong></span>
</pre></div><p>At the time of writing, there is no WildFly cartridge available in the cartridge list. For this example, I am going to use a cartridge that is available on GitHub (<a class="ulink" href="https://github.com/openshift-cartridges/openshift-wildfly-cartridge">https://github.com/openshift-cartridges/openshift-wildfly-cartridge</a>). Navigate to the folder<a id="id1372" class="indexterm"/> where you want your code to be located. If you are using Eclipse, you may want to <code class="literal">cd</code> into your workspace folder. Using the preceding syntax, but replacing the cartridge name with the cartridge URL, we will create the application, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc app create wildfly https://cartreflect-claytondev.rhcloud.com/reflect?github=openshift-cartridges/openshift-wildfly-cartridge#WildFly8</strong></span>
</pre></div><p>After running this command, a significant amount of information will be printed to the console. We will deal with this output one piece at a time. The first piece of information is the detail related to the cartridge and gear. We can see the URL from where the cartridge was cloned from, the gear size, and the domain:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Application Options</strong></span>
<span class="strong"><strong>-------------------</strong></span>
<span class="strong"><strong>Domain:     chrisritchie</strong></span>
<span class="strong"><strong>Cartridges: https://cartreflect-claytondev.rhcloud.com/reflect?github=openshift-cartridges/openshift-wildfly-cartridge#WildFly8</strong></span>
<span class="strong"><strong>Gear Size:  default</strong></span>
<span class="strong"><strong>Scaling:    no</strong></span>
</pre></div><p>The next part shows that the application is being created, and that an artifact is being deployed on the gear:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Creating application 'wildfly' ... Artifacts deployed: ./ROOT.war</strong></span>
<span class="strong"><strong>done</strong></span>
</pre></div><p>Printed out next are the details for the management console, which are as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  WildFly 8 administrator added.  Please make note of these credentials:</strong></span>
<span class="strong"><strong>   Username: admin6vIBvE6</strong></span>
<span class="strong"><strong>   Password: B_vh3CA5v4Dc</strong></span>
<span class="strong"><strong>   run 'rhc port-forward wildfly to access the web admin area on port 9990.</strong></span>
<span class="strong"><strong>Waiting for your DNS name to be available ... done</strong></span>
</pre></div><p>The following <a id="id1373" class="indexterm"/>part shows the remote Git repository being cloned to your local hard drive. The SSH key for the gear will be added to your <code class="literal">known_hosts</code> file once you allow it:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Cloning into 'wildfly'...</strong></span>
<span class="strong"><strong>The authenticity of host 'wildfly-chrisritchie.rhcloud.com (50.16.172.242)' can't be established.</strong></span>
<span class="strong"><strong>RSA key fingerprint is cf:ee:77:cb:0e:fc:02:d7:72:7e:ae:80:c0:90:88:a7.</strong></span>
<span class="strong"><strong>Are you sure you want to continue connecting (yes/no)? yes</strong></span>
<span class="strong"><strong>Warning: Permanently added 'wildfly-chrisritchie.rhcloud.com,50.16.172.242' (RSA) to the list of known hosts.</strong></span>
<span class="strong"><strong>Your application 'wildfly' is now available.</strong></span>
</pre></div><p>Lastly, your application URL, remote GIT repository, and SSH location are all printed out, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  URL:        http://wildfly-chrisritchie.rhcloud.com/</strong></span>
<span class="strong"><strong>  SSH to:     53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com</strong></span>
<span class="strong"><strong>  Git remote: ssh://53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com/~/git/wildfly.git/</strong></span>

<span class="strong"><strong>Run 'rhc show-app wildfly' for more details about your app.</strong></span>
</pre></div><p>Now, you can verify that your server is up and running, and that you can access the deployed application by pointing your browser to the URL specified in the preceding output (<a class="ulink" href="http://wildfly-chrisritchie.rhcloud.com/">http://wildfly-chrisritchie.rhcloud.com/</a>). Have a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_11_05.jpg" alt="Installing your first cartridge"/></div><p>Now, let's turn<a id="id1374" class="indexterm"/> our attention to the local repository on your computer.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip42"/>Tip</h3><p>You can import the repository into Eclipse by selecting <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Import</strong></span> | <span class="strong"><strong>Projects</strong></span> from <span class="strong"><strong>GIT</strong></span> | <span class="strong"><strong>Existing local repository</strong></span> | <span class="strong"><strong>Add</strong></span>. Then, browse to the location of your <code class="literal">git</code> repository and import it as a new Maven project so that Eclipse can automatically generate the project configuration files for you.</p></div></div><p>If you look at the structure of the <code class="literal">git</code> repository, as shown in the following screenshot, you will see that the <code class="literal">src</code> folder follows a typical Maven project structure for a web application:</p><div class="mediaobject"><img src="graphics/6232OS_11_06.jpg" alt="Installing your first cartridge"/></div><p>If you inspect the root folder via the command line, you will also notice the hidden folders. There are<a id="id1375" class="indexterm"/> two important hidden folders. The <code class="literal">.git</code> folder contains all your versioning information and Git configuration. The <code class="literal">.openshift</code> folder contains various configurations for OpenShift. Have a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_11_07.jpg" alt="Installing your first cartridge"/></div><p>The <code class="literal">deployments</code> folder performs the same task as the <code class="literal">JBOSS_HOME/standalone/deployments</code> directory. Applications placed here will be automatically deployed when the repository is pushed to the remote Git repository.</p></div><div class="section" title="Understanding the workflow"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec128"/>Understanding the workflow</h2></div></div></div><p>Just before we<a id="id1376" class="indexterm"/> start to code the actual application, we need to understand the workflow and how the code is deployed to the server. Here are the basic steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Modify the source code in the local Git repository.</li><li class="listitem">Add any deployments, such as JDBC connectors, to the <code class="literal">deployments</code> folder. This step is optional.</li><li class="listitem">Stage all files to the local repository, ready for committing.</li><li class="listitem">Commit the files to the local repository.</li><li class="listitem">Push the changes to the remote repository. This will trigger deployment on your gear. You don't need to add your application WAR to the <code class="literal">deployments</code> folder.</li></ol></div></div><div class="section" title="Building the application"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec129"/>Building the application</h2></div></div></div><p>So, now we need to<a id="id1377" class="indexterm"/> create our own application. For the first example, we will deploy a simple service that downloads the text within a text area as a PDF file. This application consists of a servlet that translates the request into a PDF response <a id="id1378" class="indexterm"/>using the <span class="strong"><strong>iText</strong></span> library (available at <a class="ulink" href="http://itextpdf.com/download.php">http://itextpdf.com/download.php</a>). Here is the servlet:</p><div class="informalexample"><pre class="programlisting">package com.packtpub.chapter11;

import java.io.IOException;

import javax.servlet.*;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.*;

import com.itextpdf.text.*;
import com.itextpdf.text.pdf.PdfWriter;

@WebServlet("/convert")
public class TextToPdf extends HttpServlet {

    public void init(ServletConfig config) throws ServletException{
        super.init(config);
    }

    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException{
        doPost(request, response);
    }

    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String text = request.getParameter("text");
        response.setContentType("application/pdf");
        Document document = new Document();
        try{
            PdfWriter.getInstance(document, response.getOutputStream());
            document.open();
            document.add(new Paragraph(text));
            document.close(); 
        }catch(DocumentException e){
            e.printStackTrace();
        }
    }
}

public void init(ServletConfig config) throws ServletException{
    super.init(config);
}

public void doGet(HttpServletRequest request, 
    HttpServletResponse response) throws ServletException, IOException{
    doPost(request, response);
}

public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException{
    String text = request.getParameter("text");
    response.setContentType("application/pdf");  
    Document document = new Document();
    try{
        PdfWriter.getInstance(document, response.getOutputStream());  
    document.open();

    document.add(new Paragraph(text));

    document.close();
    }catch(DocumentException e){
        e.printStackTrace();
    }
}</pre></div><p>We also need to add the <code class="literal">itextpdf</code> library to the project's <code class="literal">pom.xml</code> file so that the code can compile. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;
    &lt;artifactId&gt;itextpdf&lt;/artifactId&gt;
    &lt;version&gt;5.5.2&lt;/version&gt;
&lt;/dependency&gt;</pre></div><p>In addition, we <a id="id1379" class="indexterm"/>need an HTML/JSP page that contains a text area. This code is inside the <code class="literal">createpdf.html</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;form action="TextToPdf" method="post"&gt;
    &lt;textarea cols="80" rows="5" name="text"&gt;
        This text will be converted to PDF.
    &lt;/textarea&gt;
    &lt;input type="submit" value="Convert to PDF"&gt;
&lt;/form&gt;</pre></div><p>We have now finished the application. We need to add and commit our application to our local Git repository using the following <code class="literal">git add</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git add *</strong></span>
</pre></div><p>Then, enter the following <code class="literal">git</code> <code class="literal">commit</code> command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git commit -m "Initial commit of wildfly app"</strong></span>
</pre></div><p>Lastly, you need to push your local changes to the remote repository sitting on your gear, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git push</strong></span>
</pre></div><p>This will push up your code and trigger various Git hooks that cause your code to be compiled, packaged, and deployed, as you can see from the following output. The build output has been omitted for brevity.</p><div class="informalexample"><pre class="programlisting">Counting objects: 19, done.
Compressing objects: 100% (8/8), done.
Writing objects: 100% (12/12), 1.58 KiB | 0 bytes/s, done.
Total 12 (delta 3), reused 0 (delta 0)
remote: Stopping wildfly cart
remote: Sending SIGTERM to wildfly:72039 ...
remote: Building git ref 'master', commit 7d63607
...
remote: [INFO] Scanning for projects...
remote: [INFO]                                                                         
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO] Building wildfly 1.0
remote: [INFO] ------------------------------------------------------------------------
...
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO] BUILD SUCCESS
remote: [INFO] ------------------------------------------------------------------------
...
remote: Preparing build for deployment
remote: Deployment id is aed5acfd
remote: Activating deployment
remote: Deploying WildFly
remote: Starting wildfly cart
...
remote: CLIENT_MESSAGE: Artifacts deployed: ./ROOT.war
remote: -------------------------
remote: Git Post-Receive Result: success
remote: Activation status: success
remote: Deployment completed with status: success
To ssh://53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com/~/git/wildfly.git/
   76af36f..7d63607  master -&gt; master</pre></div><p>We can <a id="id1380" class="indexterm"/>now finally access our application using <a class="ulink" href="http://wildfly-chrisritchie.rhcloud.com/createpdf.html">http://wildfly-chrisritchie.rhcloud.com/createpdf.html</a>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_11_08.jpg" alt="Building the application"/></div><p>After<a id="id1381" class="indexterm"/> entering some text and clicking on the <span class="strong"><strong>Convert to PDF</strong></span> button, a PDF file is downloaded containing the text, as follows:</p><div class="mediaobject"><img src="graphics/6232OS_11_09.jpg" alt="Building the application"/></div><p>Launching our application generates a PDF file as the result—your first cloud application! Now that we have deployed a simple application to your OpenShift gear, in the next section, we will show you how to manage your OpenShift applications and introduce some advanced features.</p></div></div>
<div class="section" title="Viewing the OpenShift server logfiles"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec66"/>Viewing the OpenShift server logfiles</h1></div></div></div><p>At <a id="id1382" class="indexterm"/>some point, you will need to see what is happening on the server side. Maybe your application is failing to deploy, or you need to see the logs after you encounter an error. There are a few ways you can view the OpenShift server logs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Tail the logfile using client tools</li><li class="listitem" style="list-style-type: disc">Run SSH into the gear</li></ul></div><div class="section" title="Tailing the logfile"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec130"/>Tailing the logfile</h2></div></div></div><p>Tailing<a id="id1383" class="indexterm"/> the application server log is simple. You just need to run the <code class="literal">rhc tail</code> command. For example, to view the log for the example application that we called <code class="literal">wildfly</code>, you need to execute the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc tail -a wildfly</strong></span>
</pre></div><p>This will print out the latest entries from the logfile, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>2014-08-11 22:11:39,270 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) JBAS017534: Registered web context: /</strong></span>
<span class="strong"><strong>2014-08-11 22:11:41,411 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 54) JBAS018559: Deployed "ROOT.war" (runtime-name : "ROOT.war")</strong></span>
<span class="strong"><strong>2014-08-11 22:12:26,849 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://127.6.97.1:9990/management</strong></span>
<span class="strong"><strong>2014-08-11 22:12:26,862 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://127.6.97.1:9990</strong></span>
<span class="strong"><strong>2014-08-11 22:12:26,864 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.1.0.Final "Kenny" started in 219903ms - Started 299 of 429 services (177 services are lazy, passive or on-demand)</strong></span>
</pre></div><p>To exit the log, simply press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span>.</p></div><div class="section" title="Viewing logs via SSH"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec131"/>Viewing logs via SSH</h2></div></div></div><p>Using<a id="id1384" class="indexterm"/> the <code class="literal">rhc tail</code> command is only useful<a id="id1385" class="indexterm"/> part of the time. Most likely, you will want to view the entire log or search the log. For this, you need to SSH into the gear. We use the <code class="literal">-a</code> switch to specify the application name, as follows.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc ssh -a wildfly</strong></span>
</pre></div><p>By typing <code class="literal">ls app_name</code>, you can see that the directory structure is similar to that of a WildFly install. You can now view your file using the <code class="literal">less</code> command, which means you have full control <a id="id1386" class="indexterm"/>over navigation and search within the file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ less wildfly/standalone/logs/server.log</strong></span>
<span class="strong"><strong>...</strong></span>

<span class="strong"><strong>==&gt; example/logs/server.log &lt;==</strong></span>
<span class="strong"><strong>14:41:18,706 INFO  [org.jboss.as.connector.subsystems.datasources] (Controller Boot Thread) Deploying JDBC-compliant driver class org.h2.Driver (version 1.2)</strong></span>
<span class="strong"><strong>14:41:18,712 INFO  [org.jboss.as.connector.subsystems.datasources] (Controller Boot Thread) Deploying non-JDBC-compliant driver class com.mysql.jdbc.Driver (version 5.1)</strong></span>
<span class="strong"><strong>14:41:18,732 INFO  [org.jboss.as.clustering.infinispan.subsystem] (Controller Boot Thread) Activating Infinispan subsystem.</strong></span>
<span class="strong"><strong>14:41:18,860 INFO  [org.jboss.as.naming] (Controller Boot Thread) Activating Naming Subsystem</strong></span>
<span class="strong"><strong>14:41:18,877 INFO  [org.jboss.as.naming] (MSC service thread 1-1) Starting Naming Service </strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip43"/>Tip</h3><p>Using the <code class="literal">less</code> command gives you much more control than using <code class="literal">tail</code>. Pressing <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>F</em></span> starts the tailing of the file, and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span> stops the tailing of the file. A backslash allows you to search backwards, and a question mark allows you to search forward in the file. It becomes easy to find occurrences of exceptions and errors.</p></div></div></div></div>
<div class="section" title="Managing applications in OpenShift"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec67"/>Managing applications in OpenShift</h1></div></div></div><p>At first, it might<a id="id1387" class="indexterm"/> appear difficult to manage your application on a remote server. Once you have learned the commands to manage your application, this concern should be greatly reduced.</p><p>In order to control your applications, you can use the <code class="literal">rhc app</code> command, which takes the action to be performed and the <code class="literal">-a</code> command that specifies the application name. For example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$rhc app restart -a app_name</strong></span>
</pre></div><p>The following table shows the list of commands available to manage your applications. You can view the list of available options via the command line, using the <code class="literal">--help</code> flag:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Option</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">start</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Starts<a id="id1388" class="indexterm"/> an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">stop</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Stops an <a id="id1389" class="indexterm"/>application that is currently running</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">force-stop</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Kills <a id="id1390" class="indexterm"/>the application's processes</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">restart</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Restarts<a id="id1391" class="indexterm"/> an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">reload</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Reloads <a id="id1392" class="indexterm"/>an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">delete</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Deletes<a id="id1393" class="indexterm"/> an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">configure</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Configures<a id="id1394" class="indexterm"/> properties for an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">create</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Creates<a id="id1395" class="indexterm"/> an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">deploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Deploys <a id="id1396" class="indexterm"/>an application</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">scale-up</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Scales up<a id="id1397" class="indexterm"/> the application cartridge</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">scale-down</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Scales<a id="id1398" class="indexterm"/> down the application cartridge</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">show</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Shows <a id="id1399" class="indexterm"/>an application's information</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">tidy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Deletes <a id="id1400" class="indexterm"/>an application's logfiles and temporary files</p>
</td></tr></tbody></table></div><p>If you want to delete <a id="id1401" class="indexterm"/>the application we created earlier, you will use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc app delete -a wildfly</strong></span>

<span class="strong"><strong>This is a non-reversible action! Your application code and data will be permanently deleted if you continue!</strong></span>

<span class="strong"><strong>Are you sure you want to delete the application 'atestapp'? (yes|no): yes</strong></span>

<span class="strong"><strong>Deleting application 'wildfly' ... deleted</strong></span>
</pre></div></div>
<div class="section" title="Configuring your applications"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec68"/>Configuring your applications</h1></div></div></div><p>When you <a id="id1402" class="indexterm"/>create an application, you will have a local copy of the repository, which contains your application code and the WildFly server's <code class="literal">deployments</code> folder. Besides this, there are a couple of hidden folders in your Git repository. The<a id="id1403" class="indexterm"/> first one is the <code class="literal">.git </code>folder, which contains all your Git-related configuration. The second folder is <code class="literal">.openshift</code>. The following is the content of the <code class="literal">.openshift</code> folder:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>chris-macbook:.openshift chris$ ls -lah</strong></span>
<span class="strong"><strong>drwxr-xr-x   3 chris  staff   102B Aug 11 21:20 action_hooks</strong></span>
<span class="strong"><strong>drwxr-xr-x   4 chris  staff   136B Aug 11 21:20 config</strong></span>
<span class="strong"><strong>drwxr-xr-x   8 chris  staff   272B Aug 11 21:20 cron</strong></span>
<span class="strong"><strong>drwxr-xr-x   3 chris  staff   102B Aug 11 21:20 markers</strong></span>
</pre></div><p>The <code class="literal">action_hooks</code> folder is where developers can put action hook scripts that will be executed during the OpenShift build life cycle.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note88"/>Note</h3><p>You can create a build script to perform application initialization, such as creating tables or setting variables. For full details on<a id="id1404" class="indexterm"/> supported action hooks, see the documentation at <a class="ulink" href="http://openshift.github.io/documentation/oo_user_guide.html#build-action-hooks">http://openshift.github.io/documentation/oo_user_guide.html#build-action-hooks</a>.</p></div></div><p>The <code class="literal">cron</code> folder allows the developer to add cron jobs on the gear. The scripts added will be scheduled according to whether they are put in the <code class="literal">minutely</code>, <code class="literal">hourly</code>, <code class="literal">daily</code>, <code class="literal">weekly</code>, or <code class="literal">monthly</code> folders.</p><p>The <code class="literal">markers</code> folder can be used to set various settings. For example, the <code class="literal">skip_maven_build</code> marker file will instruct the Maven compiler to skip the build process. Lastly and importantly, the <code class="literal">config</code> folder has the following structure:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>chris-macbook:.openshift chris$ ls -lah config/</strong></span>
<span class="strong"><strong>drwxr-xr-x  3 chris  staff   102B Aug 11 21:20 modules</strong></span>
<span class="strong"><strong>-rw-r--r--  1 chris  staff    29K Aug 11 21:20 standalone.xml</strong></span>
</pre></div><p>As you expected, the <code class="literal">standalone.xml</code> file is the WildFly configuration file for your applications. The <code class="literal">modules</code> folder is where you can add your own modules, as you would in a native install of WildFly.</p><p>We have only touched upon the basics of what OpenShift can do. For a more in-depth look, see the OpenShift user guide at <a class="ulink" href="http://openshift.github.io/documentation/oo_user_guide.html">http://openshift.github.io/documentation/oo_user_guide.html</a>.</p><div class="section" title="Adding a database cartridge"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec132"/>Adding a database cartridge</h2></div></div></div><p>Every enterprise<a id="id1405" class="indexterm"/> application needs some kind of storage for its data. OpenShift allows you to add database cartridges after creating your application. To view the list of possible cartridges, you can issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc cartridge list</strong></span>
</pre></div><p>Within the list that outputs, you will see various database vendor cartridge options. In this example, we are going to add the MySQL database cartridge to our application. To do this, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc cartridge add mysql-5.5</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note89"/>Note</h3><p>If you configure your application to be scalable, the database cartridge will be installed into a new gear. If your application is not configured to be scalable, it will be added to the same gear as your application. This is to ensure that your database is not affected when you scale up or scale down your gears.</p></div></div><p>The output will print the information we need related to our new database, such as the root password, connection URL, and so on:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>chris-macbook:wildfly chris$ rhc cartridge add mysql-5.5</strong></span>

<span class="strong"><strong>Adding mysql-5.5 to application 'wildfly' ... done</strong></span>

<span class="strong"><strong>mysql-5.5 (MySQL 5.5)</strong></span>
<span class="strong"><strong>---------------------</strong></span>
<span class="strong"><strong>  Gears:          Located with wildfly-wildfly-8</strong></span>
<span class="strong"><strong>  Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>
<span class="strong"><strong>  Database Name:  wildfly</strong></span>
<span class="strong"><strong>  Password:       y-rftt5LUl6j</strong></span>
<span class="strong"><strong>  Username:       adminWfn4mG6</strong></span>

<span class="strong"><strong>MySQL 5.5 database added.  Please make note of these credentials:</strong></span>

<span class="strong"><strong>   Root User: adminWfn4mG6</strong></span>
<span class="strong"><strong>   Root Password: y-rftt5LUl6j</strong></span>
<span class="strong"><strong>   Database Name: wildfly</strong></span>

<span class="strong"><strong>Connection URL: mysql://$OPENSHIFT_MYSQL_DB_HOST:$OPENSHIFT_MYSQL_DB_PORT/</strong></span>

<span class="strong"><strong>You can manage your new MySQL database by also embedding phpmyadmin.</strong></span>
<span class="strong"><strong>The phpmyadmin username and password will be the same as the MySQL credentials above.</strong></span>

<span class="strong"><strong>RESULT:</strong></span>

<span class="strong"><strong>Mysql 5.1 database added.  Please make note of these credentials:</strong></span>
<span class="strong"><strong>  Root User: admin</strong></span>
<span class="strong"><strong>  Root Password: SH-v4VuAZ_Se</strong></span>
<span class="strong"><strong>  Database Name: example</strong></span>
</pre></div><p>The beauty of<a id="id1406" class="indexterm"/> this is that you do not need to further configure your <code class="literal">standalone.xml</code> file, as all the environment variables are set for you when you add the MySQL cartridge. You can access the datasource immediately using the JNDI namespace of  <code class="literal">java:jboss/datasources/MysqlDS</code>. Take a look at the datasource configuration in the <code class="literal">standalone.xml</code> file. You will see all properties are external environment variables, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;datasource jndi-name="java:jboss/datasources/MySQLDS" enabled="${mysql.enabled}" use-java-context="true" pool-name="MySQLDS" use-ccm="true"&gt;
    &lt;connection-url&gt;jdbc:mysql://${env.OPENSHIFT_MYSQL_DB_HOST}:${env.OPENSHIFT_MYSQL_DB_PORT}/${env.OPENSHIFT_APP_NAME}&lt;/connection-url&gt;
    &lt;driver&gt;mysql&lt;/driver&gt;
    &lt;security&gt;
        &lt;user-name&gt;${env.OPENSHIFT_MYSQL_DB_USERNAME}&lt;/user-name&gt;
        &lt;password&gt;${env.OPENSHIFT_MYSQL_DB_PASSWORD}&lt;/password&gt;
    &lt;/security&gt;
    &lt;validation&gt;
        &lt;check-valid-connection-sql&gt;SELECT 1&lt;/check-valid-connection-sql&gt;
        &lt;background-validation&gt;true&lt;/background-validation&gt;
        &lt;background-validation-millis&gt;60000&lt;/background-validation-millis&gt;
        &lt;!--&lt;validate-on-match&gt;true&lt;/validate-on-match&gt;--&gt;
    &lt;/validation&gt;
    &lt;pool&gt;
        &lt;flush-strategy&gt;IdleConnections&lt;/flush-strategy&gt;
    &lt;/pool&gt;
&lt;/datasource&gt;</pre></div><p>To remove the database cartridge, and thus disable it, you can simply run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc cartridge remove mysql-5.5</strong></span>
</pre></div></div><div class="section" title="Using OpenShift Tools and Eclipse"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec133"/>Using OpenShift Tools and Eclipse</h2></div></div></div><p>Alongside<a id="id1407" class="indexterm"/> the client tools, there <a id="id1408" class="indexterm"/>is also a plugin for Eclipse that allows you to integrate with OpenShift. If you prefer graphical interfaces over the command line, you should consider this plugin.</p><p>Installing<a id="id1409" class="indexterm"/> OpenShift Tools requires the same steps as when we installed the WildFly plugin in <a class="link" href="ch02.html" title="Chapter 2. Configuring the Core WildFly Subsystems">Chapter 2</a>, <span class="emphasis"><em>Configuring the Core WildFly Subsystems</em></span>. Perform the following steps to install OpenShift Tools:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In Eclipse, go to the marketplace by clicking on <span class="strong"><strong>Help</strong></span> | <span class="strong"><strong>Eclipse Marketplace</strong></span>.</li><li class="listitem">Search for the version of JBoss Tools that matches your Eclipse version.</li><li class="listitem">Click on <span class="strong"><strong>Install</strong></span>. You will be presented with the full list of features available.</li><li class="listitem">You can now select <span class="strong"><strong>JBoss OpenShift Tools</strong></span> along with any other features you want, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_11_10.jpg" alt="Using OpenShift Tools and Eclipse"/></div></li><li class="listitem">Click on <span class="strong"><strong>Confirm</strong></span>, accept the license terms, and click on <span class="strong"><strong>Finish</strong></span>.</li></ol></div><p>When Eclipse restarts, you will be able to create new applications or import existing applications. Creating a new application is straightforward. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New</strong></span> | <span class="strong"><strong>OpenShift Application</strong></span>. Have a look at the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_11_11.jpg" alt="Using OpenShift Tools and Eclipse"/></div></li><li class="listitem">You will be presented with a pop up allowing you to enter your OpenShift account's username and password. Enter your details and click on <span class="strong"><strong>OK</strong></span>.</li><li class="listitem">The next <a id="id1410" class="indexterm"/>screen will allow you to either download an existing application from the OpenShift cloud <a id="id1411" class="indexterm"/>or create a new one. We will create a new one here and leave you to investigate the option of downloading an existing application if that is what you require. Look for WildFly 8 in the list of possible quickstart cartridges. Have a look at the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_11_12.jpg" alt="Using OpenShift Tools and Eclipse"/></div></li><li class="listitem">Click on Next, enter the name of your application, and select your gear profile. Have a look at the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_11_13.jpg" alt="Using OpenShift Tools and Eclipse"/></div></li><li class="listitem">Click on <span class="strong"><strong>Next</strong></span>, and <span class="strong"><strong>Next</strong></span> again. Your <a id="id1412" class="indexterm"/>new application is now complete and the gear <a id="id1413" class="indexterm"/>is configured.</li></ol></div><p>This tutorial is meant to be a brief introduction to the OpenShift Tools plugin. If you are interested in<a id="id1414" class="indexterm"/> using OpenShift Tools, please refer to the online documentation at <a class="ulink" href="http://docs.jboss.org/tools/4.1.0.Final/en/User_Guide/html_single/index.html#chap-OpenShift_Tools">http://docs.jboss.org/tools/4.1.0.Final/en/User_Guide/html_single/index.html#chap-OpenShift_Tools</a>.</p></div><div class="section" title="Scaling your application"><div class="titlepage"><div><div><h2 class="title"><a id="ch11lvl2sec134"/>Scaling your application</h2></div></div></div><p>Until now, we <a id="id1415" class="indexterm"/>have mentioned some of the most essential features of the OpenShift platform. Although all the available options cannot be covered within a single chapter, there is one more feature that needs to be covered, which is application scaling.</p><p>For an application to be scalable, you must pass the <code class="literal">-s</code> switch as you create the application with the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ rhc app create app_name type -s</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note90"/>Note</h3><p>It is not possible to make a non-scalable application scalable. To do this, you need to take a snapshot of the application, spin up a new scalable application, and then push your code to it.</p></div></div><p>Once you have created a scalable application, it will automatically add nodes to the cluster when the number of concurrent requests exceed 90 percent of the maximum concurrent requests over one period. It will automatically scale down when the number of concurrent requests fall below 49.9 percent of the maximum concurrent requests over three consecutive periods.</p><p>You can also scale your application manually via the command line. To manually scale up your application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ 53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com "haproxy_ctld -u"</strong></span>
</pre></div><p>To manually scale down your application, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ 53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com "haproxy_ctld -d"</strong></span>
</pre></div><p>Lastly, you<a id="id1416" class="indexterm"/> may want to disable or enable automatic scaling. This can also be achieved via the command line. To stop automatic scaling, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ 53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com "haproxy_ctld_daemon stop"</strong></span>
</pre></div><p>To start automatic scaling, run the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ 53e905324382ecc7c30001d0@wildfly-chrisritchie.rhcloud.com "haproxy_ctld_daemon start"</strong></span>
</pre></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec69"/>Summary</h1></div></div></div><p>In this chapter, we looked at an alternative to the traditional approach of hosting applications on a company's own infrastructure. The OpenShift platform offers free and paid versions of a PaaS that enables developers to deploy to the cloud without having to worry about downloading and managing the stack, writing scripts, or installing agents.</p><p>The OpenShift platform bears some similarities to other cloud solutions, such as MS Azure. Just like Azure, OpenShift is a service managed and run by the vendor. OpenShift provides the ability to quickly choose from multiple cartridges, each of which plugs in a resource required to run your application. With a single Git command, your source code is pushed to the gear, and your application is built and then deployed to the server.</p><p>There are several ways to manage your OpenShift gears. First, you can manage them via the command line. This is the best option as you have full control over your gears. Secondly, there is the web interface, which has limited functionality but is fine to quickly create a new application. Lastly, there is OpenShift Tools, which is part of JBoss Tools, a suite of plugins for Eclipse.</p><p>There are three options available when using OpenShift. OpenShift Online is a product that offers free and subscription-based services. All the gears are hosted on the public cloud. OpenShift Enterprise allows you to download a stable and supported version of OpenShift to be run on your own hardware. Finally, if you want the latest features (with only community support) or want to contribute to the development of OpenShift, there is OpenShift Origin.</p></div></body></html>