<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Using Forms"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Using Forms</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Displaying and processing a form</li><li class="listitem" style="list-style-type: disc">Getting a submitted form value using a controller method argument</li><li class="listitem" style="list-style-type: disc">Setting a form's default values using a model object</li><li class="listitem" style="list-style-type: disc">Saving form data in an object automatically</li><li class="listitem" style="list-style-type: disc">Using text, textarea, password, and hidden fields</li><li class="listitem" style="list-style-type: disc">Using a select field</li><li class="listitem" style="list-style-type: disc">Using a checkbox</li><li class="listitem" style="list-style-type: disc">Using a list of checkboxes</li><li class="listitem" style="list-style-type: disc">Using a list of radio buttons</li><li class="listitem" style="list-style-type: disc">Validating a form using annotations</li><li class="listitem" style="list-style-type: disc">Uploading a file</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec46"/>Introduction</h1></div></div></div><p>Displaying and processing a form is tedious. Spring helps with the initialization of the form, the generation of form widgets (text fields, checkboxes, and so on), and data retrieval when the form is submitted. Form validation is made simple with annotations in the model classes.</p></div></div>
<div class="section" title="Displaying and processing a form"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec47"/>Displaying and processing a form</h1></div></div></div><p>To display a <a id="id214" class="indexterm"/>form and retrieve the data the user entered when it's submitted, use a first <a id="id215" class="indexterm"/>controller method to display the form. Use a second controller method to process the form data when the form is submitted.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec95"/>How to do it…</h2></div></div></div><p>Here are the steps to display and process a form:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a controller method to display the form:<div class="informalexample"><pre class="programlisting">@RequestMapping("/addUser")
public String addUser() {
  return "addUser";
}</pre></div></li><li class="listitem">Create a JSP with an HTML form:<div class="informalexample"><pre class="programlisting">&lt;form method="POST"&gt;
  &lt;input type="text" name="firstName" /&gt;
  &lt;input type="submit" /&gt;
&lt;/form&gt;</pre></div></li><li class="listitem">Create<a id="id216" class="indexterm"/> another controller method to process the form when it's<a id="id217" class="indexterm"/> submitted:<div class="informalexample"><pre class="programlisting">@RequestMapping(value="/addUser", <span class="strong"><strong>method=RequestMethod.POST</strong></span>)
public String addUserSubmit(HttpServletRequest request) {
  String firstName = request.getParameter("firstName");
  ...
  return "redirect:/home";
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec96"/>How it works…</h2></div></div></div><p>The first controller method displays the JSP containing the HTML form. For more details, refer to the <span class="emphasis"><em>Using a JSP view</em></span> recipe in <a class="link" href="ch03.html" title="Chapter 3. Using Controllers and Views">Chapter 3</a>, <span class="emphasis"><em>Using Controllers and Views</em></span>.</p><p>The HTML form contains one text field. It's submitted via <code class="literal">POST</code>. The form's <code class="literal">action</code> attribute is absent, so the form will be submitted to the current page URL (<code class="literal">/addUser</code>).</p><p>The second controller method is called when the form is submitted. The value of the <code class="literal">firstName</code> form field is retrieved using <code class="literal">HttpServletRequest</code>. At the end, we will redirect to <code class="literal">/home</code>.</p><p>Both controller methods are mapped to the same <code class="literal">/addUser</code> URL. The first method is called for HTTP <code class="literal">GET</code> requests. The second method is called for HTTP <code class="literal">POST</code> requests (because of <code class="literal">method=RequestMethod.POST</code>).</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec97"/>There's more…</h2></div></div></div><p>The two controller methods could have different URLs. For example, <code class="literal">/addUser</code> and <code class="literal">/addUserSubmit</code>. In this case, in the JSP, we would use the <code class="literal">action</code> attribute:</p><div class="informalexample"><pre class="programlisting">&lt;form method="POST" <span class="strong"><strong>action="/addUserSubmit"&gt;</strong></span>
  …
&lt;/form&gt;</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec98"/>See also</h2></div></div></div><p>In the second <a id="id218" class="indexterm"/>controller method, to avoid using the cumbersome <code class="literal">request.getParameter()</code> method<a id="id219" class="indexterm"/> for each form field, refer to the <span class="emphasis"><em>Getting a submitted form value using a controller method argument</em></span> and <span class="emphasis"><em>Saving form values into an object automatically</em></span> recipes.</p></div></div>
<div class="section" title="Getting a submitted form value using a controller method argument"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Getting a submitted form value using a controller method argument</h1></div></div></div><p>In this recipe, you will learn how to get the submitted form data using controller method arguments. This is convenient for simple forms that are not related to a domain object.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec99"/>How to do it…</h2></div></div></div><p>Add an <a id="id220" class="indexterm"/>argument <a id="id221" class="indexterm"/>annotated with <code class="literal">@RequestParam</code> to the controller method:</p><div class="informalexample"><pre class="programlisting">@RequestMapping("processForm")
public void processForm<span class="strong"><strong>(@RequestParam("name") String userName</strong></span>) {
...</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec100"/>How it works…</h2></div></div></div><p>The <code class="literal">userName</code> argument is initialized by Spring with the submitted value of the <code class="literal">name</code> form field.</p><p><code class="literal">@RequestParam</code> can also retrieve URL parameters, for example, <code class="literal">http://localhost:8080/springwebapp/processForm?name=Merlin</code>.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec101"/>There's more…</h2></div></div></div><p>It's also possible to add the standard <code class="literal">HttpServletRequest</code> object as an argument of the controller method and get the submitted value for <code class="literal">name</code> directly from it:</p><div class="informalexample"><pre class="programlisting">@RequestMapping("processForm")
public void processForm(HttpServletRequest request) {
  String name = <span class="strong"><strong>request.getParameter("name");</strong></span>
</pre></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec102"/>See also</h2></div></div></div><p>Refer to the <span class="emphasis"><em>Saving form values into an object automatically</em></span> recipe for more details.</p></div></div>
<div class="section" title="Setting a form's default values using a model object"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Setting a form's default values using a model object</h1></div></div></div><p>In this recipe, you will learn how to display a form with initial values that the user can change.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec103"/>How to do it…</h2></div></div></div><p>Create an <a id="id222" class="indexterm"/>object containing the default <a id="id223" class="indexterm"/>values in the controller. In the view, use Spring form tags to generate the form using that object:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the controller, add a method annotated with <code class="literal">@ModelAttribute</code>, which returns an object with default values:<div class="informalexample"><pre class="programlisting">@ModelAttribute("<span class="strong"><strong>defaultUser</strong></span>")
public <span class="strong"><strong>User</strong></span> defaultUser() {
  User user = new User();
  user.setFirstName("<span class="strong"><strong>Joe</strong></span>");
  user.setAge(<span class="strong"><strong>18</strong></span>);
  return user;
}</pre></div></li><li class="listitem">In the controller, add a method to display the form:<div class="informalexample"><pre class="programlisting">@RequestMapping("addUser")
public String addUser() {
  return "addUser";
}</pre></div></li><li class="listitem">In the JSP, use Spring form tags to generate the form:<div class="informalexample"><pre class="programlisting">&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;

&lt;form:form method="POST" modelAttribute="<span class="strong"><strong>defaultUser</strong></span>"&gt;
  &lt;form:input path="firstName" /&gt;
  &lt;form:input path="age" /&gt;
  &lt;input type="submit" value="Submit" /&gt;
&lt;/form:form&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec104"/>How it works…</h2></div></div></div><p>In the <a id="id224" class="indexterm"/>controller, because of <code class="literal">@ModelAttribute</code>, the <code class="literal">defaultUser()</code> method is automatically called for each request of the<a id="id225" class="indexterm"/> controller. The returned <code class="literal">User</code> object is stored in the memory as <code class="literal">defaultUser</code>. In the JSP, <code class="literal">defaultUser</code> is used to initialize the form:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It's set as <code class="literal">modelAttribute</code> of the <code class="literal">form:form</code> element:<div class="informalexample"><pre class="programlisting">&lt;form:form method="POST" modelAttribute="<span class="strong"><strong>defaultUser</strong></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Form fields get their values from the corresponding properties of <code class="literal">defaultUser</code>. For example, the <code class="literal">firstName</code> field will be initialized with the value returned by <code class="literal">defaultUser.getFirstName()</code>.</li></ul></div></div></div>
<div class="section" title="Saving form data in an object automatically"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Saving form data in an object automatically</h1></div></div></div><p>For forms<a id="id226" class="indexterm"/> directly related to a model object, for example, a form to add <code class="literal">User</code>, the submitted form data can be automatically saved in an instance of that object.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec105"/>How to do it…</h2></div></div></div><p>In the controller method processing the form submission, add the object as an argument and make the field names in the JSP match its attributes:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a <code class="literal">User</code> argument annotated with <code class="literal">@ModelAttribute</code> to the controller method processing the form submission:<div class="informalexample"><pre class="programlisting">@RequestMapping(value="addUser", method=RequestMethod.POST)
public void addUser(<span class="strong"><strong>@ModelAttribute User user</strong></span>) {
...</pre></div></li><li class="listitem">In the JSP, make sure that the form fields correspond to the existing attributes of the object:<div class="informalexample"><pre class="programlisting">&lt;form:input path="firstName" /&gt;
&lt;form:input path="age" /&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec106"/>How it works…</h2></div></div></div><p>When the form is submitted, this is what goes on behind the scenes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A new <code class="literal">User</code> object is created</li><li class="listitem" style="list-style-type: disc">The form values are injected into the object by matching the form field names to object attribute names, for example:<div class="informalexample"><pre class="programlisting">user.setFirstName(request.getParameter("firstName"));</pre></div></li><li class="listitem" style="list-style-type: disc">The resulting object is given to the controller method through its <code class="literal">@ModelAttribute</code> argument</li></ul></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec107"/>There's more…</h2></div></div></div><p>Instead of <a id="id227" class="indexterm"/>making Spring create a new object, you can provide the name of a default one:</p><div class="informalexample"><pre class="programlisting">public void addUser(@ModelAttribute("<span class="strong"><strong>defaultUser</strong></span>") User user) {
...</pre></div><p>In this case, Spring will use the object returned by the corresponding <code class="literal">@ModelAttribute </code>method of the controller class to store the submitted form data:</p><div class="informalexample"><pre class="programlisting">@ModelAttribute("<span class="strong"><strong>defaultUser</strong></span>")
public User user() {
  User user = new User();
  user.setFirstName("Joe");
  user.setAge(18);
  return user;
}</pre></div></div></div>
<div class="section" title="Using text, textarea, password, and hidden fields"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec51"/>Using text, textarea, password, and hidden fields</h1></div></div></div><p>In this <a id="id228" class="indexterm"/>recipe, you <a id="id229" class="indexterm"/>will learn how to display a text field, <code class="literal">textarea</code> field, <code class="literal">password</code> field, and <code class="literal">hidden</code> field using Spring form tags. When the<a id="id230" class="indexterm"/> form is<a id="id231" class="indexterm"/> submitted, we will retrieve the field value in a controller method.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec108"/>How to do it…</h2></div></div></div><p>Here are the steps to display and process text fields:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If a default value is necessary, use a <code class="literal">String</code> attribute of the default object (refer to the <span class="emphasis"><em>Setting a form's default values using a model object</em></span> recipe):<div class="informalexample"><pre class="programlisting">user.setFirstName("Joe");</pre></div></li><li class="listitem">In the JSP, use one of these Spring form tags:<div class="informalexample"><pre class="programlisting">&lt;form:input path="firstName" /&gt;
&lt;form:textarea path="firstName" /&gt;
&lt;form:password path="firstName" /&gt;
&lt;form:hidden path="firstName" /&gt;</pre></div></li><li class="listitem">In the controller method processing the form submission, make sure that the <code class="literal">@ModelAttribute</code> object has a corresponding <code class="literal">String</code> attribute:<div class="informalexample"><pre class="programlisting">public class User {
  private String firstName;
...</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec109"/>How it works…</h2></div></div></div><p>The Spring <a id="id232" class="indexterm"/>form tag <a id="id233" class="indexterm"/>generates the HTML form field and<a id="id234" class="indexterm"/> populates<a id="id235" class="indexterm"/> it with the default value defined in the default object. The <code class="literal">path</code> attribute corresponds to the attribute of the default object. When the form is submitted, the form field value is saved in the corresponding attribute of the <code class="literal">@ModelAttribute</code> object.</p><p>For reference, this is the generated HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;input id="firstName" name="firstName" type="text" value="Joe"/&gt;
&lt;textarea id="firstName" name="firstName"&gt;Joe&lt;/textarea&gt;
&lt;input id="firstName" name="firstName" type="password" value=""/&gt;
&lt;input id="firstName" name="firstName" type="hidden" value="Joe"/&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>Note that the default value is not actually used for the <code class="literal">password</code> field.</p></div></div></div></div>
<div class="section" title="Using a select field"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Using a select field</h1></div></div></div><p>In this recipe, you <a id="id236" class="indexterm"/>will learn how to display a <code class="literal">select</code> field. When the form is submitted, retrieve the selected value in a controller method.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec110"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the controller, add a <code class="literal">@ModelAttribute</code> method returning a <code class="literal">Map</code> object that contains the <code class="literal">select</code> field options:<div class="informalexample"><pre class="programlisting">@ModelAttribute("<span class="strong"><strong>countries</strong></span>")
public <span class="strong"><strong>Map</strong></span>&lt;String, String&gt;countries() {
  Map&lt;String, String&gt; m = new HashMap&lt;String, String&gt;();
  m.put("us", "United States");
  m.put("ca", "Canada");
  m.put("fr", "France");
  m.put("de", "Germany");
  return m;
}</pre></div></li><li class="listitem">If a default value is necessary, use a <code class="literal">String</code> attribute of the default object (refer to the <span class="emphasis"><em>Setting a form's default values using a model object</em></span> recipe) initialized with one of the <code class="literal">Map</code> keys:<div class="informalexample"><pre class="programlisting">user.setCountry("ca");</pre></div></li><li class="listitem">In the JSP, use a <code class="literal">form:select</code> element initialized with the <code class="literal">@ModelAttribute</code> Map:<div class="informalexample"><pre class="programlisting">&lt;form:select path="country" items="${countries}" /&gt;</pre></div></li><li class="listitem">In the <a id="id237" class="indexterm"/>controller that processes the form submission, make sure that the <code class="literal">@ModelAttribute</code> object (the one used to save the form values) has a corresponding <code class="literal">String</code> attribute:<div class="informalexample"><pre class="programlisting">public class User {
  private String country;
...</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec111"/>How it works…</h2></div></div></div><p>The <code class="literal">form:select</code> tag generates an HTML <code class="literal">select</code> field and initializes it with the <code class="literal">@ModelAttribute</code> Map and the default value defined in the default object. The <code class="literal">path</code> attribute corresponds to the attribute of the default object. When the form is submitted, the selected value is saved in the corresponding attribute of the <code class="literal">@ModelAttribute</code> <code class="literal">User</code> object.</p><p>For reference, this is the generated HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;select id="country" name="country"&gt;
  &lt;option value="de"&gt;Germany&lt;/option&gt;
  &lt;option value="fr"&gt;France&lt;/option&gt;
  &lt;option value="us"&gt;United States&lt;/option&gt;
  &lt;option value="ca" selected="selected"&gt;Canada&lt;/option&gt;
&lt;/select&gt;</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec112"/>There's more…</h2></div></div></div><p>It's not necessary to use a <code class="literal">Map</code> class for the <code class="literal">@ModelAttribute</code> object. A <code class="literal">List&lt;String&gt;</code> object or directly using fields of an existing class may be more convenient.</p><div class="section" title="Using a List&lt;String&gt; object"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec32"/>Using a List&lt;String&gt; object</h3></div></div></div><p>Instead<a id="id238" class="indexterm"/> of <code class="literal">Map</code>, it's<a id="id239" class="indexterm"/> possible that you can use a <code class="literal">List&lt;String&gt;</code> object:</p><div class="informalexample"><pre class="programlisting">@ModelAttribute("countries")
public List&lt;String&gt;countries() {
  List&lt;String&gt; l = new LinkedList&lt;String&gt;();
  l.add("com");
  l.add("ca");
  l.add("fr");
  l.add("de");    
  return l;
}</pre></div><p>The <a id="id240" class="indexterm"/>JSP code stays the same:</p><div class="informalexample"><pre class="programlisting">&lt;form:select path="country" items="${countries}" /&gt;</pre></div><p>In the <a id="id241" class="indexterm"/>generated HTML code, the displayed text will be the same as the <code class="literal">value</code> attribute:</p><div class="informalexample"><pre class="programlisting">&lt;select id="country" name="country"&gt;
  &lt;option value="com"&gt;com&lt;/option&gt;
  &lt;option value="ca" selected="selected"&gt;ca&lt;/option&gt;
  &lt;option value="fr"&gt;fr&lt;/option&gt;
  &lt;option value="de"&gt;de&lt;/option&gt;
&lt;/select&gt;</pre></div></div><div class="section" title="Using a List&lt;Object&gt; object"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl3sec33"/>Using a List&lt;Object&gt; object</h3></div></div></div><p>Instead of <a id="id242" class="indexterm"/>a <code class="literal">Map</code> object, you can use a <code class="literal">List&lt;Object&gt;</code> object. If, for<a id="id243" class="indexterm"/> example, <code class="literal">Country</code> was a class with <code class="literal">code</code> and <code class="literal">name String</code> attributes:</p><div class="informalexample"><pre class="programlisting">@ModelAttribute("countries")
public List&lt;Country&gt;countries() {
...</pre></div><p>The JSP code would specify these attributes:</p><div class="informalexample"><pre class="programlisting">&lt;form:select path="country" items="${countries}" itemValue="code" itemLabel="name" /&gt;</pre></div><p>The generated HTML code would be the same:</p><div class="informalexample"><pre class="programlisting">&lt;select id="country" name="country"&gt;
  &lt;option value="de"&gt;Germany&lt;/option&gt;
  &lt;option value="fr"&gt;France&lt;/option&gt;
  &lt;option value="us"&gt;United States&lt;/option&gt;
  &lt;option value="ca" selected="selected"&gt;Canada&lt;/option&gt;
&lt;/select&gt;</pre></div></div></div></div>
<div class="section" title="Using a checkbox"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Using a checkbox</h1></div></div></div><p>In this recipe, you<a id="id244" class="indexterm"/> will learn how to display a checkbox and, when the form is submitted, retrieve its state (selected or not) in a controller method.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec113"/>How to do it…</h2></div></div></div><p>Use the <code class="literal">form:checkbox</code> element in the JSP and a <code class="literal">boolean</code> attribute to store its value when the form is submitted:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">If a default value is necessary, use a <code class="literal">boolean</code> attribute of the default object (refer to the <span class="emphasis"><em>Setting a form's default values using a model object</em></span> recipe):<div class="informalexample"><pre class="programlisting">user.setMarried(false);</pre></div></li><li class="listitem">In the JSP, use the <code class="literal">form:checkbox</code> element:<div class="informalexample"><pre class="programlisting">&lt;form:checkbox path="married" /&gt;</pre></div></li><li class="listitem">In the controller that processes the form submission, make sure that the <code class="literal">@ModelAttribute</code> object has a corresponding <code class="literal">boolean</code> attribute:<div class="informalexample"><pre class="programlisting">public class User {
  private boolean married;
...</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec114"/>How it works…</h2></div></div></div><p>This is the generated HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;input id="married1" name="<span class="strong"><strong>married</strong></span>" type="<span class="strong"><strong>checkbox</strong></span>" value="true"/&gt;
&lt;input type="<span class="strong"><strong>hidden</strong></span>" name="<span class="strong"><strong>_married</strong></span>" value="on"/&gt;</pre></div><p>If the checkbox is checked, <code class="literal">married=true</code> is sent when the form is submitted. If it's not checked, nothing is sent (this is the standard HTML behavior). That's why a <code class="literal">hidden</code> form field is also generated. The field <code class="literal">_married</code> will be sent with the value <code class="literal">on</code> regardless of the checkbox state. So, if the married field is not there, Spring will know to set its value to false.</p></div></div>
<div class="section" title="Using a list of checkboxes"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Using a list of checkboxes</h1></div></div></div><p>In this recipe, you'll <a id="id245" class="indexterm"/>learn how to display a list of checkboxes and when the form is submitted, how to retrieve the selected values in a controller method.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec115"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the controller, add a <code class="literal">@ModelAttribute</code> method returning a <code class="literal">Map</code> object:<div class="informalexample"><pre class="programlisting">@ModelAttribute("<span class="strong"><strong>languages</strong></span>")
public Map&lt;String, String&gt;languages() {
  Map&lt;String, String&gt; m = new HashMap&lt;String, String&gt;();
  m.put("en", "English");
  m.put("fr", "French");
  m.put("de", "German");
  m.put("it", "Italian");
  return m;
}</pre></div></li><li class="listitem">If a default<a id="id246" class="indexterm"/> value is necessary, use a <code class="literal">String[]</code> attribute of the default object (refer to the <span class="emphasis"><em>Setting a form's default values using a model object</em></span> recipe) initialized with some of the <code class="literal">Map</code> keys:<div class="informalexample"><pre class="programlisting">String[] defaultLanguages = {"en", "fr"};
user.setLanguages(defaultLanguages);</pre></div></li><li class="listitem">In the JSP, use a <code class="literal">form:checkboxes</code> element initialized with the <code class="literal">@ModelAttribute</code> Map:<div class="informalexample"><pre class="programlisting">&lt;form:checkboxes items="${<code class="literal">languages</code>}" path="languages" /&gt;</pre></div></li></ol></div><p>In the controller that processes the form submission, make sure that the <code class="literal">@ModelAttribute</code> object (the one used to save the form values) has a corresponding <code class="literal">String[]</code> attribute:</p><div class="informalexample"><pre class="programlisting">public class User {
  private String[] languages;
...</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec116"/>How it works…</h2></div></div></div><p>Spring's <code class="literal">form:checkboxes</code> tag generates the checkboxes using the <code class="literal">Map</code> keys as values and the <code class="literal">Map</code> values as text displayed to the user.</p><p>For reference, this is the generated HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;span&gt;
  &lt;input id="languages1" name="languages" type="checkbox" value="de"/&gt;
  &lt;label for="languages1"&gt;German&lt;/label&gt;
&lt;/span&gt;
&lt;span&gt;
  &lt;input id="languages2" name="languages" type="checkbox" value="en"/&gt;
  &lt;label for="languages2"&gt;English&lt;/label&gt;
&lt;/span&gt;
&lt;span&gt;
  &lt;input id="languages3" name="languages" type="checkbox" value="fr"/&gt;
  &lt;label for="languages3"&gt;French&lt;/label&gt;
&lt;/span&gt;

&lt;input type="hidden" name="_languages" value="on"/&gt;</pre></div><p>As in the <a id="id247" class="indexterm"/>previous recipe, a <code class="literal">hidden</code> form field is also generated. <code class="literal">_languages=on</code> will be sent regardless of the checkboxes state. So, if none are selected, Spring will know to set the value of the languages array to an empty <code class="literal">String[]</code> object.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec117"/>There's more…</h2></div></div></div><p>To have more control on the generated HTML code (to avoid the <code class="literal">label</code> and <code class="literal">span</code> tags), it's possible to use several <code class="literal">form:checkbox</code> elements with the same value for the <code class="literal">path</code> attribute:</p><div class="informalexample"><pre class="programlisting">&lt;form:checkbox path="<span class="strong"><strong>languages</strong></span>" value="de" /&gt;German
&lt;form:checkbox path="<span class="strong"><strong>languages</strong></span>" value="en" /&gt;English
&lt;form:checkbox path="<span class="strong"><strong>languages</strong></span>" value="fr" /&gt;French</pre></div><p>The generated HTML code is similar, except for the <code class="literal">hidden</code> attribute, which is generated multiple times:</p><div class="informalexample"><pre class="programlisting">&lt;input id="languages1" name="languages" type="checkbox" value="de"/&gt;
&lt;input type="hidden" name="_languages" value="on"/&gt;
German

&lt;input id="languages2" name="languages" type="checkbox" value="en"/&gt;
&lt;input type="hidden" name="_languages" value="on"/&gt;
English

&lt;input id="languages3" name="languages" type="checkbox" value="fr"/&gt;
&lt;input type="hidden" name="_languages" value="on"/&gt;
French</pre></div></div></div>
<div class="section" title="Using a list of radio buttons"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Using a list of radio buttons</h1></div></div></div><p>In this<a id="id248" class="indexterm"/> recipe, you'll learn how to display a list of radio buttons. When the form is submitted, retrieve the selected value in a controller method.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec118"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the controller, add a <code class="literal">@ModelAttribute</code> method returning <code class="literal">Map</code> object:<div class="informalexample"><pre class="programlisting">@ModelAttribute("countries")
public Map&lt;String, String&gt;countries() {
  Map&lt;String, String&gt; m = new HashMap&lt;String, String&gt;();
  m.put("us", "United States");
  m.put("ca", "Canada");
  m.put("fr", "France");
  m.put("de", "Germany");
  return m;
}</pre></div></li><li class="listitem">If a <a id="id249" class="indexterm"/>default value is necessary, use a <code class="literal">String</code> attribute of the default object (refer to the <span class="emphasis"><em>Setting a form's default values using a model object</em></span> recipe) initialized with one of the <code class="literal">Map</code> keys:<div class="informalexample"><pre class="programlisting">user.setCountry("ca");</pre></div></li><li class="listitem">In the JSP, use a <code class="literal">form:radiobuttons</code> element initialized with the <code class="literal">@ModelAttribute</code> Map:<div class="informalexample"><pre class="programlisting">&lt;form:radiobuttons items="${countries}" path="country" /&gt;</pre></div></li><li class="listitem">In the controller processing the form submission, make sure that the <code class="literal">@ModelAttribute</code> object (the one used to save the form values) has a corresponding <code class="literal">String</code> attribute:<div class="informalexample"><pre class="programlisting">public class User {
  private String country;
...</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec119"/>How it works…</h2></div></div></div><p>Spring's <code class="literal">form:radiobuttons</code> tag generates the radio buttons using the <code class="literal">Map</code> keys as values and the <code class="literal">Map</code> values as text displayed to the user.</p><p>For reference, this is the generated HTML code:</p><div class="informalexample"><pre class="programlisting">&lt;span&gt;
  &lt;input id="country1" name="country" type="radio" value="de"/&gt;
  &lt;label for="country1"&gt;Germany&lt;/label&gt;
&lt;/span&gt;
&lt;span&gt;
  &lt;input id="country2" name="country" type="radio" value="fr"/&gt;
  &lt;label for="country2"&gt;France&lt;/label&gt;
&lt;/span&gt;
&lt;span&gt;
  &lt;input id="country3" name="country" type="radio" value="us"/&gt;
  &lt;label for="country3"&gt;United States&lt;/label&gt;
&lt;/span&gt;
&lt;span&gt;
  &lt;input id="country4" name="country" type="radio" value="ca" checked="checked"/&gt;
  &lt;label for="country4"&gt;Canada&lt;/label&gt;
&lt;/span&gt;    </pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec120"/>There's more…</h2></div></div></div><p>To have more <a id="id250" class="indexterm"/>control of the generated HTML code (to avoid the <code class="literal">label</code> and <code class="literal">span</code> tags), it's possible to use several <code class="literal">form:radiobutton</code> elements with the same value for the <code class="literal">path</code> attribute:</p><div class="informalexample"><pre class="programlisting">&lt;form:radiobutton path="<span class="strong"><strong>country</strong></span>" value="de" /&gt;Germany
&lt;form:radiobutton path="<span class="strong"><strong>country</strong></span>" value="fr" /&gt;France
&lt;form:radiobutton path="<span class="strong"><strong>country</strong></span>" value="us" /&gt;United States
&lt;form:radiobutton path="<span class="strong"><strong>country</strong></span>" value="ca" /&gt;Canada</pre></div><p>The generated HTML code for the input fields is identical to the code generated by the <code class="literal">form:radiobutton</code> tag:</p><div class="informalexample"><pre class="programlisting">&lt;input id="country1" name="country" type="radio" value="de"/&gt;Germany
&lt;input id="country2" name="country" type="radio" value="fr"/&gt;France
&lt;input id="country3" name="country" type="radio" value="us"/&gt;United States
&lt;input id="country4" name="country" type="radio" value="ca" checked="checked"/&gt;Canada</pre></div></div></div>
<div class="section" title="Validating a form using annotations"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Validating a form using annotations</h1></div></div></div><p>In this recipe, you'll learn how to add form validation rules by adding constraints directly in model <a id="id251" class="indexterm"/>classes using annotations. For example:</p><div class="informalexample"><pre class="programlisting">public class User {
  @NotEmpty
  private String firstName;</pre></div><p>We'll use<a id="id252" class="indexterm"/> constraint annotations from the Java bean annotation API and from Hibernate Validator (which is a project independent of Hibernate ORM).</p><p>If the validation fails, the form will be shown again to the user with the errors that are to be fixed.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec121"/>How to do it…</h2></div></div></div><p>Add<a id="id253" class="indexterm"/> constraint annotations to the model class. Check whether<a id="id254" class="indexterm"/> the validation was successful in the controller method. Add error tags in the JSP:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Maven dependencies in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;javax.validation&lt;/groupId&gt;
  &lt;artifactId&gt;validation-api&lt;/artifactId&gt;
  &lt;version&gt;1.1.0.Final&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
  &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
  &lt;version&gt;5.1.2.Final&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem">Add constraints using annotations to the model class:<div class="informalexample"><pre class="programlisting">@NotEmpty
private String firstName;

@Min(18) @Max(130)
private int age;</pre></div></li><li class="listitem">In the controller method processing the form submission, add <code class="literal">@Valid</code> to the result object argument and a <code class="literal">BindingResult</code> argument after it:<div class="informalexample"><pre class="programlisting">@RequestMapping(value="addUser", method=RequestMethod.POST)
public void addUser(@ModelAttribute("defaultUser") <span class="strong"><strong>@Valid</strong></span> User user, <span class="strong"><strong>BindingResult result</strong></span>) {
...</pre></div></li><li class="listitem">In that same controller method, check whether the validation was successful:<div class="informalexample"><pre class="programlisting">if(result.hasErrors()) {
  // show the form page again, with the errors
  return "addUser";  
 }
 else {
   // validation was successful, redirect to another page
   return "redirect:/home";            
 }</pre></div></li><li class="listitem">Add form errors tags in the form JSP:<div class="informalexample"><pre class="programlisting">&lt;form:input path="firstName" /&gt;
&lt;form:errors path="firstName" cssclass="error"&gt;&lt;/form:errors&gt;

&lt;form:input path="age" /&gt;
&lt;form:errors path="age" cssclass="error"&gt;&lt;/form:errors&gt;</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec122"/>How it works…</h2></div></div></div><p>The <a id="id255" class="indexterm"/>constraint annotations in the model class are used to <a id="id256" class="indexterm"/>validate the <code class="literal">User</code> object when the form is submitted. The errors are stored in the <code class="literal">BindingResult</code> object. When the form is displayed again, the <code class="literal">form:errors</code> elements will display them. An example of the generated HTML code with the errors is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;input id="firstName" name="firstName" type="text" value=""/&gt;
&lt;span id="firstName.errors" cssclass="error"&gt;may not be empty&lt;/span&gt;

&lt;input id="age" name="age" type="text" value="1233"/&gt;
&lt;span id="age.errors" cssclass="error"&gt;must be less than or equal to 120&lt;/span&gt; </pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec123"/>There's more…</h2></div></div></div><p>Some common constraint annotations are:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@Max(120)</code>: This field must have a value lower than or equal to the given number</li><li class="listitem" style="list-style-type: disc"><code class="literal">@Min(18)</code>: This field must have a value equal to or greater than the given number</li><li class="listitem" style="list-style-type: disc"><code class="literal">@NotNull</code>: This <a id="id257" class="indexterm"/>field must not be null</li><li class="listitem" style="list-style-type: disc"><code class="literal">@Valid</code>: This<a id="id258" class="indexterm"/> field must be a valid object</li><li class="listitem" style="list-style-type: disc"><code class="literal">@NotBlank</code>: This <code class="literal">String</code> field<a id="id259" class="indexterm"/> must not be null and its trimmed length must be greater than 0</li><li class="listitem" style="list-style-type: disc"><code class="literal">@NotEmpty</code>: This <a id="id260" class="indexterm"/>collection field must not be null nor empty</li></ul></div><p>A full list of all the <a id="id261" class="indexterm"/>constraint annotations can be found here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://docs.oracle.com/javaee/6/tutorial/doc/gircz.html">http://docs.oracle.com/javaee/6/tutorial/doc/gircz.html</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#section-builtin-constraints">http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#section-builtin-constraints</a></li></ul></div><p>To create a <a id="id262" class="indexterm"/>custom constraint annotation, refer to:</p><p><a class="ulink" href="http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#validator-customconstraints">http://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#validator-customconstraints</a>.</p></div></div>
<div class="section" title="Uploading a file"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Uploading a file</h1></div></div></div><p>To allow a <a id="id263" class="indexterm"/>user to upload a file from an HTML form, we need to set the form encoding to <code class="literal">multipart/form-data</code>. On the server side, we will use the <code class="literal">fileupload</code> package from the Apache Commons library to process the uploaded file.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec124"/>How to do it…</h2></div></div></div><p>Here are the steps to upload a file from a form:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the Maven dependency for <code class="literal">fileupload</code> from Apache Commons in <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
  &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
  &lt;version&gt;1.3.1&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem">In the Spring configuration, declare a <code class="literal">MultipartResolver</code> bean with a size limit (in bytes) for the data to be uploaded:<div class="informalexample"><pre class="programlisting">@Bean
MultipartResolver multipartResolver() {
  CommonsMultipartResolver resolver = new CommonsMultipartResolver();
  resolver.setMaxUploadSize(500000000);
  return resolver;
}</pre></div></li><li class="listitem">In the JSP, set the HTML form encoding to <code class="literal">multipart/form-data</code>:<div class="informalexample"><pre class="programlisting">&lt;form:form method="POST" modelAttribute="defaultUser" <span class="strong"><strong>enctype="multipart/form-data"&gt;</strong></span>
</pre></div></li><li class="listitem">Add a file upload widget:<div class="informalexample"><pre class="programlisting">&lt;input <span class="strong"><strong>type="file"</strong></span> name="file" /&gt;</pre></div></li><li class="listitem">In the controller method processing the form submission, add <code class="literal">MultipartFile</code> as a <code class="literal">@RequestParam</code> argument:<div class="informalexample"><pre class="programlisting">@RequestMapping(value="addUser", method=RequestMethod.POST)
public void addUser(User user, <span class="strong"><strong>@RequestParam("file") MultipartFile formFile</strong></span>) {
...</pre></div></li><li class="listitem">Save the <a id="id264" class="indexterm"/>uploaded file to a <code class="literal">files</code> folder in the <code class="literal">Tomcat</code> directory:<div class="informalexample"><pre class="programlisting">try {
    // Create the folder "files" if necessary
    String tomcatFolderPath = System.getProperty("catalina.home");
    File filesFolder = new File(tomcatFolderPath + File.separator + "files");
    if ( ! filesFolder.exists()) {
        filesFolder.mkdirs();
    }

    // Write the uploaded file
    File file = new File(filesFolder.getAbsolutePath() + File.separator + formFile.getName());
    BufferedOutputStream fileStream = new BufferedOutputStream(new FileOutputStream(file));
    fileStream.write(formFile.getBytes());
    fileStream.close();
} catch (Exception e) {
  // deal with the exception…
}</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec125"/>How it works…</h2></div></div></div><p>In the JSP, the <code class="literal">multipart/form-data</code> encoding is necessary for the form to be able to encode and send files.</p><p>In the controller, we will create the <code class="literal">files</code> folder if it doesn't exist. At this point, the uploaded file is in the server's memory. We still need to write it to the filesystem. We do that using the <code class="literal">formFile</code> argument. Note that if a file with the same name already exists, it will be overwritten.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec126"/>There's more…</h2></div></div></div><p>To upload several files, you can have several form fields (file1, file2 and so on) and their corresponding arguments (formFile1, formFile2 and so on). It's also possible to use the same field name for multiple file upload widgets (this is convenient to allow the user to upload an <a id="id265" class="indexterm"/>undetermined number of files):</p><div class="informalexample"><pre class="programlisting">&lt;input type="<span class="strong"><strong>file</strong></span>" name="file" /&gt;
&lt;input type="<span class="strong"><strong>file</strong></span>" name="file" /&gt;
&lt;input type="<span class="strong"><strong>file</strong></span>" name="file" /&gt;</pre></div><p>In this case, we'll retrieve the files as an array of <code class="literal">MultipartFile</code> in the controller method:</p><div class="informalexample"><pre class="programlisting">@RequestMapping(value="addUser", method=RequestMethod.POST)
public void addUser(User user, <span class="strong"><strong>@RequestParam("file") MultipartFile[] form</strong></span>
<span class="strong"><strong>FileArray</strong></span>) {
...</pre></div></div></div></body></html>