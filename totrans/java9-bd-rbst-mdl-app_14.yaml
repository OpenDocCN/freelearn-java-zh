- en: Security Enhancements
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安全增强
- en: In the last chapter, we covered concurrency enhancements introduced with the
    Java 9 platform. We took an in-depth look at concurrency both as a core Java concept
    and as a series of enhancements for Java 9\. We also explored the `Flow` class
    API that supports Reactive Programming, a new concept in Java 9\. In addition,
    we explored concurrency enhancements and the new Spin-Wait hints introduced in
    Java 9.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了Java 9平台引入的并发增强功能。我们深入探讨了并发作为Java的核心概念以及作为Java 9的一系列增强。我们还探讨了支持响应式编程的`Flow`类API，这是Java
    9中的新概念。此外，我们还探讨了Java 9中引入的并发增强和新型的自旋等待提示。
- en: In this chapter, we will look at several small changes made to the JDK that
    involve security. The size of these changes does not reflect their significance.
    The security enhancements introduced with the Java 9 platform provide developers
    with a greater ability to write and maintain applications that are more secure
    than previously possible.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨对JDK进行的一些涉及安全性的小改动。这些改动的大小并不反映它们的显著性。Java 9平台引入的安全增强为开发者提供了编写和维护比以前更安全的应用程序的能力。
- en: 'Specifically, we will review the following content areas in this chapter:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 具体来说，在本章中，我们将回顾以下内容领域：
- en: Datagram Transport Layer Security
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据报传输层安全
- en: Creating PKCS12 keystores
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建PKCS12密钥库
- en: Improving security application performance
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提高安全应用程序性能
- en: TLS application-layer protocol negotiation extension
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TLS应用层协议协商扩展
- en: Leveraging CPU instructions for GHASH and RSA
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 利用CPU指令进行GHASH和RSA
- en: OCSP stapling for TLS
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TLS的OCSP粘合
- en: DRBG-based `SecureRandom` implementations
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于DRBG的`SecureRandom`实现
- en: Datagram Transport Layer Security
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据报传输层安全
- en: '**Datagram Transport Layer Security** (**DTLS**), is a communications protocol.
    The protocol provides a layer of security for datagram-based applications. DTLS
    permits secure communications and is based on the **Transport Layer Security**
    (**TLS**) protocol. Embedded security helps ensure messages are not forged, tampered
    with, or eavesdropped.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据报传输层安全**（**DTLS**）是一种通信协议。该协议为基于数据报的应用提供一层安全。DTLS允许安全通信，并基于**传输层安全**（**TLS**）协议。嵌入式安全有助于确保消息不被伪造、篡改或窃听。'
- en: 'Let''s review the relevant terminology:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们回顾一下相关的术语：
- en: '**Communication protocol**: A set of rules that govern how information is transmitted.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通信协议**：一组规则，用于规范信息的传输。'
- en: '**Datagram**: A structured transfer unit.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**数据报**：一种结构化传输单元。'
- en: '**Eavesdropping**: Undetected listening to in-transit data packets.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**窃听**：对传输中的数据包进行未检测到的监听。'
- en: '**Forgery**: Transmission of a packet with falsified sender.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**伪造**：发送伪造发送者的数据包。'
- en: '**Network packet**: A formatted unit of data for transmission.'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**网络数据包**：用于传输的格式化数据单元。'
- en: '**Tampering**: The altering of data packets after the sender transmits them
    and before the intended receiver receives them.'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**篡改**：在发送者发送数据包后和预期接收者接收它们之前更改数据包。'
- en: '**TLS protocol**: The most common network security protocol. Uses, as an example,
    IMPA and POP for email.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**TLS协议**：最常见的网络安全协议。例如，用于电子邮件的IMPA和POP。'
- en: The DTLS Java Enhancement Proposal 219 is aimed at creating an API for the DTLS
    versions 1.0 and 1.2.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: DTLS Java增强提案219旨在为DTLS版本1.0和1.2创建一个API。
- en: In the sections that follow, we will look at each of the DTLS versions, 1.0
    and 1.2, and then review the changes to the Java 9 platform.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将查看DTLS的每个版本，1.0和1.2，然后回顾Java 9平台的变化。
- en: DTLS protocol version 1.0
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DTLS协议版本1.0
- en: 'DTLS protocol version 1.0 was established in 2006 and provides communications
    security for datagram protocols. Here are the basic characteristics:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: DTLS协议版本1.0于2006年建立，为数据报协议提供通信安全。以下是基本特征：
- en: 'Permits client/server applications to communicate without permitting:'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 允许客户端/服务器应用程序通信，但不允许：
- en: Eavesdropping
  id: totrans-26
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 窃听
- en: Tampering
  id: totrans-27
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 篡改
- en: Message forgery
  id: totrans-28
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 消息伪造
- en: Based on the TLS protocol
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 基于TLS协议
- en: Provides security guarantees
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供安全保证
- en: The DLS protocol's datagram semantics are preserved
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DLS协议的数据报语义得到保留
- en: 'The following diagram illustrates where the **Transport Layer** fits into the
    overall schema of **SSL/TLS** protocol layers and protocols for each layer:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表说明了**传输层**在**SSL/TLS**协议层和每一层协议的整体架构中的位置：
- en: '![](img/5b9c33a2-ee23-4cd5-8ddc-7e5a0591b964.png)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/5b9c33a2-ee23-4cd5-8ddc-7e5a0591b964.png)'
- en: 'DTLS protocol version 1.0 provides detailed specifications with the major areas
    of coverage listed as follows:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: 'Ciphers:'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Anti-replay block cipher
  id: totrans-36
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: New cipher suites
  id: totrans-37
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Standard (or null) stream cipher
  id: totrans-38
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Denial of service countermeasures
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Handshake:'
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Message format
  id: totrans-41
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Protocol
  id: totrans-42
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Reliability
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Messages:'
  id: totrans-44
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fragmentation and reassembly
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Loss-insensitive messaging
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Size
  id: totrans-47
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Timeout and retransmission
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Packet loss
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Path Maximum Transition Unit** (**PMTU**) discovery'
  id: totrans-50
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Record layer
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Record payload protection
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reordering
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Replay detection
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Transport layer mapping
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: DTLS protocol version 1.2
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: DTLS protocol version 1.2 was published in January 2012 and is copyrighted by
    the **Internet Engineering Task Force** (**IETF**). This section shares code samples
    that illustrate the changes in version 1.2.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: 'The following code illustrates the TLS 1.2 handshake message header. This format
    supports:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Message fragmentation
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Message loss
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reordering
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The code presented in this section is from the DTLS protocol documentation and
    is republished here in accordance with IETF's *Legal Provisions Relating to IETF
    Documents*.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: 'The record layer contains the information that we intend to send into records.
    The information starts off inside a `DTLSPlaintext` structure and then, after
    the handshake takes place, the records are encrypted and are eligible to be sent
    by the communication stream. The record layer format follows with new fields in
    version 1.2 annotated with the `// New field` in-code comments as follows:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Finally, here is the updated handshake protocol:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: DTLS support in Java 9
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Java 9''s implementation of the DTLS API is transport-independent and light-weight.
    The design considerations for the API were as follows:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: Read timeouts will not be managed
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The implementation will use a single TLS record for each wrap/unwrap operation
  id: totrans-71
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The application, not the API, will be required to:'
  id: totrans-72
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determine timeout values
  id: totrans-73
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Assemble out-of-order application data
  id: totrans-74
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The DTLS is a protocol used to secure data from the application layer before
    that data is passed to a transport layer protocol. DTLS is a good solution for
    encrypting and transmitting real-time data. Caution should be exercised so that
    we do not introduce vulnerabilities in our application''s implementation. Here
    are security considerations specific to implementing DTLS in your Java 9 applications:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
- en: Implement DTLS v1.2, since that is the latest version supported by Java 9.
  id: totrans-76
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Avoid **Rivest-Shamir-Adleman** (**RSA**) encryption. If RSA must be used, add
    addition security to your private keys since this is a weak point for RSA.
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Use 192 bits or more when using the **Elliptic Curve Diffie-Hellman** (**ECDH**)
    anonymous key agreement protocol. The 192-bit value is based on a **National Institute
    of Standards and Technology** (**NIST**) recommendation.
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The use of **Authenticated Encryption with Associated Data** (**AEAD**), a form
    of encryption, is highly recommended. AEAD provides authenticity, confidentiality,
    and integrity assurances on the data being encrypted and decrypted.
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Always implement the `renegotiation_info` extension when implementing handshake
    renegotiation.
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实现握手重协商时始终实现`renegotiation_info`扩展。
- en: Establish a **Forward Secrecy** (**FS**) capability in all Java applications
    using a communication protocol. Implementing FS ensures past session encryption
    keys are not compromised when long-term encryption keys are compromised. Ideally
    a **Perfect Forward Secrecy** (**PFS**), where each key is only valid for a single
    session, would be used in the Java applications that call for the greatest security
    of transmitted data.
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在所有使用通信协议的Java应用程序中建立**前向安全性**（**FS**）功能。实现FS确保当长期加密密钥被泄露时，过去的会话加密密钥不会被泄露。理想情况下，Java应用程序将使用**完美前向安全性**（**PFS**），其中每个密钥仅对单个会话有效，以实现传输数据的最大安全性。
- en: Creating PKCS12 keystores
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建PKCS12密钥库
- en: The Java 9 platform provides increased security for keystores. In order to appreciate
    the changes ushered in by Java Enhancement Proposal 229, create PKCS12 keystores
    by default, we will first review the concept of keystores, look at the `KeyStore`
    class, and then look at the changes.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: Java 9平台为密钥库提供了增强的安全性。为了理解Java增强提案229带来的变化，默认创建PKCS12密钥库，我们将首先回顾密钥库的概念，查看`KeyStore`类，然后查看这些变化。
- en: Keystore primer
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 密钥库简介
- en: The concept of a `KeyStore` is relatively simple. It is essentially a database
    file, or data repository file, that stores public key certificates and private
    keys. The `Keystore` will be stored in the `/jre/lib/security/cacerts` folder.
    As you will see in the next section, this database is managed by Java's `java.security.KeyStore`
    class methods.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '`KeyStore`的概念相对简单。它本质上是一个数据库文件，或数据存储文件，用于存储公钥证书和私钥。`Keystore`将存储在`/jre/lib/security/cacerts`文件夹中。正如您将在下一节中看到的那样，此数据库由Java的`java.security.KeyStore`类方法管理。'
- en: '`KeyStore` features include:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`KeyStore`功能包括：'
- en: 'Contains one of the following entry types:'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含以下之一条目类型：
- en: Private keys
  id: totrans-88
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 私钥
- en: Public key certificates
  id: totrans-89
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公钥证书
- en: Unique alias string names for every entry
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个条目都有唯一的别名字符串名称
- en: Password protection for each key
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个密钥的密码保护
- en: Java Keystore (JKS)
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Java密钥库（JKS）
- en: 'The `java.security.KeyStore` class is the storage facility for cryptographic
    keys and certificates. This class extends `java.lang.Object`, see as follows:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`java.security.KeyStore`类是加密密钥和证书的存储设施。此类扩展`java.lang.Object`，如下所示：'
- en: '[PRE3]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'There are three types of entries managed by a `KeyStore`, each implements the
    `KeyStore.Entry` interface, one of the three interfaces provided by the `KeyStore`
    class. The Entry implementations are defined in the following table:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: '`KeyStore`管理三种类型的条目，每个条目都实现了`KeyStore.Entry`接口，这是`KeyStore`类提供的三个接口之一。条目实现定义在以下表中：'
- en: '| **Implementation** | **Description** |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| **实现** | **描述** |'
- en: '| `KeyStore.PrivateKeyEntry` |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| `KeyStore.PrivateKeyEntry` |'
- en: Contains the `PrivateKey` and can store it in a protected format
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含`PrivateKey`并可以以受保护格式存储它
- en: Contains the certificate chain for the public key
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含公钥的证书链
- en: '|'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| `KeyStore.SecretKeyEntry` |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| `KeyStore.SecretKeyEntry` |'
- en: Contains the `SecretKey` and can store it in a protected format
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含`SecretKey`并可以以受保护格式存储它
- en: '|'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '| `KeyStore.TrustedCertifcateEntry` |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| `KeyStore.TrustedCertifcateEntry` |'
- en: Contains a single public key `Certificate` from an external source
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 包含来自外部源的单个公钥`证书`
- en: '|'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: 'This class has been part of the Java platform since version 1.2\. It has one
    constructor, three interfaces, six sub-classes, and several methods. The constructor
    definition is:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 此类自Java 1.2版本以来就是Java平台的一部分。它有一个构造函数，三个接口，六个子类，以及几个方法。构造函数定义如下：
- en: '[PRE4]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The `KeyStore` class contains the following interfaces:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: '`KeyStore`类包含以下接口：'
- en: '`public static interface KeyStore.Entry`:'
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public static interface KeyStore.Entry`:'
- en: This interface serves as a marker for `KeyStore` entry types and contains no
    methods.
  id: totrans-111
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此接口作为`KeyStore`条目类型的标记，不包含任何方法。
- en: '`public static interface KeyStore.LoadStoreParameter`:'
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public static interface KeyStore.LoadStoreParameter`:'
- en: 'This interface serves as a marker for load and store parameters and has the
    following method that returns null or the parameter used to protect the `KeyStore`
    data:'
  id: totrans-113
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此接口作为加载和存储参数的标记，并具有以下返回null或用于保护`KeyStore`数据参数的方法：
- en: '`getProtectionParameter()`'
  id: totrans-114
  prefs:
  - PREF_IND
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`getProtectionParameter()`'
- en: '`public static interface KeyStore.ProtectionParameter`:'
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public static interface KeyStore.ProtectionParameter`:'
- en: This interface serves as a marker for `KeyStore` protection parameters and contains
    no methods.
  id: totrans-116
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 此接口作为`KeyStore`保护参数的标记，不包含任何方法。
- en: The `java.security.KeyStore` class also contains the six nested classes listed
    as follows.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: Builder
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.Builder` class is used when you want to defer the instantiation
    of a `KeyStore`:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This class provides the necessary information for instantiating a `KeyStore`
    object. The class has the following methods:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
- en: '`public abstract KeyStore getKeyStore() throws KeyStoreException`'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public abstractKeyStore.ProtectionParameter getProjectionParameter(String
    alias) throws KeyStoreException`'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Three options for `newInstance`:'
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public static KeyStore.Builder newInstance(KeyStore keyStore, KeyStore.ProtectionParameter
    protectionParameter)`'
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public static KeyStore.Builder newInstance(String type, Provider provider,
    File file, KeyStore.ProtectionParameter protection)`'
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public static KeyStore.Builder newInstance(String type, Provider provider,
    KeyStore.ProtectionParameter protection)`'
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The CallbackHandlerProtection class
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.CallbackHandlerProtection` class definition is as follows:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'This class provides a `ProtectionParameter` to encapsulate a `CallbackHandler`
    and has the following method:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The PasswordProtection class
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.PasswordProtection` class definition is as follows:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This call provides an implementation of `ProtectionParameter` that is password-based.
    The class has the following methods:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: '`public void destroy() throws DestroyFailedException`:'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This method clears the password
  id: totrans-138
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public char[] getPassword()`:'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns a reference to the password
  id: totrans-140
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public boolean isDestroyed()`:'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns true if the password was cleared
  id: totrans-142
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The PrivateKeyEntry class
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.PrivateKeyEntry` class definition is as follows:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'This creates an entry to hold a `PrivateKey` and the corresponding `Certificate`
    chain. This class has the following methods:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: '`public Certificate getCertificate()`:'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the **end entity** `Certificate` from the `Certificate` chain
  id: totrans-148
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public Certificate[] getCertificateChain()`:'
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the `Certificate` chain as an array of `Certificates`
  id: totrans-150
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public PrivateKey getPrivateKey()`:'
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the `PrivateKey` from the current entry
  id: totrans-152
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public String toString()`:'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the `PrivateKeyEntry` as a `String`
  id: totrans-154
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The SecretKeyEntry class
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.SecretKeyEntry` class definition is as follows:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This class holds a `SecretKey` and has the following methods:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: '`public SecretKey getSecretKey()`:'
  id: totrans-159
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the entry's `SecretKey`
  id: totrans-160
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public String toString()`:'
  id: totrans-161
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the `SecretKeyEntry` as a `String`.
  id: totrans-162
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The TrustedCertificateEntry class
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The `KeyStore.TrustedCertificateEntry` class definition is as follows:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This class holds a trusted `Certificate` and has the following methods:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
- en: '`public Certificate getTrustedCertificate()`:'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the entry's trusted `Certificate`
  id: totrans-168
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`public String toString()`:'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Returns the entry's trusted `Certificate` as a `String`
  id: totrans-170
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The key to using this class is understanding the flow. First, we must load
    the `KeyStore`, using the `getInstance` method. Next we request access to the
    `KeyStore` instance. Then, we have access to read and write to the `Object`:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5ed9c56a-5951-4c6c-a561-416a6d07f71e.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
- en: 'The following code snippet shows the load-request-access implementation:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: PKCS12 default in Java 9
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Prior to Java 9, the default `KeyStore` type was **Java KeyStore** (**JKS**).
    The Java 9 platform now uses PKCS as the default `KeyStore` type, more specifically,
    PKCS12.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: '**PKCS** is the acronym for **Public Key Cryptography Standards**.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: This change to PKCS provides stronger cryptographic algorithms as compared to
    JKS. As you would expect, JDK 9 will still be compatible with JKS to support previously
    developed systems.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: Improving security application performance
  id: totrans-179
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Java Enhancement Proposal 232, titled *Improving Security Application Performance*,
    was focused on performance improvements when running applications with a security
    manager installed. Security managers can result in processing overhead and less
    than ideal application performance.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: This is an impressive undertaking as current CPU overhead when running security
    managers is estimated to result in 10-15% performance degradation. It is not feasible
    to completely remove the CPU overhead as some CPU processing is required to run
    the security manager. That being said, the intention of this proposal (JEP-232)
    was to decrease the overhead percentage as much as possible.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
- en: 'This effort resulted in the following optimizations, each detailed in subsequent
    sections:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
- en: Security policy enforcement
  id: totrans-183
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Permission evaluation
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Hash code
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Package checking algorithm
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Security policy enforcement
  id: totrans-187
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'JDK 9 uses `ConcurrentHashMap` for mapping `ProtectionDomain` to `PermissionCollection`.
    `ConcurrentHashMap` is typically used for high concurrency in applications. It
    has the following characteristics:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: Thread safe
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enter map does not need to be synchronized
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fast reads
  id: totrans-191
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writes use locks
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: No object-level locking
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Locking at a very granular level
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The `ConcurrentHashMap` class definition follows:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: In the preceding class definition, `K` refers to the type of keys maintained
    by the hash map and `V` indicates the type of mapped values. There is a `KeySetView`
    sub-class and several methods.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
- en: 'There are three additional classes related to enforcing security policy--`ProtectionDomain`,
    `PermissionCollection`, and `SecureClassLoader`:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
- en: The `ProtectionDomain` class is used to encapsulate a group of classes so that
    permissions can be granted to the domain.
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `PermissionCollection` class represents a collection of permission objects.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `SecureClassLoader` class, which extends the `ClassLoader` class, provides
    additional functionality for defining classes with permissions for retrieval by
    the system policy. In Java 9, this class uses `ConcurrentHashMap` for increased
    security.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Permission evaluation
  id: totrans-202
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Under the category of permission evaluation, three optimizations were made:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: The `identifyPolicyEntries` list previously had policy provider code for synchronization.
    This code has been removed in JDK 9.
  id: totrans-204
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`identifyPolicyEntries`列表之前有策略提供者代码用于同步。在JDK 9中已删除此代码。'
- en: '`PermissionCollection` entries are now stored in a `ConcurrentHashMap`. They
    were previously stored as a `HashMap` in a `Permission` class.'
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`PermissionCollection`条目现在存储在`ConcurrentHashMap`中。之前它们作为`Permission`类中的`HashMap`存储。'
- en: Permissions are now stored in concurrent collections in subclasses of `PermissionCollection`.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 权限现在存储在`PermissionCollection`子类的并发集合中。
- en: The java.Security.CodeSource package
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`java.security.CodeSource`包'
- en: 'A hash code is an object-generated number that is stored in a hash table for
    rapid storage and retrieval. Every object in Java has a hash code. Here are some
    characteristics and rules for hash codes:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 哈希码是一个由对象生成的数字，用于存储在哈希表中以实现快速存储和检索。Java中的每个对象都有一个哈希码。以下是哈希码的一些特性和规则：
- en: Hash codes are the same for equal objects within a running process
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在运行过程中，对于相等的对象，哈希码是相同的
- en: Hash codes can change between execution cycles
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哈希码可以在执行周期之间改变
- en: Hash codes should not be used as keys
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 哈希码不应用作键
- en: The Java 9 platform includes a modified `hashCode` method of `java.security.CodeSource`
    to optimize DNS lookups. These can be processor intensive, so a String version
    of the code source URL is used to compute hash codes.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: Java 9平台包括修改后的`java.security.CodeSource`的`hashCode`方法，以优化DNS查找。这些查找可能非常耗时，因此使用代码源URL的字符串版本来计算哈希码。
- en: 'The `CodeSource` class definition follows:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '`CodeSource`类的定义如下：'
- en: '[PRE14]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'This class has the following methods:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 此类有以下方法：
- en: '`public boolean equals(Object obj)`: Returns `true` if the objects are equal.
    This overrides the `equals` method in the `Object` class.'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public boolean equals(Object obj)`: 如果对象相等，则返回`true`。这覆盖了`Object`类中的`equals`方法。'
- en: '`public final Certificate[] getCertificates()`: Returns an array of certificates.'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public final Certificate[] getCertificates()`: 返回一个证书数组。'
- en: '`public final CodeSigner[] getCodeSigners()`: Returns an array of the code
    signers associated with the `CodeSource`.'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public final CodeSigner[] getCodeSigners()`: 返回与`CodeSource`关联的代码签名者数组。'
- en: '`public final URL getLocation()`: Returns the URL.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public final URL getLocation()`: 返回URL。'
- en: '`public int hashCode()`: Returns the hash code value for the current object.'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public int hashCode()`: 返回当前对象的哈希码值。'
- en: '`public boolean implies(CodeSource codesource)`: Returns true if the given
    code source meets the following criteria:'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public boolean implies(CodeSource codesource)`: 如果给定的代码源满足以下标准，则返回true：'
- en: is not null
  id: totrans-222
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不为null
- en: object's certificates are not null
  id: totrans-223
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对象的证书不为null
- en: object's location is not null
  id: totrans-224
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对象的位置不为null
- en: '`public String toString()`: Returns a `String` with information about the `CodeSource`
    to include the location and certificates.'
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public String toString()`: 返回一个包含`CodeSource`信息的`String`，包括位置和证书。'
- en: Package checking algorithm
  id: totrans-226
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 包检查算法
- en: Java 9's final performance improvement when running applications with a security
    manager installed, came in the form of the `java.lang.SecurityManager` package
    enhancements. Specifically, the `checkPackageAccess` method's package checking
    algorithm was modified.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 当运行带有安全管理器的应用程序时，Java 9的最终性能改进体现在`java.lang.SecurityManager`包的增强上。具体来说，`checkPackageAccess`方法的包检查算法被修改。
- en: 'The `java.lang.SecurityManager` class allows applications to implement security
    policy on specific operations. The `public void checkPackageAccess(String pkg)`
    method, of this class receives a comma-delimited list of restricted packages from
    the the `getProperty` method. As illustrated here, depending on the evaluation,
    the `checkPackageAccess` method can throw one of two exceptions:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '`java.lang.SecurityManager`类允许应用程序在特定操作上实现安全策略。此类的`public void checkPackageAccess(String
    pkg)`方法从`getProperty`方法接收一个逗号分隔的受限包列表。如图所示，根据评估结果，`checkPackageAccess`方法可以抛出两种异常之一：'
- en: '![](img/3eb8d4b8-ce69-45d2-9aa9-089c3242a60b.png)'
  id: totrans-229
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/3eb8d4b8-ce69-45d2-9aa9-089c3242a60b.png)'
- en: TLS application-layer protocol negotiation extension
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: TLS应用层协议协商扩展
- en: Java Enhancement Proposal 244, simply enhanced the `javax.net.ssl` package so
    that it supports the **Transport Layer Security** (**TLS**) **ALPN** (**Application
    Layer Protocol Negotiation**) extension. This extension permits application protocol
    negotiation for TLS connections.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: Java增强提案244简单地增强了`javax.net.ssl`包，使其支持**传输层安全性**（**TLS**）**ALPN**（**应用层协议协商**）扩展。此扩展允许TLS连接进行应用协议协商。
- en: TLS ALPN extension
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: TLS ALPN扩展
- en: 'The ALPN is a TLS extension and can be used to negotiate which protocol to
    implement when using a secure connection. ALPN represents an efficient means of
    negotiating protocols. As indicated in the following diagram, there are five basic
    steps to TLS handshakes:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: ALPN是TLS扩展，可用于在安全连接中使用时协商要实现的协议。ALPN代表了一种高效的协议协商方式。如图所示，TLS握手有五个基本步骤：
- en: '![](img/ad131890-dcff-459d-8703-ee8fa804d6b7.png)'
  id: totrans-234
  prefs: []
  type: TYPE_IMG
  zh: '![图片](img/ad131890-dcff-459d-8703-ee8fa804d6b7.png)'
- en: The javax.net.ssl package
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: javax.net.ssl包
- en: The `java.net.ssl` package contains classes relating to secure socket packages.
    This permits us to use SSL as an example, for the reliable detection of errors
    introduced to the network byte stream. It also provides the ability to encrypt
    the data as well as provide authentication of client and server.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '`java.net.ssl`包包含与安全套接字包相关的类。这使得我们可以使用SSL作为示例，以可靠地检测网络字节流中引入的错误。它还提供了加密数据以及提供客户端和服务器身份验证的能力。'
- en: 'This package includes the following interfaces:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 此包包括以下接口：
- en: '`public interface HandshakeCompletedListener extends EventListener`'
  id: totrans-238
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface HandshakeCompletedListener extends EventListener`'
- en: '`public interface HostnameVerifier`'
  id: totrans-239
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface HostnameVerifier`'
- en: '`public interface KeyManager`'
  id: totrans-240
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface KeyManager`'
- en: '`` `public interface ManagerFactoryParameters` ``'
  id: totrans-241
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`` `public interface ManagerFactoryParameters` ``'
- en: '`public interface SSLSession`'
  id: totrans-242
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface SSLSession`'
- en: '`public interface SSLSessionBindingListener extends EventListener`'
  id: totrans-243
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface SSLSessionBindingListener extends EventListener`'
- en: '`public interface SSLSessionContext`'
  id: totrans-244
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface SSLSessionContext`'
- en: '`public interace TrustManager`'
  id: totrans-245
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interace TrustManager`'
- en: '`public interface X509KeyManager extends KeyManager`'
  id: totrans-246
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface X509KeyManager extends KeyManager`'
- en: '`public interface X509TrustManager extends TrustManager`'
  id: totrans-247
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public interface X509TrustManager extends TrustManager`'
- en: 'The `java.net.ssl` package also has the following sub-classes:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '`java.net.ssl`包还具有以下子类：'
- en: '`public class CertPathTrustManagerParameters extends Object implements ManagerFactoryParameters`'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class CertPathTrustManagerParameters extends Object implements ManagerFactoryParameters`'
- en: '`public abstract class ExtendedSSLSession extends Object implements SSLSession`'
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class ExtendedSSLSession extends Object implements SSLSession`'
- en: '`public class HandshakeCompleteEvent extends EventObject`'
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class HandshakeCompleteEvent extends EventObject`'
- en: '`public abstract class HttpsURLConnection extends HttpURLConnection`'
  id: totrans-252
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class HttpsURLConnection extends HttpURLConnection`'
- en: '`public class KeyManagerFactory extends Object`'
  id: totrans-253
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class KeyManagerFactory extends Object`'
- en: '`public abstract class KeyManagerFactorySpi`'
  id: totrans-254
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class KeyManagerFactorySpi`'
- en: '`public class KeyStoreBuilderParameters extends Object implements ManagerFactoryParameters`'
  id: totrans-255
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class KeyStoreBuilderParameters extends Object implements ManagerFactoryParameters`'
- en: '`public class SSLContext extends Object`'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class SSLContext extends Object`'
- en: '`public abstract class SSLContextSpi extends Object`'
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLContextSpi extends Object`'
- en: '`public abstract class SSLEngine extends Object`'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLEngine extends Object`'
- en: '`public class SSLEngineResult extends Object`'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class SSLEngineResult extends Object`'
- en: '`public class SSLParameters extends Object`'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class SSLParameters extends Object`'
- en: '`public final class SSLPermission extends BasicPermission`'
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public final class SSLPermission extends BasicPermission`'
- en: '`public abstract class SSLServerSocket extends ServerSocket`'
  id: totrans-262
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLServerSocket extends ServerSocket`'
- en: '`public abstract class SSLServerSocketFactory extends ServerSocketFactory`'
  id: totrans-263
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLServerSocketFactory extends ServerSocketFactory`'
- en: '`public class SSLSessionBindingEvent extends EventObject`'
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class SSLSessionBindingEvent extends EventObject`'
- en: '`public abstract class SSLSocket extends Socket`'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLSocket extends Socket`'
- en: '`public abstract class SSLSocketFactory extends SocketFactory`'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class SSLSocketFactory extends SocketFactory`'
- en: '`public class TrustManagerFactory extends Object`'
  id: totrans-267
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public class TrustManagerFactory extends Object`'
- en: '`` `public abstract class TrustManagerFactorySpi extends Object` ``'
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`` `public abstract class TrustManagerFactorySpi extends Object` ``'
- en: '`public abstract class X509ExtendedKeyManager extends Object implements X509KeyManager`'
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class X509ExtendedKeyManager extends Object implements X509KeyManager`'
- en: '`public abstract class X509ExtendedTrustManager extends Object implements x509TrustManager`'
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`public abstract class X509ExtendedTrustManager extends Object implements x509TrustManager`'
- en: The java.net.ssl package extension
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '`java.net.ssl`包的扩展'
- en: 'The change to the `java.net.ssl` package in the Java 9 platform is that it
    now supports the TLS ALPN extension. Key benefits of this change are:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Java 9平台中`java.net.ssl`包的更改是现在它支持TLS ALPN扩展。这一变化的关键好处包括：
- en: TLS clients and servers can now use multiple application-layer protocols, which
    may or may not use the same transport-layer port
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: TLS客户端和服务器现在可以使用多个应用层协议，这些协议可能使用也可能不使用相同的传输层端口
- en: The ALPN extension permits clients to prioritize application-layer protocols
    it supports
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ALPN扩展允许客户端优先选择它支持的应用层协议
- en: Servers can select a client protocol and for the TLS connection
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Supports HTTP/2
  id: totrans-276
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following illustration was previously presented as the five basic steps
    to TLS handshakes. Updated for Java 9 and presented here, the illustration indicates
    where the protocol names are shared between the client and server:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/cba4b2e5-95d3-46b2-867f-67ed154af091.png)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
- en: 'Once the client''s list of application layer protocols is received, the server
    can select the server''s preferred intersection value and externally scan initial
    plain text `ClientHellos` and select an ALPN protocol. An application server will
    do one of the following:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
- en: Select any of the supported protocols
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decide that the ALPN values (remotely offered and locally supported) are mutually
    exclusive
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ignore the ALPN extension
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Other key behaviors with regards to the ALPN extension:'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
- en: The server can alter connection parameters
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: After the SSL/TLS handshake starts, the application can query to see if an ALPN
    value has been selected yet
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: After the SSL/TLS handshake ends, the application can review which protocol
    was used
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'A `ClientHello` is the first message in the TLS handshake. It has the following
    structure:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Leveraging CPU instructions for GHASH and RSA
  id: totrans-289
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The self-descriptive title of Java Enhancement Proposal (JEP) 246, **Leverage
    CPU Instructions for GHASH and RSA**, provides great insight into its goal. The
    point of this JEP was to improve the performance of cryptographic operations,
    specifically GHASH and RSA. The performance improvement has been achieved in Java
    9 by leveraging the newest SPARC and Intel x64 CPU instructions.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
- en: This enhancement did not require new or modified APIs as part of the Java 9
    platform.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
- en: Hashing
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Galois HASH** (**GHASH**) and **Rivest-Shamir-Adleman** (**RSA**) are crypto
    systems hashing algorithms. Hashes are a fixed length string or number generated
    from a string of text. Algorithms, specifically hashing algorithms, are devised
    so that the resultant hashes cannot be reverse engineered. We use hashing to store
    passwords that are generated with a salt.'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
- en: Salts, in cryptology, are random data used as an input to a hashing function
    to generate a password. Salts help protect against rainbow table attacks and dictionary
    attacks.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
- en: 'The following graphic illustrates the basics of how hashing works:'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/0d04339c-77d0-4e35-9978-19a70ee1a5d3.png)'
  id: totrans-296
  prefs: []
  type: TYPE_IMG
- en: 'As you can see, the hashing algorithm is fed plain text and a salt resulting
    in a new hashed password and the salt being stored. Here is the same graphic with
    sample input/output to demonstrate the functionality:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2760ddd0-8d13-46df-b1f0-e2c8d75cb5e9.png)'
  id: totrans-298
  prefs: []
  type: TYPE_IMG
- en: 'The validation process, the following diagram starts with the user entering
    their plain text password. The hashing algorithm takes that plain text and rehashes
    it with the stored salt. Then the resulting hashed password is compared to the
    stored one:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6934f835-2c43-4bf3-a07c-3fceb6fbc617.png)'
  id: totrans-300
  prefs: []
  type: TYPE_IMG
- en: OCSP stapling for TLS
  id: totrans-301
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**Online Certificate Status Protocol** (**OCSP**) stapling is a method of checking
    the revocation status of digital certificates. The OCSP stapling approach for
    determining an SSL certificate''s validity is assessed as being both safe and
    quick. The determination speed is achieved by permitting web servers to provide
    the validity information on its organic certificates instead of the lengthier
    process of requesting validating information from the certificate''s issuing vendor.'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: '**Online Certificate Status Protocol** (**OCSP**) stapling was previously referred
    to as the **Transport Layer Security** (**TLS**) certificate status request extension.'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
- en: OCSP stapling primer
  id: totrans-304
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'THE OCSP stapling process involves several components and validity checks.
    The following graphic illustrates the OCSP stapling process:'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/f13723c8-e7c1-44f3-8b75-f0ee59f1a148.png)'
  id: totrans-306
  prefs: []
  type: TYPE_IMG
- en: As you can see, the process starts when the user attempts to open an SSL-encrypted
    website via their browser. The browser queries the web server to ensure the SSL-encrypted
    website has a valid certificate. The web server queries the certificate's vendor
    and is provided with both the certificate status and the digital signed time-stamp.
    The web server takes those two components (certificate status and digital signed
    time-stamp), staples them together, and returns the stapled set to the requesting
    browser. The browser can then check the validity of the time-stamp and decide
    whether to display the SSL-encrypted website or to display an error.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
- en: Changes for the Java 9 platform
  id: totrans-308
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Java Enhancement Proposal 249, **OCSP Stapling for TLS**, implements OCSP stapling
    via the TLS certificate status request extension. OSCP stapling checks the validity
    of X.509 certificates.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
- en: X.509 certificates are digital certificates that use the X509 **Public Key Infrastructure**
    (**PKI**).
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
- en: 'Prior to Java 9, the certificate validity check (really, the check to see if
    the certificate has been revoked) can be enabled on the client side and has the
    following inefficiencies:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
- en: OCSP responder performance bottlenecks
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Performance degradation based on multiple passes
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Additional performance degradation if OCSP checking is performed client side
  id: totrans-314
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: False **fails** when browsers do not connect to an OCSP responder
  id: totrans-315
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Susceptibility of denial of service attacks on OCSP responders
  id: totrans-316
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The new OCSP stapling for TLS includes the following system property changes
    for the Java 9 platform:'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
- en: '`jdk.tls.client.enableStatusRequestExtension`:'
  id: totrans-318
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: true'
  id: totrans-319
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enables `status_request` extension
  id: totrans-320
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enables `status_request_v2` extension
  id: totrans-321
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enables processing `CertificateStatus` messages from server
  id: totrans-322
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.server.enableStatusRequestExtension`:'
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: false'
  id: totrans-324
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Enables OCSP stapling support server-side
  id: totrans-325
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.responseTimeout`:'
  id: totrans-326
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: 5000 milliseconds'
  id: totrans-327
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Controls maximum time allocated by server to obtain OCSP responses
  id: totrans-328
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.cacheSize`:'
  id: totrans-329
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: 256'
  id: totrans-330
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Controls maximum number of cache entries
  id: totrans-331
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can set maximum to zero eliminates ceiling
  id: totrans-332
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.cacheLifetime`:'
  id: totrans-333
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: 3600 seconds (1 hour)'
  id: totrans-334
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Controls maximum lifetime of a cached response
  id: totrans-335
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can set value to zero in order to disable cache lifetime
  id: totrans-336
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.responderURI`:'
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: none'
  id: totrans-338
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Can set a default URI for certificates without the **Authority Info Access**
    (**AIA**) extension
  id: totrans-339
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Does not override the AIA extension unless `jdk.tls.stapling.Override` property
    is set
  id: totrans-340
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.respoderOverride`:'
  id: totrans-341
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: false'
  id: totrans-342
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Allows a `jdk.tls.stapling.responderURI` provided property to override AIA extension
    values
  id: totrans-343
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`jdk.tls.stapling.ignoreExtensions`:'
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Default setting: false'
  id: totrans-345
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: Disables OCSP extension forwarding as specified in `status_request` or `status_request_v2`
    TLS extensions.
  id: totrans-346
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: The `status_request` and `status_request_v2` TLS hello extensions are now supported
    by both client and server-side Java implementations.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
- en: DRBG-based SecureRandom implementations
  id: totrans-348
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Prior to Java 9, the JDK had two approaches to generating secure random numbers.
    One method, written in Java, used SHA1-based random number generation and was
    not terribly strong. The other method was platform-dependent and used preconfigured
    libraries.
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
- en: '**Deterministic Random Bit Generator** (**DRBG**) is a method for generating
    random numbers. It has been approved by the **National Institute of Standards
    and Technology** (**NIST**), a branch of the U.S. Department of Commerce. DRBG
    methodologies include modern and stronger algorithms for generating secure random
    numbers.'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
- en: 'Java Enhancement Proposal 273, **DRBG-Based SecureRandom Implementations**
    aimed to implement three specific DRBG mechanisms. These mechanisms are listed
    as follows:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
- en: '`Hash_DRBG`'
  id: totrans-352
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`HMAC_DRBG`'
  id: totrans-353
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`CTR_DRBG`'
  id: totrans-354
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You can learn specifics about each of the DRBG mechanisms at [http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf](http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-90Ar1.pdf)
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
- en: 'Here are the three new APIs:'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
- en: '`SecureRandom`: New methods allowing the configuration of `SecureRandom` objects
    with the below listed configurable properties:'
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: seeding
  id: totrans-358
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: reseeding
  id: totrans-359
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: random-bit-generation
  id: totrans-360
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SecureRandomSpi`: new methods to implement the `SecureRandom` methods'
  id: totrans-361
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`SecureRandomParameter`: new interface so input can be passed to the new `SecureRandom`
    methods'
  id: totrans-362
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summary
  id: totrans-363
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, we looked at several small, but significant changes to the
    JDK that involve security. The featured security enhancements that are part of
    the Java 9 platform provide developers with the distinct ability to write and
    maintain applications that implement security. Specifically, we covered DTLS,
    keystores, improving security application performance, the TLS application-layer
    protocol negotiation extension, leveraging CPU instructions for GHASH and RSA,
    OCSP stapling for TLS, and DRBG-based `SecureRandom` implementations.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter we will explore the new command-line flags used in Java
    9 as well as changes to various command-line tools. Our coverage will include
    managing the Java JVM run-time and compiler using the new command-line options
    and flags.
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
