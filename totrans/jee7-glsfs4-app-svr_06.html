<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;JSON Processing with JSON-P"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. JSON Processing with JSON-P</h1></div></div></div><p>
<span class="strong"><strong>JSON</strong></span>, or the <span class="strong"><strong>JavaScript Object Notation</strong></span>, is a human-readable data<a id="id547" class="indexterm"/> interchange format. As its name implies, JSON is derived from JavaScript. Java EE 7 introduced JSON-P, the Java API for JSON Processing as <a id="id548" class="indexterm"/>
<span class="strong"><strong>Java Specification Request</strong></span> (<span class="strong"><strong>JSR</strong></span>) 353.</p><p>Traditionally, XML has been the format of choice for data interchange between disparate systems. While XML is undoubtedly very popular, JSON has been gaining ground in recent years as an arguably simpler format for data exchange. Several Java libraries exist for parsing and generating JSON data from Java code. Java EE standardized this functionality via the Java API for JSON Processing.</p><p>JSON-P includes two APIs for processing JSON—the <a id="id549" class="indexterm"/>Model API and the <a id="id550" class="indexterm"/>Streaming API; both of these APIs will be covered in this chapter.</p><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The JSON-P Model API<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating JSON data with the Model API</li><li class="listitem" style="list-style-type: disc">Parsing JSON data with the Model API</li></ul></div></li><li class="listitem" style="list-style-type: disc">The JSON-P Streaming API<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating JSON data with the Streaming API</li><li class="listitem" style="list-style-type: disc">Parsing JSON data with the Streaming API</li></ul></div></li></ul></div><div class="section" title="The JSON-P Model API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec40"/>The JSON-P Model API</h1></div></div></div><p>The JSON-P Model API<a id="id551" class="indexterm"/> allows us to generate a preloaded, fully traversable, in-memory representation of a JSON object. This API is more flexible than the Streaming API discussed in the <span class="emphasis"><em>The JSON-P Streaming API</em></span> section. However, the JSON-P Model API is slower and requires more memory, which can be a concern when handling large volumes of data.</p><div class="section" title="Generating JSON data with the Model API"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec50"/>Generating JSON data with the Model API</h2></div></div></div><p>At the heart of the JSON-P Model API is the <code class="literal">JsonObjectBuilder</code> class. This class has several overloaded <code class="literal">add()</code> methods<a id="id552" class="indexterm"/> that <a id="id553" class="indexterm"/>can be used to add properties and their corresponding values to the generated JSON data.</p><p>The following code sample illustrates how to generate <a id="id554" class="indexterm"/>JSON data using the Model API:</p><div class="informalexample"><pre class="programlisting">packagepackagenet.ensode.glassfishbook.jsonpobject;

//other imports omitted for brevity.
importimportjavax.inject.Named;
importimportjavax.json.Json;
importimportjavax.json.JsonObject;
importimportjavax.json.JsonReader;
importimportjavax.json.JsonWriter;

@Named
@SessionScoped
public class JsonpBean implements Serializable{

    private String jsonStr;

    @Inject
    private Customer customer;

    public String buildJson() {
<span class="strong"><strong>JsonObjectBuilderjsonObjectBuilder =</strong></span>

<span class="strong"><strong>Json.createObjectBuilder();</strong></span>
<span class="strong"><strong>JsonObjectjsonObject = jsonObjectBuilder.</strong></span>
<span class="strong"><strong>                add("firstName", "Scott").</strong></span>
<span class="strong"><strong>                add("lastName", "Gosling").</strong></span>
<span class="strong"><strong>                add("email", "sgosling@example.com").</strong></span>
<span class="strong"><strong>                build();</strong></span>

StringWriterstringWriter = new StringWriter();

<span class="strong"><strong>        try (JsonWriter jsonWriter = Json.createWriter(stringWriter))</strong></span>
<span class="strong"><strong>        {</strong></span>
<span class="strong"><strong>            jsonWriter.writeObject(jsonObject);</strong></span>
<span class="strong"><strong>        }</strong></span>

<span class="strong"><strong>        setJsonStr(stringWriter.toString());</strong></span>

        return "display_json";

    }
  //getters and setters omitted for brevity
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>Our example is a CDI named bean that corresponds to a larger JSF application; the other parts of the application are not shown since they are not relevant to the discussion. The complete sample application is included as part of this book's example code download.</p></div></div><p>As can be seen in the previous example, we generate an instance of <code class="literal">JsonObject</code> by invoking the <code class="literal">add()</code> method on <code class="literal">JsonObjectBuilder</code>. In our example, we see how we can add <code class="literal">String</code> values to our <code class="literal">JsonObject</code> by invoking the <code class="literal">add()</code> method on <code class="literal">JsonObjectBuilder</code>. The first parameter of the <code class="literal">add()</code> method is the property name of the <a id="id555" class="indexterm"/>generated JSON object, and the second parameter corresponds to the value of the said property. The <a id="id556" class="indexterm"/>return value of the <code class="literal">add()</code> method is another instance of <code class="literal">JsonObjectBuilder</code>; therefore, invocations to the <code class="literal">add()</code> method can be chained as shown in the example.</p><p>Once we have added all the desired properties, we need to invoke the <code class="literal">build()</code> method<a id="id557" class="indexterm"/> of <code class="literal">JsonObjectBuilder</code>, which returns an instance of a class implementing the <code class="literal">JsonObject</code> interface.</p><p>In many cases, we may want to generate a <code class="literal">String</code> representation of the JSON object we created so that it can be processed by another process or service. We can do this by creating an instance of a class implementing the <code class="literal">JsonWriter</code> interface; invoking the static<a id="id558" class="indexterm"/> <code class="literal">createWriter()</code> method of the <code class="literal">Json</code> class, and passing an instance of <code class="literal">StringWriter</code> as its sole parameter. Once we have an instance of the <code class="literal">JsonWriter</code> implementation, we need to invoke its <code class="literal">writeObject()</code> method<a id="id559" class="indexterm"/>, passing our <code class="literal">JsonObject</code> instance as its sole parameter.</p><p>At this point, our <code class="literal">StringWriter</code> instance will have the <code class="literal">String</code> representation of our JSON object as its value. So, invoking its <code class="literal">toString()</code> method<a id="id560" class="indexterm"/> will return a <code class="literal">String</code> value containing our JSON object.</p><p>Our specific example will generate a JSON string that looks as follows:</p><div class="informalexample"><pre class="programlisting">{"firstName":"Scott","lastName":"Gosling","email":
    "sgosling@example.com"}</pre></div><p>Although we added only <code class="literal">String</code> objects to our JSON object in our example, we are not limited to this type of value. <code class="literal">JsonObjectBuilder</code> has several overloaded versions of its <code class="literal">add()</code> method, allowing us to add several different types of values to our JSON objects.</p><p>The following table summarizes<a id="id561" class="indexterm"/> all of the available <a id="id562" class="indexterm"/>versions of the <code class="literal">add()</code> method:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>JsonObjectBuilder methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, BigDecimal value)</code><a id="id563" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">BigDecimal</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, BigInteger value)</code><a id="id564" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">BigInteger</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, JsonArrayBuilder value)</code><a id="id565" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds an array to our JSON object. A <code class="literal">JsonArrayBuilder</code> implementation allows us to create JSON arrays.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, JsonObjectBuilder value)</code><a id="id566" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds another JSON object to our original JSON object (the property values for JSON objects can be other JSON objects). The added <code class="literal">JsonObject</code> implementation is built from the provided <code class="literal">JsonObjectBuilder</code> parameter.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, JsonValue value)</code><a id="id567" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds another JSON object to our original JSON object (the property values for JSON objects can be other JSON objects).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, String value)</code><a id="id568" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">String</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, boolean value)</code><a id="id569" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">boolean</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, double value)</code><a id="id570" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">double</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, int value)</code><a id="id571" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds an <code class="literal">int</code> value to our JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">add(String name, long value)</code><a id="id572" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method adds a <code class="literal">long</code> value to our JSON object.</p>
</td></tr></tbody></table></div><p>In all cases, the first parameter of the <code class="literal">add()</code> method corresponds to the name of the property in our JSON<a id="id573" class="indexterm"/> object and the second parameter corresponds to the value of the property.</p></div><div class="section" title="Parsing JSON data with the Model API"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec51"/>Parsing JSON data with the Model API</h2></div></div></div><p>In the last section, we saw how to generate JSON data from our Java code with the Model API. In this section, we will see <a id="id574" class="indexterm"/>how we can read and parse the existing <a id="id575" class="indexterm"/>JSON data. The following code sample illustrates how to do this:</p><div class="informalexample"><pre class="programlisting">packagepackagenet.ensode.glassfishbook.jsonpobject;

//other imports omitted
importimportjavax.json.Json;
importimportjavax.json.JsonObject;
importimportjavax.json.JsonReader;
importimportjavax.json.JsonWriter;

@Named
@SessionScoped
public class JsonpBean implements Serializable{

    private String jsonStr;

    @Inject
    private Customer customer;


    public String parseJson() {
JsonObjectjsonObject;

try (JsonReaderjsonReader = Json.createReader(
<span class="strong"><strong>            new StringReader(jsonStr))) {</strong></span>
<span class="strong"><strong>            jsonObject = jsonReader.readObject();</strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>        </strong></span>
<span class="strong"><strong>        customer.setFirstName(</strong></span>
<span class="strong"><strong>          jsonObject.getString("firstName"));</strong></span>
<span class="strong"><strong>        customer.setLastName(</strong></span>
<span class="strong"><strong>          jsonObject.getString("lastName"));</strong></span>
<span class="strong"><strong>        customer.setEmail(jsonObject.getString("email"));</strong></span>
        
        return "display_parsed_json";
    }

    //getters and setters omitted

}</pre></div><p>To parse an existing JSON string, we need to create a <code class="literal">StringReader</code> object, passing a <code class="literal">String</code> object containing the JSON data to be parsed as a parameter. We then pass the resulting <code class="literal">StringReader</code> instance to the static <code class="literal">createReader()</code> method<a id="id576" class="indexterm"/> of the <code class="literal">Json</code> class. This method invocation will return an instance of <code class="literal">JsonReader</code>. We can then obtain an instance of <code class="literal">JsonObject</code> by<a id="id577" class="indexterm"/> invoking the <code class="literal">readObject()</code> method<a id="id578" class="indexterm"/>.</p><p>In our example, we used the <code class="literal">getString()</code> method<a id="id579" class="indexterm"/> to obtain the values for all the properties in our JSON object; the first and only argument for this method is the name of the property we wish to<a id="id580" class="indexterm"/> retrieve. Unsurprisingly, the return value is the value of the property.</p><p>In addition to the <code class="literal">getString()</code> method<a id="id581" class="indexterm"/>, there are several other similar methods to obtain the values of other types. The following table summarizes these methods:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>JsonObject methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">get(Object key)</code><a id="id582" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id583" class="indexterm"/> returns an instance of a class implementing the <code class="literal">JsonValue</code> interface.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getBoolean(String name)</code><a id="id584" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id585" class="indexterm"/> returns a <code class="literal">boolean</code> value corresponding to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getInt(String name)</code><a id="id586" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id587" class="indexterm"/>returns an <code class="literal">int</code> value corresponding to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getJsonArray(String name)</code><a id="id588" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method returns <a id="id589" class="indexterm"/>the instance of a class implementing the <code class="literal">JsonArray</code> interface that corresponds to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getJsonNumber(String name)</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id590" class="indexterm"/> returns the instance of a class implementing the <code class="literal">JsonNumber</code> interface that corresponds to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getJsonObject(String name)</code><a id="id591" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id592" class="indexterm"/> returns the instance of a class implementing the <code class="literal">JsonObject</code> interface that corresponds to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getJsonString(String name)</code><a id="id593" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id594" class="indexterm"/> returns the instance of a class implementing the <code class="literal">JsonString</code> interface that corresponds to the given key.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getString(String Name)</code><a id="id595" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id596" class="indexterm"/>returns a <code class="literal">String</code> corresponding to the given key.</p>
</td></tr></tbody></table></div><p>In all cases, the <code class="literal">String</code> parameter of the method corresponds to the key name and the return value<a id="id597" class="indexterm"/> is the JSON <a id="id598" class="indexterm"/>property value that we wish to retrieve.</p></div></div></div>
<div class="section" title="The JSON-P Streaming API"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec41"/>The JSON-P Streaming API</h1></div></div></div><p>The JSON-P Streaming API allows the sequential reading of a JSON object from a stream (a subclass of <code class="literal">java.io.OutputStream</code>, or a subclass of <code class="literal">java.io.Writer</code>). It is faster and more memory efficient than the Model API. However, the tradeoff is that it is more limited, <a id="id599" class="indexterm"/>since the<a id="id600" class="indexterm"/> JSON data needs to be read sequentially and we cannot access specific JSON properties directly, the way the Model API allows.</p><div class="section" title="Generating JSON data with the Streaming API"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec52"/>Generating JSON data with the Streaming API</h2></div></div></div><p>The JSON Streaming API has a <code class="literal">JsonGenerator</code> class<a id="id601" class="indexterm"/> that we can use to generate JSON data and write it to a stream. This class has several overloaded <code class="literal">write()</code> methods which can be used to add <a id="id602" class="indexterm"/>properties and their corresponding values to the generated JSON data.</p><p>The following code sample<a id="id603" class="indexterm"/> illustrates how to generate JSON data using the Streaming API:</p><div class="informalexample"><pre class="programlisting">packagepackagenet.ensode.glassfishbook.jsonpstreaming;

//other imports omitted
import javax.json.Json;
import javax.json.stream.JsonGenerator;
import javax.json.stream.JsonParser;
import javax.json.stream.JsonParser.Event;

@Named
@SessionScoped
public class JsonpBean implements Serializable {

    private String jsonStr;

    @Inject
    private Customer customer;

    public String buildJson() {

StringWriterstringWriter = new StringWriter();
<span class="strong"><strong>try (JsonGeneratorjsonGenerator =</strong></span>

<span class="strong"><strong>Json.createGenerator(stringWriter)) {</strong></span>
<span class="strong"><strong>            jsonGenerator.writeStartObject().</strong></span>
<span class="strong"><strong>                    write("firstName", "Larry").</strong></span>
<span class="strong"><strong>                    write("lastName", "Gates").</strong></span>
<span class="strong"><strong>                    write("email", "lgates@example.com").</strong></span>
<span class="strong"><strong>                    writeEnd();</strong></span>
<span class="strong"><strong>        }</strong></span>
       
        setJsonStr(stringWriter.toString());

        return "display_json";

    }

    //getters and setters omitted

}</pre></div><p>We create an instance of <code class="literal">JsonGenerator</code> by invoking the <code class="literal">createGenerator()</code> static method of the <code class="literal">Json</code> class. The JSON-P Streaming API provides two overloaded versions of the <code class="literal">createGenerator()</code> method; one takes <a id="id604" class="indexterm"/>an instance of a class that extends <code class="literal">java.io.Writer</code> (such as <code class="literal">StringWriter</code>, which we used in our example), and the other <a id="id605" class="indexterm"/>takes an instance of a class that extends <code class="literal">java.io.OutputStream</code>.</p><p>Before we can start adding properties to the generated JSON stream, we need to invoke the <code class="literal">writeStartObject()</code> method<a id="id606" class="indexterm"/> on <code class="literal">JsonGenerator</code>. This method writes the JSON start object character (represented by an opening curly brace (<code class="literal">{</code>) in JSON strings) and returns another instance of <code class="literal">JsonGenerator</code>, allowing us to chain the <code class="literal">write()</code> invocations to add properties to our JSON stream.</p><p>The <code class="literal">write()</code> method<a id="id607" class="indexterm"/> in <code class="literal">JsonGenerator</code> allows us to add properties to the JSON stream that we generate. Its first parameter is a <code class="literal">String</code> corresponding to the name of the property we add, and the second parameter is the value of the property.</p><p>In our example, we are adding only the <code class="literal">String</code> values to the JSON stream that we create; however, we are not limited to <code class="literal">Strings</code>. The JSON-P Streaming API provides several overloaded <code class="literal">write()</code> methods that allow us to add several different types of data to our JSON stream. The following table summarizes all of the available versions of the <code class="literal">write()</code> method:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>JsonGenerator write() methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, BigDecimal value)</code><a id="id608" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id609" class="indexterm"/> writes a <code class="literal">BigDecimal</code> value to our JSON stream.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, BigInteger value)</code><a id="id610" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id611" class="indexterm"/>writes a <code class="literal">BigInteger</code> value to our JSON stream.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, JsonValue value)</code><a id="id612" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id613" class="indexterm"/>writes a JSON object to our JSON stream (the property values for JSON streams can be other JSON objects).</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, String value)</code><a id="id614" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id615" class="indexterm"/>writes a <code class="literal">String</code> value to our JSON stream.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, boolean value)</code><a id="id616" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id617" class="indexterm"/> writes a <code class="literal">boolean</code> value to our JSON stream.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, double value)</code><a id="id618" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id619" class="indexterm"/> writes a <code class="literal">double</code> value to our JSON stream.<a id="id620" class="indexterm"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, int value)</code><a id="id621" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method<a id="id622" class="indexterm"/> writes an <code class="literal">int</code> value to our JSON stream.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">write(String name, long value)</code><a id="id623" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id624" class="indexterm"/>writes a <code class="literal">long</code> value to our JSON stream.<a id="id625" class="indexterm"/>
</p>
</td></tr></tbody></table></div><p>In all cases, the first parameter of the <code class="literal">write()</code> method<a id="id626" class="indexterm"/> corresponds to the name of the property we are adding to our JSON stream, and the second parameter corresponds to the value of the property.</p><p>Once we are done adding properties to our JSON stream, we need to invoke the <code class="literal">writeEnd()</code> method<a id="id627" class="indexterm"/> on <code class="literal">JsonGenerator</code>; this method adds the JSON end object character (represented by a closing curly brace (<code class="literal">}</code>) in JSON strings).</p><p>At this point, our stream or reader is populated with the JSON data we generated; what we do with it depends on our application logic. In our example, we simply invoked the <code class="literal">toString()</code> method of our <code class="literal">StringReader</code> class<a id="id628" class="indexterm"/> to obtain the <code class="literal">String</code> representation of the JSON data we created.</p></div><div class="section" title="Parsing JSON data with the Streaming API"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec53"/>Parsing JSON data with the Streaming API</h2></div></div></div><p>In the last section, we saw how to generate JSON data from our Java code with the Streaming API. In this section, we <a id="id629" class="indexterm"/>will see how we can read and parse the existing JSON data we receive from a stream. The following code sample illustrates how to do this:</p><div class="informalexample"><pre class="programlisting">package net.ensode.glassfishbook.jsonpstreaming;

//other imports omitted
import javax.json.Json;
import javax.json.stream.JsonGenerator;
import javax.json.stream.JsonParser;
import javax.json.stream.JsonParser.Event;

@Named
@SessionScoped
public class JsonpBean implements Serializable {

    private String jsonStr;

    @Inject
    private Customer customer;

    public String parseJson() {

StringReaderstringReader = new StringReader(jsonStr);

<span class="strong"><strong>JsonParserjsonParser = Json.createParser(stringReader);</strong></span>

        Map&lt;String, String&gt; keyValueMap = new HashMap&lt;&gt;();
        String key = null;
        String value = null;

<span class="strong"><strong>        while (jsonParser.hasNext()) {</strong></span>
<span class="strong"><strong>            JsonParser.Event event = jsonParser.next();</strong></span>

<span class="strong"><strong>            if (event.equals(Event.KEY_NAME)) {</strong></span>
<span class="strong"><strong>                key = jsonParser.getString();</strong></span>
<span class="strong"><strong>            } else if (event.equals(Event.VALUE_STRING)) {</strong></span>
<span class="strong"><strong>                value = jsonParser.getString();</strong></span>
<span class="strong"><strong>            }</strong></span>

<span class="strong"><strong>            keyValueMap.put(key, value);</strong></span>
<span class="strong"><strong>        }</strong></span>

        customer.setFirstName(keyValueMap.get("firstName"));
        customer.setLastName(keyValueMap.get("lastName"));
        customer.setEmail(keyValueMap.get("email"));

        return "display_parsed_json";
    }

    //getters and setters omitted

}</pre></div><p>The first thing we need to do in order to read JSON data using the Streaming API is to create an instance of <code class="literal">JsonParser</code> by invoking the static <code class="literal">createJsonParser()</code> method<a id="id630" class="indexterm"/> on the <code class="literal">Json</code> class. There are two overloaded versions of the <code class="literal">createJsonParser()</code> method<a id="id631" class="indexterm"/>; one takes an instance<a id="id632" class="indexterm"/> of a class that extends <code class="literal">java.io.InputStream</code>, and the other takes an instance of a class that extends <code class="literal">java.io.Reader</code>. In our example, we use the latter by passing an instance of <code class="literal">java.io.StringReader</code>, which is a subclass of <code class="literal">java.io.Reader</code>.</p><p>The next step is to loop through the JSON data to obtain the data to be parsed. We can achieve this by invoking the <code class="literal">hasNext()</code> method<a id="id633" class="indexterm"/> on <code class="literal">JsonParser</code>, which returns <code class="literal">true</code> if there is more data to be read and returns <code class="literal">false</code> otherwise.</p><p>We then need to read the next piece of data in our stream. The <code class="literal">JsonParser.next()</code> method<a id="id634" class="indexterm"/> returns an instance of <code class="literal">JsonParser.Event</code> that indicates the type of data we just read. In our example, we check only for key names (that is, "<code class="literal">firstName</code>", "<code class="literal">lastName</code>", and "<code class="literal">email</code>") and the corresponding string values. We can check for the type of data we just read by comparing the event returned by <code class="literal">JsonParser.next()</code> against several values defined in the <code class="literal">Event</code> enum defined in <code class="literal">JsonParser</code>.</p><p>The following table summarizes all of the possible constants that can be returned by <code class="literal">JsonParser.next()</code>:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>JsonParser Event constants</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.START_OBJECT</code><a id="id635" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant<a id="id636" class="indexterm"/> indicates the start of a JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.END_OBJECT</code><a id="id637" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id638" class="indexterm"/> the end of a JSON object.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.START_ARRAY</code><a id="id639" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id640" class="indexterm"/> the start of an array</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.END_ARRAY</code><a id="id641" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id642" class="indexterm"/> the end of an array.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.KEY_NAME</code><a id="id643" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant<a id="id644" class="indexterm"/> indicates the name of a JSON property that was read. We can obtain the key name by invoking <code class="literal">getString()</code> on <code class="literal">JsonParser</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.VALUE_TRUE</code><a id="id645" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id646" class="indexterm"/> that a <code class="literal">boolean</code> value of <code class="literal">true</code> was read.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.VALUE_FALSE</code><a id="id647" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id648" class="indexterm"/> that a <code class="literal">boolean</code> value of <code class="literal">false</code> was read.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.VALUE_NULL</code><a id="id649" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates <a id="id650" class="indexterm"/>that a <code class="literal">null</code> value was read.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.VALUE_NUMBER</code><a id="id651" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id652" class="indexterm"/> that a numeric value was read.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">Event.VALUE_STRING</code><a id="id653" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This constant indicates<a id="id654" class="indexterm"/> that a<a id="id655" class="indexterm"/> string value was read.</p>
</td></tr></tbody></table></div><p>As shown in the example, the <code class="literal">String</code> values can be retrieved by invoking <code class="literal">getString()</code> on <code class="literal">JsonParser</code>. Numeric values can be retrieved in<a id="id656" class="indexterm"/> several different formats; the following table summarizes the methods in <code class="literal">JsonParser</code> that can be used to retrieve numeric values:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>JsonParser methods</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getInt()</code><a id="id657" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method <a id="id658" class="indexterm"/>retrieves the numeric value as <code class="literal">int</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getLong()</code><a id="id659" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method retrieves the numeric value as <code class="literal">long</code>.<a id="id660" class="indexterm"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">getBigDecimal()</code><a id="id661" class="indexterm"/>
</p>
</td><td style="text-align: left" valign="top">
<p>This method retrieves<a id="id662" class="indexterm"/> the numeric value as an instance of <code class="literal">java.math.BigDecimal</code>.</p>
</td></tr></tbody></table></div><p>
<code class="literal">JsonParser</code> also provides a convenience <code class="literal">isIntegralNumber()</code> method<a id="id663" class="indexterm"/> that returns <code class="literal">true</code> if the numeric value can be safely cast to an <code class="literal">int</code> or a <code class="literal">long</code> type.</p><p>What we do with the values we obtain from the stream depends on our application logic. In our example, we place them in <code class="literal">Map</code> and then use the said <code class="literal">Map</code> to populate a Java class.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec42"/>Summary</h1></div></div></div><p>In this chapter, we covered the Java API for JSON Processing (JSON-P). We covered both major JSON-P's APIs: the Model API and the Streaming API.</p><p>We illustrated how to generate JSON data via JSON-P's Model API, specifically the <code class="literal">JsonBuilder</code> class. We also covered how to parse JSON data via JSON-P's Model API via the <code class="literal">JsonReader</code> class.</p><p>Additionally, we explained how to generate JSON data via JSON-P's Streaming API by employing the <code class="literal">JsonGenerator</code> class.</p><p>Lastly, we covered how to parse JSON data via JSON-P's Streaming API, specifically via the <code class="literal">JsonParser</code> class.</p><p>In the next chapter, we will cover the Java API for WebSocket.</p></div></body></html>