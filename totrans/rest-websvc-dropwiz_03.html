<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Configuring the Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Configuring the Application</h1></div></div></div><p>Up until this point, we have created a simple template for a Dropwizard application. What our application does is print a message to the terminal during startup.</p><p>Generally, every modern application depends on a number of configuration settings that define the way it runs. For instance, once our application grows and needs to interact with a database, we should somehow use (at least) a username and password to establish a database connection. Of course, we can hardcode these settings inside the application, but that's not efficient, as even a small change would require rebuilding it. The appropriate way of storing such or similar information is by using an external configuration file.</p><div class="section" title="Externalizing the application's configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec13"/>Externalizing the application's configuration</h1></div></div></div><p>Using a<a id="id40" class="indexterm"/> configuration file requires the appropriate application logic to load and parse it. Luckily, Dropwizard has built-in functionality that we will use in order to externalize our application's configuration.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec18"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new YAML file named <code class="literal">config.yaml</code> in the same directory as the <code class="literal">pom.xml</code> file. This will be the configuration file of our application. We will add two configuration parameters: the message to be printed on startup and how many times to print it. In order to do so, add the following code to <code class="literal">config.yaml</code>:<div class="informalexample"><pre class="programlisting">message: This is a message defined in the configuration file config.yaml.
messageRepetitions: 3</pre></div></li><li class="listitem">Now we have a configuration file, but we need to parse it. Let's create a new class in the <code class="literal">com.dwbook.phonebook</code> package named <code class="literal">PhonebookConfiguration</code> by adding the following code:<div class="informalexample"><pre class="programlisting">package com.dwbook.phonebook;

import com.fasterxml.jackson.annotation.JsonProperty;
import io.dropwizard.Configuration;

public class PhonebookConfiguration extends Configuration {
  @JsonProperty
  private String message;

  @JsonProperty
  private int messageRepetitions;

  public String getMessage() {
    return message;
  }

  public int getMessageRepetitions() {
    return messageRepetitions;
  }
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>As you can see, it is a simple class, with two member properties named after our configuration settings along with their getter methods.</p></div></div></li><li class="listitem">To<a id="id41" class="indexterm"/> use this class as our configuration proxy, modify the declaration of our main <code class="literal">App</code> class to extend the <code class="literal">Application&lt;PhonebookConfiguration&gt;</code> class instead of <code class="literal">Application&lt;Configuration&gt;</code>:<div class="informalexample"><pre class="programlisting">public class App extends Application&lt;PhonebookConfiguration&gt; {</pre></div></li><li class="listitem">Similarly, update <code class="literal">configuration</code> to <code class="literal">PhonebookConfiguration</code> in the declaration<a id="id42" class="indexterm"/> of the <code class="literal">App#initialize()</code> method:<div class="informalexample"><pre class="programlisting">@Override

public void initialize(Bootstrap&lt;PhonebookConfiguration&gt; b) {}</pre></div></li><li class="listitem">The <code class="literal">App#run()</code> method <a id="id43" class="indexterm"/>will require the same modification in its definition, but we'll also modify this method further so it retrieves the message to print from the configuration class:<div class="informalexample"><pre class="programlisting">public void run(PhonebookConfiguration c, Environment e)
     throws Exception {
    LOGGER.info("Method App#run() called");
    for (int i=0; i &lt; c.getMessageRepetitions(); i++) {
      System.out.println(c.getMessage());
  }
}</pre></div></li><li class="listitem">Package (<code class="literal">mvn package</code>) and run the application and specify the configuration file as well:<div class="informalexample"><pre class="programlisting">$ java -jar target/dwbook-phonebook-1.0-SNAPSHOT.jar server config.yaml</pre></div><p>You will see the message printed three times in your terminal during the application's startup, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/9530OS_03_01.jpg" alt="How to do it…"/></div></li></ol></div><p>Apart<a id="id44" class="indexterm"/> from this, and as in the previous example, you will also see an exception stating that no resource classes could be located (the <code class="literal">ResourceConfig</code> instance does not contain any root resource classes). This is because we do not have any REST resources registered in our application yet. We will deal with this in the following chapter.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec19"/>How it works…</h2></div></div></div><p>You should see that our configuration file is automatically parsed. In fact, the <code class="literal">PhonebookConfiguration</code> class is instantiated with the values specified in the configuration file.</p><p>When a configuration file is passed as a command-line argument, Dropwizard parses it and creates an instance of your service's configuration class. We added the required configuration parameters as private members of the <code class="literal">PhonebookConfiguration</code> class and annotated them with <code class="literal">@JsonProperty</code> so Dropwizard can parse them. In order to make these properties accessible to our application's service class, we also need to add public getters for these parameters.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec20"/>There's more…</h2></div></div></div><p>Externalizing your application's configuration has many advantages. With Dropwizard, you can easily store and read any kind of properties (configuration settings) you wish to have for your application with minimum effort, just by mapping YAML properties to the properties of your configuration class.</p><div class="section" title="Dropwizard's configuration parameters"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec07"/>Dropwizard's configuration parameters</h3></div></div></div><p>Dropwizard has plenty of configuration parameters available, such as the port that the embedded Jetty listens to and the logging level. The list is quite large and cannot be covered<a id="id45" class="indexterm"/> here extensively, though it is available on the official Dropwizard website at <a class="ulink" href="http://www.dropwizard.io/manual/core/#configuration-defaults">http://www.dropwizard.io/manual/core/#configuration-defaults</a>.</p></div><div class="section" title="YAML"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec08"/>YAML</h3></div></div></div><p>The<a id="id46" class="indexterm"/> description of YAML according to its official<a id="id47" class="indexterm"/> website (<a class="ulink" href="http://www.yaml.org">http://www.yaml.org</a>) is human-friendly data serialization standard. Its syntax is pretty straightforward, which is also the reason why YAML is widely accepted. YAML files are identified by the extensions <code class="literal">.yaml</code> and <code class="literal">.yml</code>; both are valid, although <code class="literal">.yml</code> seems to be more popular lately.</p></div></div></div></div>
<div class="section" title="Validating configuration settings"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec14"/>Validating configuration settings</h1></div></div></div><p>Although<a id="id48" class="indexterm"/> it is good to have the application's configuration externalized, we should not always rely on it as is. Dropwizard has got us covered, and we have the right tools in order to validate the configuration properties up on the application's startup. This is because we can use constraint annotations for our configuration properties, such as those included in the <code class="literal">javax.validation.constraints</code> or <code class="literal">org.hibernate.validator.constraints</code> packages.</p><p>We are going to limit the number of repetitions of the message to 10; if the number provided is larger than 10, then the input is considered invalid.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec21"/>How to do it…</h2></div></div></div><p>Let's go through the following steps required for validating the configuration settings:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update<a id="id49" class="indexterm"/> the definition of the <code class="literal">messageRepetitions</code> property in <code class="literal">PhonebookConfiguration</code>, annotating the property<a id="id50" class="indexterm"/> with the <code class="literal">@Max</code> annotation (you will also need to import <code class="literal">javax.validation.constraints.Max</code>):<div class="informalexample"><pre class="programlisting">@JsonProperty
@Max(10)
private int messageRepetitions;</pre></div></li><li class="listitem">In a similar way, define that the <code class="literal">message</code> property should not be empty, annotating<a id="id51" class="indexterm"/> the property with the <code class="literal">@NotEmpty (org.hibernate.validator.constraints.NotEmpty)</code> annotation:<div class="informalexample"><pre class="programlisting">@JsonProperty
@NotEmpty
private String message;</pre></div></li><li class="listitem">Edit<a id="id52" class="indexterm"/> the <code class="literal">Config.yaml</code> file and specify a value greater than 10 for the <code class="literal">messageRepetitions</code> property.</li><li class="listitem">Repackage and run the application again. The application will refuse to start, and you will see an error printed on your terminal as seen in the following screenshot:<div class="mediaobject"><img src="graphics/9530OS_03_02.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec22"/>How it works…</h2></div></div></div><p>The <a id="id53" class="indexterm"/>validation-related annotations force Dropwizard to validate the values of each of the properties declared in our configuration file. If the validation constraints are not satisfied, the relevant error message will be printed on the terminal, and the application will not start.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec23"/>There's more…</h2></div></div></div><p>Now you have a working configuration file that is mapped on the configuration object during the startup of the application. Also, as well as checking the validity of the configuration parameters, you can also provide a default value for each one of them.</p><div class="section" title="Specifying default parameters"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec09"/>Specifying default parameters</h3></div></div></div><p>You can <a id="id54" class="indexterm"/>specify the default values for configuration parameters as easily as initializing the variables on their declaration. This way, optional parameters can be omitted and can have a default value during runtime, even if they're not included in the application's configuration file.</p><p>Let's add an additional parameter, which we'll also initialize, named <code class="literal">additionalMessage,</code> along with its getter method:</p><div class="informalexample"><pre class="programlisting">@JsonProperty
private String additionalMessage = "This is optional";
public String getAdditionalMessage() {
  return additionalMessage;
}</pre></div><p>If you run the<a id="id55" class="indexterm"/> application specifying a configuration file that does not contain the <code class="literal">additionalMessage</code> property, then the default<a id="id56" class="indexterm"/> value of this property will be returned when you<a id="id57" class="indexterm"/> try to access it from another part of the code, for instance, if you use <code class="literal">c.getAdditionalMessage()</code> from inside the <code class="literal">App#run()</code> method<a id="id58" class="indexterm"/>. This way, you can have optional parameters for your application.</p></div></div></div></body></html>