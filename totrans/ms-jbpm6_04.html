<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Operation Management"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Operation Management</h1></div></div></div><p>This chapter will illustrate all the tasks that are required to perform jBPM operations by walking you through the following topics (focusing on the jBPM KIE workbench and related tools):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">jBPM environment configuration: Git and Maven repositories, organizational units, and user<a id="id304" class="indexterm"/> management with basic administration and permissions by <span class="strong"><strong>role-based access control</strong></span> (<span class="strong"><strong>RBAC</strong></span>)</li><li class="listitem" style="list-style-type: disc">New jBPM asset management feature and module deployment</li><li class="listitem" style="list-style-type: disc">Process and task management</li><li class="listitem" style="list-style-type: disc">jBPM auditing and history log analysis with a working example of BAM</li><li class="listitem" style="list-style-type: disc">Job and command scheduling with jBPM Executor</li></ul></div><p>This chapter requires a working knowledge of both Git and Maven, which play a central role in the KIE workbench architecture. You will be asked to work with Git and to deploy artifacts to Maven. Let us start by reviewing the typical software architecture of a jBPM 6.2 development system with the aim to shed some light on the new system components and the way they interact.</p><div class="section" title="An overview of the KIE workbench, Git, and Maven"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec23"/>An overview of the KIE workbench, Git, and Maven</h1></div></div></div><p>At first, the jBPM 6.2 architecture may seem a bit hard to grasp, since several new components have<a id="id305" class="indexterm"/> been integrated to provide the developers with industry standard<a id="id306" class="indexterm"/> tools for making it easier to support source code <a id="id307" class="indexterm"/>management and building/deployment. The jBPM platform integrates with the Git and Maven repositories so that you can share Kie business assets and publish Kie modules to remote teams. Let us see how Git and Maven fit into the Kie platform (shown in the following image).</p><p> </p><div class="mediaobject"><img src="graphics/9578OS_04_14.jpg" alt="An overview of the KIE workbench, Git, and Maven"/></div><p>
</p><p>The KIE workbench manages assets from its Kie Git repositories (either brand new or cloned from remote repositories). All Kie Git repositories can be found in the <code class="literal">.niogit</code> folder. The Kie deployment process installs the modules into the Kie Maven repository (located in the <code class="literal">repositories/kie</code> folder). This repository is publicly accessible via either the Git or the SSH protocol.</p><div class="section" title="Working with Git"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Working with Git</h2></div></div></div><p>The KIE workbench<a id="id308" class="indexterm"/> enables us to create a new empty Git bare repository or to clone a remote Git repository into a brand new Kie bare repository. However, the workbench does not allow us to import assets into an existing branch of a Kie repository.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>"Bare" repositories exist in Git as a way of having a central (mainly remote) repository that a number of people can push to. For details on the bare Git repository, please see the official Git documentation.</p></div></div><p>We can manage repositories from the <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Administration</strong></span> menu (<span class="strong"><strong>Repository</strong></span> item). Let us now put Kie repositories to work.</p><div class="section" title="Cloning a remote repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec27"/>Cloning a remote repository</h3></div></div></div><p>We are going<a id="id309" class="indexterm"/> to clone the <code class="literal">chapter 4-pizza</code> example repository from GitHub. It hosts two projects that we will use later in the chapter to experiment with the deployment process. To clone a remote repository, open the <span class="strong"><strong>Repositories</strong></span> | <span class="strong"><strong>Clone Repository</strong></span> dialog (see the following screenshot) and configure the parameters as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Repository Name</strong></span>: <code class="literal">chapter4-pizza</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Organizational Unit</strong></span>: Use the default provided by jBPM or create a new one (This is not relevant at this stage; let us set its value to <code class="literal">demo</code>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Git URL</strong></span>: <code class="literal">https://github.com/masteringjbpm6/chapter4-pizza.git</code><p> </p><div class="mediaobject"><img src="graphics/9578OS_04_12.jpg" alt="Cloning a remote repository"/></div><p>
</p></li></ul></div><p>We have already said that both cloned and new repositories are placed in the <code class="literal">.niogit</code> folder that you can find in the KIE installation folder. In addition, all KIE repositories are shared by default <a id="id310" class="indexterm"/>at the following URL:</p><p>
<code class="literal">git://localhost:9418/{reposname}</code> or <code class="literal">ssh://localhost:8001/{reposname}</code>
</p><p>where <code class="literal">{reposname}</code> is the <span class="strong"><strong>Repository Name</strong></span> that you provided in the dialog window (for example, <code class="literal">chapter4-pizza</code>).</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Never clone repositories from the KIE <code class="literal">.niogit</code> folder directly; always use the repository URL.</p></div></div><p>The <code class="literal">.niogit</code> folder also contains the <code class="literal">system.git</code> Kie repository, which is used as a store for metadata and settings; we will look at it in an upcoming section.</p></div><div class="section" title="Making changes and committing"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec28"/>Making changes and committing</h3></div></div></div><p>Modifying the<a id="id311" class="indexterm"/> project assets from the KIE workbench means that your changes are<a id="id312" class="indexterm"/> going to be committed into the KIE Git repository. Let us edit the jBPM process definition and see what happens upon saving the asset. Open the <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Project Authoring</strong></span> menu (<span class="strong"><strong>Project Explorer</strong></span>) and change the path to <code class="literal">demo/chapter4-pizza/pizzadelivery</code>; you should have the <span class="strong"><strong>pizzadelivery</strong></span> process listed under the <span class="strong"><strong>Business Processes</strong></span> group (see the following screenshot).</p><div class="mediaobject"><img src="graphics/9578OS_04_13.jpg" alt="Making changes and committing"/></div><p>Just drag and move, for instance, the process start node, and then, select the <span class="strong"><strong>Save</strong></span> menu item. The system prompts you with a <span class="strong"><strong>Commit</strong></span> comment; enter <code class="literal">workbench editing</code> and press <span class="strong"><strong>OK</strong></span>. Now, if we<a id="id313" class="indexterm"/> go and check the <code class="literal">.niogit/chapter4-pizza.git</code> repository and issue the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git log</strong></span>
</pre></div><p>We can see the following two commits (the older commit was the one performed during the GitHub repository initial creation, and the other is your last commit):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>commit 165a0b07f1b50962696640bcb79072458f4c82d4</strong></span>
<span class="strong"><strong>Author: admin &lt;&gt;</strong></span>
<span class="strong"><strong>Date:   Sun Mar 22 11:33:16 2015 +0100</strong></span>
<span class="strong"><strong>    workbench editing {/pizzadelivery/src/main/resources/pizzadelivery.bpmn2}</strong></span>
<span class="strong"><strong>commit a32f9a2a9bc835e74abcb78348878d8d2fc96140</strong></span>
<span class="strong"><strong>Author: admin &lt;fiorini.s@gmail.com&gt;</strong></span>
<span class="strong"><strong>Date:   Mon Mar 23 07:48:50 2015 +0100</strong></span>
<span class="strong"><strong>    pizza commit</strong></span>
</pre></div><p>We can get the first commit files by specifying the commit ID:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git show --name-status -r a32f9a2a9bc835e74abcb78348878d8d2fc96140</strong></span>
<span class="strong"><strong>Date:   Mon Mar 23 07:48:50 2015 +0100</strong></span>
<span class="strong"><strong>    pizza commit</strong></span>
<span class="strong"><strong>A       pizzadelivery/.classpath</strong></span>
<span class="strong"><strong>A       pizzadelivery/.project</strong></span>
<span class="strong"><strong>A       pizzadelivery/.settings/org.eclipse.bpmn2.modeler.core.prefs</strong></span>
</pre></div></div><div class="section" title="Pushing to the remote repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec29"/>Pushing to the remote repository</h3></div></div></div><p>Let us now<a id="id314" class="indexterm"/> check the remote origin setting for our <code class="literal">chapter4</code> repository first by using the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git remote -v</strong></span>
</pre></div><p>The following information is printed:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>origin  https://github.com/masteringjbpm6/chapter4-pizza.git (fetch)</strong></span>
<span class="strong"><strong>origin  https://github.com/masteringjbpm6/chapter4-pizza.git (push)</strong></span>
</pre></div><p>In order to update the remote origin GitHub branch (master), we issue the following push:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git push origin master</strong></span>
</pre></div><p>Since the repository is protected, you will be prompted for the repository username and password (we are using our account here):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Username for 'https://github.com': masteringjbpm6</strong></span>
<span class="strong"><strong>Password for 'https://masteringjbpm6@github.com': *****</strong></span>
</pre></div><p>Removed for clarity…</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>To https://github.com/masteringjbpm6/chapter4-pizza.git</strong></span>
<span class="strong"><strong>79bcf3a..36b57c1  master -&gt; master</strong></span>
</pre></div><p>The remote<a id="id315" class="indexterm"/> branch is finally updated.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>For fixes and enhancements, we encourage you to contribute to our example GitHub repository; in case you want to experiment with the example projects on your own, please follow the next section.</p></div></div></div><div class="section" title="New repository"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec30"/>New repository</h3></div></div></div><p>By cloning our GitHub repository into a KIE repository, you cannot (as you are not a contributor) send changes upstream. Apart from forking on GitHub, creating a new empty Kie repository is the<a id="id316" class="indexterm"/> right choice if you want KIE to centrally manage your projects. To do so, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new KIE Git repository; remember to leave the <span class="strong"><strong>Managed Repository</strong></span> option unchecked for the moment, since this turns your repository into a Maven aware repository making it hard to adjust it when projects are added from an external source (we are going to address it in the <span class="emphasis"><em>Asset management example</em></span> paragraph).</li><li class="listitem">Clone the remote GitHub repository from the command line, using your preferred Git client.</li><li class="listitem">Change your Git working copy remote origin to the new Kie repository.</li><li class="listitem">Commit and push to the Kie repository <code class="literal">master</code> branch.</li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>Please see the <span class="emphasis"><em>Git cloning and managed repository</em></span> section for a complete example of repository creation and project setup from GitHub.</p></div></div><p>jBPM 6.2 introduces a distinction between the plain Git repository (unmanaged) and a new kind of "smart" repository (managed) that we can create by setting the <span class="strong"><strong>Managed Repository</strong></span> option in the <span class="strong"><strong>New Repository</strong></span> dialog window.</p></div><div class="section" title="Managing assets – managed repositories"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec31"/>Managing assets – managed repositories</h3></div></div></div><p>As we have seen, managing<a id="id317" class="indexterm"/> Git project sources and Maven with KIE might be challenging: cloning, committing, setting repository remotes, pushing upstream, and so on, and we did not even consider Git branching in our example. jBPM 6.2 simplifies the<a id="id318" class="indexterm"/> way repositories and project source code are managed by introducing a new feature (asset management) designed to drive the development, build, and release processes thanks to a set of jBPM workflow processes, which kick in at various stages. Managed repositories, in short, provide project Maven version control and Git branch management.</p><div class="section" title="Governance workflow"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec04"/>Governance workflow</h4></div></div></div><p>The asset management workflows are not fully automatic; they also require a managing actor (who must be in the <code class="literal">kiemgmt</code> role; see the KIE workbench <code class="literal">roles.properties</code> file) to complete specific<a id="id319" class="indexterm"/> tasks in order to make the workflow progress (selecting assets to release and/or review) or present the user with informative data (such as error data). The workflows trigger only when the following pre-defined<a id="id320" class="indexterm"/> operations take place (remember, this only applies to managed repositories):</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Repository creation or configuration</strong></span>: After the Git repository is created or when the repository <span class="strong"><strong>Configure</strong></span> button is selected, the workflow can automatically <a id="id321" class="indexterm"/>add a <code class="literal">dev</code> branch and a <code class="literal">release</code> branch for you (the <code class="literal">master</code> branch is always the default one).</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Asset promotion</strong></span>: When a user thinks that his/her assets are ready to be released, he/she can <a id="id322" class="indexterm"/>submit them for a so-called<a id="id323" class="indexterm"/> <span class="strong"><strong>promotion</strong></span> by selecting the <span class="strong"><strong>Promote</strong></span> button. The promotion requires the managing user to select (Git cherry picking) and approve the submitted changes by promoting them to the Git release branch, or to delay the process for a later review.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Project build</strong></span>: The <a id="id324" class="indexterm"/>user performs <span class="strong"><strong>Build</strong></span>, selecting a specific repository branch. The build involves the compiling and installing of the project as a Maven module into the internal Kie repository.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Release</strong></span>: The user <a id="id325" class="indexterm"/>performs <span class="strong"><strong>Release</strong></span>. The release feature involves the building and deploying processes at the repository level. All of your repository projects are built and then, published to the Kie runtime (the <span class="strong"><strong>Deploy To Runtime</strong></span> option) so that business assets can be used. We<a id="id326" class="indexterm"/> can only release from branches starting with the<a id="id327" class="indexterm"/> <span class="strong"><strong>release</strong></span> label (for example, release-1.0.1).</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Please check Chapter 9 of the jBPM 6.2 User Guide for additional details on asset management<a id="id328" class="indexterm"/> workflows.</p></div></div></div><div class="section" title="Git cloning and managed repository"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec05"/>Git cloning and managed repository</h4></div></div></div><p>jBPM 6.2 does not<a id="id329" class="indexterm"/> support importing into a managed repository; the naïve solution mimics what we have seen in the (unmanaged) <span class="emphasis"><em>New repository</em></span> paragraph with slight variations; let us see how to import our GitHub <code class="literal">chapter4-managed</code> repository projects:</p><p>Let us create a<a id="id330" class="indexterm"/> multi-module repository; the settings for each step are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><span class="strong"><strong>Repository Name</strong></span>: <code class="literal">ManagedVesuvio</code>, and <span class="strong"><strong>Organizational Unit</strong></span>: <code class="literal">demo</code> (not relevant now).</li><li class="listitem"><span class="strong"><strong>Multi-project Repository</strong></span> (checked), <span class="strong"><strong>Automatically Configure Branches</strong></span> (checked), and <span class="strong"><strong>Project Settings</strong></span> (leave defaults).<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>In Step 2, the specified Maven GAV will be the Maven parent module GAV <code class="literal">(demo:ManagedVesuvio:1.0.0-SNAPSHOT)</code>. Two additional branches are created: <code class="literal">dev-1.0.0</code> and <code class="literal">release-1.0.0</code>. If we were not selecting automatic branch management, only the default <code class="literal">master</code> branch would be available and the repository could not be released as a whole (see the <span class="emphasis"><em>Releasing</em></span> section for additional hints).</p></div></div></li><li class="listitem">Clone the <code class="literal">chapter4-managed</code> example projects:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git clone https://github.com/masteringjbpm6/chapter4-managed.git</strong></span>
</pre></div></li><li class="listitem">Add a new remote named <code class="literal">kievesuvio</code> (or if you prefer, replace the origin):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git remote add kievesuvio ssh://admin@localhost:8001/ManagedVesuvio</strong></span>
</pre></div></li><li class="listitem">Change into the <code class="literal">chapter4-managed</code> folder, and add the files and commit:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git add .</strong></span>
<span class="strong"><strong>git commit -m "first Kie managed commit"</strong></span>
</pre></div></li><li class="listitem">Get updates from the <code class="literal">master</code> branch and push to the KIE <code class="literal">ManagedVesuvio</code> <code class="literal">dev-1.0.0</code> branch:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git pull kievesuvio master</strong></span>
<span class="strong"><strong>git push kievesuvio master:dev-1.0.0</strong></span>
</pre></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">At this stage, the <code class="literal">dev-1.0.0</code> branch is updated, but our <code class="literal">ManagedVesuvio</code> repository <a id="id331" class="indexterm"/>structure is not aware of the branch changes while the KIE Project <span class="strong"><strong>Explorer</strong></span> is. This is due to the fact that the repository structure shows the Maven multi-module configuration (more details in the <span class="emphasis"><em>Managed repository and Maven</em></span> section) and that its <code class="literal">pom.xml</code> file is stale. We have to add the <code class="literal">napoli</code> and <code class="literal">vesuvio</code> projects manually to it.</li></ol></div></li><li class="listitem">In File Explorer (<span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Administration</strong></span>), click on <code class="literal">pom.xml</code> and add the <code class="literal">&lt;modules&gt;</code> element as follows:<div class="informalexample"><pre class="programlisting">&lt;modules&gt;
  &lt;module&gt;napoli&lt;/module&gt;
  &lt;module&gt;vesuvio&lt;/module&gt;
&lt;/modules&gt;</pre></div></li></ol></div><p>After saving the file, KIE should pick up the projects and the repository structure should display our modules.</p><div class="mediaobject"><img src="graphics/9578OS_04_20.jpg" alt="Git cloning and managed repository"/></div><p>The repository is now properly configured, and we are ready to tackle the asset management features.</p></div><div class="section" title="Asset management example"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec06"/>Asset management example</h4></div></div></div><p>The <code class="literal">napoli</code> and <code class="literal">vesuvio</code> projects each contain a basic process definition. The <code class="literal">napoli</code> process (<code class="literal">napoli.bpmn2</code>) includes the <code class="literal">vesuvio</code> process (<code class="literal">vesuvio.bpmn2</code>) as a reusable sub-process (more on BPMN2 elements in <a class="link" href="ch05.html" title="Chapter 5. BPMN Constructs">Chapter 5</a>, <span class="emphasis"><em>BPMN Constructs</em></span>). The users perform <a id="id332" class="indexterm"/>asset management tasks by selecting the appropriate button in the <span class="strong"><strong>Repository</strong></span> | <span class="strong"><strong>Repository Structure</strong></span> view (see the following screenshot) and by<a id="id333" class="indexterm"/> completing human tasks in the <span class="strong"><strong>Task</strong></span> | <span class="strong"><strong>Task List</strong></span> window.</p><div class="mediaobject"><img src="graphics/9578OS_04_17.jpg" alt="Asset management example"/></div><p>The asset management tasks are assigned to users owning the <code class="literal">kiemgmt</code> role only; therefore, ensure that you log into the KIE workbench with the <code class="literal">admin</code> user since this is the only preset user owning this role.</p><div class="section" title="Promoting assets"><div class="titlepage"><div><div><h5 class="title"><a id="ch04lvl5sec01"/>Promoting assets</h5></div></div></div><p>We submit the assets (the napoli and vesuvio modules) for promotion to the release branch:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select<a id="id334" class="indexterm"/> <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Authoring and Repository</strong></span> | <span class="strong"><strong>Repository Structure</strong></span>; select the <span class="strong"><strong>Promote</strong></span> button and enter the target branch: <code class="literal">release-1.0.0</code>.</li><li class="listitem">In the <span class="strong"><strong>Tasks</strong></span> | <span class="strong"><strong>Task List</strong></span> window, you should now be assigned a <span class="strong"><strong>Select Assets to Promote</strong></span> task; click on it, <span class="strong"><strong>Claim</strong></span> the task, <span class="strong"><strong>Promote All</strong></span> assets, and <span class="strong"><strong>Complete</strong></span> the task as shown in the following screenshot:<div class="mediaobject"><img src="graphics/9578OS_04_21.jpg" alt="Promoting assets"/></div></li><li class="listitem">Head back to <span class="strong"><strong>Repository Structure</strong></span>, and by selecting the <code class="literal">release-1.0.0</code> branch, you should see the two promoted projects.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note18"/>Note</h3><p>Assets are now merged into the Git repository <code class="literal">release-1.0.0</code> branch.</p></div></div></li></ol></div></div><div class="section" title="Releasing"><div class="titlepage"><div><div><h5 class="title"><a id="ch04lvl5sec02"/>Releasing</h5></div></div></div><p>In <span class="strong"><strong>Repository Structure</strong></span>, select the <code class="literal">release-1.0.0</code> branch and press the <span class="strong"><strong>Release</strong></span> button. Optionally, bump the<a id="id335" class="indexterm"/> Release Version for the module, toggle <span class="strong"><strong>Deploy to Runtime</strong></span> (user: <code class="literal">admin</code>, password: <code class="literal">admin</code>, Server URL: <code class="literal">default</code>), and then proceed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note19"/>Note</h3><p>
<code class="literal">napoli</code> and <code class="literal">vesuvio</code> are now installed into the KIE Maven repository, and you can find them among your <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Artifact Repository</strong></span> artifacts. In case you selected <span class="strong"><strong>Deploy to Runtime</strong></span>, the contained process definitions would be made available in <span class="strong"><strong>Process Management</strong></span> | <span class="strong"><strong>Process Definitions</strong></span>.</p></div></div></div><div class="section" title="Building (single project)"><div class="titlepage"><div><div><h5 class="title"><a id="ch04lvl5sec03"/>Building (single project)</h5></div></div></div><p>The release<a id="id336" class="indexterm"/> process always runs through a build process for all the managed repository projects; the build/release process can also be performed, for all kind of repositories (managed/unmanaged), on the single project by the <span class="strong"><strong>Build</strong></span> menu:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Build &amp; Install</strong></span>: Deploy<a id="id337" class="indexterm"/> the artifact to the Kie repository and the system Maven repository (if any)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Build &amp; Deploy</strong></span>: Perform<a id="id338" class="indexterm"/> the install step (see previously), and then, deploy the module to the Kie runtime: business artifacts are available for runtime usage</li><li class="listitem" style="list-style-type: disc">We will discuss more on deployments in the <span class="emphasis"><em>KIE deployments </em></span>section</li></ul></div></div></div><div class="section" title="Asset versioning history"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec07"/>Asset versioning history</h4></div></div></div><p>All Git versioning<a id="id339" class="indexterm"/> information for the assets is available in the <span class="strong"><strong>Overview</strong></span> tab. For instance, by clicking on the <span class="strong"><strong>napoli</strong></span> process, we can see all the commit logs and we can load the previous Git versions for the assets with the <span class="strong"><strong>Select</strong></span> and <span class="strong"><strong>Current</strong></span> buttons (see the following screenshot; the comments may vary).</p><div class="mediaobject"><img src="graphics/9578OS_04_18.jpg" alt="Asset versioning history"/></div></div><div class="section" title="Managed repository and Maven"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec08"/>Managed repository and Maven</h4></div></div></div><p>The managed Git repositories<a id="id340" class="indexterm"/> are themselves stored as Maven modules in the <code class="literal">repositories/kie</code> repository. They can be Single Project or <a id="id341" class="indexterm"/>Multi-Project repositories; this affects the way that the Mavenized Kie projects are configured.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Single Project repository contains a single Kie Maven project</li><li class="listitem" style="list-style-type: disc">The Multi-Project repository contains a Maven multi-module project</li></ul></div><p>The parent module <code class="literal">pom.xml</code> file shows that it is a <code class="literal">pom</code> (multi) module containing the <code class="literal">napoli</code> and <code class="literal">vesuvio</code> modules:</p><div class="informalexample"><pre class="programlisting">&lt;groupId&gt;packt&lt;/groupId&gt;
&lt;artifactId&gt;ManagedVesuvio&lt;/artifactId&gt;
&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
<span class="strong"><strong>&lt;packaging&gt;pom&lt;/packaging&gt;</strong></span>
&lt;name&gt;ManagedVesuvio&lt;/name&gt;
<span class="strong"><strong>&lt;modules&gt;</strong></span>
<span class="strong"><strong>  &lt;module&gt;napoli&lt;/module&gt;</strong></span>
<span class="strong"><strong>  &lt;module&gt;vesuvio&lt;/module&gt;</strong></span>
<span class="strong"><strong>&lt;/modules&gt;</strong></span>
</pre></div><p>The <code class="literal">napoli</code> module <code class="literal">pom.xml</code> file shows that it depends on the <code class="literal">vesuvio</code> module:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;parent&gt;</strong></span>
<span class="strong"><strong>  &lt;groupId&gt;packt&lt;/groupId&gt;</strong></span>
<span class="strong"><strong>  &lt;artifactId&gt;ManagedVesuvio&lt;/artifactId&gt;</strong></span>
<span class="strong"><strong>  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;</strong></span>
<span class="strong"><strong>&lt;/parent&gt;</strong></span>
&lt;groupId&gt;packt&lt;/groupId&gt;
&lt;artifactId&gt;napoli&lt;/artifactId&gt;
&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
&lt;name&gt;napoli&lt;/name&gt; 
&lt;dependencies&gt;
  <span class="strong"><strong>&lt;dependency&gt;</strong></span>
<span class="strong"><strong>    &lt;groupId&gt;packt&lt;/groupId&gt;</strong></span>
<span class="strong"><strong>    &lt;artifactId&gt;vesuvio&lt;/artifactId&gt;</strong></span>
<span class="strong"><strong>    &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;</strong></span>
<span class="strong"><strong>  &lt;/dependency&gt;</strong></span>
&lt;/dependencies&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>Please refer to <a class="ulink" href="http://maven.apache.org/guides/mini/guide-multiple-modules.html">http://maven.apache.org/guides/mini/guide-multiple-modules.html</a> for an<a id="id342" class="indexterm"/> introduction to Maven multi-module management.</p></div></div></div><div class="section" title="Governance process definitions"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec09"/>Governance process definitions</h4></div></div></div><p>The jBPM asset management <a id="id343" class="indexterm"/>process definitions and their related business logic can be found in the Drools project called <code class="literal">guvnor-asset-mgmt</code>. This module is pre-deployed and is loaded by the KIE workbench; it is regularly listed in <span class="strong"><strong>Artifact Repository</strong></span>, and you can find its process definitions in the <span class="strong"><strong>Deployments</strong></span> | <span class="strong"><strong>Process Deployments</strong></span> window and their running instances in the <span class="strong"><strong>Process Instances</strong></span> window.</p></div></div><div class="section" title="A final note"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec32"/>A final note</h3></div></div></div><p>The KIE workbench project editor only lets you edit, build, and release the proper Kie modules and not <a id="id344" class="indexterm"/>plain Maven modules (which lack the <code class="literal">kmodule.xml</code> file). So, if you only have a single Kie module, it does not make much sense to clone a bunch of modules into a Kie multi-project managed repository; try to design your repository content with a grain of salt so that your Kie runtime and development environment is always clean and healthy. Now, instead of using the KIE workbench to complete the configuration for our next example (left for an exercise to the reader), we switch to an alternative tool, the KIE CLI (which stands for command line interface), and see different ways to perform the common operation tasks.</p></div></div></div></div>
<div class="section" title="An overview of the kie-config-cli tool"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>An overview of the kie-config-cli tool</h1></div></div></div><p>
<a class="link" href="ch02.html" title="Chapter 2. Building Your First BPM Application">Chapter 2</a>, <span class="emphasis"><em>Building Your First BPM Application</em></span> (see the <span class="emphasis"><em>Creating your first jBPM project</em></span> section) introduced several KIE console features (repositories and organizations management, module <a id="id345" class="indexterm"/>deployment, and so on). The KIE CLI utility provides the administrator/user with the tools to perform common tasks related to organizational units, repository, user permissions, and deployment management at the console/shell level.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note21"/>Note</h3><p>The tool project is <a id="id346" class="indexterm"/>hosted at GitHub: <a class="ulink" href="https://github.com/droolsjbpm/kie-wb-distributions/tree/master/kie-config-cli">https://github.com/droolsjbpm/kie-wb-distributions/tree/master/kie-config-cli</a>.</p><p>You can download the tool <a id="id347" class="indexterm"/>distributions from the JBoss snapshot Maven repository:</p><p>
<a class="ulink" href="http://snapshots.jboss.org/maven2/org/kie/kie-config-cli">http://snapshots.jboss.org/maven2/org/kie/kie-config-cli</a>.</p></div></div><p>The previous section explained in detail how KIE handles Git repositories for source projects, and we previewed the existence of a KIE system Git repository; the KIE CLI tool interfaces with it and operates in two modes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>online (default and recommended)</strong></span>: Upon startup, it connects to the system repository by using the Git service embedded in <code class="literal">kie-wb</code>. All changes are local and<a id="id348" class="indexterm"/> published to the upstream only when the <code class="literal">push-changes</code> CLI command is explicitly executed. The <code class="literal">exit</code> command will publish all local changes; to discard local changes upon exiting the CLI, the <code class="literal">discard</code> command shall be used</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>offline</strong></span>: Creates and <a id="id349" class="indexterm"/>manipulates the Kie system repository directly on the server (no discard option is available)</li></ul></div><p>The system repository stores the private configuration/settings data for the KIE workbench: how editors behave, organizational groups, security, and so on.</p><p>The system repository is located in the KIE <code class="literal">.niogit</code> folder (<code class="literal">.niogit/system.git</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>The core Git backend<a id="id350" class="indexterm"/> features are provided by the Red Hat Uberfire framework. <a class="ulink" href="http://www.uberfireframework.org">http://www.uberfireframework.org</a>.</p></div></div><p>By default, the KIE workbench monitors the <code class="literal">system.git</code> repository changes, thanks to its backend services, and updates its UI accordingly. We will continue our system repository description in the next section after our next example environment has been set up. We could have accomplished the job through the KIE workbench features, but we want you to go<a id="id351" class="indexterm"/> hands on and put the KIE console at work, getting acquainted in what is going on behind the curtains.</p><div class="section" title="Connecting (online mode)"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec49"/>Connecting (online mode)</h2></div></div></div><p>After launching<a id="id352" class="indexterm"/> the tool (by the <code class="literal">kie-config-cli</code> script in the installation folder), let us start by connecting to the KIE system repository on the localhost.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>SSH is to be preferred over the Git protocol for security reasons.</p></div></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>************* Welcome to Kie config CLI ****************</strong></span>
<span class="strong"><strong>&gt;&gt;Please specify location of remote Git system repository [ssh://localhost:8001/system]</strong></span>
<span class="strong"><strong>ssh://localhost:8001/system</strong></span>
<span class="strong"><strong>&gt;&gt;Please enter username:</strong></span>
<span class="strong"><strong>admin</strong></span>
<span class="strong"><strong>&gt;&gt;Please enter password:</strong></span>
<span class="strong"><strong>admin</strong></span>
</pre></div></div><div class="section" title="Creating an organizational unit"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec50"/>Creating an organizational unit</h2></div></div></div><p>The organizational <a id="id353" class="indexterm"/>unit is required by the KIE workbench in order to create repositories and users and have RBAC rule control that is entitled to perform certain tasks.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>create-org-unit</strong></span>
<span class="strong"><strong>&gt;&gt;Organizational Unit name:packt</strong></span>
<span class="strong"><strong>&gt;&gt;Organizational Unit owner:admin@packt.org</strong></span>
<span class="strong"><strong>&gt;&gt;Default Group Id for this Organizational Unit:com.packt</strong></span>
<span class="strong"><strong>&gt;&gt;Repositories (comma separated list):</strong></span>
<span class="strong"><strong>Result:</strong></span>
<span class="strong"><strong>Organizational Unit packt successfully created</strong></span>
</pre></div></div><div class="section" title="Creating a repository"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec51"/>Creating a repository</h2></div></div></div><p>We have already<a id="id354" class="indexterm"/> seen how to clone a Git repository from the KIE workbench. Let us now create a new Git repository (local, bare, and unmanaged; no username/password required) in which we can store our new projects.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>create-repo</strong></span>
<span class="strong"><strong>&gt;&gt;Repository alias:masteringjbpm6</strong></span>
<span class="strong"><strong>&gt;&gt;User:</strong></span>
<span class="strong"><strong>&gt;&gt;Password:</strong></span>
<span class="strong"><strong>&gt;&gt;Remote origin:</strong></span>
<span class="strong"><strong>Result:</strong></span>
<span class="strong"><strong>Repository with alias masterjbpm6 has been successfully created</strong></span>
</pre></div></div><div class="section" title="Defining role-based access control rules"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec52"/>Defining role-based access control rules</h2></div></div></div><p>To complete the<a id="id355" class="indexterm"/> setup procedure for our example, we set some RBAC rules to our masterjbm6 repository; the organization has no roles set, so in order to constrain the access to the repository, we add roles to the repository object:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>add-role-repo</strong></span>
<span class="strong"><strong>&gt;&gt;Repository alias:masteringjbpm6</strong></span>
<span class="strong"><strong>&gt;&gt;Security roles (comma separated list):user, analyst</strong></span>
<span class="strong"><strong>Result:</strong></span>
<span class="strong"><strong>Role user added successfully to repository masterjbpm6</strong></span>
<span class="strong"><strong>Role analyst added successfully to repository masterjbpm6</strong></span>
</pre></div></div><div class="section" title="Adding jBPM console users"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec53"/>Adding jBPM console users</h2></div></div></div><p>
<code class="literal">users.properties</code> and <code class="literal">roles.properties </code>define the users (with their roles) that are enabled to log<a id="id356" class="indexterm"/> into the jBPM console.</p><p>Let us edit <code class="literal">users.properties</code> and add two new users:</p><div class="informalexample"><pre class="programlisting">simone=simone
arun=arun</pre></div><p>Edit <code class="literal">roles.properties</code> and associate the users with the roles that we have created in the previous step:</p><div class="informalexample"><pre class="programlisting">simone=admin
arun=admin</pre></div></div><div class="section" title="Adding the repository to an organization"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec54"/>Adding the repository to an organization</h2></div></div></div><p>Each KIE Git repository <a id="id357" class="indexterm"/>must be bound to an organization; the organization is in charge of controlling accesses to it and giving organization users operation permissions.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>add-repo-org-unit</strong></span>
<span class="strong"><strong>&gt;&gt;Organizational Unit name:packt</strong></span>
<span class="strong"><strong>&gt;&gt;Repository alias:masteringjbpm6</strong></span>
<span class="strong"><strong>Result:</strong></span>
<span class="strong"><strong>Repository masteringjbpm6 was successfully added to Organizational Unit packt</strong></span>
</pre></div></div><div class="section" title="Pushing changes to system.git"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec55"/>Pushing changes to system.git</h2></div></div></div><p>The <code class="literal">push-changes</code> command<a id="id358" class="indexterm"/> sends changes to the KIE <code class="literal">system.git</code> repository:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>push-changes</strong></span>
<span class="strong"><strong>&gt;&gt;Result:</strong></span>
<span class="strong"><strong>&gt;&gt;Pushed successfully</strong></span>
</pre></div><p>As a consequence, your KIE workbench gets a refresh, displaying the updated settings on your UI.</p></div><div class="section" title="More on the system.git repository"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec56"/>More on the system.git repository</h2></div></div></div><p>At this point, you <a id="id359" class="indexterm"/>should have an idea of what the <code class="literal">system.git</code> repository is for; as a final exercise, let us clone it and have a look inside it:</p><div class="informalexample"><pre class="programlisting">git clone file:///$JBPM_HOME/.niogit/system.git</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>Remember to never push changes to system repository from outside the KIE CLI tool; it would likely mess up the entire KIE workbench installation!</p></div></div><p>The system repository contains some entities (organizational units and repositories) and internal configuration files; here, we can find our brand new organization and repository description files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">masteringjbpm6.repository</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">packt.organizationalunit</code></li></ul></div><p>The <code class="literal">masteringjbpm6.repository</code> file <a id="id360" class="indexterm"/>content is as follows (please note the <code class="literal">security:role</code> settings):</p><div class="informalexample"><pre class="programlisting">&lt;group&gt;
  &lt;name&gt;masteringjbpm6&lt;/name&gt;
  &lt;description&gt;&lt;/description&gt;
  &lt;type&gt;REPOSITORY&lt;/type&gt;
  &lt;enabled&gt;true&lt;/enabled&gt;
  &lt;items&gt;
    &lt;entry&gt;
      &lt;string&gt;scheme&lt;/string&gt;
      &lt;item&gt;
        &lt;name&gt;scheme&lt;/name&gt;
        &lt;value class="string"&gt;Git&lt;/value&gt;
      &lt;/item&gt;
    &lt;/entry&gt;
    &lt;entry&gt;
      &lt;string&gt;security:roles&lt;/string&gt;
      &lt;item&gt;
        &lt;name&gt;security:roles&lt;/name&gt;
        &lt;value class="list"&gt;
          <span class="strong"><strong>&lt;string&gt;user&lt;/string&gt;</strong></span>
          <span class="strong"><strong>&lt;string&gt;analyst&lt;/string&gt;</strong></span>
        &lt;/value&gt;
      &lt;/item&gt;
    &lt;/entry&gt;
    &lt;entry&gt;
      &lt;string&gt;branch&lt;/string&gt;
      &lt;item&gt;
        &lt;name&gt;branch&lt;/name&gt;
        &lt;value class="string"&gt;master&lt;/value&gt;
      &lt;/item&gt;
    &lt;/entry&gt;
  &lt;/items&gt;
&lt;/group&gt;</pre></div><p>Now that we are done with our new KIE Git repositories and environment configuration, we are ready to tackle the new deployment feature and the Kie-Maven integration, the subject of our<a id="id361" class="indexterm"/> next example.</p></div></div>
<div class="section" title="KIE deployments"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>KIE deployments</h1></div></div></div><p>The jBPM 6 platform introduced a<a id="id362" class="indexterm"/> brand new deployment process; the previous proprietary mechanism that leveraged the Guvnor packages (backed by a <a id="id363" class="indexterm"/>
<span class="strong"><strong>Java Content Repository</strong></span> (<span class="strong"><strong>JCR</strong></span>) and the Drools <code class="literal">KnowledgeAgent</code> (<code class="literal">changeset.xml</code>) was replaced with the widely adopted Apache Maven tool. This greatly improved the development process both in terms of tool configuration (more convention/configuration oriented) and support, standardization, and deployment flexibility.</p><p>When you deploy your project, you physically create a KIE deployment unit (KJAR); this module is a Maven-enabled project and is a compressed standard Java archive that contains all the project's business assets (processes, workitem handlers, business rules, forms, and so on) as well as its knowledge session and runtime declarative metadata descriptor (<code class="literal">META-INF/kmodule.xml</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>The <code class="literal">kmodule.xml</code> file is extensively covered in the official jBPM and Drools documentation.</p></div></div><p>The unique ID of a KIE module is built starting from its Maven GAV (GroupId, ArtifactId, Version) with the addition of the knowledge base name (the default knowledge base name is empty; we will return to this in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>), for example:</p><div class="informalexample"><pre class="programlisting">groupID:artifactID:version{:kbasename}</pre></div><p>The jBPM runtime resolves KJAR dependencies while automatically searching for other Maven modules in the configured Maven repositories (either by the project <code class="literal">pom.xml</code> file embedded in the KIE JAR or through the Maven <code class="literal">settings.xml</code> file) using the Drools KIE-CI components. You can alternatively use the <code class="literal">kie.maven.settings.custom</code> system property and point to any Maven <code class="literal">settings.xml</code> file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>Refer to <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>, particularly to the <span class="emphasis"><em>Repositories and scanner</em></span> section, for detailed information on class loading and resolving module dependencies at runtime.</p></div></div><p>The default KIE Maven repository artifacts (the <code class="literal">repositories/kie</code> folder) are remotely accessible at the following URL: <code class="literal">http://{jbpmconsole-host}:{port}/jbpm-console/maven2wb/</code>.</p><p>Let us now summarize<a id="id364" class="indexterm"/> the core actions that are performed during the deployment process:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Maven install of the module into the KIE Maven repository</li><li class="listitem" style="list-style-type: disc">Maven deploy of the module into your system Maven repository (the Maven <code class="literal">settings.xml </code>file from the Maven home is used, or the <code class="literal">kie.maven.settings.custom</code> system property is checked).</li><li class="listitem" style="list-style-type: disc">The jBPM database table called <code class="literal">DeploymentStore</code> is updated with the deployment descriptor (in the XML format). This change has been introduced with the jBPM 6.2 release; prior to this, the deployment information was stored inside the <code class="literal">system.git</code> repository.</li></ul></div><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>The release/deployment action never deploys the Kie module's dependencies; to avoid missing dependencies runtime errors, you have to provide the correct dependency artifacts by installing them into the Maven repository before you put your Kie module assets to work.</p></div></div><p>The following figure captures the standard Maven repository configuration when working with the KIE console; the KIE project is deployed into the internal KIE Maven repository first, which synchronizes with the remote<a id="id365" class="indexterm"/> <span class="strong"><strong>Maven Repository</strong></span>, and then, it provides remote public access (HTTP) to any application in order to resolve its dependencies.</p><div class="mediaobject"><img src="graphics/9578OS_04_01.jpg" alt="KIE deployments"/></div><div class="section" title="Artifacts and KIE modules"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec57"/>Artifacts and KIE modules</h2></div></div></div><p>A KIE module may <a id="id366" class="indexterm"/>depend on a number of additional Maven artifacts. The KIE workbench provides you with a view of your KIE Maven repository by selecting<a id="id367" class="indexterm"/> the <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Artifact Repository</strong></span> menu item. The <span class="strong"><strong>Path</strong></span> column displays the Maven repository URL for the artifact; just to clarify, let us have a look at the <code class="literal">napoli</code> Kie module that we released from our <code class="literal">ManagedVesuvio</code> repository:</p><p>
<span class="strong"><strong>Artifact Name</strong></span>: <code class="literal">napoli-1.0.0.jar</code>
</p><p>
<span class="strong"><strong>Path</strong></span>: <code class="literal">packt/napoli/1.0.0-SNAPSHOT/napoli-1.0.0.jar</code>
</p><p>This artifact is available at the following Maven artifact URL:</p><div class="informalexample"><pre class="programlisting">http://{jbpmconsole-host}:{port}/jbpm-console/maven2wb/packt/napoli/1.0.0-SNAPSHOT/napoli-1.0.0.jar</pre></div><p>Remember that while <span class="strong"><strong>Artifact Repository</strong></span> is a snapshot of the KIE Maven repository content, the KIE <span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Deployments</strong></span> menu item exclusively displays the valid KIE modules (KJARs), which are loaded and validated from the KIE console runtime.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>
<code class="literal">org.guvnor.m2repo.dir</code>: System properties set the path where the Maven repository folder will be stored; the default is <code class="literal">${jBPM-install-directory}/repositories/kie</code>.</p></div></div></div><div class="section" title="Deployment options"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec58"/>Deployment options</h2></div></div></div><p>The KJAR artifacts must always be deployed to the KIE console's Maven repository so that we can centrally manage them and have the console behave consistently. Given this, thanks to both the introduction of the Maven repository style and the new breed of tools (the KIE console<a id="id368" class="indexterm"/> and the Eclipse BPMN tools), you can tailor the deployment process to your development environment with a nice degree of flexibility.</p><p>Here you have some viable deployment options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Create a project (Mavenized by default) from the KIE console into a configured KIE Git repository; Git clone and pull from Eclipse, continue the development<a id="id369" class="indexterm"/> from Eclipse (add business models and so on), push changes to KIE (the KIE console automatically refreshes its repository view); build and deploy from KIE.</li><li class="listitem" style="list-style-type: disc">Create a Maven project from Eclipse (remember to add the <code class="literal">kmodule.xml</code> file and the jBPM dependencies in <code class="literal">pom.xml</code>); create all your business artifacts, and develop a unit test from Eclipse; push to KIE; maybe make some fixes from KIE and then build and deploy.</li><li class="listitem" style="list-style-type: disc">Create a Maven project from Eclipse as in the previous solution; install with Maven (either from Eclipse or from the command line); have the KIE console advertise the new KIE deployment module uploading the new artifact from the console (<span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Deployments</strong></span>).</li><li class="listitem" style="list-style-type: disc">From the Kie console, create a repository clone from a remote Git repository; create a project, add assets, and then, save and commit. Deploy to Maven and push changes to the remote Git repository.</li><li class="listitem" style="list-style-type: disc">Thanks to its Maven and Git integration, the KIE platform can fit very flexibly into a complex development environment.</li></ul></div></div><div class="section" title="Deployment by example – the Pizza projects"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec59"/>Deployment by example – the Pizza projects</h2></div></div></div><p>We had a preview of installing and deploying with the <code class="literal">ManagedVesuvio</code> repository release process where two KIE modules (one is dependent on the other) were released. Let us go hands on with a different module example: a KIE module (main project) and a plain module (dependency). These pizza example projects are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">Pizzadelivery</code>: The KJAR module (it contains the process definition)</li><li class="listitem" style="list-style-type: disc"><code class="literal">Pizzamodel</code>: A utility project with Java classes that model our business objects (Order, Pizza, and so on)</li></ul></div><p>The <code class="literal">Pizzadelivery</code> project depends upon the <code class="literal">Pizzamodel</code> project. Let us start by reviewing the example <a id="id370" class="indexterm"/>process definition (we will use the same process for our BAM example solution later, in the closing paragraph).</p><div class="section" title="The process definition – pizzadelivery"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec33"/>The process definition – pizzadelivery</h3></div></div></div><p>The example process definition <a id="id371" class="indexterm"/>captures a typical takeaway pizza process:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">An order is placed and Nino manages the incoming order by phone (the <span class="strong"><strong>Handle Incoming Order</strong></span> task).</li><li class="listitem">Maria gets the order details from Nino and hands off a sticky note to the pizza makers (the <span class="strong"><strong>Order Assignment</strong></span> task).</li><li class="listitem">A pizza maker (either Mario or Luigi) starts preparing the pizza (the <span class="strong"><strong>Make the Pizza</strong></span> task), while, at the same time, Maria assigns the order delivery to a pizza boy (the <span class="strong"><strong>Assign the Delivery</strong></span> task). The completion of both the delivery assignment task and the making pizza task (parallel tasks, more on this in <a class="link" href="ch05.html" title="Chapter 5. BPMN Constructs">Chapter 5</a>, <span class="emphasis"><em>BPMN Constructs</em></span>) means that the pizza is ready to be delivered.</li><li class="listitem">Salvatore delivers the pizza (the <span class="strong"><strong>Pizza Delivery</strong></span> task).<div class="mediaobject"><img src="graphics/9578OS_04_16.jpg" alt="The process definition – pizzadelivery"/></div></li></ol></div></div><div class="section" title="Deploying pizzas"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec34"/>Deploying pizzas</h3></div></div></div><p>First, we <a id="id372" class="indexterm"/>make the dependency available through Maven, and then, we deploy the module through the KIE workbench. Let us import the sources into our new KIE repository (the one we set up in the <span class="emphasis"><em>Creating a repository</em></span> section).</p></div><div class="section" title="Git and project configuration"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec35"/>Git and project configuration</h3></div></div></div><p>At this stage, you<a id="id373" class="indexterm"/> should be quite familiar with importing a source project into the KIE repository:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Clone the examples repository from our example GitHub repository:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git clone https://github.com/masteringjbpm6/chapter4-pizza.git</strong></span>
</pre></div></li><li class="listitem">Add the cloned repository projects to the local (unmanaged) <code class="literal">masteringjbpm6</code> repository section:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git remote remove origin</strong></span>
<span class="strong"><strong>git remote add origin ssh://localhost:8001/masteringjbpm6/</strong></span>
</pre></div></li><li class="listitem">By issuing a <code class="literal">git remote</code> command, we see the following:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ git remote -v</strong></span>
<span class="strong"><strong>origin ssh://admin@localhost:8001/masteringjbpm6 (fetch)</strong></span>
<span class="strong"><strong>origin ssh://admin@localhost:8001/masteringjbpm6 (push)</strong></span>
</pre></div></li><li class="listitem">Let's now push only the sample KIE module project to the new remote (origin):<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>git add pizzadelivery</strong></span>
<span class="strong"><strong>git commit –m "pizzadelivery: first kjar"</strong></span>
<span class="strong"><strong>git push -u origin master</strong></span>
</pre></div></li></ol></div><p>The aim here is to send the KIE console (through Git) only the KIE project, and not to create additional sources of issues. We are now going to provide the KIE <code class="literal">pizzadelivery</code> <a id="id374" class="indexterm"/>project Maven dependencies (<code class="literal">pizzamodel.jar</code>) through our Maven repository.</p></div><div class="section" title="Deploying the dependency"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec36"/>Deploying the dependency</h3></div></div></div><p>By switching to<a id="id375" class="indexterm"/> <span class="strong"><strong>Project Authoring</strong></span> | <span class="strong"><strong>Project Explorer</strong></span>, we can find the PizzaDelivery project (navigate through the <span class="strong"><strong>packt/masteringjbpm6</strong></span> repository breadcrumb). Press the <span class="strong"><strong>Open Project Editor</strong></span> button, and by selecting the <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Dependencies</strong></span> item from the dropdown list, we see that the <code class="literal">pizzadelivery</code> module depends on the <code class="literal">pizzamodel</code> artifact (see the picture below), which is not present in the Maven repository yet.</p><div class="mediaobject"><img src="graphics/9578OS_04_15.jpg" alt="Deploying the dependency"/></div><p>The <span class="strong"><strong>Messages</strong></span> tab reports this issue, accordingly:</p><p>
<span class="strong"><strong>Unresolved dependency com.packt.masterjbpm6:pizzamodel:1.0.0-SNAPSHOT</strong></span>
</p></div><div class="section" title="Providing artifacts"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec37"/>Providing artifacts</h3></div></div></div><p>What is going on now should be clear: the KIE dependency mechanism (the "scanner" we will talk about it in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>) cannot resolve the <code class="literal">pizzadelivery</code> project's dependencies (loaded from its <code class="literal">pom.xml</code> file) while scanning through the available Maven<a id="id376" class="indexterm"/> repositories; to address the issue, we are going to supply the missing artifact with two steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Maven install: Executing an <code class="literal">mvn clean install</code> at the <code class="literal">pizzamodel</code> project root (or using the Eclipse <span class="strong"><strong>Run As Maven Build</strong></span> integrated feature) performs the build and install of the artifact in our Maven repository so that the dependency can be resolved at runtime.</li><li class="listitem">Artifact repository upload: Go to the Kie console <span class="strong"><strong>Authoring</strong></span> | <span class="strong"><strong>Artifact Repository</strong></span> page and click the <span class="strong"><strong>Upload</strong></span> button; select the <code class="literal">pizzamodel</code> JAR file from your Maven repository folder (<code class="literal">com/packt/masterjbpm6</code>). The KIE console will copy the artifact to its internal Maven repository.<div class="mediaobject"><img src="graphics/9578OS_04_02.jpg" alt="Providing artifacts"/></div></li></ol></div><p>The artifact is now available, and if you hit the <span class="strong"><strong>Refresh</strong></span> button in the <span class="strong"><strong>Messages</strong></span> panel, the issue should be fixed.</p></div><div class="section" title="Deploying"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec38"/>Deploying</h3></div></div></div><p>We are now ready to<a id="id377" class="indexterm"/> deploy. In the <span class="strong"><strong>Projects Explorer</strong></span> tab, select the <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Project Editor</strong></span> menu item. Check whether the <code class="literal">PizzaDelivery</code> module Maven GAV properties are correct and click the <span class="strong"><strong>Build &amp; Deploy</strong></span> button.</p><div class="mediaobject"><img src="graphics/9578OS_04_03.jpg" alt="Deploying"/></div><p>Please note that during deployment, the KIE console will try to resolve and verify all of your project dependencies, potentially hitting a number of remote Maven repositories (depending on your<a id="id378" class="indexterm"/> configuration) and taking some time to finish. Ensure that your Internet connection is active or set up a Maven proxy repository (highly recommended).</p><p>The application server console traces the following information:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>18:32:33,517 INFO  [org.drools.compiler.kie.builder.impl.KieRepositoryImpl] (default task-106) KieModule was added: MemoryKieModule[releaseId=com.packt.masterjbpm6:pizzadelivery:1.0]</strong></span>
<span class="strong"><strong>18:32:34,547 INFO  [org.jbpm.console.ng.bd.backend.server.DeploymentManagerEntryPointImpl] (default task-106) Deploying unit com.packt.masterjbpm6:pizzadelivery:1.0</strong></span>
<span class="strong"><strong>18:32:35,969 INFO  [org.jbpm.kie.services.impl.store.DeploymentSynchronizer] (default task-106) Deployment unit com.packt.masterjbpm6:pizzadelivery:1.0 stored successfully</strong></span>
</pre></div><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Remember that you cannot deploy a deployment unit having the same ID (overwriting it), irrespective of whether it has active (running) process instances or not; an undeploy action is required (see the next section).</p></div></div><p>The logs confirm that the deployment was successfully completed; we can see our KJAR module listed in the <span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Deployments</strong></span> tab. Remember that for the deployment process to succeed (at least with jBPM releases up to 6.2), your <code class="literal">kmodule.xml</code> must either:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Declare<a id="id379" class="indexterm"/> an empty <code class="literal">&lt;kmodule&gt;</code> element</li><li class="listitem" style="list-style-type: disc">Declare a <code class="literal">&lt;ksession&gt;</code> element with the following attributes: <code class="literal">type="stateful" default="true"</code></li></ul></div><div class="mediaobject"><img src="graphics/9578OS_04_04.jpg" alt="Deploying"/></div><p>For the sake of thoroughness, check your jBPM data store for the deployment entry in the <code class="literal">DEPLOYMENTSTORE</code> table; we should see that a new row has been added.</p><p>The table row has a DEPLOYMENTID column: <code class="literal">com.packt.masterjbpm6:pizzadelivery:1.0.0 </code>and a DEPLOYMENTUNIT column, which contains the actual deployment descriptor:</p><div class="informalexample"><pre class="programlisting">&lt;org.jbpm.kie.services.impl.KModuleDeploymentUnit&gt;
  &lt;artifactId&gt;pizzadelivery&lt;/artifactId&gt;
  &lt;groupId&gt;com.packt.masterjbpm6&lt;/groupId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;strategy&gt;SINGLETON&lt;/strategy&gt;

&lt;/org.jbpm.kie.services.impl.KModuleDeploymentUnit&gt;</pre></div><p>This is, actually, the third step of the deployment process (see the <span class="emphasis"><em>KIE deployments</em></span> section).</p></div></div><div class="section" title="Adding a KIE module manually"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec60"/>Adding a KIE module manually</h2></div></div></div><p>Even though you<a id="id380" class="indexterm"/> have built and installed your KIE module from outside the KIE workbench (to your system Maven repository only, maybe using Eclipse IDE and a Maven install goal), you can always deploy it to KIE later. Manually adding a deployment unit means that you are making this (Maven installed) module available to the KIE runtime. From the <span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Deployments</strong></span> perspective, you can add new deployment units (the <span class="strong"><strong>New Deployment</strong></span> button); just provide the Maven GAV for the project you want to deploy and, optionally, the knowledge base and<a id="id381" class="indexterm"/> the knowledge session name.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>In addition to this, you can select the <code class="literal">ksession</code> runtime strategy that fits your requirements: a Singleton, Per Request, or Per Process instance (See <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span> for runtime strategies).</p></div></div><p>The KIE workbench will provide a new <code class="literal">kmodule.xml</code> file and meta information, converting your plain JAR module to a new KIE module. You cannot create a new deployment unit if the matching Maven artifact is not available in the KIE Maven repository.</p></div><div class="section" title="Process and task management applied – the PizzaDelivery process"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec61"/>Process and task management applied – the PizzaDelivery process</h2></div></div></div><p>The KIE workbench allows you to manage process instances and interact with process tasks. You can do the<a id="id382" class="indexterm"/> following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Send a signal to a specific process instance or a bulk signal (broadcast to all process instances).</li><li class="listitem" style="list-style-type: disc">Abort a specific process instance or perform a bulk abort—the abort terminates the instance(s) and all the pending tasks. All data pertaining to the process and its tasks are removed from the jBPM database tables.</li><li class="listitem" style="list-style-type: disc">Get the process details— the details page includes the auditing log taken from the default jBPM database auditing tables (we will talk about auditing in the last section and in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>).</li><li class="listitem" style="list-style-type: disc">Start, release, and complete a task.</li></ul></div><div class="section" title="Starting the Process"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec39"/>Starting the Process</h3></div></div></div><p>Open the <span class="strong"><strong>Process Management</strong></span> | <span class="strong"><strong>Process Definitions</strong></span> tab and click the <span class="strong"><strong>Start</strong></span> icon button next to our brand new deployed <a id="id383" class="indexterm"/>PizzaDelivery process definition; a new process instance starts. </p></div></div><div class="section" title="Undeployment"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec62"/>Undeployment</h2></div></div></div><p>The undeployment <a id="id384" class="indexterm"/>action removes the deployment unit's configuration file only from the jBPM database table, leaving the Maven artifact in place.</p></div><div class="section" title="User management"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec63"/>User management</h2></div></div></div><p>We introduced the PizzaDelivery process in the example setup section; the process requires five <a id="id385" class="indexterm"/>different human actors:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Incoming orders management</strong></span>: Nino</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Order assignments</strong></span>: Maria</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pizza cooking</strong></span>: Either Mario or Luigi</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Delivery assignments</strong></span>: Maria</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Pizza deliveries</strong></span>: Salvatore</li></ul></div><p>In order to use the KIE console to exercise our first process instance, we need to add these process participants (the actors) to the KIE runtime. Edit the <code class="literal">user.properties</code> and the <code class="literal">roles.properties</code> files in the <code class="literal">$JBOSS_HOME\standalone\configuration</code> folder; these users will be automatically added by the KIE workbench to the task service database table (<code class="literal">ORGANIZATIONALENTITY</code>, more on this in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>).</p><p>Add the actors (specify the authentication password) to the <code class="literal">user.properties</code> file:</p><div class="informalexample"><pre class="programlisting">nino=nino
maria=maria
salvatore=salvatore
mario=mario
luigi=luigi</pre></div><p>Specify a role for the users in the <code class="literal">roles.properties</code> file (the default role <code class="literal">user</code> is enough to perform tasks):</p><div class="informalexample"><pre class="programlisting">nino=user
salvatore=user
mario=user
luigi=user
maria=user</pre></div><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>There is no <a id="id386" class="indexterm"/>need to restart the application server to make it pick up the new settings.</p></div></div></div><div class="section" title="Task management"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec64"/>Task management</h2></div></div></div><p>To complete the<a id="id387" class="indexterm"/> process instance, perform the steps in the following order:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Log in as Nino</strong></span>: <span class="strong"><strong>start</strong></span> and <span class="strong"><strong>complete</strong></span> the <span class="strong"><strong>Handle Incoming Order</strong></span> task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Log in as Maria</strong></span>: <span class="strong"><strong>claim</strong></span> and <span class="strong"><strong>complete</strong></span> the <span class="strong"><strong>Assign Order</strong></span> task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Log in as Mario (or Luigi)</strong></span>: <span class="strong"><strong>claim</strong></span> and <span class="strong"><strong>complete</strong></span> the <span class="strong"><strong>Make Pizza</strong></span> task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Log in as Maria</strong></span>: <span class="strong"><strong>claim</strong></span> and <span class="strong"><strong>complete</strong></span> the <span class="strong"><strong>Assign Delivery</strong></span> task</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Log in as Salvatore</strong></span>: <span class="strong"><strong>claim</strong></span> and <span class="strong"><strong>complete</strong></span> the <span class="strong"><strong>Deliver the pizza</strong></span> task</li></ul></div><p>All tasks are completed. The process instance ends and looking at the process instance detail tab, we can see the instance log traces (events are displayed in the reverse chronological order):</p><p>Instance log:</p><div class="informalexample"><pre class="programlisting">22/nov/14 23:35:53: 8 – EndNode
22/nov/14 23:29:54: 7 - deliver the pizza (HumanTaskNode)
22/nov/14 23:29:54: 6 - Join
22/nov/14 23:27:50: 6 - Join
22/nov/14 23:26:56: 4 - make the pizza (HumanTaskNode)
22/nov/14 23:26:56: 5 - assign the delivery (HumanTaskNode)
22/nov/14 23:26:56: 3 – Split
22/nov/14 22:41:56: 2 - Assign the order (HumanTaskNode)
22/nov/14 18:10:05: 1 - Handle Incoming Order (HumanTaskNode)
22/nov/14 18:10:05: 0 - Receive Pizza Order (StartNode)</pre></div><p>The <code class="literal">Split</code> log traces the activation of the parallel diverging gateway. The <code class="literal">Join</code> logs trace the activation of the parallel converging gateway's incoming connections. The trace logs are loaded from the <code class="literal">NODEINSTANCELOG</code> table.</p><p>As you may have realized, it is not that easy to perform a full test of a process definition from within the KIE workbench; switching from actors back and forth is a cumbersome and time-consuming task…just think about a complex process with a lot of human tasks and actors or groups. We will see how to overcome these issues by using test automation with the BAM <a id="id388" class="indexterm"/>example and in the next chapter.</p></div></div>
<div class="section" title="Managing jobs and asynchronous commands' execution"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Managing jobs and asynchronous commands' execution</h1></div></div></div><p>Starting from jBPM 6, the platform features a new scheduler service (called <code class="literal">Executor</code>), which lets you<a id="id389" class="indexterm"/> schedule, execute, and manage asynchronous jobs tasks. Executor can be used either as a general-purpose Java batch scheduling facility or as a service able to<a id="id390" class="indexterm"/> execute asynchronous process tasks (see <a class="link" href="ch05.html" title="Chapter 5. BPMN Constructs">Chapter 5</a>, <span class="emphasis"><em>BPMN constructs</em></span>, the <span class="emphasis"><em>Async task</em></span> section for more details). The asset management feature, for instance, internally schedules different types of commands (to get an idea, open the <span class="strong"><strong>Deploy</strong></span> | <span class="strong"><strong>Jobs</strong></span> window, as shown in the following screenshot): <code class="literal">CreateBranchCommand</code>, <code class="literal">ListCommitsCommand</code>, <code class="literal">BuildProjectCommand</code>, <code class="literal">MavenDeployProjectCommand</code>, and so on.</p><div class="mediaobject"><img src="graphics/9578OS_04_19.jpg" alt="Managing jobs and asynchronous commands' execution"/></div><p>The Executor service executes preconfigured <code class="literal">Command</code> classes; a <code class="literal">Command</code> is a Java class that executes a set of business statements running outside the jBPM process context and communicating with Executor through a set of interfaces (<code class="literal">CommandContext</code> and <code class="literal">ExecutionResults</code>), which enforce parameter passing.</p><p>The <code class="literal">Job</code> classes are persisted in the <code class="literal">REQUESTINFO</code> jBPM database table, while the resulting errors problems are persisted in the <code class="literal">ERRORINFO</code> table.</p><div class="section" title="Creating, scheduling, and launching a new Job"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec65"/>Creating, scheduling, and launching a new Job</h2></div></div></div><p>The plain and simple, general-purpose <code class="literal">Job</code> definition (no jBPM context available) requires you to<a id="id391" class="indexterm"/> provide at least the class name for the class to schedule (see the following <a id="id392" class="indexterm"/>screenshot).</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Type the class name <a id="id393" class="indexterm"/><code class="literal">com.packt.masterjbpm6.command.SimpleCommand</code> into the <span class="strong"><strong>Type</strong></span> field and <code class="literal">SimpleCommand</code> in the <span class="strong"><strong>Name</strong></span> field. The <code class="literal">Job</code> class must be in the classpath for the KIE workbench application (<code class="literal">jbpm-console.war</code>), so either copy the <code class="literal">pizzamodel.jar</code> file in <code class="literal">WEB-INF/lib</code> for the exploded WAR or copy it in the <code class="literal">dependencies</code> folder of the jBPM setup folder and rebuild the console app by using the Ant target <code class="literal">install.jBPM-console.into.jboss</code> you can find in the jBPM <code class="literal">build.xml</code> file.</li><li class="listitem">Set the <span class="strong"><strong>Due On</strong></span> (schedule) time and, optionally, the number of <span class="strong"><strong>Retries</strong></span> (the number of times the <code class="literal">Job</code> class can be restarted after failure), and the parameters.</li><li class="listitem">The parameters (the contextual data) are passed upon execution to the <code class="literal">Job</code> instance through the <code class="literal">CommandContext</code> class. Parameters must be serializable.<div class="mediaobject"><img src="graphics/9578OS_04_05.jpg" alt="Creating, scheduling, and launching a new Job"/></div></li></ol></div><p>After being created, the task turns into the <span class="strong"><strong>QUEUED</strong></span> state (as shown in the following screenshot) and will<a id="id394" class="indexterm"/> be executed<a id="id395" class="indexterm"/> at the scheduled time. The different Job statuses are <a id="id396" class="indexterm"/>as follows: <span class="strong"><strong>QUEUED</strong></span>, <span class="strong"><strong>DONE</strong></span>, <span class="strong"><strong>CANCELLED</strong></span>, <span class="strong"><strong>ERROR</strong></span>, <span class="strong"><strong>RETRYING</strong></span>, and <span class="strong"><strong>RUNNING</strong></span>.</p><div class="mediaobject"><img src="graphics/9578OS_04_06.jpg" alt="Creating, scheduling, and launching a new Job"/></div></div></div>
<div class="section" title="Process definition conversion"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec27"/>Process definition conversion</h1></div></div></div><p>Conversion deals <a id="id397" class="indexterm"/>with moving a process definition from an old version format to a new version format. jBPM 6 gives us some (pretty much experimental) options when upgrading older process definitions to a new jBPM release format:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Importing from the old proprietary jBPM JPDL 3/4 to BPMN2 with the jBPM web process designer menu function</li><li class="listitem" style="list-style-type: disc">Ad hoc migration with <code class="literal">jBPM5migrationtoolproject</code> and <code class="literal">jbpmmigration-0.13.jar</code> or a newer release (API mapping is also supported)</li></ul></div><p>The goal of the <code class="literal">jBPM5migrationtoolproject</code> project is to provide some migration tooling to the existing users of jBPM for moving from jBPM5.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>The project home<a id="id398" class="indexterm"/> and Wiki pages are available here: <a class="ulink" href="https://developer.jboss.org/wiki/jBPM5migrationtoolproject">https://developer.jboss.org/wiki/jBPM5migrationtoolproject</a>. The project is hosted<a id="id399" class="indexterm"/> on GitHub: <a class="ulink" href="https://github.com/droolsjbpm/jbpmmigration">https://github.com/droolsjbpm/jbpmmigration</a>.</p></div></div><div class="section" title="Process definition versioning and instance upgrading"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec66"/>Process definition versioning and instance upgrading</h2></div></div></div><p>Depending on <a id="id400" class="indexterm"/>enterprise business requirements and business organizations, the<a id="id401" class="indexterm"/> processes may change at a very variable rate over time; several business migration cases need to be addressed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A complex critical business process may take months to complete (maybe due to manual tasks), yet the business staff needs to make an updated process definition available as soon as possible because some old legacy systems must be integrated into the flow</li><li class="listitem" style="list-style-type: disc">The process<a id="id402" class="indexterm"/> definition needs a fix but a number of instances of that very same process definition are active and we do not want to abort them and have the user restart the workflow from the beginning</li></ul></div><p>Apart from bumping the <a id="id403" class="indexterm"/>process definition version property (numeric), which is just a mnemonic and does not affect the process instance behavior, it's good practice to name your process ID (string) in order to reflect the version number, since the engine itself does not provide any version tracking mechanism, for example:</p><div class="informalexample"><pre class="programlisting">com.packt.masteringjbpm6.pizzadelivery_v1_0,
com.packt.masteringjbpm6.pizzadelivery_v1_1</pre></div><p>This way you can have a flexible method of switching instantiations across different versions of the process definition while preserving auditing data and maintaining separation. Each instance is, in fact, bound to its process definition (by the ID), and this must not be overwritten until the instance is completed.</p><p>To support users in migrating a process instance across different process definitions, jBPM 6 features the <code class="literal">WorkflowProcessInstanceUpgrader</code> class.</p><p>The <code class="literal">WorkflowProcessInstanceUpgrader</code>.<code class="literal">upgradeProcessInstance</code> method first disconnects the process<a id="id404" class="indexterm"/> instance from the signals, and event handler management then traverses the process instance node-by-node trying to map the nodes to the target process definition nodes by getting <code class="literal">uniqueID</code> from the mapping data that you provide.</p><p>
<code class="literal">uniqueID</code> is an internal identifier generated by the engine by concatenating the IDs of the parent (container) elements of the node, for example:</p><div class="informalexample"><pre class="programlisting">// create the node mapping data
Map&lt;String, Long&gt; mapping = new HashMap&lt;String, Long&gt;(); 
// top level node 1 must be mapped to a new node with id 2
mapping.put("1", 2L);
// node 3, which is inside a composite node 4, must be mapped to a new node with id 5
mapping.put("4.3", 5L); 
// upgrade old processInstance to a new process instance definition with id= com.packt.masteringjbpm6.pizzadelivery_v1_1
WorkflowProcessInstanceUpgrader.upgradeProcessInstance( ksession, processInstance.getId(),"com.packt.masteringjbpm6.pizzadelivery_v1_1", mapping);</pre></div><p>This solution is, all in all, far from<a id="id405" class="indexterm"/> complete for complex process definitions; you<a id="id406" class="indexterm"/> are suggested to implement your own process migration whenever possible.</p></div></div>
<div class="section" title="BAM"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec28"/>BAM</h1></div></div></div><p>The business activity<a id="id407" class="indexterm"/> monitor (BAM) provides the tools to build out of the system, customizable KPI, which are useful for the management staff in taking proactive decisions. The term was defined by Gartner Inc. (<a class="ulink" href="http://www.gartner.com/it-glossary/bam-business-activity-monitoring">http://www.gartner.com/it-glossary/bam-business-activity-monitoring</a>) and refers to the<a id="id408" class="indexterm"/> real-time aggregation, analysis, and representations of the enterprise data (possibly relating it to the system stakeholders and the customers).</p><p>The BAM's target is to produce (near) real-time information about the status and the outcome of the operations, processes, and transactions of a jBPM business system; this supports the corporate management <a id="id409" class="indexterm"/>staff in taking reactive decisions (<span class="strong"><strong>Decision Support System</strong></span> (<span class="strong"><strong>DSS</strong></span>)), and it helps staff to identify critical areas (possible sources of problems).</p><p>Examples include the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Enterprises <a id="id410" class="indexterm"/>with a JIT production business model must constantly monitor their manufacturing and procurement processes and relate them to incoming orders and business providers</li><li class="listitem" style="list-style-type: disc">Telco companies need to overview their services, providing operations in order to have an up-to-the-minute view of their customers</li></ul></div><p>BAM typically needs to be integrated with BI/data warehouse tools; the first breed of tools is real time (data-oriented heterogeneous sources), while the second is historical business data. With the advent of NoSQL database engines, big data, and cloud-based platforms, this trend is today rapidly shifting away and turning to a new breed of tools handling streaming <a id="id411" class="indexterm"/>processing (real time) as well as batch processing (<span class="strong"><strong>Complex Event Processing</strong></span> (<span class="strong"><strong>CEP</strong></span>)).</p><div class="section" title="BPM and BAM"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec67"/>BPM and BAM</h2></div></div></div><p>The primary jBPM source for BAM data is the engine audit service and the jBPM database tables.</p><p>Audit data may be<a id="id412" class="indexterm"/> relevant for some business systems and useless for others. The auditing and logging history data could be a demanding task for your system/platform software and be very expensive in terms of I/O and/or allocated resources (disk space, DB resources, and so on). The jBPM audit logging service database schema is just a default implementation; the type and amount of the default audit data may not meet your needs, and your business application might require a finer (or just different) level of information to be captured.</p><p>The jBPM audit service module (<code class="literal">jbpm-audit-6.2.0.jar</code>) provides the implementers with two ways to produce audit data by collecting the engine events:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>JPA</strong></span>: Synchronous logger that is<a id="id413" class="indexterm"/> bound to the engine transaction and persists audit events as part of a runtime engine transaction</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>JMS</strong></span>: Asynchronous logger that<a id="id414" class="indexterm"/> can be configured to place messages on the queue either with respect to active transaction (only after the transaction is committed) or directly as they are generated</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>Please refer to <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>, for a thorough explanation of the jBPM auditing and logging services.</p></div></div><p>Carefully evaluate the impact of the required audit service granularity on the engine performance and plan your implementation accordingly; for production environments, consider the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Use a different database from the engine DB for your auditing data; this facilitates the DB management tasks (for example, no Foreign Key issues)</li><li class="listitem" style="list-style-type: disc">Use asynchronous event processing for better throughput</li></ul></div><p>Where audit data really matters, some systems typically require the process history log to be maintained for a considerable amount of time (years); planning a reliable database strategy (backup/recovery) is a must. The following list <a id="id415" class="indexterm"/>provides you with some first-hand tips:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>No audit data required</strong></span>: Turnoff JPA audit persistency options (configure the jBPM <code class="literal">persistence.xml</code> file)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Default audit data</strong></span>: Enable JPA audit persistence</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Custom/finer level but no extra processing required</strong></span>: Turnoff JPA audit options, <a id="id416" class="indexterm"/>and follow the custom audit implementation notes in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Custom/finer level and extra processing required (BI)</strong></span>: Turnoff JPA audit options, and follow the custom audit implementation notes in <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>; writing to a different database is suggested</li></ul></div><p>Please check <a class="link" href="ch06.html" title="Chapter 6. Core Architecture">Chapter 6</a>, <span class="emphasis"><em>Core Architecture</em></span>, for implementation details and samples.</p></div><div class="section" title="Default history logs"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec68"/>Default history logs</h2></div></div></div><p>The engine audit log/history information is stored in the <code class="literal">PROCESSINSTANCELOG</code>, <code class="literal">NODEINSTANCELOG</code>, and <a id="id417" class="indexterm"/>
<code class="literal">VARIABLEINSTANCELOG</code> tables.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>Please check <a class="link" href="ch08.html" title="Chapter 8. Integrating jBPM with Enterprise Architecture">Chapter 8</a>, <span class="emphasis"><em>Integrating jBPM with Enterprise Architecture</em></span>, of the jBPM 6.1 user guide for details regarding the jBPM database schema.</p></div></div><p>Lesser-known yet very handy tables for our BAM purposes are the <code class="literal">TASKEVENT</code> and <code class="literal">AUDITTAASKIMPL</code> tables.</p><p>The <code class="literal">TASKEVENT</code> and <code class="literal">AUDITTAASKIMPL</code> tables are managed by <code class="literal">org.jbpm.services.task.audit.JPATaskLifeCycleEventListener</code>, a task life cycle listener created and attached to the <code class="literal">TaskService</code> instance during runtime when JPA <code class="literal">EntityManager</code> is set.</p><p>The <code class="literal">TASKEVENT</code> table logs the task event transitions:</p><div class="informalexample"><pre class="programlisting">STARTED, ACTIVATED, COMPLETED, STOPPED, EXITED, FAILED, ADDED, CLAIMED, SKIPPED, SUSPENDED, CREATED,FORWARDED, RELEASED, RESUMED, DELEGATED, NOMINATED</pre></div><p>Each row contains the key to the parent task (the<a id="id418" class="indexterm"/> <span class="strong"><strong>TASKID</strong></span> column); you can take a look at an example full table dump file (<code class="literal">taskevent_dump.txt</code>) placed in the <code class="literal">pizzadelivery</code> Eclipse project. In the following paragraph, we will cover the BAM dashboard and build <a id="id419" class="indexterm"/>a customization example by using our PizzaDelivery business process audit data.</p></div><div class="section" title="BAM and Dashbuilder – the pizza maker's performance index"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec69"/>BAM and Dashbuilder – the pizza maker's performance index</h2></div></div></div><p>jBPM 6 is shipped with a<a id="id420" class="indexterm"/> jBPM pre-configured web application built with Dashbuilder.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>Dashbuilder<a id="id421" class="indexterm"/> is the Red Hat open source platform for building business dashboards and reports; at the time of writing this book, the latest dashboard<a id="id422" class="indexterm"/> release is 6.2.0; please refer to the following<a id="id423" class="indexterm"/> product home site:</p><p>
<a class="ulink" href="http://www.dashbuilder.org">http://www.dashbuilder.org</a>.</p></div></div><p>The process and task dashboard is in no way a production-ready BAM platform but helps the jBPM system stakeholders (as well as the jBPM administrators) to get a consistent preview of the underlying auditing default data at nearly no cost.</p><div class="tip" title="Tip" style=""><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>Please check Chapter 16 of the jBPM 6.2 user guide for an introduction to the jBPM dashboard.</p></div></div><p>To illustrate a hands-on sample case, we will now generate some audit data and add a new chart (backed by a new data provider) on our jBPM dashboard; the chart will display the performance index of all the process actors with respect to the assigned tasks.</p><div class="section" title="Example projects"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec40"/>Example projects</h3></div></div></div><p>The book ships <a id="id424" class="indexterm"/>with several example Java projects; starting from this paragraph, we will use Maven projects that you can load and run into Eclipse without deploying them through the KIE workbench. The examples are jUnit-based test classes with single or multiple test methods each. To resolve all the required jBPM library dependencies, you can add the <code class="literal">org.jbpm:jbpm-test:6.2.0.Final</code> dependency to the <code class="literal">pom.xml</code> file generated by your Eclipse project.</p><div class="section" title="Configuring persistence"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl4sec10"/>Configuring persistence</h4></div></div></div><p>The examples use Bitronix and the H2 database for persistence; the database connection settings can be configured for all the projects in the <code class="literal">localJBPM.properties</code> file. This file is found in<a id="id425" class="indexterm"/> the <code class="literal">test-common</code> project of the <a class="link" href="ch05.html" title="Chapter 5. BPMN Constructs">Chapter 5</a>, <span class="emphasis"><em>BPMN Constructs</em></span> examples onward and in the <code class="literal">Pizza</code> project for this chapter, in the <code class="literal">examples</code> folder. The main settings are as follows:</p><div class="informalexample"><pre class="programlisting">persistence.datasource.user=sa
persistence.datasource.password=
persistence.datasource.url= jdbc:h2:tcp://localhost/~/jbpm-62
persistence.datasource.name=jdbc/localjbpm-ds</pre></div><p>Please note that <code class="literal">persistence.datasource.name</code> must be equal to the persistence unit <code class="literal">jta-data-source</code> element in the project <code class="literal">persistence.xml</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;jta-data-source&gt;jdbc/localjbpm-ds&lt;/jta-data-source</pre></div></div></div></div><div class="section" title="Generating audit data – ProcessBAM unit test"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec70"/>Generating audit data – ProcessBAM unit test</h2></div></div></div><p>We leverage the default jBPM JPA audit listener and generate some audit data by using our <code class="literal">PizzaDelivery</code> process. Import the Maven <code class="literal">Pizza</code> project into Eclipse and run the <code class="literal">ProcessBAM</code> unit test; this<a id="id426" class="indexterm"/> class manages five threads simulating the operations of the five process actors. It introduces some delay in the task completion just to<a id="id427" class="indexterm"/> get realistic audit data (the time is expressed in milliseconds; the test takes a couple of minutes to run).</p><p>The test also makes Luigi slightly slower than Mario in making pizzas, so we can bring this difference to notice when evaluating the KPI.</p><div class="informalexample"><pre class="programlisting">salvatore is executing task 'deliver the pizza'
salvatore is waiting for 2000 before completing task 'deliver the pizza'
mario is done with work for now.
salvatore is done with work for now.
...all tasks completed.</pre></div><p>A number of 10 <code class="literal">pizzadelivery</code> processes shall be created and all related tasks completed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">10 incoming orders managed by Nino</li><li class="listitem" style="list-style-type: disc">10 order assignments performed by Maria</li><li class="listitem" style="list-style-type: disc">10-pizza cooking shared (randomly) by Mario or Luigi</li><li class="listitem" style="list-style-type: disc">10 delivery assignments performed by Maria</li><li class="listitem" style="list-style-type: disc">10 pizza deliveries performed by Salvatore</li></ul></div><p>Let us see<a id="id428" class="indexterm"/> the steps required to configure and create the dashboard chart starting<a id="id429" class="indexterm"/> from the auditing data.</p></div><div class="section" title="Writing the business query"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec71"/>Writing the business query</h2></div></div></div><p>The query (H2 SQL syntax and functions) calculates the duration (from the STARTED to the COMPLETED task <a id="id430" class="indexterm"/>event transition, in milliseconds) for each task of the 10 completed processes.</p><div class="informalexample"><pre class="programlisting">SELECT te.id,te.type as taskevent, te.logtime as startdate, te2.type as taskevent, te2.logtime as enddate,
TIMESTAMPDIFF ('MILLISECOND',te.logtime,te2.logtime) as elapsed, te.userid, t.name as taskname
FROM TASK as  t
INNER JOIN TASKEVENT as te on te.taskid=t.id
INNER JOIN TASKEVENT te2 on te2.taskid=te.taskid and te2.logtime in

(select tetmp.logtime from taskevent as tetmp where tetmp.logtime&gt;te.logtime and te.taskid=tetmp.taskid)

where te.userid is not null and te.userid  &lt;&gt;''</pre></div><p>Starting from this data provider query, we are going to define two KPIs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Total time spent on tasks by the user</li><li class="listitem" style="list-style-type: disc">Total number of tasks performed by the user</li></ul></div></div><div class="section" title="Adding the data provider"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec72"/>Adding the data provider</h2></div></div></div><p>Log into the<a id="id431" class="indexterm"/> KIE workbench (admin/admin) and head to <span class="strong"><strong>Business Dashboard</strong></span> (in the <span class="strong"><strong>Dashboards </strong></span>menu):</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Select the <span class="strong"><strong>Administration</strong></span> | <span class="strong"><strong>Data Providers</strong></span> link from the left navigation menu pane.</li><li class="listitem">Create a new data provider: <span class="strong"><strong>name</strong></span>=<code class="literal">pizzerianapoli</code>, <span class="strong"><strong>type</strong></span>=<code class="literal">SQL query</code>, and as the <span class="strong"><strong>Query</strong></span> field, paste the preceding SQL query; on pressing the <span class="strong"><strong>Attempt data load</strong></span> button, the following message should appear:<div class="informalexample"><pre class="programlisting">SQL provider data load configuration is correct!
Elapsed time to execute query: 5189 ms
Number of entries: 50</pre></div></li></ol></div><p>The <span class="strong"><strong>Number of entries:50</strong></span> message confirms that the query result is correct: 10 processes with five tasks each gives 50 tasks. Click <span class="strong"><strong>Save</strong></span> to confirm the data provider setting. Clicking <a id="id432" class="indexterm"/>on the <span class="strong"><strong>Edit data providers</strong></span> button will open the data provider list of the defined columns:</p><div class="mediaobject"><img src="graphics/9578OS_04_07.jpg" alt="Adding the data provider"/></div><p>We are now ready to define the KPIs, but before that, we need a new blank page on the dashboard on which we are going to place the charts.</p></div><div class="section" title="Creating a new dashboard page and the KPI panels"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec73"/>Creating a new dashboard page and the KPI panels</h2></div></div></div><p>Let us create a<a id="id433" class="indexterm"/> dashboard page that is going to host the charts.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a<a id="id434" class="indexterm"/> new page by clicking the <span class="strong"><strong>blank page</strong></span> icon next to the <span class="strong"><strong>Page</strong></span> list in the dashboard top toolbar (see the following screenshot):<div class="mediaobject"><img src="graphics/9578OS_04_08.jpg" alt="Creating a new dashboard page and the KPI panels"/></div></li><li class="listitem">Set the page settings (check the following screenshot), and click the <span class="strong"><strong>Create new page</strong></span> button:<div class="mediaobject"><img src="graphics/9578OS_04_09.jpg" alt="Creating a new dashboard page and the KPI panels"/></div></li><li class="listitem">Click on the new page in the left navigation menu, insert the page URL in <span class="strong"><strong>Page properties</strong></span>, and save changes.</li><li class="listitem">Go back<a id="id435" class="indexterm"/> to the workspace and select the new page from the top page dropdown list; then, select the <span class="strong"><strong>Create a new panel in </strong></span><a id="id436" class="indexterm"/><span class="strong"><strong>current page</strong></span> item; a list with all of the available panels will pop up.<div class="mediaobject"><img src="graphics/9578OS_04_10.jpg" alt="Creating a new dashboard page and the KPI panels"/></div></li><li class="listitem">Drag the <span class="strong"><strong>Create Panel</strong></span> item (on top of the <span class="strong"><strong>Components</strong></span> list) and drop it on the highlighted target page panel that you wish your KPI to display; the dropped item<a id="id437" class="indexterm"/> prompts you for the source data provider. Selecting our <code class="literal">pizzerianapoli</code> data provider brings the KPI configuration panel to the front.</li></ol></div><p>The relevant settings details for the KPIs are as follows:</p><p>
<span class="strong"><strong>Total time spent on</strong></span>
<a id="id438" class="indexterm"/>
<span class="strong"><strong> tasks by the user</strong></span> KPI configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Data provider</strong></span>: pizzerianapoli</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>KPI name</strong></span>: Total Time spent on Tasks by User (ms)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bar Chart</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Domain (X Axis)</strong></span>: userid</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Range (Y Axis)</strong></span>: elapsed; Edit Range (Scalar function: sum)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Renderer</strong></span>: Open Flash</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Chart type</strong></span>: Box with perimeters</li></ul></div><p>
<span class="strong"><strong>Number of tasks performed by the user</strong></span> KPI configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Data provider</strong></span>: pizzerianapoli</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>KPI name</strong></span>: Tasks By User</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Bar Chart</strong></span></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Domain (X Axis)</strong></span>: userid</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Range (Y Axis)</strong></span>: taskname; Edit Range (Scalar function: count)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Renderer</strong></span>: NVD3<div class="mediaobject"><img src="graphics/9578OS_04_11.jpg" alt="Creating a new dashboard page and the KPI panels"/></div></li></ul></div></div><div class="section" title="Notes"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec74"/>Notes</h2></div></div></div><p>As we previously highlighted, the audit data elapsed times are denoted in milliseconds; this makes it<a id="id439" class="indexterm"/> possible to simulate random delays and avoids taking ages to run the test.</p><p>Given the randomness of the delays and the "make pizza" task assignments (both Mario and Luigi are potential owners of the same tasks), you might have different audit data; elapsed times and total tasks for Mario and Luigi will change for each test execution.</p><p>The unit test, however, always makes Luigi slower than Mario, so the overall KPI value never changes.</p><p>Of particular note in the two KPIs is the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Mario is the fastest pizza maker</li><li class="listitem" style="list-style-type: disc">Maria is the busiest employee (20 tasks: 10 order assignments + 10 delivery assignments); she must definitely improve her efficiency in order to not slow down the two pizza makers (waiting for her order assignments) and the pizzaboy (waiting for the delivery orders)</li></ul></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec29"/>Summary</h1></div></div></div><p>In this chapter, we explored the jBPM management features, discussing the new Git and Maven integration for project development and Kie module deployment, respectively. You should have a better understanding of the jBPM module management, and you should be able to create and configure BAM charts starting from the jBPM auditing data thanks to the off-the-shelf Red Hat Dashboard tool. The next chapter will dive into BPMN constructs and will provide you with practical process definition examples.</p></div></body></html>