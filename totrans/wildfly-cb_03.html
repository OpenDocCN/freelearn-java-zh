<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Running WildFly in Domain Mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Running WildFly in Domain Mode</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Running domain mode</li><li class="listitem" style="list-style-type: disc">Connecting the host controller to the domain controller</li><li class="listitem" style="list-style-type: disc">Stopping and starting server groups via the Web Console</li><li class="listitem" style="list-style-type: disc">Stopping and starting your server groups via the CLI</li><li class="listitem" style="list-style-type: disc">Stopping and starting your servers via the CLI</li><li class="listitem" style="list-style-type: disc">Deploying and undeploying an application to a specific server group via Web Console</li><li class="listitem" style="list-style-type: disc">Deploying and undeploying an application to a specific server group via the CLI</li><li class="listitem" style="list-style-type: disc">Checking server status via the CLI</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec32"/>Introduction</h1></div></div></div><p>In this chapter, you will learn how to manage WildFly running in the domain mode. You will also learn how to configure and manage it, via both CLI and Web Console. We will also recap some topics covered in the standalone chapter adapted for the domain mode. If you want to know about the following topics, you can refer to the <span class="emphasis"><em>Appendix</em></span> section of this book:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Domain mode and the server groups</li><li class="listitem" style="list-style-type: disc">Understanding the structure of <code class="literal">domain.xml</code></li><li class="listitem" style="list-style-type: disc">Understanding the structure of <code class="literal">host.xml</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note14"/>Note</h3><p>In this chapter, all examples and recipes use the WildFly installation described in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>, which is linked to the <code class="literal">$WILDFLY_HOME</code> variable.</p></div></div></div></div>
<div class="section" title="Running domain mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec33"/>Running domain mode</h1></div></div></div><p>In this recipe, we will <a id="id165" class="indexterm"/>learn how to run WildFly in the domain mode. There are a few concepts that you need to be aware of—domain controller, host <a id="id166" class="indexterm"/>controller and server group. However, those concepts are all explained in the <span class="emphasis"><em>Appendix</em></span> section of this book.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec71"/>Getting ready</h2></div></div></div><p>WildFly comes with pre-configured <code class="literal">domain.xml</code> and <code class="literal">host.xml</code> files. There are two defined server groups: one named <code class="literal">main-server-group</code> referencing the <code class="literal">full</code> profile; the other one named <code class="literal">other-server-group</code> referencing the <code class="literal">full-ha</code> profile.</p><div class="mediaobject"><img src="graphics/3744_03_01.jpg" alt="Getting ready"/><div class="caption"><p>Server groups in domain.xml</p></div></div><p>Each server group is then referenced into the <code class="literal">host.xml</code> file by a list of servers or hosts.</p><div class="mediaobject"><img src="graphics/3744_03_02.jpg" alt="Getting ready"/><div class="caption"><p>Servers declared in host.xml</p></div></div><p>As you can see from the preceding XML code snippet, each server definition references the server-group membership using the attribute <code class="literal">group</code>. Also, the <code class="literal">auto-start</code> attribute defines whether the server <a id="id167" class="indexterm"/>will start automatically, or whether it needs a manual <a id="id168" class="indexterm"/>startup from the Admin Console or via CLI.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec72"/>How to do it…</h2></div></div></div><p>Just open your command line and launch WildFly in the domain mode as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/domain.sh
...
22:22:53,403 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
22:22:53,525 INFO  [org.jboss.as.process.Host Controller.status] (main) WFLYPC0018: Starting process 'Host Controller'
[Host Controller] Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
[Host Controller] 22:22:53,960 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
[Host Controller] 22:22:54,131 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
[Host Controller] 22:22:54,168 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
...
22:22:56,441 INFO  [org.jboss.as.process.Server:server-one.status] (ProcessController-threads - 3) WFLYPC0018: Starting process 'Server:server-one'
...
[Host Controller] 22:22:58,352 INFO  [org.jboss.as.domain.controller.mgmt] (Remoting "master:MANAGEMENT" task-4) WFLYHC0021: Server [Server:server-one] connected using connection [Channel ID 075c2e34 (inbound) of Remoting connection 2865b4ba to /127.0.0.1:37199]
[Host Controller] 22:22:58,407 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0023: Starting server server-two
[Host Controller] 22:22:58,444 INFO  [org.jboss.as.host.controller] (server-registration-threads - 1) WFLYHC0020: Registering server server-one
22:22:58,457 INFO  [org.jboss.as.process.Server:server-two.status] (ProcessController-threads - 3) WFLYPC0018: Starting process 'Server:server-two'
...
[Server:server-one] 22:23:04,175 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 7642ms - Started 229 of 405 services (217 services are lazy, passive or on-demand)
...
[Server:server-two] 22:23:07,024 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 8229ms - Started 229 of 405 services (217 services are lazy, passive or on-demand)</pre></div><p>Accessing the Admin Console <a id="id169" class="indexterm"/>you can see <span class="strong"><strong>server-one</strong></span> and <a id="id170" class="indexterm"/><span class="strong"><strong>server-two</strong></span> up and running, while <span class="strong"><strong>server-three</strong></span> is still stopped, as depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_03_03.jpg" alt="How to do it…"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec73"/>How it works…</h2></div></div></div><p>When you start WildFly in the domain mode, the script starts WildFly which looks for its default configuration files. By default, it looks for the <code class="literal">domain.xml</code> and the <code class="literal">host.xml</code> files. When WildFly finds those two files, it parses them, and it starts taking up all the services needed and declared by the configuration files.</p><p>At the OS level, when you start WildFly in the domain mode, you are actually starting a process called <code class="literal">Process Controller</code>, which has to start another process called <code class="literal">Host Controller</code>. The <code class="literal">Host Controller</code> is responsible for managing the server configuration and for starting the <a id="id171" class="indexterm"/>WildFly instances, the servers, declared in the <code class="literal">host.xml</code> file.</p><p>As per <a id="id172" class="indexterm"/>
<a class="ulink" href="https://weblogs.java.net/blog/arungupta/archive/2014/05/30/wildfly-managed-domain-raspberry-pi-tech-tip-27">https://weblogs.java.net/blog/arungupta/archive/2014/05/30/wildfly-managed-domain-raspberry-pi-tech-tip-27</a>,</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>One Host Controller instance is configured to act as the Domain Controller. The Host Controller on each host, meant as remote server (either physical or virtual), interacts with the Domain Controller to control the lifecycle of the application server instances running on its host and to assist the Domain Controller in managing them.</em></span></p></blockquote></div><p>If you check the <a id="id173" class="indexterm"/>processes running at the OS level, you can see the following:</p><div class="informalexample"><pre class="programlisting">wildfly   <span class="strong"><strong>1525</strong></span>  <span class="strong"><strong>1429</strong></span>  7 08:26 ?        00:00:01 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Process Controller</strong></span>] -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/process-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.process-controller -jboss-home /home/wildfly/WFC/wildfly -jvm /home/wildfly/WFC/jdk8/bin/java -mp /home/wildfly/WFC/wildfly/modules -- -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/host-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -- -default-jvm /home/wildfly/WFC/jdk8/bin/java
wildfly   <span class="strong"><strong>1542</strong></span>  <span class="strong"><strong>1525</strong></span> 62 08:26 ?        00:00:10 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Host Controller</strong></span>] -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/host-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.host-controller -mp /home/wildfly/WFC/wildfly/modules --pc-address 127.0.0.1 --pc-port 56310 -default-jvm /home/wildfly/WFC/jdk8/bin/java -Djboss.home.dir=/home/wildfly/WFC/wildfly
wildfly   <span class="strong"><strong>1611</strong></span>  <span class="strong"><strong>1525</strong></span> 99 08:26 ?        00:00:22 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Server:server-one</strong></span>] -Xms64m -Xmx512m -server -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true -Djboss.home.dir=/home/wildfly/WFC/wildfly -Djboss.modules.system.pkgs=org.jboss.byteman -Djboss.server.log.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/log -Djboss.server.temp.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/tmp -Djboss.server.data.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/data -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/servers/server-one/data/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.server
wildfly   <span class="strong"><strong>1657</strong></span>  <span class="strong"><strong>1525</strong></span> 99 08:26 ?        00:00:22 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Server:server-two</strong></span>] -Xms64m -Xmx512m -server -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true -Djboss.home.dir=/home/wildfly/WFC/wildfly -Djboss.modules.system.pkgs=org.jboss.byteman -Djboss.server.log.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/log -Djboss.server.temp.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/tmp -Djboss.server.data.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/data -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/servers/server-two/data/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.server</pre></div><p>In the previous console output, I emphasized the process IDs and their JVM names, summarizing the following:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Process ID</p>
</th><th style="text-align: left" valign="bottom">
<p>Parent PID</p>
</th><th style="text-align: left" valign="bottom">
<p>JVM name</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">1525</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">1429</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">Process Controller</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the main process responsible for creating the host controller and launching the servers. It is also responsible for recreating the host controller, in case it crashes.</p>
<p>Its parent PID is the <code class="literal">domain.sh</code> bash script process, that originated it.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">1542</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">1525</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">Host Controller</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the process that manages all the hosts defined within the <code class="literal">host.xml</code> file.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">1611</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">1525</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">Server:server-one</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the JVM for the host named <code class="literal">server-one</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">1657</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">1525</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">Server:server-two</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the JVM for the host named <code class="literal">server-two</code>.</p>
</td></tr></tbody></table></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec74"/>There's more...</h2></div></div></div><p>As described in the description of the JVM named <code class="literal">Process Controller</code>, this is the main process that generates the host controller and the WildFly instances, named <code class="literal">server-one</code> and <code class="literal">server-two</code>. At the OS level, this means that if the PC crashes, all its child processes will also go down.</p><p>Instead, if the <code class="literal">Host Controller</code> crashes, nothing happens to the real WildFly instances, they just keep on running and serving your clients. Furthermore, when the <code class="literal">Host Controller</code> crashes, the <code class="literal">Process Controller</code> is responsible to start it up again. Let me show you.</p><p>Within a different terminal, kill the process with the ID that matches the <code class="literal">Host Controller</code>, which in this case is <code class="literal">1542</code>:</p><div class="informalexample"><pre class="programlisting">$ kill -9 1542</pre></div><p>Within the terminal where you <a id="id174" class="indexterm"/>launched WildFly in the domain <a id="id175" class="indexterm"/>mode, you should see log entries as follows:</p><div class="informalexample"><pre class="programlisting">[Host Controller]
08:30:41,738 INFO  [org.jboss.as.process.Host Controller.status] (reaper for Host Controller) WFLYPC0011: Process 'Host Controller' finished with an exit status of 137
08:30:41,740 INFO  [org.jboss.as.process-controller.server] (reaper for Host Controller) WFLYPC0021: Waiting 1 seconds until trying to restart process Host Controller.
08:30:42,742 INFO  [org.jboss.as.process.Host Controller.status] (reaper for Host Controller) WFLYPC0018: Starting process 'Host Controller'
[Host Controller] Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
[Host Controller] 08:30:43,205 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
[Host Controller] 08:30:43,376 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
[Host Controller] 08:30:43,414 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
[Host Controller] 08:30:44,005 INFO  [org.xnio] (MSC service thread 1-1) XNIO version 3.3.0.Final
[Host Controller] 08:30:44,007 INFO  [org.jboss.as] (Controller Boot Thread) WFLYHC0003: Creating http management service using network interface (management) port (9990) securePort (-1)
[Host Controller] 08:30:44,014 INFO  [org.xnio.nio] (MSC service thread 1-1) XNIO NIO Implementation Version 3.3.0.Final
[Host Controller] 08:30:44,146 INFO  [org.jboss.remoting] (MSC service thread 1-1) JBoss Remoting version 4.0.8.Final
[Host Controller] 08:30:44,178 INFO  [org.jboss.as.remoting] (MSC service thread 1-6) WFLYRMT0001: Listening on 127.0.0.1:9999
[Host Controller] 08:30:45,096 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,151 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,159 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute default-stack is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,167 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,181 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,185 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute default-stack is deprecated, and it might be removed in future version!
[Host Controller] 08:30:45,485 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0018: Reconnecting server server-one
[Host Controller] 08:30:45,486 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0020: Registering server server-one
[Host Controller] 08:30:45,492 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0018: Reconnecting server server-two
[Host Controller] 08:30:45,492 INFO  [org.jboss.as.host.controller] (Controller Boot Thread) WFLYHC0020: Registering server server-two
[Host Controller] 08:30:45,507 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
[Host Controller] 08:30:45,509 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
[Host Controller] 08:30:45,509 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) (Host Controller) started in 2668ms - Started 50 of 52 services (15 services are lazy, passive or on-demand)
[Host Controller] 08:30:45,982 INFO  [org.jboss.as.domain.controller.mgmt] (Remoting "master:MANAGEMENT" task-7) WFLYHC0021: Server [Server:server-two] connected using connection [Channel ID 3d3f3eed (inbound) of Remoting connection 067bd212 to /127.0.0.1:43342]
[Host Controller] 08:30:45,982 INFO  [org.jboss.as.domain.controller.mgmt] (Remoting "master:MANAGEMENT" task-8) WFLYHC0021: Server [Server:server-one] connected using connection [Channel ID 1448766c (inbound) of Remoting connection 4261cbff to /127.0.0.1:42083]</pre></div><p>So, the <code class="literal">Process Controller</code> noticed that the <code class="literal">Host Controller</code> crashed, and it started a new <code class="literal">Host Controller</code>. The running WildFly instances reconnected successfully to their <code class="literal">Host Controller</code>.</p><p>Executing the command <code class="literal">ps -efa | grep java</code> again, you will get a list of processes like the previous ones, except <a id="id176" class="indexterm"/>for the <code class="literal">Host Controller</code> process, which <a id="id177" class="indexterm"/>will be new, as follows:</p><div class="informalexample"><pre class="programlisting">wildfly   <span class="strong"><strong>1525</strong></span>  <span class="strong"><strong>1429</strong></span>  1 08:26 ?        00:00:07 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Process Controller</strong></span>] -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/process-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.process-controller -jboss-home /home/wildfly/WFC/wildfly -jvm /home/wildfly/WFC/jdk8/bin/java -mp /home/wildfly/WFC/wildfly/modules -- -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/host-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -- -default-jvm /home/wildfly/WFC/jdk8/bin/java
wildfly   1611  1525  6 08:26 ?        00:00:29 /home/wildfly/WFC/jdk8/bin/java -D[Server:server-one] -Xms64m -Xmx512m -server -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true -Djboss.home.dir=/home/wildfly/WFC/wildfly -Djboss.modules.system.pkgs=org.jboss.byteman -Djboss.server.log.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/log -Djboss.server.temp.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/tmp -Djboss.server.data.dir=/home/wildfly/WFC/wildfly/domain/servers/server-one/data -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/servers/server-one/data/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.server
wildfly   1657  1525  6 08:26 ?        00:00:29 /home/wildfly/WFC/jdk8/bin/java -D[Server:server-two] -Xms64m -Xmx512m -server -Djava.awt.headless=true -Djava.net.preferIPv4Stack=true -Djboss.home.dir=/home/wildfly/WFC/wildfly -Djboss.modules.system.pkgs=org.jboss.byteman -Djboss.server.log.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/log -Djboss.server.temp.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/tmp -Djboss.server.data.dir=/home/wildfly/WFC/wildfly/domain/servers/server-two/data -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/servers/server-two/data/logging.properties -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.server
wildfly   <span class="strong"><strong>2887</strong></span>  <span class="strong"><strong>1525</strong></span>  7 08:30 ?        00:00:15 /home/wildfly/WFC/jdk8/bin/java -D[<span class="strong"><strong>Host Controller</strong></span>] -Dorg.jboss.boot.log.file=/home/wildfly/WFC/wildfly/domain/log/host-controller.log -Dlogging.configuration=file:/home/wildfly/WFC/wildfly/domain/configuration/logging.properties -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -jar /home/wildfly/WFC/wildfly/jboss-modules.jar -mp /home/wildfly/WFC/wildfly/modules org.jboss.as.host-controller -mp /home/wildfly/WFC/wildfly/modules --pc-address 127.0.0.1 --pc-port 56310 -default-jvm /home/wildfly/WFC/jdk8/bin/java -Djboss.home.dir=/home/wildfly/WFC/wildfly --process-restarted</pre></div></div></div>
<div class="section" title="Connecting the host controller to the domain controller"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec34"/>Connecting the host controller to the domain controller</h1></div></div></div><p>In this <a id="id178" class="indexterm"/>recipe, you will learn how to connect the host <a id="id179" class="indexterm"/>controller to the domain controller. We will refer to the domain controller as <code class="literal">master</code>, while we will refer to the host controllers as <code class="literal">slave</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec75"/>Getting ready</h2></div></div></div><p>The purpose of this recipe is to show how to run a domain controller, and a series of other host controllers (we will use two host controllers) that connect to it. Whether the domain controller is on the same machine or on a different one, the connection type is meant to be "remote".</p><p>For the recipe, we will simulate two machines defining different configuration folders for each server that we are going to use. This is also a good practice for the development environment, as you can test a pseudo production scenario. Nevertheless, as we will have a <code class="literal">Host Controller</code> process running along with a <code class="literal">Domain Controller</code> process, and because both are responsible for remote management, with the management interfaces settled by default to listen on <code class="literal">localhost:9990</code>, we will have to bind them differently for each host controller.</p><p>In <a class="link" href="ch02.html" title="Chapter 2. Running WildFly in Standalone Mode">Chapter 2</a>, <span class="emphasis"><em>Running WildFly in Standalone Mode</em></span>, we saw how to run multiple WildFly instances on the same machine but with different IPs or port numbers. Here we have to do the same thing. For brevity, we will see just how to bind the host controllers on different ports.</p><p>Lastly, the host controller that connects to the domain controller needs to be authenticated. For <a id="id180" class="indexterm"/>this reason, we will need to create a <a id="id181" class="indexterm"/>new user by running the <code class="literal">add-user.sh</code> script, providing the information as depicted in the following screenshot:</p><div class="mediaobject"><img src="graphics/3744_03_04.jpg" alt="Getting ready"/></div><p>This user belongs to the <span class="strong"><strong>ManagementRealm</strong></span>, the same that was used in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span> to create the <code class="literal">wildfly</code> user in order to access the Web Console.</p><p>Keep note of the last line, the characters in red, that we will use later in the recipe.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec76"/>How to do it…</h2></div></div></div><p>First we need to create the <code class="literal">Domain Controller</code> and two <code class="literal">Host Controller</code> configuration folders. Let's create the structure of our directories:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your <a id="id182" class="indexterm"/>terminal and type as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a domain master
$ cp -a domain slave-1
$ cp -a domain slave-2
$ mv slave-1/configuration/domain.xml slave-1/configuration/domain.xml.unused
$ mv slave-2/configuration/domain.xml slave-2/configuration/domain.xml.unused</pre></div></li><li class="listitem">Now open the <code class="literal">domain.xml</code> file of the master directory and replace the <code class="literal">server-groups</code> declaration with the following XML code snippet:<div class="informalexample"><pre class="programlisting">&lt;server-groups&gt;
    &lt;server-group name="server-group-REST-app" profile="default"&gt;
        &lt;jvm name="default"&gt;
            &lt;heap size="64m" max-size="512m"/&gt;
        &lt;/jvm&gt;
        &lt;socket-binding-group ref="standard-sockets"/&gt;
    &lt;/server-group&gt;
    &lt;server-group name="server-group-SOAP-app" profile="default"&gt;
        &lt;jvm name="default"&gt;
            &lt;heap size="64m" max-size="512m"/&gt;
        &lt;/jvm&gt;
        &lt;socket-binding-group ref="standard-sockets"/&gt;
    &lt;/server-group&gt;
&lt;/server-groups&gt;</pre></div></li><li class="listitem">Here we are simulating a server group dedicated to host applications targeting the RESTful technology, and another server group dedicated to host applications targeting the SOAP technology. This is just an example. A server group might match with a particular application, or a technology (thus more applications); the choice is up to you. My suggestion is to be as consistent as <a id="id183" class="indexterm"/>possible when making such decisions.</li><li class="listitem">Edit the <code class="literal">host.xml</code> file of the <code class="literal">master</code> directory and remove the entire <code class="literal">servers</code> declaration. Once done, run the master as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/domain.sh -Djboss.domain.base.dir=master</pre></div></li><li class="listitem">The log should <a id="id184" class="indexterm"/>look as follows:<div class="informalexample"><pre class="programlisting">08:44:53,589 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
08:44:53,730 INFO  [org.jboss.as.process.Host Controller.status] (main) WFLYPC0018: Starting process 'Host Controller'
[Host Controller] Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
[Host Controller] 08:44:54,319 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
[Host Controller] 08:44:54,503 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
[Host Controller] 08:44:54,543 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
[Host Controller] 08:44:55,145 INFO  [org.xnio] (MSC service thread 1-5) XNIO version 3.3.0.Final
[Host Controller] 08:44:55,147 INFO  [org.jboss.as] (Controller Boot Thread) WFLYHC0003: Creating http management service using network interface (management) port (9990) securePort (-1)
[Host Controller] 08:44:55,155 INFO  [org.xnio.nio] (MSC service thread 1-5) XNIO NIO Implementation Version 3.3.0.Final
[Host Controller] 08:44:55,262 INFO  [org.jboss.remoting] (MSC service thread 1-5) JBoss Remoting version 4.0.8.Final
[Host Controller] 08:44:55,301 INFO  [org.jboss.as.remoting] (MSC service thread 1-1) WFLYRMT0001: Listening on 127.0.0.1:9999
[Host Controller] 08:44:56,312 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,381 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,387 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute default-stack is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,400 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,413 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,419 INFO  [org.jboss.as.controller.management-deprecated] (Controller Boot Thread) WFLYCTL0028: Attribute default-stack is deprecated, and it might be removed in future version!
[Host Controller] 08:44:56,710 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
[Host Controller] 08:44:56,710 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
[Host Controller] 08:44:56,711 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) (Host Controller) started in 2825ms - Started 50 of 52 services (15 services are lazy, passive or on-demand)</pre></div><p>There are no running servers at all.</p><p>Now it's time to configure our first slave, <code class="literal">slave-1</code>.</p></li><li class="listitem">Edit the <a id="id185" class="indexterm"/><code class="literal">slave-1/configuration/host.xml</code> file and do the following:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Name <a id="id186" class="indexterm"/>the host as <code class="literal">slave-1</code>: <code class="literal">&lt;host name="slave-1" &gt;</code></li><li class="listitem" style="list-style-type: disc">Add the <code class="literal">hostcontroller</code> user's secret values inside the <code class="literal">ManagementRealm</code> definition:<div class="informalexample"><pre class="programlisting">&lt;server-identities&gt;
    &lt;secret value="aG9zdGNvbnRyb2xsZXIuMjAxNQ=="/&gt;
&lt;/server-identities&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Change the port number for the management-interfaces:<div class="informalexample"><pre class="programlisting">&lt;management-interfaces&gt;
  &lt;native-interface security-realm="ManagementRealm"&gt;
  &lt;socket interface="management" port="${jboss.management.native.port:19999}"/&gt;
    &lt;/native-interface&gt;
      &lt;http-interface security-realm="ManagementRealm" http-upgrade-enabled="true"&gt;
        &lt;socket interface="management" port="${jboss.management.http.port:19990}"/&gt;
     &lt;/http-interface&gt;
&lt;/management-interfaces&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Use a remote <code class="literal">domain-controller</code>:<div class="informalexample"><pre class="programlisting">&lt;domain-controller&gt;
    &lt;remote host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}" security-realm="ManagementRealm" username="hostcontroller"/&gt;
&lt;/domain-controller&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">Define the hosts:<div class="informalexample"><pre class="programlisting">&lt;servers&gt;
  &lt;server name="REST-server-one" group="server-group-REST-app"&gt;
    &lt;jvm name="default"&gt;
      &lt;heap size="64m" max-size="256m"/&gt;
    &lt;/jvm&gt;
  &lt;/server&gt;
&lt;/servers&gt;</pre></div></li></ul></div></li><li class="listitem">You should <a id="id187" class="indexterm"/>end up with a file that <a id="id188" class="indexterm"/>looks like the following XML code snippet:<div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;host name="slave-1" &gt;
  &lt;extensions&gt;
    &lt;extension module="org.jboss.as.jmx"/&gt;
  &lt;/extensions&gt;
  &lt;management&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ManagementRealm"&gt;
        &lt;server-identities&gt;
          &lt;secret value="aG9zdGNvbnRyb2xsZXIuMjAxNQ=="/&gt;
        &lt;/server-identities&gt;
        &lt;authentication&gt;
          &lt;local default-user="$local" skip-group-
            loading="true"/&gt;
          &lt;properties path="mgmt-users.properties" relative-
            to="jboss.domain.config.dir"/&gt;
        &lt;/authentication&gt;
        &lt;authorization map-groups-to-roles="false"&gt;
          &lt;properties path="mgmt-groups.properties" 
          relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authorization&gt;
      &lt;/security-realm&gt;
      &lt;security-realm name="ApplicationRealm"&gt;
        &lt;authentication&gt;
          &lt;local default-user="$local" allowed-users="*" 
          skip-group-loading="true"/&gt;
          &lt;properties path="application-users.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authentication&gt;
        &lt;authorization&gt;
          &lt;properties path="application-roles.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authorization&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
    &lt;audit-log&gt;
      &lt;formatters&gt;
        &lt;json-formatter name="json-formatter"/&gt;
      &lt;/formatters&gt;
      &lt;handlers&gt;
        &lt;file-handler name="host-file" formatter="json-formatter" relative-to="jboss.domain.data.dir" path="audit-log.log"/&gt;
        &lt;file-handler name="server-file" formatter="json-formatter" relative-to="jboss.server.data.dir" path="audit-log.log"/&gt;
      &lt;/handlers&gt;
      &lt;logger log-boot="true" log-read-only="false" enabled="false"&gt;
        &lt;handlers&gt;
          &lt;handler name="host-file"/&gt;
        &lt;/handlers&gt;
      &lt;/logger&gt;
      &lt;server-logger log-boot="true" log-read-only="false" enabled="false"&gt;
        &lt;handlers&gt;
          &lt;handler name="server-file"/&gt;
        &lt;/handlers&gt;
      &lt;/server-logger&gt;
    &lt;/audit-log&gt;
    &lt;management-interfaces&gt;
      &lt;native-interface security-realm="ManagementRealm"&gt;
        &lt;socket interface="management" 
        port="${jboss.management.native.port:19999}"/&gt;
      &lt;/native-interface&gt;
      &lt;http-interface security-realm="ManagementRealm" http-upgrade-enabled="true"&gt;
        &lt;socket interface="management" port="${jboss.management.http.port:19990}"/&gt;
      &lt;/http-interface&gt;
    &lt;/management-interfaces&gt;
  &lt;/management&gt;
  &lt;domain-controller&gt;
    &lt;remote protocol="remote" host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}" security-realm="ManagementRealm" username="hostcontroller" /&gt;
  &lt;/domain-controller&gt;
  &lt;interfaces&gt;
    &lt;interface name="management"&gt;
      &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="public"&gt;
      &lt;inet-address value="${jboss.bind.address:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="unsecure"&gt;
      &lt;!-- Used for IIOP sockets in the standard configuration.
        To secure JacORB you need to setup SSL --&gt;
      &lt;inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
  &lt;jvms&gt;
    &lt;jvm name="default"&gt;
      &lt;heap size="64m" max-size="256m"/&gt;
      &lt;permgen size="256m" max-size="256m"/&gt;
      &lt;jvm-options&gt;
        &lt;option value="-server"/&gt;
      &lt;/jvm-options&gt;
    &lt;/jvm&gt;
  &lt;/jvms&gt;
  &lt;servers&gt;
  &lt;server name="REST-server-one" group="server-group-REST-app"&gt;
  &lt;jvm name="default"&gt;
  &lt;heap size="64m" max-size="256m"/&gt;
  &lt;/jvm&gt;
  &lt;/server&gt;
  &lt;/servers&gt;
  &lt;profile&gt;
  &lt;subsystem &gt;
  &lt;expose-resolved-model/&gt;
  &lt;expose-expression-model/&gt;
  &lt;remoting-connector/&gt;
  &lt;/subsystem&gt;
  &lt;/profile&gt;
&lt;/host&gt;</pre></div></li><li class="listitem">Now we are <a id="id189" class="indexterm"/>ready to run our <code class="literal">slave-1</code> host:<div class="informalexample"><pre class="programlisting">$ ./bin/domain.sh -Djboss.domain.base.dir=slave-1 -Djboss.domain.master.address=127.0.0.1</pre></div></li><li class="listitem">If you check the log output from master, you will notice that <code class="literal">slave-1</code> registered itself to the <code class="literal">Domain Controller</code>:<div class="informalexample"><pre class="programlisting">[Host Controller] 23:45:58,523 INFO  [org.jboss.as.domain] (Host Controller Service Threads - 32) WFLYHC0019: Registered remote slave host "slave-1", JBoss WildFly Full 9.0.0.Beta2 (WildFly 1.0.0.Beta2)</pre></div></li><li class="listitem">Repeat the <a id="id190" class="indexterm"/>same changes for the second slave. Set the host name to <code class="literal">slave-2</code> and add the following servers definition:<div class="informalexample"><pre class="programlisting">&lt;servers&gt;
  &lt;server name="SOAP-server-one" group="server-group-SOAP-app"&gt;
    &lt;socket-bindings port-offset="150"/&gt;
  &lt;/server&gt;
  &lt;server name="SOAP-server-two" group="server-group-SOAP-app"&gt;
    &lt;socket-bindings port-offset="250"/&gt;
  &lt;/server&gt;
&lt;/servers&gt;</pre></div></li><li class="listitem">Also, set the <code class="literal">jboss.management.native.port</code> and <code class="literal">jboss.management.http.port</code> property default values, to <code class="literal">29999</code> and <code class="literal">29990</code> respectively. You should end up with a file that looks like the following XML code snippet:<div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;host name="slave-2" &gt;
  &lt;extensions&gt;
    &lt;extension module="org.jboss.as.jmx"/&gt;
  &lt;/extensions&gt;
  &lt;management&gt;
    &lt;security-realms&gt;
      &lt;security-realm name="ManagementRealm"&gt;
        &lt;server-identities&gt;
          &lt;secret value="aG9zdGNvbnRyb2xsZXIuMjAxNQ=="/&gt;
        &lt;/server-identities&gt;
        &lt;authentication&gt;
          &lt;local default-user="$local" skip-group-loading="true"/&gt;
          &lt;properties path="mgmt-users.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authentication&gt;
        &lt;authorization map-groups-to-roles="false"&gt;
          &lt;properties path="mgmt-groups.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authorization&gt;
      &lt;/security-realm&gt;
      &lt;security-realm name="ApplicationRealm"&gt;
        &lt;authentication&gt;
          &lt;local default-user="$local" allowed-users="*" skip-group-loading="true"/&gt;
          &lt;properties path="application-users.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authentication&gt;
        &lt;authorization&gt;
          &lt;properties path="application-roles.properties" relative-to="jboss.domain.config.dir"/&gt;
        &lt;/authorization&gt;
      &lt;/security-realm&gt;
    &lt;/security-realms&gt;
    &lt;audit-log&gt;
      &lt;formatters&gt;
        &lt;json-formatter name="json-formatter"/&gt;
      &lt;/formatters&gt;
      &lt;handlers&gt;
        &lt;file-handler name="host-file" formatter="json-formatter" relative-to="jboss.domain.data.dir" path="audit-log.log"/&gt;
        &lt;file-handler name="server-file" formatter="json-
        formatter" relative-to="jboss.server.data.dir" path="audit-log.log"/&gt;
      &lt;/handlers&gt;
      &lt;logger log-boot="true" log-read-only="false" enabled="false"&gt;
        &lt;handlers&gt;
          &lt;handler name="host-file"/&gt;
        &lt;/handlers&gt;
      &lt;/logger&gt;
      &lt;server-logger log-boot="true" log-read-only="false" 
      enabled="false"&gt;
        &lt;handlers&gt;
          &lt;handler name="server-file"/&gt;
        &lt;/handlers&gt;
      &lt;/server-logger&gt;
    &lt;/audit-log&gt;
    &lt;management-interfaces&gt;
      &lt;native-interface security-realm="ManagementRealm"&gt;
        &lt;socket interface="management" port="${jboss.management.native.port:29999}"/&gt;
      &lt;/native-interface&gt;
      &lt;http-interface security-realm="ManagementRealm" http-upgrade-enabled="true"&gt;
        &lt;socket interface="management" port="${jboss.management.http.port:29990}"/&gt;
      &lt;/http-interface&gt;
    &lt;/management-interfaces&gt;
  &lt;/management&gt;
  &lt;domain-controller&gt;
    &lt;remote protocol="remote" host="${jboss.domain.master.address}" port="${jboss.domain.master.port:9999}" security-realm="ManagementRealm" username="hostcontroller" /&gt;
  &lt;/domain-controller&gt;
  &lt;interfaces&gt;
    &lt;interface name="management"&gt;
      &lt;inet-address value="${jboss.bind.address.management:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="public"&gt;
      &lt;inet-address value="${jboss.bind.address:127.0.0.1}"/&gt;
    &lt;/interface&gt;
    &lt;interface name="unsecure"&gt;
      &lt;!-- Used for IIOP sockets in the standard 
      configuration.
        To secure JacORB you need to setup SSL --&gt;
      &lt;inet-address value="${jboss.bind.address.unsecure:127.0.0.1}"/&gt;
    &lt;/interface&gt;
  &lt;/interfaces&gt;
  &lt;jvms&gt;
    &lt;jvm name="default"&gt;
      &lt;heap size="64m" max-size="256m"/&gt;
      &lt;permgen size="256m" max-size="256m"/&gt;
      &lt;jvm-options&gt;
        &lt;option value="-server"/&gt;
      &lt;/jvm-options&gt;
    &lt;/jvm&gt;
  &lt;/jvms&gt;
  &lt;servers&gt;
  &lt;server name="SOAP-server-one" group="server-group-SOAP-app"&gt;
  &lt;socket-bindings port-offset="150"/&gt;
  &lt;/server&gt;
  &lt;server name="SOAP-server-two" group="server-group-SOAP-app"&gt;
  &lt;socket-bindings port-offset="250"/&gt;
  &lt;/server&gt;
  &lt;/servers&gt;
  &lt;profile&gt;
  &lt;subsystem &gt;
  &lt;expose-resolved-model/&gt;
  &lt;expose-expression-model/&gt;
  &lt;remoting-connector/&gt;
  &lt;/subsystem&gt;
  &lt;/profile&gt;
&lt;/host&gt;</pre></div></li><li class="listitem">Now we <a id="id191" class="indexterm"/>are ready to run our <code class="literal">slave-2</code> host:<div class="informalexample"><pre class="programlisting">$ ./bin/domain.sh -Djboss.domain.base.dir=slave-2 -Djboss.domain.master.address=127.0.0.1</pre></div></li><li class="listitem">If you check <a id="id192" class="indexterm"/>the log output from <code class="literal">master</code>, you will notice that <code class="literal">slave-2</code> registered itself to the <code class="literal">Domain Controller</code>:<div class="informalexample"><pre class="programlisting">[Host Controller] 23:51:34,134 INFO  [org.jboss.as.domain] (Host Controller Service Threads - 34) WFLYHC0019: Registered remote slave host "slave-2", JBoss WildFly Full 9.0.0.Beta2 (WildFly 1.0.0.Beta2)</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec77"/>How it works…</h2></div></div></div><p>Let's first talk about the master and then about the two slaves.</p><div class="section" title="Master"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec05"/>Master</h3></div></div></div><p>Within the master, you <a id="id193" class="indexterm"/>define the entire configuration needed to run your WildFly instances. You choose a profile depending on your requirements, set IPs, ports, server, and groups. Everything is persisted into the <code class="literal">domain.xml</code>, or whatever file you choose to persist to.</p><p>As you launch the <code class="literal">domain.sh</code> script, the process by default looks for a <code class="literal">domain.xml</code> file and <code class="literal">host.xml</code> file to read the configuration, starting from the <code class="literal">jboss.home.dir</code> (whatever <code class="literal">$WILDFLY_HOME</code> is) appending <code class="literal">domain</code> and <code class="literal">configuration</code>, unless you specify differently.</p><p>We specify differently by adding the <code class="literal">jboss.domain.base.dir</code> property valued to <code class="literal">master</code>. So WildFly, starting from <code class="literal">jboss.home.dir</code> appends <code class="literal">master</code> and the <code class="literal">configuration</code>. As per the standalone mode, WildFly in the domain mode lets you override different paths if necessary.</p><p>The following table summarizes all the properties:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property name</p>
</th><th style="text-align: left" valign="bottom">
<p>Usage</p>
</th><th style="text-align: left" valign="bottom">
<p>Default value</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.home.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The root directory of the WildFly installation.</p>
</td><td style="text-align: left" valign="top">
<p>Set by <code class="literal">domain.sh</code> to <code class="literal">$JBOSS_HOME</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.base.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The base directory for domain content.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.home.dir/domain</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.config.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The base configuration directory.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.base.dir/configuration</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.data.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used for persistent data file storage.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.base.dir/data</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.log.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory containing the <code class="literal">host-controller.log</code> and <code class="literal">process-controller.log</code> files</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.base.dir/log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.temp.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used for temporary file storage.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.base.dir/tmp</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.deployment.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used to store deployed content.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.data.dir/content</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.servers.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory containing the output for the managed server instances.</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.data.dir/servers</code>
</p>
</td></tr></tbody></table></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip05"/>Tip</h3><p>The master should run alone, without any servers.</p></div></div></div><div class="section" title="Slaves"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec06"/>Slaves</h3></div></div></div><p>As stated in the previous <a id="id194" class="indexterm"/>paragraph, when you launch WildFly in the domain mode, it looks, by default, for the <code class="literal">domain.xml</code> and <code class="literal">host.xml</code> files. As we are running the slaves, we do not want to load the <code class="literal">domain.xml</code>, that's why we moved it away (actually we renamed it as <code class="literal">domain.xml.unused</code>). So the start up process only picks up the <code class="literal">host.xml</code> file where we defined our servers and the server groups they belong to.</p><p>So basically, within the <code class="literal">host.xml</code> file we just defined our servers and the domain controller that they should connect to.</p><p>Furthermore, in the host <code class="literal">slave-2</code> we needed to specify a <code class="literal">port-offset</code>, because we already have a running instance on our local machine. Both <code class="literal">SOAP-server-one</code> and <code class="literal">SOAP-server-two</code> will increment their port bindings to 150 and 250, hence <code class="literal">8230</code> for the first http-connector and <code class="literal">8330</code> for the second http-connector. Also, we had to change the port number for the management-interfaces.</p><p>Lastly, we had to specify the domain controller which the slave will connect to, by passing the <code class="literal">-Djboss.domain.master.address=127.0.0.1</code> parameter.</p><p>The domain overview from the Admin Console looks like the following screenshot:</p><div class="mediaobject"><img src="graphics/3744_03_05.jpg" alt="Slaves"/><div class="caption"><p>Admin Console—domain overview</p></div></div></div></div></div>
<div class="section" title="Stopping and starting server groups via the Web Console"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec35"/>Stopping and starting server groups via the Web Console</h1></div></div></div><p>In this recipe, we <a id="id195" class="indexterm"/>will learn how to stop and start <a id="id196" class="indexterm"/>an entire server group using the Web <a id="id197" class="indexterm"/>Console. Since a server can belong to more than one server group, you might want to stop or start all servers at once, and <a id="id198" class="indexterm"/>thus stop or start the server group.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec78"/>Getting ready</h2></div></div></div><p>To be able to follow this recipe, we need to have completed the previous one. Thus, before we can begin, we need to start the master server and the slaves <code class="literal">slave-1</code> and <code class="literal">slave-2</code>. In three different terminals, navigate to the <code class="literal">$WILDFLY_HOME</code>, and run the following commands:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">$ ./bin/domain.sh -Djboss.domain.base.dir=master</code>.</li><li class="listitem"><code class="literal">./bin/domain.sh -Djboss.domain.base.dir=slave-1 -Djboss.domain.master.address=127.0.0.1</code>.</li><li class="listitem"><code class="literal">./bin/domain.sh -Djboss.domain.base.dir=slave-2 -Djboss.domain.master.address=127.0.0.1</code>.</li></ol></div><p>Now that everything <a id="id199" class="indexterm"/>is up and running, let's move ahead.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec79"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your <a id="id200" class="indexterm"/>browser and point it to the <a id="id201" class="indexterm"/>Admin Console: <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Enter the <a id="id202" class="indexterm"/>username and password (<code class="literal">wildfly</code> and <code class="literal">cookbook.2015</code> respectively) and go to the <span class="strong"><strong>Domain</strong></span> tab. You should see a page similar to the following screenshot:<div class="mediaobject"><img src="graphics/3744_03_05.jpg" alt="How to do it…"/><div class="caption"><p>Admin Console—domain overview</p></div></div></li><li class="listitem">Now, on <a id="id203" class="indexterm"/>hovering the mouse over the <a id="id204" class="indexterm"/><span class="strong"><strong>Groups</strong></span> box, the <a id="id205" class="indexterm"/>command links will <a id="id206" class="indexterm"/>appear as follows:<div class="mediaobject"><img src="graphics/3744_03_06.jpg" alt="How to do it…"/><div class="caption"><p>Server Group: Start, Stop and Restart</p></div></div></li><li class="listitem">Also, hovering <a id="id207" class="indexterm"/>on a server-box, the <a id="id208" class="indexterm"/>command links will <a id="id209" class="indexterm"/>appear as follows:<div class="mediaobject"><img src="graphics/3744_03_07.jpg" alt="How to do it…"/><div class="caption"><p>Start server group</p></div></div></li><li class="listitem">Now try hitting <a id="id210" class="indexterm"/>the <span class="strong"><strong>Stop Group</strong></span> <a id="id211" class="indexterm"/>command link and confirm the <a id="id212" class="indexterm"/>operation!</li><li class="listitem">Tadaaaa… pretty <a id="id213" class="indexterm"/>easy huh! The page updates the server instance icon and displays <span class="strong"><strong>Operation successful</strong></span> in the message board:<div class="mediaobject"><img src="graphics/3744_03_08.jpg" alt="How to do it…"/><div class="caption"><p>Stopping Server Group</p></div></div></li><li class="listitem">In the log, you <a id="id214" class="indexterm"/>should see entries <a id="id215" class="indexterm"/>similar to the following:<div class="informalexample"><pre class="programlisting">[Host Controller] 09:05:52,656 INFO  [org.jboss.as.host.controller] (Host Controller Service Threads - 9) WFLYHC0024: Stopping server REST-server-one
[Server:REST-server-one] 09:05:52,692 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 59) WFLYSRV0211: Suspending server
09:05:52,706 INFO  [org.jboss.as.process.Server:REST-server-one.status] (ProcessController-threads - 4) WFLYPC0019: Stopping process 'Server:REST-server-one'
[Server:REST-server-one] 09:05:52,714 INFO  [org.jboss.as.server] (Thread-2) WFLYSRV0220: Server shutdown has been requested.
[Server:REST-server-one] 09:05:52,732 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-13) WFLYJCA0010: Unbound data source [java:jboss/datasources/ExampleDS]
[Server:REST-server-one] 09:05:52,735 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-9) WFLYJCA0019: Stopped Driver service with driver-name = h2
[Server:REST-server-one] 09:05:52,736 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-16) WFLYUT0019: Host default-host stopping
[Server:REST-server-one] 09:05:52,745 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0008: Undertow HTTP listener default suspending
[Server:REST-server-one] 09:05:52,750 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0007: Undertow HTTP listener default stopped, was bound to /127.0.0.1:8080
[Server:REST-server-one] 09:05:52,752 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0004: Undertow 1.2.0.Beta10 stopping
[Host Controller] 09:05:52,783 INFO  [org.jboss.as.host.controller] (Remoting "slave-1:MANAGEMENT" task-11) WFLYHC0027: Unregistering server REST-server-one
[Server:REST-server-one] 09:05:52,853 INFO  [org.jboss.as] (MSC service thread 1-4) WFLYSRV0050: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) stopped in 112ms
[Server:REST-server-one]
09:05:52,902 INFO  [org.jboss.as.process.Server:REST-server-one.status] (reaper for Server:REST-server-one) WFLYPC0011: Process 'Server:REST-server-one' finished with an exit status of 0
[Host Controller] 09:05:52,941 INFO  [org.jboss.as.host.controller] (ProcessControllerConnection-thread - 2) WFLYHC0027: Unregistering server REST-server-one</pre></div></li><li class="listitem">Let's restart the <a id="id216" class="indexterm"/>server group, by <a id="id217" class="indexterm"/>hitting the <span class="strong"><strong>Start Group</strong></span> <a id="id218" class="indexterm"/>command link, as <a id="id219" class="indexterm"/>follows:<div class="mediaobject"><img src="graphics/3744_03_09.jpg" alt="How to do it…"/></div></li><li class="listitem">Once <a id="id220" class="indexterm"/>restarted, WildFly confirms the <a id="id221" class="indexterm"/>successful operation by <a id="id222" class="indexterm"/>providing you with a <a id="id223" class="indexterm"/>message feedback and by updating the status icon associated to the servers belonging to the server group, as follows:<div class="mediaobject"><img src="graphics/3744_03_10.jpg" alt="How to do it…"/><div class="caption"><p>Start Sever Group</p></div></div></li><li class="listitem">The entries in <a id="id224" class="indexterm"/>the log of <code class="literal">slave-1</code> <a id="id225" class="indexterm"/>are as follows:<div class="informalexample"><pre class="programlisting">[Host Controller] 09:08:46,327 INFO  [org.jboss.as.host.controller] (Host Controller Service Threads - 13) WFLYHC0023: Starting server REST-server-one
09:08:46,404 INFO  [org.jboss.as.process.Server:REST-server-one.status] (ProcessController-threads - 5) WFLYPC0018: Starting process 'Server:REST-server-one'
[Server:REST-server-one] 09:08:46,859 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
[Server:REST-server-one] 09:08:47,135 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
[Server:REST-server-one] 09:08:47,243 INFO  [org.jboss.as] (MSC service thread 1-8) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
[Server:REST-server-one] 09:08:47,347 INFO  [org.xnio] (MSC service thread 1-4) XNIO version 3.3.0.Final
[Server:REST-server-one] 09:08:47,356 INFO  [org.xnio.nio] (MSC service thread 1-4) XNIO NIO Implementation Version 3.3.0.Final
[Server:REST-server-one] 09:08:47,383 INFO  [org.jboss.remoting] (MSC service thread 1-4) JBoss Remoting version 4.0.8.Final
[Host Controller] 09:08:48,065 INFO  [org.jboss.as.domain.controller.mgmt] (Remoting "slave-1:MANAGEMENT" task-13) WFLYHC0021: Server [Server:REST-server-one] connected using connection [Channel ID 312ade53 (inbound) of Remoting connection 277898d9 to /127.0.0.1:34603]
[Host Controller] 09:08:48,103 INFO  [org.jboss.as.host.controller] (server-registration-threads - 1) WFLYHC0020: Registering server REST-server-one
[Server:REST-server-one] 09:08:48,749 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 28) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
[Server:REST-server-one] 09:08:48,845 WARN  [org.jboss.as.txn] (ServerService Thread Pool -- 33) WFLYTX0013: Node identifier property is set to the default value. Please make sure it is unique.
[Server:REST-server-one] 09:08:48,845 INFO  [org.jboss.as.security] (ServerService Thread Pool -- 35) WFLYSEC0002: Activating Security Subsystem
[Server:REST-server-one] 09:08:48,846 INFO  [org.jboss.as.webservices] (ServerService Thread Pool -- 19) WFLYWS0002: Activating WebServices Extension
[Server:REST-server-one] 09:08:48,850 INFO  [org.jboss.as.security] (MSC service thread 1-15) WFLYSEC0001: Current PicketBox version=4.9.0.Beta2
[Server:REST-server-one] 09:08:49,427 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 49) WFLYCLINF0001: Activating Infinispan subsystem.
[Server:REST-server-one] 09:08:49,434 INFO  [org.jboss.as.naming] (ServerService Thread Pool -- 41) WFLYNAM0001: Activating Naming Subsystem
[Server:REST-server-one] 09:08:49,443 INFO  [org.jboss.as.connector] (MSC service thread 1-13) WFLYJCA0009: Starting JCA Subsystem (IronJacamar 1.2.3.Final)
[Server:REST-server-one] 09:08:49,464 INFO  [org.jboss.as.jsf] (ServerService Thread Pool -- 43) WFLYJSF0007: Activated the following JSF Implementations: [main]
[Server:REST-server-one] 09:08:49,498 INFO  [org.wildfly.extension.io] (ServerService Thread Pool -- 50) WFLYIO001: Worker 'default' has auto-configured to 16 core threads with 128 task threads based on your 8 available processors
[Server:REST-server-one] 09:08:49,537 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 32) WFLYUT0003: Undertow 1.2.0.Beta10 starting
[Server:REST-server-one] 09:08:49,537 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-14) WFLYUT0003: Undertow 1.2.0.Beta10 starting
[Server:REST-server-one] 09:08:49,550 INFO  [org.jboss.as.connector.subsystems.datasources] (ServerService Thread Pool -- 53) WFLYJCA0004: Deploying JDBC-compliant driver class org.h2.Driver (version 1.3)
[Server:REST-server-one] 09:08:49,566 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-8) WFLYJCA0018: Started Driver service with driver-name = h2
[Server:REST-server-one] 09:08:49,686 INFO  [org.jboss.as.naming] (MSC service thread 1-15) WFLYNAM0003: Starting Naming Service
[Server:REST-server-one] 09:08:49,698 INFO  [org.jboss.as.mail.extension] (MSC service thread 1-7) WFLYMAIL0001: Bound mail session [java:jboss/mail/Default]
[Server:REST-server-one] 09:08:49,777 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 32) WFLYUT0014: Creating file handler for path /home/wildfly/WFC/wildfly/welcome-content
[Server:REST-server-one] 09:08:49,916 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0012: Started server default-server.
[Server:REST-server-one] 09:08:49,933 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0018: Host default-host starting
[Server:REST-server-one] 09:08:50,029 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8080
[Server:REST-server-one] 09:08:50,170 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-16) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
[Server:REST-server-one] 09:08:50,440 INFO  [org.jboss.ws.common.management] (MSC service thread 1-10) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
[Server:REST-server-one] 09:08:50,733 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 4228ms - Started 193 of 370 services (207 services are lazy, passive or on-demand)</pre></div></li></ol></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec80"/>There's more...</h2></div></div></div><p>The same operations <a id="id226" class="indexterm"/>apply while stopping and <a id="id227" class="indexterm"/>starting a single server instance.</p><p>In the <code class="literal">host.xml</code> file <a id="id228" class="indexterm"/>you can define the <code class="literal">auto-start</code> attribute, the default value of which is <code class="literal">true</code>. Setting it to <code class="literal">false</code> will not start the server, and <a id="id229" class="indexterm"/>you will have to start it manually <a id="id230" class="indexterm"/>via the Admin Console or via CLI.</p><div class="informalexample"><pre class="programlisting">&lt;server name="REST-server-one" group="server-group-REST-app" auto-start="true"&gt;
    &lt;jvm name="default"&gt;
    &lt;heap size="64m" max-size="256m"/&gt;
&lt;/jvm&gt;
&lt;/server&gt;</pre></div><p>In this regard, let's try the CLI which is more fascinating!</p></div></div>
<div class="section" title="Stopping and starting your server groups via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec36"/>Stopping and starting your server groups via the CLI</h1></div></div></div><p>In this <a id="id231" class="indexterm"/>recipe, we will learn how to stop and start an entire <a id="id232" class="indexterm"/>server group using the CLI. Since a server <a id="id233" class="indexterm"/>can belong to more than one server group, you <a id="id234" class="indexterm"/>might want to stop or start all the servers at once, and thus stop or start the server group.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec81"/>Getting ready</h2></div></div></div><p>For this recipe, both the domain controller and host controllers should be up and running. For their configuration, refer to the recipe <span class="emphasis"><em>Connecting the host controller to the domain controller</em></span> in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec82"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your terminal and do as follows:<div class="mediaobject"><img src="graphics/3744_03_11.jpg" alt="How to do it…"/></div></li><li class="listitem">With the command <code class="literal">ls</code>, you can list the entire context that you walk through. What we want to do is to "stop" the entire server group named <code class="literal">server-group-REST-app</code>:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /server-group=server-group-REST-app:stop-servers()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}
[domain@localhost:9990 /]</pre></div></li><li class="listitem">Now let's start <a id="id235" class="indexterm"/>the server-group again, by <a id="id236" class="indexterm"/>invoking the <code class="literal">start-servers</code> <a id="id237" class="indexterm"/>method:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /server-group=server-group-REST-app:start-servers()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}
[domain@localhost:9990 /]</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec83"/>How it works...</h2></div></div></div><p>In the CLI, you have basically remapped the entire configuration, hence, if you look at the <code class="literal">domain.xml</code> or <code class="literal">host.xml</code> files, you find pretty much the same hierarchy.</p><p>In our recipe we wanted <a id="id238" class="indexterm"/>to stop a server group, so if you look at <a id="id239" class="indexterm"/>the <code class="literal">domain.xml</code> you can determine the <a id="id240" class="indexterm"/>contexts and commands – you can see the available <a id="id241" class="indexterm"/>commands by hitting the <span class="emphasis"><em>Tab</em></span> key next to <code class="literal">:</code> or <code class="literal">/</code>.</p></div></div>
<div class="section" title="Stopping and starting your servers via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec37"/>Stopping and starting your servers via the CLI</h1></div></div></div><p>In this <a id="id242" class="indexterm"/>recipe, we will learn how to stop and start a single <a id="id243" class="indexterm"/>server that belongs to a server group using the CLI. Because <a id="id244" class="indexterm"/>servers that belong to a server group might be spread <a id="id245" class="indexterm"/>over a series of different machines, with different resources available, you might need to stop a single server, without stopping the entire server group to add more resources and start it up back again. Fortunately, WildFly provides such granularity with regards to stop servers.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec84"/>Getting ready</h2></div></div></div><p>For this recipe, both the domain controller and host controllers should be up and running. For their configuration, refer to the recipe <span class="emphasis"><em>Connecting the host controller to the domain controller</em></span> in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec85"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your terminal and do as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect

[domain@localhost:9990 /]</pre></div></li><li class="listitem">What we want to do is to "stop" the server named <code class="literal">REST-server-one</code>, which belongs to the <code class="literal">Host Controller</code> named <code class="literal">slave-1</code>. This is done as follows:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /host=slave-1/server-config=REST-server-one:stop()
{
    "outcome" =&gt; "success",
    "result" =&gt; "<span class="strong"><strong>STOPPING</strong></span>"
}
[domain@localhost:9990 /]</pre></div><p>As you can see, the server is in the <code class="literal">STOPPING</code> state; this means it may take a while depending on how many resources you have bound and/or deployed.</p></li><li class="listitem">To check if it <a id="id246" class="indexterm"/>is done, try the following <a id="id247" class="indexterm"/>command:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /host=slave-1/server-config=REST-server-one:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "auto-start" =&gt; true,
        "cpu-affinity" =&gt; undefined,
        "group" =&gt; "server-group-REST-app",
        "name" =&gt; "REST-server-one",
        "priority" =&gt; undefined,
        "socket-binding-group" =&gt; undefined,
        "socket-binding-port-offset" =&gt; 0,
        "status" =&gt; "STOPPED",
        "interface" =&gt; undefined,
        "jvm" =&gt; {"default" =&gt; undefined},
        "path" =&gt; undefined,
        "system-property" =&gt; undefined
    }
}
[domain@localhost:9990 /]</pre></div></li><li class="listitem">Now <a id="id248" class="indexterm"/>let's start the server again by invoking <a id="id249" class="indexterm"/>the <code class="literal">start</code> method:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /host=slave-1/server-config=REST-server-one:start()
{
    "outcome" =&gt; "success",
    "result" =&gt; "STARTING"
}
[domain@localhost:9990 /]</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec86"/>How it works…</h2></div></div></div><p>The <code class="literal">stop</code> command itself is pretty easy, and does not need much explanation. What is worth mentioning is that to be able to stop a server, you first need to know which host/slave it belongs to. What you can do is navigate through WildFly's structure, as follows:</p><div class="mediaobject"><img src="graphics/3744_03_12.jpg" alt="How it works…"/></div><p>Once you have located the server you want/need to stop, you can issue the <code class="literal">stop</code> command.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec87"/>There's more…</h2></div></div></div><p>When dealing with <a id="id250" class="indexterm"/>the <code class="literal">stop</code> and <code class="literal">start</code> commands, on both <code class="literal">server-group</code> <a id="id251" class="indexterm"/>and <code class="literal">server</code>, you can add the <code class="literal">blocking=true</code> <a id="id252" class="indexterm"/>option which basically hangs the commands until it's <a id="id253" class="indexterm"/>done. The command would be as follows:</p><div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] /host=slave-1/server-config=REST-server-one:start(blocking=true)</pre></div><p>In this way we know when the server completes the operation. Imagine a case where you are executing multiple CLI commands in sequence, and a command needs the previous operations to be carried out. Without the blocking flag enabled, the command will not work.</p></div></div>
<div class="section" title="Deploying and undeploying an application to a specific server group via Web Console"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec38"/>Deploying and undeploying an application to a specific server group via Web Console</h1></div></div></div><p>In this <a id="id254" class="indexterm"/>recipe, we will <a id="id255" class="indexterm"/>learn how to <a id="id256" class="indexterm"/>deploy and undeploy <a id="id257" class="indexterm"/>an application <a id="id258" class="indexterm"/>via the Web <a id="id259" class="indexterm"/>Console, and assign it to a server group.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec88"/>Getting ready</h2></div></div></div><p>For this recipe, both the domain controller and the host controllers should be up and running. For their configuration, refer to the recipe <span class="emphasis"><em>Connecting the host controller to the domain controller</em></span> in this chapter.</p><p>In this and the following recipe, we will need an application to test our configuration. For this recipe, we will need the application named <code class="literal">example</code> which you can find in my GitHub repository. If you skipped the "<span class="emphasis"><em>Managing applications using the deployments folder</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Running WildFly in Standalone Mode">Chapter 2</a>, <span class="emphasis"><em>Running WildFly in Standalone Mode</em></span>, please refer to it to download all the source code and projects that you will need.</p><p>To build the application, type as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME/github/wildfly-cookbook
$ cd example
$ mvn -e clean package</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec89"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <a id="id260" class="indexterm"/>your browser and point it to the Admin Console: <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Enter the <a id="id261" class="indexterm"/>username and password (<code class="literal">wildfly</code> and <code class="literal">cookbook.2015</code> respectively) <a id="id262" class="indexterm"/>and <a id="id263" class="indexterm"/>go to <span class="strong"><strong>Deployments</strong></span>. You should get a page similar to the following screenshot:<div class="mediaobject"><img src="graphics/3744_03_13.jpg" alt="How to do it…"/><div class="caption"><p>The manage deployments window</p></div></div></li><li class="listitem">Now to <a id="id264" class="indexterm"/>deploy <a id="id265" class="indexterm"/>an application, we first need to add it by clicking the <span class="strong"><strong>Add</strong></span> button <a id="id266" class="indexterm"/>and <a id="id267" class="indexterm"/>choosing <a id="id268" class="indexterm"/>your <a id="id269" class="indexterm"/>artifact, as shown in the following image:<div class="mediaobject"><img src="graphics/3744_03_14.jpg" alt="How to do it…"/><div class="caption"><p>Deploying the example.war application</p></div></div></li><li class="listitem">Now just <a id="id270" class="indexterm"/>follow <a id="id271" class="indexterm"/>the wizard instructions. You should end up with your artifact deployed, but <a id="id272" class="indexterm"/>not assigned to a <span class="strong"><strong>SERVER GROUPS</strong></span>, as shown in the following <a id="id273" class="indexterm"/>screenshot:<div class="mediaobject"><img src="graphics/3744_03_15.jpg" alt="How to do it…"/><div class="caption"><p>Application deployed but not assigned to any server-group</p></div></div><p>Within the domain controller's log you should see a log like the following:</p><div class="informalexample"><pre class="programlisting">[Host Controller] 17:02:19,737 INFO  [org.jboss.as.repository] (XNIO-1 task-1) WFLYDR0001: Content added at location /home/luigi/WFC/wildfly/master/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content</pre></div></li><li class="listitem">But you don't <a id="id274" class="indexterm"/>see <a id="id275" class="indexterm"/>any logs at the <code class="literal">Host Controller</code> log side. This is because we haven't <a id="id276" class="indexterm"/>assigned the application to any server group yet. To assign the application <a id="id277" class="indexterm"/>to a <a id="id278" class="indexterm"/>server <a id="id279" class="indexterm"/>group, just hit the <span class="strong"><strong>Assign</strong></span> button and choose the server group, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_03_16.jpg" alt="How to do it…"/><div class="caption"><p>Assigning a deployment to a server-group</p></div></div></li><li class="listitem">Save it and the <a id="id280" class="indexterm"/>domain controller should spread the deployment to the servers that belong to <a id="id281" class="indexterm"/>the <a id="id282" class="indexterm"/>selected <a id="id283" class="indexterm"/>server group, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_03_17.jpg" alt="How to do it…"/><div class="caption"><p>Deployment assigned to a server-group</p></div></div><p>You can check <a id="id284" class="indexterm"/>it from the host controller's log, by looking for entries similar <a id="id285" class="indexterm"/>to the following:</p><div class="informalexample"><pre class="programlisting">[Server:REST-server-one] 17:09:13,813 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
[Server:REST-server-one] 17:09:14,406 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-1) WFLYUT0021: Registered web context: /example
[Server:REST-server-one] 17:09:14,478 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 59) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")</pre></div><p>No more <a id="id286" class="indexterm"/>entries <a id="id287" class="indexterm"/>will <a id="id288" class="indexterm"/>be found on the domain controller side.</p></li><li class="listitem">If <a id="id289" class="indexterm"/>you need to check which deployments belong to what server group, go to the <span class="strong"><strong>Deployments</strong></span> tab, select the <span class="strong"><strong>Server Groups</strong></span> tab and click the appropriate <span class="strong"><strong>View</strong></span> command <a id="id290" class="indexterm"/>link, as shown in the next screenshot:<div class="mediaobject"><img src="graphics/3744_03_18.jpg" alt="How to do it…"/><div class="caption"><p>Selecting a server-group</p></div></div></li><li class="listitem">You <a id="id291" class="indexterm"/>should <a id="id292" class="indexterm"/>see all the successful deployments, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_03_19.jpg" alt="How to do it…"/><div class="caption"><p>Deployments for a specific server-group</p></div></div></li><li class="listitem">Okay, now <a id="id293" class="indexterm"/>it's time to undeploy our application. As the Web Console suggests, from the <span class="strong"><strong>Deployments</strong></span> overview you can remove it ( undeploy it in GUI terms) by <a id="id294" class="indexterm"/>selecting the artifact and clicking the <span class="strong"><strong>Remove</strong></span> button, as shown in <a id="id295" class="indexterm"/>the <a id="id296" class="indexterm"/>next screenshot:<div class="mediaobject"><img src="graphics/3744_03_20.jpg" alt="How to do it…"/><div class="caption"><p>Undeploying the artifact</p></div></div></li><li class="listitem"><a id="id297" class="indexterm"/>Confirm <a id="id298" class="indexterm"/>your operation as follows:<div class="mediaobject"><img src="graphics/3744_03_21.jpg" alt="How to do it…"/><div class="caption"><p>Artifact undeployed</p></div></div><p>Now <a id="id299" class="indexterm"/>looking at the logs, you should find the following entries (first the <a id="id300" class="indexterm"/><code class="literal">Domain Controller</code> log followed by the <code class="literal">Host Controller</code> log):</p><div class="informalexample"><pre class="programlisting">[Server:REST-server-one] 22:17:05,544 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0022: Unregistered web context: /example
[Server:REST-server-one] 22:17:05,573 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-4) HV000001: Hibernate Validator 5.1.3.Final
[Server:REST-server-one] 22:17:05,612 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-4) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 72ms
[Server:REST-server-one] 22:17:05,659 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 70) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")
[Server:REST-server-one] 22:17:05,663 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 70) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfl/domain/servers/REST-server-one/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0/content
[Host Controller] 22:17:05,666 INFO  [org.jboss.as.repository] (XNIO-1 task-8) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/domain/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0/content</pre></div></li></ol></div><p>Now let's <a id="id301" class="indexterm"/>recap all <a id="id302" class="indexterm"/>these <a id="id303" class="indexterm"/>things <a id="id304" class="indexterm"/>and <a id="id305" class="indexterm"/>more in the next recipe <a id="id306" class="indexterm"/>using the CLI.</p></div></div>
<div class="section" title="Deploying and undeploying an application to a specific server group via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec39"/>Deploying and undeploying an application to a specific server group via the CLI</h1></div></div></div><p>In this <a id="id307" class="indexterm"/>recipe, we will learn <a id="id308" class="indexterm"/>how to deploy and <a id="id309" class="indexterm"/>undeploy an application using <a id="id310" class="indexterm"/>the CLI, and assign it to a specific <a id="id311" class="indexterm"/>server group. This recipe <a id="id312" class="indexterm"/>follows pretty much the same operation as executed in the previous recipe, but is specific to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec90"/>Getting ready</h2></div></div></div><p>For this recipe, both the domain controller and host controllers should be up and running. For their configuration, please refer to the recipe <span class="emphasis"><em>Connecting the host controller to the domain controller</em></span> in this chapter.</p><p>In this and the following recipe, we will need an application to test our configuration. For this recipe, we require the application named <code class="literal">example</code> which you can find in my GitHub repository. If you skipped the <span class="emphasis"><em>Managing applications using the deployments folder</em></span> recipe in <a class="link" href="ch02.html" title="Chapter 2. Running WildFly in Standalone Mode">Chapter 2</a>, <span class="emphasis"><em>Running WildFly in Standalone Mode</em></span>, please refer to it in order download all the source code and projects that you will need.</p><p>To build the application, type as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME/github/wildfly-cookbook
$ cd example
$ mvn -e clean package</pre></div><p>Once you build the application, copy it into the <code class="literal">$WILDFLY_HOME</code> folder for convenience.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec91"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open your terminal and connect to the DC as usual:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect</pre></div></li><li class="listitem">Now just hit <span class="emphasis"><em>Tab</em></span> to see the available commands:<div class="mediaobject"><img src="graphics/3744_03_22.jpg" alt="How to do it…"/></div></li><li class="listitem">There is <a id="id313" class="indexterm"/>a <code class="literal">deploy</code> <a id="id314" class="indexterm"/>command <a id="id315" class="indexterm"/>available, and it is the one we need. Let's deploy our artifact to both server groups, <code class="literal">server-group-REST-app</code> and <code class="literal">server-group-SOAP-app</code>.<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] deploy example.war --server-groups=server-group-SOAP-app,server-group-REST-app
[domain@localhost:9990 /]</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note15"/>Note</h3><p>Keep in <a id="id316" class="indexterm"/>mind that the application's path is relative to the path used to access the CLI. So in case you are in your user home, the path to specify to the <code class="literal">deploy</code> command would have been <code class="literal">WFC/github/wildfly-cookbook/example/target/example.war</code>.</p></div></div></li><li class="listitem">Let's <a id="id317" class="indexterm"/>check what <a id="id318" class="indexterm"/>happened to each server group singularly:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] deployment-info --server-group=server-group-REST-app
NAME        RUNTIME-NAME STATE   
example.war example.war  enabled
[domain@localhost:9990 /] deployment-info --server-group=server-group-SOAP-app
NAME        RUNTIME-NAME STATE   
example.war example.war  enabled
[domain@localhost:9990 /]</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If you <a id="id319" class="indexterm"/>don't <a id="id320" class="indexterm"/>trust the CLI, check what happened to the various logs:<p>The <a id="id321" class="indexterm"/><code class="literal">master</code> log is as follows:</p><div class="informalexample"><pre class="programlisting">[Host Controller] 22:56:08,289 INFO  [org.jboss.as.repository] (management-handler-thread - 2) WFLYDR0001: Content added at location /home/luigi/WFC/wildfly/master/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content</pre></div><p>The <a id="id322" class="indexterm"/><code class="literal">Slave-1</code> log is as follows:</p><div class="informalexample"><pre class="programlisting">[Server:REST-server-one] 22:56:08,557 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-7) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
[Server:REST-server-one] 22:56:08,779 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0021: Registered web context: /example
[Server:REST-server-one] 22:56:10,121 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 65) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")</pre></div><p>The <code class="literal">Slave-2</code> log is as follows:</p><div class="informalexample"><pre class="programlisting">[Server:SOAP-server-one] 22:56:08,725 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-6) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
[Server:SOAP-server-two] 22:56:08,741 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-3) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
[Server:SOAP-server-one] 22:56:09,906 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0021: Registered web context: /example
[Server:SOAP-server-two] 22:56:10,004 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-7) WFLYUT0021: Registered web context: /example
[Server:SOAP-server-one] 22:56:10,121 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 59) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")
[Server:SOAP-server-two] 22:56:10,134 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 59) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")</pre></div><p>As you can see from the logs, our artifact has been deployed to all the declared server groups. <code class="literal">Slave-2</code> has two running instances, each one with its own copy of the artifact.</p></li></ul></div></li><li class="listitem">Now to <a id="id323" class="indexterm"/>undeploy the <a id="id324" class="indexterm"/>artifact; it's as easy as pie:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] undeploy example.war –server-groups=server-group-REST-app,server-group-SOAP-app</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Let's check via CLI if we have effectively undeployed our artifact:<div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] deployment-info --server-group=server-group-REST-app
[domain@localhost:9990 /] deployment-info --server-group=server-group-SOAP-app
[domain@localhost:9990 /]</pre></div></li></ul></div><p>Again, check <a id="id325" class="indexterm"/>the <a id="id326" class="indexterm"/>logs to see what happened:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <a id="id327" class="indexterm"/><code class="literal">master</code> log is as follows:<div class="informalexample"><pre class="programlisting">[Host Controller] 22:59:35,225 INFO  [org.jboss.as.repository] (management-handler-thread - 9) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/master/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content</pre></div></li><li class="listitem" style="list-style-type: disc">The <a id="id328" class="indexterm"/><code class="literal">Slave-1</code> log is as follows:<div class="informalexample"><pre class="programlisting">[Server:REST-server-one] 22:59:35,005 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-7) WFLYUT0022: Unregistered web context: /example
[Server:REST-server-one] 22:59:35,044 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-8) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 40ms
[Server:REST-server-one] 22:59:35,201 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 69) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-1/servers/REST-server-one/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
[Server:REST-server-one] 22:59:35,201 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 69) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")
[Host Controller] 22:59:35,221 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 14) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-1/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
[Host Controller] 22:59:42,048 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 4) WFLYDR0009: Content /home/luigi/WFC/wildfly/slave-1/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0 is obsolete and will be removed
[Host Controller] 22:59:42,050 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 4) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-1/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0/content
[Server:REST-server-one] 22:59:46,550 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 59) WFLYDR0009: Content /home/luigi/WFC/wildfly/slave-1/servers/REST-server-one/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0 is obsolete and will be removed
[Server:REST-server-one] 22:59:46,552 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 59) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-1/servers/REST-server-one/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0/content</pre></div></li><li class="listitem" style="list-style-type: disc">The <a id="id329" class="indexterm"/><code class="literal">Slave-2</code> log is as follows:<div class="informalexample"><pre class="programlisting">[Server:SOAP-server-two] 22:59:35,004 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0022: Unregistered web context: /example
[Server:SOAP-server-one] 22:59:35,017 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0022: Unregistered web context: /example
[Server:SOAP-server-two] 22:59:35,072 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-3) HV000001: Hibernate Validator 5.1.3.Final
[Server:SOAP-server-one] 22:59:35,093 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-5) HV000001: Hibernate Validator 5.1.3.Final
[Server:SOAP-server-two] 22:59:35,127 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-6) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 127ms
[Server:SOAP-server-one] 22:59:35,141 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-8) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 128ms
[Server:SOAP-server-two] 22:59:35,203 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 64) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-2/servers/SOAP-server-two/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
[Server:SOAP-server-two] 22:59:35,204 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 64) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")
[Server:SOAP-server-one] 22:59:35,209 INFO  [org.jboss.as.repository] (ServerService Thread Pool -- 63) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-2/servers/SOAP-server-one/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
[Server:SOAP-server-one] 22:59:35,212 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 63) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")
[Host Controller] 22:59:35,219 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 15) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-2/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
[Host Controller] 22:59:49,597 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 7) WFLYDR0009: Content /home/luigi/WFC/wildfly/slave-2/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0 is obsolete and will be removed
[Host Controller] 22:59:49,598 INFO  [org.jboss.as.repository] (Host Controller Service Threads - 7) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/slave-2/data/content/8d/b8b9b1cda547c7ec3fb493dbd5940cdb378ec0/content</pre></div></li></ul></div></li></ol></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec92"/>There's more...</h2></div></div></div><p>Actually, you <a id="id330" class="indexterm"/>can deploy the artifact to <a id="id331" class="indexterm"/>all the server <a id="id332" class="indexterm"/>groups with the following <a id="id333" class="indexterm"/>directive:</p><div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] deploy example.war --all-server-groups</pre></div><p>There is a <a id="id334" class="indexterm"/>shortcut for undeploying <a id="id335" class="indexterm"/>too:</p><div class="informalexample"><pre class="programlisting">[domain@localhost:9990 /] undeploy example.war --all-relevant-server-groups</pre></div><p>It basically <a id="id336" class="indexterm"/>undeploys the artifact from all the server groups that it is assigned to.</p></div></div>
<div class="section" title="Checking server status via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec40"/>Checking server status via the CLI</h1></div></div></div><p>In this recipe, we <a id="id337" class="indexterm"/>will learn how to check the status of the server <a id="id338" class="indexterm"/>using the CLI. Using the standalone, there is no need for such a check, because you wouldn't be able to connect to the CLI at all. Thus, in the domain mode, you might need to know if a certain server is up or not before doing some operations.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec93"/>Getting ready</h2></div></div></div><p>For this recipe, both the domain controller and host controllers should be up and running. For their configuration, please refer to the recipe <span class="emphasis"><em>Connecting the host controller to the domain controller</em></span> in this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec94"/>How to do it…</h2></div></div></div><p>Open your terminal and connect to the domain controller as usual:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect

[domain@localhost:9990 /] /host=slave-1/server-config=REST-server-one:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "auto-start" =&gt; true,
        "cpu-affinity" =&gt; undefined,
        "group" =&gt; "server-group-REST-app",
        "name" =&gt; "REST-server-one",
        "priority" =&gt; undefined,
        "socket-binding-group" =&gt; undefined,
        "socket-binding-port-offset" =&gt; 0,
        "status" =&gt; "STARTED",
        "interface" =&gt; undefined,
        "jvm" =&gt; {"default" =&gt; undefined},
        "path" =&gt; undefined,
        "system-property" =&gt; undefined
    }
}
[domain@localhost:9990 /]</pre></div></div></div></body></html>