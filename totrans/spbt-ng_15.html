<html><head></head><body>
		<div id="_idContainer115">
			<h1 class="chapter-number" id="_idParaDest-283"><a id="_idTextAnchor293"/>15</h1>
			<h1 id="_idParaDest-284"><a id="_idTextAnchor294"/>Writing Tests in Angular</h1>
			<p>In the previous chapter, we learned how to secure an Angular application by adding user authentication, retrieving user information, and <span class="No-Break">protecting routes.</span></p>
			<p>What if I told you that writing tests in the frontend could be fun and exciting? This chapter will show you how good the developer experience of Cypress E2E, short for end-to-end testing, is. Why do frontend developers love the <span class="No-Break">Cypress framework?</span></p>
			<p>This chapter will teach you how to write basic Cypress tests and mock HTTP requests <span class="No-Break">for testing.</span></p>
			<p>In this chapter, we will cover the <span class="No-Break">following topics:</span></p>
			<ul>
				<li>Getting started <span class="No-Break">with Cypress</span></li>
				<li>Writing a simple <span class="No-Break">Cypress test</span></li>
				<li>Mocking HTTP responses and intercepting <span class="No-Break">HTTP requests</span></li>
			</ul>
			<h1 id="_idParaDest-285"><a id="_idTextAnchor295"/>Technical requirements</h1>
			<p>The following link will take you to the finished version of this <span class="No-Break">chapter: </span><a href="https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-15/superheroes"><span class="No-Break">https://github.com/PacktPublishing/Spring-Boot-and-Angular/tree/main/Chapter-15/superheroes</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-286"><a id="_idTextAnchor296"/>Getting started with Cypress</h1>
			<p>In this section, you will learn what Cypress is and how to get started <span class="No-Break">with it.</span></p>
			<p>Cypress is an <a id="_idIndexMarker1144"/>end-to-end agnostic framework for testing web applications. You can write test IDs in HTML tags and assert whether the HTML tags are rendered in the way you would expect them <span class="No-Break">to be.</span></p>
			<p>Let’s define <a id="_idIndexMarker1145"/>what <strong class="bold">end-to-end</strong> means. End-to-end means how a user will use your application after they land on your web application and finish tasks such as logging in, signing up, checking out, viewing a profile, logging out, filling out a form, and <span class="No-Break">so on.</span></p>
			<p>For instance, you can test or check the UI of your web application in different example cases <span class="No-Break">or scenarios:</span></p>
			<ul>
				<li>The sentence of the landing page’s value proposition contains the <span class="No-Break">word </span><span class="No-Break"><em class="italic">sale</em></span></li>
				<li>The widget count of a section of your website is what <span class="No-Break">you expected</span></li>
				<li>The items in the basket on the checkout page are cleared out after hitting the <span class="No-Break"><strong class="bold">Clear</strong></span><span class="No-Break"> button</span></li>
				<li>A login form is present when the web application’s URL <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">domain.com/login</strong></span></li>
			</ul>
			<p>These scenarios <a id="_idIndexMarker1146"/>are examples of what to test for in a web application. Cypress is a test framework where you can write and run tests that don’t take much time to set up <span class="No-Break">and configure.</span></p>
			<p>Now, let’s see how Cypress can <span class="No-Break">be installed.</span></p>
			<h2 id="_idParaDest-287"><a id="_idTextAnchor297"/>Installation</h2>
			<p>To start <a id="_idIndexMarker1147"/>using Cypress, we must install it from the npm repository by running the <span class="No-Break">following command:</span></p>
			<pre class="console">
npm i-D cypress @testing-library/cypress</pre>
			<p>The preceding <strong class="source-inline">npm</strong> command will install Cypress and the <strong class="source-inline">cypress</strong> testing library in the <strong class="source-inline">dev</strong> dependency packages. <strong class="source-inline">@testing-library</strong> is a group of common testing utilities in web development that makes the life of a <span class="No-Break">developer easier</span></p>
			<p>In the next section, we will learn what we must add to the <strong class="source-inline">npm</strong> script of our <strong class="source-inline">package.json</strong> file so that we can run the test later in <span class="No-Break">this chapter.</span></p>
			<h3>npm script</h3>
			<p>To make <a id="_idIndexMarker1148"/>it easier for us to run the Cypress test later, it’s a good idea to add a new npm script to our <strong class="source-inline">package.json</strong> file to help us easily run a command. Insert the following key/value pair inside the <strong class="source-inline">scripts</strong> block of the <span class="No-Break"><strong class="source-inline">package.json</strong></span><span class="No-Break"> file:</span></p>
			<pre class="source-code">
"test": "npx cypress open"</pre>
			<p>The preceding key/value pair helps you run the test by running the <strong class="source-inline">npm run test</strong> command in your Terminal. Run the full stack application as well as the <strong class="source-inline">npm run test</strong> command in your Terminal to <span class="No-Break">start Cypress.</span></p>
			<p>An interactive browser app will open where you can run your test. <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.1</em> shows the Cypress <a id="_idIndexMarker1149"/>dashboard with a welcome message after running the <strong class="source-inline">npm run test</strong> command. Here, we are going to use <strong class="bold">E2E Testing</strong>, so click that box <span class="No-Break">to continue:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer104">
					<img alt="Figure 15.1 – The Cypress dashboard" src="image/B18159_15_01.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.1 – The Cypress dashboard</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.2</em> shows the folders and files that will be automatically added to your Angular application directory. These are required for any web application that uses Cypress. We will add more to this because we are using TypeScript, but we will do that later. For now, just hit the <strong class="bold">Continue</strong> button; you will be taken to the <span class="No-Break">following screen:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer105">
					<img alt="Figure 15.2 – Configuration Files" src="image/B18159_15_02.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.2 – Configuration Files</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.3</em> shows that you can choose different browsers to run your E2E tests. You can choose from Chrome, Microsoft Edge, and Firefox. We will stop here because we haven’t written <a id="_idIndexMarker1150"/>any tests yet, and we still need to help Cypress learn TypeScript. Stop Cypress from running by pressing <em class="italic">Ctrl</em> + <em class="italic">C</em> in <span class="No-Break">your Terminal:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer106">
					<img alt="Figure 15.3 – Choose a Browser" src="image/B18159_15_03.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.3 – Choose a Browser</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.4</em> shows the generated <strong class="source-inline">cypress</strong> folders, which contain additional folders inside them, and the <strong class="source-inline">cypress.config.ts</strong> file for editing some of Cypress’s default behaviors. We <a id="_idIndexMarker1151"/>will discuss the <strong class="source-inline">cypress.config.ts</strong> <span class="No-Break">file later:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer107">
					<img alt="Figure 15.4 – Cypress folders and files" src="image/B18159_15_04.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.4 – Cypress folders and files</p>
			<h3>TypeScript for Cypress</h3>
			<p>To help <a id="_idIndexMarker1152"/>Cypress understand TypeScript, we must add the <strong class="source-inline">tsconfig.json</strong> file to the root directory of the <strong class="source-inline">cypress</strong> folder. Create a new file and name it <strong class="source-inline">tsconfig.json</strong>; then, write the <span class="No-Break">following configuration:</span></p>
			<pre class="source-code">
{
    "extends": "../tsconfig.json",
    "compilerOptions": {
        "types":["cypress", "@testing-library/cypress"],
        "isolatedModules": false,
        "allowJs": true,
        "experimentalDecorators": true,
        "skipLibCheck": true
    },
    "include": [
        "./**/*.ts",
    ],
    "exclude": []
}</pre>
			<p>The preceding <a id="_idIndexMarker1153"/>code inherits the <strong class="source-inline">tsconfig.json</strong> file at the root of our Angular application. Then, we added <strong class="source-inline">cypress</strong> and <strong class="source-inline">@testing-library/cypress</strong> to the <strong class="source-inline">tsconfig.json</strong> file, which will help Cypress understand any TypeScript files in the Cypress directory. The array shows that we are including these TypeScript files in any level of <span class="No-Break">the directory.</span></p>
			<p>Now that we have set up Cypress for TypeScript, let’s update the <strong class="source-inline">cypress.config.ts</strong> file in our <span class="No-Break">Angular application.</span></p>
			<h2 id="_idParaDest-288"><a id="_idTextAnchor298"/>Updating the Cypress config file</h2>
			<p>What is a <a id="_idIndexMarker1154"/>Cypress config file? The <strong class="source-inline">cypress.config.ts</strong> file is used to store any configurations for things such as environments, timeouts, folders/files, screenshots, videos, downloads, browsers, viewports, and more that are specific <span class="No-Break">to Cypress.</span></p>
			<p>You are modifying the default behavior of Cypress by supplying any optional configurations you want to add. So, update the <strong class="source-inline">cypress.config.ts</strong> file with the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
import { defineConfig } from "cypress";
export default defineConfig({
  e2e: {
    setupNodeEvents(on, config) {
      // implement node event listeners here
    },
    baseUrl: "http://localhost:4200",
    video: false,
  },
});</pre>
			<p>The preceding <a id="_idIndexMarker1155"/>code configures the base URL for Cypress where Angular runs. There is also a configuration for the video that disables the end-to-end testing recording. We are only using <strong class="source-inline">baseUrl</strong> and the video properties of the <span class="No-Break">Cypress configuration.</span></p>
			<p>In the next section, we will start writing some simple Cypress tests to help you gain confidence in writing tests and see how easy it is to write tests <span class="No-Break">in Cypress.</span></p>
			<h1 id="_idParaDest-289"><a id="_idTextAnchor299"/>Writing Cypress tests</h1>
			<p>In this section, we will start writing simple Cypress tests to see how fun and easy it is to write tests <a id="_idIndexMarker1156"/>using Cypress. We will start the tests by adding a test attribute in an HTML tag in the authentication form. We are going to edit the <strong class="source-inline">auth-form.component.html</strong> file to write the <strong class="source-inline">test-id</strong> attribute. Here is what was changed in the <span class="No-Break"><strong class="source-inline">auth-form.component.html</strong></span><span class="No-Break"> line:</span></p>
			<pre class="source-code">
&lt;mat-card-title data-cy="auth-title"&gt;{{title}}&lt;/mat-card-title&gt;</pre>
			<p>You can see the attribute we added in the preceding code. <strong class="source-inline">data-cy</strong> is an attribute for the test ID that Cypress will use to target the HTML element we want <span class="No-Break">to test.</span></p>
			<p>Now that we’ve added our first test ID, let’s go to the <strong class="source-inline">e2e</strong> folder inside the <strong class="source-inline">cypress</strong> directory and create a new file. The filename needs to contain <em class="italic">.cy</em>. Name the new file <strong class="source-inline">anti-heroes.cy.ts</strong> and then add the <span class="No-Break">following code:</span></p>
			<pre class="source-code">
/// &lt;reference types="cypress"/&gt;
describe("Anti Heroes Page", () =&gt; {
  // basic test
  it("should display login page", () =&gt; {
    cy.visit("/");
    cy.url().should("include", "/login");
    cy.get("[data-cy=auth-title]").should("contain",
                                          "Login");
  });
});</pre>
			<p>The preceding <a id="_idIndexMarker1157"/>code provides the first description of our test. First, we are adding a reference to the Cypress types to get extra tooling <span class="No-Break">using TypeScript.</span></p>
			<p>Then, we have the <strong class="source-inline">describe</strong> function, which is used for group tests. The <strong class="source-inline">describe</strong> function has two arguments. The first argument is a string, and it passes the name that the <strong class="source-inline">describe</strong> function will use. The second argument is a callback function that will contain all tests under the <span class="No-Break"><strong class="source-inline">describe</strong></span><span class="No-Break"> function.</span></p>
			<p>The <strong class="source-inline">it</strong> function also accepts a string for the name of the test and a callback function for the details of the tests. The first <strong class="source-inline">it</strong> function tests whether an authenticated user can see the login page if the user visits the root domain of the Angular <span class="No-Break">app’s URL.</span></p>
			<p><strong class="source-inline">cy</strong> is an object where you can chain different types of commands. We are using the <strong class="source-inline">visit</strong> command, which allows us to write the URL we will use to navigate to <strong class="source-inline">localhost:4200</strong> once we run the test. <strong class="source-inline">cy.url</strong> asserts that the URL can be found on the login subpage. We are also testing <strong class="source-inline">mat-card-title</strong> through the <strong class="source-inline">data-cy= "auth-title"</strong> attribute, which has the word <em class="italic">Login</em> in <span class="No-Break">this test.</span></p>
			<p>As you can see, the first test is easy to write. The setup for writing the test is also easy. But before we run our first test, let’s create a user for <span class="No-Break">our test:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer108">
					<img alt="Figure 15.5 – A user for E2E testing (Angular app login page)" src="image/B18159_15_05.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.5 – A user for E2E testing (Angular app login page)</p>
			<p>In <span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.5</em>, we are creating a user for our E2E testing. The <strong class="source-inline">user@cypress.com</strong> username is just a made-up email address you are not required to use. You can use whatever email address you want. We will use the <strong class="source-inline">user@cypress.com</strong> user to log into our app <a id="_idIndexMarker1158"/>and use the web app like a real user would use <span class="No-Break">our application.</span></p>
			<p>Now, go to your Terminal and run the <strong class="source-inline">npm run test</strong> command to run Angular’s E2E tests. Go to the <strong class="bold">Specs</strong> section of the Cypress dashboard to find the list of <span class="No-Break"><strong class="bold">E2E specs</strong></span><span class="No-Break">:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer109">
					<img alt="Figure 15.6 – E2E specs" src="image/B18159_15_06.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.6 – E2E specs</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.6</em> shows the list of <strong class="bold">E2E specs</strong> files for testing. Here, there is a single spec file; this is the one we <span class="No-Break">created earlier.</span></p>
			<p>Click on the <strong class="bold">anti-heroes</strong> spec to run the test we created and see whether it is passing <span class="No-Break">or failing:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer110">
					<img alt="Figure 15.7 – Passing test" src="image/B18159_15_07.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.7 – Passing test</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.7</em> shows that the two asserts we wrote in our test are passing. This means that the login <a id="_idIndexMarker1159"/>subpage is where the unauthenticated user was directed after landing on the root domain page. The passing test also tells us that the title of the form the user saw was <em class="italic">Login</em> and <span class="No-Break">not </span><span class="No-Break"><em class="italic">Register</em></span><span class="No-Break">.</span></p>
			<p>If you change <strong class="source-inline">should("contain", "Login");</strong> to <strong class="source-inline">should("contain", "Register");</strong>, the test will fail, which is an indicator that the test is accurate and that it is not just passing anything we write in <span class="No-Break">the test.</span></p>
			<p>With that, we have finished writing a simple E2E test using Cypress and saw that our tests are passing. In the next section, we will mock HTTP responses and intercept HTTP requests that our Angular application sends so that we no longer need the backend application to run <span class="No-Break">these tests.</span></p>
			<h1 id="_idParaDest-290"><a id="_idTextAnchor300"/>Mocking HTTP responses and intercepting HTTP requests</h1>
			<p><strong class="bold">Mocking tests</strong> can <a id="_idIndexMarker1160"/>help <a id="_idIndexMarker1161"/>us isolate <a id="_idIndexMarker1162"/>and focus on tests and not on the state of external dependencies or behavior. In this section, we will mock the HTTP responses of our server and intercept the HTTP requests <a id="_idIndexMarker1163"/>of our Angular application for testing. We are going <a id="_idIndexMarker1164"/>to intercept the HTTP requests so that we can send fake responses to Angular and not pollute our <span class="No-Break">dev database.</span></p>
			<p>We will start by adding a new file to the root of the <strong class="source-inline">cypress</strong> directory. Name the file <strong class="source-inline">global.d.ts</strong>. The <strong class="source-inline">global.d.ts</strong> file, also <a id="_idIndexMarker1165"/>known as <strong class="bold">global libraries</strong>, provides a way to make interfaces and types globally available in our <span class="No-Break">TypeScript code.</span></p>
			<p>After creating the <strong class="source-inline">global.d.ts</strong> file, write the following code <span class="No-Break">inside it:</span></p>
			<pre class="source-code">
/// &lt;reference types="cypress"/&gt;
declare namespace Cypress {
    interface Chainable {
        getCommand(url: string, responseBody: Array&lt;any&gt;):
          Chainable&lt;any&gt;;
        deleteCommand(url: string): Chainable&lt;any&gt;;
        postCommand(url: string, requestBody: any):
          Chainable&lt;any&gt;;
    }
}</pre>
			<p>The preceding code allows us to use custom chainable commands, which will give us IntelliSense whenever we hit the dot after <span class="No-Break">writing </span><span class="No-Break"><em class="italic">cy</em></span><span class="No-Break">.</span></p>
			<p>Now that we’ve added <strong class="source-inline">global.d.ts</strong>, let’s install a library that can generate a unique universal ID, also <a id="_idIndexMarker1166"/>known as a <strong class="bold">UUID</strong>, and use it as a temporary ID for a fake object we will create to respond to Angular’s <span class="No-Break">HTTP request.</span></p>
			<p>The following <strong class="source-inline">npm</strong> command will install an <strong class="source-inline">npm</strong> library called <strong class="source-inline">uuid</strong> to help us generate the UUID <span class="No-Break">we need:</span></p>
			<pre class="console">
npm i uuid</pre>
			<p>We also need the types for the <strong class="source-inline">uuid</strong> library <span class="No-Break">we installed:</span></p>
			<pre class="console">
npm i -D @types/uuid</pre>
			<p>The preceding <strong class="source-inline">npm</strong> command will install the <strong class="source-inline">uuid</strong> <span class="No-Break">TypeScript types.</span></p>
			<p>Now, we need <a id="_idIndexMarker1167"/>a file for the fixtures in our Cypress test. A <strong class="bold">fixture</strong> is the <a id="_idIndexMarker1168"/>fixed state of an object or array that’s used as a baseline <a id="_idIndexMarker1169"/>for <span class="No-Break">running tests:</span></p>
			<ol>
				<li>Go to the <strong class="source-inline">fixtures</strong> folder inside the <strong class="source-inline">cypress</strong> directory in your application. Create two JSON files and name them <strong class="source-inline">anti-heroes.json</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">user.json</strong></span><span class="No-Break">.</span></li>
				<li>Copy the content of the file from <a href="https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/fixtures/anti-heroes.json">https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/fixtures/anti-heroes.json</a> and paste it into the <span class="No-Break"><strong class="source-inline">anti-heroes.json</strong></span><span class="No-Break"> file.</span></li>
				<li>Next, copy the content of the file from <a href="https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/fixtures/user.json">https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/fixtures/user.json</a> and paste it into the <span class="No-Break"><strong class="source-inline">user.json</strong></span><span class="No-Break"> file.</span></li>
			</ol>
			<p>The preceding JSON objects are objects that we are going to use in our fixtures. We will use these as response bodies to send <span class="No-Break">mock responses.</span></p>
			<ol>
				<li value="4">Now, let’s update the <strong class="source-inline">commands.ts</strong> file in the <strong class="source-inline">support</strong> folder inside the <strong class="source-inline">cypress</strong> directory. Use the <span class="No-Break">following code:</span><pre class="console">
// @ts-check</pre><pre class="console">
///&lt;reference path="../global.d.ts" /&gt;</pre><pre class="console">
/// &lt;reference types="cypress"/&gt;</pre><pre class="console">
import { v4 as uuidv4 } from "uuid";</pre><pre class="console">
Cypress.Commands.add("getCommand", (url: string, responseBody: Array&lt;any&gt;) =&gt; {</pre><pre class="console">
    cy.intercept("GET", url, {</pre><pre class="console">
        statusCode: 200,</pre><pre class="console">
        body: responseBody,</pre><pre class="console">
    });</pre><pre class="console">
});</pre><pre class="console">
Cypress.Commands.add("deleteCommand", (url: string) =&gt; {</pre><pre class="console">
    cy.intercept("DELETE", url, {</pre><pre class="console">
        statusCode: 200,</pre><pre class="console">
    });</pre><pre class="console">
});</pre><pre class="console">
Cypress.Commands.add("postCommand", (url: string, requestBody: any) =&gt; {</pre><pre class="console">
    requestBody.id = uuidv4();</pre><pre class="console">
    cy.intercept("POST", url, {</pre><pre class="console">
        statusCode: 201,</pre><pre class="console">
        body: requestBody,</pre><pre class="console">
    });</pre><pre class="console">
});</pre></li>
			</ol>
			<p>The <a id="_idIndexMarker1170"/>preceding code implements the custom chainable <a id="_idIndexMarker1171"/>commands we wrote inside the <strong class="source-inline">global.d.ts</strong> file. <strong class="source-inline">getCommand</strong>, <strong class="source-inline">deleteCommand</strong>, and <strong class="source-inline">postCommand</strong> require URLs as strings to intercept any HTTP requests. The custom chainable commands require a state, which will be <span class="No-Break">a fixture.</span></p>
			<ol>
				<li value="5">Now, let’s write more tests in <strong class="source-inline">anti-heroes.cy.ts</strong>. But first, we must add more test IDs for the tests <span class="No-Break">we write.</span></li>
			</ol>
			<p>Go to <strong class="source-inline">auth-form.component.html</strong> and <a id="_idIndexMarker1172"/>update the <a id="_idIndexMarker1173"/>code with the <span class="No-Break">following code:</span></p>
			<pre class="console">
&lt;mat-card&gt;
    &lt;mat-card-title
      data-cy="auth-title"&gt;{{title}}&lt;/mat-card-title&gt;
    &lt;mat-card-content&gt;
        &lt;form [formGroup]="form"
          (ngSubmit)="submit()"&gt;
        &lt;p *ngIf="error" class="error"&gt;
            {{ error }}
        &lt;/p&gt;
        &lt;p&gt;
            &lt;mat-form-field&gt;
            &lt;input type="text"
              matInput placeholder="Username"
              formControlName="email"
              data-cy="email"&gt;
            &lt;/mat-form-field&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;mat-form-field&gt;
            &lt;input type="password"
              matInput placeholder="Password"
              formControlName="password"
              data-cy="password"&gt;
            &lt;/mat-form-field&gt;
        &lt;/p&gt;
        &lt;div class="button"&gt;
            &lt;button type="submit"
              mat-button data-cy="submit-login"&gt;
              {{title}}&lt;/button&gt;
        &lt;/div&gt;
        &lt;p *ngIf="title == 'Login'" class="link"
          [routerLink]="['register']"
          routerLinkActive="router-link-active"&gt;
          Create account&lt;/p&gt;
        &lt;p *ngIf="title == 'Register'"
          class="link" [routerLink]="['']"
          routerLinkActive="router-link-active"&gt;
          Sign In&lt;/p&gt;
        &lt;/form&gt;
    &lt;/mat-card-content&gt;
&lt;/mat-card&gt;</pre>
			<p>The <a id="_idIndexMarker1174"/>preceding code contains four <strong class="source-inline">data-cy</strong> attributes <a id="_idIndexMarker1175"/>that will be used as targeted selectors. You can find the <strong class="source-inline">data-cy</strong> selectors in the <strong class="source-inline">mat-card-title</strong>, inputs, and <span class="No-Break"><strong class="source-inline">button</strong></span><span class="No-Break"> elements.</span></p>
			<ol>
				<li value="6">The next file to update will be <strong class="source-inline">navbar.component.html</strong>. Use the following code to update <span class="No-Break">the file:</span><pre class="console">
&lt;p&gt;</pre><pre class="console">
  &lt;mat-toolbar color="primary"&gt;</pre><pre class="console">
    &lt;span data-cy="logo"&gt;Angular CRUD&lt;/span&gt;</pre><pre class="console">
  &lt;/mat-toolbar&gt;</pre><pre class="console">
&lt;/p&gt;</pre></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker1176"/>code contains one <strong class="source-inline">data-cy</strong> attribute, which you can find in the <span class="No-Break"><strong class="source-inline">span</strong></span><span class="No-Break"> element.</span></p>
			<ol>
				<li value="7">Next, we need <a id="_idIndexMarker1177"/>to update the <span class="No-Break"><strong class="source-inline">anti-hero-list-component.html</strong></span><span class="No-Break"> file:</span><pre class="console">
&lt;table mat-table [dataSource]="antiHeroes" class="mat-elevation-z8"&gt;</pre><pre class="console">
    &lt;!-- Data for columns --&gt;</pre><pre class="console">
    &lt;ng-container *ngFor="let item of headers"</pre><pre class="console">
      [matColumnDef]="item.fieldName"&gt;</pre><pre class="console">
      &lt;th mat-header-cell *matHeaderCellDef&gt;</pre><pre class="console">
       {{item.headerName}} &lt;/th&gt;</pre><pre class="console">
      &lt;td mat-cell *matCellDef="let element"</pre><pre class="console">
        data-cy="row"&gt; {{element[item.fieldName]}}</pre><pre class="console">
      &lt;/td&gt;</pre><pre class="console">
    &lt;/ng-container&gt;</pre><pre class="console">
    &lt;!-- Actions for specific item --&gt;</pre><pre class="console">
    &lt;ng-container matColumnDef="actions"&gt;</pre><pre class="console">
        &lt;th mat-header-cell *matHeaderCellDef&gt;</pre><pre class="console">
          Actions &lt;/th&gt;</pre><pre class="console">
        &lt;td mat-cell *matCellDef="let element"&gt;</pre><pre class="console">
            <strong class="bold">&lt;button (click)="selectAntiHero(element,</strong></pre><pre class="console">
<strong class="bold">              0)" mat-raised-button color="primary"</strong></pre><pre class="console">
<strong class="bold">              data-cy="view"&gt;</strong></pre><pre class="console">
<strong class="bold">                &lt;mat-icon&gt;pageview&lt;/mat-icon&gt; View</strong></pre><pre class="console">
<strong class="bold">            &lt;/button&gt;</strong></pre><pre class="console">
            &amp;nbsp;</pre><pre class="console">
            <strong class="bold">&lt;button (click)="selectAntiHero(element,</strong></pre><pre class="console">
<strong class="bold">              1)" mat-raised-button color="warn"</strong></pre><pre class="console">
<strong class="bold">              data-cy="delete"&gt;</strong></pre><pre class="console">
<strong class="bold">                &lt;mat-icon&gt;delete&lt;/mat-icon&gt; Delete</strong></pre><pre class="console">
<strong class="bold">            &lt;/button&gt;</strong></pre><pre class="console">
        &lt;/td&gt;</pre><pre class="console">
    &lt;/ng-container&gt;</pre><pre class="console">
    &lt;tr mat-header-row</pre><pre class="console">
      *matHeaderRowDef="headerFields"&gt;&lt;/tr&gt;</pre><pre class="console">
    &lt;tr mat-row *matRowDef="let row;</pre><pre class="console">
      columns: headerFields"&gt;&lt;/tr&gt;</pre><pre class="console">
  &lt;/table&gt;</pre></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker1178"/>code contains three <strong class="source-inline">data-cy</strong> attributes, which you can find in the <strong class="source-inline">td</strong> element, and two <span class="No-Break"><strong class="source-inline">button</strong></span><span class="No-Break"> elements.</span></p>
			<ol>
				<li value="8">Next, we <a id="_idIndexMarker1179"/>must edit the <strong class="source-inline">anti-hero-command-bar.component.html</strong> file using the <span class="No-Break">following code:</span><pre class="console">
&lt;p&gt;</pre><pre class="console">
  &lt;mat-toolbar&gt;</pre><pre class="console">
    &lt;button mat-raised-button color="primary"</pre><pre class="console">
      (click)="emitAction(0)"data-cy="create"&gt;</pre><pre class="console">
      &lt;mat-icon&gt;fiber_new&lt;/mat-icon&gt; Create</pre><pre class="console">
    &lt;/button&gt;</pre><pre class="console">
    &amp;nbsp;</pre><pre class="console">
    &lt;button mat-raised-button color="warn"</pre><pre class="console">
      (click)="emitAction(1)"data-cy="delete-all"&gt;</pre><pre class="console">
      &lt;mat-icon&gt;delete&lt;/mat-icon&gt; Delete All</pre><pre class="console">
    &lt;/button&gt;</pre><pre class="console">
    &lt;button mat-button color="danger"</pre><pre class="console">
      (click)="logOut()" data-cy="logout"&gt;</pre><pre class="console">
      &lt;mat-icon&gt;logout&lt;/mat-icon&gt; logout</pre><pre class="console">
    &lt;/button&gt;</pre><pre class="console">
  &lt;/mat-toolbar&gt;</pre><pre class="console">
&lt;/p&gt;</pre></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker1180"/>code contains three selectors, which you can find in the <span class="No-Break"><strong class="source-inline">button</strong></span><span class="No-Break"> elements.</span></p>
			<ol>
				<li value="9">The last <a id="_idIndexMarker1181"/>file to update <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">anti-hero-form.component.html</strong></span><span class="No-Break">:</span><pre class="console">
&lt;mat-card class="form-card"&gt;</pre><pre class="console">
  &lt;h2&gt;{{ selectedAntiHero ? "Update/View Hero" :</pre><pre class="console">
    "Create Hero" }}&lt;/h2&gt;</pre><pre class="console">
  &lt;form class="anti-hero-form" [formGroup]="form"&gt;</pre><pre class="console">
    &lt;mat-form-field class="example-full-width"</pre><pre class="console">
      appearance="fill"&gt;&lt;mat-label&gt;</pre><pre class="console">
      First Name&lt;/mat-label&gt;</pre><pre class="console">
      &lt;input matInput formControlName="firstName"</pre><pre class="console">
        placeholder="Ex. Tony" data-cy="firstName"/&gt;</pre><pre class="console">
    &lt;/mat-form-field&gt;&lt;mat-form-field</pre><pre class="console">
      class="example-full-width" appearance="fill"&gt;</pre><pre class="console">
      &lt;mat-label&gt;Last Name&lt;/mat-label&gt;</pre><pre class="console">
      &lt;input matInput formControlName="lastName"</pre><pre class="console">
        placeholder="Ex. Stark" data-cy="lastName"/&gt;</pre><pre class="console">
    &lt;/mat-form-field&gt;</pre><pre class="console">
    &lt;mat-form-field class="example-full-width"</pre><pre class="console">
      appearance="fill"&gt;&lt;mat-label&gt;House&lt;/mat-label&gt;</pre><pre class="console">
      &lt;input matInput formControlName="house"</pre><pre class="console">
        placeholder="Ex. California" data-cy="house"/&gt;</pre><pre class="console">
        &lt;/mat-form-field&gt;&lt;mat-form-field</pre><pre class="console">
        class="example-full-width" appearance="fill"&gt;</pre><pre class="console">
        &lt;mat-label&gt;Known As&lt;/mat-label&gt;</pre><pre class="console">
      &lt;input matInput formControlName="knownAs"</pre><pre class="console">
        placeholder="Ex. Iron Man" data-cy="knownAs"</pre><pre class="console">
        /&gt;&lt;/mat-form-field&gt;&lt;div class="button-group"&gt;</pre><pre class="console">
      &lt;button mat-raised-button color="primary"</pre><pre class="console">
       (click)="emitAction()" data-cy="action"</pre><pre class="console">
      &gt;{{ actionButtonLabel }}&lt;/button&gt;</pre><pre class="console">
      &amp;nbsp;</pre><pre class="console">
      &lt;button mat-raised-button color="warn"</pre><pre class="console">
        (click)="clear()"&gt;Clear&lt;/button&gt;</pre><pre class="console">
    &lt;/div&gt;</pre><pre class="console">
  &lt;/form&gt;</pre><pre class="console">
&lt;/mat-card&gt;</pre></li>
			</ol>
			<p>The preceding code contains five inputs, which you can find in the <strong class="source-inline">input</strong> elements and the <span class="No-Break"><strong class="source-inline">button</strong></span><span class="No-Break"> element.</span></p>
			<p>With that, we have added the necessary test ID attributes to the HTML elements we are going to test later. We will need the mentioned <strong class="source-inline">data-cy</strong> test IDs when <a id="_idIndexMarker1182"/>we start writing tests in the <span class="No-Break"><strong class="source-inline">anti-heroes.cy.ts</strong></span><span class="No-Break"> file.</span></p>
			<ol>
				<li value="10">Now, let’s <a id="_idIndexMarker1183"/>start writing tests in <strong class="source-inline">anti-heroes.cy.ts</strong>. Here is the <span class="No-Break">new code:</span><pre class="console">
/// &lt;reference types="cypress"/&gt;</pre><pre class="console">
describe("Login Page", () =&gt; {</pre><pre class="console">
  beforeEach(() =&gt; {</pre><pre class="console">
    cy.fixture("anti-heroes").then(function (data) {</pre><pre class="console">
      /* register custom commands. */</pre><pre class="console">
      cy.getCommand("/api/v1/anti-heroes", data);</pre><pre class="console">
      cy.deleteCommand("/api/v1/anti-heroes/*");</pre><pre class="console">
    });</pre><pre class="console">
    cy.visit("/");</pre><pre class="console">
    cy.fixture("user").then((data: { email: string;</pre><pre class="console">
      password: string }) =&gt; {</pre><pre class="console">
      cy.get("[data-cy=email]").type(data.email);</pre><pre class="console">
      cy.get("[data-cy=password]")</pre><pre class="console">
        .type(data.password);</pre><pre class="console">
      cy.get("[data-cy=submit-login]").click();</pre><pre class="console">
    });</pre><pre class="console">
  });</pre><pre class="console">
  afterEach(() =&gt; {</pre><pre class="console">
    cy.get("[data-cy=logout]").click();</pre><pre class="console">
  });</pre><pre class="console">
  it.skip("should display login page", () =&gt; {</pre><pre class="console">
    cy.visit("/");</pre><pre class="console">
    cy.url().should("include", "/login");</pre><pre class="console">
    cy.get("[data-cy=auth-title]").should("contain",</pre><pre class="console">
      "Login");</pre><pre class="console">
  });</pre><pre class="console">
});</pre></li>
			</ol>
			<p>The preceding code shows a <strong class="source-inline">describe</strong> function that has two other functions <span class="No-Break">inside it.</span></p>
			<p>The first function inside the <strong class="source-inline">describe</strong> function is <a id="_idIndexMarker1184"/>called <strong class="source-inline">beforeEach</strong>, which runs each <a id="_idIndexMarker1185"/>time a test starts running. The <strong class="source-inline">beforeEach</strong> function keeps its state and uses it in the test. This function fits scenarios <a id="_idIndexMarker1186"/>where the test has to do precisely the same thing that other tests will also have to do – for instance, going to a particular URL, logging in, and intercepting HTTP calls using custom chainable commands such as <strong class="source-inline">getCommand</strong> <span class="No-Break">and </span><span class="No-Break"><strong class="source-inline">deleteCommand</strong></span><span class="No-Break">.</span></p>
			<p>The second function inside the <strong class="source-inline">describe</strong> function is called <strong class="source-inline">afterEach</strong>. The <strong class="source-inline">afterEach</strong> function runs every time a test ends. This function is suitable for cleaning up or logging out the user in the test. The <strong class="source-inline">beforeEach</strong> and <strong class="source-inline">afterEach</strong> functions save us a lot of <span class="No-Break">repeatable code.</span></p>
			<ol>
				<li value="11">Now, let’s add some tests to the <strong class="source-inline">anti-heroes.cy.ts</strong> file. Copy the following code and put it under the first test <span class="No-Break">we wrote:</span><pre class="console">
it("should display logo", () =&gt; { cy.get("[data-cy=logo]")</pre><pre class="console">
.should("contain", "Angular CRUD");</pre><pre class="console">
});</pre><pre class="console">
it("should render anti-heroes", () =&gt; {</pre><pre class="console">
  cy.fixture("anti-heroes").then(function (data) {</pre><pre class="console">
    cy.get("[data-cy=row]").should("have.length", 24);</pre><pre class="console">
  });</pre><pre class="console">
});</pre><pre class="console">
it("should remove a card after clicking a delete button", () =&gt; { const index = 1;</pre><pre class="console">
  cy.get("[data-cy=delete]").eq(index).click();</pre><pre class="console">
  cy.get("[data-cy=row]").should("have.length", 20);</pre><pre class="console">
});</pre><pre class="console">
it("should add a new hero", () =&gt; { const firstName = "Bucky";</pre><pre class="console">
  const lastName = "Barnes";</pre><pre class="console">
  const house = "Marvel";</pre><pre class="console">
  const knownAs = "The Winter Soldier";</pre><pre class="console">
  cy.get("[data-cy=create]").click();</pre><pre class="console">
  cy.get("[data-cy=firstName]").type(firstName);</pre><pre class="console">
  cy.get("[data-cy=lastName]").type(lastName);</pre><pre class="console">
  cy.get("[data-cy=house]").type(house);</pre><pre class="console">
  cy.get("[data-cy=knownAs]").type(knownAs);</pre><pre class="console">
  cy.postCommand("/api/v1/anti-heroes", {</pre><pre class="console">
    firstName,lastName,house,knownAs,});</pre><pre class="console">
  cy.get("[data-cy=action]").click();</pre><pre class="console">
  cy.fixture("anti-heroes").then(function (data) {</pre><pre class="console">
    cy.get("[data-cy=row]").should("have.length", 24);</pre><pre class="console">
  });</pre></li>
			</ol>
			<p>The preceding code shows the tests we are going to use for Cypress. You can see that <strong class="source-inline">fixture</strong> needs a string, which is the name of the JSON file. The data from <strong class="source-inline">fixture</strong> is the parameter of the <span class="No-Break">anonymous function.</span></p>
			<p>We are asserting <strong class="source-inline">24</strong> because there are four elements for every object we use in <strong class="source-inline">data-cy=" row"</strong>, which is how we built the HTML elements on the user interface. There are also six objects inside the array of the <span class="No-Break"><strong class="source-inline">anti-heroes.json</strong></span><span class="No-Break"> file.</span></p>
			<p>The newly <a id="_idIndexMarker1187"/>added tests show how we can pick a particular <a id="_idIndexMarker1188"/>object from a list or array of rendered UIs using the <strong class="source-inline">eq</strong> keyword and an <span class="No-Break"><strong class="source-inline">index</strong></span><span class="No-Break"> number.</span></p>
			<p>The newly added tests also show how to write text into an input field by calling the <strong class="source-inline">click</strong> and <strong class="source-inline">type</strong> functions. Then, you can use the <strong class="source-inline">postCommand</strong> custom chainable command to intercept HTTP <span class="No-Break">POST requests.</span></p>
			<ol>
				<li value="12">Lastly, before running the test, make Cypress skip the simple test we wrote earlier by calling <strong class="source-inline">skip</strong>, <span class="No-Break">like so:</span><pre class="console">
it.skip("should display login page", () =&gt; {</pre></li>
			</ol>
			<p>The preceding code changed the simple test from <em class="italic">run</em> to <span class="No-Break"><em class="italic">don’t run</em></span><span class="No-Break">.</span></p>
			<p>The entire code for the <strong class="source-inline">anti-heroes.cy.ts</strong> spec file can be found <span class="No-Break">at </span><a href="https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/e2e/anti-heroes.cy.ts"><span class="No-Break">https://github.com/PacktPublishing/Spring-Boot-and-Angular/blob/main/Chapter-15/superheroes/cypress/e2e/anti-heroes.cy.ts</span></a><span class="No-Break">.</span></p>
			<p>Now, we can run the <strong class="source-inline">anti-heroes.cs.ts</strong> spec file to see whether everything will pass, as shown in the <span class="No-Break">following figure:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer111">
					<img alt="Figure 15.8 – Passing tests" src="image/B18159_15_08.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.8 – Passing tests</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.8</em> shows that the <strong class="bold">should display login page</strong> test was skipped, while <a id="_idIndexMarker1189"/>the rest of the <span class="No-Break">tests passed.</span></p>
			<p>You can <a id="_idIndexMarker1190"/>see what is happening inside the <strong class="source-inline">beforeEach</strong> function, <span class="No-Break">like so:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer112">
					<img alt="Figure 15.9 – BEFORE EACH DOM snapshot" src="image/B18159_15_09.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.9 – BEFORE EACH DOM snapshot</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.9</em> shows the steps that were taken by the <strong class="source-inline">beforeEach</strong> function. The steps are DOM snapshots of the <span class="No-Break">web application.</span></p>
			<p>Let’s also check the test body of the <strong class="source-inline">anti-heroes.cy.ts</strong> spec file. You should see the <span class="No-Break">following information:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer113">
					<img alt="Figure 15.10 – TEST BODY DOM snapshot﻿" src="image/B18159_15_10.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.10 – TEST BODY DOM snapshot</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.10</em> shows the steps that were taken in the test body. These are the actions that you wrote in the <span class="No-Break"><strong class="source-inline">anti-heroes.cy.ts</strong></span><span class="No-Break"> file.</span></p>
			<p>We can <a id="_idIndexMarker1191"/>also see what happened inside the <strong class="source-inline">afterEach</strong> function. You <a id="_idIndexMarker1192"/>should be able to see the <span class="No-Break">following output:</span></p>
			<div>
				<div class="IMG---Figure" id="_idContainer114">
					<img alt="Figure 15.11 – AFTER EACH DOM snapshot" src="image/B18159_15_11.jpg"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 15.11 – AFTER EACH DOM snapshot</p>
			<p><span class="No-Break"><em class="italic">Figure 15</em></span><em class="italic">.11</em> shows the steps inside the <strong class="source-inline">afterEach</strong> function. Here, you can see that the <strong class="source-inline">afterEach</strong> function logged out and redirected the user to the application’s <span class="No-Break">login page.</span></p>
			<p>And that’s <a id="_idIndexMarker1193"/>how you write Cypress tests. Now, let’s summarize <a id="_idIndexMarker1194"/>what was covered in <span class="No-Break">this chapter.</span></p>
			<h1 id="_idParaDest-291"><a id="_idTextAnchor301"/>Summary</h1>
			<p>With this, you have arrived at the end of this chapter. First, you learned what Cypress is and how easy it is to set up and write an end-to-end test. You also learned how to intercept HTTP requests and mock <span class="No-Break">HTTP responses.</span></p>
			<p>In the next chapter, you will learn how to package both frontend and backend applications into a single executable <span class="No-Break">JAR file.</span></p>
		</div>
	

		<div class="Content" id="_idContainer116">
			<h1 id="_idParaDest-292"><a id="_idTextAnchor302"/>Part 4: Deployment</h1>
			<p>This part demonstrates the modern way of shipping backend and frontend applications. The following chapters are covered in <span class="No-Break">this part:</span></p>
			<ul>
				<li><a href="B18159_16.xhtml#_idTextAnchor303"><em class="italic">Chapter 16</em></a>, <em class="italic">Packaging Backend and Frontend with Maven</em></li>
				<li><a href="B18159_17.xhtml#_idTextAnchor315"><em class="italic">Chapter 17</em></a>, <em class="italic">Deploying Spring Boot and the Angular App</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer117">
			</div>
		</div>
		<div>
			<div id="_idContainer118">
			</div>
		</div>
	</body></html>