<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Security Patterns</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre10"><span class="calibre10">In </span></span>this chapter, we will look at security pattern concepts and how they can help us to implement better security applications. We will also learn about the single-sign-on pattern and how this can help us to provide a secure application. In addition, we will learn about the authentication mechanism and authentication interceptor, focusing on how to implement those concepts. After reading this chapter, we will be able to create a security application and implement it using Java EE 8. The topics covered in this chapter are as follows:</p>
<p class="mce-root"/>
<ul class="calibre15">
<li class="calibre16">Explaining the concept of security patterns</li>
<li class="calibre16">Explaining the concept of the single-sign-on pattern</li>
<li class="calibre16">Implementing the single-sign-on pattern</li>
<li class="calibre16">Explaining the authentication mechanism</li>
<li class="calibre16">Implementing the authentication mechanism</li>
<li class="calibre16">Explaining the authentication interceptor</li>
<li class="calibre16">Implementing the authentication interceptor</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining the concept of security patterns</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Applications have a close relationship with data and its storage. This is because applications <span class="calibre10">basically</span><span class="calibre10"> </span>consist of managing data in order to make it possible to optimize the business using automation tasks<span class="calibre10">, helping with decision-making, organizing tasks, and managing certain areas. Also, many companies need to store delicate data and validate access control. Over time, the demand for security software grew significantly, and many companies increasingly invested in creating </span><span class="calibre10">safe </span><span class="calibre10">applications.</span> An integral element of security is security information,<span class="calibre10"> </span>which follows these basic principles:</p>
<ul class="calibre15">
<li class="calibre16"><strong class="calibre3">Confidentiality</strong>: The data should not be accessible to non-authorized users or to any entities that request access to the data.</li>
<li class="calibre16"><strong class="calibre3">Integrity</strong>: The data cannot be updated or modified in a non-authorized manner.</li>
<li class="calibre16"><strong class="calibre3">Availability</strong>: The data should be available when it is needed.</li>
<li class="calibre16"><strong class="calibre3">Non-repudiation</strong>: Users cannot repudiate or deny the relation using data or any other process.</li>
</ul>
<p class="mce-root">For an application to be safe, it needs to provide at least <span class="calibre10">these basic principles</span><span class="calibre10">.</span></p>
<p class="mce-root">Security patterns are a set of solutions to common security problems that occur over and over. A large part of these security patterns works to solve problems about authentication, which is associated with confidentiality and integrity principles. With security patterns, the developer can write software <span class="calibre10">with </span><span class="calibre10">a</span><span class="calibre10"> </span><span class="calibre10">high level of security for targeting known problems and issues using solutions that are tested and validated.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining the concept of the single-sign-on pattern</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In a business environment, it is very common that, when a user logs in to a system, they are automatically logged into various other systems within the business without having to input their login details more than once. One example of this is Google services. Here, if a user logs in to one Google application (Gmail, YouTube, Google Drive), they are logged in to all the available Google <span class="calibre10">services.</span><span class="calibre10"> For example, if we log in to Gmail, we can access YouTube without having to log in again.</span></p>
<p class="mce-root">Single-sign-on is a security pattern that creates an authentication service that is shared with several applications of a domain to make the centered validation of authentication and authenticates a user only once in this domain. The user can then access all applications of this domain without having to authenticate again. All applications that depend on this type communicate with service authentication in order to validate the authentication of a user and log in if they are not <span class="calibre10">yet</span><span class="calibre10"> logged in. These applications can be made in any language or technology and can stay in several networks or separate physical locations. I</span><span class="calibre10">n the following diagram, we can see the process of authentication using single-sign-on:</span></p>
<div class="cdpaligncenter"><img src="Images/0df504d4-646b-43aa-913f-356b740f00f1.png" width="746" height="688" class="calibre96"/></div>
<p class="mce-root">In the preceding figure, we have three applications that are accessed by a user as well as a single point to log in and validate authentication. This single point is shown in our <span class="calibre10">diagram</span> by <strong class="calibre8">Authentication Service</strong>. When a user (represented by <strong class="calibre8">Actor</strong> in the <span class="calibre10">diagram</span>) sends a request to an application (<strong class="calibre8">Application 1</strong>, <strong class="calibre8">Application 2</strong>, or <strong class="calibre8">Application 3</strong>), this application waits for <strong class="calibre8">Authentication Service</strong> to validate whether the user is logged in. If not, they are redirected to the login page, and the user can log in there. After the user logs in, when they access <strong class="calibre8">Application 1</strong>, <strong class="calibre8">Application 2</strong>, or <strong class="calibre8">Application 3</strong>, they will not need to log in again. </p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">The single-sign-off pattern is a process that occurs when a user logs out of something. At this point, they are then logged out from all applications that they were logged in to by the authentication service. This is a good pattern because it makes it possible to log in and out of all applications only once, and it also separates all authentication logic from business logic, putting it into a separate service. This then promotes the decoupling of authentication logic and business logic, making it possible to change the logic authentication without impacting the business logic. This pattern can be done using OAuth, SAML, or a custom process of authentication. In a real-world situation, it is very common to use third-party solutions, such as OAuth0 and <strong class="calibre8">Red Hat single-sign-on</strong> (<strong class="calibre8">RH-SSO</strong>). In our example, we will complete a custom <span class="calibre10">authentication </span><span class="calibre10">process.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the single-sign-on pattern</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In our example of implementing <strong class="calibre8">single-sign-on</strong> (<strong class="calibre8">SSO</strong>), we will create the authentication service through a custom process to authenticate the users and we will also allow the user to log in using their login credentials. After this, one token will be generated and sent to the user. Further, we will create two applications (<kbd class="calibre18">App1</kbd> and <kbd class="calibre18">App2</kbd>), and when the user tries to access these applications when not logged in, the application will authenticate the user on the authentication service and the user will access <kbd class="calibre18">App1</kbd> and <kbd class="calibre18">App2</kbd> without having to log in again. The authentication service will be a REST application written using JAX-RS, and <kbd class="calibre18">App1</kbd> and <kbd class="calibre18">App2</kbd> will be applications that implement a JAX-RS client to validate user access. With this, t<span class="calibre10">he following classes will be created to use with our example:</span></p>
<ul class="calibre15">
<li class="calibre16"><kbd class="calibre18">AuthenticationResource</kbd>: This is responsible for processing the login request and validating the authentication of a user. This class is written using JAX-RS and is inside the authentication service application.</li>
<li class="calibre16"><kbd class="calibre18">AuthSession</kbd>: This is a session that contains data and information about logins. This class has the application scope, that is, a Java EE scope.</li>
<li class="calibre16"><kbd class="calibre18">Auth</kbd>: This is a bean that represents the logged-in user. This class contains the user's login details, password, and date of the last login. </li>
<li class="calibre16"><kbd class="calibre18">TokenUtils</kbd>: This is a class that contains a method for generating tokens.</li>
<li class="calibre16"><kbd class="calibre18">App1</kbd>: This app sends the <kbd class="calibre18">Welcome to App1</kbd> <span class="calibre5">text </span>if the user is logged in. If the user is not logged in, this application launches an error. </li>
<li class="calibre16"><kbd class="calibre18">App2</kbd>: <span class="calibre5">This app sends the <kbd class="calibre18">Welcome to App2</kbd> </span><span class="calibre5">text</span><span class="calibre5"> </span><span class="calibre5">if the user is logged in. If the user is not logged in, this application launches an error.</span></li>
<li class="calibre16"><kbd class="calibre18">Auth</kbd>: This is an interface with methods responsible for calling the authentication services.</li>
<li class="calibre16"><kbd class="calibre18">AuthImpl</kbd>: This is a class that implements the <kbd class="calibre18">Auth</kbd> interface. This class is an EJB.</li>
</ul>
<p class="mce-root">The <kbd class="calibre18">App1</kbd> and <kbd class="calibre18">App2</kbd> <span class="calibre10">applications</span><span class="calibre10"> </span><span class="calibre10">don't have any process or logic that is required in order to log a user in;</span> <span class="calibre10">this is the </span><span class="calibre10">responsibility</span> <span class="calibre10">of the authentication service (the resource that validates the authentication), which has the <kbd class="calibre18">AuthenticationResource</kbd> class with this responsibility. </span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the AuthenticationResource class</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre10"><kbd class="calibre18">AuthenticationResource</kbd> is a JAX-RS resource, which makes it possible to log in and validates the authentication of an application. In the following code, we have its implementation:</span></p>
<pre class="calibre23"><span class="calibre5">import </span>javax.inject.<span class="calibre5">Inject</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.*<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Response<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Date<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Optional<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Path</span>(<span class="calibre5">"auth"</span>)<br class="calibre2"/><span class="calibre5">public class </span>AuthenticationResource {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Inject<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>AuthSession <span class="calibre5">authSession</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@POST<br class="calibre2"/></span><span class="calibre5">    @Consumes</span>(<span class="calibre5">"application/x-www-form-urlencoded"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">login</span>(<span class="calibre5">@FormParam</span>(<span class="calibre5">"login"</span>) String login<span class="calibre5">, </span><span class="calibre5">@FormParam</span>(<span class="calibre5">"password"</span>) String password ) {<br class="calibre2"/><br class="calibre2"/>        //If user already logged, then get it token<br class="calibre2"/>        Optional&lt;String&gt; key = <span class="calibre5">authSession</span>.getToken(login<span class="calibre5">, </span>password)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        if </span>( key.isPresent() ){<br class="calibre2"/><br class="calibre2"/>           <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>(key.get()).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        //Validade login and password on data source<br class="calibre2"/>        <span class="calibre5">if</span>( !<span class="calibre5">authSession</span>.getDataSource().containsKey(login)<br class="calibre2"/>                || !<span class="calibre5">authSession</span>.getDataSource()<br class="calibre2"/>                .get(login)<br class="calibre2"/>                .getPassword()<br class="calibre2"/>                .equals( password) )<br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(Response.Status.<span class="calibre5">UNAUTHORIZED</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>String token = TokenUtils.<span class="calibre5">generateToken</span>()<span class="calibre5">;<br class="calibre2"/>        //Persiste the information of authentication on AuthSession<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">authSession</span>.putAuthenticated( token<span class="calibre5">, new </span>Auth(login<span class="calibre5">, </span>password<span class="calibre5">, new </span>Date()))<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        return </span>Response.<span class="calibre5">ok</span>(token).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <br class="calibre2"/>    <span class="calibre5">@HEAD<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/{token}"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">checkAuthentication</span>(<span class="calibre5">@PathParam</span>(<span class="calibre5">"token"</span>)String token)  {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( <span class="calibre5">authSession</span>.getAuthenticated().containsKey( token )){<br class="calibre2"/><br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>().build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(Response.Status.<span class="calibre5">UNAUTHORIZED</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">In the preceding code block, we have <kbd class="calibre18">AuthenticationResource</kbd>, which contains the <kbd class="calibre18">authSession</kbd> attribute that is used to persist the information about the login on the data source and obtain access to data sources that contain users' information used to validate login credentials. Further, <kbd class="calibre18">AuthenticationResource</kbd> has two methods: <kbd class="calibre18">login(String login, String password)</kbd>, which is used to process the login request, and <kbd class="calibre18">checkAuthentication( String token)</kbd>, which is used to allow clients to check whether a user is authenticated. In the following code block, we have the <kbd class="calibre18">login</kbd> method which is used to log a user in:</p>
<pre class="mce-root2"><span class="calibre5">    @POST<br class="calibre2"/></span><span class="calibre5">    @Consumes</span>(<span class="calibre5">"application/x-www-form-urlencoded"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">login</span>(<span class="calibre5">@FormParam</span>(<span class="calibre5">"login"</span>) String login<span class="calibre5">, </span><span class="calibre5">@FormParam</span>(<span class="calibre5">"password"</span>) String password ) {<br class="calibre2"/>        <br class="calibre2"/>        //If user already logged, then get it token <br class="calibre2"/>        Optional&lt;String&gt; key = <span class="calibre5">authSession</span>.getToken(login<span class="calibre5">, </span>password)<span class="calibre5">;</span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        if </span>( key.isPresent() ){<br class="calibre2"/><br class="calibre2"/>           <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>(key.get()).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/>        <br class="calibre2"/>        //Validate the login and password on data source    <br class="calibre2"/>        <span class="calibre5">if</span>( !<span class="calibre5">authSession</span>.getDataSource().containsKey(login)<br class="calibre2"/>                || !<span class="calibre5">authSession</span>.getDataSource()<br class="calibre2"/>                .get(login)<br class="calibre2"/>                .getPassword()<br class="calibre2"/>                .equals( password) )<br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(Response.Status.<span class="calibre5">UNAUTHORIZED</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>String token = TokenUtils.<span class="calibre5">generateToken</span>()<span class="calibre5">;<br class="calibre2"/>        //Persiste the information of authentication on the AuthSession.<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">authSession</span>.putAuthenticated( token<span class="calibre5">, new </span>Auth(login<span class="calibre5">, </span>password<span class="calibre5">, new </span>Date()))<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        return </span>Response.<span class="calibre5">ok</span>(token).status(Response.Status.CREATED).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}</pre>
<p class="mce-root">In the preceding code block, we can see that if a user is already logged in, the token is returned as a response. If the user is not logged in, the login and password details are validated and a new token is generated and returned as a response. Note that this method is called when the client sends a <kbd class="calibre18">POST</kbd> request to this resource.</p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">The other method is<span class="calibre10"> </span><kbd class="calibre18">checkAuthentication( String token)</kbd><span class="calibre10">, which is used to allow clients to check whether a user is authenticated. In the preceding code block, we have this method.</span> This method returns the 200 HTTP status code to the client if it is logged in, or returns the 401 <span class="calibre10">HTTP status code</span> if it is not logged in:</p>
<pre class="mce-root2"><span class="calibre5">    @HEAD<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/{token}"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">checkAuthentication</span>(<span class="calibre5">@PathParam</span>(<span class="calibre5">"token"</span>)String token)  {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( <span class="calibre5">authSession</span>.getAuthenticated().containsKey( token )){<br class="calibre2"/><br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>().build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(Response.Status.<span class="calibre5">UNAUTHORIZED</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}</pre>
<p class="mce-root">Note that the <kbd class="calibre18">checkAuthentication(String token)</kbd> <span class="calibre10">method </span><span class="calibre10">is called when the client sends a <kbd class="calibre18">HEAD</kbd> request.</span></p>
<p class="mce-root">The <kbd class="calibre18">AuthSession</kbd> class is used in the <kbd class="calibre18">AuthenticationResource</kbd> class. The <kbd class="calibre18"><span class="calibre5">AuthSession</span></kbd> class has an application scope and is used to persist information about users that are logged in and has a data source that contains all users' login credentials:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.annotation.<span class="calibre5">PostConstruct</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.enterprise.context.<span class="calibre5">ApplicationScoped</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.HashMap<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Map<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Optional<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@ApplicationScoped<br class="calibre2"/></span><span class="calibre5">public class </span>AuthSession {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>Map&lt;String<span class="calibre5">,</span>Auth&gt; <span class="calibre5">authenticated</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    private </span>Map&lt;String<span class="calibre5">,</span>Auth&gt; <span class="calibre5">dataSource</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@PostConstruct<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public void </span><span class="calibre5">init</span>(){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">authenticated </span>= <span class="calibre5">new </span>HashMap&lt;&gt;()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">dataSource </span>= <span class="calibre5">new </span>HashMap&lt;&gt;()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        for</span>(<span class="calibre5">int </span>i = <span class="calibre5">1</span><span class="calibre5">; </span>i &lt;= <span class="calibre5">50</span><span class="calibre5">; </span>i++){<br class="calibre2"/>            <span class="calibre5">dataSource</span>.put(<span class="calibre5">"login"</span>+i<span class="calibre5">, new </span>Auth(<span class="calibre5">"login"</span>+i<span class="calibre5">, </span><span class="calibre5">"123456"</span>) )<span class="calibre5">;<br class="calibre2"/>        }<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>AuthSession <span class="calibre5">putAuthenticated</span>(String key<span class="calibre5">, </span>Auth auth){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">authenticated</span>.put(key<span class="calibre5">, </span>auth)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        return this;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>AuthSession <span class="calibre5">removeAuthenticated</span>(String key<span class="calibre5">, </span>Auth auth){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">authenticated</span>.remove(key<span class="calibre5">, </span>auth)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        return this;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>Map&lt;String<span class="calibre5">, </span>Auth&gt; <span class="calibre5">getAuthenticated</span>() {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">authenticated</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>Map&lt;String<span class="calibre5">, </span>Auth&gt; <span class="calibre5">getDataSource</span>() {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">dataSource</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>Optional&lt;String&gt; <span class="calibre5">getToken</span>(String login<span class="calibre5">, </span>String password){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">for</span>( String key :  <span class="calibre5">authenticated</span>.keySet() ){<br class="calibre2"/><br class="calibre2"/>            Auth auth = <span class="calibre5">authenticated</span>.get( key )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            if</span>( auth.getLogin().equals(login)<br class="calibre2"/>                    &amp;&amp;  auth.getPassword().equals( password )){<br class="calibre2"/>                <span class="calibre5">return </span>Optional.<span class="calibre5">of</span>(key)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            </span>}<br class="calibre2"/><br class="calibre2"/>        }<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Optional.<span class="calibre5">empty</span>()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"><kbd class="calibre18">Auth</kbd> is a bean that contains information about users' login details:</p>
<pre class="mce-root2"><span class="calibre5">import </span>java.util.Date<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">public class </span>Auth {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>String <span class="calibre5">login</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    private </span>String <span class="calibre5">password</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    private </span>Date <span class="calibre5">loginDate</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    public </span><span class="calibre5">Auth</span>(){}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span><span class="calibre5">Auth</span>(String login<span class="calibre5">, </span>String password){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">this</span>.<span class="calibre5">login </span>= login<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        this</span>.<span class="calibre5">password </span>= password<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span><span class="calibre5">Auth</span>(String login<span class="calibre5">, </span>String password<span class="calibre5">, </span>Date loginDate){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">this</span>.<span class="calibre5">login </span>= login<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        this</span>.<span class="calibre5">password </span>= password<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        this</span>.<span class="calibre5">loginDate </span>= loginDate<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>String <span class="calibre5">getLogin</span>() {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">login</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public void </span><span class="calibre5">setLogin</span>(String login) {<br class="calibre2"/>        <span class="calibre5">this</span>.<span class="calibre5">login </span>= login<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>String <span class="calibre5">getPassword</span>() {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">password</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public void </span><span class="calibre5">setPassword</span>(String password) {<br class="calibre2"/>        <span class="calibre5">this</span>.<span class="calibre5">password </span>= password<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>Date <span class="calibre5">getLoginDate</span>() {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">loginDate</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public void </span><span class="calibre5">setLoginDate</span>(Date loginDate) {<br class="calibre2"/>        <span class="calibre5">this</span>.<span class="calibre5">loginDate </span>= loginDate<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root"><span class="calibre10">As demonstrated, </span><kbd class="calibre18">TokenUtils</kbd> is a class that uses the <kbd class="calibre18">generateToken()</kbd> <span class="calibre10">method</span><span class="calibre10"> </span><span class="calibre10">to generate a new token:</span></p>
<pre class="mce-root2"><span class="calibre5">import </span>java.security.SecureRandom<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Date<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">public class </span>TokenUtils {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public static </span>String <span class="calibre5">generateToken</span>(){<br class="calibre2"/><br class="calibre2"/>        SecureRandom random = <span class="calibre5">new </span>SecureRandom()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        long </span>longToken = Math.<span class="calibre5">abs</span>( random.nextLong() )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        return </span>Long.<span class="calibre5">toString</span>(<span class="calibre5">new </span>Date().getTime()) + Long.<span class="calibre5">toString</span>( longToken<span class="calibre5">, </span><span class="calibre5">16 </span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the App1 and App2 classes</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In the preceding code block, we have the code of the <span class="calibre10"><kbd class="calibre18">App1</kbd></span> <span class="calibre10">application. When this application is accessed by a <kbd class="calibre18">GET</kbd> request, a request is sent to the authentication service to</span> validate<span class="calibre10"> whether the user </span><span class="calibre10">has</span><span class="calibre10"> </span><span class="calibre10">already logged in:</span></p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.inject.<span class="calibre5">Inject</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.*<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Response<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Objects<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Path</span>(<span class="calibre5">"app1"</span>)<br class="calibre2"/><span class="calibre5">public class </span>App1 {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Inject<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>Auth <span class="calibre5">auth</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>( String token ){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( !<span class="calibre5">auth</span>.isLogged( token ) ){<br class="calibre2"/>            <span class="calibre5">throw new </span>WebApplicationException(Response.Status.<span class="calibre5">UNAUTHORIZED</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App1!"</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@POST<br class="calibre2"/></span><span class="calibre5">    @Consumes</span>(<span class="calibre5">"application/x-www-form-urlencoded"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>(<span class="calibre5">@FormParam</span>(<span class="calibre5">"login"</span>) String login<span class="calibre5">, </span><span class="calibre5">@FormParam</span>(<span class="calibre5">"password"</span>) String password ) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( Objects.<span class="calibre5">isNull</span>(login) || Objects.<span class="calibre5">isNull</span>(password) ){<br class="calibre2"/>            <span class="calibre5">throw new </span>WebApplicationException(Response.Status.<span class="calibre5">INTERNAL_SERVER_ERROR</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        String token = <span class="calibre5">auth</span>.login(login<span class="calibre5">,</span>password)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App1!"</span>)<br class="calibre2"/>                .header(<span class="calibre5">"token"</span><span class="calibre5">,</span>token)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">In the preceding code, we have the <kbd class="calibre18">App1</kbd> <span class="calibre10">class, which contains</span><span class="calibre10"> the <kbd class="calibre18">auth</kbd> parameter, which is an EJB used to integrate with the authentication service. Further, this class has two methods, called</span> <kbd class="calibre18">helloWorld</kbd>, <span class="calibre10">with different signatures. In </span><kbd class="calibre18">helloWorld( String login, String password )</kbd><span class="calibre10">, the login is completed and then the </span><kbd class="calibre18">Hello World. Welcome to App1!</kbd> message <span class="calibre10">is sent to the user. In </span><kbd class="calibre18">helloWorld( String token )</kbd><span class="calibre10">, the token is validated, and if it is a valid token and the user is logged in, the </span><kbd class="calibre18">Hello World. Welcome to App1!</kbd> message <span class="calibre10">is sent to the user.</span><span class="calibre10"> </span></p>
<p class="mce-root">In the following code block, we have the <kbd class="calibre18">App2</kbd> class. This has the same code as <kbd class="calibre18">App1</kbd>, but prints another message to the user. This class stays in another application, known as <kbd class="calibre18">App2</kbd> to us:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.inject.<span class="calibre5">Inject</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.*<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Response<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Objects<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Path</span>(<span class="calibre5">"app2"</span>)<br class="calibre2"/><span class="calibre5">public class </span>App2 {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Inject<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>Auth <span class="calibre5">auth</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>( String token ){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( !<span class="calibre5">auth</span>.isLogged( token ) ){<br class="calibre2"/>            <span class="calibre5">throw new </span>WebApplicationException(Response.Status.<span class="calibre5">UNAUTHORIZED</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response.<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App2!"</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@POST<br class="calibre2"/></span><span class="calibre5">    @Consumes</span>(<span class="calibre5">"application/x-www-form-urlencoded"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>(<span class="calibre5">@FormParam</span>(<span class="calibre5">"login"</span>) String login<span class="calibre5">, </span><span class="calibre5">@FormParam</span>(<span class="calibre5">"password"</span>) String password ) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if</span>( Objects.<span class="calibre5">isNull</span>(login) || Objects.<span class="calibre5">isNull</span>(password) ){<br class="calibre2"/>            <span class="calibre5">throw new </span>WebApplicationException(Response.Status.<span class="calibre5">INTERNAL_SERVER_ERROR</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        String token = <span class="calibre5">auth</span>.login(login<span class="calibre5">,</span>password)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App2!"</span>)<br class="calibre2"/>                .header(<span class="calibre5">"token"</span><span class="calibre5">,</span>token)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">In the following code block, we have the <kbd class="calibre18">Auth</kbd> interface. This interface contains the contract with the methods responsible for integrating with the authentication service, validating the authentication, and logging in:</p>
<pre class="mce-root2"><span class="calibre5">public interface </span>Auth {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public boolean </span><span class="calibre5">isLogged</span>(String token)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    public </span>String <span class="calibre5">login</span>(String login<span class="calibre5">, </span>String password)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>String <span class="calibre5">logout</span>(String token)<span class="calibre5">;<br class="calibre2"/></span>}</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"><span class="calibre10">In the following code block, we have the <kbd class="calibre18">AuthImpl</kbd> class, which is an implementation of the <kbd class="calibre18">Auth</kbd> interface as well as a stateless EJB:</span></p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.ejb.<span class="calibre5">Stateless</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.client.ClientBuilder<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.client.Entity<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.client.WebTarget<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Form<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Stateless<br class="calibre2"/></span><span class="calibre5">public class </span>AuthImpl <span class="calibre5">implements </span>Auth {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>String <span class="calibre5">URL </span>= <span class="calibre5">"http://localhost:8080/javaEE8ExampleSSOAppService/resources/auth"</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@Override<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public boolean </span><span class="calibre5">isLogged</span>(String token) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>prepareWebTarget().path(<span class="calibre5">"/"</span>+ token)<br class="calibre2"/>                .request()<br class="calibre2"/>                .head().getStatus() == <span class="calibre5">200</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Override<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>String <span class="calibre5">login</span>(String login<span class="calibre5">, </span>String password) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>prepareWebTarget()<br class="calibre2"/>                .request()<br class="calibre2"/>                .post(Entity.<span class="calibre5">form</span>(<span class="calibre5">new </span>Form(<span class="calibre5">"login"</span><span class="calibre5">, </span>login )<br class="calibre2"/>                                .param(<span class="calibre5">"password"</span><span class="calibre5">, </span>password))<span class="calibre5">,<br class="calibre2"/></span><span class="calibre5">                      </span>String.<span class="calibre5">class</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Override<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>String <span class="calibre5">logout</span>(String token) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>prepareWebTarget().path(<span class="calibre5">"/"</span>+ token)<br class="calibre2"/>                .request()<br class="calibre2"/>                .delete(String.<span class="calibre5">class</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">protected </span>WebTarget <span class="calibre5">prepareWebTarget</span>() {<br class="calibre2"/><br class="calibre2"/></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<pre class="mce-root2">        <span class="calibre5">return </span>ClientBuilder.<span class="calibre5">newClient</span>().target(<span class="calibre5">URL</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">In the preceding code block, we have three methods, called <kbd class="calibre18">isLogged</kbd>, <kbd class="calibre18">login</kbd>, and <kbd class="calibre18">logout</kbd>, with the signatures <kbd class="calibre18">isLogged(String token)</kbd>, <kbd class="calibre18">login(String login, String password)</kbd>, and <kbd class="calibre18">logout(String token)</kbd>, respectively.</p>
<p class="mce-root">When a user logs in to an application (either <kbd class="calibre18">App1</kbd> or <kbd class="calibre18">App2</kbd>), and when the user navigates to another application using the token, this user will not need to log in again. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining the authentication mechanism</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In an enterprise environment, every application or resource needs to validate the user access and guarantee that all users that access these applications or resources will be identified and validated to prevent non-authorized access. When a user requests access to a protected area, they need to be authenticated and then their permissions will be validated by the server. To allow a developer to authenticate and validate users, Java EE 8 has to have an Authentication Mechanism, which is a common solution in Java EE 8 that allows developers to authenticate and validate users in a fast and easy way. The Java EE 8 has five mechanisms to authenticate users:</p>
<ul class="calibre15">
<li class="calibre16">Basic authentication</li>
<li class="calibre16">Form-based authentication</li>
<li class="calibre16">Digest authentication</li>
<li class="calibre16">Client authentication</li>
<li class="calibre16">Mutual authentication </li>
</ul>
<p class="mce-root"><span class="calibre10">The authentication mechanism works by identifying the roles that define user permissions. Identity is generally </span><span class="calibre10">defined</span><span class="calibre10"> </span><span class="calibre10">by logging in with a username and password. This information about a user needs to be kept in a database, generally called a</span> <em class="calibre12">realm</em>, <span class="calibre10">to allow the server to validate the information. To use the authentication mechanism, we configure it with the deployment descriptor file, using annotation or the programmatic way. Usually, we will specify an authentication mechanism using annotation or a deployment descriptor file. </span></p>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining basic authentication</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Basic authentication is the default mechanism if the developer uses an authentication mechanism without defining it. With this authentication mechanism, if the user is not authenticated when they send a request, then a dialog box requesting a username and password is returned. This mechanism is not completely safe, because the username and password are easily captured, making <em class="calibre12">man-in-the-middle</em> attacks possible. To use this authentication mechanism, it is recommended to use a secure transport mechanism, such as SSL (HTTPS) or a VPN. The following figure represents a Java EE tutorial showing what happens when basic authentication is used:</p>
<div class="cdpaligncenter"><img src="Images/0de03f79-aab7-42f8-9961-51b7d45f1665.png" width="560" height="353" class="calibre97"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining form authentication</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Form-based authentication is an authentication mechanism that uses forms to request a username and password, allowing the developer to customize the login and error screen. When a user requests access to a protected resource, the authentication mechanism sends a login page to the user, who then inputs the username and password and sends them to the server. If the <span class="calibre10">username</span> or password is not correct, the server will return the error page or return the <span class="calibre10">requested </span><span class="calibre10">resource. </span><span class="calibre10">This mechanism is not safe either, because the username and password are also easily captured in this way, making a </span><em class="calibre12">man-in-the-middle</em><span class="calibre10"> attack possible. As mentioned in the previous section, it is recommended to use a secure transport mechanism, such as SSL (HTTPS) or a VPN, when using <span class="calibre10">this authentication mechanism</span>.</span><span class="calibre10"> </span></p>
<p class="mce-root"><span class="calibre10">The following diagram represents a Java EE tutorial, showing what happens when form-based authentication is used:</span></p>
<div class="cdpaligncenter"><img src="Images/570365ca-b6b7-449e-bb7b-f3ea8108ee46.png" width="579" height="368" class="calibre98"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining digest authentication</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Digest authentication is an authentication mechanism that uses a one-way cryptographic hash of the password and additional data. With this mechanism, the developer does not need to use a secure transport mechanism to protect login credentials. This is because this mechanism already provides the security. When a user sends a digest to a server, the digest authentication needs a clear-text password available in order to digest and validate the access, comparing the clear-text password sent with the password saved on the server. </p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining client authentication</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Client authentication is a mechanism that authenticates the client by using its public key certificate instead of a username and password, such as in basic and form-based authentication. This mechanism is considered more secure because it uses HTTP over SSL (HTTPS) and uses the client's public key certificate.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining mutual authentication</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Mutual authentication is an authentication mechanism where a server authenticates a client and a client authenticates a server. Mutual authentication works with <em class="calibre12">certificate-based</em> or <em class="calibre12">username/password-based</em>. With <em class="calibre12">certificate-based</em>, the client requests access to a protected resource, then the server responds, sending its certificate to the client. After this, the client verifies the server certificate and, if the server's certificate is valid, the client sends its certificate to the server. The server then verifies the client's certificate and, if the client's certificate is valid, the server grants the client access <span class="calibre10">to</span><span class="calibre10"> </span><span class="calibre10">the protected resource. The following diagram </span><span class="calibre10">shows what happens when mutual authentication with</span> <span class="calibre10"><em class="calibre12">certificate-</em></span><em class="calibre12">based</em> works:</p>
<p class="cdpaligncenter2"><img src="Images/c6542b6a-f37d-4898-84aa-5ac99109d97c.png" width="618" height="645" class="calibre99"/></p>
<p class="mce-root">In <em class="calibre12">username/password-</em><em class="calibre12">bas</em><em class="calibre12">ed</em>, <span class="calibre10">the client requests access to a protected resource, then the server responds, sending its certificate to the client. The client then verifies the server certificate and if it is valid, the client sends its username and password to the server. Following this, the server verifies the credentials and, if these are valid, the server grants the client access </span><span class="calibre10">to</span><span class="calibre10"> </span><span class="calibre10">the protected resource. The following diagram shows what happens when mutual authentication with</span> <span class="calibre10"><em class="calibre12">username/password-</em></span><em class="calibre12">based</em> <span class="calibre10">work</span><span class="calibre10">s:</span></p>
<div class="cdpaligncenter"><img src="Images/d0141b09-7f02-40e9-a963-2d9d360fcc66.png" width="652" height="492" class="calibre100"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">When to use the deployment descriptor, annotation, or programmatic configuration</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To specify and configure the authentication mechanism, we can either <span class="calibre10">use</span><span class="calibre10"> the </span><span class="calibre10">deployment descriptor file, use annotation, or programmatically define the configuration. Generally, we choose annotation because it is easy to use in Java EE projects. However, sometimes it easier and more interesting to use deployment descriptors or programmatic configuration. If this is the case, what are the appropriate scenarios in which to use each? </span></p>
<p class="mce-root">When we use a deployment descriptor, we define a file of configurations and create a configuration to a set of resources. This makes it possible to create a single location to configure our security policies and associate it with a set of resources. However, when we use an annotation, we define a policy on the specific resource and it overrides the deployment descriptor, if it exists. Using annotations, we create an authentication's configurations because it doesn't need to set up an XML file. However, when we use a programmatic configuration, <span class="calibre10">we can authenticate other characteristics</span> that don't exist and we can use the authentication mechanism in a dynamic way. Further, when we want to create configurations for a set of resources, we can use the deployment descriptor file. When we want to create an authentication using dynamic behavior, we use programmatic configuration, and when we need to create a configuration in an easy manner, we use annotation.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the authentication mechanism</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre10">In our example of implementing an authentication mechanism, we will create an application with resources that receive a request and return <em class="calibre12">hello world</em> messages to the user. However, this resource is protected and the user needs to be authenticated in order to access this resource. Further, we will set up some security policies and associations through the deployment descriptor file, some security policies to some resources using annotation, and some security policies to some resources using the programmatic configuration. We will also use basic authentication. To configure the security policies using the deployment descriptor file and programmatic configuration, we will use a JAX-RS resource. To configure the security policies using annotation, we will use a servlet. All of the examples used here are secure in a web application, but Java EE 8 permits the use of authentication mechanisms on the enterprise application. In this example, the following classes are used:</span></p>
<ul class="calibre15">
<li class="calibre16"><kbd class="calibre18">web.xml</kbd>: <span class="calibre5"><span class="calibre5">This is a deployment descriptor file that is used to configure the authentication mechanism.</span></span></li>
<li class="calibre16"><kbd class="calibre18">HelloWorld</kbd>: This is a JAX-RS resource class that contains the authentication mechanism used by the deployment descriptor file and the programmatic configuration.</li>
<li class="calibre16"><kbd class="calibre18">HelloWorldServlet</kbd>: This is a s<span class="calibre5">ervlet class that contains the authentication mechanism used by the annotation.</span></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the web.xml file</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><kbd class="calibre18">web.xml</kbd> is a deployment descriptor of a web application and it contains many configurations about the web application. In the following deployment descriptor, we have the security configurations for our web application:</p>
<pre class="mce-root2"><span class="calibre5">&lt;?</span><span class="calibre5">xml version</span><span class="calibre5">="1.0" </span><span class="calibre5">encoding</span><span class="calibre5">="UTF-8" </span><span class="calibre5">?&gt;<br class="calibre2"/></span><span class="calibre5">&lt;web-app &gt;<br class="calibre2"/></span><span class="calibre5">    &lt;security-constraint&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;web-resource-collection&gt;<br class="calibre2"/></span><span class="calibre5">            &lt;web-resource-name&gt;</span>helloworld<span class="calibre5">&lt;/web-resource-name&gt;<br class="calibre2"/></span><span class="calibre5">            &lt;url-pattern&gt;</span>/resources/helloworld/*<span class="calibre5">&lt;/url-pattern&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;/web-resource-collection&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;auth-constraint&gt;<br class="calibre2"/></span><span class="calibre5">            &lt;role-name&gt;</span>user<span class="calibre5">&lt;/role-name&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;/auth-constraint&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;user-data-constraint&gt;<br class="calibre2"/></span><span class="calibre5">            &lt;transport-guarantee&gt;</span>CONFIDENTIAL<span class="calibre5">&lt;/transport-guarantee&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;/user-data-constraint&gt;<br class="calibre2"/></span><span class="calibre5">    &lt;/security-constraint&gt;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    &lt;login-config&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;auth-method&gt;</span>BASIC<span class="calibre5">&lt;/auth-method&gt;<br class="calibre2"/></span><span class="calibre5">    &lt;/login-config&gt;<br class="calibre2"/></span><span class="calibre5">&lt;/web-app&gt;<br class="calibre2"/></span></pre>
<p class="mce-root"><span class="calibre10">In this deployment descriptor, we define the security to all resources that its URL matches with the <kbd class="calibre18">/resources/helloworld/*</kbd> pattern. In the following XML code, we have a snippet of <kbd class="calibre18">web.xml</kbd></span><span class="calibre10"> that defines a URL pattern:</span></p>
<pre class="mce-root2"><span class="calibre5"> &lt;web-resource-collection&gt;<br class="calibre2"/></span><span class="calibre5">     &lt;web-resource-name&gt;</span>helloworld<span class="calibre5">&lt;/web-resource-name&gt;<br class="calibre2"/></span><span class="calibre5">     &lt;url-pattern&gt;</span>/resources/helloworld/*<span class="calibre5">&lt;/url-pattern&gt;<br class="calibre2"/></span><span class="calibre5"> &lt;/web-resource-collection&gt;</span></pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root"><span class="calibre10">The following XML code contains a snippet of <kbd class="calibre18">web.xml</kbd> that defines security roles:</span></p>
<pre class="mce-root2"><span class="calibre5">&lt;auth-constraint&gt;<br class="calibre2"/></span><span class="calibre5">    &lt;role-name&gt;</span>user<span class="calibre5">&lt;/role-name&gt;<br class="calibre2"/></span><span class="calibre5">&lt;/auth-constraint&gt;</span></pre>
<p class="mce-root"><span class="calibre10">In the following XML code, we have a snippet of <kbd class="calibre18">web.xml</kbd> that defines the authentication mechanism:</span></p>
<pre class="mce-root2"><span class="calibre5">&lt;login-config&gt;<br class="calibre2"/></span><span class="calibre5">    &lt;auth-method&gt;</span>BASIC<span class="calibre5">&lt;/auth-method&gt;<br class="calibre2"/></span><span class="calibre5">&lt;/login-config&gt;</span></pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the HelloWorld class</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">The <kbd class="calibre18">HelloWorld</kbd> class is a JAX-RS resource that responds to requests sent to the <kbd class="calibre18">/helloworld</kbd> path<em class="calibre12">.</em> This class has two methods with the respective <kbd class="calibre18">helloWorldWithDeploymentDescriptor()</kbd> and <span class="calibre10"><kbd class="calibre18">helloWorldWithProgrammatically()</kbd> signatures. In <kbd class="calibre18">helloWorldWithDeploymentDescriptor()</kbd>, the authentication validation is oriented by the deployment descriptor configuration, and in <kbd class="calibre18">helloWorldWithProgrammatically()</kbd>, the authentication validation is oriented by codes written by the developer:</span></p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.ws.rs.<span class="calibre5">GET</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.<span class="calibre5">Path</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.<span class="calibre5">Context</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Response<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.SecurityContext<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Path</span>(<span class="calibre5">"helloworld"</span>)<br class="calibre2"/><span class="calibre5">public class </span>HelloWorld {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Context<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>SecurityContext <span class="calibre5">securityContext</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/deploymentdescriptor"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorldWithDeploymentDescriptor()</span>{<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App with validation by deployment descriptor!"</span>)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/programmatically"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorldWithProgrammatically</span>() {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if </span>(!<span class="calibre5">securityContext</span>.isUserInRole(<span class="calibre5">"user"</span>)) {<br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(<span class="calibre5">401</span>).header(<span class="calibre5">"WWW-Authenticate"</span><span class="calibre5">, </span><span class="calibre5">"Basic"</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App with validation by programmatically."</span>)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">The preceding code includes the <kbd class="calibre18">helloWorldWithDeploymentDescriptor()</kbd> <span class="calibre10">method,</span><span class="calibre10"> </span><span class="calibre10">which contains the code that only responds to the client because the validation of authentication is done by the Java EE context without using any code together with the core business logic. In t</span><span class="calibre10">he following code, we have a snippet of the <kbd class="calibre18">HelloWorld</kbd> class that includes the <kbd class="calibre18">helloWorldWithDeploymentDescriptor()</kbd> method:</span></p>
<pre class="mce-root2"><span class="calibre5">    @GET<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/deploymentdescriptor"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorldWithDeploymentDescriptor()</span>{<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App with validation by deployment descriptor!"</span>)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}</pre>
<p class="mce-root">In the following code, we have a snippet of the <kbd class="calibre18">HelloWorld</kbd> class that includes a <kbd class="calibre18">helloWorldWithProgrammatically()</kbd> <span class="calibre10">method<span class="calibre10"><span class="calibre10"> </span></span></span><span class="calibre10">that uses a code to validate the role associated with each user that sent a request:</span></p>
<pre class="mce-root2"><span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    @Path</span>(<span class="calibre5">"/programmatically"</span>)<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorldWithProgrammatically</span>() {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if </span>(!<span class="calibre5">securityContext</span>.isUserInRole(<span class="calibre5">"user"</span>)) {<br class="calibre2"/>            <span class="calibre5">return </span>Response.<span class="calibre5">status</span>(<span class="calibre5">401</span>).header(<span class="calibre5">"WWW-Authenticate"</span><span class="calibre5">, </span><span class="calibre5">"Basic"</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response<br class="calibre2"/>                .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App with validation by programmatically."</span>)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}</pre>
<p class="mce-root">To show the dialog box in the browser in a programmatic manner, use the following code:</p>
<pre class="mce-root2"> <span class="calibre5">if </span>(!<span class="calibre5">securityContext</span>.isUserInRole(<span class="calibre5">"user"</span>)) {<br class="calibre2"/>      r<span class="calibre5">eturn </span>Response.<span class="calibre5">status</span>(<span class="calibre5">401</span>).header(<span class="calibre5">"WWW-Authenticate"</span><span class="calibre5">, <br class="calibre2"/></span><span class="calibre5">      "Basic"</span>).build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"> </span>}</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the HelloWordServlet class</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre10">The <kbd class="calibre18">HelloWorldServlet</kbd> class is a s</span>ervlet <span class="calibre10">class that responds to requests sent to the</span> <kbd class="calibre18">/helloworld/annotation</kbd><em class="calibre12"> </em><span class="calibre10">path.</span><span class="calibre10"> This class has a <kbd class="calibre18">doGet(HttpServletRequest request, HttpServletResponse response)</kbd></span><span class="calibre10"> </span><span class="calibre10">method</span><span class="calibre10"> </span><span class="calibre10">that responds to all <kbd class="calibre18">GET</kbd> requests. After this method is processed, a validation of authentication is done, and if the user is associated with the</span> <kbd class="calibre18">user</kbd> <span class="calibre10">role, the method is processed. If not, the dialog box is returned to the user:</span></p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.annotation.security.<span class="calibre5">DeclareRoles</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.ServletException<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.annotation.<span class="calibre5">HttpConstraint</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.annotation.<span class="calibre5">ServletSecurity</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.annotation.<span class="calibre5">WebServlet</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServlet<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServletRequest<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServletResponse<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.io.IOException<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@WebServlet</span>(<span class="calibre5">name </span>= <span class="calibre5">"HelloWorldServlet"</span><span class="calibre5">, </span><span class="calibre5">urlPatterns </span>= <span class="calibre5">"/helloworld/annotation"</span>)<br class="calibre2"/><span class="calibre5">@DeclareRoles</span>(<span class="calibre5">"user"</span>)<br class="calibre2"/><span class="calibre5">@ServletSecurity</span>(<span class="calibre5">@HttpConstraint</span>(<span class="calibre5">transportGuarantee </span>= <span class="calibre5">ServletSecurity</span>.TransportGuarantee.<span class="calibre5">NONE</span><span class="calibre5">,<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">rolesAllowed </span>= {<span class="calibre5">"user"</span>}))<br class="calibre2"/><span class="calibre5">public class </span>HelloWorldServlet <span class="calibre5">extends </span>HttpServlet {<br class="calibre2"/>    <br class="calibre2"/>    <span class="calibre5">protected void </span><span class="calibre5">doGet</span>(HttpServletRequest request<span class="calibre5">, <br class="calibre2"/></span>   HttpServletResponse response) <span class="calibre5">throws </span>ServletException<span class="calibre5">, </span>IOException {<br class="calibre2"/><br class="calibre2"/>        response.getWriter().write(<span class="calibre5">"Hello World. Welcome to App with <br class="calibre2"/>        validation by annotation!"</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Explaining the authentication interceptor</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In an enterprise application, authentication is a very important process and this can be done using many <span class="calibre10">techniques</span>. In Java EE 8, one of these techniques is the interceptor pattern. </p>
<p class="mce-root">The interceptor pattern is an advanced programming technique that makes it possible to intercept an object call and process algorithms before or after processing the call. This works as <strong class="calibre8">aspect-oriented programming</strong> (<strong class="calibre8">AOP</strong>), which makes it possible to include behavior in a process without altering its logic. To implement this using Java EE 8, we can use either<span class="calibre10"> the</span><span class="calibre10"> EJB interceptor or the CDI interceptor. We can also select which kind of interceptor to use, depending on whether we are intercepting an EJB class/method or a CDI class/method.</span></p>
<p class="mce-root">The authentication interceptor is a technique that uses an interceptor pattern either through an EJB interceptor or a CDI interceptor. This is done to add authentication logic before or after <span class="calibre10">using </span><span class="calibre10">the business logic aspect of oriented programming. We can then validate the authentication without having to couple the authentication logic with the business logic. It is better to use the EJB interceptor with business logic in an EJB class, and it is better to use the CDI interceptor with the CDI class in a web tier.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the authentication interceptor</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre10">In our final example of implementing the authentication interceptor,</span> <span class="calibre10">we will create an application with resources that receives a user request and returns </span><em class="calibre12">hello world</em><span class="calibre10"> messages to the user, but this resource is protected and the user needs to be authenticated in order to access the resource.</span> <span class="calibre10">However, this protection is achieved by authenticating the interceptor implemented using the CDI interceptor, which captures a call to a resource and validates the user access</span><span class="calibre10">. Further, we will use the basic authentication mechanism to do an authentication validation; the source of the user data will not be managed by the application server and Java EE, but by a custom data source. In this example, the following classes are used:</span></p>
<ul class="calibre15">
<li class="calibre16"><kbd class="calibre18">DataSource</kbd><span class="calibre5">: This is the data source that contains security user information.</span></li>
<li class="calibre16"><kbd class="calibre18">Auth</kbd>: This is the interface used to define a method to validate authentication and authorization.</li>
<li class="calibre16"><kbd class="calibre18">AuthImpl</kbd>: This is the class that implements the <kbd class="calibre18">Auth</kbd> interface.</li>
<li class="calibre16"><kbd class="calibre18">Authentication</kbd>: This is the qualifier used to configure the method to be intercepted.</li>
<li class="calibre16"><kbd class="calibre18">AuthenticationInterceptor</kbd>: This is the interceptor that intercepts a call to the <kbd class="calibre18">HelloWorld</kbd> methods and validates the user access.</li>
<li class="calibre16"><kbd class="calibre18">HelloWorld</kbd>: This is the JAX-RS resource class that contains the authentication mechanism used by the deployment descriptor file and programmatic configuration.</li>
<li class="calibre16"><kbd class="calibre18">AuthUtils</kbd>: This is the utility c<span class="calibre5">lass f</span>or authentication.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the CDI interceptor</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To implement the CDI interceptor, we need to create a qualifier to be used to configure a class or method to be intercepted. In the following code block, we have a qualifier, called <kbd class="calibre18">Authentication</kbd>, with a parameter, called roles, and these are used to declare the roles that are permitted to access a resource:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.enterprise.util.<span class="calibre5">Nonbinding</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.interceptor.<span class="calibre5">InterceptorBinding</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.lang.annotation.*<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Inherited<br class="calibre2"/></span><span class="calibre5">@InterceptorBinding<br class="calibre2"/></span><span class="calibre5">@Retention</span>(RetentionPolicy.<span class="calibre5">RUNTIME</span>)<br class="calibre2"/><span class="calibre5">@Target</span>({ElementType.<span class="calibre5">METHOD</span><span class="calibre5">, </span>ElementType.<span class="calibre5">TYPE</span>})<br class="calibre2"/><span class="calibre5">public </span>@<span class="calibre5">interface </span><span class="calibre5">Authentication </span>{<br class="calibre2"/>    <span class="calibre5">@Nonbinding </span>String[] <span class="calibre5">roles</span>() <span class="calibre5">default </span>{}<span class="calibre5">;<br class="calibre2"/></span>}</pre>
<p class="mce-root">In the following code block, we have the <kbd class="calibre18">AuthenticationInteceptor</kbd> class, which is used as an interceptor. This class is annotated with the <kbd class="calibre18">@Authentication</kbd> annotation, indicating that this class will intercept all calls to methods annotated with <kbd class="calibre18">@Authentication</kbd> and will process the method annotated with <kbd class="calibre18">@AroundInvoke</kbd>:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.inject.<span class="calibre5">Inject</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.interceptor.<span class="calibre5">AroundInvoke</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.interceptor.<span class="calibre5">Interceptor</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.interceptor.InvocationContext<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServletRequest<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServletResponse<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.io.IOException<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.io.Serializable<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Arrays<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Authentication<br class="calibre2"/></span><span class="calibre5">@Interceptor<br class="calibre2"/></span><span class="calibre5">public class </span>AuthenticationInterceptor <span class="calibre5">implements </span>Serializable{<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Inject<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>Auth <span class="calibre5">auth</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@AroundInvoke<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Object <span class="calibre5">authentication</span>(InvocationContext context) <span class="calibre5">throws <br class="calibre2"/></span>    IOException {<br class="calibre2"/><br class="calibre2"/>      HttpServletRequest request = getHttpServletRequest( context )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">      </span>HttpServletResponse response = getHttpServletResponse( context )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">      </span>String[] credentials = AuthUtils.<span class="calibre5">readBasicAuthHeader</span>( request )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        if</span>(credentials.<span class="calibre5">length </span>&lt; <span class="calibre5">2</span>){<br class="calibre2"/>            prepareDialogBox( response )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            return null;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        String login = credentials[AuthUtils.<span class="calibre5">INDEX_LOGIN</span>]<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>String password = credentials[AuthUtils.<span class="calibre5">INDEX_PASSWORD</span>]<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">Authentication </span>authentication = <br class="calibre2"/>       context.getMethod().getAnnotation( <span class="calibre5">Authentication</span>.<span class="calibre5">class </span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        if</span>( !<span class="calibre5">auth</span>.isAuthenticated( login<span class="calibre5">, </span>password ) ){<br class="calibre2"/>            prepareDialogBox( response )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            return null;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">if </span>( Arrays.<span class="calibre5">stream</span>(authentication.roles()).noneMatch( role -&gt; <br class="calibre2"/><span class="calibre5">        auth</span>.isAuthorized( <span class="calibre5">login</span><span class="calibre5">, </span>role )) ){<br class="calibre2"/><br class="calibre2"/>            response.sendError(HttpServletResponse.<span class="calibre5">SC_UNAUTHORIZED</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            return null;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">try </span>{<br class="calibre2"/>            <span class="calibre5">return </span>context.proceed()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>} <span class="calibre5">catch </span>(Exception e) {<br class="calibre2"/>            e.printStackTrace()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            <br class="calibre2"/></span>      response.sendError(HttpServletResponse.<span class="calibre5">SC_INTERNAL_SERVER_ERROR</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return null;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public void </span><span class="calibre5">prepareDialogBox</span>( HttpServletResponse response ) <span class="calibre5">throws <br class="calibre2"/></span>    IOException {<br class="calibre2"/>        response.addHeader(<span class="calibre5">"WWW-Authenticate"</span><span class="calibre5">, </span><span class="calibre5">"Basic"</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>response.sendError(HttpServletResponse.<span class="calibre5">SC_UNAUTHORIZED</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>HttpServletRequest <span class="calibre5">getHttpServletRequest</span>(InvocationContext <br class="calibre2"/>    ic) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>(HttpServletRequest) Arrays<br class="calibre2"/>                .<span class="calibre5">stream</span>(ic.getParameters()).filter(p -&gt;  p <span class="calibre5">instanceof <br class="calibre2"/></span>                 HttpServletRequest )<br class="calibre2"/>                .findFirst()<br class="calibre2"/>                .get()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>HttpServletResponse <br class="calibre2"/><span class="calibre5">    getHttpServletResponse</span>(InvocationContext ic) {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>(HttpServletResponse) Arrays<br class="calibre2"/>                .<span class="calibre5">stream</span>(ic.getParameters()).filter(p -&gt;  p <span class="calibre5">instanceof <br class="calibre2"/></span>                 HttpServletResponse )<br class="calibre2"/>                .findFirst()<br class="calibre2"/>                .get()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">This snippet of the preceding code block shows how to configure a class to be the interceptor that captures all calls to methods annotated with <kbd class="calibre18">@Authentication</kbd>:</p>
<pre class="mce-root2"><span class="calibre5">@Authentication<br class="calibre2"/></span><span class="calibre5">@Interceptor<br class="calibre2"/></span><span class="calibre5">public class </span>AuthenticationInterceptor <span class="calibre5">implements </span>Serializable{<br class="calibre2"/>...<br class="calibre2"/>}</pre>
<p class="mce-root">Note that this interceptor expects <kbd class="calibre18">HttpServletRequest</kbd> and <kbd class="calibre18">HttpServletResponse</kbd> as parameters of the target method. This is done in order to allow for the validation of authentication and authorization. </p>
<p class="mce-root"/>
<p class="mce-root"/>
<p class="mce-root">In the following code block, we have a snippet of the interceptor. This configures a method to process when a call has been intercepted:</p>
<pre class="mce-root2"><span class="calibre5">    @AroundInvoke<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Object <span class="calibre5">authentication</span>(InvocationContext context) <span class="calibre5">throws </span>IOException {<br class="calibre2"/>        ...<br class="calibre2"/>    }</pre>
<p class="mce-root">In the preceding code block, we have the <kbd class="calibre18">Auth</kbd> interface:</p>
<pre class="mce-root2"><span class="calibre5">public interface </span>Auth {<br class="calibre2"/><br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>Boolean <span class="calibre5">isAuthorized</span>(String login<span class="calibre5">, </span>String role)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    public </span>Boolean <span class="calibre5">isAuthenticated</span>(String login<span class="calibre5">, </span>String password)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span>}</pre>
<p class="mce-root">In the preceding code block, we have the class that implements an <kbd class="calibre18">Auth</kbd> interface. In this class, we will consult information about the user from a data source. This class is an EJB:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.ejb.<span class="calibre5">Stateless</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.inject.<span class="calibre5">Inject</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Stateless<br class="calibre2"/></span><span class="calibre5">public class </span>AuthImpl <span class="calibre5">implements </span>Auth {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Inject<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">private </span>DataSource <span class="calibre5">dataSource</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@Override<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Boolean <span class="calibre5">isAuthorized</span>(String login<span class="calibre5">,</span>String role) {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">dataSource</span>.readUserRoles( login ).contains( role )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@Override<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public </span>Boolean <span class="calibre5">isAuthenticated</span>(String login<span class="calibre5">, </span>String password) {<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">dataSource</span>.readUserPassword( login ).contains( password )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>
<p class="mce-root">In the preceding code block, we have a <kbd class="calibre18">DataSource</kbd> class. This class has the logic to read information about users, and all information in this data source stays as maps. However, we can save this information in a relational database, non-relational database, filesystem, or LDAP. This class has the application scope and maintains all security data in memory for all the application life cycles:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.annotation.<span class="calibre5">PostConstruct</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.enterprise.context.<span class="calibre5">ApplicationScoped</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Arrays<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.HashMap<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.List<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Map<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@ApplicationScoped<br class="calibre2"/></span><span class="calibre5">public class </span>DataSource {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">private </span>Map&lt;String<span class="calibre5">, </span>List&lt;String&gt;&gt; <span class="calibre5">roles</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    private </span>Map&lt;String<span class="calibre5">, </span>String&gt; <span class="calibre5">passwords</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">@PostConstruct<br class="calibre2"/></span><span class="calibre5">    </span><span class="calibre5">public void </span><span class="calibre5">init</span>(){<br class="calibre2"/>        <span class="calibre5">roles </span>= <span class="calibre5">new </span>HashMap&lt;&gt;()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">roles</span>.put(<span class="calibre5">"rhuan"</span><span class="calibre5">, </span>Arrays.<span class="calibre5">asList</span>(<span class="calibre5">"user"</span><span class="calibre5">,</span><span class="calibre5">"admin"</span>))<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">roles</span>.put(<span class="calibre5">"joao"</span><span class="calibre5">, </span>Arrays.<span class="calibre5">asList</span>(<span class="calibre5">"user"</span><span class="calibre5">,</span><span class="calibre5">"admin"</span>))<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">passwords </span>= <span class="calibre5">new </span>HashMap&lt;&gt;()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">passwords</span>.put(<span class="calibre5">"rhuan"</span><span class="calibre5">, </span><span class="calibre5">"123456"</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span><span class="calibre5">passwords</span>.put(<span class="calibre5">"joao"</span><span class="calibre5">, </span><span class="calibre5">"123456"</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>List&lt;String&gt; <span class="calibre5">readUserRoles</span>(String login){<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">roles</span>.get( login )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public </span>String <span class="calibre5">readUserPassword</span>(String login){<br class="calibre2"/>        <span class="calibre5">return </span><span class="calibre5">passwords</span>.get( login )<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>
<p class="mce-root">In the following code block, we have <kbd class="calibre18">AuthUtils</kbd>. This is an authentication utility class. This class uses the <kbd class="calibre18">readBasicHeader</kbd> method, which receives <kbd class="calibre18">HttpServletRequest</kbd> as a parameter and extracts a username and password if the request uses basic authorization:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.servlet.http.HttpServletRequest<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.nio.charset.Charset<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>java.util.Base64<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">public class </span>AuthUtils {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">public static final int </span><span class="calibre5">INDEX_LOGIN </span>= <span class="calibre5">0</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    public static final int </span><span class="calibre5">INDEX_PASSWORD </span>= <span class="calibre5">1</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    public static </span>String[] <span class="calibre5">readBasicAuthHeader</span>( HttpServletRequest request ){<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">final </span>String authorization = request.getHeader(<span class="calibre5">"Authorization"</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">        if </span>(authorization != <span class="calibre5">null </span>&amp;&amp; authorization.startsWith(<span class="calibre5">"Basic"</span>)) {<br class="calibre2"/><br class="calibre2"/>            String base64Credentials = authorization.substring(<span class="calibre5">"Basic"</span>.length()).trim()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">            </span>String credentials =<br class="calibre2"/>                    <span class="calibre5">new </span>String(<br class="calibre2"/>                            Base64.<span class="calibre5">getDecoder</span>().decode(<br class="calibre2"/>                                    base64Credentials)<span class="calibre5">,<br class="calibre2"/></span><span class="calibre5">                            </span>Charset.<span class="calibre5">forName</span>(<span class="calibre5">"UTF-8"</span>))<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">            return </span>credentials.split(<span class="calibre5">":"</span><span class="calibre5">, </span><span class="calibre5">2</span>)<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">        </span>}<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return new </span>String[<span class="calibre5">0</span>]<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/>}</pre>
<p class="mce-root">In the following code block, we have <kbd class="calibre18">beans.xml</kbd>, which contains an <kbd class="calibre18">&lt;interceptors&gt;</kbd> <span class="calibre10">tag</span><span class="calibre10"> </span><span class="calibre10">with a declaration of all CDI interceptors. Its configuration is needed for the CDI interceptor to work:</span></p>
<pre class="mce-root2"><span class="calibre5">&lt;?</span><span class="calibre5">xml version</span><span class="calibre5">="1.0" </span><span class="calibre5">encoding</span><span class="calibre5">="UTF-8"</span><span class="calibre5">?&gt;<br class="calibre2"/></span><span class="calibre5">&lt;beans </span><span class="calibre5">xmlns</span><span class="calibre5">="http://xmlns.jcp.org/xml/ns/javaee"<br class="calibre2"/></span><span class="calibre5">       </span><span class="calibre5">xmlns:</span><span class="calibre5">xsi</span><span class="calibre5">="http://www.w3.org/2001/XMLSchema-instance"<br class="calibre2"/></span><span class="calibre5">       </span><span class="calibre5">xsi</span><span class="calibre5">:schemaLocation</span><span class="calibre5">="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/beans_1_1.xsd"<br class="calibre2"/></span><span class="calibre5">       </span><span class="calibre5">bean-discovery-mode</span><span class="calibre5">="all"</span><span class="calibre5">&gt;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    &lt;interceptors&gt;<br class="calibre2"/></span><span class="calibre5">        &lt;class&gt;</span>com.packt.rhuan.interceptors.AuthenticationInterceptor<span class="calibre5">&lt;/class&gt;<br class="calibre2"/></span><span class="calibre5">    &lt;/interceptors&gt;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">&lt;/beans&gt;<br class="calibre2"/></span></pre>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Implementing the JAX-RS resource</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In the following code snippet, we have a JAX-RS resource class, called <kbd class="calibre18">HelloWorld</kbd>. This class receives a request and returns a message to the client. <span class="calibre10">B</span>efore the execution of the resource logic, <kbd class="calibre18">AuthenticationInterceptor</kbd> intercepts a call to a method and processes the authentication logic:</p>
<pre class="mce-root2"><span class="calibre5">import </span>javax.servlet.http.HttpServletRequest<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.servlet.http.HttpServletResponse<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.<span class="calibre5">GET</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.<span class="calibre5">Path</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.<span class="calibre5">Context</span><span class="calibre5">;<br class="calibre2"/></span><span class="calibre5">import </span>javax.ws.rs.core.Response<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">@Path</span>(<span class="calibre5">"helloworld"</span>)<br class="calibre2"/><span class="calibre5">public class </span>HelloWorld {<br class="calibre2"/><br class="calibre2"/>    <span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    @Authentication</span>(<span class="calibre5">roles </span>= {<span class="calibre5">"user"</span>})<br class="calibre2"/>    <span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>(<span class="calibre5">@Context </span>HttpServletRequest request<span class="calibre5">, <br class="calibre2"/></span><span class="calibre5">    @Context </span>HttpServletResponse response)  {<br class="calibre2"/><br class="calibre2"/>        <span class="calibre5">return </span>Response<br class="calibre2"/>       .<span class="calibre5">ok</span>(<span class="calibre5">"Hello World. Welcome to App with validation by <br class="calibre2"/>       authentication interceptor!"</span>)<br class="calibre2"/>                .build()<span class="calibre5">;<br class="calibre2"/></span><span class="calibre5"><br class="calibre2"/></span><span class="calibre5">    </span>}<br class="calibre2"/><br class="calibre2"/><br class="calibre2"/><br class="calibre2"/>}</pre>
<p class="mce-root">Note that the <kbd class="calibre18"><span class="calibre5">helloWorld(@Context HttpServletRequest request, @Context HttpServletResponse response)</span></kbd> <span class="calibre10">method </span><span class="calibre10">has the </span><kbd class="calibre18">@Authentication(roles={"user})</kbd><span class="calibre10"> </span><span class="calibre10">annotation,</span><span class="calibre10"> </span><span class="calibre10">along with the</span> <kbd class="calibre18">HttpServletRequest</kbd> <span class="calibre10">and</span> <kbd class="calibre18">HttpServletResponse</kbd> <span class="calibre10">parameters</span><span class="calibre10">. With </span><span class="calibre10"><kbd class="calibre18">@Authentication(roles={"user})</kbd>, we configured the <kbd class="calibre18">helloWorld(@Context HttpServletRequest request, @Context HttpServletResponse response)</kbd> </span><span class="calibre10">method to </span><span class="calibre10">be intercepted by</span> <kbd class="calibre18">AuthenticationInterceptor</kbd><span class="calibre10">. As previously mentioned, the target method must have</span> <kbd class="calibre18">HttpServletRequest</kbd> <span class="calibre10">and</span> <kbd class="calibre18">HttpServletResponse</kbd> <span class="calibre10">as parameters:</span></p>
<pre class="mce-root2">    <span class="calibre5">@GET<br class="calibre2"/></span><span class="calibre5">    @Authentication</span>(<span class="calibre5">roles </span>= {<span class="calibre5">"user"</span>})</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<pre class="mce-root2">    <span class="calibre5">public </span>Response <span class="calibre5">helloWorld</span>(<span class="calibre5">@Context </span>HttpServletRequest request<span class="calibre5">, </span><span class="calibre5">@Context </span>HttpServletResponse response)  {<br class="calibre2"/>        ...<br class="calibre2"/>   }</pre>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">In this chapter, we covered security patterns as well as how to implement a security application using Java EE and its best practices. We also looked at single-sign-on (SSO), authentication mechanisms, and an authentication interceptor. Further, we demonstrated how to implement each of these using Java EE 8.</p>
<p class="mce-root">On the topic of a single-sign-on, we implement SSO using JAX-RS and create a service to deal with all authentication and authorization logic. As discussed, implementing a single-sign-on is generally done by a third-party application, such as Red Hat <span class="calibre10">single-</span>sign-on (RH-SSO) or Oracle Enterprise single-sign-on, but we can also create our own solution.</p>
<p class="mce-root">We learned about authentication mechanisms and how to use this HTTP <span class="calibre10">tool</span><span class="calibre10"> </span><span class="calibre10">with Java EE 8. Using Java EE 8, we implemented a basic mechanism, and saved user information on an application server at the realm. Further, we demonstrated how to implement authentication mechanisms in a servlet and REST resource.</span></p>
<p class="mce-root">We implemented an authentication interceptor using a CDI interceptor and configured it to intercept a JAX-RS resource. The JAX-RS resource authentication interceptor tends to be a better solution, but we can use this solution in a servlet or in an EJB class.</p>
<p class="mce-root">In the next chapter, we will explore deployment patterns, why these are important for the success of a project, what blue/green deployment is, why it is important to use blue/green deployment, <span class="calibre10">what continuous deployment is, and why we should use continuous deployment.</span></p>


            </article>

            
        </section>
    </div>



  </body></html>