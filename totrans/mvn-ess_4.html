<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Maven Plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Maven Plugins</h1></div></div></div><p>The roots of Maven go back to the <span class="emphasis"><em>Jakarta Turbine</em></span> project, which was started as an attempt to simplify the build process of Jakarta Turbine. The beauty of Maven is its design. It does not try to do everything by itself, but rather delegates to a plugin framework. When you download Maven from its website, it's only the core framework, and the plugins are downloaded on demand. All the useful functionalities in the build process are developed as Maven plugins. You can also call Maven a plugin execution framework. The following figure shows the Maven plugins:</p><div class="mediaobject"><img src="graphics/B02157_04_01.jpg" alt="Maven Plugins"/></div><p>A Maven plugin can be executed on its own or can be executed as a part of a Maven lifecycle. We will discuss Maven lifecycles in <a class="link" href="ch05.html" title="Chapter 5. Build Lifecycles">Chapter 5</a>, <span class="emphasis"><em>Build Lifecycles</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note22"/>Note</h3><p>A Maven build lifecycle consists of a set of well-defined phases. Each phase groups a set of goals defined by Maven plugins and the lifecycle defines the order of execution. Maven comes with three standard lifecycles: <span class="strong"><strong>default</strong></span>, <span class="strong"><strong>clean</strong></span>, and <span class="strong"><strong>site</strong></span>. Each lifecycle defines its own set of phases.</p></div></div><p>Each plugin has its own set of goals, and each goal is responsible for performing a specific action. Let's see how to execute the <code class="literal">clean</code> goal of the Maven <code class="literal">clean</code> plugin. The <code class="literal">clean</code> goal will attempt to clean the working directory and the associated files created during the build:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean:clean</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>Maven plugins can be self-executed as <code class="literal">mvn plugin-prefix-name:goal-name</code>.</p></div></div><p>The same <code class="literal">clean</code> plugin can be executed via the <code class="literal">clean</code> lifecycle, as shown in the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean</strong></span>
</pre></div><p>The clean goal of the Maven <code class="literal">clean</code> plugin is associated with the <code class="literal">clean</code> phase of the clean lifecycle. The clean lifecycle defines three phases: <code class="literal">pre-clean</code>, <code class="literal">clean</code>, and <code class="literal">post-clean</code>. A phase in a lifecycle is just an ordered placeholder in the build execution path. For example, the <code class="literal">clean</code> phase in the <code class="literal">clean</code> lifecycle cannot do anything on its own. In the Maven architecture, it has two key elements: nouns and verbs. Both nouns and verbs, which are related to a given project, are defined in the POM file. The name of the project, the name of the parent project, the dependencies, and the type of packaging are nouns. Plugins bring verbs into the Maven build system, and they define what needs to be done during the build execution via its goals. A plugin is a group of goals. Each goal of a plugin can be executed on its own or can be registered as part of a phase in a Maven build lifecycle. One difference here is that when you execute a Maven plugin on its own, it only runs the goal specified in the command; however, when you run it as a part of a lifecycle, then Maven executes all the plugin goals associated with the corresponding lifecycle up until the specified phase (including that phase).</p><p>When you type <code class="literal">mvn clean</code>, it executes all the phases defined in the <code class="literal">clean</code> lifecycle up to and including the <code class="literal">clean</code> phase. Don't be confused; in this command, <code class="literal">clean</code> is not the name of the lifecycle, it's the name of a phase. It's only a coincidence that the name of the phase happens to be the name of the lifecycle. In Maven, you cannot simply execute a lifecycle by its name—it has to be the name of a phase. Maven will find the corresponding lifecycle and will execute all phases in it up to the given phase (including that phase).</p><p>In this chapter, we will be talking about the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Commonly used Maven plugins and their usage</li><li class="listitem" style="list-style-type: disc">Plugin discovery and execution process</li></ul></div><div class="section" title="Common Maven plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Common Maven plugins</h1></div></div></div><p>Maven plugins<a id="id169" class="indexterm"/> are mostly developed under the Apache Maven project itself, as well as under the Codehaus and Google Code projects. The following sections list out a set of commonly used Maven plugins and their usages.</p><div class="section" title="The clean plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec25"/>The clean plugin</h2></div></div></div><p>As discussed<a id="id170" class="indexterm"/> earlier, the <code class="literal">clean</code> plugin executes the <code class="literal">clean</code> goal of the <a id="id171" class="indexterm"/>Maven <code class="literal">clean</code> plugin to remove any of the working directories and other resources created during the build, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean:clean</strong></span>
</pre></div><p>The Maven <code class="literal">clean</code> plugin is also associated with the <code class="literal">clean</code> lifecycle. If you just execute <code class="literal">mvn clean</code>, the <code class="literal">clean</code> goal of the <code class="literal">clean</code> plugin will get executed.</p><p>You do not need to explicitly define the Maven <code class="literal">clean</code> plugin in your project POM file. Your project inherits it from the Maven super POM file. In <a class="link" href="ch02.html" title="Chapter 2. Understanding the Project Object Model (POM)">Chapter 2</a>, <span class="emphasis"><em>Understanding the Project Object Model (POM)</em></span>, we discussed the Maven super POM file in detail. The following configuration in the super POM file associates the Maven <code class="literal">clean</code> plugin with all the Maven projects:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;<span class="strong"><strong>maven-clean-plugin</strong></span>&lt;/artifactId&gt;
  &lt;version&gt;2.5&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-clean&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>clean</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>clean</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note24"/>Note</h3><p>The Maven <code class="literal">default</code> lifecycle includes the phases: validate, initialize, generate-sources, process-sources, generateresources, process-resources, compile, process-classes, generate-test-sources, process-test-sources, generate-testresources, process-test-resources, test-compile, process-testclasses, test, prepare-package, package, pre-integration-test, integration-test, post-integration-test, verify, install, deploy.</p></div></div><p>By default, the <code class="literal">clean</code> goal of the <code class="literal">clean</code> plugin runs under the <code class="literal">clean</code> phase of the Maven <code class="literal">clean</code> life<a id="id172" class="indexterm"/>cycle. If your project wants the <code class="literal">clean</code> plugin to run by<a id="id173" class="indexterm"/> default, then you can associate it with the <code class="literal">initialize</code> phase of the Maven <code class="literal">default</code> lifecycle. You can add the following configuration to your application POM file:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  [...]
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-clean-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.5&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;auto-clean&lt;/id&gt;
            &lt;phase&gt;initialize&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;clean&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
  [...]
&lt;/project&gt;</pre></div><p>Now, the <code class="literal">clean</code> goal of the <code class="literal">clean</code> plugin will get executed when you execute any of the phases in the Maven <code class="literal">default</code> lifecycle; there is no need to explicitly execute the <code class="literal">clean</code> phase of the <code class="literal">clean</code> lifecycle. For example, <code class="literal">mvn install</code> will run the <code class="literal">clean</code> goal in its <code class="literal">initialize</code> phase. This way, you can override the default behavior of the Maven <code class="literal">clean</code> plugin. A complete Maven sample project with the previous plugin configuration is available <a id="id174" class="indexterm"/>at <a class="ulink" href="https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter04/jose">https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter04/jose</a>.</p></div><div class="section" title="The compiler plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec26"/>The compiler plugin</h2></div></div></div><p>The <code class="literal">compiler</code> plugin is <a id="id175" class="indexterm"/>used to compile the source code. This has<a id="id176" class="indexterm"/> two goals: <code class="literal">compile</code> and <code class="literal">testCompile</code>. The <code class="literal">compile</code> goal is bound to the <code class="literal">compile</code> phase of the Maven <code class="literal">default</code> lifecycle. When you type <code class="literal">mvn clean install</code>, Maven will execute all the phases in the <code class="literal">default</code> lifecycle up to the <code class="literal">install</code> phase, which also includes the <code class="literal">compile</code> phase. This, in turn, will run the <code class="literal">compile</code> goal of the <code class="literal">compiler</code> plugin.</p><p>The following command shows how to execute the <code class="literal">compile</code> goal of the <code class="literal">compiler</code> plugin by itself. This will simply compile your source code:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn compiler:compile</strong></span>
</pre></div><p>All the Maven projects inherit the <code class="literal">compiler</code> plugin from the super POM file. As shown in the following configuration, the super POM defines the <code class="literal">compiler</code> plugin. It associates the <code class="literal">testCompile</code> and <code class="literal">compile</code> goals with the <code class="literal">test-compile</code> and <code class="literal">compile</code> phases of the Maven <code class="literal">default</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;<span class="strong"><strong>maven-compiler-plugin</strong></span>&lt;/artifactId&gt;
  &lt;version&gt;3.1&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-testCompile&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>test-compile</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>testCompile</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
    &lt;execution&gt;
      &lt;id&gt;default-compile&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>compile</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>compile</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>By default, the Maven <code class="literal">compiler</code> plugin assumes JDK 1.5 for both the <code class="literal">source</code> and <code class="literal">target</code> elements. JVM identifies the Java version of the source code via the <code class="literal">source</code> configuration<a id="id177" class="indexterm"/> parameter and the version of the compiled code via<a id="id178" class="indexterm"/> the <code class="literal">target</code> configuration parameter. If you want to break the assumption made by Maven and specify your own <code class="literal">source</code> and <code class="literal">target</code> versions, you need to override the <code class="literal">compiler</code> plugin configuration in your application POM file, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  [...]
  &lt;build&gt;
    [...]
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          <span class="strong"><strong>&lt;source&gt;1.7&lt;/source&gt;</strong></span>
          <span class="strong"><strong>&lt;target&gt;1.7&lt;/target&gt;</strong></span>
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
    [...]
  &lt;/build&gt;
  [...]
&lt;/project&gt;</pre></div><p>You can pass any argument to the <code class="literal">compiler</code> plugin under the <code class="literal">compilerArgument</code> element, not just the source and target elements. This is more useful when the Maven <code class="literal">compiler</code> plugin does not have an element defined for the corresponding JVM argument. For example, the same <code class="literal">source</code> and <code class="literal">target</code> values can also be passed in the following manner:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  [...]
  &lt;build&gt;
    [...]
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
        &lt;version&gt;3.1&lt;/version&gt;
        &lt;configuration&gt;
          <span class="strong"><strong>&lt;compilerArgument&gt;-source 1.7 –target 1.7&lt;/compilerArgument&gt;</strong></span>
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
    [...]
  &lt;/build&gt;
  [...]
&lt;/project&gt;</pre></div></div><div class="section" title="The install plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec27"/>The install plugin</h2></div></div></div><p>The <code class="literal">install</code> plugin <a id="id179" class="indexterm"/>will deploy the final project artifacts into the <code class="literal">local</code> Maven<a id="id180" class="indexterm"/> repository defined under the <code class="literal">localRepository</code> element of <code class="literal">MAVEN_HOME/conf/settings.xml</code>, where the default location is <code class="literal">USER_HOME/.m2/repository</code>. The <code class="literal">install</code> goal of the <code class="literal">install</code> plugin is bound to the <code class="literal">install</code> phase of the Maven <code class="literal">default</code> lifecycle. When you type <code class="literal">mvn clean install</code>, Maven will execute all the phases in the <code class="literal">default</code> lifecycle up to and including the <code class="literal">install</code> phase.</p><p>The following command shows how to execute the <code class="literal">install</code> goal of the <code class="literal">install</code> plugin by itself:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn install:install</strong></span>
</pre></div><p>All the Maven projects inherit the <code class="literal">install</code> plugin from the super POM file. As shown in the following configuration, the super POM defines the <code class="literal">install</code> plugin. It associates the <code class="literal">install</code> goal with the <code class="literal">install</code> phase of the Maven <code class="literal">default</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
      &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.4&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;default-install&lt;/id&gt;
          &lt;phase&gt;<span class="strong"><strong>install</strong></span>&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;<span class="strong"><strong>install</strong></span>&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;</pre></div><p>The <code class="literal">install</code> goal <a id="id181" class="indexterm"/>of the <code class="literal">install</code> plugin does not have any<a id="id182" class="indexterm"/> configurations to be overridden at the project level.</p></div><div class="section" title="The deploy plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec28"/>The deploy plugin</h2></div></div></div><p>The <code class="literal">deploy</code> plugin <a id="id183" class="indexterm"/>will deploy the final project artifacts into a <a id="id184" class="indexterm"/>remote Maven repository. The <code class="literal">deploy</code> goal of the <code class="literal">deploy</code> plugin is associated with the <code class="literal">deploy</code> phase of the <code class="literal">default</code> Maven lifecycle. To deploy an artifact via the <code class="literal">default</code> lifecycle, <code class="literal">mvn clean install</code> is not sufficient. It has to be <code class="literal">mvn clean deploy</code>. Any guesses why?</p><p>The <code class="literal">deploy</code> phase of the <code class="literal">default</code> Maven lifecycle comes after the <code class="literal">install</code> phase. Executing <code class="literal">mvn clean deploy</code> will execute all the phases of the <code class="literal">default</code> Maven lifecycle up to and including the <code class="literal">deploy</code> phase, which also includes the <code class="literal">install</code> phase. The following command shows how to execute the <code class="literal">deploy</code> goal of the <code class="literal">deploy</code> plugin by itself:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn deploy:deploy</strong></span>
</pre></div><p>All the Maven projects inherit the <code class="literal">deploy</code> plugin from the super POM file. As shown in the following configuration, super POM defines the <code class="literal">deploy</code> plugin. It associates the <code class="literal">deploy</code> goal with the <code class="literal">deploy</code> phase of the Maven <code class="literal">default</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">   &lt;plugin&gt;
     &lt;artifactId&gt;maven-deploy-plugin&lt;/artifactId&gt;
     &lt;version&gt;2.7&lt;/version&gt;
     &lt;executions&gt;
       &lt;execution&gt;
         &lt;id&gt;default-deploy&lt;/id&gt;
         &lt;phase&gt;<span class="strong"><strong>deploy</strong></span>&lt;/phase&gt;
         &lt;goals&gt;
           &lt;goal&gt;<span class="strong"><strong>deploy</strong></span>&lt;/goal&gt;
         &lt;/goals&gt;
       &lt;/execution&gt;
     &lt;/executions&gt;
   &lt;/plugin&gt;</pre></div><p>Before executing either <code class="literal">mvn deploy:deploy</code> or <code class="literal">mvn deploy</code>, you need to set up the remote Maven repository details in your project POM file, under the <code class="literal">distributionManagement</code> section, as follows:</p><div class="informalexample"><pre class="programlisting">[...]
  &lt;distributionManagement&gt;
    &lt;repository&gt;
      &lt;id&gt;wso2-maven2-repository&lt;/id&gt;
      &lt;name&gt;WSO2 Maven2 Repository&lt;/name&gt;
      &lt;url&gt;<span class="strong"><strong>scp://dist.wso2.org/home/httpd/dist.wso2.org/maven2/</strong></span>&lt;/url&gt;
    &lt;/repository&gt;
  &lt;/distributionManagement&gt;
[...]</pre></div><p>In this <a id="id185" class="indexterm"/>example, Maven connects to the remote repository <a id="id186" class="indexterm"/>via <code class="literal">scp</code>. <span class="strong"><strong>Secure Copy</strong></span> (<span class="strong"><strong>scp</strong></span>) defines a way of securely transferring files between<a id="id187" class="indexterm"/> two nodes in a computer network, which is built on top of popular SSH. To authenticate to the remote server, Maven provides two ways; one is based on a username and password, and the other one is based on SSH authentication keys. To configure username/password credentials against the Maven repository, we need to add the following <code class="literal">&lt;server&gt;</code> configuration element to <code class="literal">USER_HOME/.m2/settings.xml</code>. The value of the <code class="literal">id</code> element must carry the value of the remote repository hostname:</p><div class="informalexample"><pre class="programlisting">&lt;server&gt;
  &lt;id&gt;dist.wso2.org&lt;/id&gt;
  <span class="strong"><strong>&lt;username&gt;my_username&lt;/username&gt;       </strong></span>
<span class="strong"><strong>  &lt;password&gt;my_password&lt;/password&gt;</strong></span>
&lt;/server&gt;</pre></div><p>If the remote repository only supports SSH authentication keys, then we need to specify the location of the private key, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;server&gt;
  &lt;id&gt;dist.wso2.org&lt;/id&gt;
  &lt;username&gt;my_username&lt;/username&gt;       
  &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;
&lt;/server&gt;</pre></div><p>The <code class="literal">deploy</code> goal of the <code class="literal">deploy</code> plugin does not have any configurations to be overridden at the project level.</p></div><div class="section" title="The surefire plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec29"/>The surefire plugin</h2></div></div></div><p>The <code class="literal">surefire</code> plugin<a id="id188" class="indexterm"/> will run the unit tests associated with<a id="id189" class="indexterm"/> the project. The <code class="literal">test</code> goal of the <code class="literal">surefire</code> plugin is bound to the <code class="literal">test</code> phase of the <code class="literal">default</code> Maven lifecycle. When you type <code class="literal">mvn clean install</code>, Maven will execute all the phases in the <code class="literal">default</code> lifecycle up to and including the <code class="literal">install</code> phase, which also includes the <code class="literal">test</code> phase.</p><p>The following command shows how to execute the <code class="literal">test</code> goal of the <code class="literal">surefire</code> plugin:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn surefire:test</strong></span>
</pre></div><p>All the Maven <a id="id190" class="indexterm"/>projects inherit the <code class="literal">surefire</code> plugin from the <a id="id191" class="indexterm"/>super POM file. As shown in the following configuration, the super POM defines the <code class="literal">surefire</code> plugin. It associates the <code class="literal">test</code> goal with the <code class="literal">test</code> phase of the Maven <code class="literal">default</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;<span class="strong"><strong>maven-surefire-plugin</strong></span>&lt;/artifactId&gt;
  &lt;version&gt;2.12.4&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-test&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>test</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>test</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>Since the <code class="literal">surefire</code> plugin is defined in the super POM file, you do not need to add it explicitly to your application POM file. However, you need to add a dependency to <code class="literal">junit</code>, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  [...]
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;4.8.1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  [...]
&lt;/dependencies&gt;</pre></div><p>The <code class="literal">surefire</code> plugin is not just coupled to JUnit, it can be used with other testing frameworks as well. If you are using TestNG, then you need to add a dependency to <code class="literal">testng</code>, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  [...]
    &lt;dependency&gt;
      &lt;groupId&gt;org.testng&lt;/groupId&gt;
      &lt;artifactId&gt;testng&lt;/artifactId&gt;
      &lt;version&gt;6.3.1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
  [...]
&lt;/dependencies&gt;</pre></div><p>The <code class="literal">surefire</code> plugin<a id="id192" class="indexterm"/> introduces a concept called test providers. You <a id="id193" class="indexterm"/>can specify a test provider within the plugin itself; if not, it will be derived from the dependency JAR file. For example, if you want to use the <code class="literal">junit47</code> provider, then within the plugin configuration, you can specify it as shown here. The <code class="literal">surefire</code> plugin supports, by default, four test providers: <code class="literal">surefire-junit3</code>, <code class="literal">surefire-junit4</code>, <code class="literal">surefire-junit47</code>, and <code class="literal">surefire-testng</code>:</p><div class="informalexample"><pre class="programlisting">&lt;plugins&gt;
[...]
  &lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.17&lt;/version&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.apache.maven.surefire&lt;/groupId&gt;
        &lt;artifactId&gt;<code class="literal">surefire-junit47</code>&lt;/artifactId&gt;
        &lt;version&gt;2.17&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/plugin&gt;
[...]
&lt;/plugins&gt;</pre></div><p>Since all the Maven projects inherit the <code class="literal">surefire</code> plugin from the super POM file, you do not need to override its configuration in the application POM file unless it's an absolute necessity. One of the reasons to override the parent configuration is to override the default test provider selection algorithm.</p></div><div class="section" title="The site plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec30"/>The site plugin</h2></div></div></div><p>The <code class="literal">site</code> plugin<a id="id194" class="indexterm"/> generates static HTML web content for a Maven project, including the reports configured in the project. This defines eight goals, where each goal <a id="id195" class="indexterm"/>runs in one of the four phases defined in the Maven <code class="literal">site</code> lifecycle: <code class="literal">pre-site</code>, <code class="literal">site</code>, <code class="literal">post-site</code>, and <code class="literal">site-deploy</code>, which can be described as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">site:site</code>: This goal generates a site for a single Maven project</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:deploy</code>: This goal deploys the generated site via a Wagon supported protocol to the site URL specified in the <code class="literal">&lt;distributionManagement&gt;</code> section of the POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:run</code>: This goal opens the site with the Jetty web server</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:stage</code>: This goal generates a site in a local staging or mock directory based on the site URL specified in the <code class="literal">&lt;distributionManagement&gt;</code> section of the POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:stage-deploy</code>: This goal deploys the generated site to a staging or mock directory to the site URL specified in the <code class="literal">&lt;distributionManagement&gt;</code> section of the POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:attach-descriptor</code>: This goal adds the site descriptor (<code class="literal">site.xml</code>) to the list of files to be installed/deployed</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:jar</code>: This goal bundles the site output into a JAR file so that it can be deployed to a repository</li><li class="listitem" style="list-style-type: disc"><code class="literal">site:effective-site</code>: This goal calculates the effective site descriptor after inheritance and interpolation of <code class="literal">site.xml</code></li></ul></div><p>All the Maven projects inherit the <code class="literal">site</code> plugin from the super POM file. As shown in the following configuration, the super POM defines the <code class="literal">site</code> plugin. It associates the <code class="literal">site</code> and <code class="literal">deploy</code> goals with the <code class="literal">site</code> and <code class="literal">site-deploy</code> phases of the Maven <code class="literal">default</code> lifecycle:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;
  &lt;version&gt;3.3&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-site&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>site</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>site</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;outputDirectory&gt;
          PROJECT_HOME/target/site&lt;/outputDirectory&gt;
        &lt;reportPlugins&gt;
          &lt;reportPlugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;
                maven-project-info-reports-plugin
            &lt;/artifactId&gt;
          &lt;/reportPlugin&gt;
        &lt;/reportPlugins&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
    &lt;execution&gt;
      &lt;id&gt;default-deploy&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>site-deploy</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>deploy</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;outputDirectory&gt;
          PROJECT_HOME/target/site&lt;/outputDirectory&gt;
        &lt;reportPlugins&gt;
          &lt;reportPlugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;
              maven-project-info-reports-plugin
           &lt;/artifactId&gt;
          &lt;/reportPlugin&gt;
        &lt;/reportPlugins&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
  &lt;configuration&gt;
    &lt;outputDirectory&gt;
      PROJECT_HOME/target/site&lt;/outputDirectory&gt;
    &lt;reportPlugins&gt;
      &lt;reportPlugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;
          maven-project-info-reports-plugin
        &lt;/artifactId&gt;
      &lt;/reportPlugin&gt;
    &lt;/reportPlugins&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div><p>As defined in the<a id="id196" class="indexterm"/> previous configuration, when you run <code class="literal">mvn site</code> or <code class="literal">mvn site:site</code>, the resultant HTML web content will be created inside the <code class="literal">target/site</code> directory under the project home. The <code class="literal">site</code> goal of the <code class="literal">site</code> plugin only <a id="id197" class="indexterm"/>generates the HTML web content; to deploy it, you need to use the <code class="literal">deploy</code> goal. To deploy <code class="literal">site</code> to a remote application server, you need to specify the remote machine details under the <code class="literal">distributionManagement</code> section of your application POM file, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  ...
  &lt;distributionManagement&gt;
    &lt;site&gt;
      &lt;id&gt;mycompany.com&lt;/id&gt;
      &lt;url&gt;scp://mycompany/www/docs/project/&lt;/url&gt;
    &lt;/site&gt;
  &lt;/distributionManagement&gt;
  ...
&lt;/project&gt;</pre></div><p>To configure credentials to connect to the remote computer, you need to add the following <code class="literal">&lt;server&gt;</code> configuration element under the <code class="literal">&lt;servers&gt;</code> parent element of <code class="literal">USER_HOME/.m2/settings.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server&gt;
  &lt;id&gt;mycompany.com&lt;/id&gt;
  <span class="strong"><strong>&lt;username&gt;my_username&lt;/username&gt;       </strong></span>
<span class="strong"><strong>  &lt;password&gt;my_password&lt;/password&gt;</strong></span>
&lt;/server&gt;</pre></div><p>The generated site or the web content can be deployed to the remote location by executing the <code class="literal">deploy</code> goal of the Maven <code class="literal">site</code> plugin, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn site:deploy</strong></span>
</pre></div><p>In most of the cases, you do not need to override the <code class="literal">site</code> plugin configuration.</p></div><div class="section" title="The jar plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec31"/>The jar plugin</h2></div></div></div><p>The <code class="literal">jar</code> plugin <a id="id198" class="indexterm"/>creates a JAR file from your Maven project. The <code class="literal">jar</code> goal <a id="id199" class="indexterm"/>of the <code class="literal">jar</code> plugin is bound to the <code class="literal">package</code> phase of the Maven <code class="literal">default</code> lifecycle. When you type <code class="literal">mvn clean install</code>, Maven will execute all the phases in the <code class="literal">default</code> lifecycle up to and including the <code class="literal">install</code> phase, which also includes the <code class="literal">package</code> phase.</p><p>The following command shows how to execute the <code class="literal">jar</code> goal of the <code class="literal">jar</code> plugin:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn jar:jar</strong></span>
</pre></div><p>All the Maven projects inherit the <code class="literal">jar</code> plugin from the super POM file. As shown in the following configuration, the super POM defines the <code class="literal">jar</code> plugin. It associates the <code class="literal">jar</code> goal with the <code class="literal">package</code> phase of the Maven <code class="literal">default</code> lifecycle.</p><div class="informalexample"><pre class="programlisting"> &lt;plugin&gt;
   &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
   &lt;version&gt;2.4&lt;/version&gt;
   &lt;executions&gt;
     &lt;execution&gt;
       &lt;id&gt;default-jar&lt;/id&gt;
       &lt;phase&gt;<span class="strong"><strong>package</strong></span>&lt;/phase&gt;
       &lt;goals&gt;
         &lt;goal&gt;<span class="strong"><strong>jar</strong></span>&lt;/goal&gt;
       &lt;/goals&gt;
     &lt;/execution&gt;
   &lt;/executions&gt;
 &lt;/plugin&gt;</pre></div><p>In most of the cases, you do not need to override the <code class="literal">jar</code> plugin configuration, except in a case where you need to create a self-executable JAR file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note25"/>Note</h3><p>Creating a<a id="id200" class="indexterm"/> self-executable JAR file with <code class="literal">maven-jar-plugin</code> can be found at <a class="ulink" href="http://maven.apache.org/shared/maven-archiver/examples/classpath.html">http://maven.apache.org/shared/maven-archiver/examples/classpath.html</a>.</p></div></div></div><div class="section" title="The source plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec32"/>The source plugin</h2></div></div></div><p>The <code class="literal">source</code> plugin<a id="id201" class="indexterm"/> creates a JAR file with the project source <a id="id202" class="indexterm"/>code. It defines five goals: <code class="literal">aggregate</code>, <code class="literal">jar</code>, <code class="literal">test-jar</code>, <code class="literal">jar-no-fork</code>, and <code class="literal">test-jar-no-fork</code>. All these five goals of the <code class="literal">source</code> plugin run under the <code class="literal">package</code> phase of the <code class="literal">default</code> lifecycle.</p><p>Unlike any of the plugins we discussed earlier, if you want to execute the <code class="literal">source</code> plugin with the Maven <code class="literal">default</code> lifecycle, it has to be defined in the project POM file, as shown here. The <a id="id203" class="indexterm"/>super POM file does not define the <code class="literal">source</code> plugin; it has <a id="id204" class="indexterm"/>to be defined within your Maven project itself:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;   
...   
   &lt;build&gt;     
    &lt;plugins&gt;       
     &lt;plugin&gt;         
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;<span class="strong"><strong>maven-source-plugin</strong></span>&lt;/artifactId&gt;         
      &lt;version&gt;2.3&lt;/version&gt;         
      &lt;configuration&gt;            
       &lt;outputDirectory&gt;
          /absolute/path/to/the/output/directory
       &lt;/outputDirectory&gt;           
       &lt;finalName&gt;filename-of-generated-jar-file&lt;/finalName&gt; 
       &lt;attach&gt;false&lt;/attach&gt;         
      &lt;/configuration&gt;       
     &lt;/plugin&gt;
    &lt;/plugins&gt;   
   &lt;/build&gt;   
... 
&lt;/project&gt;</pre></div><p>What is the difference between the <code class="literal">jar</code> plugin and the <code class="literal">source</code> plugin? Both create JAR files; however, the <code class="literal">jar</code> plugin creates a JAR file from the binary artifact, while the <code class="literal">source</code> plugin creates a JAR file from the source code. Small-scale open source projects use this approach to distribute the corresponding source code along with the binary artifacts.</p></div><div class="section" title="The resources plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec33"/>The resources plugin</h2></div></div></div><p>The <code class="literal">resources</code> plugin <a id="id205" class="indexterm"/>copies the resources associated with the<a id="id206" class="indexterm"/> main project as well as the tests to the project output directory. The <code class="literal">resources</code> goal of the <code class="literal">resources</code> plugin copies the main resources into the main output directory, and it runs under the <code class="literal">process-resources</code> phase of the Maven <code class="literal">default</code> lifecycle. The <code class="literal">testResources</code> goal copies all the resources associated with the tests to the test output directory, and it runs under the <code class="literal">process-test-resources</code> phase of the Maven <code class="literal">default</code> lifecycle. The <code class="literal">copyResources</code> goal can be configured to copy any resource to the project output directory, and this is not bound to any of the phases in the Maven <code class="literal">default</code> lifecycle.</p><p>All the Maven <a id="id207" class="indexterm"/>projects inherit the <code class="literal">resources</code> plugin from the <a id="id208" class="indexterm"/>super POM file. As shown in the following configuration, super POM defines the <code class="literal">resources</code> plugin. It associates <code class="literal">resources</code> and <code class="literal">testResources</code> goals with the <code class="literal">process-resources</code> and <code class="literal">process-test-resources</code> phases of the Maven <code class="literal">default</code> lifecycle. When you type <code class="literal">mvn clean install</code>, Maven will execute all the phases in the <code class="literal">default</code> lifecycle up to and including the <code class="literal">install</code> phase, which also includes the <code class="literal">process-resources</code> and <code class="literal">process-test-resources</code> phases.</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.6&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default-resources&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>process-resources</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>resources</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
    &lt;execution&gt;
      &lt;id&gt;default-testResources&lt;/id&gt;
      &lt;phase&gt;<span class="strong"><strong>process-test-resources</strong></span>&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;<span class="strong"><strong>testResources</strong></span>&lt;/goal&gt;
      &lt;/goals&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>In most of the cases, you do not need to override the <code class="literal">resources</code> plugin configuration, unless you have a specific need to filter <code class="literal">resources</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note26"/>Note</h3><p>More details about <a id="id209" class="indexterm"/>resource filtering with <code class="literal">maven-resources-plugin</code> can be found at <a class="ulink" href="http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html</a>.</p></div></div></div><div class="section" title="The release plugin"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec34"/>The release plugin</h2></div></div></div><p>Releasing a <a id="id210" class="indexterm"/>project requires a lot of repetitive tasks. The objective of the Maven <code class="literal">release</code> plugin is to automate them. The <code class="literal">release</code> plugin defines<a id="id211" class="indexterm"/> the following eight goals, which are executed in two stages: preparing the release and performing the release:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">release:clean</code>: This goal cleans up after a release preparation</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:prepare</code>: This <a id="id212" class="indexterm"/>goal prepares for a release in <span class="strong"><strong>Software Configuration Management</strong></span> (<span class="strong"><strong>SCM</strong></span>)</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:prepare-with-pom</code>: This goal prepares for a release in SCM, and it generates release POMs by fully resolving the dependencies</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:rollback</code>: This goal rolls back to a previous release</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:perform</code>: This goal performs a release from SCM</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:stage</code>: This goal performs a release from SCM into a staging folder/repository</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:branch</code>: This goal creates a branch of the current project with all the versions updated</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:update-versions</code>: This goal updates the versions in POM(s)</li></ul></div><p>The preparation stage will complete the following tasks with the <code class="literal">release:prepare</code> goal:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It verifies that all the changes in the source code are committed.</li><li class="listitem" style="list-style-type: disc">It ensures that there are no SNAPSHOT dependencies. During the project development phase, we use SNAPSHOT dependencies; however, at the time of the release, all the dependencies should be changed to the latest released version of each dependency.</li><li class="listitem" style="list-style-type: disc">The version of the project POM file will be changed from SNAPSHOT to a concrete version number.</li><li class="listitem" style="list-style-type: disc">The SCM information in the project POM file will be changed to include the final destination of the tag.</li><li class="listitem" style="list-style-type: disc">It execute all the tests against the modified POM files.</li><li class="listitem" style="list-style-type: disc">It commits the modified POM files to SCM and tag the code with the version name.</li><li class="listitem" style="list-style-type: disc">It changes the version in POM files in the trunk to a SNAPSHOT version and commits the modified POM files to the trunk.</li></ul></div><p>Finally, the release will be performed with the <code class="literal">release:perform</code> goal. This will check out the code from the <code class="literal">release</code> tag in the SCM, and run a set of predefined goals: <code class="literal">site</code> and <code class="literal">deploy-site</code>.</p><p>The <code class="literal">maven-release-plugin</code> is not defined in the super POM file; it should be explicitly<a id="id213" class="indexterm"/> defined in your application POM file. The <code class="literal">releaseProfiles</code> configuration element defines the profiles to be released, and the <code class="literal">goals</code> configuration <a id="id214" class="indexterm"/>element defines the plugin goals to be executed during <code class="literal">release:perform</code>, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.5&lt;/version&gt;
  &lt;configuration&gt;
    &lt;releaseProfiles&gt;release&lt;/releaseProfiles&gt;
    &lt;goals&gt;<span class="strong"><strong>deploy assembly:single</strong></span>&lt;/goals&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div></div></div></div>
<div class="section" title="Plugin discovery and execution"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec35"/>Plugin discovery and execution</h1></div></div></div><p>To associate a plugin with your Maven project, you have to either define it explicitly in your application <a id="id215" class="indexterm"/>POM file, or you should inherit it from a parent POM <a id="id216" class="indexterm"/>or the super POM file. Let's take a look at the Maven <code class="literal">jar</code> plugin. The <code class="literal">jar</code> plugin is defined by the super POM file, and all the Maven projects inherit it. To define a plugin (which is not inherited from the POM hierarchy), or associate a plugin with your Maven project, you must add the plugin configuration under the <code class="literal">build/plugins/plugin</code> element of your application <code class="literal">pom.xml</code>. In this way, you can associate any number of plugins with your project, as shown here:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;   
...   
   &lt;build&gt;     
    &lt;plugins&gt;       
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.4&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;default-jar&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;jar&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;   
   &lt;/build&gt;   
... 
&lt;/project&gt;</pre></div><p>In the Maven<a id="id217" class="indexterm"/> execution environment, what matters is not just your <a id="id218" class="indexterm"/>application POM file but the effective POM file. The effective POM file is constructed by the project POM file, any parent POM files, and the super POM file.</p><p>A Maven plugin can be executed in two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Using a lifecycle</li><li class="listitem" style="list-style-type: disc">Directly invoking a plugin goal</li></ul></div><p>If it is executed via a lifecycle, then there are plugin goals associated with different phases of the lifecycle. When each phase gets executed, all the plugin goals will also get executed only if the effective POM file of the project has defined the corresponding plugins under its plugins configuration. The same applies even when you try to invoke a plugin goal directly (for example, <code class="literal">mvn jar:jar</code>), the goal will be executed only if the corresponding plugin is associated with the project.</p><p>In either way, how does Maven find the plugin corresponding to the provided plugin goal?</p><p>Similar to any other dependency in Maven, a plugin is also uniquely identified by three coordinates: <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">version</code>. For plugins, however, you do not need to explicitly specify <code class="literal">groupId</code>. Maven assumes two <code class="literal">groupId</code> elements by default: <code class="literal">org.apache.maven.plugins</code> and <code class="literal">org.codehaus.mojo</code>. First, it will try to locate the plugin from <code class="literal">USER_HOME/.m2/repository/org/apache/maven/plugins</code>, and if that fails, it will locate it from <code class="literal">USER_HOME/.m2/repository/org/codehaus/mojo</code>.</p><p>In the previous sample plugin configuration, you may not find <code class="literal">groupId</code>. The <code class="literal">jar</code> plugin is available at <code class="literal">USER_HOME/.m2/repository/org/apache/maven/plugins/maven-jar-plugin</code>.</p><p>Maven also lets <a id="id219" class="indexterm"/>you add your own plugin groups, and they can<a id="id220" class="indexterm"/> be included in the plugin discovery. You can do it by updating <code class="literal">USER_HOME/.m2/settings.xml</code> or <code class="literal">MAVEN_HOME/conf/settings.xml</code>, as shown in the following manner:</p><div class="informalexample"><pre class="programlisting">&lt;pluginGroups&gt;
  &lt;pluginGroup&gt;com.packt.plugins&lt;/pluginGroup&gt;
&lt;/pluginGroups&gt;</pre></div><p>Maven will always give priority to the previous configuration and then start looking for the well-known <code class="literal">groupId</code> elements: <code class="literal">org.apache.maven.plugins</code> and <code class="literal">org.codehaus.mojo</code>.</p><p>Let's take a look at some of the sample plugin configurations used in some popular open source projects.</p><p>Apache Felix provides a <code class="literal">bundle</code> plugin for Maven, which creates an OSGi bundle out of a Maven project. Another open source project, WSO2 Carbon, uses this <code class="literal">bundle</code> plugin in its development. You<a id="id221" class="indexterm"/> can find a sample POM file, which consumes the plugin at <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/service-stubs/org.wso2.carbon.qpid.stub/4.2.0/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/service-stubs/org.wso2.carbon.qpid.stub/4.2.0/pom.xml</a>. This is a custom plugin, which does not fall into any of the <code class="literal">groupId</code> elements known to Maven by default. In that case, anyone who uses the plugin must qualify the plugin with <code class="literal">groupId</code>, or they must add the corresponding <code class="literal">groupId</code> element to the <code class="literal">pluginGroups</code> configuration element, as discussed earlier.</p><p>The following code shows the plugin configuration from the WSO2 Carbon project:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;<span class="strong"><strong>org.apache.felix</strong></span>&lt;/groupId&gt;
  &lt;artifactId&gt;<span class="strong"><strong>maven-bundle-plugin</strong></span>&lt;/artifactId&gt;              
  &lt;extensions&gt;true&lt;/extensions&gt;
  &lt;configuration&gt;
    &lt;instructions&gt;
      &lt;Bundle-SymbolicName&gt;
      ${project.artifactId}&lt;/Bundle-SymbolicName&gt;
      &lt;Bundle-Name&gt;${project.artifactId}&lt;/Bundle-Name&gt;
      &lt;Carbon-Component&gt;UIBundle&lt;/Carbon-Component&gt;
      &lt;Import-Package&gt;
             org.apache.axis2.*; version="${axis2.osgi.version.range}",
             org.apache.axiom.*; version="${axiom.osgi.version.range}",
             *;resolution:=optional
      &lt;/Import-Package&gt;
      &lt;Export-Package&gt;
             org.wso2.carbon.qpid.stub.*;version="${carbon.platform.package.export.version}",
      &lt;/Export-Package&gt;
    &lt;/instructions&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div><div class="section" title="Plugin management"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec35"/>Plugin management</h2></div></div></div><p>If you<a id="id222" class="indexterm"/> take a look at the previous configuration carefully, you do not see a version for the <code class="literal">bundle</code> plugin. This is where the <code class="literal">pluginManagement</code> element comes into play. With the <code class="literal">pluginManagement</code> configuration element, you can avoid repetitive usage of the plugin version. Once you define a plugin under <code class="literal">pluginManagement</code>, all the child POM files will inherit that configuration.</p><p>The WSO2 Carbon project defines all the plugins used by its child projects under the <code class="literal">pluginManagement</code> section of <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml</a>, and <a id="id223" class="indexterm"/>all the projects inherit it. A truncated part of the configuration is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;pluginManagement&gt;
  &lt;plugin&gt;
    &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
    &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.3.5&lt;/version&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
  &lt;/plugin&gt;
&lt;/pluginManagement&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note27"/>Note</h3><p>We'll discuss plugin management in detail in <a class="link" href="ch07.html" title="Chapter 7. Best Practices">Chapter 7</a>, <span class="emphasis"><em>Best Practices</em></span>.</p></div></div></div><div class="section" title="Plugin repositories"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec36"/>Plugin repositories</h2></div></div></div><p>Maven downloads<a id="id224" class="indexterm"/> plugins on demand when it cannot find a plugin in its local repository. By default, Maven looks for any plugin that is not available locally in the Maven plugin repository defined by the super POM file (this is the default behavior; you can also define plugin repositories in your application POM file). The following code snippets shows how to define plugin repositories:</p><div class="informalexample"><pre class="programlisting">&lt;pluginRepositories&gt;
  &lt;pluginRepository&gt;
    &lt;id&gt;central&lt;/id&gt;
    &lt;name&gt;Maven Plugin Repository&lt;/name&gt;
    &lt;url&gt;http://repo1.maven.org/maven2&lt;/url&gt;
    &lt;layout&gt;default&lt;/layout&gt;
    &lt;snapshots&gt;
      &lt;enabled&gt;false&lt;/enabled&gt;
    &lt;/snapshots&gt;
    &lt;releases&gt;
      &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
    &lt;/releases&gt;
  &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;</pre></div><p>If you develop a custom plugin, just like the Apache Felix <code class="literal">bundle</code> plugin, you must make it available for the rest via a plugin repository, and any other consumer of that plugin, such as the WSO2 Carbon project, must define the corresponding plugin repository in its POM file or in a parent POM file.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note28"/>Note</h3><p>The WSO2 Carbon <a id="id225" class="indexterm"/>project defines two plugin repositories in its parent POM file at <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml</a>.</p><p>The Apache Felix <code class="literal">bundle</code> plugin<a id="id226" class="indexterm"/> is available at <a class="ulink" href="http://dist.wso2.org/maven2/org/apache/felix/maven-bundle-plugin/">http://dist.wso2.org/maven2/org/apache/felix/maven-bundle-plugin/</a>.</p></div></div><p>The following configuration is a part of the WSO2 Carbon project <code class="literal">parent/pom.xml</code>, which defines the two plugin repositories:</p><div class="informalexample"><pre class="programlisting">&lt;pluginRepositories&gt;
  &lt;pluginRepository&gt;
    &lt;id&gt;wso2-maven2-repository-1&lt;/id&gt;
    &lt;url&gt;http://dist.wso2.org/maven2&lt;/url&gt;
  &lt;/pluginRepository&gt;
  &lt;pluginRepository&gt;
    &lt;id&gt;wso2-maven2-repository-2&lt;/id&gt;
    &lt;url&gt;http://dist.wso2.org/snapshots/maven2&lt;/url&gt;
  &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;</pre></div></div><div class="section" title="Plugin as an extension"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec37"/>Plugin as an extension</h2></div></div></div><p>If you look at the <a id="id227" class="indexterm"/>definition of the Apache Felix <code class="literal">bundle</code> plugin, you might have noticed the <code class="literal">extensions</code> configuration element, which is set to <code class="literal">true</code>:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
   &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
   &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt; 
   <span class="strong"><strong>&lt;extensions&gt;true&lt;/extensions&gt;</strong></span>
&lt;/plugin&gt;</pre></div><p>As we discussed earlier, the goal of the <code class="literal">bundle</code> plugin is to build an OSGi bundle from a Maven project. In other words, the Apache Felix <code class="literal">bundle</code> plugin introduces a new packaging type with an existing file extension, <code class="literal">.jar</code>. If you look at the POM file of the WSO2 Carbon project, which consumes the <code class="literal">bundle</code> plugin, you can see the packaging of the project is set to <code class="literal">bundle</code> (<a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/service-stubs/org.wso2.carbon.qpid.stub/4.2.0/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/service-stubs/org.wso2.carbon.qpid.stub/4.2.0/pom.xml</a>), as follows:</p><div class="informalexample"><pre class="programlisting">&lt;packaging&gt;bundle&lt;/packaging&gt;</pre></div><p>If you are associating a plugin with your project, which introduces a new packaging type or a customized lifecycle, then you must set the value of the <code class="literal">extensions</code> configuration element to <code class="literal">true</code>. Once this is done, the Maven engine will go further and will look for the <code class="literal">components.xml</code> file inside <code class="literal">META-INF/plexus</code> of the corresponding <code class="literal">jar</code> plugin.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec36"/>Summary</h1></div></div></div><p>In this chapter, we focused on Maven plugins. Maven only provides a build framework while the Maven plugins perform the actual tasks. Maven has a large, rich set of plugins, and the chances that you have to write your own custom plugin are very slim. This chapter covered some of the most commonly used Maven plugins, and later explained how plugins are discovered and executed. If you would like to know about custom plugin development, refer to the book, <span class="emphasis"><em>Mastering Apache Maven 3</em></span> by <span class="emphasis"><em>Packt Publishing</em></span>.</p><p>In the next chapter, we will focus on Maven build lifecycle.</p></div></body></html>