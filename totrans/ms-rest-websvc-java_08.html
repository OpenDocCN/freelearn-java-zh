<html><head></head><body>
  <div id="_idContainer063">
   <h1 class="chapterNumber">
    <a id="_idTextAnchor135">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     6
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-126">
    <a id="_idTextAnchor136">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Advanced API Concepts and Implementations
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3.1">
     Creating robust and high-performance RESTful APIs involves more than just setting up endpoints and handling CRUD operations.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     As applications grow and user demands increase, incorporating advanced strategies that keep your APIs efficient, reliable, and resilient under various conditions becomes essential.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     This chapter explores these strategies, focusing on data-handling techniques such as pagination, filtering, and file uploads and downloads, as well as resilience mechanisms crucial for modern API development.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.4.1">
     On the data management front, we will examine key practices such as pagination, filtering, and the efficient uploading and downloading of files through REST APIs.
    </span>
    <span class="koboSpan" id="kobo.4.2">
     These methods are designed to boost the responsiveness and scalability of your APIs, ensuring they can seamlessly manage higher loads and more complex data interactions.
    </span>
    <span class="koboSpan" id="kobo.4.3">
     Some of these topics are related to performance, but we will cover performance optimization in greater detail in
    </span>
    <a href="B21843_10.xhtml#_idTextAnchor284">
     <em class="italic">
      <span class="koboSpan" id="kobo.5.1">
       Chapter 10
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.6.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.7.1">
     The chapter will explore critical resilience mechanisms, including timeouts, retry strategies, rate limiting, throttling, idempotency keys, circuit breakers, and bulkheads.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     These approaches help safeguard your APIs against failures, manage traffic effectively, and maintain stability even under unpredictable or adverse conditions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.8.1">
     From a developer’s perspective, anticipating how systems will behave in real-world scenarios can be challenging.
    </span>
    <span class="koboSpan" id="kobo.8.2">
     During development, we often operate in ideal settings: running the API locally, being the sole user, and conducting tests with minimal variables that might cause failures.
    </span>
    <span class="koboSpan" id="kobo.8.3">
     This controlled environment can obscure the complexities and potential issues that emerge in production, where the API must support multiple users, handle varying loads, and respond to unexpected events.
    </span>
    <span class="koboSpan" id="kobo.8.4">
     By incorporating the advanced concepts and implementations discussed in this chapter, you will be better equipped to build APIs that perform reliably and efficiently in any environment.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.9.1">
     We are going to cover the following topics:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.10.1">
      Data handling
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.11.1">
      Resilience
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-127">
    <a id="_idTextAnchor137">
    </a>
    <span class="koboSpan" id="kobo.12.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.13.1">
     In this chapter, you will find several different approaches that will help you to improve your API depending on your requirements.
    </span>
    <span class="koboSpan" id="kobo.13.2">
     For this chapter, we recommend you catch up with the code from the previous chapter; some small enhancements for this chapter are available at the following link:
    </span>
    <a href="https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter6">
     <span class="url">
      <span class="koboSpan" id="kobo.14.1">
       https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter6
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.15.1">
     .
    </span>
    <span class="koboSpan" id="kobo.15.2">
     We use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.16.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.17.1">
     command-line tool as a client to test the APIs.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-128">
    <a id="_idTextAnchor138">
    </a>
    <span class="koboSpan" id="kobo.18.1">
     Data handling
    </span>
   </h1>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.19.1">
      Data handling
     </span>
    </strong>
    <span class="koboSpan" id="kobo.20.1">
     is the cornerstone of building robust and user-friendly APIs.
    </span>
    <span class="koboSpan" id="kobo.20.2">
     In this section, we will explore advanced data-handling techniques that address common challenges faced in real-world API development.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.21.1">
     Ensuring that an
    </span>
    <a id="_idIndexMarker320">
    </a>
    <span class="koboSpan" id="kobo.22.1">
     API delivers reliable performance is crucial for several interconnected reasons, including enhancing user experience, enabling system scalability, optimizing resource efficiency, and influencing the success of the business behind API development.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.23.1">
     A high-performing API must respond quickly and communicate clearly with clients.
    </span>
    <span class="koboSpan" id="kobo.23.2">
     This means returning appropriate HTTP status codes (such as 200 for success or 404 for not found) along with descriptive messages that explain what happened.
    </span>
    <span class="koboSpan" id="kobo.23.3">
     Low latency is crucial because users expect fast responses, and slow APIs can create system bottlenecks that frustrate users.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.24.1">
     When APIs take too long to respond, they cause delays throughout the entire application.
    </span>
    <span class="koboSpan" id="kobo.24.2">
     Modern systems often need real-time data updates, so APIs must handle frequent requests efficiently while maintaining consistent response times.
    </span>
    <span class="koboSpan" id="kobo.24.3">
     Clear communication is equally important—when errors occur, clients need informative messages that explain the problem and suggest solutions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.25.1">
     Effective APIs balance speed with clarity.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     They process requests quickly while providing meaningful feedback through proper status codes and helpful messages.
    </span>
    <span class="koboSpan" id="kobo.25.3">
     This approach ensures both end users and developers can work with the API effectively, reducing confusion and debugging time.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.26.1">
     Optimizing response
    </span>
    <a id="_idIndexMarker321">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     speed and message quality helps APIs handle increased traffic without compromising performance or raising operational costs.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     These improvements support both user satisfaction and business growth.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.28.1">
     In the following sections, we will explore data-handling techniques that improve API performance.
    </span>
    <span class="koboSpan" id="kobo.28.2">
     We will start with pagination for managing large datasets, then cover filtering and efficient file operations through REST APIs.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-129">
    <span class="koboSpan" id="kobo.29.1">
     Paginatio
    </span>
    <a id="_idTextAnchor139">
    </a>
    <span class="koboSpan" id="kobo.30.1">
     n
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.31.1">
     Retrieving a large number of records from one or multiple database tables and converting them into a data
    </span>
    <a id="_idIndexMarker322">
    </a>
    <span class="koboSpan" id="kobo.32.1">
     structure compatible with your language/framework, such as in Java with Spring Boot, consumes resources, including memory and CPU processing power.
    </span>
    <span class="koboSpan" id="kobo.32.2">
     This process continues until the data is transformed into a standard format
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     such as JSON for communication and is ready to be sent to the client.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     Additionally, even after the data is prepared, resources are still used to transmit it over the network to the client.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.34.1">
     Often, it is unnecessary to send all the data represented by a resource in a single, large payload to the client.
    </span>
    <span class="koboSpan" id="kobo.34.2">
     Doing so consumes more resources, degrades the system performance, and causes a poor user experience.
    </span>
    <span class="koboSpan" id="kobo.34.3">
     These may be accompanied by the increased costs associated with cloud computing, which are billed based on usage.
    </span>
    <span class="koboSpan" id="kobo.34.4">
     Processing and transferring larger amounts of data also takes more time.
    </span>
    <span class="koboSpan" id="kobo.34.5">
     Instead, the data can be divided into smaller chunks, which require less time and fewer resources, thereby making the API more reliable and cost-effective to maintain.
    </span>
    <span class="koboSpan" id="kobo.34.6">
     This approach is known as
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.35.1">
      pagination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.36.1">
     , which enhances API responsiveness and conserves resources.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.37.1">
     Consider the following example: our API contains 100,000 products, and we have a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.38.1">
      single-page application
     </span>
    </strong>
    <span class="koboSpan" id="kobo.39.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.40.1">
      SPA
     </span>
    </strong>
    <span class="koboSpan" id="kobo.41.1">
     ) that consumes
    </span>
    <a id="_idIndexMarker324">
    </a>
    <span class="koboSpan" id="kobo.42.1">
     this API to display products in a data table on the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.43.1">
      Products
     </span>
    </strong>
    <span class="koboSpan" id="kobo.44.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.44.2">
     Imagine that every time a user opens this page, the API is called to access the database, load these records into memory, convert them to JSON, and then transfer this large amount of data via an internet request each time a user accesses the page.
    </span>
    <span class="koboSpan" id="kobo.44.3">
     Now, imagine that this system is used by numerous users daily.
    </span>
    <span class="koboSpan" id="kobo.44.4">
     Without pagination, each user action would trigger resource-intensive processes, leading to increased costs, slower response times, and a diminished user experience.
    </span>
    <span class="koboSpan" id="kobo.44.5">
     By implementing pagination, the API can deliver smaller, more manageable datasets, improving performance and scalability while reducing operational expenses.
    </span>
    <span class="koboSpan" id="kobo.44.6">
     All of that can be done without limiting the user interface view of the application, because the user will never see all the products displayed at the same time.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-130">
    <a id="_idTextAnchor140">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     Different pagination approaches
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.46.1">
     The following
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     are some common approaches to REST API pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.48.1">
      Offset-based pagination
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.49.1">
      Page-based pagination
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.50.1">
      Cursor-based pagination
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.51.1">
      Keyset pagination
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.52.1">
     Let’s take a look at each of them
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.53.1">
     Offset-based pagination
    </span>
   </h4>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.54.1">
      Offset-based pagination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.55.1">
     is a straightforward and widely adopted technique.
    </span>
    <span class="koboSpan" id="kobo.55.2">
     It works by defining an
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.56.1">
     offset (the starting position) and a limit (the number of records to retrieve per page) to navigate through the dataset.
    </span>
    <span class="koboSpan" id="kobo.56.2">
     This is the approach
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.57.1">
     that we can find in the APIs of several different companies, such as OpenWeatherMap, Stripe, Adidas, and Mailchimp.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.58.1">
     The following
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.59.1">
     are the advantages of offset-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.60.1">
       Simplicity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.61.1">
      : The method is straightforward to implement and easy to understand
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.62.1">
       Flexibility
      </span>
     </strong>
     <span class="koboSpan" id="kobo.63.1">
      : By adjusting the offset, you can directly jump to any position that you may want
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.64.1">
     The following
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.65.1">
     are the disadvantages of offset-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.66.1">
       Performance issues
      </span>
     </strong>
     <span class="koboSpan" id="kobo.67.1">
      : As the offset increases, query performance declines because the database must scan and skip over a growing number of records.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.68.1">
       Data consistency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.69.1">
      : Data changes such as inserts or deletes between requests can lead to inconsistent results, causing duplicate or missing records across pages.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.70.1">
     Clients can manipulate the business logic, which does not guarantee a single experience for all clients.
    </span>
    <span class="koboSpan" id="kobo.70.2">
     It can be considered a benefit, though, if the API is meant to be very flexible.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.71.1">
     Most likely, this will be passed to a database query such as SQL, which, without proper input sanitization and parameterization, can cause SQL injection.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.72.1">
     The following is an example of an API call:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.73.1">GET /api/products?offset=50&amp;limit=25
GET https://&lt;dc&gt;.api.mailchimp.com/3.0/lists/{list_id}/members?count=100&amp;offset=200
</span></code></pre>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.74.1">
     Page-based pagination
    </span>
   </h4>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.75.1">
      Page-based pagination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.76.1">
     divides a dataset into pages, allowing clients to navigate the data by specifying a
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.77.1">
     page number.
    </span>
    <span class="koboSpan" id="kobo.77.2">
     This approach is simple and hence widely adopted
    </span>
    <a id="_idIndexMarker331">
    </a>
    <span class="koboSpan" id="kobo.78.1">
     by companies in the API market, for example, Salesforce and Microsoft.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.79.1">
     To use it, you need to specify the page you want to retrieve (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.80.1">
      page
     </span>
    </code>
    <span class="koboSpan" id="kobo.81.1">
     ) and the number of records per page (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.82.1">
      page_size
     </span>
    </code>
    <span class="koboSpan" id="kobo.83.1">
     ).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.84.1">
     The following
    </span>
    <a id="_idIndexMarker332">
    </a>
    <span class="koboSpan" id="kobo.85.1">
     are the advantages of page-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.86.1">
       User-friendliness
      </span>
     </strong>
     <span class="koboSpan" id="kobo.87.1">
      : Intuitive for users to navigate to specific pages
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.88.1">
       Simplicity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.89.1">
      : Easy to implement and understand
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.90.1">
     The following
    </span>
    <a id="_idIndexMarker333">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     are the disadvantages of page-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.92.1">
       Performance issues
      </span>
     </strong>
     <span class="koboSpan" id="kobo.93.1">
      : Like offset-based pagination, large page numbers can cause performance degradation.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.94.1">
       Less flexibility
      </span>
     </strong>
     <span class="koboSpan" id="kobo.95.1">
      : The returned list of records must start at a page boundary.
     </span>
     <span class="koboSpan" id="kobo.95.2">
      This may not be convenient for user interfaces using scrollbars instead of the classical pagination.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.96.1">
     The following is an example of an API call:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.97.1">GET https://api.github.com/repos/{owner}/{repo}/issues?page=2&amp;per_page=30
GET https://yoursubdomain.zendesk.com/api/v2/tickets.json?page=5&amp;per_page=100
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.98.1">
     Page-based pagination for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.99.1">
      GET /products
     </span>
    </code>
    <span class="koboSpan" id="kobo.100.1">
     endpoint of our example Product API was implemented while demonstrating API evolution in
    </span>
    <a href="B21843_05.xhtml#_idTextAnchor116">
     <em class="italic">
      <span class="koboSpan" id="kobo.101.1">
       Chapter 5
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.102.1">
     .
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.103.1">
     Cursor-based pagination
    </span>
   </h4>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.104.1">
      Cursor-based pagination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.105.1">
     uses a pointer (cursor) to keep track of the current position in the dataset.
    </span>
    <span class="koboSpan" id="kobo.105.2">
     Instead
    </span>
    <a id="_idIndexMarker334">
    </a>
    <span class="koboSpan" id="kobo.106.1">
     of specifying an offset, clients use a cursor to request the
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     next set of records and a limit that represents the number of records we want to return per chunk of data.
    </span>
    <span class="koboSpan" id="kobo.107.2">
     That is the approach implemented by the X (formerly Twitter) API to paginate the data of tweets, followers, and other resources.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.108.1">
     The following
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.109.1">
     are the advantages of cursor-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.110.1">
       Performance efficiency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.111.1">
      : Maintains reliable performance regardless of dataset size since it does not require skipping records
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.112.1">
       Data consistency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.113.1">
      : Less susceptible to data inconsistencies between requests, ensuring more reliable results
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.114.1">
     The following
    </span>
    <a id="_idIndexMarker337">
    </a>
    <span class="koboSpan" id="kobo.115.1">
     are the disadvantages of cursor-based pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.116.1">
       Complexity
      </span>
     </strong>
     <span class="koboSpan" id="kobo.117.1">
      : The implementation is more complex when compared to offset-based pagination
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.118.1">
       Less flexibility
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      : It is suited for sequential navigation and may not be a good option if you need to jump to arbitrary pages
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.120.1">
     The following is an example of an API call:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.121.1">GET /api/products?cursor=eyJpZCI6NzUsIm5hbWUiOiJQcm9kdWN0IDc1In0=&amp;limit=25
GET https://api.twitter.com/2/tweets?pagination_token=XYZ123&amp;max_results=20
</span></code></pre>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.122.1">
     Keyset pagination
    </span>
   </h4>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.123.1">
      Keyset pagination
     </span>
    </strong>
    <span class="koboSpan" id="kobo.124.1">
     is a variation
    </span>
    <a id="_idIndexMarker338">
    </a>
    <span class="koboSpan" id="kobo.125.1">
     of cursor-based pagination; it leverages a
    </span>
    <a id="_idIndexMarker339">
    </a>
    <span class="koboSpan" id="kobo.126.1">
     unique key—typically a timestamp or a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.127.1">
      universally unique identifier
     </span>
    </strong>
    <span class="koboSpan" id="kobo.128.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.129.1">
      UUID
     </span>
    </strong>
    <span class="koboSpan" id="kobo.130.1">
     )—to navigate through records.
    </span>
    <span class="koboSpan" id="kobo.130.2">
     Unlike offset-based pagination, which relies
    </span>
    <a id="_idIndexMarker340">
    </a>
    <span class="koboSpan" id="kobo.131.1">
     on numerical offsets that can become increasingly inefficient with larger datasets, keyset pagination uses the unique key to mark the position in the dataset.
    </span>
    <span class="koboSpan" id="kobo.131.2">
     This approach ensures faster query performance and more consistent response times, making it particularly well suited for applications that require real-time data access and scalability.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.132.1">
     The following
    </span>
    <a id="_idIndexMarker341">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     are the advantages of keyset pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.134.1">
       Performance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.135.1">
      : Keyset pagination offers better performance for large datasets by eliminating the need for the database to count or skip over large numbers of records, as is necessary with offset-based pagination
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.136.1">
       Scalability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.137.1">
      : As datasets grow, keyset pagination maintains consistent response times, making it a scalable solution for high-traffic applications
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.138.1">
       Reliability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.139.1">
      : By relying on a unique key for navigation, keyset pagination reduces the risk of encountering missing or duplicate records, ensuring data integrity across paginated results
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.140.1">
     The following
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.141.1">
     are the disadvantages of keyset pagination:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.142.1">
       Sequential navigation only
      </span>
     </strong>
     <span class="koboSpan" id="kobo.143.1">
      : Keyset pagination requires sequential data access.
     </span>
     <span class="koboSpan" id="kobo.143.2">
      Unlike offset-based pagination, which allows users to jump directly to any page by specifying an offset, keyset pagination requires navigating through records in a linear order.
     </span>
     <span class="koboSpan" id="kobo.143.3">
      This limitation can be restrictive for applications where users need to access non-sequential pages or perform random access within the dataset.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.144.1">
       Bookmark dependency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.145.1">
      : To access a specific page, the client must retain the unique key (cursor) from the preceding pages.
     </span>
     <span class="koboSpan" id="kobo.145.2">
      This dependency can complicate client-side logic, especially in scenarios where users might want to revisit or share specific pages without maintaining a history of cursors.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.146.1">
     The following is an example of an API call:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.147.1">GET https://www.reddit.com/r/{subreddit}/comments.json?limit=25&amp;after=t3_abcdef
GET https://api.linkedin.com/v2/connections?q=cursor&amp;start=0&amp;count=25&amp;cursor=urn:li:person:123456789 Authorization: Bearer YOUR_ACCESS_TOKEN
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.148.1">
     After selecting
    </span>
    <a id="_idIndexMarker343">
    </a>
    <span class="koboSpan" id="kobo.149.1">
     the pagination strategy to apply to all our endpoints and APIs, we should
    </span>
    <a id="_idIndexMarker344">
    </a>
    <span class="koboSpan" id="kobo.150.1">
     also return the information about the pagination.
    </span>
    <span class="koboSpan" id="kobo.150.2">
     Providing information such as total items, pages, and the current page helps clients better navigate large datasets.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-131">
    <a id="_idTextAnchor141">
    </a>
    <span class="koboSpan" id="kobo.151.1">
     Different approaches to return pagination information
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.152.1">
     There are
    </span>
    <a id="_idIndexMarker345">
    </a>
    <span class="koboSpan" id="kobo.153.1">
     many ways to return pagination information to the client.
    </span>
    <span class="koboSpan" id="kobo.153.2">
     The most common are as follows:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.154.1">
      Using response headers
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.155.1">
      Including pagination information in the response body
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.156.1">
      Using hypermedia (HATEOAS)
     </span>
    </li>
   </ul>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.157.1">
     Using response headers
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.158.1">
     This strategy involves embedding pagination information directly within the HTTP headers, such as
    </span>
    <a id="_idIndexMarker346">
    </a>
    <span class="koboSpan" id="kobo.159.1">
     details about the total number of pages, the current page, and other relevant information.
    </span>
    <span class="koboSpan" id="kobo.159.2">
     This approach is not commonly used in isolation, and it is often combined with other strategies to enhance API functionality.
    </span>
    <span class="koboSpan" id="kobo.159.3">
     For instance, GitLab employs this method alongside hypermedia strategies to provide a more comprehensive user experience.
    </span>
    <span class="koboSpan" id="kobo.159.4">
     We can combine filtering with pagination to retrieve specific data, allowing us to manage large datasets by breaking them into paginated sections:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.160.1">HTTP/</span><span class="hljs-number"><span class="koboSpan" id="kobo.161.1">2</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.162.1">200</span></span><span class="koboSpan" id="kobo.163.1"> OK
status</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.164.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.165.1">200</span></span><span class="koboSpan" id="kobo.166.1"> OK
X-Total-Count</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.167.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.168.1">150</span></span><span class="koboSpan" id="kobo.169.1">
X-Total-Pages</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.170.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.171.1">15</span></span><span class="koboSpan" id="kobo.172.1">
X-Current-Page</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.173.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.174.1">3</span></span><span class="koboSpan" id="kobo.175.1">
X-Page-Size</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.176.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.177.1">10</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.178.1">
     In the preceding example, we can see four custom headers to inform the client about how to navigate through the API effectively.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.179.1">
     Including pagination information in the response body
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.180.1">
     In this approach, the API includes paginated data within the response body alongside relevant pagination
    </span>
    <a id="_idIndexMarker347">
    </a>
    <span class="koboSpan" id="kobo.181.1">
     metadata, such as total pages and the current page.
    </span>
    <span class="koboSpan" id="kobo.181.2">
     For example, the Stripe API employs this strategy by returning both the data and a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.182.1">
      has_more
     </span>
    </code>
    <span class="koboSpan" id="kobo.183.1">
     flag that indicates whether additional results are available.
    </span>
    <span class="koboSpan" id="kobo.183.2">
     This method offers clarity by directly integrating pagination details with the response, letting clients understand their data context.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.184.1">
     Some APIs separate the response data from the metadata, which can also be effective.
    </span>
    <span class="koboSpan" id="kobo.184.2">
     An examp
    </span>
    <a id="_idTextAnchor142">
    </a>
    <span class="koboSpan" id="kobo.185.1">
     le structure is shown here:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.186.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.187.1">"data"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.188.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.189.1">[</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.190.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.191.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.192.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.193.1">1</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.194.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.195.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.196.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.197.1">"Item 1"</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.198.1">},</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.199.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.200.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.201.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.202.1">2</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.203.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.204.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.205.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.206.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.207.1">Item 2"</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.208.1">}</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.209.1">],</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.210.1">"pagination"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.211.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.212.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.213.1">"totalItems"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.214.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.215.1">150</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.216.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.217.1">"totalPages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.218.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.219.1">15</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.220.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.221.1">"currentPage"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.222.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.223.1">3</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.224.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.225.1">"pageSize"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.226.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.227.1">10</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.228.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.229.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.230.1">
     In this structure, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.231.1">
      data
     </span>
    </code>
    <span class="koboSpan" id="kobo.232.1">
     field contains the actual results from the API, while the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.233.1">
      pagination
     </span>
    </code>
    <span class="koboSpan" id="kobo.234.1">
     section
    </span>
    <a id="_idIndexMarker348">
    </a>
    <span class="koboSpan" id="kobo.235.1">
     provides essential metadata about the paginated response.
    </span>
    <span class="koboSpan" id="kobo.235.2">
     This approach enhances usability by clearly organizing both the data and its associated pagination information, making it easier for clients to navigate and process the results.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.236.1">
     Using hypermedia (HATEOAS)
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.237.1">
     HATEOAS enhances API responses by embedding navigational links that guide clients on how to
    </span>
    <a id="_idIndexMarker349">
    </a>
    <span class="koboSpan" id="kobo.238.1">
     navigate and perform actions based on the server’s response.
    </span>
    <span class="koboSpan" id="kobo.238.2">
     As we discussed in
    </span>
    <a href="B21843_01.xhtml#_idTextAnchor015">
     <em class="italic">
      <span class="koboSpan" id="kobo.239.1">
       Chapter 1
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.240.1">
     , HATEOAS represents the fourth level of maturity in REST architecture, helping to decouple the client from the server.
    </span>
    <span class="koboSpan" id="kobo.240.2">
     We will dive deep into this subject in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.241.1">
      HATEOAS
     </span>
    </em>
    <span class="koboSpan" id="kobo.242.1">
     subsection later in this chapter.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.243.1">
     This strategy empowers clients to interact with the API dynamically, without requiring prior knowledge of the structure or additional documentation.
    </span>
    <span class="koboSpan" id="kobo.243.2">
     For example, APIs such as GitHub incorporate HATEOAS to make navigation through resources, such as paginated data, straightforward and intuitive.
    </span>
    <span class="koboSpan" id="kobo.243.3">
     In the following code block, we can see an example of using this strategy to help the client move through the data:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.244.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.245.1">"_links"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.246.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.247.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.248.1">"self"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.249.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.250.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.251.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.252.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.253.1">"/orders?offset=200&amp;limit=20"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.254.1">},</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.255.1">"prev"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.256.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.257.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.258.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.259.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.260.1">"/orders?offset=180&amp;limit=20"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.261.1">},</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.262.1">"next"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.263.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.264.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.265.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.266.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.267.1">"/orders?offset=220&amp;limit=20"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.268.1">},</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.269.1">"first"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.270.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.271.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.272.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.273.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.274.1">"/orders?limit=20"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.275.1">},</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.276.1">"last"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.277.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.278.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.279.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.280.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.281.1">"/orders?offset=1000&amp;limit=20"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.282.1">}</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.283.1">},</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.284.1">"totalCount"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.285.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.286.1">1020</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.287.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.288.1">"_embedded"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.289.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.290.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.291.1">"orders"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.292.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.293.1">[</span></span>
      <span class="hljs-punctuation"><span class="koboSpan" id="kobo.294.1">{</span></span><span class="koboSpan" id="kobo.295.1"> ... </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.296.1">},</span></span>
      <span class="hljs-punctuation"><span class="koboSpan" id="kobo.297.1">{</span></span><span class="koboSpan" id="kobo.298.1"> ... </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.299.1">},</span></span><span class="koboSpan" id="kobo.300.1">
      ... 
    </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.301.1">]</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.302.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.303.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.304.1">
     As shown in the preceding code, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.305.1">
      _links
     </span>
    </code>
    <span class="koboSpan" id="kobo.306.1">
     attribute provides key navigational details, including information about the current request and links to the previous and next pages, as well
    </span>
    <a id="_idIndexMarker350">
    </a>
    <span class="koboSpan" id="kobo.307.1">
     as the first and last pages.
    </span>
    <span class="koboSpan" id="kobo.307.2">
     With these comprehensive links, clients can effortlessly navigate through the API without needing to construct additional requests manually.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.308.1">
     This structure streamlines the client’s interaction with the data, embedding the necessary navigation information within each response.
    </span>
    <span class="koboSpan" id="kobo.308.2">
     By supplying these links, the API enables developers to create more intuitive and seamless user experiences.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.309.1">
     In API development, efficient data handling and robust pagination strategies are not merely supplementary features—they are essential points that underpin the efficacy, scalability, and overall user experience of your applications.
    </span>
    <span class="koboSpan" id="kobo.309.2">
     We have outlined some different pagination approaches with their details, to ensure that your APIs deliver reliable and high-performing services.
    </span>
    <span class="koboSpan" id="kobo.309.3">
     Regardless of your chosen approach, the key is maintaining consistency across all endpoints.
    </span>
    <span class="koboSpan" id="kobo.309.4">
     Ensuring that every API follows the same pagination standard helps simplify integration for clients and promotes a more cohesive experience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.310.1">
     In the next section, we will explore how to filter data returned by the API by applying some strategies that allow us to combine pagination and filtering.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.311.1">
     While pagination alone enables us to manage large datasets by breaking them into manageable pages, it may not fully address the client’s needs when specific subsets of data are required.
    </span>
    <span class="koboSpan" id="kobo.311.2">
     To improve data handling further, we can incorporate filtering, which will allow clients to retrieve only the data they need within each page.
    </span>
    <span class="koboSpan" id="kobo.311.3">
     By combining pagination with filtering, we offer a more flexible and efficient approach to data retrieval.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-132">
    <a id="_idTextAnchor143">
    </a>
    <span class="koboSpan" id="kobo.312.1">
     Filtering
    </span>
   </h2>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.313.1">
      Filtering
     </span>
    </strong>
    <span class="koboSpan" id="kobo.314.1">
     allows API
    </span>
    <a id="_idIndexMarker351">
    </a>
    <span class="koboSpan" id="kobo.315.1">
     clients to inform our API that we need some specific subset of the data
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.316.1">
     on that resource, which means that it will not waste resources processing data that we are not interested in at that moment; we can concentrate exclusively on the data that we need.
    </span>
    <span class="koboSpan" id="kobo.316.2">
     We can combine filtering with pagination to retrieve specific data, allowing us to manage large datasets by breaking them into paginated sections.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.317.1">
     The following are some principles for filtering:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.318.1">
       Statelessness
      </span>
     </strong>
     <span class="koboSpan" id="kobo.319.1">
      : The REST API should be stateless, meaning that every request from a client
     </span>
     <a id="_idIndexMarker353">
     </a>
     <span class="koboSpan" id="kobo.320.1">
      must contain all the necessary information that will give the server the capability to fulfill the request.
     </span>
     <span class="koboSpan" id="kobo.320.2">
      Filtering is achieved by including filter parameters in the query string of the request URL, without the need to save this state on the API server side.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.321.1">
       Consistency and predictability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      : The filtering syntax should be consistent across all API endpoints.
     </span>
     <span class="koboSpan" id="kobo.322.2">
      This ensures predictability across different endpoints and makes it easy for
     </span>
     <a id="_idIndexMarker354">
     </a>
     <span class="koboSpan" id="kobo.323.1">
      clients to understand the filtering by looking at the request.
     </span>
     <span class="koboSpan" id="kobo.323.2">
      For example, if we are filtering by a first name parameter using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.324.1">
       `?firstName=Peter`
      </span>
     </code>
     <span class="koboSpan" id="kobo.325.1">
      in one endpoint, it should work similarly across other endpoints where such filtering is relevant.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.326.1">
       Granularity and flexibility
      </span>
     </strong>
     <span class="koboSpan" id="kobo.327.1">
      : An effective filtering mechanism allows clients to precisely
     </span>
     <a id="_idIndexMarker355">
     </a>
     <span class="koboSpan" id="kobo.328.1">
      define their requirements while being adaptable enough to handle different scenarios.
     </span>
     <span class="koboSpan" id="kobo.328.2">
      For instance, filters should accommodate different data types (such as strings, numbers, and dates) and a range of operators (such as equals, not equals, greater than, less than, in, etc.).
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-133">
    <a id="_idTextAnchor144">
    </a>
    <span class="koboSpan" id="kobo.329.1">
     Different filtering approaches
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.330.1">
     Filtering
    </span>
    <a id="_idIndexMarker356">
    </a>
    <span class="koboSpan" id="kobo.331.1">
     can be implemented via several different approaches.
    </span>
    <span class="koboSpan" id="kobo.331.2">
     It can be implemented using the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.332.1">
       Basic field filtering
      </span>
     </strong>
     <span class="koboSpan" id="kobo.333.1">
      : This is
     </span>
     <a id="_idIndexMarker357">
     </a>
     <span class="koboSpan" id="kobo.334.1">
      the most straightforward approach, where you can pass the field name to the resource and the value that you want to filter by, which is usually done by passing these values as a query parameter on the URL:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.335.1">GET</span></span><span class="koboSpan" id="kobo.336.1"> /customers?firstName=</span><span class="hljs-title"><span class="koboSpan" id="kobo.337.1">Peter</span></span><span class="koboSpan" id="kobo.338.1"> or </span><span class="hljs-variable"><span class="koboSpan" id="kobo.339.1">GET</span></span><span class="koboSpan" id="kobo.340.1"> /products?category=electronics
</span></code></pre>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.341.1">
       Multiple field filtering
      </span>
     </strong>
     <span class="koboSpan" id="kobo.342.1">
      : This is the same as the previous one, with the only difference
     </span>
     <a id="_idIndexMarker358">
     </a>
     <span class="koboSpan" id="kobo.343.1">
      being that we will pass multiple field filters and their respective values for filtering the data.
     </span>
     <span class="koboSpan" id="kobo.343.2">
      To separate the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.344.1">
       field=value
      </span>
     </code>
     <span class="koboSpan" id="kobo.345.1">
      set, we will use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.346.1">
       '&amp;'
      </span>
     </code>
     <span class="koboSpan" id="kobo.347.1">
      character:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.348.1">GET</span></span><span class="koboSpan" id="kobo.349.1"> /customer?firstName=</span><span class="hljs-title"><span class="koboSpan" id="kobo.350.1">Peter</span></span><span class="koboSpan" id="kobo.351.1">&amp;age=</span><span class="hljs-number"><span class="koboSpan" id="kobo.352.1">30</span></span>
</code></pre>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.353.1">
     It is possible to achieve filtering by a range of values, combining the same field name preceded by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.354.1">
      min
     </span>
    </code>
    <span class="koboSpan" id="kobo.355.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.356.1">
      max
     </span>
    </code>
    <span class="koboSpan" id="kobo.357.1">
     prefixes, as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.358.1">GET</span></span><span class="koboSpan" id="kobo.359.1"> /customer?minAge=</span><span class="hljs-number"><span class="koboSpan" id="kobo.360.1">35</span></span><span class="koboSpan" id="kobo.361.1">&amp;maxAge=</span><span class="hljs-number"><span class="koboSpan" id="kobo.362.1">45</span></span>
</code></pre>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.363.1">
       Filtering with comparison operators
      </span>
     </strong>
     <span class="koboSpan" id="kobo.364.1">
      : Some APIs also provide the capability of handling
     </span>
     <a id="_idIndexMarker359">
     </a>
     <span class="koboSpan" id="kobo.365.1">
      comparison operators; this gives a chance to build a more sophisticated set of filtering combinations than a simple field equals value:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.366.1">GET</span></span><span class="koboSpan" id="kobo.367.1"> /products?price[gte]=</span><span class="hljs-number"><span class="koboSpan" id="kobo.368.1">100</span></span><span class="koboSpan" id="kobo.369.1">&amp;price[lte]=</span><span class="hljs-number"><span class="koboSpan" id="kobo.370.1">500</span></span>
</code></pre>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.371.1">
       List filtering (inclusion/exclusion)
      </span>
     </strong>
     <span class="koboSpan" id="kobo.372.1">
      : Using
     </span>
     <a id="_idIndexMarker360">
     </a>
     <span class="koboSpan" id="kobo.373.1">
      this approach, we can use an operator of
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.374.1">
       in
      </span>
     </code>
     <span class="koboSpan" id="kobo.375.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.376.1">
       nin
      </span>
     </code>
     <span class="koboSpan" id="kobo.377.1">
      (not in) on a list:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.378.1">GET</span></span><span class="koboSpan" id="kobo.379.1"> /users?role[</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.380.1">in</span></span><span class="koboSpan" id="kobo.381.1">]=admin,supervisor,user
</span><span class="hljs-variable"><span class="koboSpan" id="kobo.382.1">GET</span></span><span class="koboSpan" id="kobo.383.1"> /products?category[nin]=books,phones
</span></code></pre>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.384.1">
     As you will
    </span>
    <a id="_idIndexMarker361">
    </a>
    <span class="koboSpan" id="kobo.385.1">
     realize by now, pagination and filtering are two concepts that you cannot miss in your API implementation.
    </span>
    <span class="koboSpan" id="kobo.385.2">
     Furthermore, they need to be combined to exploit their advantages on the endpoints of our APIs that are candidates to return lists of data.
    </span>
    <span class="koboSpan" id="kobo.385.3">
     These are some best practices:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.386.1">
      Use significant, clear, and intuitive parameter names that guide the user to avoid errors
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.387.1">
      Validate and sanitize the inputs to avoid attacks and typos
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.388.1">
      Validate and implement default limits to avoid the user requesting large values and the server having to pass excessive volumes of data
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.389.1">
      Keep consistent naming, response metadata, and approaches across the system to provide a good user/developer experience, making the structure and parametrization standardized and easy to consume
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.390.1">
     Filtering is a critical aspect of robust API design, enabling clients to retrieve the data they need without overburdening the server or the network.
    </span>
    <span class="koboSpan" id="kobo.390.2">
     By implementing well-structured filtering mechanisms, APIs can achieve higher performance, scalability, and user satisfaction.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.391.1">
     Employing various filtering approaches—from basic field filters to advanced comparison operators and list-based criteria—allows APIs to cater to diverse client requirements and complex querying needs.
    </span>
    <span class="koboSpan" id="kobo.391.2">
     Moreover, integrating filtering with pagination not only enhances data management but also ensures that responses remain swift and manageable, even when dealing with extensive datasets.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.392.1">
     Let us explore a
    </span>
    <a id="_idIndexMarker362">
    </a>
    <span class="koboSpan" id="kobo.393.1">
     practical example that builds upon our paginated endpoint.
    </span>
    <span class="koboSpan" id="kobo.393.2">
     Here, we add filtering capabilities to allow clients to specify criteria such as categories or price ranges.
    </span>
    <span class="koboSpan" id="kobo.393.3">
     Combining pagination and filtering not only enhances data management but also is a best practice that provides a streamlined experience for clients, keeping responses fast and relevant even as datasets grow.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.394.1">
     Consider an e-commerce API endpoint that returns a list of products.
    </span>
    <span class="koboSpan" id="kobo.394.2">
     This endpoint allows clients to request specific pages of data and apply filters to retrieve only the products they need, reducing data load on both the client and server.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.395.1">
     The following is an example of an API call using pagination and filtering:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.396.1">GET</span></span><span class="koboSpan" id="kobo.397.1"> /api/v1/products?page=</span><span class="hljs-number"><span class="koboSpan" id="kobo.398.1">2</span></span><span class="koboSpan" id="kobo.399.1">&amp;limit=</span><span class="hljs-number"><span class="koboSpan" id="kobo.400.1">10</span></span><span class="koboSpan" id="kobo.401.1">&amp;category=electronics&amp;price_min=</span><span class="hljs-number"><span class="koboSpan" id="kobo.402.1">100</span></span><span class="koboSpan" id="kobo.403.1">&amp;price_max=</span><span class="hljs-number"><span class="koboSpan" id="kobo.404.1">500</span></span><span class="koboSpan" id="kobo.405.1">&amp;sort=price_asc
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.406.1">
     It should return something like the following:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.407.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.408.1">"data"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.409.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.410.1">[</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.411.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.412.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.413.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.414.1">101</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.415.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.416.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.417.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.418.1">"Smartphone Model X"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.419.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.420.1">"category"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.421.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.422.1">"electronics"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.423.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.424.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.425.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.426.1">250.00</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.427.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.428.1">"available"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.429.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.430.1">true</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.431.1">},</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.432.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.433.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.434.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.435.1">102</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.436.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.437.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.438.1">name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.439.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.440.1">"Wireless Earbuds"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.441.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.442.1">"category"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.443.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.444.1">"electronics"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.445.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.446.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.447.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.448.1">120.00</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.449.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.450.1">"available"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.451.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.452.1">true</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.453.1">}</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.454.1">// Additional products...</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.455.1">],</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.456.1">"pagination"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.457.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.458.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.459.1">"totalItems"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.460.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.461.1">42</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.462.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.463.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.464.1">totalPages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.465.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.466.1">5</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.467.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.468.1">"currentPage"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.469.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.470.1">2</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.471.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.472.1">"pageSize"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.473.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.474.1">10</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.475.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.476.1">}</span></span>
</code></pre>
   <h3 class="heading-3" id="_idParaDest-134">
    <a id="_idTextAnchor145">
    </a>
    <span class="koboSpan" id="kobo.477.1">
     Best practices when paginating and filtering
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.478.1">
     Let’s take
    </span>
    <a id="_idIndexMarker363">
    </a>
    <span class="koboSpan" id="kobo.479.1">
     a look at some of the best practices to follow when paginating and filtering:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.480.1">
       Use clear and intuitive parameter names
      </span>
     </strong>
     <span class="koboSpan" id="kobo.481.1">
      : The parameter names, such as
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.482.1">
       page
      </span>
     </code>
     <span class="koboSpan" id="kobo.483.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.484.1">
       limit
      </span>
     </code>
     <span class="koboSpan" id="kobo.485.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.486.1">
       category
      </span>
     </code>
     <span class="koboSpan" id="kobo.487.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.488.1">
       priceMin
      </span>
     </code>
     <span class="koboSpan" id="kobo.489.1">
      , and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.490.1">
       priceMax
      </span>
     </code>
     <span class="koboSpan" id="kobo.491.1">
      , should be simple, self-explanatory, and aligned with common API design conventions, making the endpoint easy to use and understand.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.492.1">
       Apply input validation and sanitization
      </span>
     </strong>
     <span class="koboSpan" id="kobo.493.1">
      : The API validates all parameters to ensure they are correctly formatted.
     </span>
     <span class="koboSpan" id="kobo.493.2">
      For instance,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.494.1">
       page
      </span>
     </code>
     <span class="koboSpan" id="kobo.495.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.496.1">
       limit
      </span>
     </code>
     <span class="koboSpan" id="kobo.497.1">
      must be integers, while
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.498.1">
       priceMin
      </span>
     </code>
     <span class="koboSpan" id="kobo.499.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.500.1">
       priceMax
      </span>
     </code>
     <span class="koboSpan" id="kobo.501.1">
      must be decimal numbers.
     </span>
     <span class="koboSpan" id="kobo.501.2">
      Additionally, the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.502.1">
       sort
      </span>
     </code>
     <span class="koboSpan" id="kobo.503.1">
      parameter only accepts specific values, preventing injection attacks and typos.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.504.1">
       Apply default limits and constraints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.505.1">
      : In our example, a default limit of 10 items per page is applied, and the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.506.1">
       limit
      </span>
     </code>
     <span class="koboSpan" id="kobo.507.1">
      parameter cannot exceed
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.508.1">
       100
      </span>
     </code>
     <span class="koboSpan" id="kobo.509.1">
      .
     </span>
     <span class="koboSpan" id="kobo.509.2">
      These measures protect the server from handling overly large requests, enhancing performance and preventing abuse.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.510.1">
       Employ consistent naming and metadata
      </span>
     </strong>
     <span class="koboSpan" id="kobo.511.1">
      : The response includes metadata—
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.512.1">
       page
      </span>
     </code>
     <span class="koboSpan" id="kobo.513.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.514.1">
       limit
      </span>
     </code>
     <span class="koboSpan" id="kobo.515.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.516.1">
       totalPages
      </span>
     </code>
     <span class="koboSpan" id="kobo.517.1">
      , and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.518.1">
       totalItems
      </span>
     </code>
     <span class="koboSpan" id="kobo.519.1">
      —that provides clients with essential information about the pagination state, ensuring a standardized and predictable experience.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.520.1">
       Combine pagination and filtering
      </span>
     </strong>
     <span class="koboSpan" id="kobo.521.1">
      : This example demonstrates how pagination and filtering work together.
     </span>
     <span class="koboSpan" id="kobo.521.2">
      The client can specify page numbers and filters simultaneously, allowing them to retrieve exactly the data they need without overloading the server or client with unnecessary information.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.522.1">
     By applying these best practices, the API achieves a balance of flexibility, performance, and user-friendliness, ensuring that clients can access data efficiently while maintaining robust, scalable API design.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.523.1">
     With pagination and filtering, we have seen how to manage large datasets efficiently by selectively retrieving information.
    </span>
    <span class="koboSpan" id="kobo.523.2">
     However, in many applications, handling data is not limited to managing
    </span>
    <a id="_idIndexMarker364">
    </a>
    <span class="koboSpan" id="kobo.524.1">
     structured information alone.
    </span>
    <span class="koboSpan" id="kobo.524.2">
     Often, APIs need to support the uploading and downloading of files, allowing clients to transfer data in formats such as images, documents, and reports.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.525.1">
     In the next section, we will dive into best practices and techniques for handling file uploads and downloads via REST APIs.
    </span>
    <span class="koboSpan" id="kobo.525.2">
     These strategies will help ensure secure, reliable file transfers that integrate smoothly with the rest of the API.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-135">
    <a id="_idTextAnchor146">
    </a>
    <span class="koboSpan" id="kobo.526.1">
     Uploading and downloading files via the REST API
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.527.1">
     Web applications often need to support file uploads and downloads.
    </span>
    <span class="koboSpan" id="kobo.527.2">
     This functionality is usually accompanied
    </span>
    <a id="_idIndexMarker365">
    </a>
    <span class="koboSpan" id="kobo.528.1">
     by additional requirements, such as validating file types, names, and maximum sizes, determining optimal storage solutions, providing
    </span>
    <a id="_idIndexMarker366">
    </a>
    <span class="koboSpan" id="kobo.529.1">
     meaningful responses, and handling large files efficiently through streaming.
    </span>
    <span class="koboSpan" id="kobo.529.2">
     In this section, we will discuss these common topics in detail.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.530.1">
     When designing
    </span>
    <a id="_idIndexMarker367">
    </a>
    <span class="koboSpan" id="kobo.531.1">
     controllers to handle file uploads, it is essential
    </span>
    <a id="_idIndexMarker368">
    </a>
    <span class="koboSpan" id="kobo.532.1">
     to ensure that the parameter for the uploaded file is defined using the Spring Web interface, that is, the Spring Boot interface that represents an uploaded file in a multi-part request—
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.533.1">
      org.springframework.web.multipart.MultipartFile
     </span>
    </code>
    <span class="koboSpan" id="kobo.534.1">
     .
    </span>
    <span class="koboSpan" id="kobo.534.2">
     Additionally, the request must have its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.535.1">
      Content-Type
     </span>
    </code>
    <span class="koboSpan" id="kobo.536.1">
     set to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.537.1">
      multipart/form-data
     </span>
    </code>
    <span class="koboSpan" id="kobo.538.1">
     , the standard format used by web browsers for uploading files, so this format is also expected by an API service using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.539.1">
      MultipartFile
     </span>
    </code>
    <span class="koboSpan" id="kobo.540.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.541.1">
     We can demonstrate the upload and download functionality by adding a subresource,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.542.1">
      /products/{productId}/photo
     </span>
    </code>
    <span class="koboSpan" id="kobo.543.1">
     , to our example Product API, which will represent a photo image of the product.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.544.1">
     The following is an example HTTP request and method to upload a single file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.545.1">curl -X </span><span class="hljs-variable"><span class="koboSpan" id="kobo.546.1">PUT</span></span><span class="koboSpan" id="kobo.547.1"> -F </span><span class="hljs-string"><span class="koboSpan" id="kobo.548.1">"file=@C:/path/of/your/file.jpeg"</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.549.1">http://localhost:8080/api/products/AK12345/photo</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.550.1">// Single file upload Controller Method</span></span><span class="koboSpan" id="kobo.551.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.552.1">PutMapping</span></span><span class="koboSpan" id="kobo.553.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.554.1">"/{productId}/photo"</span></span><span class="koboSpan" id="kobo.555.1">)
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.556.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.557.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.558.1">String</span></span><span class="koboSpan" id="kobo.559.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.560.1">uploadProductPhoto</span></span><span class="koboSpan" id="kobo.561.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.562.1">@PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.563.1">"productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.564.1">) @ValidSku </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.565.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.566.1"> productId,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.567.1">@RequestParam(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.568.1">"file"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.569.1">) MultipartFile file</span></span><span class="koboSpan" id="kobo.570.1">) {
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.571.1">// Implementation logic </span></span><span class="koboSpan" id="kobo.572.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.573.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.574.1">
      multipart/form-data
     </span>
    </code>
    <span class="koboSpan" id="kobo.575.1">
     format represents a form that can contain multiple fields.
    </span>
    <span class="koboSpan" id="kobo.575.2">
     It is also possible
    </span>
    <a id="_idIndexMarker369">
    </a>
    <span class="koboSpan" id="kobo.576.1">
     to use it to upload multiple files in one request.
    </span>
    <span class="koboSpan" id="kobo.576.2">
     This is why the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.577.1">
      "file"
     </span>
    </code>
    <span class="koboSpan" id="kobo.578.1">
     parameter name in the preceding example is important for identifying the file
    </span>
    <a id="_idIndexMarker370">
    </a>
    <span class="koboSpan" id="kobo.579.1">
     our code wants to work with.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.580.1">
     The following
    </span>
    <a id="_idIndexMarker371">
    </a>
    <span class="koboSpan" id="kobo.581.1">
     is an example HTTP request:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.582.1">curl -X POST -F "file=@C:/path/of/your/file1.txt" -F "file=@C:/path/of/your/file2.txt" http://localhost:8080/uploads
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.583.1">
     And the following is the method to upload multiple files:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.584.1">// Multiple files upload Controller Method
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.585.1">PostMapping</span></span><span class="koboSpan" id="kobo.586.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.587.1">"/uploads"</span></span><span class="koboSpan" id="kobo.588.1">)
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.589.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.590.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.591.1">String</span></span><span class="koboSpan" id="kobo.592.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.593.1">uploadFiles</span></span><span class="koboSpan" id="kobo.594.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.595.1">@RequestParam(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.596.1">"files"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.597.1">) MultipartFile[] files</span></span><span class="koboSpan" id="kobo.598.1">) {
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.599.1">// Implementation logic </span></span><span class="koboSpan" id="kobo.600.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.601.1">
     Our example code
    </span>
    <a id="_idIndexMarker372">
    </a>
    <span class="koboSpan" id="kobo.602.1">
     stores the uploaded file content as a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.603.1">
      large object
     </span>
    </strong>
    <span class="koboSpan" id="kobo.604.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.605.1">
      LOB
     </span>
    </strong>
    <span class="koboSpan" id="kobo.606.1">
     ) in the relational database for simplicity.
    </span>
    <span class="koboSpan" id="kobo.606.2">
     Relational databases are not optimized for this kind of data, so in large-scale systems, other types of storage are commonly used.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.607.1">
     The file could be saved in an external storage provider, such as AWS S3.
    </span>
    <span class="koboSpan" id="kobo.607.2">
     This cloud-based storage solution efficiently manages files, providing a link for accessing the stored content.
    </span>
    <span class="koboSpan" id="kobo.607.3">
     This approach is increasingly popular in the industry as it optimizes resource management and leverages the scalability of cloud infrastructure.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.608.1">
     By saving files in cloud data storage and exposing only the link through the API, developers can avoid loading large resources directly.
    </span>
    <span class="koboSpan" id="kobo.608.2">
     This not only enhances performance but also improves response times for clients, allowing them to retrieve files as needed without overloading the API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.609.1">
     In the
    </span>
    <a id="_idIndexMarker373">
    </a>
    <span class="koboSpan" id="kobo.610.1">
     preceding examples, the API returns a string in the response, so the returned string could be used to pass the cloud storage URL.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.611.1">
     It is advisable
    </span>
    <a id="_idIndexMarker374">
    </a>
    <span class="koboSpan" id="kobo.612.1">
     to validate uploaded files to ensure security, data integrity, and performance.
    </span>
    <span class="koboSpan" id="kobo.612.2">
     Some of the possible validations are described in the following section.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-136">
    <a id="_idTextAnchor147">
    </a>
    <span class="koboSpan" id="kobo.613.1">
     Validating the uploaded files
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.614.1">
     The validation
    </span>
    <a id="_idIndexMarker375">
    </a>
    <span class="koboSpan" id="kobo.615.1">
     step is critical not only for RESTful APIs but also for any system that you may be developing, to maintain the integrity and security of your application.
    </span>
    <span class="koboSpan" id="kobo.615.2">
     The inputs you receive can make the application vulnerable to several distinct kinds of attacks.
    </span>
    <span class="koboSpan" id="kobo.615.3">
     Let us see some examples of important validations to be performed when uploading files.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.616.1">
     Validating the file content type
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.617.1">
     Accepting files of only a certain type would be a good measure to avoid receiving malicious files or even
    </span>
    <a id="_idIndexMarker376">
    </a>
    <span class="koboSpan" id="kobo.618.1">
     data that does not comply with the data you need to store.
    </span>
    <span class="koboSpan" id="kobo.618.2">
     In the following example, you ensure that you will only receive PNG and JPEG files:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.619.1">private static final List&lt;String&gt; ALLOWED_CONTENT_TYPES = List.of("image/png", "image/jpeg");
</span><span class="hljs-title"><span class="koboSpan" id="kobo.620.1">String</span></span><span class="koboSpan" id="kobo.621.1"> contentType = file.</span><span class="hljs-title"><span class="koboSpan" id="kobo.622.1">getContentType</span></span><span class="koboSpan" id="kobo.623.1">();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.624.1">if</span></span><span class="koboSpan" id="kobo.625.1"> (!</span><span class="hljs-variable"><span class="koboSpan" id="kobo.626.1">ALLOWED_CONTENT_TYPES</span></span><span class="koboSpan" id="kobo.627.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.628.1">contains</span></span><span class="koboSpan" id="kobo.629.1">(contentType)) {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.630.1">// report error using the 415 HTTP status code (Unsupported Media Type)</span></span><span class="koboSpan" id="kobo.631.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.632.1">
     Please note that the content type of the whole HTTP request body will be
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.633.1">
      multipart/form-data
     </span>
    </code>
    <span class="koboSpan" id="kobo.634.1">
     , but each of the files it contains also has its own content type.
    </span>
    <span class="koboSpan" id="kobo.634.2">
     This is why we need to check the content type using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.635.1">
      getContentType
     </span>
    </code>
    <span class="koboSpan" id="kobo.636.1">
     method of the particular
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.637.1">
      MultipartFile
     </span>
    </code>
    <span class="koboSpan" id="kobo.638.1">
     object we are going to process.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.639.1">
     Besides the content of the file, our example Product API stores the content type of the uploaded file.
    </span>
    <span class="koboSpan" id="kobo.639.2">
     The same content type is returned by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.640.1">
      GET
     </span>
    </code>
    <span class="koboSpan" id="kobo.641.1">
     endpoint when the file is downloaded.
    </span>
    <span class="koboSpan" id="kobo.641.2">
     Without the correct
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.642.1">
      Content-Type
     </span>
    </code>
    <span class="koboSpan" id="kobo.643.1">
     header, opening the URL in a web browser would display gibberish because the browser would not know how to interpret the downloaded file bytes.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.644.1">
     Validating the file size
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.645.1">
     Validating the size of a file is a measure to avoid processing files that are bigger than expected, which can
    </span>
    <a id="_idIndexMarker377">
    </a>
    <span class="koboSpan" id="kobo.646.1">
     cause denial of service by exhaustion of memory due to the overloading of the system with excessively large files, irrespective of whether the upload is intentional or not.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.647.1">
     We can check the file size programmatically
    </span>
    <a id="_idTextAnchor148">
    </a>
    <span class="koboSpan" id="kobo.648.1">
     using the respective method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.649.1">
      MultipartFile
     </span>
    </code>
    <span class="koboSpan" id="kobo.650.1">
     class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.651.1">private </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.652.1">static</span></span><span class="koboSpan" id="kobo.653.1"> final long </span><span class="hljs-variable"><span class="koboSpan" id="kobo.654.1">MAX_FILE_SIZE</span></span><span class="koboSpan" id="kobo.655.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.656.1">10</span></span><span class="koboSpan" id="kobo.657.1"> * </span><span class="hljs-number"><span class="koboSpan" id="kobo.658.1">1024</span></span><span class="koboSpan" id="kobo.659.1"> * </span><span class="hljs-number"><span class="koboSpan" id="kobo.660.1">1024</span></span><span class="koboSpan" id="kobo.661.1">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.662.1">// 10 MB</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.663.1">if</span></span><span class="koboSpan" id="kobo.664.1"> (file.</span><span class="hljs-title"><span class="koboSpan" id="kobo.665.1">getSize</span></span><span class="koboSpan" id="kobo.666.1">() &gt; </span><span class="hljs-variable"><span class="koboSpan" id="kobo.667.1">MAX_FILE_SIZE</span></span><span class="koboSpan" id="kobo.668.1">) { 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.669.1">  throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.670.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.671.1">FileSizeLimitExceededException</span></span><span class="koboSpan" id="kobo.672.1">(
</span><span class="hljs-keyword">    </span><span class="hljs-string"><span class="koboSpan" id="kobo.673.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.674.1">File size exceeds the allowable limit of 10 MB."</span></span><span class="koboSpan" id="kobo.675.1">); 
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.676.1">
     File uploads are also limited for the whole application by Spring configuration properties specifying the maximum acceptable multipart request size and the maximum size of one file within such a request.
    </span>
    <span class="koboSpan" id="kobo.676.2">
     You can set the properties in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.677.1">
      application.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.678.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.679.1">
      application.properties
     </span>
    </code>
    <span class="koboSpan" id="kobo.680.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.681.1">spring.servlet.multipart.max-file-size=10MB</span></span> 
<span class="hljs-string"><span class="koboSpan" id="kobo.682.1">spring.servlet.multipart.max-request-size=10MB</span></span>
</code></pre>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.683.1">
     Validating filenames
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.684.1">
     To improve file upload security on your server, validating filenames is essential to prevent attacks such
    </span>
    <a id="_idIndexMarker378">
    </a>
    <span class="koboSpan" id="kobo.685.1">
     as path traversal, where attackers attempt to access restricted areas on your server’s filesystem.
    </span>
    <span class="koboSpan" id="kobo.685.2">
     For example, an attacker might use a filename such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.686.1">
      ../../etc/passwd
     </span>
    </code>
    <span class="koboSpan" id="kobo.687.1">
     to try to access sensitive files outside the intended upload directory.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.688.1">
     Path traversal attacks can be particularly dangerous in file uploads.
    </span>
    <span class="koboSpan" id="kobo.688.2">
     By manipulating the file path, an attacker may exploit weak validation to save files in unintended locations on the server, potentially leading to the exposure of sensitive data or even overwriting critical files.
    </span>
    <span class="koboSpan" id="kobo.688.3">
     For example, if the server directly appends a user-provided filename to an upload path, an attacker could use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.689.1">
      ../
     </span>
    </code>
    <span class="koboSpan" id="kobo.690.1">
     sequences to navigate up the directory structure, allowing them to access or modify restricted files.
    </span>
    <span class="koboSpan" id="kobo.690.2">
     This is why validation is crucial when handling file paths, especially in upload scenarios.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.691.1">
     While there are several ways to prevent path traversal attacks, here are some effective strategies:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.692.1">
       Set user and file permissions carefully
      </span>
     </strong>
     <span class="koboSpan" id="kobo.693.1">
      : Restrict permissions to limit access only to necessary users and directories.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.694.1">
       Store files separately
      </span>
     </strong>
     <span class="koboSpan" id="kobo.695.1">
      : Consider storing uploaded files on a different server or in a secure storage service such as AWS S3.
     </span>
     <span class="koboSpan" id="kobo.695.2">
      By keeping files off the main server, you reduce the risk of unauthorized access to your system’s file structure.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.696.1">
       Validate the file path
      </span>
     </strong>
     <span class="koboSpan" id="kobo.697.1">
      : Ensure that the file path points to a specific folder that is expected for the files to be sent.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.698.1">
       Use secure file upload resolvers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.699.1">
      : In Spring, classes such as
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.700.1">
       CommonsMultipartResolver
      </span>
     </code>
     <span class="koboSpan" id="kobo.701.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.702.1">
       StandardServletMultipartResolver
      </span>
     </code>
     <span class="koboSpan" id="kobo.703.1">
      , as resolvers, are responsible for resolving or interpreting multipart data within a request and help manage file uploads securely.
     </span>
     <span class="koboSpan" id="kobo.703.2">
      They separate file parts from other form data
     </span>
     <a id="_idIndexMarker379">
     </a>
     <span class="koboSpan" id="kobo.704.1">
      and make them accessible as
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.705.1">
       MultipartFile
      </span>
     </code>
     <span class="koboSpan" id="kobo.706.1">
      objects within Spring’s request-handling framework.
     </span>
     <span class="koboSpan" id="kobo.706.2">
      Both of these classes are responsible for parsing multipart file requests, which are commonly used in file uploads.
     </span>
     <span class="koboSpan" id="kobo.706.3">
      They handle the file data separately from user input, which helps prevent injection attacks:
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.707.1">
       CommonsMultipartResolver
      </span>
     </strong>
     <span class="koboSpan" id="kobo.708.1">
      : This class, part of the Apache Commons
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.709.1">
       FileUpload
      </span>
     </code>
     <span class="koboSpan" id="kobo.710.1">
      library, allows you to configure file size limits and temporary storage directories.
     </span>
     <span class="koboSpan" id="kobo.710.2">
      It offers flexibility for applications that require strict control over file storage and performance.
     </span>
     <span class="koboSpan" id="kobo.710.3">
      By setting up limits and constraints through
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.711.1">
       CommonsMultipartResolver
      </span>
     </code>
     <span class="koboSpan" id="kobo.712.1">
      , you can mitigate risks such as excessive file uploads or unauthorized access to temporary storage.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.713.1">
       StandardServletMultipartResolver
      </span>
     </strong>
     <span class="koboSpan" id="kobo.714.1">
      : This is a resolver in Spring that leverages the built-in multipart support provided by Servlet 3.0, making it a reliable and efficient choice for handling file uploads in Spring applications.
     </span>
     <span class="koboSpan" id="kobo.714.2">
      By relying on the servlet container’s native multipart processing, this resolver avoids the need for additional libraries, simplifying setup and maintenance.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.715.1">
     These resolvers not only simplify file handling but also help mitigate potential security vulnerabilities by handling multipart file requests in a standardized way.
    </span>
    <span class="koboSpan" id="kobo.715.2">
     This ensures that files are processed according to predefined rules, which reduces the risk of path traversal and other injection attacks.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.716.1">
     When working with files stored on your application’s server, remember not to rely solely on methods such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.717.1">
      StringUtils.cleanPath
     </span>
    </code>
    <span class="koboSpan" id="kobo.718.1">
     .
    </span>
    <span class="koboSpan" id="kobo.718.2">
     Although commonly used, it should not be the only security measure because it does not fully protect against path traversal.
    </span>
    <span class="koboSpan" id="kobo.718.3">
     As noted in the Spring documentation (v6.1.12), “
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.719.1">
      cleanPath
     </span>
    </code>
    <em class="italic">
     <span class="koboSpan" id="kobo.720.1">
      should not be depended upon in a security context
     </span>
    </em>
    <span class="koboSpan" id="kobo.721.1">
     .”
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.722.1">
     To enhance
    </span>
    <a id="_idIndexMarker380">
    </a>
    <span class="koboSpan" id="kobo.723.1">
     filename sanitization, you can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.724.1">
      FilenameUtils
     </span>
    </code>
    <span class="koboSpan" id="kobo.725.1">
     class from the Apache Commons IO library.
    </span>
    <span class="koboSpan" id="kobo.725.2">
     This utility class provides methods to manipulate and sanitize filenames safely.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.726.1">
     Here are some examples of codes that would help to cover some file upload validations:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.727.1">// Extract the base name of the file, removing any path information</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.728.1">String</span></span><span class="koboSpan" id="kobo.729.1"> sanitizedFilename = </span><span class="hljs-title"><span class="koboSpan" id="kobo.730.1">FilenameUtils</span></span><span class="koboSpan" id="kobo.731.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.732.1">getName</span></span><span class="koboSpan" id="kobo.733.1">(originalFilename);
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.734.1">// Enforce character restrictions</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.735.1">if</span></span><span class="koboSpan" id="kobo.736.1"> (!sanitizedFilename.</span><span class="hljs-title"><span class="koboSpan" id="kobo.737.1">matches</span></span><span class="koboSpan" id="kobo.738.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.739.1">"^[a-zA-Z0-9._-]+$"</span></span><span class="koboSpan" id="kobo.740.1">)) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.742.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.743.1">SecurityException</span></span><span class="koboSpan" id="kobo.744.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.745.1">"Invalid characters in file name."</span></span><span class="koboSpan" id="kobo.746.1">);
}
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.747.1">// Limit file name length</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.748.1">if</span></span><span class="koboSpan" id="kobo.749.1"> (sanitizedFilename.</span><span class="hljs-title"><span class="koboSpan" id="kobo.750.1">length</span></span><span class="koboSpan" id="kobo.751.1">() &gt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.752.1">100</span></span><span class="koboSpan" id="kobo.753.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.754.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.755.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.756.1">SecurityException</span></span><span class="koboSpan" id="kobo.757.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.758.1">"File name too long."</span></span><span class="koboSpan" id="kobo.759.1">);
}
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.760.1">// Check allowed extensions</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.761.1">List</span></span><span class="koboSpan" id="kobo.762.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.763.1">String</span></span><span class="koboSpan" id="kobo.764.1">&gt; allowedExtensions = </span><span class="hljs-title"><span class="koboSpan" id="kobo.765.1">Arrays</span></span><span class="koboSpan" id="kobo.766.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.767.1">asList</span></span><span class="koboSpan" id="kobo.768.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.769.1">"jpg"</span></span><span class="koboSpan" id="kobo.770.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.771.1">"png"</span></span><span class="koboSpan" id="kobo.772.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.773.1">"pdf"</span></span><span class="koboSpan" id="kobo.774.1">);
</span><span class="hljs-title"><span class="koboSpan" id="kobo.775.1">String</span></span><span class="koboSpan" id="kobo.776.1"> extension = </span><span class="hljs-title"><span class="koboSpan" id="kobo.777.1">FilenameUtils</span></span><span class="koboSpan" id="kobo.778.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.779.1">getExtension</span></span><span class="koboSpan" id="kobo.780.1">(sanitizedFilename);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.781.1">if</span></span><span class="koboSpan" id="kobo.782.1"> (!allowedExtensions.</span><span class="hljs-title"><span class="koboSpan" id="kobo.783.1">contains</span></span><span class="koboSpan" id="kobo.784.1">(extension.</span><span class="hljs-title"><span class="koboSpan" id="kobo.785.1">toLowerCase</span></span><span class="koboSpan" id="kobo.786.1">())) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.787.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.788.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.789.1">SecurityException</span></span><span class="koboSpan" id="kobo.790.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.791.1">"File type not allowed."</span></span><span class="koboSpan" id="kobo.792.1">);
}
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.793.1">// Avoid leading dots and double extensions</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.794.1">if</span></span><span class="koboSpan" id="kobo.795.1"> (sanitizedFilename.</span><span class="hljs-title"><span class="koboSpan" id="kobo.796.1">startsWith</span></span><span class="koboSpan" id="kobo.797.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.798.1">"."</span></span><span class="koboSpan" id="kobo.799.1">) || sanitizedFilename.</span><span class="hljs-title"><span class="koboSpan" id="kobo.800.1">contains</span></span><span class="koboSpan" id="kobo.801.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.802.1">".."</span></span><span class="koboSpan" id="kobo.803.1">)) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.804.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.805.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.806.1">SecurityException</span></span><span class="koboSpan" id="kobo.807.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.808.1">"Invalid file name format."</span></span><span class="koboSpan" id="kobo.809.1">);
}
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.810.1">// Ensure path is within the intended directory</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.811.1">Path</span></span><span class="koboSpan" id="kobo.812.1"> targetPath = </span><span class="hljs-title"><span class="koboSpan" id="kobo.813.1">Paths</span></span><span class="koboSpan" id="kobo.814.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.815.1">get</span></span><span class="koboSpan" id="kobo.816.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.817.1">"/uploads/"</span></span><span class="koboSpan" id="kobo.818.1">)
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.819.1">resolve</span></span><span class="koboSpan" id="kobo.820.1">(sanitizedFilename)
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.821.1">normalize</span></span><span class="koboSpan" id="kobo.822.1">();
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.823.1">if</span></span><span class="koboSpan" id="kobo.824.1"> (!targetPath.</span><span class="hljs-title"><span class="koboSpan" id="kobo.825.1">startsWith</span></span><span class="koboSpan" id="kobo.826.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.827.1">"/uploads/"</span></span><span class="koboSpan" id="kobo.828.1">)) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.829.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.831.1">SecurityException</span></span><span class="koboSpan" id="kobo.832.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.833.1">"Invalid file path."</span></span><span class="koboSpan" id="kobo.834.1">);
}
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.835.1">// Optionally, add a unique prefix to avoid conflicts</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.836.1">String</span></span><span class="koboSpan" id="kobo.837.1"> uniqueFileName = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.838.1">UUID</span></span><span class="koboSpan" id="kobo.839.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.840.1">randomUUID</span></span><span class="koboSpan" id="kobo.841.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.842.1">toString</span></span><span class="koboSpan" id="kobo.843.1">() + </span><span class="hljs-string"><span class="koboSpan" id="kobo.844.1">"_"</span></span><span class="koboSpan" id="kobo.845.1"> + sanitizedFilename;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.846.1">
     This approach
    </span>
    <a id="_idIndexMarker381">
    </a>
    <span class="koboSpan" id="kobo.847.1">
     provides a thorough sanitization and validation of filenames, ensuring that they do the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.848.1">
      Conform to expected characters and formats
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.849.1">
      Have reasonable length limits
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.850.1">
      Are restricted to allowed file types
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.851.1">
      Are stored only within the intended directory
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.852.1">
      Are optionally assigned a unique name to prevent conflicts
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.853.1">
     By combining these security measures and utilizing
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.854.1">
      FilenameUtils
     </span>
    </code>
    <span class="koboSpan" id="kobo.855.1">
     for safe file name manipulation, you can ensure that file uploads remain secure.
    </span>
    <span class="koboSpan" id="kobo.855.2">
     This reduces the chance of path traversal attacks and protects your application from unauthorized access.
    </span>
    <span class="koboSpan" id="kobo.855.3">
     Even if your application stores files on a service such as AWS S3, validating filenames contributes to a consistent, secure, and user-friendly experience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.856.1">
     Using storage services such as AWS S3 can simplify file upload handling by offloading certain security concerns from your application server.
    </span>
    <span class="koboSpan" id="kobo.856.2">
     Since S3 and similar services store files in a managed environment separate from your server’s filesystem, they reduce the risk of path traversal attacks, where an attacker might attempt to save or access files in unauthorized locations.
    </span>
    <span class="koboSpan" id="kobo.856.3">
     By isolating storage, these services protect your core infrastructure from direct interaction with uploaded files, reducing the potential impact of improperly validated file paths or names.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.857.1">
     Additionally, AWS S3 automatically generates unique URLs or identifiers for uploaded files, which minimizes the need for name conflict resolution and additional filename validation.
    </span>
    <span class="koboSpan" id="kobo.857.2">
     S3 enforces secure naming conventions and ensures that uploaded files are stored safely without affecting other areas of your application.
    </span>
    <span class="koboSpan" id="kobo.857.3">
     This means your application can focus on verifying basic attributes, such as file type or size, without worrying as much about path traversal or directory restrictions, streamlining the file upload process and enhancing overall security.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.858.1">
     After implementing thorough validation to secure filenames and mitigate risks such as path traversal attacks, it is crucial to consider how our API communicates the outcome of the file upload process.
    </span>
    <span class="koboSpan" id="kobo.858.2">
     Providing clear, meaningful responses ensures that clients are informed about the status of their upload attempts, whether successful or not.
    </span>
    <span class="koboSpan" id="kobo.858.3">
     Effective responses do more than
    </span>
    <a id="_idIndexMarker382">
    </a>
    <span class="koboSpan" id="kobo.859.1">
     acknowledge success—they also guide users when an error occurs, helping them understand what went wrong and how to correct it.
    </span>
    <span class="koboSpan" id="kobo.859.2">
     By returning specific HTTP status codes and relevant metadata, we can make the file upload process more transparent, reliable, and user-friendly.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-137">
    <a id="_idTextAnchor149">
    </a>
    <span class="koboSpan" id="kobo.860.1">
     Providing meaningful responses on our API service for file upload
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.861.1">
     Provide
    </span>
    <a id="_idIndexMarker383">
    </a>
    <span class="koboSpan" id="kobo.862.1">
     clear feedback to the client regarding the result of the upload by using appropriate HTTP status codes:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.863.1">
       201 Created
      </span>
     </code>
     <span class="koboSpan" id="kobo.864.1">
      : When a file is successfully uploaded
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.865.1">
       415 Unsupported Media Type
      </span>
     </code>
     <span class="koboSpan" id="kobo.866.1">
      : For invalid file types
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.867.1">
       413 Payload Too Large
      </span>
     </code>
     <span class="koboSpan" id="kobo.868.1">
      : If the file size exceeds the allowed limit
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.869.1">
       400 Bad Request
      </span>
     </code>
     <span class="koboSpan" id="kobo.870.1">
      : For other validation errors
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.871.1">
     Include metadata in the response, such as the file URL or identifier for future downloads.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.872.1">
     After covering these fundamental yet essential details and highlighting specific precautions for handling files within your API, it becomes clear that even seemingly minor implementations can lead to potential vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.872.2">
     Such weaknesses may act as critical points of failure, potentially destabilizing the entire API.
    </span>
    <span class="koboSpan" id="kobo.872.3">
     For instance, a single malformed file could disrupt API operations, or an attack exploiting file-naming conventions might provide an entry point for malicious actors.
    </span>
    <span class="koboSpan" id="kobo.872.4">
     The intention of covering this topic was to call your attention to these scenarios that you may encounter when dealing with files on your API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.873.1">
     Earlier in this chapter, we introduced HATEOAS while discussing pagination to demonstrate how hypermedia links can enhance navigation through large datasets.
    </span>
    <span class="koboSpan" id="kobo.873.2">
     Now, we’ll explore HATEOAS in greater detail as it represents a broader architectural pattern that goes beyond pagination, offering a more sophisticated approach to API interaction and resource discovery.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-138">
    <a id="_idTextAnchor150">
    </a>
    <span class="koboSpan" id="kobo.874.1">
     HATEOAS
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.875.1">
     HATEOAS, as mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.876.1">
      Pagination
     </span>
    </em>
    <span class="koboSpan" id="kobo.877.1">
     section, is a key principle of RESTful APIs that improves the
    </span>
    <a id="_idIndexMarker384">
    </a>
    <span class="koboSpan" id="kobo.878.1">
     client’s interaction by including navigational links within the response.
    </span>
    <span class="koboSpan" id="kobo.878.2">
     These hyperlinks guide the client on how to access related resources without needing prior knowledge of the API structure.
    </span>
    <span class="koboSpan" id="kobo.878.3">
     As we saw before, in a paginated response, HATEOAS can provide links to the next and previous pages, enabling smooth navigation through data without requiring hardcoded logic.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.879.1">
     By using HATEOAS, APIs become more self-explanatory and adaptable to changes.
    </span>
    <span class="koboSpan" id="kobo.879.2">
     Clients can discover available actions, such as editing or deleting, directly from the response, based on the provided links.
    </span>
    <span class="koboSpan" id="kobo.879.3">
     This simplifies API usage and ensures flexibility, as clients do not have to rely on external documentation to understand the API’s behavior, reducing the chance of errors when updates occur.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.880.1">
     Let us see
    </span>
    <a id="_idIndexMarker385">
    </a>
    <span class="koboSpan" id="kobo.881.1">
     an example of using HATEOAS to expose available operations on a resource:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.882.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.883.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.884.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.885.1">123</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.886.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.887.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.888.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.889.1">"John Doe"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.890.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.891.1">"email"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.892.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.893.1">"johndoe@example.com"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.894.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.895.1">"links"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.896.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.897.1">[</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.898.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.899.1">"rel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.900.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.901.1">"self"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.902.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.903.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.904.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.905.1">"/users/123"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.906.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.907.1">"method"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.908.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.909.1">"GET"</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.910.1">},</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.911.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.912.1">"rel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.913.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.914.1">"edit"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.915.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.916.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.917.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.918.1">"/users/123"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.919.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.920.1">"method"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.921.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.922.1">"PUT"</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.923.1">},</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.924.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.925.1">"rel"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.926.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.927.1">"delete"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.928.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.929.1">"href"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.930.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.931.1">"/users/123"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.932.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.933.1">"method"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.934.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.935.1">"DELETE"</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.936.1">}</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.937.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.938.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.939.1">
     In the preceding example, the response contains three elements in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.940.1">
      links
     </span>
    </code>
    <span class="koboSpan" id="kobo.941.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.941.2">
     The first element,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.942.1">
      "rel": "self"
     </span>
    </code>
    <span class="koboSpan" id="kobo.943.1">
     , indicates the link to the current resource itself.
    </span>
    <span class="koboSpan" id="kobo.943.2">
     This allows the client to retrieve or interact with a specific user using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.944.1">
      GET
     </span>
    </code>
    <span class="koboSpan" id="kobo.945.1">
     method at the URL provided in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.946.1">
      href
     </span>
    </code>
    <span class="koboSpan" id="kobo.947.1">
     (which stands for hypermedia reference) attribute.
    </span>
    <span class="koboSpan" id="kobo.947.2">
     The second element,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.948.1">
      "rel": "edit"
     </span>
    </code>
    <span class="koboSpan" id="kobo.949.1">
     , provides a link for updating the user’s details with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.950.1">
      PUT
     </span>
    </code>
    <span class="koboSpan" id="kobo.951.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.951.2">
     Lastly, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.952.1">
      "rel": "delete"
     </span>
    </code>
    <span class="koboSpan" id="kobo.953.1">
     element allows the client to remove the user with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.954.1">
      DELETE
     </span>
    </code>
    <span class="koboSpan" id="kobo.955.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.955.2">
     Each of these links guides the client through interactions with the resource, making the API self-explanatory and easier to use.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.956.1">
     HATEOAS, as outlined in RFC 8288, formalizes the use of web links in APIs, ensuring consistency and clarity in how these links are structured and interpreted.
    </span>
    <span class="koboSpan" id="kobo.956.2">
     This RFC defines key components such as the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.957.1">
      rel
     </span>
    </code>
    <span class="koboSpan" id="kobo.958.1">
     attribute, which specifies the relation type of a link (e.g.,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.959.1">
      "self"
     </span>
    </code>
    <span class="koboSpan" id="kobo.960.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.961.1">
      "edit"
     </span>
    </code>
    <span class="koboSpan" id="kobo.962.1">
     ), and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.963.1">
      href
     </span>
    </code>
    <span class="koboSpan" id="kobo.964.1">
     , which defines the target URL for the interaction.
    </span>
    <span class="koboSpan" id="kobo.964.2">
     By adhering to this standard, APIs become more robust, with clients able to navigate resources and perform actions without needing to hardcode endpoint paths or refer to external documentation.
    </span>
    <span class="koboSpan" id="kobo.964.3">
     This approach enhances flexibility and future-proofs API interactions, as the server can evolve while still
    </span>
    <a id="_idIndexMarker386">
    </a>
    <span class="koboSpan" id="kobo.965.1">
     maintaining compatibility with existing clients.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.966.1">
     The same example we saw before can also have a different response, where certain actions—such as deleting the element—are not available.
    </span>
    <span class="koboSpan" id="kobo.966.2">
     For instance, in the following example, the response for the user
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.967.1">
      "Jane Smith"
     </span>
    </code>
    <span class="koboSpan" id="kobo.968.1">
     does not include a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.969.1">
      "delete"
     </span>
    </code>
    <span class="koboSpan" id="kobo.970.1">
     link in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.971.1">
      links
     </span>
    </code>
    <span class="koboSpan" id="kobo.972.1">
     section:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.973.1">{
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.974.1">"id"</span></span><span class="koboSpan" id="kobo.975.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.976.1">456</span></span><span class="koboSpan" id="kobo.977.1">,
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.978.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.979.1">name"</span></span><span class="koboSpan" id="kobo.980.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.981.1">"Jane Smith"</span></span><span class="koboSpan" id="kobo.982.1">,
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.983.1">"email"</span></span><span class="koboSpan" id="kobo.984.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.985.1">"janesmith@example.com"</span></span><span class="koboSpan" id="kobo.986.1">,
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.987.1">"links"</span></span><span class="koboSpan" id="kobo.988.1">: [
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.989.1">"rel"</span></span><span class="koboSpan" id="kobo.990.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.991.1">"self"</span></span><span class="koboSpan" id="kobo.992.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.993.1">"href"</span></span><span class="koboSpan" id="kobo.994.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">"/users/456"</span></span><span class="koboSpan" id="kobo.996.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.997.1">"method"</span></span><span class="koboSpan" id="kobo.998.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.999.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1000.1">GET"</span></span><span class="koboSpan" id="kobo.1001.1">
    },
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1002.1">"rel"</span></span><span class="koboSpan" id="kobo.1003.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1004.1">"edit"</span></span><span class="koboSpan" id="kobo.1005.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1006.1">"href"</span></span><span class="koboSpan" id="kobo.1007.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1008.1">"/users/456"</span></span><span class="koboSpan" id="kobo.1009.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1010.1">"method"</span></span><span class="koboSpan" id="kobo.1011.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1012.1">"PUT"</span></span><span class="koboSpan" id="kobo.1013.1">
    }
  ]
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1014.1">
     In this case, the absence of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1015.1">
      delete
     </span>
    </code>
    <span class="koboSpan" id="kobo.1016.1">
     link indicates that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1017.1">
      delete
     </span>
    </code>
    <span class="koboSpan" id="kobo.1018.1">
     operation is not available for this resource, due to permission restrictions or business rules.
    </span>
    <span class="koboSpan" id="kobo.1018.2">
     HATEOAS helps make these limitations clear to the client, ensuring that the client does not attempt unsupported actions.
    </span>
    <span class="koboSpan" id="kobo.1018.3">
     This allows the API to dynamically control which actions are allowed, preventing misuse and guiding the client’s behavior based on the current state of the resource.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1019.1">
     To simplify the implementation of HATEOAS, modern API frameworks offer built-in tools to support this pattern.
    </span>
    <span class="koboSpan" id="kobo.1019.2">
     For example, in Spring Boot, you can leverage the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1020.1">
      spring-boot-starter-hateoas
     </span>
    </code>
    <span class="koboSpan" id="kobo.1021.1">
     dependency to easily incorporate HATEOAS into your API:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1022.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1023.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1024.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1025.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1026.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1027.1">&gt;</span></span><span class="koboSpan" id="kobo.1028.1">org.springframework.boot</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1029.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1030.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1031.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1032.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1033.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1034.1">&gt;</span></span><span class="koboSpan" id="kobo.1035.1">spring-boot-starter-hateoas</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1036.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1037.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1038.1">&gt;</span></span><span class="koboSpan" id="kobo.1039.1">
&lt;/</span><span class="hljs-name"><span class="koboSpan" id="kobo.1040.1">dependency</span></span><span class="koboSpan" id="kobo.1041.1">&gt;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1042.1">
     HATEOAS enhances the dynamism of the API, advancing it to a higher level of maturity by incorporating all the benefits we have mentioned so far.
    </span>
    <span class="koboSpan" id="kobo.1042.2">
     However, it is important to evaluate whether this resource is necessary for your use case, as HATEOAS is not a mandatory component for every API.
    </span>
    <span class="koboSpan" id="kobo.1042.3">
     It requires another dependency, additional development, and maintenance, and then requires attention to understand whether it makes sense to have it.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1043.1">
     We have covered essential practices for building a reliable and user-friendly API by employing efficient
    </span>
    <a id="_idIndexMarker387">
    </a>
    <span class="koboSpan" id="kobo.1044.1">
     data-handling techniques.
    </span>
    <span class="koboSpan" id="kobo.1044.2">
     Now, as we transition to resilience patterns, we will explore strategies that help APIs maintain stability and robustness, even in the face of unexpected challenges.
    </span>
    <span class="koboSpan" id="kobo.1044.3">
     Resilience is crucial for ensuring that an API continues to function reliably under various adverse conditions, from network issues to system overloads.
    </span>
    <span class="koboSpan" id="kobo.1044.4">
     In the upcoming section, we will dive into patterns that enable APIs to handle such scenarios gracefully, enhancing their dependability and user experience.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-139">
    <a id="_idTextAnchor151">
    </a>
    <span class="koboSpan" id="kobo.1045.1">
     Resilience
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1046.1">
     Before discussing how to make an API resilient, let’s look at the Oxford English dictionary’s definition for resilience: “
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1047.1">
      (of a person or animal) able to withstand or recover quickly from difficult conditions.
     </span>
    </em>
    <span class="koboSpan" id="kobo.1048.1">
     ” If we try to apply the same definition to our RESTful APIs or systems in general, we could
    </span>
    <a id="_idIndexMarker388">
    </a>
    <span class="koboSpan" id="kobo.1049.1">
     say that a resilient API is an API that can withstand failures and disruptions while maintaining its functionality and performance, recovering from situations that could shut it down or cause a degradation in performance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1050.1">
     To ensure that an API serves as a reliable component of a larger, robust system, it must handle excess spikes, performance degradation of services it depends on, and infrastructure failures effectively.
    </span>
    <span class="koboSpan" id="kobo.1050.2">
     For that, we need to observe several aspects of the API design that we are going to approach.
    </span>
    <span class="koboSpan" id="kobo.1050.3">
     We will explore strategies and techniques to achieve these capabilities, ensuring your APIs can deliver consistent value.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1051.1">
     Regarding API design, the key principles that we need to observe are the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1052.1">
       Redundancy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1053.1">
      : Have multiple instances of our components/services to avoid a single point of failure.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1054.1">
       Decoupling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1055.1">
      : Minimize dependencies in the design, aiming to limit impact during any system part failure.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1056.1">
      Minimize direct dependencies within a system’s design by reducing the interconnections between its components, which helps limit the impact of any single component’s failure.
     </span>
     <span class="koboSpan" id="kobo.1056.2">
      When an API is tightly coupled to other services or components, an issue in one part can cascade throughout the system, leading to widespread failures or degraded performance.
     </span>
     <span class="koboSpan" id="kobo.1056.3">
      By contrast, a decoupled system allows components to operate more independently, isolating faults and preventing them from affecting other parts.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1057.1">
       Fault isolation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1058.1">
      : Use techniques such as bulkheads and circuit breakers to confine failures to isolated parts of the system, preventing error states from propagating throughout the entire system, as would occur with a “poison pill.”
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1059.1">
       Graceful degradation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1060.1">
      : Keep limited functionality even when parts of the system fail or are underperforming.
     </span>
     <span class="koboSpan" id="kobo.1060.2">
      This way prioritizes the main functionalities, preventing the entire system from stopping.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1061.1">
     Let us list some concepts and patterns that we will talk about and the problems that each one of them can help us to solve:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1062.1">
      Timeouts
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1063.1">
      Retry mechanisms
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1064.1">
      Rate limiting and throttling
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1065.1">
      Idempotency key
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1066.1">
      Circuit breaker
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1067.1">
      Bulkhead
     </span>
    </li>
   </ul>
   <h2 class="heading-2" id="_idParaDest-140">
    <a id="_idTextAnchor152">
    </a>
    <span class="koboSpan" id="kobo.1068.1">
     Timeouts
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1069.1">
     Establishing
    </span>
    <a id="_idIndexMarker389">
    </a>
    <span class="koboSpan" id="kobo.1070.1">
     appropriate timeout settings is critical when designing APIs to ensure
    </span>
    <a id="_idIndexMarker390">
    </a>
    <span class="koboSpan" id="kobo.1071.1">
     system resilience.
    </span>
    <span class="koboSpan" id="kobo.1071.2">
     API interactions often involve synchronous remote calls between services, whether they reside on the same network or across different networks.
    </span>
    <span class="koboSpan" id="kobo.1071.3">
     This synchronous communication means that the client remains unaware of the server’s processing status, maintains the network connection, and waits until the call either succeeds or fails.
    </span>
    <span class="koboSpan" id="kobo.1071.4">
     Without well-defined timeouts, clients might experience prolonged wait times for responses, which can degrade user experience, introduce security vulnerabilities, and cause system instability or downtime.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1072.1">
     The timeout can be set from two perspectives:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1073.1">
      Client configuration
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1074.1">
      Server configuration
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-141">
    <a id="_idTextAnchor153">
    </a>
    <span class="koboSpan" id="kobo.1075.1">
     Client configuration
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1076.1">
     Configuring timeouts on the client side is essential to prevent clients from waiting indefinitely for a server
    </span>
    <a id="_idIndexMarker391">
    </a>
    <span class="koboSpan" id="kobo.1077.1">
     response.
    </span>
    <span class="koboSpan" id="kobo.1077.2">
     By setting a specific timeout duration, the client ensures that it does not become unresponsive due to delayed server replies.
    </span>
    <span class="koboSpan" id="kobo.1077.3">
     When the
    </span>
    <a id="_idIndexMarker392">
    </a>
    <span class="koboSpan" id="kobo.1078.1">
     server fails to respond within the designated timeout period, the client should do the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1079.1">
       Alert users
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1080.1">
      : Inform users about the delay to maintain transparency and manage expectations
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1081.1">
       Log the event
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1082.1">
      : Record the timeout occurrence in logs for monitoring and troubleshooting purposes
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1083.1">
       Initiate retry mechanisms
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      : Depending on the application requirements, the client may attempt to resend the request to recover from transient issues
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1085.1">
     Let’s implement the timeout for the API client using Spring Boot’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1086.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1087.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1087.2">
     In our example, we will configure a timeout of six seconds, striking a balance between allowing sufficient time for normal operations and preventing excessive waiting periods.
    </span>
    <span class="koboSpan" id="kobo.1087.3">
     Here is how to configure
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1088.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1089.1">
     with the appropriate timeout settings:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1090.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1091.1">Configuration</span></span><span class="koboSpan" id="kobo.1092.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1093.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1094.1">ProductsApiConfiguration</span></span><span class="koboSpan" id="kobo.1095.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1096.1">Bean</span></span><span class="koboSpan" id="kobo.1097.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1098.1">ProductsApi</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1099.1">getProductsApi</span></span><span class="koboSpan" id="kobo.1100.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1101.1">ApiClient apiClient</span></span><span class="koboSpan" id="kobo.1102.1">)
    {     
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1103.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1104.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1105.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1106.1">(apiClient);
    }
 
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1107.1">Bean</span></span><span class="koboSpan" id="kobo.1108.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1109.1">ApiClient</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1110.1">getApiClient</span></span><span class="koboSpan" id="kobo.1111.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1112.1">RestClient restClient</span></span><span class="koboSpan" id="kobo.1113.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1114.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1115.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1116.1">ApiClient</span></span><span class="koboSpan" id="kobo.1117.1">(restClient);
    }
 
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1118.1">Bean</span></span><span class="koboSpan" id="kobo.1119.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1120.1">RestClient</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1121.1">getRestClient</span></span><span class="koboSpan" id="kobo.1122.1">() {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1123.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1124.1">RestClient</span></span><span class="koboSpan" id="kobo.1125.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1126.1">builder</span></span><span class="koboSpan" id="kobo.1127.1">()
            
       .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1128.1">requestFactory</span></span><span class="koboSpan" id="kobo.1129.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1130.1">customClientHttpRequestFactory</span></span><span class="koboSpan" id="kobo.1131.1">())
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1132.1">build</span></span><span class="koboSpan" id="kobo.1133.1">();
    }
 
    private </span><span class="hljs-title"><span class="koboSpan" id="kobo.1134.1">ClientHttpRequestFactory</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1135.1">customClientHttpRequestFactory</span></span><span class="koboSpan" id="kobo.1136.1">() {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1137.1">Duration</span></span><span class="koboSpan" id="kobo.1138.1"> duration = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1139.1">Duration</span></span><span class="koboSpan" id="kobo.1140.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1141.1">ofSeconds</span></span><span class="koboSpan" id="kobo.1142.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1143.1">6</span></span><span class="koboSpan" id="kobo.1144.1">);
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1145.1">ClientHttpRequestFactorySettings</span></span><span class="koboSpan" id="kobo.1146.1"> settings = 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1147.1">            ClientHttpRequestFactorySettings</span></span><span class="koboSpan" id="kobo.1148.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1149.1">DEFAULTS</span></span><span class="koboSpan" id="kobo.1150.1">
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1151.1">withConnectTimeout</span></span><span class="koboSpan" id="kobo.1152.1">(duration)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1153.1">withReadTimeout</span></span><span class="koboSpan" id="kobo.1154.1">(duration);
 
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1155.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1156.1">ClientHttpRequestFactories</span></span><span class="koboSpan" id="kobo.1157.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1158.1">get</span></span><span class="koboSpan" id="kobo.1159.1">(settings);
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1160.1">
     This example
    </span>
    <a id="_idIndexMarker393">
    </a>
    <span class="koboSpan" id="kobo.1161.1">
     demonstrated how to configure
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1162.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1163.1">
     with appropriate
    </span>
    <a id="_idIndexMarker394">
    </a>
    <span class="koboSpan" id="kobo.1164.1">
     timeout settings to establish connections and receive data.
    </span>
    <span class="koboSpan" id="kobo.1164.2">
     Let us set up these timeouts to ensure our client avoids waiting too long for server responses.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-142">
    <a id="_idTextAnchor154">
    </a>
    <span class="koboSpan" id="kobo.1165.1">
     Server configuration
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1166.1">
     When a server receives a request, it begins processing the necessary information, which may involve
    </span>
    <a id="_idIndexMarker395">
    </a>
    <span class="koboSpan" id="kobo.1167.1">
     interacting with other servers, executing database queries, and performing various computational tasks.
    </span>
    <span class="koboSpan" id="kobo.1167.2">
     If these operations exceed the predefined
    </span>
    <a id="_idIndexMarker396">
    </a>
    <span class="koboSpan" id="kobo.1168.1">
     timeout threshold, the server should do the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1169.1">
       Terminate processing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1170.1">
      : Stop any ongoing operations related to the request to free up resources
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1171.1">
       Release allocated resources
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1172.1">
      : Ensure that resources such as memory, threads, and database connections are properly released to prevent leaks and bottlenecks
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1173.1">
       Notify the client
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1174.1">
      : Inform the client that a timeout has occurred using the appropriate HTTP error code,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1175.1">
       408 Request Timeout
      </span>
     </code>
     <span class="koboSpan" id="kobo.1176.1">
      , allowing the client to handle the situation appropriately (e.g., by retrying the request or notifying the user)
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1177.1">
     Before setting a timeout, it is important to observe the typical responses of your service and network conditions; this will allow you to have a proper notion of what is a “normal” expected time to respond, because setting a very short timeout can cause unnecessary failures, whereas a very long timeout can lead to poor user experience.
    </span>
    <span class="koboSpan" id="kobo.1177.2">
     The best application of this practice requires constant monitoring of the timeout metrics and adjusting configurations, both client and server, to maintain a healthy, resilient, and sustainable API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1178.1">
     To illustrate client timeout settings in a Spring Boot application, you can configure the connection timeout and read timeout within
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1179.1">
      ClientHttpRequestFactorySettings
     </span>
    </code>
    <span class="koboSpan" id="kobo.1180.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1180.2">
     This class is responsible for setting up the HTTP request factory with specific timeout parameters.
    </span>
    <span class="koboSpan" id="kobo.1180.3">
     These settings are then used to create a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1181.1">
      RestClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1182.1">
     instance, which is a component for executing HTTP requests to other services.
    </span>
    <span class="koboSpan" id="kobo.1182.2">
     For more detailed information on this configuration, please refer to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1183.1">
      ProductsApiConfiguration
     </span>
    </code>
    <span class="koboSpan" id="kobo.1184.1">
     class in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1185.1">
      chapter6
     </span>
    </code>
    <span class="koboSpan" id="kobo.1186.1">
     folder of the book’s source code repository.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1187.1">
     While the last
    </span>
    <a id="_idIndexMarker397">
    </a>
    <span class="koboSpan" id="kobo.1188.1">
     example focuses on client-side configuration, it’s worth noting
    </span>
    <a id="_idIndexMarker398">
    </a>
    <span class="koboSpan" id="kobo.1189.1">
     that server-side timeout configuration in Spring Boot typically involves setting properties in your
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1190.1">
      application.properties
     </span>
    </code>
    <span class="koboSpan" id="kobo.1191.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1192.1">
      application.yml
     </span>
    </code>
    <span class="koboSpan" id="kobo.1193.1">
     file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1194.1">
     Take the following example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1195.1">server:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1196.1">tomcat:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1197.1">connection-timeout:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1198.1">5000</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1199.1">
     This sets the server’s connection timeout to five seconds.
    </span>
    <span class="koboSpan" id="kobo.1199.2">
     The specific properties and their effects can vary depending on the server you’re using (e.g., Tomcat or Jetty).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1200.1">
     The previous examples show basic client-side and server-side timeout configurations.
    </span>
    <span class="koboSpan" id="kobo.1200.2">
     However, in more complex applications, you might need more advanced timeout management.
    </span>
    <span class="koboSpan" id="kobo.1200.3">
     The example in this book is intentionally simple to focus on key concepts.
    </span>
    <span class="koboSpan" id="kobo.1200.4">
     For real-world applications, especially those with complex database operations or microservices, you might find more sophisticated libraries, such as Resilience4j, useful.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1201.1">
     Resilience4j offers a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1202.1">
      TimeLimiter
     </span>
    </code>
    <span class="koboSpan" id="kobo.1203.1">
     module that provides detailed control over timeouts and works well with Spring Boot applications.
    </span>
    <span class="koboSpan" id="kobo.1203.2">
     While this level of complexity is not necessary for our basic example, understanding these advanced techniques can be valuable as your applications become more complex.
    </span>
    <span class="koboSpan" id="kobo.1203.3">
     Here’s an example using Resilience4j version 2.2.0 to manage timeouts in a more advanced scenario:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1204.1">
      Add the Resilience4j dependency to your project:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1205.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1206.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1207.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1208.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1209.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1210.1">&gt;</span></span><span class="koboSpan" id="kobo.1211.1">io.github.resilience4j</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1212.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1213.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1214.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1215.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1216.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1217.1">&gt;</span></span><span class="koboSpan" id="kobo.1218.1">resilience4j-spring-boot3</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1219.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1220.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1221.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.1222.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1223.1">version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1224.1">&gt;</span></span><span class="koboSpan" id="kobo.1225.1">2.2.0</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1226.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1227.1">version</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1228.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1229.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1230.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1231.1">&gt;</span></span>
</code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1232.1">
      Configure
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1233.1">
       TimeLimiter
      </span>
     </code>
     <span class="koboSpan" id="kobo.1234.1">
      in your
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1235.1">
       application.yml
      </span>
     </code>
     <span class="koboSpan" id="kobo.1236.1">
      :
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1237.1">resilience4j:</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.1238.1">timelimiter:</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.1239.1">instances:</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.1240.1">productServiceGetById:</span></span>
        <span class="hljs-attr"><span class="koboSpan" id="kobo.1241.1">timeout-duration:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">5s</span></span>
        <span class="hljs-attr"><span class="koboSpan" id="kobo.1243.1">cancel-running-future:</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1244.1">true</span></span>
</code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1245.1">
      Implement
     </span>
     <a id="_idIndexMarker399">
     </a>
     <span class="koboSpan" id="kobo.1246.1">
      the service
     </span>
     <a id="_idIndexMarker400">
     </a>
     <span class="koboSpan" id="kobo.1247.1">
      with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1248.1">
       TimeLimiter
      </span>
     </code>
     <span class="koboSpan" id="kobo.1249.1">
      :
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1250.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1251.1">Service</span></span><span class="koboSpan" id="kobo.1252.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1253.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1254.1">ProductsQueryUseCaseImpl</span></span><span class="koboSpan" id="kobo.1255.1"> implements </span><span class="hljs-title"><span class="koboSpan" id="kobo.1256.1">ProductsQueryUseCase</span></span><span class="koboSpan" id="kobo.1257.1"> {
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1258.1">ProductsRepository</span></span><span class="koboSpan" id="kobo.1259.1"> productsRepository;
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1260.1">PhotoProductsRepository</span></span><span class="koboSpan" id="kobo.1261.1"> photoProductsRepository;
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1262.1">TimeLimiter</span></span><span class="koboSpan" id="kobo.1263.1"> timeLimiter;
 
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1264.1">ProductsQueryUseCaseImpl</span></span><span class="koboSpan" id="kobo.1265.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1266.1">ProductsRepository</span></span><span class="koboSpan" id="kobo.1267.1"> productsRepository,   
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1268.1">        PhotoProductsRepository</span></span><span class="koboSpan" id="kobo.1269.1"> photoProductsRepository,   
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1270.1">        TimeLimiterRegistry</span></span><span class="koboSpan" id="kobo.1271.1"> timeLimiterRegistry) {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1272.1">this</span></span><span class="koboSpan" id="kobo.1273.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1274.1">productsRepository</span></span><span class="koboSpan" id="kobo.1275.1"> = productsRepository;
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1276.1">this</span></span><span class="koboSpan" id="kobo.1277.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1278.1">photoProductsRepository</span></span><span class="koboSpan" id="kobo.1279.1"> = photoProductsRepository;
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1280.1">this</span></span><span class="koboSpan" id="kobo.1281.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1282.1">timeLimiter</span></span><span class="koboSpan" id="kobo.1283.1"> = timeLimiterRegistry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1284.1">timeLimiter</span></span><span class="koboSpan" id="kobo.1285.1">(
</span><span class="hljs-variable">            </span><span class="hljs-string"><span class="koboSpan" id="kobo.1286.1">"productServiceGetById"</span></span><span class="koboSpan" id="kobo.1287.1">);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1288.1">Override</span></span><span class="koboSpan" id="kobo.1289.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1290.1">CompletableFuture</span></span><span class="koboSpan" id="kobo.1291.1">&lt;
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1292.1">Product</span></span><span class="koboSpan" id="kobo.1293.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1294.1">getProductByIdAsync</span></span><span class="koboSpan" id="kobo.1295.1">(</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1296.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1297.1"> productId</span></span><span class="koboSpan" id="kobo.1298.1">) {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1299.1">return</span></span><span class="koboSpan" id="kobo.1300.1"> timeLimiter.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1301.1">executeCompletionStage</span></span><span class="koboSpan" id="kobo.1302.1">(
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1303.1">                Executors</span></span><span class="koboSpan" id="kobo.1304.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1305.1">newSingleThreadScheduledExecutor</span></span><span class="koboSpan" id="kobo.1306.1">(), 
                () -&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1307.1">CompletableFuture</span></span><span class="koboSpan" id="kobo.1308.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1309.1">supplyAsync</span></span><span class="koboSpan" id="kobo.1310.1">(() -&gt;     
                    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1311.1">getProductById</span></span><span class="koboSpan" id="kobo.1312.1">(productId)))
</span><span class="hljs-title">                    </span><span class="koboSpan" id="kobo.1313.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1314.1">toCompletableFuture</span></span><span class="koboSpan" id="kobo.1315.1">();
    }
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1316.1">
      Use the service in a controller:
     </span>
     <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1317.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1318.1">RestController</span></span><span class="koboSpan" id="kobo.1319.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1320.1">RequestMapping</span></span><span class="koboSpan" id="kobo.1321.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1322.1">"/api/products"</span></span><span class="koboSpan" id="kobo.1323.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1324.1">Validated</span></span><span class="koboSpan" id="kobo.1325.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1326.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1327.1">ProductsApiController</span></span><span class="koboSpan" id="kobo.1328.1"> implements </span><span class="hljs-title"><span class="koboSpan" id="kobo.1329.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1330.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1331.1">GetMapping</span></span><span class="koboSpan" id="kobo.1332.1">(value = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1333.1">"/{productId}"</span></span><span class="koboSpan" id="kobo.1334.1">)
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1335.1">Override</span></span><span class="koboSpan" id="kobo.1336.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1337.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1338.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1339.1">ProductOutput</span></span><span class="koboSpan" id="kobo.1340.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1341.1">getProductById</span></span><span class="koboSpan" id="kobo.1342.1">(
        </span><span class="hljs-params"><span class="koboSpan" id="kobo.1343.1">@PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1344.1">"productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1345.1">) @ValidSku </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1346.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1347.1"> productId</span></span><span class="koboSpan" id="kobo.1348.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1349.1">try</span></span><span class="koboSpan" id="kobo.1350.1"> {
            final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1351.1">var</span></span><span class="koboSpan" id="kobo.1352.1"> product = productsQueryUseCase
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1353.1">getProductByIdAsync</span></span><span class="koboSpan" id="kobo.1354.1">(productId).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1355.1">get</span></span><span class="koboSpan" id="kobo.1356.1">();
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1357.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1358.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1359.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1360.1">status</span></span><span class="koboSpan" id="kobo.1361.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1362.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1363.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1364.1">OK</span></span><span class="koboSpan" id="kobo.1365.1">)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1366.1">body</span></span><span class="koboSpan" id="kobo.1367.1">(productMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1368.1">toProductOutput</span></span><span class="koboSpan" id="kobo.1369.1">(product));
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1370.1">catch</span></span><span class="koboSpan" id="kobo.1371.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1372.1">ExecutionException</span></span><span class="koboSpan" id="kobo.1373.1"> ex) {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1374.1">if</span></span><span class="koboSpan" id="kobo.1375.1"> (ex.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1376.1">getCause</span></span><span class="koboSpan" id="kobo.1377.1">() </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1378.1">instanceof</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1379.1">TimeoutException</span></span><span class="koboSpan" id="kobo.1380.1">) {
                </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1381.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1382.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1383.1">ResponseStatusException</span></span><span class="koboSpan" id="kobo.1384.1">(
                    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1385.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1386.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1387.1">REQUEST_TIMEOUT</span></span><span class="koboSpan" id="kobo.1388.1">, 
</span><span class="hljs-title">                    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1389.1">"Timeout to access the product id: </span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1390.1">                     [%s]"</span></span><span class="koboSpan" id="kobo.1391.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1392.1">formatted</span></span><span class="koboSpan" id="kobo.1393.1">(productId), ex);
            }
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1394.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1395.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1396.1">UnexpectedServerError</span></span><span class="koboSpan" id="kobo.1397.1">(
</span><span class="hljs-keyword">                </span><span class="hljs-string"><span class="koboSpan" id="kobo.1398.1">"Error to access the product."</span></span><span class="koboSpan" id="kobo.1399.1">, ex);
        } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1400.1">catch</span></span><span class="koboSpan" id="kobo.1401.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1402.1">Exception</span></span><span class="koboSpan" id="kobo.1403.1"> ex) {
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1404.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1405.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1406.1">UnexpectedServerError</span></span><span class="koboSpan" id="kobo.1407.1">(
</span><span class="hljs-keyword">                </span><span class="hljs-string"><span class="koboSpan" id="kobo.1408.1">"Error to access the product."</span></span><span class="koboSpan" id="kobo.1409.1">, ex);
        }
    }
}
</span></code></pre>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1410.1">
     In this
    </span>
    <a id="_idIndexMarker401">
    </a>
    <span class="koboSpan" id="kobo.1411.1">
     example, note the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1412.1">
      We have
     </span>
     <a id="_idIndexMarker402">
     </a>
     <span class="koboSpan" id="kobo.1413.1">
      an instance of
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1414.1">
       TimeLimiter
      </span>
     </code>
     <span class="koboSpan" id="kobo.1415.1">
      that is built by a named
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1416.1">
       TimeLimiterRegistry
      </span>
     </code>
     <span class="koboSpan" id="kobo.1417.1">
      using the configuration named
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1418.1">
       productServiceGetById
      </span>
     </code>
     <span class="koboSpan" id="kobo.1419.1">
      , which has a configuration for a five-second timeout.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1420.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1421.1">
       ProductsQueryUseCaseImpl.getProductById()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1422.1">
      method uses the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1423.1">
       timeLimiter.executeCompetionStage()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1424.1">
      method, which wraps the repository call in a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1425.1">
       CompletableFuture
      </span>
     </code>
     <span class="koboSpan" id="kobo.1426.1">
      to make it asynchronous.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1427.1">
      In a real scenario, if a complex database query or high server load causes a delay, it will be detected by this
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1428.1">
       timeLimiter
      </span>
     </code>
     <span class="koboSpan" id="kobo.1429.1">
      call, throwing one exception.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1430.1">
     That will be detected by the controller’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1431.1">
      try/catch
     </span>
    </code>
    <span class="koboSpan" id="kobo.1432.1">
     and return a timeout HTTP code.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1433.1">
     This example shows how to apply timeouts to specific service methods, such as those involving database operations.
    </span>
    <span class="koboSpan" id="kobo.1433.2">
     Although it is more complex than the book’s main example, it demonstrates
    </span>
    <a id="_idIndexMarker403">
    </a>
    <span class="koboSpan" id="kobo.1434.1">
     how you can improve your timeout strategies as your application’s needs grow.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1435.1">
     In practice, you would
    </span>
    <a id="_idIndexMarker404">
    </a>
    <span class="koboSpan" id="kobo.1436.1">
     choose the appropriate level of timeout management based on your specific requirements.
    </span>
    <span class="koboSpan" id="kobo.1436.2">
     You might start with simpler approaches and move to more advanced solutions, such as Resilience4j, as your system becomes more complex.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1437.1">
     While timeouts are crucial for maintaining system responsiveness, they often work hand in hand with another important resilience pattern: retry mechanisms.
    </span>
    <span class="koboSpan" id="kobo.1437.2">
     When a timeout occurs, it may be due to temporary issues that could be resolved quickly.
    </span>
    <span class="koboSpan" id="kobo.1437.3">
     In such cases, automatically retrying the operation can help maintain service continuity without user intervention.
    </span>
    <span class="koboSpan" id="kobo.1437.4">
     Let’s explore how retry mechanisms complement timeout strategies and enhance overall system resilience.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-143">
    <a id="_idTextAnchor155">
    </a>
    <span class="koboSpan" id="kobo.1438.1">
     Retry mechanism
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1439.1">
     Implementing a retry mechanism is an effective strategy to prevent the temporary unavailability
    </span>
    <a id="_idIndexMarker405">
    </a>
    <span class="koboSpan" id="kobo.1440.1">
     of a system component from disrupting the entire chain of dependent processes.
    </span>
    <span class="koboSpan" id="kobo.1440.2">
     While retries can mitigate temporary failures, excessive or inappropriate
    </span>
    <a id="_idIndexMarker406">
    </a>
    <span class="koboSpan" id="kobo.1441.1">
     retries can exacerbate issues, leading to resource exhaustion and degraded performance.
    </span>
    <span class="koboSpan" id="kobo.1441.2">
     We will present how to properly deal with this here.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1442.1">
     There are countless reasons why an API might fail to complete a process cycle, affecting various tasks within a request.
    </span>
    <span class="koboSpan" id="kobo.1442.2">
     Here are some cases that you can handle with retries:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1443.1">
      Timeouts
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1444.1">
      5xx server errors (e.g.,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1445.1">
       500 Internal Server Error
      </span>
     </code>
     <span class="koboSpan" id="kobo.1446.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1447.1">
       503 Service Unavailable
      </span>
     </code>
     <span class="koboSpan" id="kobo.1448.1">
      )
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1449.1">
      Rate limiting (e.g.,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1450.1">
       429 Too Many Requests
      </span>
     </code>
     <span class="koboSpan" id="kobo.1451.1">
      )
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1452.1">
     Consider an e-commerce platform where verifying the stock count of a product is a critical step in finalizing a sale.
    </span>
    <span class="koboSpan" id="kobo.1452.2">
     Suppose the product stock verification API typically responds within 2 to 5 seconds.
    </span>
    <span class="koboSpan" id="kobo.1452.3">
     If this API experiences a temporary delay or failure, implement a retry mechanism to ensure that the transaction can still proceed without unnecessary abandonment.
    </span>
    <span class="koboSpan" id="kobo.1452.4">
     Take the following example:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1453.1">
       Initial request
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1454.1">
      : The system requests the stock count
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1455.1">
       First failure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1456.1">
      : The API does not respond within the expected period
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1457.1">
       Retry attempt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1458.1">
      : The system retries the request after a brief delay
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1459.1">
       Successful response
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1460.1">
      : On the second attempt, the API responds successfully, allowing the sale to proceed
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1461.1">
     This approach minimizes the risk of losing transactions due to temporary API unavailability.
    </span>
    <span class="koboSpan" id="kobo.1461.2">
     However, retries can
    </span>
    <a id="_idIndexMarker407">
    </a>
    <span class="koboSpan" id="kobo.1462.1">
     become problematic if the product stock API is
    </span>
    <a id="_idIndexMarker408">
    </a>
    <span class="koboSpan" id="kobo.1463.1">
     down and recovery takes longer.
    </span>
    <span class="koboSpan" id="kobo.1463.2">
     Continuous retries without communicating with other systems involved in the transaction can lead to a poor customer experience and cause considerable damage and loss to the company.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1464.1">
     To not get trapped in the pitfalls that we mentioned, you need to consider some best practices when implementing your retry policy:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1465.1">
      Set a maximum retry limit
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1466.1">
      Use exponential backoff with jitter
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1467.1">
      Have idempotent requests
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1468.1">
      Implement timeout mechanisms
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1469.1">
      Log retry attempts
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-144">
    <a id="_idTextAnchor156">
    </a>
    <span class="koboSpan" id="kobo.1470.1">
     Set a maximum retry limit
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1471.1">
     Without a
    </span>
    <a id="_idIndexMarker409">
    </a>
    <span class="koboSpan" id="kobo.1472.1">
     maximum retry limit, your system could enter an endless loop of trying to resend a failed request.
    </span>
    <span class="koboSpan" id="kobo.1472.2">
     Imagine a scenario where a server is down for an extended period.
    </span>
    <span class="koboSpan" id="kobo.1472.3">
     If there is no limit on retries, the system will keep trying to resend the request forever, wasting resources and potentially causing other issues.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-145">
    <a id="_idTextAnchor157">
    </a>
    <span class="koboSpan" id="kobo.1473.1">
     Use exponential backoff with jitter
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1474.1">
     Exponential
    </span>
    <a id="_idIndexMarker410">
    </a>
    <span class="koboSpan" id="kobo.1475.1">
     backoff is a method used to manage the timing of retry attempts after a failure.
    </span>
    <span class="koboSpan" id="kobo.1475.2">
     Instead of trying to resend the message at regular intervals, the system waits longer each time it fails to resend.
    </span>
    <span class="koboSpan" id="kobo.1475.3">
     The wait time increases exponentially, meaning it increases quickly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1476.1">
     Let us look at an example:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1477.1">
       First attempt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1478.1">
      : If sending the message fails, wait for a brief period of time (e.g., one second) before trying again.
     </span>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1479.1">
       Second attempt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1480.1">
      : If it fails again, wait twice as long (e.g., two seconds).
     </span>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1481.1">
       Third attempt
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1482.1">
      : Double the wait time, that is, four seconds.
     </span>
    </li>
    <li class="numberedList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1483.1">
       Continue depending on the limit of tries
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1484.1">
      : At every new retry, the wait time doubles (8 seconds, 16 seconds, etc.).
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1485.1">
     This approach
    </span>
    <a id="_idIndexMarker411">
    </a>
    <span class="koboSpan" id="kobo.1486.1">
     helps prevent the system from repeatedly trying to send messages too quickly, which can cause more problems, such as overloading the server or network.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1487.1">
     Jitter
    </span>
   </h4>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1488.1">
      Jitter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1489.1">
     is a random
    </span>
    <a id="_idIndexMarker412">
    </a>
    <span class="koboSpan" id="kobo.1490.1">
     time used as a time interval for retrying failed requests.
    </span>
    <span class="koboSpan" id="kobo.1490.2">
     Instead of having the retry mechanism make all the calls at a fixed time or even with exponential progress, we have a random time for each new retry.
    </span>
    <span class="koboSpan" id="kobo.1490.3">
     Instead of waiting exactly 2 seconds, for example, it might wait between 1 and 3 seconds.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-146">
    <a id="_idTextAnchor158">
    </a>
    <span class="koboSpan" id="kobo.1491.1">
     Combining exponential backoff and jitter
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1492.1">
     Using only exponential backoff can still cause issues.
    </span>
    <span class="koboSpan" id="kobo.1492.2">
     If many devices or systems are trying to resend
    </span>
    <a id="_idIndexMarker413">
    </a>
    <span class="koboSpan" id="kobo.1493.1">
     messages at the same time, they might all wait the same amount and then retry together, creating a sudden peak of traffic.
    </span>
    <span class="koboSpan" id="kobo.1493.2">
     This can make the network or server even more overwhelming, which is why it is best practice to combine exponential backoff and jitter.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1494.1">
     Adding jitter helps by spreading out the retry attempts.
    </span>
    <span class="koboSpan" id="kobo.1494.2">
     Each device waits for a slightly different time, reducing the chance that they all send requests at the same time.
    </span>
    <span class="koboSpan" id="kobo.1494.3">
     This makes the system more stable and increases the chances that messages will be successfully sent.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-147">
    <a id="_idTextAnchor159">
    </a>
    <span class="koboSpan" id="kobo.1495.1">
     Have idempotent requests
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1496.1">
     Having idempotent
    </span>
    <a id="_idIndexMarker414">
    </a>
    <span class="koboSpan" id="kobo.1497.1">
     requests when retrying API calls is vital for building resilient and reliable systems.
    </span>
    <span class="koboSpan" id="kobo.1497.2">
     It ensures that multiple attempts to perform the same operation do not lead to unintended consequences, such as duplicate actions or inconsistent data.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-148">
    <a id="_idTextAnchor160">
    </a>
    <span class="koboSpan" id="kobo.1498.1">
     Implement timeout mechanisms
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1499.1">
     You are
    </span>
    <a id="_idIndexMarker415">
    </a>
    <span class="koboSpan" id="kobo.1500.1">
     already aware of the importance of timeouts from the previous topic.
    </span>
    <span class="koboSpan" id="kobo.1500.2">
     A retry involves sending a new request to the service, and it is essential to manage how long we wait before taking the next action.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-149">
    <a id="_idTextAnchor161">
    </a>
    <span class="koboSpan" id="kobo.1501.1">
     Log retry attempts
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1502.1">
     Logging each failure during retry attempts will help us understand recurring patterns or frequent issues
    </span>
    <a id="_idIndexMarker416">
    </a>
    <span class="koboSpan" id="kobo.1503.1">
     causing the retries, and it will ease system troubleshooting.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1504.1">
     A well-implemented retry mechanism significantly enhances the resilience of APIs by gracefully handling transient failures.
    </span>
    <span class="koboSpan" id="kobo.1504.2">
     By adhering to best practices—such as limiting retry attempts, employing exponential backoff, guaranteeing idempotent retries, and distinguishing error types—developers can ensure that retries contribute to system stability without introducing new vulnerabilities.
    </span>
    <span class="koboSpan" id="kobo.1504.3">
     Thoughtful retry strategies lead to improved user experiences, higher system reliability, and sustained operational efficiency.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1505.1">
     Although retry mechanisms help handle temporary failures, unrestricted retries could overwhelm your system.
    </span>
    <span class="koboSpan" id="kobo.1505.2">
     This brings us to another crucial resilience pattern: rate limiting.
    </span>
    <span class="koboSpan" id="kobo.1505.3">
     By controlling the frequency and volume of requests, rate limiting helps maintain system stability even during high-load situations.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-150">
    <a id="_idTextAnchor162">
    </a>
    <span class="koboSpan" id="kobo.1506.1">
     Rate limiting
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1507.1">
     Rate limiting is a
    </span>
    <a id="_idIndexMarker417">
    </a>
    <span class="koboSpan" id="kobo.1508.1">
     critical strategy used to protect APIs from abuse and
    </span>
    <a id="_idIndexMarker418">
    </a>
    <span class="koboSpan" id="kobo.1509.1">
     excessive resource access.
    </span>
    <span class="koboSpan" id="kobo.1509.2">
     It ensures the stability, reliability, and security of API systems by restricting the number of requests an API can handle from a user (user, IP, application, token, etc.) within a specified period.
    </span>
    <span class="koboSpan" id="kobo.1509.3">
     This approach helps to prevent
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1510.1">
      denial of service
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1511.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1512.1">
      DoS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1513.1">
     ) attacks
    </span>
    <a id="_idIndexMarker419">
    </a>
    <span class="koboSpan" id="kobo.1514.1">
     and ensures the fair distribution of services among clients, preventing exhaustion of resources.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1515.1">
     We can
    </span>
    <a id="_idIndexMarker420">
    </a>
    <span class="koboSpan" id="kobo.1516.1">
     apply rate limiting on distinct levels of context; it can be based on the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1517.1">
       Global level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1518.1">
      : In this context, we can limit the total number of requests the API can handle by period
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1519.1">
       IP level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1520.1">
      : By IP, we limit the number of requests based on the IP address of the client
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1521.1">
       User level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1522.1">
      : Limits requests based on individual users or clients
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1523.1">
       Application level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1524.1">
      : Limits based on a specific application using the API
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1525.1">
     In the following sections, we will explore some of the aspects of implementing rate limiting, such as quota management, time windows, and rate-limiting headers.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-151">
    <a id="_idTextAnchor163">
    </a>
    <span class="koboSpan" id="kobo.1526.1">
     Rate limiting key aspects
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1527.1">
     To effectively manage rate limiting, it is essential to understand its core components and how they contribute
    </span>
    <a id="_idIndexMarker421">
    </a>
    <span class="koboSpan" id="kobo.1528.1">
     to overall API resilience.
    </span>
    <span class="koboSpan" id="kobo.1528.2">
     Rate limiting is not just about restricting requests; it is about controlling access fairly, transparently, and scalably, ensuring a stable experience for all users while protecting resources.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1529.1">
     In this section, we will explore three critical aspects of rate limiting:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1530.1">
       Quota management
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1531.1">
      : Defines the maximum number of requests allowed per client within a given period (e.g., 1,500 requests per hour).
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1532.1">
       Time windows
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1533.1">
      : The period during which the request count is measured.
     </span>
     <span class="koboSpan" id="kobo.1533.2">
      Common intervals include per second, minute, hour, or day.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1534.1">
       Rate limit headers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1535.1">
      : APIs often include headers in responses to inform clients about their current usage and remaining quota.
     </span>
     <span class="koboSpan" id="kobo.1535.2">
      Examples include the following:
     </span>
     <ul>
      <li class="bulletList">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1536.1">
         X-Rate-Limit-Limit
        </span>
       </code>
       <span class="koboSpan" id="kobo.1537.1">
        : The maximum number of requests allowed
       </span>
      </li>
      <li class="bulletList">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1538.1">
         X-Rate-Limit-Remaining
        </span>
       </code>
       <span class="koboSpan" id="kobo.1539.1">
        : The number of requests left in the current window
       </span>
      </li>
      <li class="bulletList">
       <code class="inlineCode">
        <span class="koboSpan" id="kobo.1540.1">
         X-Rate-Limit-Reset
        </span>
       </code>
       <span class="koboSpan" id="kobo.1541.1">
        : The time when the rate limit will reset
       </span>
      </li>
     </ul>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1542.1">
       Provide the proper response HTTP code when it reaches the rating limit
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1543.1">
      : A
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1544.1">
       429 Too Many Requests
      </span>
     </code>
     <span class="koboSpan" id="kobo.1545.1">
      error is advised by RFC 6585.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1546.1">
     Now that you know what these aspects are and understand what they mean, let us talk about different implementations of rate limiting on your API.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-152">
    <a id="_idTextAnchor164">
    </a>
    <span class="koboSpan" id="kobo.1547.1">
     Rate limiting implementation strategies
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1548.1">
     Implementing
    </span>
    <a id="_idIndexMarker422">
    </a>
    <span class="koboSpan" id="kobo.1549.1">
     rate limiting requires careful consideration of various strategies, each with its advantages and trade-offs:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1550.1">
       Fixed window
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1551.1">
      : This strategy has the time split into fixed intervals (windows), such as one
     </span>
     <a id="_idIndexMarker423">
     </a>
     <span class="koboSpan" id="kobo.1552.1">
      minute.
     </span>
     <span class="koboSpan" id="kobo.1552.2">
      The count of requests is reset at the start of each new window.
     </span>
     <span class="koboSpan" id="kobo.1552.3">
      This is the simplest implementation, although it might be susceptible to bursts at window boundaries (e.g., a client could send double the allowed requests in a brief period and have multiple requests rejected).
     </span>
     <span class="koboSpan" id="kobo.1552.4">
      Depending on the application, it may be acceptable to employ this simple strategy to implement and have occasional failures.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1553.1">
       Sliding window
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1554.1">
      : Unlike
     </span>
     <a id="_idIndexMarker424">
     </a>
     <span class="koboSpan" id="kobo.1555.1">
      fixed windows, sliding windows move continuously.
     </span>
     <span class="koboSpan" id="kobo.1555.2">
      For each request, the system checks the number of requests in the past defined period for readjusting itself.
     </span>
     <span class="koboSpan" id="kobo.1555.3">
      It will result in a smoother distribution of allowed requests over time, reducing the chance of overloaded periods and periods without any requests.
     </span>
     <span class="koboSpan" id="kobo.1555.4">
      It has a more complex implementation but shows precise control over request rates.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1556.1">
       Token bucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1557.1">
      : A bucket holds tokens representing the number of allowed requests.
     </span>
     <span class="koboSpan" id="kobo.1557.2">
      Tokens
     </span>
     <a id="_idIndexMarker425">
     </a>
     <span class="koboSpan" id="kobo.1558.1">
      are added, refilling the bucket based on the number of allowed requests per configured time.
     </span>
     <span class="koboSpan" id="kobo.1558.2">
      Each request consumes a token.
     </span>
     <span class="koboSpan" id="kobo.1558.3">
      If no tokens are available, the request is rejected.
     </span>
     <span class="koboSpan" id="kobo.1558.4">
      It has a slightly more complex logic, but will support the APIs that need to handle occasional spikes without compromising overall rate limits.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1559.1">
       Leaky bucket
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1560.1">
      : This strategy is like a token bucket but processes requests at a fixed rate, queuing
     </span>
     <a id="_idIndexMarker426">
     </a>
     <span class="koboSpan" id="kobo.1561.1">
      requests where the bucket limit is the mark that determines whether we accept new requests.
     </span>
     <span class="koboSpan" id="kobo.1561.2">
      If the queue/bucket is full, additional requests are rejected.
     </span>
     <span class="koboSpan" id="kobo.1561.3">
      Every time a request is processed from the queue, it opens space for a new, incoming request.
     </span>
     <span class="koboSpan" id="kobo.1561.4">
      It can cause an increase in latency due to the queuing.
     </span>
     <span class="koboSpan" id="kobo.1561.5">
      However, it will ensure a steady processing rate.
     </span>
     <span class="koboSpan" id="kobo.1561.6">
      This is advantageous for systems where maintaining a consistent processing rate is critical.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1562.1">
     The rate limiting implementation will protect the API against abuse by malicious actors overwhelming the API, support resource management, ensure a fair distribution of resources among the clients, and maintain the API’s responsiveness by controlling the traffic flow.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1563.1">
     While rate limiting focuses on restricting the total number of requests, a related but distinct concept is throttling.
    </span>
    <span class="koboSpan" id="kobo.1563.2">
     Understanding the difference between these two approaches is crucial for implementing effective request management strategies.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1564.1">
     Gateway-level rate limiting
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1565.1">
     While rate
    </span>
    <a id="_idIndexMarker427">
    </a>
    <span class="koboSpan" id="kobo.1566.1">
     limiting inside individual API services provides good protection, implementing rate limiting at the gateway level offers important benefits that experienced developers should consider for production systems.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1567.1">
     Single point of control
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1568.1">
     API gateways
    </span>
    <a id="_idIndexMarker428">
    </a>
    <span class="koboSpan" id="kobo.1569.1">
     act as the main entry point for all client requests.
    </span>
    <span class="koboSpan" id="kobo.1569.2">
     This makes them perfect places to set up rate-limiting rules.
    </span>
    <span class="koboSpan" id="kobo.1569.3">
     Instead of adding rate-limiting code to each service separately, you can manage all policies from one central location.
    </span>
    <span class="koboSpan" id="kobo.1569.4">
     This approach reduces complexity and makes maintenance easier across your entire system.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1570.1">
     Stopping requests early
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1571.1">
     Gateway-level rate limiting blocks excessive requests before they reach your application services.
    </span>
    <span class="koboSpan" id="kobo.1571.2">
     When
    </span>
    <a id="_idIndexMarker429">
    </a>
    <span class="koboSpan" id="kobo.1572.1">
     clients send too many requests, the gateway immediately returns a 429 error code without using any backend resources, such as database connections or server processing power.
    </span>
    <span class="koboSpan" id="kobo.1572.2">
     This early blocking protects your system during traffic spikes and saves computing resources.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1573.1">
     System-wide rate limiting
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1574.1">
     In complex systems where clients use multiple services, gateway rate limiting lets you set limits
    </span>
    <a id="_idIndexMarker430">
    </a>
    <span class="koboSpan" id="kobo.1575.1">
     across your entire API.
    </span>
    <span class="koboSpan" id="kobo.1575.2">
     For example, you can limit a user to 5,000 requests per hour across all services, not just individual ones.
    </span>
    <span class="koboSpan" id="kobo.1575.3">
     This prevents clients from avoiding limits by spreading requests across different endpoints.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1576.1">
     Implementation options
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1577.1">
     Popular gateway tools such as Kong, AWS API Gateway, and Nginx offer built-in rate-limiting features.
    </span>
    <span class="koboSpan" id="kobo.1577.2">
     These tools support different strategies, such as the token bucket and sliding window
    </span>
    <a id="_idIndexMarker431">
    </a>
    <span class="koboSpan" id="kobo.1578.1">
     methods.
    </span>
    <span class="koboSpan" id="kobo.1578.2">
     When using multiple gateway servers, consider using shared storage such as Redis to track request counts accurately across all servers.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1579.1">
     Gateway-level rate limiting works best when combined with service-level rate limiting.
    </span>
    <span class="koboSpan" id="kobo.1579.2">
     Use gateways for general limits and overall system protection, while keeping specific business rules and detailed limits within individual services.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-153">
    <a id="_idTextAnchor165">
    </a>
    <span class="koboSpan" id="kobo.1580.1">
     Throttling
    </span>
   </h2>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1581.1">
      Throttling
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1582.1">
     , on the other hand, manages the rate at which requests are handled.
    </span>
    <span class="koboSpan" id="kobo.1582.2">
     Instead of limiting the
    </span>
    <a id="_idIndexMarker432">
    </a>
    <span class="koboSpan" id="kobo.1583.1">
     total number of requests, throttling makes sure that requests are processed at a steady pace.
    </span>
    <span class="koboSpan" id="kobo.1583.2">
     This is often done by queuing or delaying requests to keep the system stable.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1584.1">
     For real-time data, the API
    </span>
    <a id="_idIndexMarker433">
    </a>
    <span class="koboSpan" id="kobo.1585.1">
     limits how frequently each user can make requests to prevent server overload.
    </span>
    <span class="koboSpan" id="kobo.1585.2">
     In this case, each user can make only one request per second.
    </span>
    <span class="koboSpan" id="kobo.1585.3">
     If a user sends requests faster than this, throttling will slow down their requests, but will not block them completely.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1586.1">
     This is how it works:
    </span>
   </p>
   <ol>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1587.1">
      User X sends three requests in one second.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1588.1">
      The API processes the first request immediately.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1589.1">
      The API delays the second and third requests, ensuring each request is spaced one second apart.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1590.1">
     Throttling controls
    </span>
    <a id="_idIndexMarker434">
    </a>
    <span class="koboSpan" id="kobo.1591.1">
     the pace of requests, allowing the server to handle high-frequency requests without being overwhelmed.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1592.1">
     What is
    </span>
    <a id="_idIndexMarker435">
    </a>
    <span class="koboSpan" id="kobo.1593.1">
     the difference between rate limiting and throttling, then?
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1594.1">
       Rate limiting
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1595.1">
      : Controls the
     </span>
     <a id="_idIndexMarker436">
     </a>
     <span class="koboSpan" id="kobo.1596.1">
      total number of requests over a period (e.g., 500 requests per hour)
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1597.1">
       Throttling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1598.1">
      : Controls the
     </span>
     <a id="_idIndexMarker437">
     </a>
     <span class="koboSpan" id="kobo.1599.1">
      speed of requests, slowing them down if they come in too quickly (e.g., one request per second)
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1600.1">
     Using both
    </span>
    <a id="_idIndexMarker438">
    </a>
    <span class="koboSpan" id="kobo.1601.1">
     together ensures that the API remains responsive and fair, even with high demand.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-154">
    <a id="_idTextAnchor166">
    </a>
    <span class="koboSpan" id="kobo.1602.1">
     Throttling implementation strategies
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1603.1">
     The following
    </span>
    <a id="_idIndexMarker439">
    </a>
    <span class="koboSpan" id="kobo.1604.1">
     are some of the throttling implementation strategies:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1605.1">
       Dynamic throttling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1606.1">
      : Adjusts limits based on real-time system performance and load.
     </span>
     <span class="koboSpan" id="kobo.1606.2">
      This
     </span>
     <a id="_idIndexMarker440">
     </a>
     <span class="koboSpan" id="kobo.1607.1">
      implementation is more responsive to changing conditions, although it requires sophisticated monitoring and adjustment mechanisms.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1608.1">
       Priority-based throttling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1609.1">
      : Assigns priorities to different types of requests or clients.
     </span>
     <span class="koboSpan" id="kobo.1609.2">
      In
     </span>
     <a id="_idIndexMarker441">
     </a>
     <span class="koboSpan" id="kobo.1610.1">
      this way, it ensures critical operations have access to necessary resources; however, this approach is complex to manage.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1611.1">
       Graceful degradation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1612.1">
      : Reduces functionality or performance in a controlled manner
     </span>
     <a id="_idIndexMarker442">
     </a>
     <span class="koboSpan" id="kobo.1613.1">
      when under high load.
     </span>
     <span class="koboSpan" id="kobo.1613.2">
      During peak usage, this strategy maintains some level of service.
     </span>
     <span class="koboSpan" id="kobo.1613.3">
      This strategy may come at the cost of some periods of bad user experience.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1614.1">
       Circuit breaker pattern
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1615.1">
      : Temporarily stop requests flowing to some specific route, to
     </span>
     <a id="_idIndexMarker443">
     </a>
     <span class="koboSpan" id="kobo.1616.1">
      prevent system overload and allow recovery.
     </span>
     <span class="koboSpan" id="kobo.1616.2">
      It will protect the system against cascading failures.
     </span>
     <span class="koboSpan" id="kobo.1616.3">
      As a side effect, it may require careful configuration to avoid unnecessary shutdowns.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1617.1">
     Throttling helps ensure the reliability of APIs, maintaining stability under varying conditions.
    </span>
    <span class="koboSpan" id="kobo.1617.2">
     It allocates resources efficiently based on current demands, preventing slowdowns and outages, and maintaining the consistency of the service.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1618.1">
     This strategy is used by many large API providers, such as Microsoft’s GitHub API, which has a detailed rate-limiting system based on distinct levels.
    </span>
    <span class="koboSpan" id="kobo.1618.2">
     The level is determined by the number of simultaneous requests you make.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1619.1">
     To simplify things, let us assume we are at the most basic level.
    </span>
    <span class="koboSpan" id="kobo.1619.2">
     In this case, rate limits depend on our authentication.
    </span>
    <span class="koboSpan" id="kobo.1619.3">
     For example, unauthenticated requests that can access public data have their specific limits.
    </span>
    <span class="koboSpan" id="kobo.1619.4">
     Authenticated requests, on the other hand, have different rate limits (bigger) depending on the type of authentication, such as using a token or OAuth.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1620.1">
     This does
    </span>
    <a id="_idIndexMarker444">
    </a>
    <span class="koboSpan" id="kobo.1621.1">
     not mean you need to implement something that complex.
    </span>
    <span class="koboSpan" id="kobo.1621.2">
     This is an example of how rate limits can help manage the demand on your API, depending on the level of implementation.
    </span>
    <span class="koboSpan" id="kobo.1621.3">
     It depends only on your needs and creativity.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1622.1">
     A quite simple example where you can find rate limits widely used on the market of API providers is the limiting of the usage for the free user plan, as you can see on different Google APIs, for example.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1623.1">
     Rate limiting and throttling are essential mechanisms for API management, helping to maintain the integrity and reliability of services.
    </span>
    <span class="koboSpan" id="kobo.1623.2">
     Rate limiting focuses on controlling the number of requests per client within a specific time, while throttling employs strategies to manage overall traffic flow and system performance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1624.1">
     For API providers, implementing effective rate limiting and throttling ensures fair usage, protects against abuse, and maintains optimal performance.
    </span>
    <span class="koboSpan" id="kobo.1624.2">
     For API consumers, understanding these mechanisms allows for the design of resilient applications that interact smoothly with APIs, handle limitations gracefully, and provide a seamless user experience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1625.1">
     Managing the request flow through throttling is important, but ensuring request consistency is equally crucial.
    </span>
    <span class="koboSpan" id="kobo.1625.2">
     This is where idempotency comes into play, particularly when dealing with retried requests that might have succeeded but failed to communicate their success.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-155">
    <a id="_idTextAnchor167">
    </a>
    <span class="koboSpan" id="kobo.1626.1">
     Idempotency key
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1627.1">
     To understand
    </span>
    <a id="_idIndexMarker445">
    </a>
    <span class="koboSpan" id="kobo.1628.1">
     why an idempotency key is necessary, it is essential to first
    </span>
    <a id="_idIndexMarker446">
    </a>
    <span class="koboSpan" id="kobo.1629.1">
     understand the concept of idempotency.
    </span>
    <span class="koboSpan" id="kobo.1629.2">
     If you do not recall this from the second chapter, now is a good time to revisit that section.
    </span>
    <span class="koboSpan" id="kobo.1629.3">
     In simple terms, idempotency means calling the API multiple times with the same parameters while ensuring that the state remains unchanged and no unintended side effects occur.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1630.1">
     According to the idempotency key RFC (there is no defined number yet) about the idempotency key header, “The HTTP Idempotency-Key request header field can be used to carry an idempotency key in order to make non-idempotent HTTP methods such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1631.1">
      POST
     </span>
    </code>
    <span class="koboSpan" id="kobo.1632.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1633.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.1634.1">
     fault-tolerant.”
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1635.1">
     Imagine the following scenario: we have a frontend that sends an order to our management order API, and this happens when the user clicks on the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1636.1">
      Save Order
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1637.1">
     button; this will trigger the code that will make a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1638.1">
      POST
     </span>
    </code>
    <span class="koboSpan" id="kobo.1639.1">
     call with all the data required to create a new order.
    </span>
    <span class="koboSpan" id="kobo.1639.2">
     Let us imagine that due to internet instability, the user does not see the result on the screen as fast as usual and
    </span>
    <a id="_idIndexMarker447">
    </a>
    <span class="koboSpan" id="kobo.1640.1">
     hits this button multiple times.
    </span>
    <span class="koboSpan" id="kobo.1640.2">
     This means we will receive multiple
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1641.1">
      POST
     </span>
    </code>
    <span class="koboSpan" id="kobo.1642.1">
     calls with the same data.
    </span>
    <span class="koboSpan" id="kobo.1642.2">
     As an undesirable side effect, we would have the same
    </span>
    <a id="_idIndexMarker448">
    </a>
    <span class="koboSpan" id="kobo.1643.1">
     order repeated multiple times, which causes an inconsistency in our system.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1644.1">
     If our frontend added on each call a header item
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1645.1">
      "Idempotency-Key"
     </span>
    </code>
    <span class="koboSpan" id="kobo.1646.1">
     , a key that satisfies the requirement that its value is the same if and only if it is the same request (order) from a business perspective, it would prevent this undesirable side effect of having multiple wrong records stored on the management API because
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1647.1">
      "Idempotency-Key"
     </span>
    </code>
    <span class="koboSpan" id="kobo.1648.1">
     would serve as a unique key to avoid these repetitions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1649.1">
     Here is an example of one call to an API that requires the usage of an idempotency key:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1650.1">curl https://api.service.com/v1/orders \
  -u Ao24N7La2PDTkdtegf553lJI: \
  -H "Idempotency-Key: AF1GvyNVeriLWuDU" \
  -d description="My Order Test"
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1651.1">
     In the preceding example, we have the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1652.1">
      "Idempotency-Key"
     </span>
    </code>
    <span class="koboSpan" id="kobo.1653.1">
     header, and this header is sent by the request client.
    </span>
    <span class="koboSpan" id="kobo.1653.2">
     The Stripe documentation recommends generating a key with V4 UUIDs, or another random string with enough entropy to avoid collisions.
    </span>
    <span class="koboSpan" id="kobo.1653.3">
     By doing so, we can guarantee idempotency even for methods that are not idempotent.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1654.1">
     In summary, using an idempotency key is crucial for maintaining the reliability and consistency of APIs, especially when handling non-idempotent requests such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1655.1">
      POST
     </span>
    </code>
    <span class="koboSpan" id="kobo.1656.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1657.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.1658.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1658.2">
     By assigning a unique key to each request, developers can prevent duplicate actions, such as multiple orders being created unintentionally.
    </span>
    <span class="koboSpan" id="kobo.1658.3">
     This approach ensures that even if a user sends the same request multiple times due to network issues or repeated clicks, the system remains stable and accurate.
    </span>
    <span class="koboSpan" id="kobo.1658.4">
     Implementing idempotency keys not only safeguards the integrity of the data but also enhances the user experience by avoiding errors and inconsistencies.
    </span>
    <span class="koboSpan" id="kobo.1658.5">
     Adhering to best practices, such as generating unique and secure keys, further strengthens the API’s resilience and fault tolerance.
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.1659.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1660.1">
       UUID V4
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1661.1">
      A UUID V4 is a 128-bit value used to uniquely identify information in computer systems.
     </span>
     <span class="koboSpan" id="kobo.1661.2">
      It is randomly generated and follows a specific format to ensure uniqueness.
     </span>
     <span class="koboSpan" id="kobo.1661.3">
      Unlike other versions, a V4 UUID relies on random numbers, which makes it highly unlikely to generate duplicates.
     </span>
     <span class="koboSpan" id="kobo.1661.4">
      This type of identifier is often used when a unique reference is needed, such as in database entries or API requests, to ensure data consistency and prevent collisions.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1662.1">
     While idempotency
    </span>
    <a id="_idIndexMarker449">
    </a>
    <span class="koboSpan" id="kobo.1663.1">
     ensures request consistency, it does not address the broader
    </span>
    <a id="_idIndexMarker450">
    </a>
    <span class="koboSpan" id="kobo.1664.1">
     challenge of handling failing downstream services.
    </span>
    <span class="koboSpan" id="kobo.1664.2">
     The circuit breaker pattern offers a solution by preventing cascading failures in distributed systems.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-156">
    <a id="_idTextAnchor168">
    </a>
    <span class="koboSpan" id="kobo.1665.1">
     Circuit breaker
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1666.1">
     Inspired by electrical circuit breakers, which protect electrical systems from damage caused by overloads or short circuits, the circuit breaker pattern in software works analogously.
    </span>
    <span class="koboSpan" id="kobo.1666.2">
     It helps prevent
    </span>
    <a id="_idIndexMarker451">
    </a>
    <span class="koboSpan" id="kobo.1667.1">
     system failures by stopping repeated attempts at unsuccessful operations until the system recovers.
    </span>
    <span class="koboSpan" id="kobo.1667.2">
     Just like in an electrical circuit, when the switch is closed, energy flows through, but opening the switch disrupts the flow.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1668.1">
     When a certain
    </span>
    <a id="_idIndexMarker452">
    </a>
    <span class="koboSpan" id="kobo.1669.1">
     number or percentage of failures is detected, the pattern opens the faulty circuit or component and redirects all requests to a fallback routine.
    </span>
    <span class="koboSpan" id="kobo.1669.2">
     After some time, it tries again, and if not all but some requests succeed, then it assumes the state of half open.
    </span>
    <span class="koboSpan" id="kobo.1669.3">
     Then, depending on the stability of the subsequent requests, it can open or close, and so on.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1670.1">
     Some frameworks also allow you to ignore certain types of failures (Java exceptions) and only count specific ones, offering more control over how the system responds to avoid issues.
    </span>
    <span class="koboSpan" id="kobo.1670.2">
     Depending on the library or framework you choose, the circuit breaker configuration can have an extensive list of parameters to customize how the circuit breaker needs to behave.
    </span>
    <span class="koboSpan" id="kobo.1670.3">
     In the following figure, we have an illustration of the workflow and an example of the Resilience4j configuration for our circuit breaker.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1671.1">
     <img alt="Figure 6.1 – Circuit breaker flow" src="../Images/B21843_06_1.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1672.1">
     Figure 6.1 – Circuit breaker flow
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1673.1">
     The following
    </span>
    <a id="_idIndexMarker453">
    </a>
    <span class="koboSpan" id="kobo.1674.1">
     is an example
    </span>
    <a id="_idIndexMarker454">
    </a>
    <span class="koboSpan" id="kobo.1675.1">
     of implementation using Resilience4j:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1676.1">CircuitBreakerRegistry</span></span><span class="koboSpan" id="kobo.1677.1"> circuitBreakerRegistry = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1678.1">CircuitBreakerRegistry</span></span><span class="koboSpan" id="kobo.1679.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1680.1">ofDefaults</span></span><span class="koboSpan" id="kobo.1681.1">();
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1682.1">// Configure the CircuitBreaker</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1683.1">CircuitBreakerConfig</span></span><span class="koboSpan" id="kobo.1684.1"> circuitBreakerConfig = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1685.1">CircuitBreakerConfig</span></span><span class="koboSpan" id="kobo.1686.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1687.1">ofDefaults</span></span><span class="koboSpan" id="kobo.1688.1">()
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1689.1">failureRateThreshold</span></span><span class="koboSpan" id="kobo.1690.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1691.1">50</span></span><span class="koboSpan" id="kobo.1692.1">) </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1693.1">// 50% failure rate</span></span><span class="koboSpan" id="kobo.1694.1">
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1695.1">waitDurationInOpenState</span></span><span class="koboSpan" id="kobo.1696.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1697.1">Duration</span></span><span class="koboSpan" id="kobo.1698.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1699.1">ofSeconds</span></span><span class="koboSpan" id="kobo.1700.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1701.1">10</span></span><span class="koboSpan" id="kobo.1702.1">))
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1703.1">slowCallDurationThreshold</span></span><span class="koboSpan" id="kobo.1704.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1705.1">Duration</span></span><span class="koboSpan" id="kobo.1706.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1707.1">ofSeconds</span></span><span class="koboSpan" id="kobo.1708.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1709.1">5</span></span><span class="koboSpan" id="kobo.1710.1">));
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1711.1">// Create a CircuitBreaker instance</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1712.1">CircuitBreaker</span></span><span class="koboSpan" id="kobo.1713.1"> circuitBreaker = circuitBreakerRegistry.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1714.1">circuitBreaker</span></span><span class="koboSpan" id="kobo.1715.1">(
</span><span class="hljs-title">    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1716.1">"circuitService"</span></span><span class="koboSpan" id="kobo.1717.1">, circuitBreakerConfig);
 
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1718.1">// Use the CircuitBreaker to protect a downstream service call</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1719.1">try</span></span><span class="koboSpan" id="kobo.1720.1"> {
    circuitBreaker.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1721.1">decorateSupplier</span></span><span class="koboSpan" id="kobo.1722.1">(() -&gt; downstreamService.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1723.1">call</span></span><span class="koboSpan" id="kobo.1724.1">()).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1725.1">get</span></span><span class="koboSpan" id="kobo.1726.1">();
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1727.1">catch</span></span><span class="koboSpan" id="kobo.1728.1"> (</span><span class="hljs-title"><span class="koboSpan" id="kobo.1729.1">CircuitBreakerOpenException</span></span><span class="koboSpan" id="kobo.1730.1"> e) {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1731.1">// Fallback or other suitable action</span></span><span class="koboSpan" id="kobo.1732.1">
} 
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1733.1">
     This code sets up a Resilience4j circuit breaker to monitor a downstream service call.
    </span>
    <span class="koboSpan" id="kobo.1733.2">
     It does the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1734.1">
      Opens after the service fails more than 50% of the time
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1735.1">
      Remains open for 10 seconds before allowing test requests
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1736.1">
      Treats calls taking longer than five seconds as failures
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1737.1">
     By using the circuit breaker pattern, the API becomes more resilient, as it limits repeated calls to failing services and recovers once the service stabilizes.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1738.1">
     In the previous example, we saw how a circuit breaker can help manage failures in downstream services, protecting the API by isolating and handling service disruptions.
    </span>
    <span class="koboSpan" id="kobo.1738.2">
     However, implementing
    </span>
    <a id="_idIndexMarker455">
    </a>
    <span class="koboSpan" id="kobo.1739.1">
     circuit breakers within each API service can
    </span>
    <a id="_idIndexMarker456">
    </a>
    <span class="koboSpan" id="kobo.1740.1">
     lead to duplicated code and maintenance challenges, especially in larger systems with multiple services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1741.1">
     Let us explore this further by understanding a different way of implementing a circuit breaker that is implemented at the level of the system gateway.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-157">
    <a id="_idTextAnchor169">
    </a>
    <span class="koboSpan" id="kobo.1742.1">
     Circuit breaker implemented in the gateway
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1743.1">
     A gateway functions as a central control point for managing communication between various services
    </span>
    <a id="_idIndexMarker457">
    </a>
    <span class="koboSpan" id="kobo.1744.1">
     or systems.
    </span>
    <span class="koboSpan" id="kobo.1744.2">
     This makes it an optimal location for implementing patterns such as circuit breakers, rate limiting, and file upload validation.
    </span>
    <span class="koboSpan" id="kobo.1744.3">
     By incorporating these mechanisms at the gateway level, operational concerns are separated from business logic, allowing for isolation and promoting the standardization of system configurations, all managed through the gateway.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1745.1">
     Here are
    </span>
    <a id="_idIndexMarker458">
    </a>
    <span class="koboSpan" id="kobo.1746.1">
     some benefits of implementing a circuit breaker on a gateway:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1747.1">
       Centralized control
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1748.1">
      : A single circuit breaker can protect multiple downstream services, simplifying management and monitoring
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1749.1">
       Improved resilience
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1750.1">
      : By isolating failing services, a circuit breaker can prevent cascading failures and maintain overall system stability
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1751.1">
       Reduced latency
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1752.1">
      : When a service is deemed unhealthy, the circuit breaker can quickly return a fallback response, reducing latency for clients
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1753.1">
       Enhanced reliability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1754.1">
      : A circuit breaker can help ensure that critical services remain available even in the face of temporary failures
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1755.1">
     The circuit breaker pattern is a crucial tool for building reliable and stable APIs, especially those that rely on multiple services or external APIs.
    </span>
    <span class="koboSpan" id="kobo.1755.2">
     You should consider using this pattern in several key situations to enhance resilience and stability.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1756.1">
     Firstly, when building distributed systems or microservices, distinct parts of your application communicate with each other through APIs.
    </span>
    <span class="koboSpan" id="kobo.1756.2">
     In such setups, if one service becomes slow or fails, it can negatively impact the entire system.
    </span>
    <span class="koboSpan" id="kobo.1756.3">
     By implementing a circuit breaker, you can monitor these API calls and stop attempts to communicate with the failing service temporarily.
    </span>
    <span class="koboSpan" id="kobo.1756.4">
     This prevents one service’s issues from causing a domino effect, ensuring that other parts of the system continue to function smoothly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1757.1">
     Another important scenario is when your application relies on external services.
    </span>
    <span class="koboSpan" id="kobo.1757.2">
     Many applications depend on third-party APIs, such as payment gateways, social media platforms, or data providers.
    </span>
    <span class="koboSpan" id="kobo.1757.3">
     These external services can sometimes experience downtime or slow responses due to several reasons, such as maintenance or high traffic.
    </span>
    <span class="koboSpan" id="kobo.1757.4">
     A circuit breaker helps by detecting these failures early and avoiding long waits for responses that may never come.
    </span>
    <span class="koboSpan" id="kobo.1757.5">
     Instead, your application can provide fallback options, such as default messages or alternative actions, maintaining a good user experience even when external services are unreliable.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1758.1">
     To prevent
    </span>
    <a id="_idIndexMarker459">
    </a>
    <span class="koboSpan" id="kobo.1759.1">
     transaction failures, systems often cache frequently calculated values such as delivery tax, which may depend on external services.
    </span>
    <span class="koboSpan" id="kobo.1759.2">
     In situations where a quick response is crucial, a cached value can serve as a fallback option, avoiding lost transactions.
    </span>
    <span class="koboSpan" id="kobo.1759.3">
     A circuit breaker pattern can be effectively used to manage these scenarios.
    </span>
    <span class="koboSpan" id="kobo.1759.4">
     Promote a fallback solution until the part of the circuit that is opened gets to a normal state again.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1760.1">
     Circuit breakers help prevent system failures by stopping repeated attempts at unsuccessful operations.
    </span>
    <span class="koboSpan" id="kobo.1760.2">
     However, sometimes we need to isolate different parts of our system to prevent resource exhaustion.
    </span>
    <span class="koboSpan" id="kobo.1760.3">
     This is where the bulkhead pattern becomes valuable.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-158">
    <a id="_idTextAnchor170">
    </a>
    <span class="koboSpan" id="kobo.1761.1">
     Bulkhead
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1762.1">
     Imagine you have a system where one small part fails, but you do not want the entire system to go down because of it.
    </span>
    <span class="koboSpan" id="kobo.1762.2">
     This is where the bulkhead pattern comes in.
    </span>
    <span class="koboSpan" id="kobo.1762.3">
     Let us explore how this pattern
    </span>
    <a id="_idIndexMarker460">
    </a>
    <span class="koboSpan" id="kobo.1763.1">
     helps improve fault tolerance and keeps your system running smoothly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1764.1">
     The bulkhead
    </span>
    <a id="_idIndexMarker461">
    </a>
    <span class="koboSpan" id="kobo.1765.1">
     pattern is inspired by ships.
    </span>
    <span class="koboSpan" id="kobo.1765.2">
     Ships have bulkheads, which are walls that divide the ship into separate sections.
    </span>
    <span class="koboSpan" id="kobo.1765.3">
     If one section takes on water, the bulkheads prevent the water from spreading to other parts of the ship.
    </span>
    <span class="koboSpan" id="kobo.1765.4">
     This keeps the ship from sinking entirely.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1766.1">
     In software, the bulkhead pattern works similarly by dividing an application into various parts or services that operate independently.
    </span>
    <span class="koboSpan" id="kobo.1766.2">
     If one part fails or slows down, the other parts continue to function without any issues.
    </span>
    <span class="koboSpan" id="kobo.1766.3">
     This isolation ensures that a problem in one area does not affect the entire system.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1767.1">
     As mentioned, the bulkhead pattern is a structural design pattern used to partition a system into isolated units or modules.
    </span>
    <span class="koboSpan" id="kobo.1767.2">
     Each module can handle its own load and failures independently, ensuring that an issue in one does not cascade to others.
    </span>
    <span class="koboSpan" id="kobo.1767.3">
     This isolation can be applied at
    </span>
    <a id="_idIndexMarker462">
    </a>
    <span class="koboSpan" id="kobo.1768.1">
     various levels, such as the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1769.1">
       Service level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1770.1">
      : Separating different microservices within an architecture
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1771.1">
       Resource level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1772.1">
      : Allocating separate thread pools, memory, or database connections to different components
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1773.1">
       Functional level
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1774.1">
      : Dividing functionalities within a service to prevent one failing feature from affecting others
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1775.1">
     The key
    </span>
    <a id="_idIndexMarker463">
    </a>
    <span class="koboSpan" id="kobo.1776.1">
     characteristics of this pattern include the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1777.1">
       Isolation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1778.1">
      : Ensures that failures in one compartment do not impact others
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1779.1">
       Resource allocation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1780.1">
      : Allocates separate resources to each compartment to prevent resource exhaustion from affecting the entire system
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1781.1">
       Fault tolerance
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1782.1">
      : Enhances the system’s ability to handle partial failures gracefully
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1783.1">
     A common example of using the bulkhead pattern is managing “hot paths” in your system.
    </span>
    <span class="koboSpan" id="kobo.1783.2">
     Hot paths are parts of your system that receive more traffic than others.
    </span>
    <span class="koboSpan" id="kobo.1783.3">
     If a hot path gets too many requests, it can overload that part of the system, causing it to slow down or crash.
    </span>
    <span class="koboSpan" id="kobo.1783.4">
     This can make the
    </span>
    <a id="_idIndexMarker464">
    </a>
    <span class="koboSpan" id="kobo.1784.1">
     entire system unresponsive, affecting users who are not using the hot path.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1785.1">
     To understand how the bulkhead pattern enhances resilience, we will dive into different areas where this approach can be applied effectively.
    </span>
    <span class="koboSpan" id="kobo.1785.2">
     By isolating components, we can prevent failures in one part of the system from affecting the entire application.
    </span>
    <span class="koboSpan" id="kobo.1785.3">
     This flexibility allows us to apply the bulkhead pattern across various levels, such as services, resources, and functionalities, making it a versatile solution for fault tolerance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1786.1">
     Let’s explore some practical ways to implement bulkheads in different system architectures and at different levels, from monolithic systems to microservices, as well as through database and queue management.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-159">
    <a id="_idTextAnchor171">
    </a>
    <span class="koboSpan" id="kobo.1787.1">
     Implementing bulkhead in different architectures
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1788.1">
     You can
    </span>
    <a id="_idIndexMarker465">
    </a>
    <span class="koboSpan" id="kobo.1789.1">
     apply the bulkhead pattern whether you are using a monolithic architecture or microservices:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1790.1">
       Monolithic systems
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1791.1">
      : Even if your system is a single application, you can create isolation by directing heavy traffic to specific instances.
     </span>
     <span class="koboSpan" id="kobo.1791.2">
      For example, you can have certain instances handle the hot paths while other instances manage different parts of the system.
     </span>
     <span class="koboSpan" id="kobo.1791.3">
      This way, if the hot path gets overloaded, the rest of the system remains unaffected.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1792.1">
       Microservices
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1793.1">
      : In a microservices architecture, each service can act as a separate bulkhead.
     </span>
     <span class="koboSpan" id="kobo.1793.2">
      If one service fails, the others continue to operate normally.
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-160">
    <a id="_idTextAnchor172">
    </a>
    <span class="koboSpan" id="kobo.1794.1">
     Implementing the bulkhead pattern through database isolation
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1795.1">
     Another way to implement the bulkhead pattern is by isolating your databases.
    </span>
    <span class="koboSpan" id="kobo.1795.2">
     Instead of using a
    </span>
    <a id="_idIndexMarker466">
    </a>
    <span class="koboSpan" id="kobo.1796.1">
     single database that handles all requests, you can create separate database instances for different parts of your system.
    </span>
    <span class="koboSpan" id="kobo.1796.2">
     For example, a high-traffic feature can have its own database, preventing it from overwhelming the main database and affecting other features.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-161">
    <a id="_idTextAnchor173">
    </a>
    <span class="koboSpan" id="kobo.1797.1">
     Implementing the bulkhead pattern through queue management
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1798.1">
     You
    </span>
    <a id="_idIndexMarker467">
    </a>
    <span class="koboSpan" id="kobo.1799.1">
     can also apply isolation to message queues by creating different queues with varying priorities.
    </span>
    <span class="koboSpan" id="kobo.1799.2">
     High-priority queues can be monitored and scaled independently to ensure they process messages quickly, while standard queues operate normally.
    </span>
    <span class="koboSpan" id="kobo.1799.3">
     This prevents a surge in one queue from impacting others.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-162">
    <a id="_idTextAnchor174">
    </a>
    <span class="koboSpan" id="kobo.1800.1">
     External services and throttling
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1801.1">
     When your system makes calls to external services, latency and timeouts can cause problems.
    </span>
    <span class="koboSpan" id="kobo.1801.2">
     By using the
    </span>
    <a id="_idIndexMarker468">
    </a>
    <span class="koboSpan" id="kobo.1802.1">
     bulkhead pattern, you can limit the number of external requests, ensuring that slow responses from third-party services do not overwhelm your system.
    </span>
    <span class="koboSpan" id="kobo.1802.2">
     Implementing throttling in your code can help manage the flow of these requests effectively.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1803.1">
     Using the bulkhead
    </span>
    <a id="_idIndexMarker469">
    </a>
    <span class="koboSpan" id="kobo.1804.1">
     pattern increases your system’s resilience and availability.
    </span>
    <span class="koboSpan" id="kobo.1804.2">
     It makes your system easier to manage by isolating different parts.
    </span>
    <span class="koboSpan" id="kobo.1804.3">
     However, adding bulkheads also introduces some complexity.
    </span>
    <span class="koboSpan" id="kobo.1804.4">
     You need to carefully design your system to ensure that the added complexity is justified by the improved fault tolerance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1805.1">
     The bulkhead resilience pattern is a powerful technique for building robust and reliable systems.
    </span>
    <span class="koboSpan" id="kobo.1805.2">
     By creating isolation between different parts of your architecture, you can prevent small failures from cascading and affecting the entire system.
    </span>
    <span class="koboSpan" id="kobo.1805.3">
     Whether you are working with monolithic applications or microservices, the bulkhead pattern can enhance your system’s stability and performance.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1806.1">
     The bulkhead pattern is a strong architectural method used for designing and building APIs.
    </span>
    <span class="koboSpan" id="kobo.1806.2">
     It helps make systems more resilient, scalable, and able to handle faults.
    </span>
    <span class="koboSpan" id="kobo.1806.3">
     Separating distinct parts of the system keeps failures limited, uses resources efficiently, and ensures the system stays strong even if some parts go down.
    </span>
    <span class="koboSpan" id="kobo.1806.4">
     However, it is important to weigh these benefits against the extra complexity and resource use it can bring.
    </span>
    <span class="koboSpan" id="kobo.1806.5">
     Careful planning, managing resources well, and continuous monitoring are key to successfully using the bulkhead pattern in your API design.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-163">
    <a id="_idTextAnchor175">
    </a>
    <span class="koboSpan" id="kobo.1807.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1808.1">
     This chapter covered two important areas for building strong RESTful APIs: data handling and resilience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1809.1">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1810.1">
      Data handling
     </span>
    </em>
    <span class="koboSpan" id="kobo.1811.1">
     section focused on managing large amounts of data efficiently.
    </span>
    <span class="koboSpan" id="kobo.1811.2">
     Key techniques include pagination, which splits data into smaller pages to improve performance, and filtering, which allows clients to request only the data they need.
    </span>
    <span class="koboSpan" id="kobo.1811.3">
     The chapter also explained how to handle file uploads and downloads securely, ensuring that APIs can manage large files without slowing down.
    </span>
    <span class="koboSpan" id="kobo.1811.4">
     Additionally, we introduced HATEOAS, which adds navigational links to API responses, making it easier for clients to interact with the API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1812.1">
     The
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1813.1">
      Resilience
     </span>
    </em>
    <span class="koboSpan" id="kobo.1814.1">
     section showed us how we can keep APIs stable and reliable under various conditions.
    </span>
    <span class="koboSpan" id="kobo.1814.2">
     Important strategies included setting timeouts to avoid long wait times, using retry mechanisms to handle temporary failures, and implementing rate limiting to prevent abuse and manage traffic.
    </span>
    <span class="koboSpan" id="kobo.1814.3">
     Throttling helps control the flow of requests, while idempotency keys ensure that repeated requests do not cause errors.
    </span>
    <span class="koboSpan" id="kobo.1814.4">
     Advanced patterns, such as circuit breakers, stop failing requests to protect the system, and bulkheads isolate different parts of the API to prevent failures from spreading.
    </span>
    <span class="koboSpan" id="kobo.1814.5">
     By applying these resilience techniques, APIs can maintain high performance and reliability even during unexpected challenges.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1815.1">
     Overall, by focusing on effective data handling and robust resilience strategies, developers can create APIs that are both efficient and dependable, capable of supporting growing applications and delivering a consistent user experience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1816.1">
     Now that you have mastered advanced API concepts and implementations, the journey ahead will focus on securing, testing, and deploying your APIs in production environments.
    </span>
    <a href="B21843_07.xhtml#_idTextAnchor176">
     <em class="italic">
      <span class="koboSpan" id="kobo.1817.1">
       Chapter 7
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.1818.1">
     will guide you through securing your RESTful APIs against common vulnerabilities and attacks, teaching you to implement HTTPS encryption, proper authentication and authorization mechanisms, JWT tokens, and protection against OWASP vulnerabilities and CORS issues.
    </span>
    <a href="B21843_08.xhtml#_idTextAnchor223">
     <em class="italic">
      <span class="koboSpan" id="kobo.1819.1">
       Chapter 8
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.1820.1">
     shifts focus to comprehensive testing strategies, covering everything from Spring MVC unit testing to integration testing, GenAI-assisted test creation, and contract testing to ensure API reliability.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1821.1">
     These upcoming chapters will transform your APIs from functional prototypes into secure, well-tested services ready for production deployment.
    </span>
    <span class="koboSpan" id="kobo.1821.2">
     By the end of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1822.1">
      Part 2
     </span>
    </em>
    <span class="koboSpan" id="kobo.1823.1">
     , you will have the knowledge to build APIs that not only perform well but also protect user data and maintain reliability under various conditions, preparing you for the final part of the book, which covers deployment and performance optimization.
    </span>
   </p>
  </div>
 </body></html>