- en: Chapter 12. Role-based Access Control with WildFly
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第12章. 使用WildFly进行基于角色的访问控制
- en: 'In this chapter, you will learn the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将学习以下菜谱：
- en: Switching between simple and RBAC providers
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在简单和RBAC提供者之间切换
- en: Managing users, groups, and their role mapping
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理用户、组和它们的角色映射
- en: Setting a predefined role to all authenticated users
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将预定义的角色设置给所有已认证用户
- en: Granting user access by server group or host – scoped roles
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通过服务器组或主机范围授予用户访问权限 - 范围角色
- en: Integrating with OpenLDAP
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与OpenLDAP集成
- en: Introduction
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: 'In this chapter, you will learn how to improve your WildFly management console
    by providing a fine-grained access control mechanism. WildFly comes with two built-in
    providers: one is called simple, which is the default one and the second one is
    called RBAC—as you guessed, it stands for **role-based access control**.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，你将学习如何通过提供细粒度的访问控制机制来改进WildFly管理控制台。WildFly附带两个内置提供者：一个是称为simple，它是默认的；另一个称为RBAC——正如你所猜到的，它代表**基于角色的访问控制**。
- en: Switching to the RBAC provider means you can control what a user can do and
    see, and what kinds of operations the user is allowed to perform. Using the RBAC
    provider, you are basically sharing responsibility with different users. You might
    want some users to just make deployments, others to occasionally monitor the overall
    system, and so on. Furthermore, we will see how to integrate RBAC with an LDAP
    system (which provides users and groups), and mapping them to the WildFly roles.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 切换到RBAC提供者意味着你可以控制用户可以做什么和看到什么，以及用户被允许执行的操作类型。使用RBAC提供者，你基本上是在与不同用户分担责任。你可能希望一些用户只进行部署，其他人偶尔监控整个系统，等等。此外，我们将看到如何将RBAC与一个提供用户和组的LDAP系统（WildFly角色）集成。
- en: 'WildFly comes with a set of predefined roles, each one having a specific permission.
    These roles are as follows:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: WildFly附带一组预定义的角色，每个角色都有特定的权限。这些角色如下：
- en: '**Monitor**: As the name may suggest, this role can just view the state of
    the server, but it cannot see sensitive data, such as passwords.'
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控员**：正如其名可能暗示的，这个角色只能查看服务器状态，但不能查看敏感数据，如密码。'
- en: '**Operator**: This role has the same permissions as those provided by the monitor,
    plus it can stop and start a server, or pause runtime services such as JMS destinations.
    You would typically give such a role to people who are responsible for managing
    a specific server instance. Still, an operator cannot see sensitive data, such
    as passwords.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**操作员**：这个角色具有与监控器提供的相同权限，还可以停止和启动服务器，或者暂停运行时服务，如JMS目的地。通常，你会将这样的角色授予负责管理特定服务器实例的人员。然而，操作员无法查看敏感数据，如密码。'
- en: '**Maintainer**: This role has the permissions to view and edit all the runtime
    states and all configurations, besides sensitive data. Users with such a role
    can manage almost the entire system.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**维护者**：这个角色有权查看和编辑所有运行时状态和所有配置，除了敏感数据。具有这种角色的用户可以管理几乎整个系统。'
- en: '**Deployer**: This role is like the monitor role, plus it can read and modify
    the configuration and the state of deployments.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**部署者**：这个角色类似于监控器角色，还可以读取和修改部署的配置和状态。'
- en: '**Auditor**: This role is like the monitor role, plus it can view sensitive
    data. It also has access to the audit logging subsystem.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**审计员**：这个角色类似于监控器角色，还可以查看敏感数据。它还可以访问审计日志子系统。'
- en: '**Administrator**: This role can do anything, view and modify everything except
    the audit logging subsystem. The administrator can also configure the RBAC provider.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**管理员**：这个角色可以做任何事情，查看和修改一切，除了审计日志子系统。管理员还可以配置RBAC提供者。'
- en: '**SuperUser**: This is the most powerful role. It can view and modify resources,
    state, and sensitive data. This role is the one that was used before the RBAC
    was introduced.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**超级用户**：这是最强大的角色。它可以查看和修改资源、状态和敏感数据。这个角色是在引入RBAC之前使用的。'
- en: These roles can be combined together to form a group of roles, which can be
    used by a specific user.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 这些角色可以组合在一起形成一个角色组，该角色组可以被特定用户使用。
- en: Switching between simple and RBAC providers
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在简单和RBAC提供者之间切换
- en: In this recipe, we will learn how to switch from the simple provider to the
    RBAC provider. RBAC provides a fine-grained access control to our management console.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个菜谱中，我们将学习如何从简单提供者切换到RBAC提供者。RBAC为我们提供了细粒度的访问控制。
- en: Getting ready
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: 'To get started, let''s first create an `ad-hoc` folder to run our WildFly.
    In a terminal window, execute the following commands:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，让我们首先创建一个`ad-hoc`文件夹来运行我们的WildFly。在终端窗口中，执行以下命令：
- en: '[PRE0]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Now it's time to run our WildFly!!!
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-25
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Perform the following steps:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a terminal window and enter the following commands:'
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Once started, in a new terminal window, connect to the CLI and switch to the
    RBAC provider, as follows:'
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Great, we successfully switched to the RBAC provider.
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'In our `standalone.xml` file, we should find the following definition:'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'To switch back to the `simple` provider, do as follows:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'In our `standalone.xml` file, we should find the following definition:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: That's it, pretty easy so far!!!
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: This approach is pretty easy and straightforward; there is not much to talk
    about except its usage. The preceding example is just the first step. As a matter
    of fact, if you try to access the console after you switch to the `RBAC` provider,
    you are not able to log in.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: 'Try it!!! Open the browser and point it to `http://localhost:9990`. Enter the
    username and password that we specified at the beginning of the book: `wildfly`
    as the username and `cookbook.2015` as the password.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: See, you cannot log in. How to resolve this?
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: From the preceding XML code snippet, you should have noticed the directive `include`
    referring the user named `$local`. In this case, `$local` means the users defined
    within the `ManagementRealm` and `ApplicationRealm` realms, but with no privileges
    at all to access the console.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: 'What we should do, is add our `wildfly` user from `ManagementRealm` in the
    `include` XML element, as follows:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'The preceding commands generate the following XML code into our `standalone.xml`
    file:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-47
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Now if we try to access the console as usual, we should be able to log in successfully.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Regardless the providers that you have chosen, once logged in, you can see
    the role of your user, by clicking on the username, displayed on the top-right
    corner of the web console:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more…](img/3744_12_01.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
- en: Displaying current logged user's role
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, we have a role called **SuperUser**. Looking a little bit further,
    there is an interesting link **Run as…** which should intrigue you. Let's click
    it!
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more…](img/3744_12_02.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
- en: Run as role selection role pop-up
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: Try to play around with it to better understand the different roles and the
    permissions you get. For example, try to deploy an application using the **Monitor**
    role, or check if you can view or edit the username and password of a datasource.
    Be curious!
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: Managing users, groups, and their role mapping
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to manage users, groups, and their relative
    mapping to the WildFly roles. We will perform most of the tasks from within the
    Web Console.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started, let''s first create an `ad-hoc` folder to run our WildFly.
    In a terminal window, execute the following commands:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now it's time to run our WildFly.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Open a terminal window and enter the following commands:'
  id: totrans-64
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Once started, connect to the CLI and switch to the RBAC provider in a new terminal
    window as we did in the previous recipe:'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Now that we''ve successfully switched to the RBAC provider, we need to map
    our local management user (if you''ve been following the book, you''ll know it
    is **wildfly**) to the **SuperUser** role, as follows:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Okay, we can now access the Web Console, and see how we can manage users, groups,
    and their relative mappings.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: Users
  id: totrans-71
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Let''s first add some users:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: 'In a new terminal window, execute the following commands:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Okay, now let's open the browser and point it to `http://localhost:9990`.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once logged in as the **wildfly** user, click on the Administration tab and
    you should see a page like the following:![Users](img/3744_12_03.jpg)
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Displaying RBAC users
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Our **wildfly** user is there. Let's add the user `devguy` by clicking on the
    button labeled **Add**, and filling in the form as follows:![Users](img/3744_12_04.jpg)
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: RBAC form for adding a user and its roles
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Confirm by clicking the **Save** button. Now we should have the new user added
    to the list, as depicted in the next image:![Users](img/3744_12_05.jpg)
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Displaying the newly added user devguy
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'If we cannot access the Web Console for any reason, we can rely on the CLI,
    and specify the following commands:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Let''s add the other users, `opsguy`, `devopsguy`, and `pmguy`, giving them
    appropriate roles:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '`opsguy`: Roles of the maintainer and operator'
  id: totrans-85
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`devopsguy`: Role of the administrator'
  id: totrans-86
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '`pmguy`: Role of the monitor'
  id: totrans-87
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: You should have the following list:![Users](img/3744_12_06.jpg)
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: List of users
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now that we've entered all our users, let's try one of them.
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: So log out and log back in with the user `pmguy`. Once we are back in, let's
    go to the **Deployments** tab. You see a page similar to the following:![Users](img/3744_12_07.jpg)
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deployments page without any buttons to alter deployments
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: As you can see, we cannot manage our deployments, we cannot remove or disable
    them, nor can we deploy new applications.
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Let's go back to our **Administration** tab and see if we can add a more powerful
    role:![Users](img/3744_12_08.jpg)
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Administration page warning about Authorization Required
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We can't; only users with the Administrator and SuperUser roles can.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: Groups
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As we saw, every role has specific permissions on what you can and can't do,
    and on what you can and cannot see. Despite the simple mapping user roles, you
    can manage and combine multiple roles under a specific group.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s create two groups: `development` and `operations`:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: If you are still logged in as the `pmguy` user, log off and log back in with
    as the `wildfly` user.
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once there, go to the **Administration** tab and click **Groups**:![Groups](img/3744_12_09.jpg)
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Displaying RBAC groups
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Add the two groups by clicking the **Add** button, as follows:![Groups](img/3744_12_10.jpg)
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating the Development group
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the preceding screenshot, we are selecting the **Deployer** and the **Operator**
    roles from the list of WildFly's built-in roles, and giving them to the **Development**
    group.![Groups](img/3744_12_11.jpg)
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Creating the Operations group
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the preceding screenshot, we are selecting the **Maintainer** and the **Operator**
    roles from the list of WildFly's built-in roles, and giving them to the **Operations**
    group.
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now we should have the following entries in our `group-roles` table:![Groups](img/3744_12_12.jpg)
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: List of groups
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Our `standalone.xml` file should have the following definition:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: As you can see, the groups too have been included in the appropriate role. Now
    we need to give a group to a user. With our configuration, we could give the **Development**
    group to the `devguy` user, and the **Operations** group to the `opsguy`.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
- en: 'As we are dealing with users that belong to **ManagementRealm** to accomplish
    this task from the command line, we can follow two different ways:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: 'Insert the user again, using the `add-user.sh` script and passing the group,
    as follows:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Adding the user directly to the `mgmt-groups.properties` file, as follows:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Note
  id: totrans-118
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Because we could potentially have tens, hundreds, and thousands of users, we
    probably do not want to map a role for every user, but instead, map a set of roles
    to a group, and map users to that group. This is the kind of scenario that we
    find in a corporate having its users stored in an `Active Directory` or LDAP stores—we
    will dive into integrating the LDAP store later in this chapter.
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Having said that, let's remove the role mapping for the users `devguy` and `opsguy`.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: We can do this from the Web Console, by selecting the user and clicking on the
    **Remove** button.
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once done, we should have the following scenario:![Groups](img/3744_12_13.jpg)
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: List of users
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now we should be able to log out and log back in with the user `devguy`.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once done, let's click on the `devguy` link on the top-right corner of the page,
    and we should see his roles, as follows:![Groups](img/3744_12_14.jpg)
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Displaying user's roles
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Let's try this with the other user, `opsguy`. If everything is fine, we should
    see his roles as well.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  id: totrans-128
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Users and groups management is simplified by the Web Console; nevertheless,
    we still need some tasks to be done outside the Web Console, like mapping users
    to groups. By the way, here is the main process:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
- en: We need a user capable of accessing the RBAC administration page and adding/removing
    users and groups—just like our WildFly SuperUser
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: We need to add users or groups and map them to the appropriate role
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Users have to be present in a store, like the properties file and LDAP (both
    stores are supported by WildFly); we used the `add-user.sh` script to silently
    add users, along with their realm
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting a predefined role to all authenticated users
  id: totrans-133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to set a predefined role to all authenticated
    users. This setting might be handy when you have a large user base and you don't
    have a complete view of all users and groups that are present in the the identity
    store. So instead of not authorizing some users, you may want to give them the
    simplest and the least privileges.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started, let''s first create an `ad-hoc` folder to run our WildFly.
    In a terminal window execute the following commands:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，让我们首先创建一个`ad-hoc`文件夹来运行我们的WildFly。在终端窗口中执行以下命令：
- en: '[PRE17]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Now it's time to run our WildFly!
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候运行我们的WildFly了！
- en: How to do it…
  id: totrans-139
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作…
- en: 'Open a terminal window and enter the following commands:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个终端窗口并输入以下命令：
- en: '[PRE18]'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Once started, in a new terminal window, connect to the CLI and switch to the
    RBAC provider as we did in the previous recipe:'
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦启动，在新终端窗口中连接到CLI并切换到RBAC提供者，就像我们之前的方法一样：
- en: '[PRE19]'
  id: totrans-143
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Now that we''ve successfully switched to the RBAC provider, we need to map
    our local management user (if you are following the book, the local management
    user is `wildfly`) to the **SuperUser** role, as follows:'
  id: totrans-144
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们已经成功切换到RBAC提供者，我们需要将我们的本地管理用户（如果您正在遵循本书，本地管理用户是`wildfly`）映射到**SuperUser**角色，如下所示：
- en: '[PRE20]'
  id: totrans-145
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Now we need to add some users, just to simulate the users whom we didn''t consider
    as having access to our system; in a new terminal window, execute the following
    commands:'
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在我们需要添加一些用户，只是为了模拟我们没有考虑为系统提供访问权限的用户；在新的终端窗口中，执行以下命令：
- en: '[PRE21]'
  id: totrans-147
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Okay, we can now access the Web Console and see how we can manage those kinds
    of users, by giving them the default role.
  id: totrans-148
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 好的，我们现在可以访问Web控制台并查看我们如何通过给他们默认角色来管理这类用户。
- en: Let's open the browser and point it to `http://localhost:9990`.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们打开浏览器并将它指向`http://localhost:9990`。
- en: Authenticate with the `wildfly` user and once there, click on the **Administration**
    tab and then on the **Roles** section.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`wildfly`用户进行认证，一旦登录，点击**管理**标签，然后点击**角色**部分。
- en: Then, select the **Monitor** role, click the **Edit** link, and mark the **Include
    All** check, as follows:![How to do it…](img/3744_12_15.jpg)
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，选择**Monitor**角色，点击**编辑**链接，并标记**包含所有**复选框，如下所示：![如何操作…](img/3744_12_15.jpg)
- en: Giving a default role to all authenticated users
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 为所有已认证用户分配默认角色
- en: Once you click **Save**, the selected role will be given as the default one
    to all authenticated users.![How to do it…](img/3744_12_16.jpg)
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您点击**保存**，所选角色将被分配给所有已认证用户的默认角色。![如何操作…](img/3744_12_16.jpg)
- en: List of roles
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 角色列表
- en: 'If we don''t have access to the Web Console, we can still rely on our CLI and
    issue the following commands:'
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果我们没有访问Web控制台，我们仍然可以依赖我们的CLI并发出以下命令：
- en: '[PRE22]'
  id: totrans-156
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Okay, let's try our settings by logging out and logging back in with the user
    `luigi`. Open the browser and point it to `http://localhost:9990`.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 好的，让我们通过注销并使用用户`luigi`重新登录来尝试我们的设置。打开浏览器并将它指向`http://localhost:9990`。
- en: Insert `luigi` as the username and `luigi.2015` as the password; we should end
    up with the following scenario:![How to do it…](img/3744_12_17.jpg)
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将`luigi`作为用户名，将`luigi.2015`作为密码；我们应该得到以下场景：![如何操作…](img/3744_12_17.jpg)
- en: User luigi mapped to the default role Monitor
  id: totrans-159
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 用户luigi映射到默认角色Monitor
- en: Neat!
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 很棒！
- en: How it works…
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的…
- en: There is not much to talk about as the process is pretty straightforward. Let's
    recap what we did and how we did it.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 由于过程相当直接，没有太多可说的。让我们回顾一下我们做了什么以及我们是如何做的。
- en: First we needed to switch the provider, passing it from `simple` to `rbac` using
    the CLI.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要切换提供者，使用CLI将`simple`切换到`rbac`。
- en: 'Secondly, we needed to include our management user `wildfly` to the **SuperUser**
    role, which resulted in the following configuration:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们需要将我们的管理用户`wildfly`添加到**SuperUser**角色中，这导致了以下配置：
- en: '[PRE23]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Then, we added the potential, unmanaged users to the `ManagementRealm` realm,
    using the `add-user.sh` script:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用`add-user.sh`脚本将潜在的非管理用户添加到`ManagementRealm`域中：
- en: '[PRE24]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The `--silent=true` command basically means non-interactive mode; we then passed
    the username followed by its password, and then we specified the path for storing
    our users. By default, the store is represented by the `mgmt-users.properties`
    file, which corresponds to the `ManagementRealm`, on the WildFly side.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '`--silent=true`命令基本上意味着非交互模式；然后我们传递用户名和密码，然后我们指定存储用户的路径。默认情况下，存储由`mgmt-users.properties`文件表示，对应于WildFly侧的`ManagementRealm`。'
- en: If we wanted to store the users in `ApplicationRealm`, we should have passed
    the option `-a` to the script. Furthermore, if we wanted to store the users' credentials
    into a different file, we could have passed the option `-up /path/filename.properties`.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们想要将用户存储在`ApplicationRealm`中，我们应该在脚本中传递了选项`-a`。此外，如果我们想要将用户的凭据存储到不同的文件中，我们可以传递选项`-up
    /path/filename.properties`。
- en: 'For a complete list of available options, issue the `add-user.sh` script passing
    the `--help` directive, as follows:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取所有可用选项的完整列表，请运行`add-user.sh`脚本并传递`--help`指令，如下所示：
- en: '[PRE25]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '![How it works…](img/3744_12_18.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
- en: Lastly, we made the monitor role the default one for all authenticated users.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
- en: Granting user access by server group or host – scoped roles
  id: totrans-174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to grant access to a user only in a specific
    server-group or host. This is available only in the domain mode, obviously. This
    feature takes the name of scoped roles, and it comes in very handy when you need
    to share your environment with multiple teams such as development teams. This
    way, every team can actually work on its server group or dedicated host, without
    interfering with the other server groups or hosts.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-176
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To get started, let''s first create an `ad-hoc` folder to run our WildFly.
    In a terminal window enter the following commands:'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Now it's time to run our WildFly.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Open a terminal window and execute the following commands:'
  id: totrans-181
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-182
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Once started, connect to the CLI in a new terminal window and switch to the
    RBAC provider, as we did in the previous recipe:'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-184
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Now that we''ve successfully switched to the RBAC provider, we need to map
    our `wildfly` user to the **SuperUser** role, as follows:'
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-186
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Now we can log in to our WildFly console and create the so called `scoped-roles`.
  id: totrans-187
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Log in to the WildFly Web Console and go to the **Administration** tab. Then
    select the **Roles** sub tab, and select the **Scoped Roles** section. The page
    is depicted as follows:![How to do it…](img/3744_12_19.jpg)
  id: totrans-188
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Administrative page of the scoped roles
  id: totrans-189
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now click the **Add** button and fill in the form as depicted in the following
    screenshot:![How to do it…](img/3744_12_20.jpg)
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Scoped Role adding form
  id: totrans-191
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once you submit the form by clicking on the **Save** button, the scoped role
    will be inserted and shown as per the following list:![How to do it…](img/3744_12_21.jpg)
  id: totrans-192
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: List displaying the dev-team-one scoped role
  id: totrans-193
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now it's time to create a user to map it to the scoped role created in the previous
    steps.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a terminal and execute the following commands:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Now we can add that user to the `dev-team-one` scoped role.
  id: totrans-197
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Let's go back to the WildFly Web Console, select the **Administration** tab,
    then the **Users** sub tab, and click the **Add** button. Fill in the form as
    depicted in the following image:![How to do it…](img/3744_12_22.jpg)
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once you save your changes, you should have the following list:![How to do it…](img/3744_12_23.jpg)
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now we can log out and log back in with the `user-dev-1` user and the password
    `devguy.2015`.
  id: totrans-200
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Now if you go to the **Domain** tab, in the **Overview** section (the menu
    item on the left), you will only see the topology of the server group that your
    user belongs to, as depicted in the following screenshot:'
  id: totrans-201
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_12_24.jpg)'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: That's it!
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  id: totrans-204
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: There is not much to talk about as the process is pretty straightforward. Let's
    recap what we did and how we did it.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
- en: First we needed to switch the provider, passing from `simple` to the `rbac`
    provider, using the CLI.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
- en: 'Secondly, we needed to include our management user `wildfly` to the **SuperUser**
    role, which resulted in the following configuration:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我们需要将我们的管理用户`wildfly`添加到**SuperUser**角色，这导致了以下配置：
- en: '[PRE31]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Then we logged into the WildFly Web Console with the user `wildfly`, and added
    our first scoped role. We mapped the scoped role to a server group, the one named
    `main-server-group` with the base role of `Deployer`.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们以用户`wildfly`的身份登录到WildFly Web控制台，并添加了我们的第一个范围角色。我们将范围角色映射到名为`main-server-group`的服务器组，其基本角色为`Deployer`。
- en: 'We could have also mapped our scoped role to a host by specifying the `Host`
    in the **Type** selection component, depicted as follows:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还可以通过在**类型**选择组件中指定`Host`，将我们的范围角色映射到主机，如下所示：
- en: '![How it works…](img/3744_12_25.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![如何工作…](img/3744_12_25.jpg)'
- en: As you can see, the scope of the role would have matched the host names available
    in our configuration, that is, `master` in our case.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，角色的范围将与我们的配置中可用的主机名相匹配，即在我们的情况下是`master`。
- en: 'Then, we added a user, using the `add- user.sh` script:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们使用`add-user.sh`脚本添加了一个用户：
- en: '[PRE32]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The `--silent=true` command basically means the non-interactive mode; we then
    passed the username followed by its password, and then we specified the path for
    storing users. By default, the store is represented by the `mgmt-users.properties`
    file, which corresponds to the `ManagementRealm`, on the WildFly side.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '`--silent=true`命令基本上意味着非交互模式；然后我们传递用户名和密码，然后指定存储用户的路径。默认情况下，存储由`mgmt-users.properties`文件表示，对应于WildFly侧的`ManagementRealm`。'
- en: Lastly, we mapped the `user-dev-1` to the scoped role, and we logged in with
    it.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们将`user-dev-1`映射到范围角色，并使用它登录。
- en: As a result, we had the WildFly Web Console available just to the server group
    specified in the scoped role, accordingly to the role assigned to it; in our case
    that was the `Deployer` role.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，WildFly Web控制台仅对指定在范围角色中的服务器组可用，相应地，它被分配了`Deployer`角色。
- en: Integrating with OpenLDAP
  id: totrans-218
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 与OpenLDAP集成
- en: In this recipe, you will learn how to integrate OpenLDAP to provide a user base
    for our RBAC provider. In an enterprise environment, you usually find databases
    where companies store their users. Those databases typically have some kind of
    structure which defines roles, profiles, and/or groups for each user.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个配方中，你将学习如何集成OpenLDAP为我们的RBAC提供者提供一个用户基础。在企业环境中，你通常会发现公司存储其用户的数据库。这些数据库通常具有某种结构，为每个用户定义角色、配置文件和/或组。
- en: For example, people connecting to a server may or may not see certain files
    or directories. People accessing an application may or may not find a particular
    functionality; that could be the case of the WildFly Web Console. LDAP is a protocol
    used by many databases that are used to store those users' grants. There are many
    of them such as the Microsoft Active Directory, but to keep us on track with the
    open source world, we will see and use the OpenLDAP tool.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，连接到服务器的用户可能看到或不看到某些文件或目录。访问应用程序的用户可能找到或不找到特定的功能；这可能就是WildFly Web控制台的情况。LDAP是一种由许多数据库使用的协议，用于存储这些用户的权限。有许多这样的数据库，例如Microsoft
    Active Directory，但为了保持我们与开源世界的同步，我们将查看和使用OpenLDAP工具。
- en: Getting ready
  id: totrans-221
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: For this recipe, you will use a ready-to-use OpenLDAP server as the installation
    of the OpenLDAP server is out of the scope of this book.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个配方，你将使用一个现成的OpenLDAP服务器，因为OpenLDAP服务器的安装超出了本书的范围。
- en: 'Nonetheless, we will use the LDAP structure defined in the following LDIF file:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，我们仍将使用以下LDIF文件中定义的LDAP结构：
- en: '[https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif](https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif)'
  id: totrans-224
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif](https://raw.githubusercontent.com/foogaro/wildfly-cookbook/master/rbac.ldif)'
- en: 'By the way, if you want a deep dive into OpenLDAP, you can rely on the excellent
    book *Mastering OpenLDAP: Configuring, Securing and Integrating Directory Services*,
    *Matt Butcher*, *Packt Publishing*.'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: '顺便说一下，如果您想深入了解OpenLDAP，您可以依靠优秀的书籍《Mastering OpenLDAP: Configuring, Securing
    and Integrating Directory Services》，作者：*Matt Butcher*，出版社：*Packt Publishing*。'
- en: 'To get started, let''s first create an `ad-hoc` folder to run our WildFly.
    In a terminal window enter the following commands:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始，我们首先创建一个`ad-hoc`文件夹来运行我们的WildFly。在终端窗口中输入以下命令：
- en: '[PRE33]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Now it's time to run our WildFly.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候运行我们的WildFly了。
- en: How to do it…
  id: totrans-229
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做到这一点…
- en: 'Open a terminal window and execute the following commands:'
  id: totrans-230
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开一个终端窗口并执行以下命令：
- en: '[PRE34]'
  id: totrans-231
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Once started, in a new terminal window, connect to the CLI and switch to the
    RBAC provider, as we did in the previous recipes:'
  id: totrans-232
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-233
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Now that we''ve successfully switched to the RBAC provider, we need to map
    our local management user (if you are following the book, you''ll know it is `wildfly`)
    to the **SuperUser** role, as follows:'
  id: totrans-234
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-235
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Now that we''ve completely switched to the RBAC provider, we need to configure
    the LDAP connection and its grouping filter. Stop WildFly, open the `standalone.xml`
    file, and then add the following `security-realm`:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Now, just right after the `</security-realms>` XML closing tag, add the following:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Map distinguish name (the `dn` attribute), to whatever fits your current LDAP
    system. Do the same for the `search-credential` attribute which represents the
    password used by the `admin` user, specified at the beginning of the `dn` attribute:
    `cn=Manager`.'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
- en: Also keep in mind that in a production environment you would use the LDAP protocol
    over SSL, which transmit credentials in a secure way. Thus the URL would be `ldaps://secureldap.intranet:636`.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: 'Keep your `standalone.xml` file open and apply the following changes:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
- en: 'Find the following definition:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-244
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Replace it with the following:'
  id: totrans-245
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-246
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: That's all we have to do to integrate LDAP with RBAC for our management console.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
- en: 'I''ve populated the OpenLDAP server with the `rbac.ldif` file, and have referenced
    `user1` to the custom groups on OpenLDAP itself. The following is an extraction
    of such a configuration:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Now we need to map the OpenLDAP groups to WildFly''s built-in roles, as described
    in the *Managing users, groups, and their role mapping* recipe, such that `user1`
    would have the roles **Deployers**, **Operators**, and **Maintainer**. Please
    bind the groups and roles as depicted in the following image:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_12_26.jpg)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
- en: 'Now, if you try to log out and log back into the WildFly Web Console with the
    user `user1`, you will be first prompted for credentials for the LDAPRealm, as
    depicted in the following image:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_12_27.jpg)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
- en: 'Next, you will login with proper roles, as depicted in the following image:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_12_28.jpg)'
  id: totrans-255
  prefs: []
  type: TYPE_IMG
- en: As you can see, the user `user1` is logged in with the roles of **Operator**,
    **Maintainer**, and **Deployer**.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: First we needed to switch the provider, passing from `simple` to `rbac` using
    the CLI.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
- en: 'Secondly, we needed to include our management user `wildfly` in the `SuperUser`
    role, which resulted in the following configuration:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Then we added a new security-realm named LDAPRealm. In it, we defined the authentication
    and authorization process, which involved setting the proper LDAP distinguish
    names.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: In order to connect to the LDAP, we had to create a connection reference using
    the outbound-connections directive.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
- en: Lastly, we mapped the HTTP management interface, the WildFly console, to the
    LDAPRealm realm.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
- en: Because of the structure of the `rbac.ldif` file, where the group that the user
    belongs to is mapped into the group itself, we had to instruct the `group-search`
    element instead of the `user-to-dn` element.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`rbac.ldif`文件的架构，其中用户所属的组映射到该组本身，我们不得不指导使用`group-search`元素而不是`user-to-dn`元素。
