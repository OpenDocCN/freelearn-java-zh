<html><head></head><body>
<div id="_idContainer044">
<h1 class="chapter-number" id="_idParaDest-234"><a id="_idTextAnchor233"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-235"><a id="_idTextAnchor234"/><span class="koboSpan" id="kobo.2.1">Getting Started with gRPC</span></h1>
<p><span class="koboSpan" id="kobo.3.1">gRPC is an open source framework for general-purpose </span><a id="_idIndexMarker902"/><strong class="bold"><span class="koboSpan" id="kobo.4.1">Remote Procedure Calls</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">RPCs</span></strong><span class="koboSpan" id="kobo.7.1">) across a network. </span><span class="koboSpan" id="kobo.7.2">RPCs allow a remote procedure (hosted on a different machine) to call as if it were calling a local procedure in connected systems without coding the remote interaction details. </span><span class="koboSpan" id="kobo.7.3">RPC has a constant meaning in the </span><em class="italic"><span class="koboSpan" id="kobo.8.1">gRPC</span></em><span class="koboSpan" id="kobo.9.1"> abbreviation. </span><span class="koboSpan" id="kobo.9.2">It seems logical that the </span><em class="italic"><span class="koboSpan" id="kobo.10.1">g</span></em><span class="koboSpan" id="kobo.11.1"> in gRPC would refer to </span><em class="italic"><span class="koboSpan" id="kobo.12.1">Google</span></em><span class="koboSpan" id="kobo.13.1"> because it was initially developed there. </span><span class="koboSpan" id="kobo.13.2">But the meaning of the </span><em class="italic"><span class="koboSpan" id="kobo.14.1">g</span></em><span class="koboSpan" id="kobo.15.1"> has changed with every release. </span><span class="koboSpan" id="kobo.15.2">For its first release, version 1.0, the </span><em class="italic"><span class="koboSpan" id="kobo.16.1">g</span></em><span class="koboSpan" id="kobo.17.1"> in gRPC stood for gRPC itself. </span><span class="koboSpan" id="kobo.17.2">That is, in version 1.0, it stood for </span><strong class="bold"><span class="koboSpan" id="kobo.18.1">gRPC </span></strong><strong class="bold"><a id="_idIndexMarker903"/></strong><strong class="bold"><span class="koboSpan" id="kobo.19.1">Remote Procedure Call</span></strong><span class="koboSpan" id="kobo.20.1">. </span><span class="koboSpan" id="kobo.20.2">In this chapter, you are going to use gRPC version 1.54, where the </span><em class="italic"><span class="koboSpan" id="kobo.21.1">g</span></em><span class="koboSpan" id="kobo.22.1"> stands for </span><strong class="bold"><span class="koboSpan" id="kobo.23.1">gracious</span></strong><span class="koboSpan" id="kobo.24.1">. </span><span class="koboSpan" id="kobo.24.2">Therefore, you can refer to gRPC as </span><strong class="bold"><span class="koboSpan" id="kobo.25.1">gracious Remote Procedure Call</span></strong><span class="koboSpan" id="kobo.26.1"> (for version 1.54). </span><span class="koboSpan" id="kobo.26.2">You can find out all the meanings of the </span><em class="italic"><span class="koboSpan" id="kobo.27.1">g</span></em><span class="koboSpan" id="kobo.28.1"> for different versions </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">at </span></span><a href="https://github.com/grpc/grpc/blob/master/doc/g_stands_for.md"><span class="No-Break"><span class="koboSpan" id="kobo.30.1">https://github.com/grpc/grpc/blob/master/doc/g_stands_for.md</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.31.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.32.1">In this chapter, you’ll learn the fundamentals of gRPC such as its architecture, service definitions, life cycle, server, and client. </span><span class="koboSpan" id="kobo.32.2">This chapter will provide you with a foundation that you can use to implement gRPC-based APIs. </span><span class="koboSpan" id="kobo.32.3">These fundamentals will help you to implement inter-service communication in a sample </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">e-commerce app.</span></span></p>
<p><span class="koboSpan" id="kobo.34.1">You will use gRPC-based APIs to develop a basic payment gateway for processing payments in an e-commerce app in the </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">next chapter.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.36.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.37.1">gRPC is </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">pronounced </span></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.39.1">Jee-Arr-Pee-See</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.41.1">You will explore the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.43.1">Introduction and </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">gRPC architecture</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">service definitions</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Exploring the gRPC </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">life cycle</span></span></li>
<li><span class="koboSpan" id="kobo.49.1">Understanding the gRPC server and </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">gRPC stub</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.51.1">Handling errors</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.52.1">After completing this chapter, you will understand the gRPC basics, which will help you to implement a gRPC-based web service in the </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">next chapter.</span></span></p>
<h1 id="_idParaDest-236"><a id="_idTextAnchor235"/><span class="koboSpan" id="kobo.54.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.55.1">This chapter contains only the theory of gRPC. </span><span class="koboSpan" id="kobo.55.2">However, you would generally need any gRPC API client such as Insomnia for the development and testing of gRPC-based </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">web services.</span></span></p>
<p><span class="koboSpan" id="kobo.57.1">You are going to learn the fundamentals of gRPC in this chapter, so this chapter doesn’t have its own code repository. </span><span class="koboSpan" id="kobo.57.2">However, for actual code, you can refer to the </span><a href="B19349_11.xhtml#_idTextAnchor250"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.58.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.59.1"> code </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">at </span></span><a href="https://github.com/PacktPublishing/Modern-API-Development-with-Spring-6-and-Spring-Boot-3/tree/dev/Chapter11"><span class="No-Break"><span class="koboSpan" id="kobo.61.1">https://github.com/PacktPublishing/Modern-API-Development-with-Spring-6-and-Spring-Boot-3/tree/dev/Chapter11</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.62.1">.</span></span></p>
<h1 id="_idParaDest-237"><a id="_idTextAnchor236"/><span class="koboSpan" id="kobo.63.1">How does gRPC work?</span></h1>
<p><span class="koboSpan" id="kobo.64.1">gRPC is an open source framework for general-purpose RPCs across a network. </span><span class="koboSpan" id="kobo.64.2">gRPC supports full-duplex </span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.65.1">streaming and is also mostly aligned with HTTP/2 semantics. </span><span class="koboSpan" id="kobo.65.2">It supports different media formats, </span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.66.1">such as </span><strong class="bold"><span class="koboSpan" id="kobo.67.1">Protocol Buffers</span></strong><span class="koboSpan" id="kobo.68.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.69.1">Protobuf</span></strong><span class="koboSpan" id="kobo.70.1">), JSON, XML, and Thrift. </span><span class="koboSpan" id="kobo.70.2">Protobuf is the default media format. </span><span class="koboSpan" id="kobo.70.3">The use of Protobuf aces the others because of </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">higher performance.</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">gRPC brings the best of </span><a id="_idIndexMarker906"/><strong class="bold"><span class="koboSpan" id="kobo.73.1">REST</span></strong><span class="koboSpan" id="kobo.74.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.75.1">Representational State Transfer</span></strong><span class="koboSpan" id="kobo.76.1">) and RPC to the table and is well suited for distributed network communication through APIs. </span><span class="koboSpan" id="kobo.76.2">It offers some prolific features, </span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.78.1">It is designed for a highly scalable distributed system and offers </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.79.1">low latency</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.81.1">It offers load balancing </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">and failover.</span></span></li>
<li><span class="koboSpan" id="kobo.83.1">It can be integrated easily at the application layer for interaction with flow control because of its </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">layered design.</span></span></li>
<li><span class="koboSpan" id="kobo.85.1">It supports cascade </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">call cancellation.</span></span></li>
<li><span class="koboSpan" id="kobo.87.1">It offers wide communication — mobile app to server, web app to server, and any gRPC client app to the gRPC server app on </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">different machines.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.89.1">You’re already aware of REST and its implementation. </span><span class="koboSpan" id="kobo.89.2">Let’s find out the differences between REST and gRPC in the next subsection, which gives you a different perspective and allows you to choose between REST or gRPC based on your requirements and </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">use case.</span></span></p>
<h2 id="_idParaDest-238"><a id="_idTextAnchor237"/><span class="koboSpan" id="kobo.91.1">REST versus gRPC</span></h2>
<p><span class="koboSpan" id="kobo.92.1">gRPC is </span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.93.1">based on client-server architecture, whereas this is not true </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">for REST.</span></span></p>
<p><span class="koboSpan" id="kobo.95.1">Both gRPC and REST leverage the HTTP protocol. </span><span class="koboSpan" id="kobo.95.2">gRPC supports HTTP/2 specifications and full-duplex streaming communication in contrast to REST, which serves well for various scenarios such as voice or </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">video calls.</span></span></p>
<p><span class="koboSpan" id="kobo.97.1">You can pass payloads using query parameters, path parameters, and the request body in REST. </span><span class="koboSpan" id="kobo.97.2">This means that the request payload/data can be passed using different sources that lead to the parsing of the payload/data from different sources, which adds latency and complexity. </span><span class="koboSpan" id="kobo.97.3">On the other hand, gRPC performs better than REST as it uses the static paths and single source of the </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">request payload.</span></span></p>
<p><span class="koboSpan" id="kobo.99.1">As you know, the REST response error depends on HTTP status codes, whereas gRPC has formalized the set of errors to make it well aligned </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">with APIs.</span></span></p>
<p><span class="koboSpan" id="kobo.101.1">The REST API is more flexible in its implementation because it is purely dependent on HTTP. </span><span class="koboSpan" id="kobo.101.2">This gives you flexibility, but you need standards and conventions for strict verification and validation. </span><span class="koboSpan" id="kobo.101.3">But do you know why you need these strict verifications and validations? </span><span class="koboSpan" id="kobo.101.4">It is because you can implement an API in different ways. </span><span class="koboSpan" id="kobo.101.5">For example, you can delete a resource using any HTTP method instead of just using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">HTTP DELETE</span></strong><span class="koboSpan" id="kobo.103.1"> method, and this simply </span><span class="No-Break"><span class="koboSpan" id="kobo.104.1">sounds horrific.</span></span></p>
<p><span class="koboSpan" id="kobo.105.1">On top of everything mentioned, gRPC is also built for supporting and handling call cancellations, load balancing, </span><span class="No-Break"><span class="koboSpan" id="kobo.106.1">and failovers.</span></span></p>
<p><span class="koboSpan" id="kobo.107.1">REST is mature and widely adopted, but gRPC brings its advantages. </span><span class="koboSpan" id="kobo.107.2">Therefore, you can choose between them based on their pros and cons. </span><span class="koboSpan" id="kobo.107.3">(Mind you, we haven’t yet discussed GraphQL, which brings its own offerings. </span><span class="koboSpan" id="kobo.107.4">You will learn about GraphQL in </span><a href="B19349_13.xhtml#_idTextAnchor288"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.108.1">Chapter 13</span></em></span></a><span class="koboSpan" id="kobo.109.1">, </span><em class="italic"><span class="koboSpan" id="kobo.110.1">Getting Started with GraphQL</span></em><span class="koboSpan" id="kobo.111.1">, and </span><a href="B19349_14.xhtml#_idTextAnchor313"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.112.1">Chapter 14</span></em></span></a><span class="koboSpan" id="kobo.113.1">, </span><em class="italic"><span class="koboSpan" id="kobo.114.1">GraphQL API Development </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.115.1">and Testing</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">.)</span></span></p>
<p><span class="koboSpan" id="kobo.117.1">Let’s find out whether we can use gRPC for web communication like REST in the </span><span class="No-Break"><span class="koboSpan" id="kobo.118.1">next subsection.</span></span></p>
<h2 id="_idParaDest-239"><a id="_idTextAnchor238"/><span class="koboSpan" id="kobo.119.1">Can I call the gRPC server from web browsers and mobile apps?</span></h2>
<p><span class="koboSpan" id="kobo.120.1">Of course, you can. </span><span class="koboSpan" id="kobo.120.2">The gRPC </span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.121.1">framework is </span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.122.1">designed for communication in distributed systems and is mostly aligned with HTTP/2 semantics. </span><span class="koboSpan" id="kobo.122.2">You can call a gRPC API from a mobile app, just like calling any local object. </span><span class="koboSpan" id="kobo.122.3">That’s the beauty of gRPC! </span><span class="koboSpan" id="kobo.122.4">It supports inter-service communication across the intranet and internet and calls from the mobile app and web browser to the gRPC server. </span><span class="koboSpan" id="kobo.122.5">Therefore, you can utilize it for all kinds </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">of communications.</span></span></p>
<p><span class="koboSpan" id="kobo.124.1">gRPC for web (that is, </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">gRPC-web</span></strong><span class="koboSpan" id="kobo.126.1">) was quite new in 2018, but now (in 2023), it is getting more recognition and is especially being used </span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.127.1">for </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">Internet of Things</span></strong><span class="koboSpan" id="kobo.129.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.130.1">IoT</span></strong><span class="koboSpan" id="kobo.131.1">) applications. </span><span class="koboSpan" id="kobo.131.2">Ideally, you should adopt it first for your internal inter-service communications and then for web/mobile </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">server communication.</span></span></p>
<p><span class="koboSpan" id="kobo.133.1">Let’s find out more about its architecture in the </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">next subsection.</span></span></p>
<h2 id="_idParaDest-240"><a id="_idTextAnchor239"/><span class="koboSpan" id="kobo.135.1">Getting to know the gRPC architecture</span></h2>
<p><span class="koboSpan" id="kobo.136.1">gRPC is a general-purpose RPC-based </span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.137.1">framework. </span><span class="koboSpan" id="kobo.137.2">It works very well in the RPC style, which involves the </span><span class="No-Break"><span class="koboSpan" id="kobo.138.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.139.1">First, you define the service interface, which includes method signatures, with their parameters and </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">return types.</span></span></li>
<li><span class="koboSpan" id="kobo.141.1">Then, you implement the defined service interface as a part of the </span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.142.1">gRPC server. </span><span class="koboSpan" id="kobo.142.2">You are now ready to serve the </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">remote calls.</span></span></li>
<li><span class="koboSpan" id="kobo.144.1">Next, you need the stub for clients, which you can generate using the service interface. </span><span class="koboSpan" id="kobo.144.2">The client application calls the stub, which is a local call. </span><span class="koboSpan" id="kobo.144.3">In turn, the stub communicates with the gRPC server, and the returned value is passed to the gRPC client. </span><span class="koboSpan" id="kobo.144.4">This is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">following diagram:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.146.1"><img alt="Figure 10.1 – gRPC client-server architecture" src="image/Figure_10.1_B19349.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.147.1">Figure 10.1 – gRPC client-server architecture</span></p>
<p><span class="koboSpan" id="kobo.148.1">For client applications, it is just a local call to the stub to get the response. </span><span class="koboSpan" id="kobo.148.2">You can have a server on either the same machine or a different machine. </span><span class="koboSpan" id="kobo.148.3">This makes it easier to write distributed services. </span><span class="koboSpan" id="kobo.148.4">It is an ideal tool for writing microservices. </span><span class="koboSpan" id="kobo.148.5">gRPC is language-independent. </span><span class="koboSpan" id="kobo.148.6">You can write servers and clients in different languages. </span><span class="koboSpan" id="kobo.148.7">This provides a lot of flexibility </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">for development.</span></span></p>
<p><span class="koboSpan" id="kobo.150.1">gRPC is a layered architecture that has the following layers to make remote </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">calling possible:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.152.1">Stub</span></strong><span class="koboSpan" id="kobo.153.1">: You know the client calls the server through stubs. </span><span class="koboSpan" id="kobo.153.2">A stub is the topmost layer. </span><span class="koboSpan" id="kobo.153.3">Stubs are generated from the </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">interface definition language</span></strong><span class="koboSpan" id="kobo.155.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.156.1">IDL</span></strong><span class="koboSpan" id="kobo.157.1">) file, which contains service interfaces, methods, and messages. </span><span class="koboSpan" id="kobo.157.2">The IDL file will have a </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">.proto</span></strong><span class="koboSpan" id="kobo.159.1"> extension if the interface is defined </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">using Protobuf.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.161.1">Channel</span></strong><span class="koboSpan" id="kobo.162.1">: The stub </span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.163.1">uses </span><strong class="bold"><span class="koboSpan" id="kobo.164.1">application binary interfaces</span></strong><span class="koboSpan" id="kobo.165.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.166.1">ABIs</span></strong><span class="koboSpan" id="kobo.167.1">) to communicate with the server. </span><span class="koboSpan" id="kobo.167.2">The channel is the middle layer that provides these ABIs. </span><span class="koboSpan" id="kobo.167.3">In general, the channel provides the connection to the server on a specific host and port. </span><span class="koboSpan" id="kobo.167.4">That’s the reason the channel has a status such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">connected</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.169.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">idle</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.171.1">.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.172.1">Transport</span></strong><span class="koboSpan" id="kobo.173.1">: This is the lowest layer and uses HTTP/2 as its protocol. </span><span class="koboSpan" id="kobo.173.2">Therefore, gRPC provides full-duplex communication and multiplex parallel calls over the same </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">network connection.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.175.1">You can develop a gRPC-based service by following </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.177.1">Define the service interface using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.178.1">.proto</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.179.1">file (Protobuf).</span></span></li>
<li><span class="koboSpan" id="kobo.180.1">Write the implementation of the service interface defined in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.181.1">step 1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.183.1">Create a gRPC server and register the service </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">with it.</span></span></li>
<li><span class="koboSpan" id="kobo.185.1">Generate the service stub and use it with the </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">gRPC client.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.187.1">You’ll implement the actual gRPC service in the next chapter, </span><a href="B19349_11.xhtml#_idTextAnchor250"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.188.1">Chapter 11</span></em></span></a><span class="koboSpan" id="kobo.189.1">, </span><em class="italic"><span class="koboSpan" id="kobo.190.1">gRPC API Development </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.191.1">and Testing</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.193.1">gRPC stub</span></p>
<p class="callout"><span class="koboSpan" id="kobo.194.1">A stub is an object that exposes service interfaces. </span><span class="koboSpan" id="kobo.194.2">The gRPC client calls the stub method, hooks the call to the server, and gets the </span><span class="No-Break"><span class="koboSpan" id="kobo.195.1">response back.</span></span></p>
<p><span class="koboSpan" id="kobo.196.1">You need </span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.197.1">to understand Protobuf to define the service interfaces. </span><span class="koboSpan" id="kobo.197.2">Let’s explore it in the </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">next subsection.</span></span></p>
<h2 id="_idParaDest-241"><a id="_idTextAnchor240"/><span class="koboSpan" id="kobo.199.1">How gRPC uses Protobuf</span></h2>
<p><span class="koboSpan" id="kobo.200.1">Protobuf was created in 2001 and was publicly made available in 2008. </span><span class="koboSpan" id="kobo.200.2">It was also used by Google’s microservice-based </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">system, Stubby.</span></span></p>
<p><span class="koboSpan" id="kobo.202.1">gRPC also works well with JSON and other media types. </span><span class="koboSpan" id="kobo.202.2">However, you’ll define the service interfaces using Protobuf because it is known for its performance. </span><span class="koboSpan" id="kobo.202.3">It allows formal contracts, better bandwidth optimization, and code generation. </span><span class="koboSpan" id="kobo.202.4">Protobuf is also the default format for gRPC. </span><span class="koboSpan" id="kobo.202.5">gRPC makes use of Protobuf not only for data serialization but also for code generation. </span><span class="koboSpan" id="kobo.202.6">Protobuf serializes data and, unlike JSON, YAML is not human-readable. </span><span class="koboSpan" id="kobo.202.7">Let’s see how it </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">is built.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Protobuf messages contain a series of key-value pairs. </span><span class="koboSpan" id="kobo.204.2">The key specifies the </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">message</span></strong><span class="koboSpan" id="kobo.206.1"> field and its type. </span><span class="koboSpan" id="kobo.206.2">Let’s examine the following </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">Employee</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1"> message:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.209.1">
message Employee {  int64 id = </span><strong class="bold"><span class="koboSpan" id="kobo.210.1">1</span></strong><span class="koboSpan" id="kobo.211.1">;
  string firstName = </span><strong class="bold"><span class="koboSpan" id="kobo.212.1">2</span></strong><span class="koboSpan" id="kobo.213.1">;
}</span></pre>
<p><span class="koboSpan" id="kobo.214.1">Let’s represent this message using Protobuf (with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">id</span></strong><span class="koboSpan" id="kobo.216.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">299</span></strong><span class="koboSpan" id="kobo.218.1"> and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">firstName</span></strong><span class="koboSpan" id="kobo.220.1"> value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">Scott</span></strong><span class="koboSpan" id="kobo.222.1">), as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.223.1">following diagram:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.224.1"><img alt="Figure 10.2 – Employee message representation using Protobuf" src="image/Figure_10.2_B19349.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.225.1">Figure 10.2 – Employee message representation using Protobuf</span></p>
<p><span class="koboSpan" id="kobo.226.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">Id</span></strong><span class="koboSpan" id="kobo.228.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.229.1">firstName</span></strong><span class="koboSpan" id="kobo.230.1"> fields are tagged with numbers, sequenced </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">1</span></strong><span class="koboSpan" id="kobo.232.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">2</span></strong><span class="koboSpan" id="kobo.234.1">, respectively, which </span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.235.1">is required for serialization. </span><span class="koboSpan" id="kobo.235.2">The wire type is another </span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.236.1">aspect that provides information to find the length of </span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">the value.</span></span></p>
<p><span class="koboSpan" id="kobo.238.1">The following table contains the wire types and their </span><span class="No-Break"><span class="koboSpan" id="kobo.239.1">respective meanings:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-3">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.240.1">Wire Type</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.241.1">Meaning</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.242.1">Used For</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.243.1">0</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.244.1">Var int</span></span></p>
<p><span class="koboSpan" id="kobo.245.1">(</span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">variable-length integer)</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">int32</span></strong><span class="koboSpan" id="kobo.248.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">int64</span></strong><span class="koboSpan" id="kobo.250.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">uint32</span></strong><span class="koboSpan" id="kobo.252.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">uint64</span></strong><span class="koboSpan" id="kobo.254.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">sint32</span></strong><span class="koboSpan" id="kobo.256.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">sint64</span></strong><span class="koboSpan" id="kobo.258.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">bool</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">enum</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.262.1">1</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.263.1">64-bit</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">fixed64</span></strong><span class="koboSpan" id="kobo.265.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">sfixed64</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">double</span></strong></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.269.1">2</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.270.1">Length-delimited</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">string</span></strong><span class="koboSpan" id="kobo.272.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">bytes</span></strong><span class="koboSpan" id="kobo.274.1">, embedded messages, packed </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">repeated fields</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.276.1">3</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.277.1">Start group</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">groups</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.279.1"> (deprecated)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.280.1">4</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.281.1">End group</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">groups</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.283.1"> (deprecated)</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.284.1">5</span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.285.1">32-bit</span></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">fixed32</span></strong><span class="koboSpan" id="kobo.287.1">, </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">sfixed32</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.289.1">, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.290.1">float</span></strong></span></p>
</td>
</tr>
</tbody>
</table>
<p><span class="koboSpan" id="kobo.291.1">A Protobuf file is created with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">.proto</span></strong><span class="koboSpan" id="kobo.293.1"> extension. </span><span class="koboSpan" id="kobo.293.2">You define service interfaces in the form of method signatures and messages (objects), which are referred to in method signatures. </span><span class="koboSpan" id="kobo.293.3">These messages can be method parameters or returned types. </span><span class="koboSpan" id="kobo.293.4">You can compile a defined service interface with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">protoc</span></strong><span class="koboSpan" id="kobo.295.1"> compiler, which generates the classes for</span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.296.1"> interfaces </span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.297.1">and given messages. </span><span class="koboSpan" id="kobo.297.2">Similarly, you can also generate the stubs for the </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">gRPC client.</span></span></p>
<p><span class="koboSpan" id="kobo.299.1">Let’s have a look at the following sample </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">.</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">proto</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.302.1"> file:</span></span></p>
<p class="SC---Heading" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.303.1">Sample service interface of Employee</span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.304.1">
syntax = "proto3";package com.packtpub;
option java_package = "com.packt.modern.api.proto";
option java_multiple_files = true;
message Employee {
  int64 id = 1;
  string firstName = 2;
  string lastName = 3;
  int64 deptId = 4;
  double salary = 5;
  message Address {
    string houseNo = 1;
    string street1 = 2;
    string street2 = 3;
    string city = 4;
    string state = 5;
    string country = 6;
    string pincode = 7;
  }
}
message EmployeeCreateResponse {
  int64 id = 1;
}
service EmployeeService {
  rpc Create(Employee) returns (EmployeeCreateResponse);
}</span></pre>
<p><span class="koboSpan" id="kobo.305.1">Let’s understand </span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.306.1">this </span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.307.1">code line </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">by line:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.309.1">The first line represents the Protobuf version denoted by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">syntax</span></strong><span class="koboSpan" id="kobo.311.1"> keyword. </span><span class="koboSpan" id="kobo.311.2">The value of </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">syntax</span></strong><span class="koboSpan" id="kobo.313.1"> (</span><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">proto3</span></strong><span class="koboSpan" id="kobo.315.1">) tells the compiler that version 3 of Protobuf is used. </span><span class="koboSpan" id="kobo.315.2">The default version is </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">proto2</span></strong><span class="koboSpan" id="kobo.317.1">. </span><span class="koboSpan" id="kobo.317.2">Protobuf version 3 offers more features and simplified syntax and supports more languages. </span><span class="koboSpan" id="kobo.317.3">gRPC recommends using Protobuf </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">version 3.</span></span></li>
<li><span class="koboSpan" id="kobo.319.1">Next, you define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.320.1">proto</span></strong><span class="koboSpan" id="kobo.321.1"> package name using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">package</span></strong><span class="koboSpan" id="kobo.323.1"> keyword followed by the package name. </span><span class="koboSpan" id="kobo.323.2">It prevents name clashes among </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">message types.</span></span></li>
<li><span class="koboSpan" id="kobo.325.1">Next, you use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">option</span></strong><span class="koboSpan" id="kobo.327.1"> keyword to define the Java package name using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.328.1">java_package</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.329.1"> parameter.</span></span></li>
<li><span class="koboSpan" id="kobo.330.1">Then, you use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.331.1">option</span></strong><span class="koboSpan" id="kobo.332.1"> keyword again to generate a separate file for each root-level message type using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.333.1">java_multiple_files</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.334.1"> parameter.</span></span></li>
<li><span class="koboSpan" id="kobo.335.1">Then, you define the messages, which are nothing but objects, using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">messages</span></strong><span class="koboSpan" id="kobo.337.1"> keyword. </span><span class="koboSpan" id="kobo.337.2">The message and its fields are defined using the strong types, which define the objects with exact specifications. </span><span class="koboSpan" id="kobo.337.3">You can define nested messages just like nested classes in Java. </span><span class="koboSpan" id="kobo.337.4">The last point contains the table of Protobuf types that you can use for defining the types of </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">message</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.339.1"> fields.</span></span></li>
<li><span class="koboSpan" id="kobo.340.1">You can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">Employee.Address</span></strong><span class="koboSpan" id="kobo.342.1"> to define the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">address</span></strong><span class="koboSpan" id="kobo.344.1"> field in </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">other messages.</span></span></li>
<li><span class="koboSpan" id="kobo.346.1">The tagging of fields marked with a sequence number is required because it is used for serialization and parsing </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">binary messages.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.348.1">Please note that you cannot change the message structure once it </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">is serialized.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.350.1">Service definitions are defined using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.351.1">service</span></strong><span class="koboSpan" id="kobo.352.1"> keyword. </span><span class="koboSpan" id="kobo.352.2">A service definition contains the methods. </span><span class="koboSpan" id="kobo.352.3">You can define methods using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">rpc</span></strong><span class="koboSpan" id="kobo.354.1"> keyword. </span><span class="koboSpan" id="kobo.354.2">Please refer to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.355.1">EmployeeService</span></strong><span class="koboSpan" id="kobo.356.1"> service definition for reference. </span><span class="koboSpan" id="kobo.356.2">You’ll explore more about service definitions in the </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">next subsection.</span></span></li>
<li><span class="koboSpan" id="kobo.358.1">Protobuf has</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.359.1"> predefined</span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.360.1"> types (scalar types). </span><span class="koboSpan" id="kobo.360.2">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.361.1">message</span></strong><span class="koboSpan" id="kobo.362.1"> field can have one of the Protobuf scalar types. </span><span class="koboSpan" id="kobo.362.2">When we compile the </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">.proto</span></strong><span class="koboSpan" id="kobo.364.1"> file, it converts the </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">message</span></strong><span class="koboSpan" id="kobo.366.1"> field into its respective language type. </span><span class="koboSpan" id="kobo.366.2">The following table defines the mapping between Protobuf types and </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">Java types:</span></span></li>
</ol>
<table class="No-Table-Style _idGenTablePara-1" id="table002">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.368.1">Protobuf types</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.369.1">Java types</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.370.1">Remarks</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.371.1">Double</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">Double</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.373.1">Like Java </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">type </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">double</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">Float</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.378.1">Float</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.379.1">Like Java </span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">type </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">float</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.382.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">int32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">Int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.385.1">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">sint32</span></strong><span class="koboSpan" id="kobo.387.1"> if the field contains negative values because it uses variable-length encoding, which is inefficient for encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">negative numbers.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">int64</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">Long</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.391.1">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">sint64</span></strong><span class="koboSpan" id="kobo.393.1"> if the field contains negative values because it uses variable-length encoding, which is inefficient for encoding </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">negative numbers.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">uint32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">Int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.397.1">It uses variable-length encoding. </span><span class="koboSpan" id="kobo.397.2">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">fixed32</span></strong><span class="koboSpan" id="kobo.399.1"> if values are greater </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.401.1">28</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">uint64</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">Long</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.405.1">It uses variable-length encoding. </span><span class="koboSpan" id="kobo.405.2">Use </span><strong class="source-inline"><span class="koboSpan" id="kobo.406.1">fixed64</span></strong><span class="koboSpan" id="kobo.407.1"> if values are greater </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.409.1">56</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">sint32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">Int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.413.1">More efficient for encoding negative numbers because it contains a signed </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">int</span></strong><span class="koboSpan" id="kobo.415.1"> value. </span><span class="koboSpan" id="kobo.415.2">It uses </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">variable-length encoding.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">sint64</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">Long</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.419.1">More efficient for encoding negative numbers because it contains a signed </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">int</span></strong><span class="koboSpan" id="kobo.421.1"> value. </span><span class="koboSpan" id="kobo.421.2">It </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">uses variable-length</span></span></p>
<p> <span class="No-Break"><span class="koboSpan" id="kobo.423.1">encoding.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">fixed32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.426.1">Always </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">4 bytes.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.428.1">fixed64</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">long</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.430.1">Always </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1">8 bytes.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.432.1">sfixed32</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">int</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.434.1">Always 4 bytes. </span><span class="koboSpan" id="kobo.434.2">More efficient for encoding values greater </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.436.1">28</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.438.1">sfixed64</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">long</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.440.1">Always 8 bytes. </span><span class="koboSpan" id="kobo.440.2">More efficient for encoding values greater </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.442.1">56</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.444.1">Bool</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">boolean</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">true</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.447.1">or </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.448.1">false</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">String</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.451.1">String</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.452.1">Contains UTF-8 encoded string or 7-bit ASCII text, which should not be longer </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.454.1">32</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">Bytes</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">ByteString</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.458.1">Contains an arbitrary sequence of bytes, which should not be longer </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">than 2</span></span><span class="No-Break"><span class="superscript"><span class="koboSpan" id="kobo.460.1">32</span></span></span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p><span class="koboSpan" id="kobo.462.1">Protobuf also allows you to define the enumeration types (using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">enum</span></strong><span class="koboSpan" id="kobo.464.1"> keyword) and maps (using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">map&lt;keytype, valuetype&gt;</span></strong><span class="koboSpan" id="kobo.466.1"> keyword). </span><span class="koboSpan" id="kobo.466.2">Please refer to the following code for examples of enumeration and </span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">map types:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.468.1">
… omittedmessage Employee {
  … omitted
  </span><strong class="bold"><span class="koboSpan" id="kobo.469.1">enum Grade</span></strong><span class="koboSpan" id="kobo.470.1"> {
    I_GRADE = 1;
    II_GRADE = 2;
    III_GRADE = 3;
    IV_GRADE = 4;
  }
  </span><strong class="bold"><span class="koboSpan" id="kobo.471.1">map&lt;string, int32&gt; nominees = 1;</span></strong><span class="koboSpan" id="kobo.472.1">
  … omitted
}</span></pre>
<p><span class="koboSpan" id="kobo.473.1">The preceding </span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.474.1">sample </span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.475.1">code creates the </span><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">Employee</span></strong><span class="koboSpan" id="kobo.477.1"> message, which has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">Grade</span></strong><span class="koboSpan" id="kobo.479.1"> enumeration field with values such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">I_GRADE</span></strong><span class="koboSpan" id="kobo.481.1">. </span><span class="koboSpan" id="kobo.481.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">nominees</span></strong><span class="koboSpan" id="kobo.483.1"> field is a map that has a key with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">string</span></strong><span class="koboSpan" id="kobo.485.1"> type and a value with an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">int32</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.487.1"> type.</span></span></p>
<p><span class="koboSpan" id="kobo.488.1">Let’s explore service definitions further in the </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">next section.</span></span></p>
<h1 id="_idParaDest-242"><a id="_idTextAnchor241"/><span class="koboSpan" id="kobo.490.1">Understanding service definitions</span></h1>
<p><span class="koboSpan" id="kobo.491.1">You define a service by </span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.492.1">specifying its methods with the respective parameters and return </span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.493.1">types. </span><span class="koboSpan" id="kobo.493.2">These methods are exposed by the server, which can be called remotely. </span><span class="koboSpan" id="kobo.493.3">You defined the </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">EmployeeService</span></strong><span class="koboSpan" id="kobo.495.1"> definition in the previous subsection, as shown in the next </span><span class="No-Break"><span class="koboSpan" id="kobo.496.1">code block:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.497.1">service</span></strong><span class="koboSpan" id="kobo.498.1"> EmployeeService {  </span><strong class="bold"><span class="koboSpan" id="kobo.499.1">rpc</span></strong><span class="koboSpan" id="kobo.500.1"> Create(Employee) returns (EmployeeCreateResponse);
}</span></pre>
<p><span class="koboSpan" id="kobo.501.1">Here, </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">Create</span></strong><span class="koboSpan" id="kobo.503.1"> is a method exposed by the </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">EmployeeService</span></strong><span class="koboSpan" id="kobo.505.1"> service definition. </span><span class="koboSpan" id="kobo.505.2">Messages used in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">Create</span></strong><span class="koboSpan" id="kobo.507.1"> service should also be defined as a part of the service definition. </span><span class="koboSpan" id="kobo.507.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.508.1">Create</span></strong><span class="koboSpan" id="kobo.509.1"> service method is a unary service method because the client sends a single request object and receives a single response object in return from </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">the server.</span></span></p>
<p><span class="koboSpan" id="kobo.511.1">Let’s dig further into the types of service methods offered </span><span class="No-Break"><span class="koboSpan" id="kobo.512.1">by gRPC:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.513.1">Unary</span></strong><span class="koboSpan" id="kobo.514.1">: We have already </span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.515.1">discussed the unary service method in the previous example. </span><span class="koboSpan" id="kobo.515.2">This would have a one-way response for a </span><span class="No-Break"><span class="koboSpan" id="kobo.516.1">single request.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.517.1">Server streaming</span></strong><span class="koboSpan" id="kobo.518.1">: In these types of service methods, the client sends a single object to the server and receives the stream response in return. </span><span class="koboSpan" id="kobo.518.2">This stream contains the sequence of messages. </span><span class="koboSpan" id="kobo.518.3">The stream is kept open until the client receives all the messages. </span><span class="koboSpan" id="kobo.518.4">The message sequence order is guaranteed by gRPC. </span><span class="koboSpan" id="kobo.518.5">In the following example, the client will keep receiving the live score messages until the match </span><span class="No-Break"><span class="koboSpan" id="kobo.519.1">is over:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.520.1">
rpc LiveMatchScore(MatchId) returns (stream MatchScore);</span></pre></li> <li><strong class="bold"><span class="koboSpan" id="kobo.521.1">Client streaming</span></strong><span class="koboSpan" id="kobo.522.1">: In these types of service methods, the client sends a sequence of messages to the server and receives a response object in return. </span><span class="koboSpan" id="kobo.522.2">The stream is kept open until the client sends all the messages. </span><span class="koboSpan" id="kobo.522.3">The message sequence order is guaranteed by gRPC. </span><span class="koboSpan" id="kobo.522.4">Once all the messages are sent by the client, it waits for the server’s response. </span><span class="koboSpan" id="kobo.522.5">In the following example, a client sends the data messages to the server until all the data records are sent, and it then waits for </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">the report:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.524.1">
rpc AnalyzeData(stream DataInput) returns (Report);</span></pre></li> <li><strong class="bold"><span class="koboSpan" id="kobo.525.1">Bidirectional streaming</span></strong><span class="koboSpan" id="kobo.526.1">: This is the simultaneous execution of client and server streaming. </span><span class="koboSpan" id="kobo.526.2">It means both the server and client send a sequence of messages using a read-write stream. </span><span class="koboSpan" id="kobo.526.3">Here, the order of the sequence is preserved. </span><span class="koboSpan" id="kobo.526.4">However, these two streams operate independently. </span><span class="koboSpan" id="kobo.526.5">Therefore, each can read and write in whatever order they like. </span><span class="koboSpan" id="kobo.526.6">The server can read and reply to the messages one by one or at once or can have any combination. </span><span class="koboSpan" id="kobo.526.7">In the following example, processed records can be sent immediately one by one or can be sent later in</span><a id="_idIndexMarker928"/> <span class="No-Break"><span class="koboSpan" id="kobo.527.1">different batches:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.528.1">
rpc BatchProcessing(stream InputRecords)    returns (stream Response);</span></pre></li> </ul>
<p><span class="koboSpan" id="kobo.529.1">Now that you </span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.530.1">have </span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.531.1">learned about the gRPC service definitions, let’s explore the RPC life cycle in the </span><span class="No-Break"><span class="koboSpan" id="kobo.532.1">next section.</span></span></p>
<h1 id="_idParaDest-243"><a id="_idTextAnchor242"/><span class="koboSpan" id="kobo.533.1">Exploring the RPC life cycle</span></h1>
<p><span class="koboSpan" id="kobo.534.1">In the previous </span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.535.1">section, you learned about four types of service definitions. </span><span class="koboSpan" id="kobo.535.2">Each type of service definition has its own life cycle. </span><span class="koboSpan" id="kobo.535.3">Let’s find out more about the life cycle of each service definition in </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">this section:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.537.1">The life cycle of a unary RPC</span></strong><span class="koboSpan" id="kobo.538.1">: A unary RPC is the simplest form of service method. </span><span class="koboSpan" id="kobo.538.2">Both the client and the server send a single object. </span><span class="koboSpan" id="kobo.538.3">Let’s find out how it works. </span><span class="koboSpan" id="kobo.538.4">A unary RPC is initiated by the client. </span><span class="koboSpan" id="kobo.538.5">The client calls a stub method, which notifies the server that the RPC has been invoked. </span><strong class="source-inline"><span class="koboSpan" id="kobo.539.1">A stub</span></strong><span class="koboSpan" id="kobo.540.1"> also provides the server client’s metadata, the method name, and the specified deadline, if applicable, </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">with notification.</span></span></li>
</ul>
<p><strong class="bold"><span class="koboSpan" id="kobo.542.1">Metadata</span></strong><span class="koboSpan" id="kobo.543.1"> is data about the RPC in the form of key-value pairs, such as timeout and </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">authentication details.</span></span></p>
<p><span class="koboSpan" id="kobo.545.1">Next, in response, the server sends back its initial metadata. </span><span class="koboSpan" id="kobo.545.2">Whether the server sends initial metadata immediately or after receiving the client’s request message depends on the application. </span><span class="koboSpan" id="kobo.545.3">But the server must send it before </span><span class="No-Break"><span class="koboSpan" id="kobo.546.1">any response.</span></span></p>
<p><span class="koboSpan" id="kobo.547.1">The server works on the request and prepares the response after receiving the client’s request message. </span><span class="koboSpan" id="kobo.547.2">The server sends back the response with the status (code and optional message) and optional trailing metadata for </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">successful calls.</span></span></p>
<p><span class="koboSpan" id="kobo.549.1">The client receives a response and completes the call (for a status of </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">OK</span></strong><span class="koboSpan" id="kobo.551.1">, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">HTTP </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.553.1">status 200</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">).</span></span></p>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.555.1">The life cycle of a server-streaming RPC</span></em><span class="koboSpan" id="kobo.556.1">: The life cycle of a server-streaming RPC is almost </span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.557.1">the same as a unary RPC. </span><span class="koboSpan" id="kobo.557.2">It follows the same steps. </span><span class="koboSpan" id="kobo.557.3">The only difference is the way the response is sent because of the stream response. </span><span class="koboSpan" id="kobo.557.4">The server sends messages as streams until all the messages are sent. </span><span class="koboSpan" id="kobo.557.5">In the end, the server sends back the response with the status (code and optional message) and optional trailing metadata and completes the server-side processing. </span><span class="koboSpan" id="kobo.557.6">The client completes the life cycle once it has all the </span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">server’s messages.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.559.1">The life cycle of a client-streaming RPC</span></em><span class="koboSpan" id="kobo.560.1">: The life cycle of a client-streaming RPC is almost the same as a unary RPC. </span><span class="koboSpan" id="kobo.560.2">It follows the same steps. </span><span class="koboSpan" id="kobo.560.3">The only difference is the way the request is sent because of the stream request. </span><span class="koboSpan" id="kobo.560.4">The client sends messages as streams until all the messages are sent to the server. </span><span class="koboSpan" id="kobo.560.5">The server sends back the single message response with the status (code and optional message) and optional trailing metadata for successful calls. </span><span class="koboSpan" id="kobo.560.6">The server sends the response after receiving all the client’s messages in idle scenarios. </span><span class="koboSpan" id="kobo.560.7">The client completes the life cycle once it receives the </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">server message.</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.562.1">The life cycle of a bidirectional streaming RPC</span></em><span class="koboSpan" id="kobo.563.1">: The first two steps in the life cycle of a bidirectional streaming RPC are the same as a unary RPC. </span><span class="koboSpan" id="kobo.563.2">Streaming processing from both sides is application specific. </span><span class="koboSpan" id="kobo.563.3">Both the server and client can read and write messages in any order because the two streams are independent of </span><span class="No-Break"><span class="koboSpan" id="kobo.564.1">each other.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.565.1">The server can process streams of request messages sent by the client in any order. </span><span class="koboSpan" id="kobo.565.2">For example, the server and client can play ping-pong: the client sends the request message and the server processes it. </span><span class="koboSpan" id="kobo.565.3">Again, the client sends the request message, and the server processes it, and the process, as you know, goes on. </span><span class="koboSpan" id="kobo.565.4">Or the</span><a id="_idIndexMarker933"/><span class="koboSpan" id="kobo.566.1"> server waits until it receives all the client’s messages before it writes </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">its messages.</span></span></p>
<p><span class="koboSpan" id="kobo.568.1">The client completes the life cycle once it receives all the </span><span class="No-Break"><span class="koboSpan" id="kobo.569.1">server messages.</span></span></p>
<h2 id="_idParaDest-244"><a id="_idTextAnchor243"/><span class="koboSpan" id="kobo.570.1">Events that impact the life cycle</span></h2>
<p><span class="koboSpan" id="kobo.571.1">The following events </span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.572.1">may impact the life cycle of </span><span class="No-Break"><span class="koboSpan" id="kobo.573.1">the RPC:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.574.1">Deadlines/timeouts</span></strong><span class="koboSpan" id="kobo.575.1">: gRPC supports deadlines/timeouts. </span><span class="koboSpan" id="kobo.575.2">Therefore, a client would wait for the defined deadline/timeout to get the response from the server. </span><span class="koboSpan" id="kobo.575.3">If the wait exceeds the defined deadline/timeout, then it throws the </span><strong class="source-inline"><span class="koboSpan" id="kobo.576.1">DEADLINE_EXCEEDED</span></strong><span class="koboSpan" id="kobo.577.1"> error. </span><span class="koboSpan" id="kobo.577.2">Similarly, the server can query to find out whether a particular RPC has timed out, or how much time is left to complete </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">the RPC.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.579.1">Timeout configuration is language-specific. </span><span class="koboSpan" id="kobo.579.2">Some language APIs support timeouts (durations of time), and some support deadlines (a fixed point in time). </span><span class="koboSpan" id="kobo.579.3">APIs may have a default value of deadline/timeout, and some </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">may not.</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.581.1">RPC termination</span></strong><span class="koboSpan" id="kobo.582.1">: There are a few scenarios where the RPC gets terminated because both the client and server make independent and local determinations of the success of the call, and their conclusions may not match. </span><span class="koboSpan" id="kobo.582.2">For example, the server may finish its part by sending all its messages, but it may fail from the client’s side because responses have arrived after the timeout. </span><span class="koboSpan" id="kobo.582.3">Another scenario would be when a server decides to complete the RPC before the client sends </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">all messages.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.584.1">Canceling an RPC</span></strong><span class="koboSpan" id="kobo.585.1">: gRPC has a provision to cancel the RPC at any time by either the server or client. </span><span class="koboSpan" id="kobo.585.2">This terminates the RPC immediately. </span><span class="koboSpan" id="kobo.585.3">However, changes made</span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.586.1"> before the cancellation are not </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">rolled back.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.588.1">Let’s explore the gRPC server and stub a bit more in the </span><span class="No-Break"><span class="koboSpan" id="kobo.589.1">next section.</span></span></p>
<h2 id="_idParaDest-245"><a id="_idTextAnchor244"/><span class="koboSpan" id="kobo.590.1">Understanding the gRPC server and gRPC stub</span></h2>
<p><span class="koboSpan" id="kobo.591.1">If you closely</span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.592.1"> observe </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.593.1">Figure 10</span></em></span><em class="italic"><span class="koboSpan" id="kobo.594.1">.1</span></em><span class="koboSpan" id="kobo.595.1">, you’ll find that the </span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.596.1">gRPC server and gRPC stub are core parts of the </span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.597.1">implementation because gRPC is based on the client-server architecture. </span><span class="koboSpan" id="kobo.597.2">Once you define the service, you can generate both service interfaces and the stub using the Protobuf compiler, </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">protoc</span></strong><span class="koboSpan" id="kobo.599.1">, with the gRPC Java plugin. </span><span class="koboSpan" id="kobo.599.2">You’ll find a practical example in </span><a href="B19349_11.xhtml#_idTextAnchor250"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.600.1">Chapter 11</span></em></span></a><span class="No-Break"><span class="koboSpan" id="kobo.601.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.602.1">The following types of files are generated by </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">the compiler:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.604.1">Models</span></strong><span class="koboSpan" id="kobo.605.1">: It generates all the </span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.606.1">messages (that is, models) defined in the service definition file, which contains the Protobuf code to serialize, deserialize, and fetch the types of request and </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">response messages.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.608.1">gRPC Java files</span></strong><span class="koboSpan" id="kobo.609.1">: It contains</span><a id="_idIndexMarker940"/><span class="koboSpan" id="kobo.610.1"> the service base interface and stubs. </span><span class="koboSpan" id="kobo.610.2">The base interface is implemented and then used as a part of the gRPC server. </span><span class="koboSpan" id="kobo.610.3">Stubs are used by the clients for communication with </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">the server.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.612.1">First, you need to implement the interface, as shown in the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.613.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">EmployeeService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.616.1">
public class EmployeeService extends EmployeeServiceImplBase {  // some code
  @Override
  public void create(Employee request,
     io.grpc.stub.StreamObserver&lt;Response&gt; responseObserver) {
    // implementation
  }
}</span></pre>
<p><span class="koboSpan" id="kobo.617.1">Once you</span><a id="_idIndexMarker941"/><span class="koboSpan" id="kobo.618.1"> implement</span><a id="_idIndexMarker942"/><span class="koboSpan" id="kobo.619.1"> the </span><a id="_idIndexMarker943"/><span class="koboSpan" id="kobo.620.1">interface, you can run the gRPC server to serve the requests from </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">gRPC clients:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.622.1">
public class GrpcServer { public static void main(String[] arg) {
  try {
    </span><strong class="bold"><span class="koboSpan" id="kobo.623.1">Server server = ServerBuilder.forPort(8080)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.624.1">        .addService(new EmployeeService()).build();</span></strong><span class="koboSpan" id="kobo.625.1">
    System.out.println("Starting gRPC Server Service...");
    </span><strong class="bold"><span class="koboSpan" id="kobo.626.1">server.start();</span></strong><span class="koboSpan" id="kobo.627.1">
    System.out.println("Server has started at port: 8080");
    System.out.println("Following services are
        available: ");
    server.getServices().stream().forEach( s -&gt;
      System.out.println("Service Name: " +
      s.getServiceDescriptor().getName())
    );
    </span><strong class="bold"><span class="koboSpan" id="kobo.628.1">server.awaitTermination();</span></strong><span class="koboSpan" id="kobo.629.1">
  } catch (Exception e) {
    // error handling
  }
 }
}</span></pre>
<p><span class="koboSpan" id="kobo.630.1">For clients, first, you need to create the channel using </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">ChannelBuilder</span></strong><span class="koboSpan" id="kobo.632.1">, and then you can use the created channels to create stubs, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.634.1">
public EmployeeServiceClient(</span><strong class="bold"><span class="koboSpan" id="kobo.635.1">ManagedChannelBuilder</span></strong><span class="koboSpan" id="kobo.636.1">&lt;?&gt;  channelBuilder) {  channel = channelBuilder.build();
  blockingStub = </span><strong class="bold"><span class="koboSpan" id="kobo.637.1">EmployeeServiceGrpc.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.638.1">      newBlockingStub</span></strong><span class="koboSpan" id="kobo.639.1">(</span><strong class="bold"><span class="koboSpan" id="kobo.640.1">channel</span></strong><span class="koboSpan" id="kobo.641.1">);
  asyncStub = EmployeeServiceGrpc.newStub(channel);
}</span></pre>
<p><span class="koboSpan" id="kobo.642.1">Here, both blocking</span><a id="_idIndexMarker944"/><span class="koboSpan" id="kobo.643.1"> and</span><a id="_idIndexMarker945"/><span class="koboSpan" id="kobo.644.1"> asynchronous </span><a id="_idIndexMarker946"/><span class="koboSpan" id="kobo.645.1">stubs have been created using the channel built using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.646.1">ManageChannelBuilder</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.647.1"> class.</span></span></p>
<p><span class="koboSpan" id="kobo.648.1">Let’s explore error handling in the </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">next section.</span></span></p>
<h1 id="_idParaDest-246"><a id="_idTextAnchor245"/><span class="koboSpan" id="kobo.650.1">Handling errors and error status codes</span></h1>
<p><span class="koboSpan" id="kobo.651.1">Unlike REST, which makes use of the HTTP status codes, gRPC uses a </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">Status</span></strong><span class="koboSpan" id="kobo.653.1"> model, which contains its </span><a id="_idIndexMarker947"/><span class="koboSpan" id="kobo.654.1">error codes </span><a id="_idIndexMarker948"/><span class="koboSpan" id="kobo.655.1">and optional error </span><span class="No-Break"><span class="koboSpan" id="kobo.656.1">message (string).</span></span></p>
<p><span class="koboSpan" id="kobo.657.1">If you remember, you have used the special class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">Error</span></strong><span class="koboSpan" id="kobo.659.1"> to contain the error details because HTTP error codes contain limited information. </span><span class="koboSpan" id="kobo.659.2">Similarly, the gRPC error </span><strong class="source-inline"><span class="koboSpan" id="kobo.660.1">Status</span></strong><span class="koboSpan" id="kobo.661.1"> model is limited to code and an optional message (string). </span><span class="koboSpan" id="kobo.661.2">You don't have sufficient error details for the client to use to handle the error or retry. </span><span class="koboSpan" id="kobo.661.3">You can make use of the richer error model as described at </span><a href="https://cloud.google.com/apis/design/errors#error_model"><span class="koboSpan" id="kobo.662.1">https://cloud.google.com/apis/design/errors#error_model</span></a><span class="koboSpan" id="kobo.663.1">, which allows you to pass detailed error information back to the client. </span><span class="koboSpan" id="kobo.663.2">You can also find the error models in the next code block for </span><span class="No-Break"><span class="koboSpan" id="kobo.664.1">quick reference:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.665.1">
package google.rpc;message Status {
  // actual error code is defined by `google.rpc.Code`.
</span><span class="koboSpan" id="kobo.665.2">  int32 code = 1;
  // A developer-facing human-readable error message
  string message = 2;
  // Additional error information that the client
     code can use
  // to handle the error, such as retry info or a
     help link.
</span><span class="koboSpan" id="kobo.665.3">  </span><strong class="bold"><span class="koboSpan" id="kobo.666.1">repeated</span></strong><span class="koboSpan" id="kobo.667.1"> google.protobuf.Any </span><strong class="bold"><span class="koboSpan" id="kobo.668.1">details</span></strong><span class="koboSpan" id="kobo.669.1"> = 3;
}</span></pre>
<p><span class="koboSpan" id="kobo.670.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">details</span></strong><span class="koboSpan" id="kobo.672.1"> field contains extra information, and you can use it to pass relevant information such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">RetryInfo</span></strong><span class="koboSpan" id="kobo.674.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.675.1">DebugInfo</span></strong><span class="koboSpan" id="kobo.676.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.677.1">QuotaFailure</span></strong><span class="koboSpan" id="kobo.678.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.679.1">ErrorInfo</span></strong><span class="koboSpan" id="kobo.680.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.681.1">PreconditionFailure</span></strong><span class="koboSpan" id="kobo.682.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.683.1">BadRequest</span></strong><span class="koboSpan" id="kobo.684.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.685.1">RequestInfo</span></strong><span class="koboSpan" id="kobo.686.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.687.1">ResourceInfo</span></strong><span class="koboSpan" id="kobo.688.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">Help</span></strong><span class="koboSpan" id="kobo.690.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">LocalizedMethod</span></strong><span class="koboSpan" id="kobo.692.1">. </span><span class="koboSpan" id="kobo.692.2">All these message types are available </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">at </span></span><a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto"><span class="No-Break"><span class="koboSpan" id="kobo.694.1">https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.695.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.696.1">These richer error models are described using Protobuf. </span><span class="koboSpan" id="kobo.696.2">If you would like to use richer error models, you must make sure that support libraries are aligned with the practical use of APIs, as described </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">for Protobuf.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">Like REST, errors can</span><a id="_idIndexMarker949"/><span class="koboSpan" id="kobo.699.1"> be </span><a id="_idIndexMarker950"/><span class="koboSpan" id="kobo.700.1">raised by the RPC for various reasons, such as network failure or data validation. </span><span class="koboSpan" id="kobo.700.2">Let’s have a look at the following REST error codes and their respective </span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">gRPC counterparts:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table003">
<colgroup>
<col/>
<col/>
<col/>
</colgroup>
<thead>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.702.1">HTTP </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.703.1">Status Code</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><strong class="bold"><span class="koboSpan" id="kobo.704.1">gRPC </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.705.1">Status Code</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.706.1">Notes</span></strong></span></p>
</td>
</tr>
</thead>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">400</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.708.1">INVALID_ARGUMENT</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.709.1">For </span><span class="No-Break"><span class="koboSpan" id="kobo.710.1">invalid arguments.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">400</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.712.1">FAILED_PRECONDITION</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.713.1">The action could not be performed due to a </span><span class="No-Break"><span class="koboSpan" id="kobo.714.1">failed pre-condition.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">400</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.716.1">OUT_OF_RANGE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.717.1">If an invalid range is specified by </span><span class="No-Break"><span class="koboSpan" id="kobo.718.1">the client.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.719.1">401</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">UNAUTHENTICATED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.721.1">If the client’s request is not authenticated, such as having a missing or </span><span class="No-Break"><span class="koboSpan" id="kobo.722.1">expired token.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.723.1">403</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">PERMISSION_DENIED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.725.1">The client does not have the </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">sufficient permission.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">404</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.728.1">NOT_FOUND</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.729.1">The requested resource was </span><span class="No-Break"><span class="koboSpan" id="kobo.730.1">not found.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.731.1">409</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">ABORTED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.733.1">A conflict for read-write operations or any </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">concurrency conflict.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">409</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">ALREADY_EXISTS</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.737.1">If the request is for creating a new resource that </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">already exists.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">429</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.740.1">RESOURCE_EXHAUSTED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.741.1">If the request reaches the API </span><span class="No-Break"><span class="koboSpan" id="kobo.742.1">rate limiting.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">499</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">CANCELLED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.745.1">If the request is canceled by </span><span class="No-Break"><span class="koboSpan" id="kobo.746.1">the client.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.747.1">500</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.748.1">DATA_LOSS</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.749.1">For unrecoverable data loss </span><span class="No-Break"><span class="koboSpan" id="kobo.750.1">or corruption.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">500</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.752.1">UNKNOWN</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.753.1">For an unknown error at </span><span class="No-Break"><span class="koboSpan" id="kobo.754.1">the server.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">500</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.756.1">INTERNAL</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.757.1">For an internal </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">server error.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.759.1">501</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.760.1">NOT_IMPLEMENTED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.761.1">API not implemented by </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">the server.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.763.1">502</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.764.1">N/A</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.765.1">Error due to unreachable network or </span><span class="No-Break"><span class="koboSpan" id="kobo.766.1">network misconfiguration.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.767.1">503</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">UNAVAILABLE</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.769.1">The server is down or unavailable due to any reason. </span><span class="koboSpan" id="kobo.769.2">The client can perform a retry on </span><span class="No-Break"><span class="koboSpan" id="kobo.770.1">such errors.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.771.1">504</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.772.1">DEADLINE_EXCEEDED</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.773.1">Either request doesn’t finish within </span><span class="No-Break"><span class="koboSpan" id="kobo.774.1">the deadline.</span></span></p>
</td>
</tr>
</tbody>
</table>
<p><span class="koboSpan" id="kobo.775.1">gRPC error codes are</span><a id="_idIndexMarker951"/><span class="koboSpan" id="kobo.776.1"> more </span><a id="_idIndexMarker952"/><span class="koboSpan" id="kobo.777.1">readable as you don’t need mapping to understand the </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">number codes.</span></span></p>
<h1 id="_idParaDest-247"><a id="_idTextAnchor246"/><span class="koboSpan" id="kobo.779.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.780.1">In this chapter, you explored Protobuf, IDL, and the serialization utility. </span><span class="koboSpan" id="kobo.780.2">You also explored gRPC fundamentals such as service definitions, messages, server interfaces, and methods. </span><span class="koboSpan" id="kobo.780.3">You compared gRPC with REST. </span><span class="koboSpan" id="kobo.780.4">I hope this has given you enough perspective to </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">understand gRPC.</span></span></p>
<p><span class="koboSpan" id="kobo.782.1">You also learned about the gRPC life cycles, servers, and clients with stubs. </span><span class="koboSpan" id="kobo.782.2">You covered Protobuf, gRPC architecture, and gRPC fundamentals, which will allow you to develop gRPC-based APIs </span><span class="No-Break"><span class="koboSpan" id="kobo.783.1">and services.</span></span></p>
<p><span class="koboSpan" id="kobo.784.1">You will make use of the fundamentals you learned in this chapter in the next chapter to implement the gRPC server </span><span class="No-Break"><span class="koboSpan" id="kobo.785.1">and client.</span></span></p>
<h1 id="_idParaDest-248"><a id="_idTextAnchor247"/><span class="koboSpan" id="kobo.786.1">Questions</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.787.1">What </span><span class="No-Break"><span class="koboSpan" id="kobo.788.1">is RPC?</span></span></li>
<li><span class="koboSpan" id="kobo.789.1">How is gRPC different in comparison to REST and which one should </span><span class="No-Break"><span class="koboSpan" id="kobo.790.1">be used?</span></span></li>
<li><span class="koboSpan" id="kobo.791.1">Which type of service method is useful when you want to view the latest tweets or do similar types </span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">of work?</span></span></li>
</ol>
<h1 id="_idParaDest-249"><a id="_idTextAnchor248"/><span class="koboSpan" id="kobo.793.1">Answers</span></h1>
<ol>
<li value="1"><span class="koboSpan" id="kobo.794.1">RPC stands for Remote Procedure Call. </span><span class="koboSpan" id="kobo.794.2">A client can call an exposed procedure on a remote server, which is just like calling a local procedure, but it gets executed on a remote server. </span><span class="koboSpan" id="kobo.794.3">An RPC is best suited for inter-service communication in </span><span class="No-Break"><span class="koboSpan" id="kobo.795.1">connected systems.</span></span></li>
<li><span class="koboSpan" id="kobo.796.1">gRPC is based on the client-server architecture, whereas this is not true for REST. </span><span class="koboSpan" id="kobo.796.2">gRPC also supports full-duplex streaming communication in contrast to REST. </span><span class="koboSpan" id="kobo.796.3">gRPC performs better than REST as it uses static paths and a single source of the </span><span class="No-Break"><span class="koboSpan" id="kobo.797.1">request payload.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.798.1">A REST response error depends on HTTP status codes, whereas gRPC has formalized the set of errors to make it well aligned with APIs. </span><span class="koboSpan" id="kobo.798.2">gRPC has also been built to support and handle call cancellations, load balancing, and failovers. </span><span class="koboSpan" id="kobo.798.3">For more information, please refer to the </span><em class="italic"><span class="koboSpan" id="kobo.799.1">REST versus </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.800.1">gRPC</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.801.1"> subsection.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.802.1">You should use the server-streaming RPC method because you want to receive the latest messages from the server, such </span><span class="No-Break"><span class="koboSpan" id="kobo.803.1">as tweets.</span></span></li>
</ol>
<h1 id="_idParaDest-250"><a id="_idTextAnchor249"/><span class="koboSpan" id="kobo.804.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.805.1">You can find out more at the </span><span class="No-Break"><span class="koboSpan" id="kobo.806.1">following links:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.807.1">gRPC </span><span class="No-Break"><span class="koboSpan" id="kobo.808.1">documentation: </span></span><a href="https://grpc.io/"><span class="No-Break"><span class="koboSpan" id="kobo.809.1">https://grpc.io/</span></span></a></li>
<li><em class="italic"><span class="koboSpan" id="kobo.810.1">Practical </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.811.1">gRPC</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">: </span></span><a href="https://www.packtpub.com/in/web-development/practical-grpc"><span class="No-Break"><span class="koboSpan" id="kobo.813.1">https://www.packtpub.com/in/web-development/practical-grpc</span></span></a></li>
</ul>
</div>
</body></html>