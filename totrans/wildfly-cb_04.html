<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Managing the Logging Subsystem with the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Managing the Logging Subsystem with the CLI</h1></div></div></div><p>In this chapter, you will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Creating a file-handler logging</li><li class="listitem" style="list-style-type: disc">Creating a periodic-rotating file-handler</li><li class="listitem" style="list-style-type: disc">Creating a size-rotating file-handler</li><li class="listitem" style="list-style-type: disc">Defining asynchronous handlers</li><li class="listitem" style="list-style-type: disc">Creating a syslog-handler</li><li class="listitem" style="list-style-type: disc">Listing and reading log files</li><li class="listitem" style="list-style-type: disc">Using a different logging implementation</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Introduction</h1></div></div></div><p>The logging subsystem <a id="id339" class="indexterm"/>is where you can configure the information statements of WildFly and your application, for debugging and auditing purposes.</p><p>WildFly comes with a default configuration, which can be found in the <code class="literal">configuration</code> folder of both the standalone and domain directories. The default configuration automatically logs the information on the console and on a file named <code class="literal">server.log</code>.</p><p>As you will learn in this <a id="id340" class="indexterm"/>chapter, WildFly has seven different handlers to help you persist with your application logs:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Console</strong></span>: Writes <a id="id341" class="indexterm"/>application logs to the standard output</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>File</strong></span>: Writes <a id="id342" class="indexterm"/>application logs to a file</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Periodic</strong></span>: Writes <a id="id343" class="indexterm"/>application logs to a file by rotating it on the basis of time</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Size</strong></span>: Writes <a id="id344" class="indexterm"/>application logs to a file by rotating it on the basis of size</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Async</strong></span>: Wraps one <a id="id345" class="indexterm"/>or more handler to give asynchronous behavior</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Custom</strong></span>: Lets you use <a id="id346" class="indexterm"/>your own handler, as long as it extends the <code class="literal">java.util.logging.Handler</code> class</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Syslog</strong></span>: Writes <a id="id347" class="indexterm"/>application logs to the default OS logger</li></ul></div><p>Depending on the <a id="id348" class="indexterm"/>operation mode of your WildFly, you have different settings concerning the default log file paths.</p><div class="section" title="Domain mode"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec95"/>Domain mode</h2></div></div></div><p>In a managed <a id="id349" class="indexterm"/>domain, we have two types of log files: Controller and server logs.</p><p>Starting with the default configuration of <code class="literal">domain.xml</code>, both the domain controller components and the servers are located on the same host:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Process</p>
</th><th style="text-align: left" valign="bottom">
<p>Log File</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Host Controller]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.log.dir/host-controller.log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Process Controller]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.log.dir/process-controller.log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Server One]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.servers.dir/server-one/log/server.log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Server Two]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.servers.dir/server-two/log/server.log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Server Three]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.domain.servers.dir/server-three/log/server.log</code>
</p>
</td></tr></tbody></table></div><p>If you want to change one of the previously mentioned properties, you can set a different value, as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/domain.sh -Djboss.domain.log.dir=/home/luigi/wildfly-domain-logs</pre></div></div><div class="section" title="Standalone mode"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec96"/>Standalone mode</h2></div></div></div><p>The default log <a id="id350" class="indexterm"/>files for a standalone server is in the log subdirectory of the <code class="literal">jboss.server.base.dir</code> folder of the WildFly home:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Process</p>
</th><th style="text-align: left" valign="bottom">
<p>Log File</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">[Server]</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.log.dir/server.log</code>
</p>
</td></tr></tbody></table></div><p>If you want to change the <a id="id351" class="indexterm"/>previously mentioned property, you can set a different value, as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/standalone.sh -Djboss.server.log.dir=/home/luigi/wildfly-standalone-logs</pre></div></div></div></div>
<div class="section" title="Creating a file-handler logging"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec42"/>Creating a file-handler logging</h1></div></div></div><p>The logging <a id="id352" class="indexterm"/>subsystem is where you configure the output information statements of your application and/or WildFly cores, for debugging or auditing purposes. In this recipe, we will learn how to target the log statement output of your application to a file-handler.</p><p>For the sake of simplicity, we will try our recipe with WildFly running in the standalone mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec97"/>Getting ready</h2></div></div></div><p>First of all, let's create a standalone configuration for our recipe, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone std-logging</pre></div><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">logging</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>.</p><p>Now, let's start WildFly, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/std-logging</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec98"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect

[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now execute the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/file-handler=<span class="strong"><strong>wildflycookbook-fh</strong></span>:add(level=INFO, file={"relative-to"=&gt;"jboss.server.log.dir", "path"=&gt;"wildflycookbook-fh.log"}, append=false, autoflush=true)
[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add(use-parent-handlers=false,handlers=<span class="strong"><strong>["wildflycookbook-fh"]</strong></span>,level=INFO)</pre></div></li><li class="listitem">Now deploy the <code class="literal">logging.war</code> application, and take a look at the <code class="literal">log</code> folder to see if the file <code class="literal">wildflycookbook-fh.log</code> is present. The corresponding test URL is as follows <code class="literal">http://127.0.0.1:8080/logging</code>.</li></ol></div><p>Now check your logs and you should see something like this:</p><div class="mediaobject"><img src="graphics/3744_04_01.jpg" alt="How to do it..."/><div class="caption"><p>Log statements with wildflycookbook-fh file handler.</p></div></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec99"/>How it works...</h2></div></div></div><p>We first need to add the file-handler, and then create a category to map the proper application packages to our new file-handler, <code class="literal">wildflycookbook-fh</code>.</p><p>Application package <a id="id353" class="indexterm"/>can be any, even the WildFly internal package, that you might be interested in and want to store in a separate file.</p><p>Anyway, once you've created the file-handler, you can check it's configuration within the CLI, as follows:</p><div class="mediaobject"><img src="graphics/3744_04_02.jpg" alt="How it works..."/></div><p>Looking at the <code class="literal">standalone.xml file</code>, the new file-handler configuration looks as follows:</p><div class="informalexample"><pre class="programlisting">&lt;file-handler name="wildflycookbook-fh" autoflush="true"&gt;
  &lt;level name="INFO"/&gt;
  &lt;file relative-to="jboss.server.log.dir" path="wildflycookbook-fh.log"/&gt;
  &lt;append value="false"/&gt;
&lt;/file-handler&gt;            
&lt;logger category="com.packtpub.wildflycookbook" use-parent-handlers="false"&gt;
  &lt;level name="INFO"/&gt;
  &lt;handlers&gt;
    &lt;handler name="wildflycookbook-fh"/&gt;
  &lt;/handlers&gt;
&lt;/logger&gt;</pre></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec100"/>There's more...</h2></div></div></div><p>Typically, every <a id="id354" class="indexterm"/>environment has its own peculiarities, even for the logging subsystem. In a test environment, you will probably need more information to view, so you want developer information to be traced into the log file. We can achieve this behavior by enabling the <code class="literal">DEBUG</code> level on both, handler and category. Let's see both the instructions.</p><p>First we enable the <code class="literal">DEBUG</code> level on the file handler itself:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/file-handler=wildflycookbook-fh:write-attribute(name=level,value=DEBUG)</pre></div><p>Then we enable the <code class="literal">DEBUG</code> level on the category:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:write-attribute(name=level,value=DEBUG)</pre></div></div></div>
<div class="section" title="Creating a periodic-rotating file-handler"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Creating a periodic-rotating file-handler</h1></div></div></div><p>In this recipe, we will <a id="id355" class="indexterm"/>learn how to target the log statement output of your application to a periodic file handler. This is different from the file-handler, in that when the running system reaches a pre-defined time (that is, hour change, day change, and so on), the log file rolls, backing up itself and creating a new file with the same characteristics.</p><p>For the sake of simplicity, we will try our recipe with WildFly running in the standalone mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec101"/>Getting ready</h2></div></div></div><p>If you didn't follow the previous recipe, we will need to create a standalone configuration for our recipe, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone std-logging</pre></div><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">logging</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>.</p><p>Now, let's start WildFly, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/std-logging</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec102"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running <a id="id356" class="indexterm"/>WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect

[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now execute the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/periodic-rotating-file-handler=<span class="strong"><strong>wildflycookbook-prfh</strong></span>:add(level=INFO, file={"relative-to"=&gt;"jboss.server.log.dir", "path"=&gt;"wildflycookbook-prfh.log"}, append=false, autoflush=true, <span class="strong"><strong>suffix=".yyyy-MM-dd-HH-mm</strong></span>")</pre></div><p>In the preceding configuration, we settled the suffix, the rotating algorithm, to minutes just to give an example.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>In a production environment, you should use a daily rotating algorithm and schedule an <code class="literal">olding</code> mechanism to back up the files somewhere else in order to avoid file system fullfilling.</p></div></div><p>Nevertheless, if you followed the previous recipe, you just need to add the <code class="literal">periodic.rotating-file-handler</code> to the category as follows:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add-handler(name=<span class="strong"><strong>wildflycookbook-prfh</strong></span>)</pre></div></li><li class="listitem">Instead, if you skipped the <span class="emphasis"><em>Creating a file-handler logging</em></span> recipe, you need to create a new category and reference the handler to it, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add(use-parent-handlers=false,handlers=<span class="strong"><strong>["wildflycookbook-prfh"]</strong></span>, level=INFO)</pre></div></li><li class="listitem">Now deploy the <code class="literal">logging.war</code>, if you haven't done it yet, and take a look at the <code class="literal">log</code> folder to check if the file <code class="literal">wildflycookbook-prfh.log</code> is present. To trigger the log statements into the new file, hit the following address: <code class="literal">http://127.0.0.1:8080/logging</code>.<p>Now wait a minute, and refresh the page a couple of times. What you should notice in the <code class="literal">jboss.server.base.dir/log</code> folder is at least another <code class="literal">*-prfh*</code> log file, as follows:</p><div class="mediaobject"><img src="graphics/3744_04_03.jpg" alt="How to do it…"/></div></li></ol></div><p>As you can see, our log file has rotated once.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec103"/>How it works…</h2></div></div></div><p>We first need to create the file-handler and then create a category to map the proper application packages to our new periodic-rotating-file-handler <code class="literal">wildflycookbook-prfh</code>. Application package can be any, even the WildFly internal package, that you might be interested in and want to <a id="id357" class="indexterm"/>store in a separate file.</p><p>What about the "zero" byte file? That file was created just after the creation of the handler. In my case, I waited for a  few minutes before running the <code class="literal">logging</code> application, so when it was time to write on the file, the handler first checked if the minute was changed (it was), then rolled the file. It then created the new file and wrote into it.</p><p>Anyway, once you've created the periodic-rotating-file-handler, you can check it's configuration within the CLI, as follows:</p><div class="mediaobject"><img src="graphics/3744_04_04.jpg" alt="How it works…"/></div><p>Looking at <code class="literal">standalone.xml</code>, the new periodic-rotating-file-handler configuration looks like the following:</p><div class="informalexample"><pre class="programlisting">&lt;periodic-rotating-file-handler name="wildflycookbook-prfh" autoflush="true"&gt;
  &lt;level name="INFO"/&gt;
  &lt;file relative-to="jboss.server.log.dir" path="wildflycookbook-prfh.log"/&gt;
  &lt;suffix value=".yyyy-MM-dd-HH-mm"/&gt;
  &lt;append value="false"/&gt;
&lt;/periodic-rotating-file-handler&gt;
&lt;logger category="com.packtpub.wildflycookbook" use-parent-handlers="false"&gt;
  &lt;level name="INFO"/&gt;
  &lt;handlers&gt;
    &lt;handler name="wildflycookbook-fh"/&gt;
    &lt;handler name="wildflycookbook-prfh"/&gt;
  &lt;/handlers&gt;
&lt;/logger&gt;</pre></div><p>The <a id="id358" class="indexterm"/><code class="literal">wildflycookbook-fh</code> handler is present because of the previous recipe.</p></div></div>
<div class="section" title="Creating a size-rotating file-handler"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Creating a size-rotating file-handler</h1></div></div></div><p>In this recipe, we <a id="id359" class="indexterm"/>will learn how to target the log statement output of your application to a size-rotating-file-handler. It is different from a file-handler in that when the file itself reaches a specific size in terms of bytes, it rolls backing up itself and creates a new file with the same characteristics. This mechanism is, by default, settled to have only one backup file. This is to prevent your hard disks running out of space quickly, in case you forget the setting.</p><p>For the sake of simplicity, we will try our recipe with WildFly running in the standalone mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec104"/>Getting ready</h2></div></div></div><p>If you didn't follow the previous recipe, we will need to create a standalone configuration for our recipe, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone std-logging</pre></div><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">logging</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>.</p><p>Now, let's start WildFly, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/std-logging</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec105"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running <a id="id360" class="indexterm"/>WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh--connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now execute the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/size-rotating-file-handler=<span class="strong"><strong>wildflycookbook-srfh</strong></span>:add(level=INFO, file={"relative-to"=&gt;"jboss.server.log.dir", "path"=&gt;"wildflycookbook-srfh.log"}, append=false, autoflush=true, <span class="strong"><strong>rotate-size</strong></span>=1k, <span class="strong"><strong>max-backup-index</strong></span>=5)</pre></div><p>In the preceding configuration, we settled the <code class="literal">rotate-size</code> to <code class="literal">1</code> KB. When the file reaches that size, the handler closes the current file and creates a new one. The old one will be renamed with an index suffix. The property <code class="literal">max-backup-index</code> specifies exactly how many files the handler has to maintain; in our case it is <code class="literal">five</code>.</p></li><li class="listitem">Nevertheless, in the <span class="emphasis"><em>Creating a file-handler logging</em></span> recipe we created a logger category. Thus, if you followed that recipe, you just need to add the <code class="literal">size-rotating-file-handler</code> handler to the category as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add-handler(name=<span class="strong"><strong>wildflycookbook-srfh</strong></span>)</pre></div></li><li class="listitem">Instead, if you skipped the <code class="literal">Creating a file-handler logging</code> recipe, you need to create a new category and reference the handler to it, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add(use-parent-handlers=false,handlers=<span class="strong"><strong>["wildflycookbook-srfh"]</strong></span>, level=INFO)</pre></div></li><li class="listitem">Now deploy the <code class="literal">logging.war</code>, if you haven't done it yet, and take a look at the <code class="literal">log</code> folder to check if the file <code class="literal">wildflycookbook-srfh.log</code> is present. To trigger the log statements into the new file, hit the following address: <code class="literal">http://127.0.0.1:8080/logging</code>.</li><li class="listitem">Do it three to four times, so that our log file increases in size. What you should notice is a couple of <code class="literal">*-srfh.log</code> log files in the <code class="literal">jboss.server.base.dir/log</code> folder, as follows:<div class="mediaobject"><img src="graphics/3744_04_05.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec106"/>How it works…</h2></div></div></div><p>We first need to create the size-rotating-file-handler and then create/choose a category to map the proper application packages to our new size-rotating-file-handler, <code class="literal">wildflycookbook-srfh</code>. Application package can be any, even the WildFly internal package, that you might <a id="id361" class="indexterm"/>be interested in and want to store in a separate file.</p><p>What happens if we reach <code class="literal">max-backup-index</code>?</p><p>Suppose we already switched our current log file five times, so in our <code class="literal">log</code> folder we have the following files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log.1</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log.2</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log.3</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log.4</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">wildflycookbook-srfh.log.5</code></li></ul></div><p>Indexed files are all about 1 KB in size, while the current one, <code class="literal">wildflycookbook-srfh.log</code> needs only a few more bytes to roll.</p><p>As we hit our application once again, the current file rolls with the index suffix 1, the old <code class="literal">.1</code> becomes <code class="literal">.2</code>, the old <code class="literal">.2</code> becomes <code class="literal">.3</code> and so on.. What happens to the <code class="literal">.5</code> file? It gets removed and the <code class="literal">.4</code> file takes its place.</p><p>Anyway, once you've created the size-rotating-file-handler, you can check its configuration within the CLI, as follows:</p><div class="mediaobject"><img src="graphics/3744_04_06.jpg" alt="How it works…"/></div><p>Looking at <a id="id362" class="indexterm"/><code class="literal">standalone.xml</code>, the new size-rotating-file-handler configuration looks like this:</p><div class="informalexample"><pre class="programlisting">&lt;size-rotating-file-handler name="wildflycookbook-srfh" autoflush="true"&gt;
  &lt;level name="INFO"/&gt;
  &lt;file relative-to="jboss.server.log.dir" path="wildflycookbook-srfh.log"/&gt;
  &lt;rotate-size value="1k"/&gt;
  &lt;max-backup-index value="5"/&gt;
  &lt;append value="false"/&gt;
&lt;/size-rotating-file-handler&gt;
&lt;logger category="com.packtpub.wildflycookbook" use-parent-handlers="false"&gt;
  &lt;level name="INFO"/&gt;
  &lt;handlers&gt;
    &lt;handler name="wildflycookbook-fh"/&gt;
    &lt;handler name="wildflycookbook-prfh"/&gt;
    &lt;handler name="wildflycookbook-srfh"/&gt;
  &lt;/handlers&gt;
&lt;/logger&gt;</pre></div><p>The handlers, <code class="literal">wildflycookbook-fh</code> and <code class="literal">wildflycookbook-prfh,</code> are present because of the previous recipes.</p></div></div>
<div class="section" title="Defining asynchronous handlers"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Defining asynchronous handlers</h1></div></div></div><p>In this recipe, you <a id="id363" class="indexterm"/>will learn how to target the log statement output of your application to a handler of your choice and have it logging in an asynchronous way. For the sake of simplicity, we will try our recipe with WildFly running in the standalone mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec107"/>Getting ready</h2></div></div></div><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">logging</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>.</p><p>Furthermore, this recipe relies on the configuration made while explaining the <span class="emphasis"><em>Creating a file-handler logging</em></span> and <span class="emphasis"><em>Creating a periodic-rotating file-handler</em></span> recipes of this chapter.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec108"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running <a id="id364" class="indexterm"/>WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh--connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now execute the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/async-handler=wildflycookbook-afh:add(level=INFO, <span class="strong"><strong>queue-length</strong></span>=1024, <span class="strong"><strong>overflow-action</strong></span>=BLOCK)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /] /subsystem=logging/async-handler=wildflycookbook-afh:assign-subhandler(name=<span class="strong"><strong>wildflycookbook-prfh</strong></span>)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /] /subsystem=logging/async-handler=wildflycookbook-afh:assign-subhandler(name=<span class="strong"><strong>wildflycookbook-fh</strong></span>)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">To check the new configuration, just issue the following command:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/async-handler=wildflycookbook-afh:read-resource(recursive=true,include-runtime=true,include-defaults=true)
{
  "outcome" =&gt; "success",
  "result" =&gt; {
    "enabled" =&gt; true,
    "filter" =&gt; undefined,
    "filter-spec" =&gt; undefined,
    "level" =&gt; "INFO",
    "name" =&gt; "wildflycookbook-afh",
    "overflow-action" =&gt; "BLOCK",
    "queue-length" =&gt; 1024,
    "subhandlers" =&gt; [
        "wildflycookbook-prfh",
        "wildflycookbook-fh"
    ]
  }
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Okay, now we have our new async-handler managing two other handlers in an asynchronous way. To check if the async-handler is properly configured, open the browser and point it to the following URL: <code class="literal">http://127.0.0.1:8080/logging</code></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec109"/>How it works…</h2></div></div></div><p>The files managed by the <code class="literal">wildflycookbook-fh</code> and <code class="literal">wildflycookbook-prfh</code> handlers, still write into their own <a id="id365" class="indexterm"/>log files. The async-handler itself does not generate any additional files at all; it only adds asynchronous behavior to the other handlers.</p><p>The async-handler is used to improve the logging throughput.</p><p>It grabs application log statements, puts them into a buffer, and then logs them using the handlers that you defined. Also, this buffer is not unbounded—it has a limit. As a matter of fact, from the commands shown in the <span class="emphasis"><em>How to do it</em></span> section, I've emphasized some of the key points: <code class="literal">queue-length</code> and <code class="literal">overflow-action</code>.</p><p>Simply speaking, we told the async-handler how many log statements the buffers can hold, and what it should do when there is no more room in them.</p><p>We settled <code class="literal">1024</code> as the number of the log statements for the buffer, and we settled a <code class="literal">block</code> action as an exceeded limit behavior. This means that the log statement is in a hold state until it finds room in the buffer. You can otherwise choose the <code class="literal">discard</code> action, with the consequence of losing your logs.</p><p>You can use whatever action you want, but keep in mind that for the <code class="literal">block</code> action, you should tune the size of your buffer to not hold too many or too few logs.</p><p>Looking at <code class="literal">standalone.xml</code>, the new async-handler configuration looks like this:</p><div class="informalexample"><pre class="programlisting">&lt;async-handler name="wildflycookbook-afh"&gt;
  &lt;level name="INFO"/&gt;
  &lt;queue-length value="1024"/&gt;
  &lt;overflow-action value="block"/&gt;
  &lt;subhandlers&gt;
    &lt;handler name="wildflycookbook-prfh"/&gt;
    &lt;handler name="wildflycookbook-fh"/&gt;
  &lt;/subhandlers&gt;
&lt;/async-handler&gt;</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec110"/>There's more…</h2></div></div></div><p>The async-handler is faster, so why wouldn't you always use that?  Well, not always; sometimes you can get a worse performance by using the async-handler.</p><p>If your application makes <a id="id366" class="indexterm"/>intense use of I/O operations, then you can benefit from it. On the other hand, if your application makes intense use of the CPU, you will definitely not benefit from using the async-handler, as it will increase context-switching.</p></div></div>
<div class="section" title="Creating a syslog-handler"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Creating a syslog-handler</h1></div></div></div><p>In this recipe, we <a id="id367" class="indexterm"/>will learn how to use "syslog". The syslog is a standard protocol used for message logging. This standard has been implemented for different operating systems, such as Linux, Unix, and Windows. In 2009, the <span class="strong"><strong>Internet </strong></span><a id="id368" class="indexterm"/><span class="strong"><strong>Engineering Task Force</strong></span> (<span class="strong"><strong>IETF</strong></span>) standardized the "syslog" protocol specification, which can be viewed at the following address:</p><p>
<a class="ulink" href="http://tools.ietf.org/html/rfc5424">http://tools.ietf.org/html/rfc5424</a>
</p><p>You will probably use <code class="literal">syslog-handler</code> in environments where a centralized logging system is used to collect all system information.</p><p>Lastly, for this recipe I will use a syslog server named <code class="literal">syslog-ng</code>.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To install into a Fedora 21 system, do as follows:<div class="informalexample"><pre class="programlisting">$ sudo yum -y install rsyslog</pre></div></li><li class="listitem">Once done, enable the following directives into <code class="literal">/etc/rsyslog.conf</code>,:<div class="informalexample"><pre class="programlisting">$ModLoad imudp.so
$UDPServerRun 514</pre></div></li><li class="listitem">Then start the <code class="literal">rsyslogd</code> daemon with the following command:<div class="informalexample"><pre class="programlisting">$ sudo /usr/sbin/rsyslogd</pre></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Its detailed installation and configuration is out of the scope of this book. By the way, you can refer to <a id="id369" class="indexterm"/>the official documentation at the following site:</p><p>
<a class="ulink" href="https://syslog-ng.org">https://syslog-ng.org</a>
</p></div></div><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec111"/>Getting ready</h2></div></div></div><p>If you didn't follow the previous recipe, we will need to create a standalone configuration for our recipe, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone std-logging</pre></div><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">logging</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>,<span class="emphasis"><em> Welcome to WildFly!</em></span>.</p><p>Now, let's start WildFly, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/std-logging</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec112"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh--connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now execute <a id="id370" class="indexterm"/>the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/syslog-handler=wildfly-slh:add(server-address=localhost,hostname=foogaro,port=514,syslog-format=RFC5424,facility=user-level,level=INFO,app-name=wildfly-logging,enabled=true)
{"outcome" =&gt; "success"}</pre></div></li><li class="listitem">Now we need to associate the handler to a logger, and we will use <code class="literal">com.packtpub.wildflycookbook</code> (used in the previous recipes of this chapter), as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging/logger=com.packtpub.wildflycookbook:add-handler(name=wildfly-slh)
{"outcome" =&gt; "success"}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Before we can test our new configuration, open a new terminal window and <code class="literal">tail</code> the <code class="literal">syslog</code>, by issuing the following command:<div class="informalexample"><pre class="programlisting">$ journalctl -f</pre></div><p>This will work in Fedora 21; in a different Linux system, you may find your <code class="literal">SysLog</code> server logging into the <code class="literal">/var/log/messages</code> file. However, point to the file with regard to your OS.</p></li><li class="listitem">Once ready, deploy the logging application, if you haven't done so yet, and open your browser to the following URL: <code class="literal">http://localhost:8080/logging</code>.</li><li class="listitem">You should see something similar to the following:<div class="informalexample"><pre class="programlisting">Message from syslogd@localhost at Apr 19 17:56:36 ...
<span class="strong"><strong>wildfly-logging</strong></span>[15343] Fatal message</pre></div><p>It's our logging application's fatal message catched by the syslog. You know this because it refers to the <code class="literal">wildfly-logging</code> which corresponds to the value of the attribute <code class="literal">app-name</code>, when defining the <code class="literal">syslog-handler</code>. It worked!</p></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec113"/>How it works…</h2></div></div></div><p>First of all, it's better to repeat that "syslog" is a protocol, thus it has many implementations <a id="id371" class="indexterm"/>depending on the hardware and software. In other words, it is OS dependent. In our first command, while creating the <code class="literal">syslog-handler</code>, we specified a lot of parameters.</p><p>Let's summarize them in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Attribute</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">server-address</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is where the syslog server is—default is <code class="literal">localhost</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">hostname</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the hostname of the sever sending the messages.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">port</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the port that the syslog server listens to—default is <code class="literal">514</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">syslog-format</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The format used to log the message based on the RFC5424 specification—default is <code class="literal">RFC5424</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">facility</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the "category" of the message, still based on the RFC5425 specification—default is <code class="literal">user-level</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">level</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This is the log level—default is <code class="literal">ALL</code>.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">app-name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This should correspond to the application generating the message. It's basically used for filtering.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">enabled</code>
</p>
</td><td style="text-align: left" valign="top">
<p>When set to false, disables the <code class="literal">syslog-handler</code>—default value is <code class="literal">true</code>.</p>
</td></tr></tbody></table></div><p>However, whenever you create a handler, you will always have to reference it into a logger. Otherwise you will not see any messages at all.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note17"/>Note</h3><p>Going into much detail about the "syslog" protocol is out of the scope of this book. For more <a id="id372" class="indexterm"/>information about it, please refer to its <a id="id373" class="indexterm"/>specification, available at the following site:</p><p>
<a class="ulink" href="http://tools.ietf.org/html/rfc5424">http://tools.ietf.org/html/rfc5424</a>
</p></div></div></div></div>
<div class="section" title="Listing and reading log files"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Listing and reading log files</h1></div></div></div><p>In this recipe, we <a id="id374" class="indexterm"/>will learn how to list and read log files. This can be helpful when <a id="id375" class="indexterm"/>you have access only to the CLI (which might be a remote one), and not to the server itself or the file system hosting the log files.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec114"/>Getting ready</h2></div></div></div><p>To fully understand this recipe, you should have followed one of the previous recipes, which have created the various log files. However, the standard WildFly log file <code class="literal">server.log</code> would be present and it's enough.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec115"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Before reading a file, we need to know which log files are present. To list them all, execute the following commands:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:list-log-files
{
  "outcome" =&gt; "success",
  "result" =&gt; [
    {
      "file-name" =&gt; "server.log",
      "file-size" =&gt; 24879L,
      "last-modified-date" =&gt; "2015-05-24T15:14:29.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-fh.log",
      "file-size" =&gt; 0L,
      "last-modified-date" =&gt; "2015-05-24T15:14:13.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-prfh.log",
      "file-size" =&gt; 0L,
      "last-modified-date" =&gt; "2015-05-24T15:14:13.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-prfh.log.2015-05-24-14-42",
      "file-size" =&gt; 0L,
      "last-modified-date" =&gt; "2015-05-24T14:42:14.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-prfh.log.2015-05-24-14-43",
      "file-size" =&gt; 440L,
      "last-modified-date" =&gt; "2015-05-24T14:43:06.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-srfh.log",
      "file-size" =&gt; 0L,
      "last-modified-date" =&gt; "2015-05-24T15:14:13.000+0200"
    },
    {
      "file-name" =&gt; "wildflycookbook-srfh.log.1",
      "file-size" =&gt; 1096L,
      "last-modified-date" =&gt; "2015-05-24T14:44:17.000+0200"
    }
    ]
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Because of our <a id="id376" class="indexterm"/>previous recipes, we have a lot of files to look at. For <a id="id377" class="indexterm"/>the purpose of this recipe, we will use the default log file, <code class="literal">server.log</code>. To read the file, we can try the following command:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:read-log-file(name=server.log)
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "2015-05-24 15:14:14,813 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-9) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8080",
        "2015-05-24 15:14:14,964 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-15) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]",
        "2015-05-24 15:14:15,021 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-5) WFLYDS0013: Started FileSystemDeploymentService for directory /Users/foogaro/wildfly-9.0.0.Beta2/std-logging/deployments",
        "2015-05-24 15:14:15,025 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-8) WFLYSRV0027: Starting deployment of \"logging.war\" (runtime-name: \"logging.war\")",
        "2015-05-24 15:14:15,116 INFO [org.jboss.ws.common.management] (MSC service thread 1-4) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3",
        "2015-05-24 15:14:15,363 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-11) WFLYUT0021: Registered web context: /logging",
        "2015-05-24 15:14:15,405 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 34) WFLYSRV0010: Deployed \"logging.war\" (runtime-name : \"logging.war\")",
        "2015-05-24 15:14:15,545 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
        "2015-05-24 15:14:15,546 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
        "2015-05-24 15:14:15,546 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 2328ms - Started 269 of 451 services (221 services are lazy, passive or on-demand)"
    ]
}
[standalone@localhost:9990 /]</pre></div><p>As you can see, the output shows just the last few lines of the content.</p></li><li class="listitem">If you want to read <a id="id378" class="indexterm"/>from the beginning, you can specify the <code class="literal">tail=false</code> <a id="id379" class="indexterm"/>parameter (by default, it is set to <code class="literal">true</code>), along with the <code class="literal">name</code> parameter, as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:read-log-file(name=server.log,tail=false)
{
    "outcome" =&gt; "success",
    "result" =&gt; [
        "2015-05-24 14:38:38,059 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final",
        "2015-05-24 14:38:38,216 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final",
        "2015-05-24 14:38:38,266 INFO  [org.jboss.as] (MSC service thread 1-6) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting",
        "2015-05-24 14:38:38,267 DEBUG [org.jboss.as.config] (MSC service thread 1-6) Configured system properties:",
        "[Standalone] = ",
        "awt.toolkit = sun.lwawt.macosx.LWCToolkit",
        "file.encoding = UTF-8",
        "file.encoding.pkg = sun.io",
        "file.separator = /",
        "ftp.nonProxyHosts = local|*.local|169.254/16|*.169.254/16"
    ]
}
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">If you want to see <a id="id380" class="indexterm"/>more lines of the log file, just specify the number <a id="id381" class="indexterm"/>of lines you want,  and add the <code class="literal">lines</code> parameter as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:read-log-file(name=server.log,lines=15)
{
  "outcome" =&gt; "success",
  "result" =&gt; [
    "2015-05-24 15:14:14,642 INFO  [org.jboss.as.naming] (MSC service thread 1-16) WFLYNAM0003: Starting Naming Service",
    "2015-05-24 15:14:14,642 INFO [org.jboss.as.mail.extension] (MSC service thread 1-14) 
    WFLYMAIL0001: Bound mail session [java:jboss/mail/Default]",
    "2015-05-24 15:14:14,703 INFO [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0014: Creating file handler for path /Users/foogaro/wildfly-9.0.0.Beta2/welcome-content",
    "2015-05-24 15:14:14,728 INFO [org.wildfly.extension.undertow] (MSC service thread 1-5) WFLYUT0012: Started server default-server.",
    "2015-05-24 15:14:14,745 INFO [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0018: Host default-host starting",
    "2015-05-24 15:14:14,813 INFO [org.wildfly.extension.undertow] (MSC service thread 1-9) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8080",
    "2015-05-24 15:14:14,964 INFO [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-15) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]",
    "2015-05-24 15:14:15,021 INFO [org.jboss.as.server.deployment.scanner] (MSC service thread 1-5) WFLYDS0013: Started FileSystemDeploymentService for directory /Users/foogaro/wildfly-9.0.0.Beta2/std-logging/deployments",
    "2015-05-24 15:14:15,025 INFO [org.jboss.as.server.deployment] (MSC service thread 1-8) WFLYSRV0027: Starting deployment of \"logging.war\" (runtime-name: \"logging.war\")",
    "2015-05-24 15:14:15,116 INFO [org.jboss.ws.common.management] (MSC service thread 1-4) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3",
    "2015-05-24 15:14:15,363 INFO [org.wildfly.extension.undertow] (MSC service thread 1-11) WFLYUT0021: Registered web context: /logging",
    "2015-05-24 15:14:15,405 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 34) WFLYSRV0010: Deployed \"logging.war\" (runtime-name : \"logging.war\")",
    "2015-05-24 15:14:15,545 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management",
    "2015-05-24 15:14:15,546 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990",
    "2015-05-24 15:14:15,546 INFO  [org.jboss.as] (Controller 
    Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 2328ms - Started 269 of 451 services (221 services are lazy, passive or on-demand)"
    ]
}
[standalone@localhost:9990 /]</pre></div></li></ol></div><p>Obviously, a continuous <code class="literal">tail -f</code> like command would be very useful, but there isn't one, at least not for the moment.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec116"/>There's more…</h2></div></div></div><p>There is one more option <a id="id382" class="indexterm"/>worth mentioning, that is, the <code class="literal">skip</code> parameter. It basically shifts <a id="id383" class="indexterm"/>your lines up or down, depending on whether you are starting from the head or the tail of the file.</p><p>Let's give it a try using a skip by 5 lines:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:read-log-file(name=server.log,skip=5)
{
  "outcome" =&gt; "success",
  "result" =&gt; [
    "2015-05-24 15:14:14,642 INFO  [org.jboss.as.naming] (MSC service thread 1-16) WFLYNAM0003: Starting Naming Service",
    "2015-05-24 15:14:14,642 INFO  [org.jboss.as.mail.extension] (MSC service thread 1-14) WFLYMAIL0001: Bound mail session [java:jboss/mail/Default]",
    "2015-05-24 15:14:14,703 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0014: Creating file handler for path /Users/foogaro/wildfly-9.0.0.Beta2/welcome-content",
    "2015-05-24 15:14:14,728 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-5) WFLYUT0012: Started server default-server.",
    "2015-05-24 15:14:14,745 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0018: Host default-host starting",
    "2015-05-24 15:14:14,813 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-9) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8080",
    "2015-05-24 15:14:14,964 INFO [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-15) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]",
    "2015-05-24 15:14:15,021 INFO [org.jboss.as.server.deployment.scanner] (MSC service thread 1-5) WFLYDS0013: Started FileSystemDeploymentService for directory /Users/foogaro/wildfly-9.0.0.Beta2/std-logging/deployments",
    "2015-05-24 15:14:15,025 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-8) WFLYSRV0027: Starting deployment of \"logging.war\" (runtime-name: \"logging.war\")",
    "2015-05-24 15:14:15,116 INFO  [org.jboss.ws.common.management] (MSC service thread 1-4) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3"
    ]
}
[standalone@localhost:9990 /]</pre></div><p>The command just dropped the last 5 lines of the file, but it started displaying the output 5 lines earlier. By default, the total number of lines displayed is 10—this is because, by default, it starts reading the tail of the file.</p><p>Since WildFly version 8.2, the <a id="id384" class="indexterm"/>logging subsystem earned a new resource called <code class="literal">log-file</code>. The <a id="id385" class="indexterm"/>resource lists all log files defined in the <code class="literal">jboss.server.log.dir</code> (or <code class="literal">jboss.domain.log.dir</code> depending on the operational mode), which are defined in the subsystem. With WildFly 9, now you can download a log file by using the management interface.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a browser and point it to <code class="literal">http://localhost:9990/management/subsystem/logging/log-file/server.log?operation=attribute&amp;name=stream&amp;useStreamAsResponse</code>.</li><li class="listitem">Alternatively, you can use HTTP tools such as <code class="literal">curl</code>. With the <code class="literal">curl</code> tool, you can get a log file content, as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest -o server.log -L -D - http://127.0.0.1:9990/management?useStreamAsResponse --header "Content-Type: application/json" -u wildfly:cookbook.2015 -d '{"operation":"read-attribute","address":[{"subsystem":"logging"},{"log-file":"server.log"}],"name":"stream"}'</pre></div><p>The preceding example gets the stream of the <code class="literal">server.log</code> and stores it into a homonymous file (the <code class="literal">-o server.log</code> directive effectively stores the output).</p></li><li class="listitem">Meanwhile, with the new release of WildFly 9, you can read the log file directly from the Web <a id="id386" class="indexterm"/>Console. You can see all the available files by <a id="id387" class="indexterm"/>clicking on <span class="strong"><strong>Runtime</strong></span> and by selecting the <span class="strong"><strong>Log viewer</strong></span> menu item on the left, as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_04_07.jpg" alt="There's more…"/></div></li><li class="listitem">Once you select the log file to view, the <span class="strong"><strong>Download</strong></span> and <span class="strong"><strong>View</strong></span> buttons, are enabled. The <a id="id388" class="indexterm"/>following screenshot is how a log file looks like in the Web Console:<div class="mediaobject"><img src="graphics/3744_04_08.jpg" alt="There's more…"/></div></li></ol></div><p>How nice and elegant!</p></div></div>
<div class="section" title="Using a different logging implementation"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Using a different logging implementation</h1></div></div></div><p>In this final recipe <a id="id389" class="indexterm"/>about logging, we will learn how to use a different logging implementation. In the earlier version of JBoss AS, you could have relied on the <code class="literal">java.util.logging</code> (also JUL) or the <code class="literal">log4j</code> implementation. WildFly relies on the JUL logging implementation.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec117"/>Getting ready</h2></div></div></div><p>To manage which logging implementation you can use, WildFly gives you a couple of attributes.</p><p>The first one is named <code class="literal">add-logging-api-dependencies</code>, which can be set to <code class="literal">true</code> (default value) or to <code class="literal">false</code>. When it's true, the WildFly logging default implementation is automatically added to all deployments.</p><p>The other attribute is named <code class="literal">use-deployment-logging-config</code>, which can be set to <code class="literal">true</code> (default value) or to <code class="literal">false</code>. When set to <code class="literal">true</code>, it gives to deployments the <code class="literal">per-deployment logging</code> feature, which essentially enables your application to carry its own logging configuration file.</p><p>The following configuration files are allowed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">logging.properties</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">jboss-logging.properties</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">log4j.properties</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">log4j.xml</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">jboss-log4j.xml</code></li></ul></div><p>If you are deploying an EAR application, the file should be placed into the <code class="literal">META-INF</code> directory. While in case of WAR and JAR bundles, the file could be either placed into the <code class="literal">META-INF</code> or <code class="literal">WEB-INF</code> directory.</p><p>Now let's go back to our recipe. We will see how we can use a different logging implementation. We will use the <code class="literal">log4j</code> implementation.</p><p>To test our logging configuration, we will need an application to log some statements. In this case, we will use the application named <code class="literal">log4j</code>. To obtain the artifact to deploy, please refer to the <span class="emphasis"><em>Software prerequisites</em></span> recipe in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span>.</p><p>Now it's time to create a custom standalone configuration folder to test our recipe, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone std-log4j
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/std-log4j</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec118"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly server, open your command-line tool and connect to the CLI:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now we remove the automatic logging dependency of our application. Keep in mind that this setting would be general to all other applications that are running on the same WildFly instance, as shown in the following command:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:write-attribute(name=add-logging-api-dependencies,value=false)
{"outcome" =&gt; "success"}</pre></div></li><li class="listitem">Now the <a id="id390" class="indexterm"/>application to be deployed needs to declare a dependency to <code class="literal">log4j</code>, which is already provided to you as a module in the WildFly home <code class="literal">modules/system/layers/base/org/apache/log4j/main</code> folder. To do this, you need to add a file called <code class="literal">jboss-deployment-structure.xml</code> into your <code class="literal">META-INF</code> or <code class="literal">WEB-INF</code> folder (depending if you got an EAR or a WAR application), which looks like the following:<div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;jboss-deployment-structure &gt;
  &lt;deployment&gt;
    &lt;dependencies&gt;
      &lt;module name="org.apache.log4j" /&gt;
     &lt;/dependencies&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;
Now, let's go back to the CLI to tell WildFly that we have our own configuration file, which looks like the following:
&lt;log4j:configuration debug="true" xmlns:log4j='http://jakarta.apache.org/log4j/'&gt;
  &lt;appender name="fileAppender" class="org.apache.log4j.RollingFileAppender"&gt;
      &lt;param name="append" value="false" /&gt;
      &lt;param name="file" value="log4j.log" /&gt;

      &lt;layout class="org.apache.log4j.PatternLayout"&gt;
        &lt;param name="ConversionPattern" value="%d{ABSOLUTE} %-5p [%c{1}] %m%n" /&gt;
      &lt;/layout&gt;
  &lt;/appender&gt;
  &lt;root&gt;
    &lt;level value="DEBUG" /&gt;
    &lt;appender-ref ref="fileAppender" /&gt;
  &lt;/root&gt;
&lt;/log4j:configuration&gt;</pre></div></li><li class="listitem">As <a id="id391" class="indexterm"/>previously mentioned, the <code class="literal">per-deployment-logging</code> feature is enabled by default. However, here is the CLI command to enable it:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] /subsystem=logging:write-attribute(name=use-deployment-logging-config,value=true)
{
  "outcome" =&gt; "success",
  "response-headers" =&gt; {
    "operation-requires-reload" =&gt; true,
    "process-state" =&gt; "reload-required"
  }
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>Remember to <code class="literal">reload</code> the server once done.</p></div></div></li><li class="listitem">Also, as pointed out in the <span class="emphasis"><em>Getting ready</em></span> section, you can provide your own logging configuration file. The following is the <code class="literal">log4j.xml</code>  file that comes with my <code class="literal">log4j</code> application:<div class="informalexample"><pre class="programlisting">&lt;log4j:configuration debug="true" xmlns:log4j='http://jakarta.apache.org/log4j/'&gt;
  &lt;appender name="fileAppender" class="org.apache.log4j.RollingFileAppender"&gt;
    &lt;param name="append" value="false" /&gt;
    &lt;param name="file" value="log4j.log" /&gt;

    &lt;layout class="org.apache.log4j.PatternLayout"&gt;
      &lt;param name="ConversionPattern" value="%d{ABSOLUTE} %-5p [%c{1}] %m%n" /&gt;
    &lt;/layout&gt;
  &lt;/appender&gt;
    &lt;root&gt;
      &lt;level value="DEBUG" /&gt;
      &lt;appender-ref ref="fileAppender" /&gt;
    &lt;/root&gt;
&lt;/log4j:configuration&gt;</pre></div></li><li class="listitem">Now we can build and deploy the application. While deploying the application, keep an eye on the logs in the <code class="literal">log4j.log</code> file ( defined in the above XML code snippet), available in the <code class="literal">£WILDFLY_HOME</code> folder. You should see the following entries:<div class="informalexample"><pre class="programlisting">15:32:20,835 ERROR [Startup] Error message
15:32:20,837 WARN  [Startup] Warning message
15:32:20,837 INFO  [Startup] Information message
15:32:20,837 DEBUG [Startup] Debug message</pre></div></li></ol></div></div><div class="section" title="There is more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec119"/>There is more…</h2></div></div></div><p>There is another way to achieve the same result. You can maintain the <code class="literal">add-logging-api-dependencies</code> to <code class="literal">true</code>, and exclude the <code class="literal">logging</code> subsystem to avoid implicit dependencies <a id="id392" class="indexterm"/>within the <code class="literal">jboss-deployment-structure.xml</code> file, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;jboss-deployment-structure &gt;
  &lt;deployment&gt;
    &lt;exclude-subsystems&gt;
      &lt;subsystem name="logging"/&gt;
      &lt;/exclude-subsystems&gt;
      &lt;dependencies&gt;
        &lt;module name="org.apache.log4j" /&gt;
      &lt;/dependencies&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></div><p>This approach is too conservative, as it won't affect other applications which may rely on the logging subsystem.</p><p>Furthermore, the dependencies can be written in the standard Java way, which is via the <code class="literal">MANIFEST.MF</code> file placed in the <code class="literal">META-INF</code> folder, as follows:</p><div class="informalexample"><pre class="programlisting">Manifest-Version: 1.0
Dependencies: org.apache.log4j
&lt;empty line&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>Remember to include an empty line at the end of the line, to have a valid <code class="literal">MANIFEST.MF</code> file. You can also have more dependencies modules, by separating them with a comma <code class="literal">,</code>.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec120"/>See also</h2></div></div></div><p>More information <a id="id393" class="indexterm"/>about how logging works in <a id="id394" class="indexterm"/>WildFly 9, can be viewed at <a class="ulink" href="https://docs.jboss.org/author/display/WFLY9/Logging+Configuration">https://docs.jboss.org/author/display/WFLY9/Logging+Configuration</a>.</p></div></div></body></html>