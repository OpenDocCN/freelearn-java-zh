<html><head></head><body>
<div id="page" style="height:0pt"/><div class="book" title="Chapter&#xA0;6.&#xA0;Player Permissions" id="190861-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06" class="calibre1"/>Chapter 6. Player Permissions</h1></div></div></div><p class="calibre8">Player Permissions is one feature that nearly every Bukkit server administrator wants to have on their server. In vanilla Minecraft, you are either an <a id="id151" class="calibre1"/>
<span class="strong"><strong class="calibre2">OP</strong></span> (<span class="strong"><strong class="calibre2">operator</strong></span>), or simply a regular player. With permissions, you can create an infinite number of ranks between the two. There are several permission plugins available, which can be found on the Bukkit or Spigot websites. In the past, developers had to write their own code in order to support one or more of these permission systems. Luckily, the Bukkit API now has a basis for player permissions, which makes our job easier. We no longer need to learn a new API for every permissions plugin that exists. We only need to support Bukkit's universal permissions system, which we can be sure will not change drastically at any moment. In this chapter, you will do just that and install a permissions plugin that helps you organize each player's permissions. By the end of this chapter, you will be able to control your server in a way that ensures that untrusted players will not be able to spoil the fun for everyone else. We will cover the following topics in this chapter:</p><div class="book"><ul class="itemizedlist"><li class="listitem">The benefits of using permissions on your server and in plugins</li><li class="listitem">What a permission node is and how it is used by developers and server administrators</li><li class="listitem">Adding a permission node to the <code class="email">plugin.yml</code> file</li><li class="listitem">Assigning a permission node to one of your plugin's commands</li><li class="listitem">Testing player permissions in-game</li><li class="listitem">Installing and configuring a third-party permissions plugin</li><li class="listitem">Using permission nodes throughout your plugin</li></ul></div></div>

<div class="book" title="Chapter&#xA0;6.&#xA0;Player Permissions" id="190861-b66e70deee6e4ed481db4b113e303f23">
<div class="book" title="The benefits of permissions"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_1"><a id="ch06lvl1sec37" class="calibre1"/>The benefits of permissions</h1></div></div></div><p class="calibre8">
<span class="strong"><strong class="calibre2">Permissions</strong></span><a id="id152" class="calibre1"/> give you more control over the players on your server. They allow you to prevent abuse from untrusted players. With permissions, you can give each player a specific rank based on their role in the server and how trustworthy they are. Let's say that you want to give a specific player the ability to teleport to the location of some other <a id="id153" class="calibre1"/>players. With permissions, you can do so without giving that same player the ability to spawn items, kick/ban other players, and even stop your server completely! The simplest example of a useful permission is not giving new players the permission to build. This prevents someone from logging on to your server with the sole intention of defacing the world. They will be unable to destroy your or other players' buildings.</p><p class="calibre8">When programming plugins, you can assign certain permissions to specific commands or actions. This allows you to give the benefits of your plugins to privileged people only. For example, you may want only your good friend and yourself to have the option of enchanting your items using the <code class="email">enchant</code> command. The first step to accomplishing this is to know what permission nodes are and how they work.</p></div></div>
<div class="book" title="Understanding permission nodes" id="19UOO1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec38" class="calibre1"/>Understanding permission nodes</h1></div></div></div><p class="calibre8">A <span class="strong"><strong class="calibre2">permission node</strong></span><a id="id154" class="calibre1"/> is a <code class="email">string</code> that usually contains multiple words separated by periods. These permission nodes are given to players to give them special privileges on the server. An example of this is <code class="email">minecraft.command.give</code>, which is the permission node that is needed to execute the <code class="email">give</code> command. As you can see, it can be broken down into three parts, namely, the creator (Minecraft), the category (command), and the specific privilege (the <code class="email">give</code> command). You will find most permission nodes structured this way. For a plugin, its permission nodes begin with the name of the plugin. This helps prevent any collision of nodes. If two plugins were to use the same permission node, then an administrator cannot limit access to one node and not the other node. You will also find that many plugins' permission nodes are only two words long. This is done when the plugin does not have many permissions. Therefore, there is no need for categories. On the other hand, for large plugins, you may wish to include numerous nested categories.</p><p class="calibre8">To help you understand permission nodes, we will create a <a id="id155" class="calibre1"/>permission node for the <code class="email">Enchanter</code> plugin. The first word of the permission node will be<a id="id156" class="calibre1"/> the name of the plugin, while<a id="id157" class="calibre1"/> the second word will be the name of the command. If the permission node is directly related to a specific command, then it is wise to use the command name within the permission node. This will make your permissions simple to understand and easy to remember. The permission node for the <code class="email">enchant</code> command<a id="id158" class="calibre1"/> will be <code class="email">enchanter.enchant</code>. If we expect this plugin to have several permissions, then we can use <code class="email">enchanter.command.enchant</code> instead. Either permission node is fine, but we will use the former in our example. Note that most developers tend to keep their permission nodes in lowercase. This is optional, but it usually prevents errors when typing in the node later. Once we have decided upon a permission node, we must add it to <code class="email">plugin.yml</code> in order to use it with a plugin.</p></div>
<div class="book" title="Adding a permission node to plugin.yml" id="1AT9A1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec39" class="calibre1"/>Adding a permission node to plugin.yml</h1></div></div></div><p class="calibre8">In the <code class="email">Enchanter</code> project, open the <code class="email">plugin.yml</code> file. Adding permission nodes is similar to how commands are added. On a<a id="id159" class="calibre1"/> new line, add <code class="email">permissions:</code>. Ensure <a id="id160" class="calibre1"/>that this line is not indented at all. On the lines that follow, add each permission node that our plugin will use, followed by a colon. The next few lines will provide the attributes of the permission, such as its description. The following code is an example of how the <code class="email">plugin.yml</code> file will look with the <code class="email">enchant</code> permission node added. Ensure that the indentations are similar. Note that the version attribute should also be updated to indicate that this is a new and improved version of the <code class="email">Enchanter</code> plugin:</p><div class="informalexample"><pre class="programlisting">name: Enchanter
version: 0.2
main: com.codisimus.enchanter.Enchanter
description: Used to quickly put enchantments on an item
commands:
  enchant:
    aliases: e
    description: Adds enchantments to the item in your hand
    usage: Hold the item you wish to enchant and type /enchant
permissions:
  enchanter.enchant:
    description: Needed to use the enchant command
    default: op</pre></div><p class="calibre8">The default attribute can be set to <code class="email">true</code>, <code class="email">false</code>, <code class="email">op</code>, or <code class="email">not op</code>. This determines who will have this permission; <code class="email">true</code> means that everyone will have this permission, <code class="email">false</code> means that no one will have it, <code class="email">op</code> means that only operators will have it, and <code class="email">not op</code> means that everyone except for the operators will have it. Who has this permission can be further modified by using a permission plugin, which will be discussed later in this chapter.</p><p class="calibre8">Just like with commands, you can assign multiple permissions to a plugin. For more information<a id="id161" class="calibre1"/> on the <code class="email">plugin.yml</code> file, visit <a class="calibre1" href="http://wiki.bukkit.org/Plugin_YAML">http://wiki.bukkit.org/Plugin_YAML</a>.</p></div>
<div class="book" title="Assigning a permission node to a plugin command" id="1BRPS1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec40" class="calibre1"/>Assigning a permission node to a plugin command</h1></div></div></div><p class="calibre8">Now that we have created the <a id="id162" class="calibre1"/>permission node, we want to <a id="id163" class="calibre1"/>prevent players from using the <code class="email">enchant</code> command if they do not have the <code class="email">enchanter.enchant</code> node. This process is simple, as it only requires adding a few more lines to the <code class="email">plugin.yml</code> file.</p><p class="calibre8">For the <code class="email">enchant</code> command, we will add two attributes, namely <code class="email">permission</code> and <code class="email">permission-message</code>. The <code class="email">permission</code> attribute is simply the permission node that is needed to execute the command. The <code class="email">permission-message</code> attribute is a message that the player will see if they do not have the necessary permissions. After these additions, the <code class="email">plugin.yml</code> file will look like this:</p><div class="informalexample"><pre class="programlisting">name: Enchanter
version: 0.2
main: com.codisimus.enchanter.Enchanter
description: Used to quickly put enchantments on an item
commands:
  enchant:
    aliases: [e]
    description: Adds enchantments to the item in your hand
    usage: Hold the item you wish to enchant and type /enchant
    permission: enchanter.enchant
    permission-message: You do not have permission to enchant items
permissions:
  enchanter.enchant:
    description: Needed to use the enchant command
    default: op</pre></div><p class="calibre8">You may want to <a id="id164" class="calibre1"/>add colors to the permission message. This<a id="id165" class="calibre1"/> can be done by using the <code class="email">§</code> symbol. This is the character that Minecraft uses to indicate a color code. This symbol can be easily typed by holding <span class="strong"><em class="calibre9">Alt</em></span> while pressing <span class="strong"><em class="calibre9">2</em></span> and then <span class="strong"><em class="calibre9">1</em></span>. A list of all the colors and their <a id="id166" class="calibre1"/>corresponding code can be found at <a class="calibre1" href="http://www.minecraftwiki.net/wiki/Formatting_codes">http://www.minecraftwiki.net/wiki/Formatting_codes</a>. An example of the <code class="email">permissions-message</code> line with color support looks like this:</p><div class="informalexample"><pre class="programlisting">permission-message: §4You do not have permission to §6enchant items</pre></div><div class="mediaobject"><img src="../images/00037.jpeg" alt="Assigning a permission node to a plugin command" class="calibre10"/></div><p class="calibre11"> </p></div>
<div class="book" title="Testing player permissions" id="1CQAE1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec41" class="calibre1"/>Testing player permissions</h1></div></div></div><p class="calibre8">You can test the new <a id="id167" class="calibre1"/>addition to the plugin by building the <code class="email">jar</code> file and installing it on your server, as discussed in <a class="calibre1" title="Chapter 4. Testing on the Spigot Server" href="part0033_split_000.html#VF2I1-b66e70deee6e4ed481db4b113e303f23">Chapter 4</a>, <span class="strong"><em class="calibre9">Testing on the Spigot Server</em></span>. Ensure that you reload or restart the server so that the newest version of the plugin is used. Remember that the version number is printed on the console when the plugin is enabled.</p><p class="calibre8">By testing on your server, you will find out that you can enchant items through the plugin. Since you are an OP, you have the <code class="email">enchanter.enchant</code> node by default. <span class="strong"><em class="calibre9">De-OP</em></span> yourself by using the following console command:</p><div class="informalexample"><pre class="programlisting">&gt;deop Codisimus</pre></div><p class="calibre8">Now, you will no <a id="id168" class="calibre1"/>longer be able to use the <code class="email">/enchant</code> command.</p></div>
<div class="book" title="Using a third-party permissions plugin"><div class="book" id="1DOR02-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec42" class="calibre1"/>Using a third-party permissions plugin</h1></div></div></div><p class="calibre8">You will most likely have <a id="id169" class="calibre1"/>trusted players on your server with whom you wish to share the use of the <code class="email">/enchant</code> command. However, these players are not trusted enough to be an OP. In order to share the use of this command, you will need to use a permissions plugin. The permissions plugin will allow you to create multiple groups of players. Each group will have different permissions assigned to it. Each player that plays on your server can then be assigned to a specific group. As an example, you can have four permission groups, namely <span class="strong"><em class="calibre9">default</em></span>, <span class="strong"><em class="calibre9">trusted</em></span>, <span class="strong"><em class="calibre9">mod</em></span>, and <span class="strong"><em class="calibre9">admin</em></span>. The <span class="strong"><em class="calibre9">default</em></span> group will have the basic permissions. A new player who joins the server will be put into the <span class="strong"><em class="calibre9">default</em></span> group. The <span class="strong"><em class="calibre9">trusted</em></span> group will have a few more privileges. They will have access to specific commands, such as setting the time of day in the server world and teleporting players. The <span class="strong"><em class="calibre9">mod</em></span> group stands for "moderator", and it will have access to many other commands, such as kicking or banning a player. Finally, the <code class="email">admin</code> group, which stands for "administrator", will have the <code class="email">/give</code> command and the <code class="email">/enchant</code> command.</p><p class="calibre8">There are several permission plugins available at <a class="calibre1" href="http://dev.bukkit.org">dev.bukkit.org</a>. Each permission plugin is created by a different developer. They have various features depending on how the developer decided to program it. Most of the popular permissions plugins that are used today were actually created before permissions were added to the API. Because of this, they may not utilize all of Bukkit's features. They also include additional features that are no longer needed, such as permission groups. The plugin that we will use is the one that I have developed myself, and it is called <code class="email">CodsPerms</code>. <code class="email">CodsPerms</code> is<a id="id170" class="calibre1"/> a simple and basic permissions plugin. Because <code class="email">CodsPerms</code> follows the rules of the Bukkit API, the group configuration that you will learn in this chapter can also be utilized for other permission plugins. Instructions on where to download <code class="email">CodsPerms</code> can be <a id="id171" class="calibre1"/>found at <a class="calibre1" href="http://codisimus.com/codsperms">http://codisimus.com/codsperms</a>.</p><p class="calibre8">Once you have the <code class="email">jar</code> file of the plugin, install it on your server as you would install one of your own plugins. With the plugin installed, the <code class="email">permission</code> command will be available to you. Executing the <code class="email">/perm</code> command will inform you of the various commands that are now at your disposal.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip19" class="calibre1"/>Tip</h3><p class="calibre8">You need to have the <code class="email">permissions.manage</code> node in order to use the permission command. Until we fully set up the permission plugin, you can either run these commands from the console, or give yourself the OP status.</p></div><p class="calibre8">You will see that there are commands that can be used to give permission nodes to players as well as remove them. This is useful if you want to add single nodes, such as giving yourself the <code class="email">permissions.manage</code> node, but you will not want to use those commands for everyone who joins your server. To resolve this, we will configure the groups that were presented earlier.</p><p class="calibre8">These groups will be created <a id="id172" class="calibre1"/>as a permission node that contains several other child permission nodes. This will allow us to give a player a single group node, and they will then inherit all of its children. We can create these parent nodes within the <code class="email">permissions.yml</code> file located in the <code class="email">root</code> directory (the same folder in which you placed <code class="email">spigot.jar</code>). The <code class="email">permissions.yml</code> file is a <code class="email">YAML</code> file like <code class="email">plugin.yml</code>. Therefore, you should be familiar with the formatting. You can edit this file with a text editor. If you wish to use NetBeans, you can open the file by navigating to <span class="strong"><strong class="calibre2">File</strong></span> | <span class="strong"><strong class="calibre2">Open File…</strong></span> or by dragging and dropping the file in the NetBeans window.</p><div class="informalexample" title="Note"><h3 class="title2"><a id="tip20" class="calibre1"/>Tip</h3><p class="calibre8">Editing a <code class="email">YAML</code> file incorrectly will cause it to not load completely. The issue that you will most likely face with the <code class="email">YAML</code> files is having a <span class="strong"><em class="calibre9">tab</em></span> in your document rather than <span class="strong"><em class="calibre9">spaces</em></span>. This will cause your file to not load properly.</p></div><p class="calibre8">The following code is a sample of how <code class="email">permissions.yml</code> might look after creating the groups that were specified earlier:</p><div class="informalexample"><pre class="programlisting">group.default:
  description: New Players who may have joined for the first time
  default: true
  children:
    minecraft.command.kill: true
    minecraft.command.list: true
group.trusted:
  description: Players who often play on the server
  default: false
  children:
    group.default: true
    minecraft.command.weather: true
    minecraft.command.time: true
    minecraft.command.teleport: true
group.mod:
  description: Players who moderate the server
  default: false
  children:
    group.trusted: true
    minecraft.command.ban: true
    minecraft.command.pardon: true
    minecraft.command.kick: true
group.admin:
  description: Players who administer on the server
  default: false
  children:
    group.mod: true
    minecraft.command.ban-ip: true
    minecraft.command.pardon-ip: true
    minecraft.command.gamerule: true
    minecraft.command.give: true
    minecraft.command.say: true
    permissions.manage: true
    enchanter.enchant: true</pre></div><p class="calibre8">Every group can inherit <a id="id173" class="calibre1"/>the permission nodes of another group by simply adding that group permission node as one of their children. In this example, the <code class="email">admin</code> group inherits all the permissions from the <code class="email">mod</code> group, the <code class="email">mod</code> group inherits all the permissions from the <code class="email">trusted</code> group, and the <code class="email">trusted</code> group inherits all the permissions from the <code class="email">default</code> group. Therefore, the <code class="email">admin</code> group also inherits the <code class="email">default</code> group's permissions through parentage. In this sample file, we have <code class="email">default</code> set to <code class="email">true</code> for the <code class="email">group.default</code> parent node. This means that each player on the server will automatically have the <code class="email">group.default</code> permission node. Because of the child nodes, each player will also have <code class="email">minecraft.command.kill</code> and <code class="email">minecraft.command.list</code>. Adding permissions to the default group will eliminate the need to hand out permissions to each player who joins your server.</p><p class="calibre8">As you can see, the permission nodes earlier included permissions for some Minecraft commands as well as the permission for the <code class="email">Enchanter</code> plugin. There are many more permissions than have already been listed. These are a few that are commonly used. The rest of the permissions for the Minecraft and Bukkit commands<a id="id174" class="calibre1"/> can be found at <a class="calibre1" href="http://wiki.bukkit.org/CraftBukkit_commands">wiki.bukkit.org/CraftBukkit_commands</a>.</p><p class="calibre8">Once you have populated the permissions <code class="email">YAML</code> file, you will have to reload the server in order for the changes to take effect. Now, you can assign players to different groups. Use the following command with your own username to add yourself to the trusted group:</p><div class="informalexample"><pre class="programlisting">&gt;perm give Codisimus group.trusted</pre></div><p class="calibre8">You will have the permissions defined in <code class="email">group.trusted</code> within the <code class="email">permissions.yml</code> file. Try putting yourself in various groups and using the <code class="email">/enchant</code> commands and various other commands. Ensure that you are not an OP, as it will give you all the permissions regardless of which group you are in. Also, keep in mind that you must manually remove yourself from groups. If a player in the <code class="email">admin</code> group is added to the <code class="email">trusted</code> group, they <a id="id175" class="calibre1"/>will still have administrator privileges until they are removed from the admin group.</p></div>
<div class="book" title="Using permission nodes throughout your plugins" id="1ENBI1-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec43" class="calibre1"/>Using permission nodes throughout your plugins</h1></div></div></div><p class="calibre8">In some cases, you may <a id="id176" class="calibre1"/>want to check whether a player has a<a id="id177" class="calibre1"/> specific permission from within your code. With the addition of a universal permission system within Bukkit, this is very easy, regardless of the permission plugin that you are using. Looking at the Bukkit API documentation, you will see that the <code class="email">Player</code> object contains a <code class="email">hasPermission</code> method, which returns a Boolean response. The method requires a <code class="email">string</code> value, which is the permission node that is being checked. We can place this method in an <code class="email">if</code> statement, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">if (player.hasPermission("enchanter.enchant")) {
  //Add a level 10 Knockback enchantment
  Enchantment enchant = Enchantment.KNOCKBACK;
  hand.addUnsafeEnchantment(enchant, 10);
  player.sendMessage("Your item has been enchanted!");
} else {
  player.sendMessage("You do not have permission to enchant");
}</pre></div><p class="calibre8">This block of code is unnecessary for the plugin because Bukkit can automatically handle player permissions for commands. To have a look at how this is properly used, let's go back to <code class="email">MyFirstBukkitPlugin</code> and add a permission check. The following code is the modified <code class="email">onEnable</code> method, which will only say <code class="email">Hello</code> to the players who have the necessary permission:</p><div class="informalexample"><pre class="programlisting">@Override
public void onEnable() {
  if (Bukkit.getOnlinePlayers().size() &gt;= 1) {
    for (Player player : Bukkit.getOnlinePlayers()) {
      //Only say 'Hello' to each player that has permission
      if (player.hasPermission("myfirstbukkitplugin.greeting")) {
        player.sendMessage("Hello " + player.getName());
      }
    }
  } else {
    //Say 'Hello' to the Minecraft World
    broadcastToServer("Hello World!");
  }
}</pre></div><p class="calibre8">Remember that you will also have to modify <code class="email">plugin.yml</code> to add the permission node to your plugin.</p><p class="calibre8">You can also broadcast a <a id="id178" class="calibre1"/>message to only the players who have a specific permission node. The documentation on this can be found at <a class="calibre1" href="https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Bukkit.html#broadcast(java.lang.String,%20java.lang.String)">https://hub.spigotmc.org/javadocs/spigot/org/bukkit/Bukkit.html#broadcast(java.lang.String,%20java.lang.String)</a>.</p><p class="calibre8">Try adding some <a id="id179" class="calibre1"/>permission nodes to some other projects that <a id="id180" class="calibre1"/>were created in the previous chapters. For example, add the <code class="email">creeperhiss.scare</code> permission node to the plugin that has the <code class="email">/scare &lt;player&gt;</code> command. As an added challenge, add an option that allows a player to type <code class="email">/scare all</code> if they want to scare all the players on the server. In this case, you could check each player for the <code class="email">creeperhiss.hear</code> permission node. That way, only those players will hear the sound. This is a good example of a permission node that should be set to <code class="email">not op</code> by default.</p></div>
<div class="book" title="Summary" id="1FLS41-b66e70deee6e4ed481db4b113e303f23"><div class="book"><div class="book"><div class="book"><h1 class="title" id="calibre_pb_0"><a id="ch06lvl1sec44" class="calibre1"/>Summary</h1></div></div></div><p class="calibre8">The existing plugins, after being modified, are now more flexible with the aid of a permission plugin. With <code class="email">CodsPerms</code> running on your server, you can have multiple groups for players. You can create plugins that give certain players privileged commands, and yet these same players will be prevented from using commands that can be misused. This new knowledge of Bukkit permissions will give you an increased control over both your plugins and server. Now that you know how to program both commands and permissions, you are ready to dive into some of the more challenging and exciting sections of the Bukkit API. In the next chapter, you will learn how to automate your server and customize it by using the Bukkit event system.</p></div></body></html>