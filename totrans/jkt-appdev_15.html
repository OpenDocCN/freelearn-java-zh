<html><head></head><body>
<div id="_idContainer080">
<h1 class="chapter-number" id="_idParaDest-196"><a id="_idTextAnchor204"/><span class="koboSpan" id="kobo.1.1">15</span></h1>
<h1 id="_idParaDest-197"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.2.1">Putting it All Together</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In previous chapters, we’ve been covering Jakarta EE APIs and specifications individually. </span><span class="koboSpan" id="kobo.3.2">In this chapter, however, we will develop an application using popular Jakarta EE APIs, illustrating how to use </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">them together.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we will cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">The </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">sample application</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">Creating </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">customer data</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Viewing </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">customer data</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Updating </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">customer data</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Deleting </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">customer data</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.17.1">Implementing pagination</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.18.1">By the end of this chapter, you will have learned how to develop a complete application combining several popular Jakarta </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">EE APIs.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.20.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.21.1">Example source code for this chapter can be found on GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">at </span></span><a href="https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch15_src"><span class="No-Break"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch15_src</span></span></a></p>
<h1 id="_idParaDest-198"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.24.1">The sample application</span></h1>
<p><span class="koboSpan" id="kobo.25.1">The sample application</span><a id="_idIndexMarker705"/><span class="koboSpan" id="kobo.26.1"> that we will develop in this chapter is a typical CRUD (Create, Read, Update and Delete) application. </span><span class="koboSpan" id="kobo.26.2">We will be using CDI to develop our controllers, Jakarta Persistence as our Object-Relational Mapping tool, leveraging Jakarta Enterprise Beans to handle transactions, plus Jakarta Faces to develop the user interface. </span><span class="koboSpan" id="kobo.26.3">We’ll cover some advanced Jakarta Faces features such as developing custom converters and</span><a id="_idIndexMarker706"/><span class="koboSpan" id="kobo.27.1"> implementing custom </span><strong class="bold"><span class="koboSpan" id="kobo.28.1">Expression Language</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.30.1">EL</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">) Resolvers.</span></span></p>
<p><span class="koboSpan" id="kobo.32.1">The application is a web-based application used to maintain customers in a database. </span><span class="koboSpan" id="kobo.32.2">It provides functionality to view all customers, views details for a single customer, and updates and deletes </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">new customers.</span></span></p>
<h2 id="_idParaDest-199"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.34.1">The landing page</span></h2>
<p><span class="koboSpan" id="kobo.35.1">Our</span><a id="_idIndexMarker707"/><span class="koboSpan" id="kobo.36.1"> application’s landing page is a very simple Facelets page, that has a simple command link that invokes a method on the main controller, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.37.1">following snippet.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.38.1">
&lt;h:body&gt;
  &lt;h:form&gt;
    </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">&lt;h:commandLink action="#{customerController.listSetup}"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.40.1">      value="View all customers"/&gt;</span></strong><span class="koboSpan" id="kobo.41.1">
  &lt;/h:form&gt;
&lt;/h:body&gt;</span></pre> <p><span class="koboSpan" id="kobo.42.1">The main controller for our application is a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">CustomerController</span></strong><span class="koboSpan" id="kobo.44.1">. </span><span class="koboSpan" id="kobo.44.2">It is implemented as a session-scoped CDI named bean. </span><span class="koboSpan" id="kobo.44.3">When the user clicks on the link on the page, our Facelets page invokes a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">listSetup()</span></strong><span class="koboSpan" id="kobo.46.1"> on our controller. </span><span class="koboSpan" id="kobo.46.2">This method does some initialization and then directs the user to a page displaying all existing customers, as illustrated in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">code segment.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.48.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted for brevity
@Named
@SessionScoped
public class CustomerController implements Serializable {
  //variable declarations omitted
  </span><strong class="bold"><span class="koboSpan" id="kobo.49.1">public String listSetup()</span></strong><span class="koboSpan" id="kobo.50.1"> {
    reset(true);
    </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">return "/customer/List";</span></strong><span class="koboSpan" id="kobo.52.1">
  }
  private void reset(boolean resetFirstItem) {
    customer = null;
    customerItems = null;
    pagingInfo.setItemCount(-1);
    if (resetFirstItem) {
      pagingInfo.setFirstItem(0);
    }
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.53.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">listSetup()</span></strong><span class="koboSpan" id="kobo.55.1"> method in our controller invokes a </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">reset()</span></strong><span class="koboSpan" id="kobo.57.1"> method which is used for pagination (more on that later), then returns a string matching the path of the page that displays the list of </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">existing customers.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1">The </span><a id="_idIndexMarker708"/><span class="koboSpan" id="kobo.60.1">first time we navigate to the page displaying the list of customers, we simply display a message stating that no customers have been found, as the CUSTOMERS table in the database </span><span class="No-Break"><span class="koboSpan" id="kobo.61.1">is empty.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer071">
<span class="koboSpan" id="kobo.62.1"><img alt="Figure 15.1 – ﻿ Empty Customer List" src="image/B21231_15_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.63.1">Figure 15.1 –  Empty Customer List</span></p>
<p><span class="koboSpan" id="kobo.64.1">Our Facelets page has an </span><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">&lt;h:outputText&gt;</span></strong><span class="koboSpan" id="kobo.66.1"> tag that is rendered only if the list of customers </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">is empty.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.68.1">
&lt;h:form styleClass="jsfcrud_list_form"&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.69.1">  &lt;</span></strong><strong class="bold"><span class="koboSpan" id="kobo.70.1">h:outputText escape="false" value="(No customers found)"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.71.1">    rendered=</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.72.1">      "#{customerController.pagingInfo.itemCount == 0}" /&gt;</span></strong><span class="koboSpan" id="kobo.73.1">
   &lt;!-- Additional markup omitted →
   </span><strong class="bold"><span class="koboSpan" id="kobo.74.1">&lt;h:commandButton</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.75.1">     action="#{customerController.createSetup}"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.76.1">     value="New Customer"/&gt;</span></strong><span class="koboSpan" id="kobo.77.1">
&lt;/form&gt;</span></pre> <p><span class="koboSpan" id="kobo.78.1">Our Facelets page</span><a id="_idIndexMarker709"/><span class="koboSpan" id="kobo.79.1"> also has a command button labeled </span><strong class="bold"><span class="koboSpan" id="kobo.80.1">New Customer</span></strong><span class="koboSpan" id="kobo.81.1">, which invokes logic on our controller to insert Customer data into </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">the database.</span></span></p>
<h2 id="_idParaDest-200"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.83.1">Creating customer data</span></h2>
<p><span class="koboSpan" id="kobo.84.1">The</span><a id="_idIndexMarker710"/><span class="koboSpan" id="kobo.85.1"> command button on the Facelets page displaying a list of customers invokes a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.86.1">createSetup()</span></strong><span class="koboSpan" id="kobo.87.1"> on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">CustomerController</span></strong><span class="koboSpan" id="kobo.89.1">, which does some initialization before displaying a form allowing the user to enter data for a </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">new customer.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.91.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  private Customer customer = null;
  private PagingInfo pagingInfo = null;
  //additional variable declarations omitted
  </span><strong class="bold"><span class="koboSpan" id="kobo.92.1">public String createSetup()</span></strong><span class="koboSpan" id="kobo.93.1"> {
    reset(false);
    customer = new Customer();
    List&lt;Address&gt; addressList = new ArrayList&lt;&gt;(1);
    Address address = new Address();
    List&lt;Telephone&gt; telephoneList = new ArrayList&lt;&gt;(1);
    Telephone telephone = new Telephone();
    address.setCustomer(customer);
    addressList.add(address);
    telephone.setCustomer(customer);
    telephoneList.add(telephone);
    customer.setAddressList(addressList);
    customer.setTelephoneList(telephoneList);
    return "/customer/New";
  }
  private void reset(boolean resetFirstItem) {
    customer = null;
    customerItems = null;
    pagingInfo.setItemCount(-1);
    if (resetFirstItem) {
      pagingInfo.setFirstItem(0);
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.94.1">As we can see, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">createSetup()</span></strong><span class="koboSpan" id="kobo.96.1"> method invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">reset()</span></strong><span class="koboSpan" id="kobo.98.1"> method, which simply clears some data from memory and performs some logic for pagination, then creates a</span><a id="_idIndexMarker711"/><span class="koboSpan" id="kobo.99.1"> new </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">Customer</span></strong><span class="koboSpan" id="kobo.101.1"> object. </span><span class="koboSpan" id="kobo.101.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">Customer</span></strong><span class="koboSpan" id="kobo.103.1"> class is a straightforward JPA Entity, it has one too many relationships with two additional JPA Entities, </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">Address</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.105.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">Telephone</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.108.1">
package com.ensode.jakartaeealltogether.entity;
//imports omitted
@Entity
@Table(name = "CUSTOMERS")
public class Customer implements Serializable {
  private static final long serialVersionUID = 1L;
  @Id
  @Basic(optional = false)
  @GeneratedValue(strategy = GenerationType.AUTO)
  @Column(name = "CUSTOMER_ID")
  private Integer customerId;
  @Column(name = "FIRST_NAME")
  private String firstName;
  @Column(name = "LAST_NAME")
  private String lastName;
  @Column(name = "EMAIL")
  private String email;
  </span><strong class="bold"><span class="koboSpan" id="kobo.109.1">@OneToMany(mappedBy = "customer",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.110.1">    cascade = CascadeType.ALL)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.111.1">  private List&lt;Address&gt; addressList;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.112.1">  @OneToMany(mappedBy = "customer",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.113.1">    cascade = CascadeType.ALL)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.114.1">  private List&lt;Telephone&gt; telephoneList;</span></strong><span class="koboSpan" id="kobo.115.1">
  //methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.116.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">createSetup()</span></strong><span class="koboSpan" id="kobo.118.1"> method initializes the lists of </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">Address</span></strong><span class="koboSpan" id="kobo.120.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">Telephone</span></strong><span class="koboSpan" id="kobo.122.1"> on the new instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">Customer</span></strong><span class="koboSpan" id="kobo.124.1"> to instances of </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">ArrayList</span></strong><span class="koboSpan" id="kobo.126.1"> containing a single element of </span><a id="_idIndexMarker712"/><span class="koboSpan" id="kobo.127.1">the corresponding type, then navigates to the Facelets page where the user can enter data for the new customer. </span><span class="koboSpan" id="kobo.127.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.128.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.129.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer072">
<span class="koboSpan" id="kobo.131.1"><img alt="Figure 15.2 – Entering New Customer data" src="image/B21231_15_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.132.1">Figure 15.2 – Entering New Customer data</span></p>
<p><span class="koboSpan" id="kobo.133.1">The </span><a id="_idIndexMarker713"/><span class="koboSpan" id="kobo.134.1">markup for our page is a fairly standard Facelets page, it implements some custom logic to populate all drop-down menus on the page, for example, to obtain the options on the </span><strong class="bold"><span class="koboSpan" id="kobo.135.1">Address Type</span></strong><span class="koboSpan" id="kobo.136.1"> drop-down, the page invokes a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">addressTypeItemsAvailableSelectOne()</span></strong><span class="koboSpan" id="kobo.138.1">, on a CDI bean </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">AddressTypeController</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.142.1">
 &lt;h:selectOneMenu id="selectOneAddr" value=
   "#{customerController.customer.addressList[0].
</span><span class="koboSpan" id="kobo.142.2">      addressType}" required="true"&gt;
   &lt;f:selectItems id="selectOneAddrOpts" value=</span><strong class="bold"><span class="koboSpan" id="kobo.143.1">"#{addressTypeController.addressTypeItemsAvailableSelectOne}"</span></strong><span class="koboSpan" id="kobo.144.1">/&gt;
&lt;/h:selectOneMenu&gt;</span></pre> <p><span class="koboSpan" id="kobo.145.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.146.1">AddressTypeController.getAddressTypeItemsAvailableSelectOne()</span></strong><span class="koboSpan" id="kobo.147.1"> method invokes a trivial method on a </span><strong class="bold"><span class="koboSpan" id="kobo.148.1">Data Access Object</span></strong><span class="koboSpan" id="kobo.149.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.150.1">DAO</span></strong><span class="koboSpan" id="kobo.151.1">), which returns a list</span><a id="_idIndexMarker714"/><span class="koboSpan" id="kobo.152.1"> of entities containing all address types in the database, then passes this list to a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">getSelectItems()</span></strong><span class="koboSpan" id="kobo.154.1"> on a utility class </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">JSFUtil</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.158.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class AddressTypeController implements Serializable {
  @EJB
  private AddressTypeDao dao;
  public SelectItem[]
        getAddressTypeItemsAvailableSelectOne() {
    return JsfUtil.getSelectItems(
        dao.findAddressTypeEntities(), true);
  }
}</span></pre> <p><span class="koboSpan" id="kobo.159.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">JSFUtil.getSelectItems()</span></strong><span class="koboSpan" id="kobo.161.1"> method iterates through the returned entities and returns an array of </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">SelectItem</span></strong><span class="koboSpan" id="kobo.163.1">, using the return value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.164.1">toString()</span></strong><span class="koboSpan" id="kobo.165.1"> method of each entities as the label, and the entity itself as </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">the value.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.167.1">
package com.ensode.jakartaeealltogether.faces.util;
//imports omitted
public class JsfUtil {
  public static SelectItem[] getSelectItems(List&lt;?&gt; entities, 
    boolean selectOne) {
    int size = selectOne ? </span><span class="koboSpan" id="kobo.167.2">entities.size() + 1 :
      entities.size();
    SelectItem[] items = new SelectItem[size];
    int i = 0;
    if (selectOne) {
      items[0] = new SelectItem("", "---");
      i++;
    }
    for (Object x : entities) {
      items[i++] = new SelectItem(x, x.toString());
    }
    return items;
  }
}</span></pre> <p><span class="koboSpan" id="kobo.168.1">The</span><a id="_idIndexMarker715"/><span class="koboSpan" id="kobo.169.1"> logic to populate other drop-down menus on the page is </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">very similar.</span></span></p>
<p><span class="koboSpan" id="kobo.171.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.172.1">Save</span></strong><span class="koboSpan" id="kobo.173.1"> button on the new customer page is implemented as a </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">command button:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.175.1">
&lt;h:commandButton action="#{customerController.create}"
  value="Save"/&gt;</span></pre> <p><span class="koboSpan" id="kobo.176.1">The command button invokes a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">create()</span></strong><span class="koboSpan" id="kobo.178.1"> on our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">CustomerController</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.180.1"> class.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.181.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  @EJB
  private CustomerDao dao;
  //additional methods and variable declarations omitted
  public String create() {
    try {
      dao.create(customer);
      JsfUtil.addSuccessMessage(
        "Customer was successfully created.");
    } catch (Exception e) {
      JsfUtil.ensureAddErrorMessage(e,
        "A persistence error occurred.");
      return null;
    }
    return listSetup();
  }
}</span></pre> <p><span class="koboSpan" id="kobo.182.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">CustomerController.create()</span></strong><span class="koboSpan" id="kobo.184.1"> method simply invokes a similarly named </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">create()</span></strong><span class="koboSpan" id="kobo.186.1"> method on our data access object, the DAO method simply inserts a new row into </span><a id="_idIndexMarker716"/><span class="koboSpan" id="kobo.187.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">CUSTOMERS</span></strong><span class="koboSpan" id="kobo.189.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">ADDRESSES</span></strong><span class="koboSpan" id="kobo.191.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.192.1">TELEPHONES</span></strong><span class="koboSpan" id="kobo.193.1"> database tables, which correspond to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">Customer</span></strong><span class="koboSpan" id="kobo.195.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">Address</span></strong><span class="koboSpan" id="kobo.197.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">Telephone</span></strong><span class="koboSpan" id="kobo.199.1"> Jakarta </span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">Persistence Entities.</span></span></p>
<p><span class="koboSpan" id="kobo.201.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">CustomerrController.create()</span></strong><span class="koboSpan" id="kobo.203.1"> method then displays a success message to the user if the operation was successful, or an error message if the operation failed. </span><span class="koboSpan" id="kobo.203.2">It then directs the user to the page listing all customer objects. </span><span class="koboSpan" id="kobo.203.3">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.204.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.205.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer073">
<span class="koboSpan" id="kobo.207.1"><img alt="Figure 15.3 – ﻿Populated Customer List" src="image/B21231_15_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.208.1">Figure 15.3 – Populated Customer List</span></p>
<p><span class="koboSpan" id="kobo.209.1">Now that </span><a id="_idIndexMarker717"/><span class="koboSpan" id="kobo.210.1">we have created a customer, our </span><strong class="bold"><span class="koboSpan" id="kobo.211.1">Customer List</span></strong><span class="koboSpan" id="kobo.212.1"> page displays a data table listing the customer we just created. </span><span class="koboSpan" id="kobo.212.2">It contains command links for viewing, editing or deleting each customer. </span><span class="koboSpan" id="kobo.212.3">We will cover how to view existing customer data in the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">next section.</span></span></p>
<h2 id="_idParaDest-201"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.214.1">Viewing customer data</span></h2>
<p><span class="koboSpan" id="kobo.215.1">As mentioned in</span><a id="_idIndexMarker718"/><span class="koboSpan" id="kobo.216.1"> the previous section, each row on the data table on the </span><strong class="bold"><span class="koboSpan" id="kobo.217.1">Customer List</span></strong><span class="koboSpan" id="kobo.218.1"> page has a </span><strong class="bold"><span class="koboSpan" id="kobo.219.1">View</span></strong><span class="koboSpan" id="kobo.220.1"> command link. </span><span class="koboSpan" id="kobo.220.2">The markup for the command link looks like </span><span class="No-Break"><span class="koboSpan" id="kobo.221.1">the following:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.222.1">
&lt;h:commandLink value="View" action="#{customerController.detailSetup}"&gt;
  </span><strong class="bold"><span class="koboSpan" id="kobo.223.1">&lt;f:param name="jsfcrud.currentCustomer" value="#{jsfcrud_class['com.ensode.jakartaeealltogether.faces.util.JsfUtil'].jsfcrud_method['getAsConvertedString'][item1][customerController.converter].jsfcrud_invoke}"/&gt;</span></strong><span class="koboSpan" id="kobo.224.1">
&lt;/h:commandLink&gt;</span></pre> <p><span class="koboSpan" id="kobo.225.1">Notice the </span><strong class="source-inline"><span class="koboSpan" id="kobo.226.1">&lt;f:param&gt;</span></strong><span class="koboSpan" id="kobo.227.1"> tag inside the command link. </span><span class="koboSpan" id="kobo.227.2">This tag adds a request parameter to the HTTP request created when the user clicks </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">the button.</span></span></p>
<p><span class="koboSpan" id="kobo.229.1">We are</span><a id="_idIndexMarker719"/><span class="koboSpan" id="kobo.230.1"> using an advanced Jakarta Faces technique to dynamically generate the value of the request parameter. </span><span class="koboSpan" id="kobo.230.2">We are using a custom Expression Language resolver, so that we can implement custom logic to our Jakarta Faces </span><span class="No-Break"><span class="koboSpan" id="kobo.231.1">expression language.</span></span></p>
<p><span class="koboSpan" id="kobo.232.1">In order to use a custom Expression Language resolver, we need to declare it in our application’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">faces-config.xml </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">configuration</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.235.1"> file.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.236.1">
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;faces-config version="4.0"
  
  
    xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee https://
      jakarta.ee/xml/ns/jakartaee/web-facesconfig_4_0.xsd"&gt;
  </span><strong class="bold"><span class="koboSpan" id="kobo.237.1">&lt;application&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.238.1">    &lt;el-resolver&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.239.1">      com.ensode.jakartaeealltogether.faces.util.JsfCrudELResolver</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.240.1">    &lt;/el-resolver&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.241.1">  &lt;/application&gt;</span></strong><span class="koboSpan" id="kobo.242.1">
&lt;/faces-config&gt;</span></pre> <p><span class="koboSpan" id="kobo.243.1">As we can see, we register our custom Expression Language resolver by placing its fully qualified name inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">&lt;el-resolver&gt;</span></strong><span class="koboSpan" id="kobo.245.1"> tag </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">in faces-config.xml.</span></span></p>
<p><span class="koboSpan" id="kobo.247.1">The details of our Expression Language resolver are out of scope, suffice to say that its </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">getValue()</span></strong><span class="koboSpan" id="kobo.249.1"> method is invoked automatically when resolving the value attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">&lt;f:param&gt;</span></strong><span class="koboSpan" id="kobo.251.1">, it uses Java’s reflection API to determine which method to call. </span><span class="koboSpan" id="kobo.251.2">In our specific example, it calls a method call </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">getConvertedAsString()</span></strong><span class="koboSpan" id="kobo.253.1"> in a class called </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">JsfUtil</span></strong><span class="koboSpan" id="kobo.255.1">, passing an instance of a custom converter called </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">CustomerConverter</span></strong><span class="koboSpan" id="kobo.257.1"> as </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">a parameter.</span></span></p>
<p><span class="koboSpan" id="kobo.259.1">The</span><a id="_idIndexMarker720"/><span class="koboSpan" id="kobo.260.1"> following code snippet shows the signature of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">getValue()</span></strong><span class="koboSpan" id="kobo.262.1"> method of our custom </span><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">ELResolver</span></strong><span class="koboSpan" id="kobo.264.1">, the GitHub repository for this book contains the complete </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">source code.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.266.1">
package com.ensode.jakartaeealltogether.faces.util;
//imports omitted
public class JsfCrudELResolver extends ELResolver {
  //variable declarations omitted
  @Override
  </span><strong class="bold"><span class="koboSpan" id="kobo.267.1">public Object getValue(ELContext context, Object base,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.268.1">    Object property)</span></strong><span class="koboSpan" id="kobo.269.1"> {
    //use reflection to determine which method to invoke
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.270.1">After all is said and done, our </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">ELResolver</span></strong><span class="koboSpan" id="kobo.272.1"> returns the value of the primary key for the corresponding </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">Customer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1"> object.</span></span></p>
<p><span class="koboSpan" id="kobo.275.1">When the user clicks on the </span><strong class="bold"><span class="koboSpan" id="kobo.276.1">View</span></strong><span class="koboSpan" id="kobo.277.1"> link, a method called </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">CustomerController.detailSetup()</span></strong><span class="koboSpan" id="kobo.279.1"> is invoked, which performs some initialization before displaying customer information on </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">the browser.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.281.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  @PostConstruct
  public void init() {
    converter = new CustomerConverter();
  }
  private Customer customer = null;
  private CustomerConverter converter = null;
  //additional variable declarations omitted
  public String detailSetup() {
    return scalarSetup("/customer/Detail");
  }
  private String scalarSetup(String destination) {
    reset(false);
    </span><strong class="bold"><span class="koboSpan" id="kobo.282.1">customer = (Customer) JsfUtil.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.283.1">      getObjectFromRequestParameter(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.284.1">       "jsfcrud.currentCustomer", converter, null);</span></strong><span class="koboSpan" id="kobo.285.1">
    if (customer == null) {
     //error handling code omitted
    }
    return destination;
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.286.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.287.1">CustomerController.detailSetup()</span></strong><span class="koboSpan" id="kobo.288.1"> method simply delegates most of its logic to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.289.1">scalarSetup()</span></strong><span class="koboSpan" id="kobo.290.1"> method, which is used every time we need to display information about a </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">single customer.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.292.1">CustomerController.scalarSetup()</span></strong><span class="koboSpan" id="kobo.293.1"> invokes </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">JsfUtil.getObjectFromRequestParameter()</span></strong><span class="koboSpan" id="kobo.295.1">, passing the request parameter name, and our custom Jakarta </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">Faces converter.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">JSFUtil.getObjectFromRequestParameter()</span></strong><span class="koboSpan" id="kobo.298.1">, in turn, uses our custom converter to </span><a id="_idIndexMarker721"/><span class="koboSpan" id="kobo.299.1">obtain an instance of our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">Customer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.301.1"> object.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.302.1">
package com.ensode.jakartaeealltogether.faces.util;
//imports omitted
public class JsfUtil {
  public static String getRequestParameter(String key) {
    return FacesContext.getCurrentInstance().getExternalContext().
</span><span class="koboSpan" id="kobo.302.2">    getRequestParameterMap().get(key);
  }
  public static Object getObjectFromRequestParameter(String requestParameterName, Converter converter, UIComponent component) {
    String theId =
     JsfUtil.getRequestParameter(requestParameterName);
    return </span><strong class="bold"><span class="koboSpan" id="kobo.303.1">converter.getAsObject(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.304.1">      FacesContext.getCurrentInstance(), component, theId);</span></strong><span class="koboSpan" id="kobo.305.1">
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.306.1">As we can see, </span><strong class="source-inline"><span class="koboSpan" id="kobo.307.1">JSFUtil</span></strong><span class="koboSpan" id="kobo.308.1"> invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">getAsObject()</span></strong><span class="koboSpan" id="kobo.310.1"> method of our custom Faces converter. </span><span class="koboSpan" id="kobo.310.2">Our converter, in turn, obtains our session-scoped </span><strong class="source-inline"><span class="koboSpan" id="kobo.311.1">CustomerController</span></strong><span class="koboSpan" id="kobo.312.1"> instance via the Jakarta Faces API, then invokes its </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">findCustomer()</span></strong><span class="koboSpan" id="kobo.314.1"> method to obtain the corresponding instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">Customer</span></strong><span class="koboSpan" id="kobo.316.1"> Jakarta Persistence entity, as shown in the </span><a id="_idIndexMarker722"/><span class="No-Break"><span class="koboSpan" id="kobo.317.1">following example.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.318.1">
package com.ensode.jakartaeealltogether.faces.converter;
//imports omitted
@FacesConverter(forClass = Customer.class)
public class CustomerConverter implements Converter {
  @Override
  public Object getAsObject(FacesContext facesContext, UIComponent component, String string) {
    if (string == null || string.length() == 0) {
      return null;
    }
    Integer id = Integer.valueOf(string);
    </span><strong class="bold"><span class="koboSpan" id="kobo.319.1">CustomerController controller =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.320.1">      (CustomerController) facesContext.getApplication().</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.321.1">     getELResolver().getValue(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.322.1">     facesContext.getELContext(), null,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.323.1">     "customerController");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.324.1">    return controller.findCustomer(id);</span></strong><span class="koboSpan" id="kobo.325.1">
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.326.1">Once we obtain the </span><strong class="source-inline"><span class="koboSpan" id="kobo.327.1">Customer</span></strong><span class="koboSpan" id="kobo.328.1"> instance, control is passed to the </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">Customer Detail</span></strong><span class="koboSpan" id="kobo.330.1"> page, which is a basic Facelets page that displays customer information. </span><span class="koboSpan" id="kobo.330.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.331.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.332.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer074">
<span class="koboSpan" id="kobo.334.1"><img alt="Figure 15.4 – ﻿The Customer Detail page" src="image/B21231_15_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.335.1">Figure 15.4 – The Customer Detail page</span></p>
<p><span class="koboSpan" id="kobo.336.1">Now that we’ve</span><a id="_idIndexMarker723"/><span class="koboSpan" id="kobo.337.1"> seen how we can display customer information, we’ll focus our attention on updating existing </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">customer data.</span></span></p>
<h2 id="_idParaDest-202"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.339.1">Updating customer data</span></h2>
<p><span class="koboSpan" id="kobo.340.1">There isn’t </span><a id="_idIndexMarker724"/><span class="koboSpan" id="kobo.341.1">much we haven’t already discussed when it comes to updating customer data. </span><span class="koboSpan" id="kobo.341.2">The command link labeled </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">Edit</span></strong><span class="koboSpan" id="kobo.343.1"> on each row navigates to the </span><strong class="bold"><span class="koboSpan" id="kobo.344.1">Edit Customer</span></strong><span class="koboSpan" id="kobo.345.1"> page. </span><span class="koboSpan" id="kobo.345.2">The markup for the command link looks </span><span class="No-Break"><span class="koboSpan" id="kobo.346.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.347.1">
&lt;h:commandLink value="Edit" action="#{customerController.editSetup}"&gt;
  &lt;f:param name="jsfcrud.currentCustomer" value=
"#{jsfcrud_class['com.ensode.jakartaeealltogether.faces.util.JsfUtil'].jsfcrud_method['getAsConvertedString'][item1][customerController.converter].jsfcrud_invoke}"/&gt;
&lt;/h:commandLink&gt;</span></pre> <p><span class="koboSpan" id="kobo.348.1">The </span><a id="_idIndexMarker725"/><span class="koboSpan" id="kobo.349.1">command link uses the same technique to pass involving a custom Expression Language resolver we discussed in the previous section to pass the id of the customer to update as a request parameter, then invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">CustomerController.editSetup()</span></strong><span class="koboSpan" id="kobo.351.1"> method which performs some initialization before directing the user to the </span><strong class="bold"><span class="koboSpan" id="kobo.352.1">Edit Customer</span></strong><span class="koboSpan" id="kobo.353.1"> page. </span><span class="koboSpan" id="kobo.353.2">Relevant methods in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">CustomerController</span></strong><span class="koboSpan" id="kobo.355.1"> CDI bean are shown in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">code snippet.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.357.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  private Customer customer = null;
  //additional variable declarations omitted
  </span><strong class="bold"><span class="koboSpan" id="kobo.358.1">public String editSetup() {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.359.1">    return scalarSetup("/customer/Edit");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.360.1">  }</span></strong><span class="koboSpan" id="kobo.361.1">
  private String scalarSetup(String destination) {
    reset(false);
    customer = (Customer) JsfUtil.
</span><span class="koboSpan" id="kobo.361.2">      getObjectFromRequestParameter(
      "jsfcrud.currentCustomer", converter, null);
    if (customer == null) {
      //error handling code omitted
    }
    return destination;
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.362.1">As we </span><a id="_idIndexMarker726"/><span class="koboSpan" id="kobo.363.1">can see, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">editSetup()</span></strong><span class="koboSpan" id="kobo.365.1"> method follows the same pattern we discussed when we covered how to navigate to the read-only </span><strong class="bold"><span class="koboSpan" id="kobo.366.1">Customer Detail</span></strong><span class="koboSpan" id="kobo.367.1"> page, it invokes the previously discussed </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">scalarSetup()</span></strong><span class="koboSpan" id="kobo.369.1"> method to obtain the appropriate instance of the Customer entity, then directs the user to the </span><strong class="bold"><span class="koboSpan" id="kobo.370.1">Edit </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.371.1">Customer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.372.1"> page.</span></span></p>
<p><span class="koboSpan" id="kobo.373.1">The markup for the </span><strong class="bold"><span class="koboSpan" id="kobo.374.1">Edit Customer</span></strong><span class="koboSpan" id="kobo.375.1"> page is fairly trivial. </span><span class="koboSpan" id="kobo.375.2">It includes a number of input fields using binding expressions mapping to different fields on the Customer entity. </span><span class="koboSpan" id="kobo.375.3">It uses the same technique we discussed in the Creating Customer Data section to populate all drop-downs on the page. </span><span class="koboSpan" id="kobo.375.4">Upon successful navigation, the </span><strong class="bold"><span class="koboSpan" id="kobo.376.1">Edit Customer</span></strong><span class="koboSpan" id="kobo.377.1"> page is rendered as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.378.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.379.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.380.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer075">
<span class="koboSpan" id="kobo.381.1"><img alt="Figure 15.5 – Edit Customer page" src="image/B21231_15_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.382.1">Figure 15.5 – Edit Customer page</span></p>
<p><span class="koboSpan" id="kobo.383.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.384.1">Save</span></strong><span class="koboSpan" id="kobo.385.1"> button at the bottom of the form invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">edit()</span></strong><span class="koboSpan" id="kobo.387.1"> method on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">CustomerController</span></strong><span class="koboSpan" id="kobo.389.1"> class. </span><span class="koboSpan" id="kobo.389.2">The markup Our DAO retrieves </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">the customer:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.391.1">
&lt;h:commandButton </span><strong class="bold"><span class="koboSpan" id="kobo.392.1">action="#{customerController.edit}"</span></strong><span class="koboSpan" id="kobo.393.1">
  value="Save"&gt;
  &lt;f:param name="jsfcrud.currentCustomer"
  value=
"#{jsfcrud_class['com.ensode.jakartaeealltogether.faces.util.JsfUtil'].jsfcrud_method['getAsConvertedString'][customerController.customer][customerController.converter].jsfcrud_invoke}"/&gt;
&lt;/h:commandButton&gt;</span></pre> <p><span class="koboSpan" id="kobo.394.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.395.1">Save</span></strong><span class="koboSpan" id="kobo.396.1"> button  uses the </span><a id="_idIndexMarker727"/><span class="koboSpan" id="kobo.397.1">previously discussed technique to send the ID of the customer being edited as a request parameter, then invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">edit()</span></strong><span class="koboSpan" id="kobo.399.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">CustomerController</span></strong><span class="koboSpan" id="kobo.401.1">, which looks </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.403.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  private Customer customer = null;
  private CustomerConverter converter = null;
  //additional variable declarations omitted
  @EJB
  private CustomerDao dao;
  </span><strong class="bold"><span class="koboSpan" id="kobo.404.1">public String edit()</span></strong><span class="koboSpan" id="kobo.405.1"> {
    String customerString = converter.getAsString(
      FacesContext.getCurrentInstance(), null, customer);
    String currentCustomerString =
      JsfUtil.getRequestParameter(
      "jsfcrud.currentCustomer");
    if (customerString == null ||
        customerString.length() == 0 ||
        !customerString.equals(currentCustomerString)) {
      String outcome = editSetup();
      if ("customer_edit".equals(outcome)) {
        JsfUtil.addErrorMessage(
          "Could not edit customer. </span><span class="koboSpan" id="kobo.405.2">Try again.");
      }
      return outcome;
    }
    try {
      dao.edit(customer);
      JsfUtil.addSuccessMessage(
        "Customer was successfully updated.");
    } catch (Exception e) {
      //exception handling code omitted
    }
    return detailSetup();
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.406.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">edit()</span></strong><span class="koboSpan" id="kobo.408.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">CustomerController</span></strong><span class="koboSpan" id="kobo.410.1"> performs a sanity check to make sure the ID of the customer in memory matches the ID passed as a request parameter, and displays an error message if this is not the case. </span><span class="koboSpan" id="kobo.410.2">If the sanity check is successful, the method invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">edit()</span></strong><span class="koboSpan" id="kobo.412.1"> method on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1">CustomerDao</span></strong><span class="koboSpan" id="kobo.414.1"> data access object, as illustrated</span><a id="_idIndexMarker728"/><span class="koboSpan" id="kobo.415.1"> in the following </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">code snippet:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.417.1">
package com.ensode.jakartaeealltogether.dao;
//imports omitted
@Stateless
public class CustomerDao implements Serializable {
  @Resource
  private EJBContext ejbContext;
  @PersistenceContext
  private EntityManager em;
  public void edit(Customer customer) throws Exception {
    try {
      customer = em.merge(customer);
    } catch (Exception ex) {
      ejbContext.setRollbackOnly();
      String msg = ex.getLocalizedMessage();
      if (msg == null || msg.length() == 0) {
        Integer id = customer.getCustomerId();
        if (findCustomer(id) == null) {
          throw new NonexistentEntityException(
            "The customer with id " + id +
            " no longer exists.");
        }
      }
      throw ex;
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.418.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">edit()</span></strong><span class="koboSpan" id="kobo.420.1"> method on our DAO invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">merge()</span></strong><span class="koboSpan" id="kobo.422.1"> method on its injected </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">EntityManager</span></strong><span class="koboSpan" id="kobo.424.1">, which updates the corresponding customer data in the database. </span><span class="koboSpan" id="kobo.424.2">If there is an exception, the method rolls back the transaction and then attempts to retrieve the customer </span><a id="_idIndexMarker729"/><span class="koboSpan" id="kobo.425.1">from the database. </span><span class="koboSpan" id="kobo.425.2">In case the </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">edit()</span></strong><span class="koboSpan" id="kobo.427.1"> method can’t find the customer in the database, it displays an error message stating that the customer doesn’t exist anymore. </span><span class="koboSpan" id="kobo.427.2">The reason why this logic is necessary is because another user or process may have deleted our customer from the database while our user was </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">updating it.</span></span></p>
<p><span class="koboSpan" id="kobo.429.1">If the customer data is successfully updated, the user is directed to the </span><strong class="bold"><span class="koboSpan" id="kobo.430.1">Customer Detail</span></strong><span class="koboSpan" id="kobo.431.1"> page, displaying updated customer data. </span><span class="koboSpan" id="kobo.431.2">See </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.432.1">Figure 15</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.433.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer076">
<span class="koboSpan" id="kobo.435.1"><img alt="Figure 15.6 – Customer Detail page displaying updated customer data" src="image/B21231_15_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.436.1">Figure 15.6 – Customer Detail page displaying updated customer data</span></p>
<p><span class="koboSpan" id="kobo.437.1">In the </span><a id="_idIndexMarker730"/><span class="koboSpan" id="kobo.438.1">next section, we will discuss how our sample application deletes customer data from </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">the database.</span></span></p>
<h2 id="_idParaDest-203"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.440.1">Deleting customer data</span></h2>
<p><span class="koboSpan" id="kobo.441.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.442.1">Customer List</span></strong><span class="koboSpan" id="kobo.443.1"> page</span><a id="_idIndexMarker731"/><span class="koboSpan" id="kobo.444.1"> has a link labeled Destroy for each element on </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">the table.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer077">
<span class="koboSpan" id="kobo.446.1"><img alt="Figure 15.7﻿ – Customer List page" src="image/B21231_15_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.447.1">Figure 15.7 – Customer List page</span></p>
<p><span class="koboSpan" id="kobo.448.1">The</span><a id="_idIndexMarker732"/><span class="koboSpan" id="kobo.449.1"> markup for the </span><strong class="bold"><span class="koboSpan" id="kobo.450.1">Delete</span></strong><span class="koboSpan" id="kobo.451.1"> command link follows the previously discussed pattern of setting a request parameter with the ID of the customer to delete, as seen in the </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">following example.</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.453.1">
&lt;h:commandLink value="Delete"
  </span><strong class="bold"><span class="koboSpan" id="kobo.454.1">action="#{customerController.destroy}"</span></strong><span class="koboSpan" id="kobo.455.1">&gt;
  &lt;f:param name="jsfcrud.currentCustomer" value=
"#{jsfcrud_class['com.ensode.jakartaeealltogether.faces.util.JsfUtil'].jsfcrud_method['getAsConvertedString'][item1][customerController.converter].jsfcrud_invoke}"/&gt;
&lt;/h:commandLink&gt;</span></pre> <p><span class="koboSpan" id="kobo.456.1">When clicked, the command link invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">destroy()</span></strong><span class="koboSpan" id="kobo.458.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.459.1">CustomerController</span></strong><span class="koboSpan" id="kobo.460.1">, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">following example.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.462.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  @EJB
  private CustomerDao dao;
  //additional variable declarations omitted
  public String destroy() {
    String idAsString =
     JsfUtil.getRequestParameter("jsfcrud.currentCustomer");
    Integer id = Integer.valueOf(idAsString);
    try {
      dao.destroy(id);
      JsfUtil.addSuccessMessage(
        "Customer was successfully deleted.");
    } catch (Exception e){
      //exception handling logic omitted
    }
    return relatedOrListOutcome();
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.463.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">destroy()</span></strong><span class="koboSpan" id="kobo.465.1"> method in </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">CustomerController</span></strong><span class="koboSpan" id="kobo.467.1"> simply invokes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">destroy()</span></strong><span class="koboSpan" id="kobo.469.1"> method</span><a id="_idIndexMarker733"/><span class="koboSpan" id="kobo.470.1"> on </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1">CustomerDAO</span></strong><span class="koboSpan" id="kobo.472.1">, passing the customer ID as obtained from the request parameter. </span><span class="koboSpan" id="kobo.472.2">The controller then navigates back to the </span><strong class="bold"><span class="koboSpan" id="kobo.473.1">Customer List</span></strong><span class="koboSpan" id="kobo.474.1"> page and displays a success message upon successful deletion. </span><span class="koboSpan" id="kobo.474.2">If there are any exceptions when attempting to delete the customer, they are </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">handled appropriately.</span></span></p>
<p><span class="koboSpan" id="kobo.476.1">Our DAO </span><a id="_idIndexMarker734"/><span class="koboSpan" id="kobo.477.1">retrieves the customer from the database, using the ID it receives as a parameter, performs a sanity check to make sure the data wasn’t deleted by another process and then deletes the customer from the database by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">remove()</span></strong><span class="koboSpan" id="kobo.479.1"> method on the injected </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">EntityManager</span></strong><span class="koboSpan" id="kobo.481.1"> instance, as </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">illustrated below.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.483.1">
package com.ensode.jakartaeealltogether.dao;
//imports omitted
@Stateless
public class CustomerDao implements Serializable {
  @Resource
  private EJBContext ejbContext;
  @PersistenceContext
  private EntityManager em;
  </span><strong class="bold"><span class="koboSpan" id="kobo.484.1">public void destroy(Integer id)</span></strong><span class="koboSpan" id="kobo.485.1"> throws
    NonexistentEntityException, RollbackFailureException,
    Exception {
    try {
      Customer customer;
      try {
        customer = em.getReference(Customer.class, id);
        customer.getCustomerId();
      } catch (EntityNotFoundException enfe) {
        throw new NonexistentEntityException(
          "The customer with id " + id +
          " no longer exists.", enfe);
      }
      em.remove(customer);
    } catch (Exception ex) {
      try {
        ejbContext.setRollbackOnly();
      } catch (Exception re) {
        throw new RollbackFailureException("An error "
            + "occurred attempting to roll back", re);
      }
      throw ex;
    }
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.486.1">After</span><a id="_idIndexMarker735"/><span class="koboSpan" id="kobo.487.1"> successfully deleting a customer from the database, the </span><strong class="bold"><span class="koboSpan" id="kobo.488.1">Customer List</span></strong><span class="koboSpan" id="kobo.489.1"> is displayed, containing a success message indicating the deletion </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">was successful.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer078">
<span class="koboSpan" id="kobo.491.1"><img alt="Figure 15.8 – Successful deletion" src="image/B21231_15_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.492.1">Figure 15.8 – Successful deletion</span></p>
<p><span class="koboSpan" id="kobo.493.1">We have</span><a id="_idIndexMarker736"/><span class="koboSpan" id="kobo.494.1"> now seen how our sample application creates, updates, displays and deletes data, including some advanced techniques it uses involving custom converters and a custom Expression </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">Language resolver.</span></span></p>
<p><span class="koboSpan" id="kobo.496.1">Our sample application also contains logic to handle pagination when there is a large number command link is displayed if thereof customers in the database. </span><span class="koboSpan" id="kobo.496.2">We will discuss this functionality in the </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">next section.</span></span></p>
<h2 id="_idParaDest-204"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.498.1">Implementing pagination</span></h2>
<p><span class="koboSpan" id="kobo.499.1">The</span><a id="_idIndexMarker737"/><span class="koboSpan" id="kobo.500.1"> standard Jakarta Faces data table component simply displays all elements on a list on the page. </span><span class="koboSpan" id="kobo.500.2">This works fine when we have a small number of elements to display, but becomes cumbersome when displaying lots of elements. </span><span class="koboSpan" id="kobo.500.3">In many production environments, it is not uncommon to have to display hundreds </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">of elements.</span></span></p>
<p><span class="koboSpan" id="kobo.502.1">Our sample application implements custom pagination logic, if there are more than five customers to display, it only displays five customers at a time, then has </span><strong class="bold"><span class="koboSpan" id="kobo.503.1">Previous</span></strong><span class="koboSpan" id="kobo.504.1"> and/or </span><strong class="bold"><span class="koboSpan" id="kobo.505.1">Next</span></strong><span class="koboSpan" id="kobo.506.1"> links displayed as appropriate to navigate between all customers. </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.507.1">Figure 15</span></em></span><em class="italic"><span class="koboSpan" id="kobo.508.1">.9 </span></em><span class="koboSpan" id="kobo.509.1">illustrates our custom pagination logic </span><span class="No-Break"><span class="koboSpan" id="kobo.510.1">in action.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer079">
<span class="koboSpan" id="kobo.511.1"><img alt="Figure 15.9 – Custom pagination" src="image/B21231_15_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.512.1">Figure 15.9 – Custom pagination</span></p>
<p><span class="koboSpan" id="kobo.513.1">Our </span><strong class="bold"><span class="koboSpan" id="kobo.514.1">Customer List</span></strong><span class="koboSpan" id="kobo.515.1"> page renders a </span><strong class="bold"><span class="koboSpan" id="kobo.516.1">Previous</span></strong><span class="koboSpan" id="kobo.517.1"> link to navigate back to the previous link, or a </span><strong class="bold"><span class="koboSpan" id="kobo.518.1">Next</span></strong><span class="koboSpan" id="kobo.519.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.520.1">Remaining</span></strong><span class="koboSpan" id="kobo.521.1"> link to navigate to the next page. </span><span class="koboSpan" id="kobo.521.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Next</span></strong><span class="koboSpan" id="kobo.523.1"> link is rendered if there are at least 5 more customers to display, if there are less than 5, then the </span><strong class="bold"><span class="koboSpan" id="kobo.524.1">Remaining</span></strong><span class="koboSpan" id="kobo.525.1"> link </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">is rendered.</span></span></p>
<p><span class="koboSpan" id="kobo.527.1">All three links</span><a id="_idIndexMarker738"/><span class="koboSpan" id="kobo.528.1"> are conditionally rendered via the command link’s rendered attribute, which takes a boolean expression to determine if the link should </span><span class="No-Break"><span class="koboSpan" id="kobo.529.1">be rendered.</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.530.1">
 &lt;h:commandLink action="#{customerController.prev}"
 value="Previous #{customerController.pagingInfo.batchSize}"
      rendered="#{customerController.renderPrevLink}"/&gt;</span></pre> <p><span class="koboSpan" id="kobo.531.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.532.1">Previous</span></strong><span class="koboSpan" id="kobo.533.1"> command link determines if it should be rendered by obtaining the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">renderPrevLink</span></strong><span class="koboSpan" id="kobo.535.1"> property on </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">our controller.</span></span></p>
<p><span class="koboSpan" id="kobo.537.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">next()</span></strong><span class="koboSpan" id="kobo.539.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">prev()</span></strong><span class="koboSpan" id="kobo.541.1"> methods update the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">renderPrevLink</span></strong><span class="koboSpan" id="kobo.543.1"> property. </span><span class="koboSpan" id="kobo.543.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">next()</span></strong><span class="koboSpan" id="kobo.545.1"> method is invoked when either the </span><strong class="bold"><span class="koboSpan" id="kobo.546.1">Next</span></strong><span class="koboSpan" id="kobo.547.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.548.1">Remaining</span></strong><span class="koboSpan" id="kobo.549.1"> link is clicked. </span><span class="koboSpan" id="kobo.549.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">prev()</span></strong><span class="koboSpan" id="kobo.551.1"> method is invoked when the </span><strong class="bold"><span class="koboSpan" id="kobo.552.1">Previous</span></strong><span class="koboSpan" id="kobo.553.1"> command link is invoked. </span><span class="koboSpan" id="kobo.553.2">The updated </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">renderPrevLink</span></strong><span class="koboSpan" id="kobo.555.1"> value is used to determine if the </span><strong class="bold"><span class="koboSpan" id="kobo.556.1">Previous</span></strong><span class="koboSpan" id="kobo.557.1"> command link</span><a id="_idIndexMarker739"/><span class="koboSpan" id="kobo.558.1"> should </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">be rendered.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.560.1">
package com.ensode.jakartaeealltogether.faces.controller;
//imports omitted
@Named
@SessionScoped
public class CustomerController implements Serializable {
  @PostConstruct
  public void init() {
    pagingInfo = new PagingInfo();
  }
  private PagingInfo pagingInfo = null;
  private boolean renderPrevLink;
  @EJB
  private CustomerDao dao;
  //additional variable declarations omitted
  public PagingInfo getPagingInfo() {
    if (pagingInfo.getItemCount() == -1) {
      pagingInfo.setItemCount(dao.getCustomerCount());
    }
    return pagingInfo;
  }
  </span><strong class="bold"><span class="koboSpan" id="kobo.561.1">public boolean getRenderPrevLink() {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.562.1">    return renderPrevLink;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.563.1">  }</span></strong><span class="koboSpan" id="kobo.564.1">
  public String next() {
    reset(false);
    getPagingInfo().nextPage();
    </span><strong class="bold"><span class="koboSpan" id="kobo.565.1">renderPrevLink = getPagingInfo().getFirstItem() &gt;=</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.566.1">      getPagingInfo().getBatchSize();</span></strong><span class="koboSpan" id="kobo.567.1">
    return "List";
  }
  public String prev() {
    reset(false);
    getPagingInfo().previousPage();
    </span><strong class="bold"><span class="koboSpan" id="kobo.568.1">renderPrevLink = getPagingInfo().getFirstItem() &gt;=</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.569.1">      getPagingInfo().getBatchSize();</span></strong><span class="koboSpan" id="kobo.570.1">
    return "List";
  }
  //additional methods omitted
}</span></pre> <p><span class="koboSpan" id="kobo.571.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.572.1">Next</span></strong><span class="koboSpan" id="kobo.573.1"> command </span><a id="_idIndexMarker740"/><span class="koboSpan" id="kobo.574.1">link is displayed if there are at least five more customers </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">to display.</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.576.1">
&lt;h:commandLink action="#{customerController.next}" value="Next #{customerController.pagingInfo.batchSize}" rendered="#{customerController.pagingInfo.lastItem + customerController.pagingInfo.batchSize le customerController.pagingInfo.itemCount}"</span></pre> <p><span class="koboSpan" id="kobo.577.1">In this case, the logic of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">rendered</span></strong><span class="koboSpan" id="kobo.579.1"> attribute is embedded on the page, as opposed to relying on the controller as is the case for the </span><strong class="bold"><span class="koboSpan" id="kobo.580.1">Previous</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.581.1">command link.</span></span></p>
<p><span class="koboSpan" id="kobo.582.1">The </span><strong class="bold"><span class="koboSpan" id="kobo.583.1">Remaining</span></strong><span class="koboSpan" id="kobo.584.1"> command link is displayed if there are less than five customers to display on the </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">next page.</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.586.1">
&lt;h:commandLink action="#{customerController.next}" value="Remaining #{customerController.pagingInfo.itemCount - customerController.pagingInfo.lastItem}"
                       rendered="#{customerController.pagingInfo.lastItem lt
  customerController.pagingInfo.itemCount and
  customerController.pagingInfo.lastItem +
  customerController.pagingInfo.batchSize gt
  customerController.pagingInfo.itemCount}"/&gt;</span></pre> <p><span class="koboSpan" id="kobo.587.1">This command link also embeds the logic of its rendered attribute as an expression on </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">the page.</span></span></p>
<p><span class="koboSpan" id="kobo.589.1">The </span><a id="_idIndexMarker741"/><span class="koboSpan" id="kobo.590.1">pagination logic relies on a </span><strong class="source-inline"><span class="koboSpan" id="kobo.591.1">PagingInfo</span></strong><span class="koboSpan" id="kobo.592.1"> utility class, this class has methods to obtain the first and last elements to display, as logic to determine which elements to display on every page of our </span><span class="No-Break"><span class="koboSpan" id="kobo.593.1">data table.</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.594.1">
package com.ensode.jakartaeealltogether.faces.util;
public class PagingInfo {
  private int batchSize = 5;
  private int firstItem = 0;
  private int itemCount = -1;
  //trivial setters and getters omitted
  public int getFirstItem() {
    if (itemCount == -1) {
      throw new IllegalStateException(
        "itemCount must be set before invoking " +
        "getFirstItem");
    }
    if (firstItem &gt;= itemCount) {
      if (itemCount == 0) {
        firstItem = 0;
      } else {
        int zeroBasedItemCount = itemCount - 1;
        double pageDouble = zeroBasedItemCount / batchSize;
        int page = (int) Math.floor(pageDouble);
        firstItem = page * batchSize;
      }
    }
    return firstItem;
  }
  public int getLastItem() {
    getFirstItem();
    int lastItem = firstItem + batchSize &gt; itemCount ?
</span><span class="koboSpan" id="kobo.594.2">      itemCount : firstItem + batchSize;
    return lastItem;
  }
  public void nextPage() {
    getFirstItem();
    if (firstItem + batchSize &lt; itemCount) {
      firstItem += batchSize;
    }
  }
  public void previousPage() {
    getFirstItem();
    firstItem -= batchSize;
    if (firstItem &lt; 0) {
      firstItem = 0;
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.595.1">As seen in</span><a id="_idIndexMarker742"/><span class="koboSpan" id="kobo.596.1"> previous code examples, our controller relies on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">PaginationInfo</span></strong><span class="koboSpan" id="kobo.598.1"> utility class to </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">implement pagination.</span></span></p>
<h1 id="_idParaDest-205"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.600.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.601.1">In this chapter, we illustrated how to integrate several Jakarta EE technologies via a sample application. </span><span class="koboSpan" id="kobo.601.2">We covered the </span><span class="No-Break"><span class="koboSpan" id="kobo.602.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.603.1">How to create customer data by integrating Jakarta Faces, CDI,  Jakarta Enterprise Beans and </span><span class="No-Break"><span class="koboSpan" id="kobo.604.1">Jakarta Persistence</span></span></li>
<li><span class="koboSpan" id="kobo.605.1">How to view customer data by integrating Jakarta Faces, CDI, Jakarta Enterprise Beans and </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">Jakarta Persistence</span></span></li>
<li><span class="koboSpan" id="kobo.607.1">How to update customer data by integrating Jakarta Faces, CDI, Jakarta Enterprise Beans and </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">Jakarta Persistence</span></span></li>
<li><span class="koboSpan" id="kobo.609.1">How to delete customer data by integrating Jakarta Faces, CDI, Jakarta Enterprise Beans and </span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">Jakarta Persistence</span></span></li>
<li><span class="koboSpan" id="kobo.611.1">How to implement custom pagination logic when displaying tabular data with the Jakarta Faces data </span><span class="No-Break"><span class="koboSpan" id="kobo.612.1">table component</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.613.1">Jakarta EE APIs are designed to work together, and, as seen in this chapter, they can be seamlessly integrated to build </span><span class="No-Break"><span class="koboSpan" id="kobo.614.1">robust applications.</span></span></p>
</div>
</body></html>