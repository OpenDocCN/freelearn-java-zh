<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Running WildFly in Standalone Mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Running WildFly in Standalone Mode</h1></div></div></div><p>In this chapter, we will cover the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Running WildFly from a custom configuration folder</li><li class="listitem" style="list-style-type: disc">Binding WildFly onto a custom port</li><li class="listitem" style="list-style-type: disc">Binding WildFly onto a custom IP</li><li class="listitem" style="list-style-type: disc">Configuring multiple WildFly instances to run on the same machine with different ports</li><li class="listitem" style="list-style-type: disc">Configuring multiple WildFly instances to run on the same machine with different IPs</li><li class="listitem" style="list-style-type: disc">Managing applications using the deployments folder</li><li class="listitem" style="list-style-type: disc">Connecting to the CLI</li><li class="listitem" style="list-style-type: disc">Checking the server-state via the CLI</li><li class="listitem" style="list-style-type: disc">Deploying an application via the CLI</li><li class="listitem" style="list-style-type: disc">Undeploying an application via the CLI</li><li class="listitem" style="list-style-type: disc">Executing commands in batch mode via the CLI</li><li class="listitem" style="list-style-type: disc">Reloading a server configuration via the CLI</li><li class="listitem" style="list-style-type: disc">Shutting down and restarting an instance via the CLI</li><li class="listitem" style="list-style-type: disc">Suspending and resuming an instance via the CLI</li><li class="listitem" style="list-style-type: disc">Backing up your configuration file via the CLI</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>Introduction</h1></div></div></div><p>In this chapter, you will learn how to manage WildFly running in the standalone mode. First we will discuss which profile fits our needs, and then we will cover how to run WildFly with a specific configuration file, navigate through the Web Console, and the CLI.</p><p>You will also learn how to get multiple WildFly instances running on the same machine, both with different ports and IPs, in case you have only one network interface. You will learn how to connect to the CLI, retrieve server information, reload server configuration, and shut down, deploy, and undeploy an application.</p></div></div>
<div class="section" title="Running WildFly from a custom configuration folder"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>Running WildFly from a custom configuration folder</h1></div></div></div><p>In this <a id="id62" class="indexterm"/>recipe, you will learn how to run <a id="id63" class="indexterm"/>WildFly from a custom configuration folder. This can be handy if you want to use the same WildFly installation folder, but run two or more WildFly instances with different configurations.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec27"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">What you have to do is to just copy the <code class="literal">standalone</code> folder to a path of your choice.</li><li class="listitem">That's it! Now just run WildFly as usual, specifying your configuration folder by passing the <code class="literal">-Djboss.server.base.dir</code> directive:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=/your/config/path</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec28"/>How it works…</h2></div></div></div><p>On specification of a different <code class="literal">jboss.server.base.dir</code> directory, WildFly tries to pick up the <code class="literal">standalone.xml</code> file from the expected folder. In fact, your configuration path has to maintain the same folder structure. WildFly lets you override different paths, in case you need to.</p><p>The following is a table summarizing all such paths:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Property name</p>
</th><th style="text-align: left" valign="bottom">
<p>Usage</p>
</th><th style="text-align: left" valign="bottom">
<p>Default value</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">java.ext.dirs</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The JDK extension directory paths</p>
</td><td style="text-align: left" valign="top">
<p>Null</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.home.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The root directory of the WildFly installation</p>
</td><td style="text-align: left" valign="top">
<p>Set by <code class="literal">standalone.sh to $JBOSS_HOME</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.base.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The base directory for server content</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.home.dir/standalone</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.config.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The base configuration directory</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.base.dir/configuration</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.data.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used for persistent data file storage</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.base.dir/data</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.log.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory containing the <code class="literal">server.log</code> file</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.base.dir/log</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.temp.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used for temporary file storage</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.base.dir/tmp</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.deploy.dir</code>
</p>
</td><td style="text-align: left" valign="top">
<p>The directory used to store the deployed content</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">jboss.server.data.dir/content</code>
</p>
</td></tr></tbody></table></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec29"/>There's more…</h2></div></div></div><p>Furthermore, you <a id="id64" class="indexterm"/>can use a different <a id="id65" class="indexterm"/>configuration file by specifying it via the <code class="literal">--server-config</code> directive, as follows:</p><div class="informalexample"><pre class="programlisting">$ $WILDFLY_HOME/bin/standalone.sh --server-config=standalone-ha.xml</pre></div></div></div>
<div class="section" title="Binding WildFly onto a custom port"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Binding WildFly onto a custom port</h1></div></div></div><p>Why would <a id="id66" class="indexterm"/>you bind WildFly onto a custom port? This is <a id="id67" class="indexterm"/>because you might have a different service running on the same IP:PORT (that is, another WildFly or JBoss instance, Tomcat, or GlassFish).</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec30"/>How to do it...</h2></div></div></div><p>Just open your command line and launch your WildFly standalone instance as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh</pre></div><p>Now you can change the port using either the Web Console or the CLI:</p><div class="section" title="Using the Web Console"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec01"/>Using the Web Console</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Point your browser to the following address: <code class="literal">http://127.0.0.1:8080/console</code>.</li><li class="listitem">Log in by entering the credentials specified in <a class="link" href="ch01.html" title="Chapter 1. Welcome to WildFly!">Chapter 1</a>, <span class="emphasis"><em>Welcome to WildFly!</em></span> while adding the management user; we entered <code class="literal">wildfly</code> as the username and <code class="literal">cookbook.2015</code> as the password.</li><li class="listitem">Select the <span class="strong"><strong>Configuration</strong></span> tab and select from the menu on the left side under general configuration, the voice <span class="strong"><strong>Socket Binding</strong></span>, and select <span class="strong"><strong>View</strong></span> as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_02_01.jpg" alt="Using the Web Console"/></div></li><li class="listitem">Select the <a id="id68" class="indexterm"/><code class="literal">http</code> property and scroll down the <a id="id69" class="indexterm"/>page to edit the port number, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_02_02.jpg" alt="Using the Web Console"/></div></li><li class="listitem">Now, change the <a id="id70" class="indexterm"/>port number from <code class="literal">8080</code> to <code class="literal">9080</code> <a id="id71" class="indexterm"/>and click on the button labeled <span class="strong"><strong>Save</strong></span>. You will be notified, but the GUI will denote that the update was successful and that a server reload is required to take advantage of the new changes.<div class="mediaobject"><img src="graphics/3744_02_03.jpg" alt="Using the Web Console"/></div></li><li class="listitem">Go to the <a id="id72" class="indexterm"/><span class="strong"><strong>Runtime</strong></span> tab. You should see a <a id="id73" class="indexterm"/>button labeled <span class="strong"><strong>Reload</strong></span>, click on it and confirm, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_02_04.jpg" alt="Using the Web Console"/></div></li><li class="listitem">Now open your <a id="id74" class="indexterm"/>Web Console using the new port <a id="id75" class="indexterm"/>number as follows: <code class="literal">http://localhost:9080/console</code>.</li></ol></div></div><div class="section" title="Using the CLI"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec02"/>Using the CLI</h3></div></div></div><p>In a different <a id="id76" class="indexterm"/>terminal, connect to the CLI and do as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh</pre></div><p>You are disconnected at the moment; type <code class="literal">connect</code> to connect to the server or <code class="literal">help</code> for the list of supported commands:</p><div class="informalexample"><pre class="programlisting">[disconnected /] connect
[standalone@localhost:9990 /] /socket-binding-group=standard-sockets/socket-binding=http:read-attribute(name=port)
{
    "outcome" =&gt; "success",
    "result" =&gt; expression "${jboss.http.port:8080}"
}
[standalone@localhost:9990 /] /socket-binding-group=standard-sockets/socket-binding=http:read-attribute(name=bound-port)
{
    "outcome" =&gt; "success",
    "result" =&gt; 8080
}
[standalone@localhost:9990 /] /socket-binding-group=standard-sockets/socket-binding=http:write-attribute(name=port,value=9080)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}
[standalone@localhost:9990 /] reload
[standalone@localhost:9990 /] /socket-binding-group=standard-sockets/socket-binding=http:read-attribute(name=port)            
{
    "outcome" =&gt; "success",
    "result" =&gt; 9080
}
[standalone@localhost:9990 /]</pre></div></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec31"/>There's more…</h2></div></div></div><p>Actually there is <a id="id77" class="indexterm"/>another method to change the port number, which is by passing <code class="literal">standalone.sh</code>, a Java parameter (which starts with a capital "D") as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.http.port=9080</pre></div><p>This will match the property named <code class="literal">http</code> specified in the <code class="literal">socket-binding</code> tag, for the attribute <code class="literal">port</code> in <code class="literal">standalone.xml</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note12"/>Note</h3><p>If you are coming from JBoss AS 5 or 6, you might have used <code class="literal">port-offset</code>, which still changes the port number by adding the offset to the default value (which is <code class="literal">8080</code>), but also changes other port numbers. In WildFly, it would also change the management port.</p></div></div><p>So we specify the port-offset to <code class="literal">1000</code> as follows :</p><div class="informalexample"><pre class="programlisting">$ ./bin/standalone.sh -Djboss.socket.binding.port-offset=1000</pre></div><p>We would end up with <a id="id78" class="indexterm"/>WildFly listening on port 9080 (that is, 8080+1000) and the WildFly management port would be 10990 (that is, 9090+1000).</p></div></div>
<div class="section" title="Binding WildFly onto a custom IP"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Binding WildFly onto a custom IP</h1></div></div></div><p>As for the port <a id="id79" class="indexterm"/>number, you might want to bind WildFly to an <a id="id80" class="indexterm"/>address different from the default one; for example, your public IP.</p><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec32"/>How to do it…</h2></div></div></div><p>To achieve this kind of customization, you can use both the Web Console and the CLI. Nevertheless, it is common to have SSH access to the servers running WildFly, or worse (better for security reasons), you might have SSH on different servers before landing on the WildFly one. In this case, you will only be able to use the CLI, that's why from now on we will mainly use the CLI to manage the server.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip02"/>Tip</h3><p>Getting used to the CLI will give you a deeper knowledge of WildFly's configuration setting and it will be more mnemonic so you won't forget it.</p></div></div><p>Let's change the IP address as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.bind.address=10.0.0.1
...
22:56:05,531 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0006: Undertow HTTP listener default listening on /<span class="strong"><strong>10.0.0.1</strong></span>:8080
...</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec33"/>How it works…</h2></div></div></div><p>If you look at <code class="literal">standalone.xml</code>, you will notice properties within the following <code class="literal">{}</code> and preceded by the dollar sign <code class="literal">$</code>. This property will be replaced by the value of the namesake parameter, specified when launching the server with the script.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec34"/>There's more...</h2></div></div></div><p>Furthermore, the same logic applies when you want to modify the management interface address. In that case, you will have to pass the <code class="literal">jboss.bind.address.management</code> parameter.</p><p>By the way, both <a id="id81" class="indexterm"/>parameters can be specified with shortcuts, such as <code class="literal">-b 10.0.0.1</code> for the <code class="literal">jboss.bind.address</code> parameter, and <code class="literal">-bmanagement 10.0.0.1</code> for the <code class="literal">jboss.bind.address.management</code>.</p></div></div>
<div class="section" title="Configuring multiple WildFly instances to run on the same machine with different ports"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Configuring multiple WildFly instances to run on the same machine with different ports</h1></div></div></div><p>In <a id="id82" class="indexterm"/>some cases, mostly because of architectural reasons, you may need to run multiple WildFly instances on a single server. You can do this by isolating each instance and giving it a different binding port.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec35"/>Getting ready</h2></div></div></div><p>First of all, we need to create a standalone configuration for each instance that we want to set up and run. All we need to do is replicate the concept explained in the <span class="emphasis"><em>Running WildFly from a custom configuration folder</em></span> recipe. Suppose we want two running nodes/instances, we use the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone node-1
$ cp -a standalone node-2</pre></div><p>Now we are ready to configure each instance.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec36"/>How to do it…</h2></div></div></div><p>To achieve such a requirement, you can use either of the methods explained earlier in the <span class="emphasis"><em>Binding WildFly on a custom port</em></span> recipe. Let's take a look at each of them.</p><div class="section" title="Using jboss.http.port"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec03"/>Using jboss.http.port</h3></div></div></div><p>The first thing to try is <a id="id83" class="indexterm"/>to run the two WildFly instances by passing the parameter <code class="literal">jboss.http.port</code>, obviously with different values. Actually, one of them could have the default value:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME//node-1 -Djboss.http.port=8180
...
10:30:23,924 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-7) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8180
...</pre></div><p>Now we are going to run another WildFly instance by passing a different <code class="literal">jboss.http.port</code> parameter in a different terminal window:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME$WILDFLY_HOME/node-2 -Djboss.http.port=8280
...
10:30:34,205 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-6) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8280
...
<span class="strong"><strong>10:30:34,473 ERROR [org.jboss.msc.service.fail] (MSC service thread 1-8) MSC000001: Failed to start service jboss.serverManagement.controller.management.http: org.jboss.msc.service.StartException in service jboss.serverManagement.controller.management.http: WFLYSRV0083: Failed to start the http-interface service</strong></span>
...
10:30:34,685 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0054: Admin console is not enabled
<span class="strong"><strong>10:30:34,685 ERROR [org.jboss.as] (Controller Boot Thread) WFLYSRV0026: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started (with errors) in 3252ms - Started 196 of 377 services (2 services failed or missing dependencies, 210 services are lazy, passive or on-demand)</strong></span>
</pre></div><p>Ouch! Something went wrong!</p><p>As you can see from the <a id="id84" class="indexterm"/>log, <code class="literal">http-interface</code> couldn't start properly because of the <span class="strong"><strong>Address already in use</strong></span> message. This is because we changed <code class="literal">jboss.http.port</code>, but not the analogous one for the management interface, which is <code class="literal">http-interface</code> defined in <code class="literal">standalone.xml</code>:</p><div class="mediaobject"><img src="graphics/3744_02_05.jpg" alt="Using jboss.http.port"/><div class="caption"><p>"http-interface" defined in the standalone.xml</p></div></div><p>Every standalone instance has its own management interface, thus we need to change its binding as well. Let's fix it:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME//node-1 -Djboss.http.port=8180 -Djboss.management.http.port=9991
...
11:11:05,862 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8180
...
<span class="strong"><strong>11:11:06,405 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9991/management</strong></span>
<span class="strong"><strong>11:11:06,406 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9991</strong></span>
...</pre></div><p>This is in a different <a id="id85" class="indexterm"/>terminal window:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME$WILDFLY_HOME/node-2 -Djboss.http.port=8280 -Djboss.management.http.port=9992
...
11:11:59,777 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8280
...
<span class="strong"><strong>11:12:00,358 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9992/management</strong></span>
<span class="strong"><strong>11:12:00,359 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9992</strong></span>
...</pre></div><p>There you go! Now if you check the open sockets at the OS level, filtering by the java process, you will see the following:</p><div class="mediaobject"><img src="graphics/3744_02_06.jpg" alt="Using jboss.http.port"/></div></div><div class="section" title="Using jboss.socket.binding.port-offset"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl3sec04"/>Using jboss.socket.binding.port-offset</h3></div></div></div><p>Okay, let's <a id="id86" class="indexterm"/>try using the <code class="literal">port-offset</code> directive:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.serever.base.dir=$WILDFLY_HOME/node-1 -Djboss.socket.binding.port-offset=100
...
11:35:05,783 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8180
...
11:35:06,512 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:10090/management
11:35:06,513 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:10090
11:35:06,513 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3228ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>The following is <a id="id87" class="indexterm"/>keyed in a different terminal window:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.serever.base.dir=$WILDFLY_HOME/node-2 -Djboss.socket.binding.port-offset=200
...
11:35:23,389 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-5) WFLYUT0006: Undertow HTTP listener default listening on /127.0.0.1:8280
...
11:35:24,030 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:10190/management
11:35:24,030 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:10190
11:35:24,031 INFO  [org.jboss.as] (Controller Boot Thread)  WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3191ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>As you have noticed, both servers start up regularly without any additional configuration or precaution. Lastly, just check the socket at the OS level:</p><div class="mediaobject"><img src="graphics/3744_02_07.jpg" alt="Using jboss.socket.binding.port-offset"/></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec37"/>There's more...</h2></div></div></div><p>Using the <code class="literal">jboss.socket.binding.port-offset</code> directive facilitates all configuration needs, in contrast to every single configuration update needed when using <code class="literal">jboss.http.port</code>.</p><p>Furthermore, with <a id="id88" class="indexterm"/>WildFly, you could benefit even more by using the <code class="literal">port-offset</code> configuration, as you would also need to adjust the remoting socket.</p></div></div>
<div class="section" title="Configuring multiple WildFly instances to run on the same machine with different IPs"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Configuring multiple WildFly instances to run on the same machine with different IPs</h1></div></div></div><p>In <a id="id89" class="indexterm"/>some cases, mostly due to architectural reasons, you may need to run multiple WildFly instances on a single server. You can do this by isolating each instance and giving it different binding IPs. The IPs might be virtual or effectively provided by the physical network interfaces installed on your system. Either way is good.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec38"/>Getting ready</h2></div></div></div><p>If you decide on virtual IPs, you can do this as follows:</p><div class="informalexample"><pre class="programlisting">$ sudo ifconfig YOUR_NIC:1 10.0.1.1 netmask 255.255.255.0
$ sudo ifconfig YOUR_NIC:2 10.0.1.2 netmask 255.255.255.0</pre></div><p>Here <code class="literal">YOUR_NIC</code> might be <code class="literal">eth0</code>. Now, if you list all the available interfaces in your server, you will also see the following new ones:</p><div class="informalexample"><pre class="programlisting">$ ifconfig
eth0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        ether f0:de:f1:99:b2:94  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        device interrupt 20  memory 0xf2600000-f2620000  
eth0:1: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 10.0.1.1  netmask 255.255.255.0  broadcast 10.0.1.255
        ether f0:de:f1:99:b2:94  txqueuelen 1000  (Ethernet)
        device interrupt 20  memory 0xf2600000-f2620000
eth0:2: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500
        inet 10.0.1.2  netmask 255.255.255.0  broadcast 10.0.1.255
        ether f0:de:f1:99:b2:94  txqueuelen 1000  (Ethernet)
        device interrupt 20  memory 0xf2600000-f2620000  </pre></div><p>After that, we need to create a standalone configuration for each instance that we want to set up and run. If you have already done so from the previous recipe (<span class="emphasis"><em>Configuring multiple WildFly instances to run on the same machine with different ports</em></span>), you can jump to the <span class="emphasis"><em>How to do it...</em></span> section. Otherwise, all we need to do is replicate the concept explained in the <span class="emphasis"><em>Binding WildFly onto a custom IP</em></span> recipe. Suppose we want two running nodes/instances, the command is as follows:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ cp -a standalone node-1
$ cp -a standalone node-2</pre></div><p>Now we are ready to configure each instance.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec39"/>How to do it…</h2></div></div></div><p>Open a <a id="id90" class="indexterm"/>terminal window and type in the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/node-1 -Djboss.bind.address=10.0.1.1
…
22:32:34,259 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-6) WFLYUT0006: Undertow HTTP listener default listening on /10.0.1.1:8080
22:32:34,549 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-3) WFLYDS0013: Started FileSystemDeploymentService for directory /home/luigi/WFC/wildfly/node-1/deployments
22:32:34,623 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-7) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
22:32:34,729 INFO  [org.jboss.ws.common.management] (MSC service thread 1-6) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
22:32:35,022 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
22:32:35,023 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
22:32:35,024 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3260ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>Type the following in a different terminal window:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/node-2 -Djboss.bind.address=10.0.1.2
...
22:33:02,522 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-8) WFLYUT0006: Undertow HTTP listener default listening on /10.0.1.2:8080
22:33:02,735 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-8) WFLYDS0013: Started FileSystemDeploymentService for directory /home/luigi/WFC/wildfly/node-2/deployments
<span class="strong"><strong>22:33:02,830 ERROR [org.jboss.msc.service.fail] (MSC service thread 1-1) MSC000001: Failed to start service jboss.serverManagement.controller.management.http: org.jboss.msc.service.StartException in service jboss.serverManagement.controller.management.http: WFLYSRV0083: Failed to start the http-interface service</strong></span>
<span class="strong"><strong>  at org.jboss.as.server.mgmt.UndertowHttpManagementService.start(UndertowHttpManagementService.java:269)</strong></span>
<span class="strong"><strong>  at org.jboss.msc.service.ServiceControllerImpl$StartTask.startService(ServiceControllerImpl.java:1948)</strong></span>
<span class="strong"><strong>  at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1881)</strong></span>
<span class="strong"><strong>  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</strong></span>
<span class="strong"><strong>  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</strong></span>
<span class="strong"><strong>  at java.lang.Thread.run(Thread.java:745)</strong></span>
<span class="strong"><strong>Caused by: java.lang.RuntimeException: java.net.BindException: Address already in use</strong></span>
<span class="strong"><strong>  at org.jboss.as.domain.http.server.ManagementHttpServer.start(ManagementHttpServer.java:160)</strong></span>
<span class="strong"><strong>  at org.jboss.as.server.mgmt.UndertowHttpManagementService.start(UndertowHttpManagementService.java:235)</strong></span>
<span class="strong"><strong>  ... 5 more</strong></span>
<span class="strong"><strong>Caused by: java.net.BindException: Address already in use</strong></span>
<span class="strong"><strong>  at sun.nio.ch.Net.bind0(Native Method)</strong></span>
<span class="strong"><strong>  at sun.nio.ch.Net.bind(Net.java:436)</strong></span>
<span class="strong"><strong>  at sun.nio.ch.Net.bind(Net.java:428)</strong></span>
<span class="strong"><strong>  at sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:214)</strong></span>
<span class="strong"><strong>  at sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:74)</strong></span>
<span class="strong"><strong>  at sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:67)</strong></span>
<span class="strong"><strong>  at org.xnio.nio.NioXnioWorker.createTcpConnectionServer(NioXnioWorker.java:182)</strong></span>
<span class="strong"><strong>  at org.xnio.XnioWorker.createStreamConnectionServer(XnioWorker.java:243)</strong></span>
<span class="strong"><strong>  at org.jboss.as.domain.http.server.ManagementHttpServer.start(ManagementHttpServer.java:147)</strong></span>
<span class="strong"><strong>  ... 6 more</strong></span>
  
22:33:02,858 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-7) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
22:33:02,907 INFO  [org.jboss.ws.common.management] (MSC service thread 1-3) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
<span class="strong"><strong>22:33:02,911 ERROR [org.jboss.as.controller.management-operation] (Controller Boot Thread) WFLYCTL0013: Operation ("add") failed - address: ([</strong></span>
<span class="strong"><strong>    ("core-service" =&gt; "management"),</strong></span>
<span class="strong"><strong>    ("management-interface" =&gt; "http-interface")</strong></span>
<span class="strong"><strong>]) - failure description: {"WFLYCTL0080: Failed services" =&gt; {"jboss.serverManagement.controller.management.http" =&gt; "org.jboss.msc.service.StartException in service jboss.serverManagement.controller.management.http: WFLYSRV0083: Failed to start the http-interface service</strong></span>
<span class="strong"><strong>    Caused by: java.lang.RuntimeException: java.net.BindException: Address already in use</strong></span>
<span class="strong"><strong>    Caused by: java.net.BindException: Address already in use"}}</strong></span>
22:33:02,969 INFO  [org.jboss.as.controller] (Controller Boot Thread) WFLYCTL0183: Service status report
WFLYCTL0186:   Services which failed to start:      service jboss.serverManagement.controller.management.http: org.jboss.msc.service.StartException in service jboss.serverManagement.controller.management.http: WFLYSRV0083: Failed to start the http-interface service

22:33:03,253 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0063: Http management interface is not enabled
22:33:03,254 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0054: Admin console is not enabled
<code class="literal">22:33:03,254 ERROR [org.jboss.as] (Controller Boot Thread) WFLYSRV0026: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started (with errors) in 3277ms - Started 196 of 377 services (2 services failed or missing dependencies, 210 services are lazy, passive or on-demand)</code>
</pre></div><p>Ouch! Another fail!</p><p>What's wrong now? Pretty much the same thing we had in the previous recipe. We didn't change any <a id="id91" class="indexterm"/>binding parameter (IP address or port number) for the management interface.</p><p>As a matter of fact, as you can see from the log of the <code class="literal">node-1</code> instance, the management and HTTP interface are bound to the local address, which is the default one. Thus, the <code class="literal">node-2</code> instance will have the same settings, hence the error: <span class="strong"><strong>Address already in use</strong></span>.</p><p>Let's fix this error:</p><div class="informalexample"><pre class="programlisting">$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/node-1 -Djboss.bind.address=10.0.1.1 -Djboss.bind.address.management=10.0.1.1
...
22:38:41,054 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-6) WFLYUT0006: Undertow HTTP listener default listening on /10.0.1.1:8080
22:38:41,313 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-6) WFLYDS0013: Started FileSystemDeploymentService for directory /home/luigi/WFC/wildfly/node-1/deployments
22:38:41,372 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-2) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
22:38:41,450 INFO  [org.jboss.ws.common.management] (MSC service thread 1-8) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
22:38:41,792 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://10.0.1.1:9990/management
22:38:41,793 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://10.0.1.1:9990
22:38:41,794 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3224ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>Type the <a id="id92" class="indexterm"/>following in a different terminal window:</p><div class="informalexample"><pre class="programlisting">$ ./bin/standalone.sh -Djboss.server.base.dir=$WILDFLY_HOME/node-2 -Djboss.bind.address=10.0.1.2 -Djboss.bind.address.management=10.0.1.2
…
22:39:55,815 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-1) WFLYUT0006: Undertow HTTP listener default listening on /10.0.1.2:8080
22:39:56,054 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-4) WFLYDS0013: Started FileSystemDeploymentService for directory /home/luigi/WFC/wildfly/node-2/deployments
22:39:56,176 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-8) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
22:39:56,241 INFO  [org.jboss.ws.common.management] (MSC service thread 1-7) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
22:39:56,567 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://10.0.1.2:9990/management
22:39:56,567 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://10.0.1.2:9990
22:39:56,568 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3271ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>There you go! We <a id="id93" class="indexterm"/>have two WildFly instances running at the same time, each using a dedicated IP, even if they are both using the same PORT. Let's check it at OS level:</p><div class="mediaobject"><img src="graphics/3744_02_08.jpg" alt="How to do it…"/></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec40"/>There's more…</h2></div></div></div><p>As you have noticed in this recipe and in the previous one, we can customize the WildFly binding relative to the IP address and port number, both for the service components (which is your application) and the management components (which are the Admin Console and the CLI).</p><p>Obviously, we can even mix customization and thus change both the IP and the port, and change the port number for the service components and the IP address for the management interface. You can do whatever you want as long as you don't make equals binding.</p><p>A typical configuration has the services components bound to a public interface (that is, an IP address that's visible externally) and the management interface bound to a private interface (that is, an IP address that's only visible locally or within your network).</p></div></div>
<div class="section" title="Managing applications using the deployments folder"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Managing applications using the deployments folder</h1></div></div></div><p>After <a id="id94" class="indexterm"/>configuring and customizing <a id="id95" class="indexterm"/>the WildFly standalone, it's time to deploy our first application. WildFly provides a lot of methods to deploy applications, one of them being via the deployment scanner (well known to those of you who come from the JBoss AS version). Basically, all you need to do is to copy your artifact into the <code class="literal">deployments</code> folder of your standalone instance.</p><p>In a production environment, you had better turn off the deployment scanner to avoid replacing a deployment accidentally—you would be in very big trouble. Do use the proper "deploy" operation using either the CLI or the Admin Console. We will see both in this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec41"/>Getting ready</h2></div></div></div><p>In this recipe, we will need a Java web application. If you want, you can use one of my projects from my <a id="id96" class="indexterm"/>GitHub account, at the following address: <a class="ulink" href="https://github.com/foogaro/wildfly-cookbook.git">https://github.com/foogaro/wildfly-cookbook.git</a>.</p><p>You can <code class="literal">git-clone</code> the repository or just download it as a ZIP archive. Either way, create a folder <a id="id97" class="indexterm"/>named <code class="literal">github</code> into the <code class="literal">WFC</code> folder, and place the source into it.</p><p>Using the <code class="literal">git-clone</code> command, do as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC
$ mkdir github
$ cd github
$ git clone https://github.com/foogaro/wildfly-cookbook.git</pre></div><p>Once <code class="literal">git</code> has <a id="id98" class="indexterm"/>done with cloning the repo, you can find a project called <code class="literal">example</code>. To compile the project, do as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github/wildfly-cookbook/example
$ mvn -e clean package</pre></div><p>The preceding commands compile the project and generate the web application artifact into a folder named <code class="literal">target</code>. There you can find the application <code class="literal">example.awar</code>, ready to be deployed.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note13"/>Note</h3><p>There is also the <a id="id99" class="indexterm"/>official WildFly quickstarts repository, which has plenty of precious resources to look at, and it is also available for contribution at the following address: <a class="ulink" href="https://github.com/wildfly/quickstart">https://github.com/wildfly/quickstart</a>.</p></div></div><p>Now, assume that we are going to use the default <code class="literal">standalone</code> folder as the base configuration path of our instance. To see everything in action, it's better to first run WildFly and then start managing the application itself using the <code class="literal">deployments</code> folder.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec42"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, let's start up WildFly:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh
...
WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3087ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div></li><li class="listitem">Now keeping your terminal windows visible, open your favorite file manager tool, and copy <code class="literal">example.war</code> into the <code class="literal">deployments</code> folder.<p>Alternatively, you can copy the web application using a new terminal, using the following command:</p><div class="informalexample"><pre class="programlisting">$ cp ~/WFC/github/wildfly-cookbook/example/target/example.war $WILDFLY_HOME/standalone/deployments</pre></div></li><li class="listitem">A few seconds <a id="id100" class="indexterm"/>later (the timer <a id="id101" class="indexterm"/>interval is set for every 5 seconds, so you may wait a few milliseconds or 5 seconds), we'll get the following output:<div class="informalexample"><pre class="programlisting">22:51:31,396 INFO  [org.jboss.as.repository] (DeploymentScanner-threads - 1) WFLYDR0001: Content added at location /home/luigi/WFC/wildfly/standalone/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
22:51:31,447 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-3) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
22:51:31,986 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) WFLYUT0021: Registered web context: /example
22:51:32,046 INFO  [org.jboss.as.server] (DeploymentScanner-threads - 1) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")</pre></div><p>And you should also get a new file in the <code class="literal">deployments</code> folder named <code class="literal">example.war.deployed</code>. This is a marker saying that the application has been successfully deployed. In case of an error, any operation would have been rolled back and a new file named <code class="literal">example.war.failed</code> would have been created.</p></li><li class="listitem">Now, can you guess how to undeploy it? Yes... rename the marker file extension with <code class="literal">.undeploy</code> as follows:<div class="informalexample"><pre class="programlisting">22:55:17,702 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-7) WFLYUT0022: Unregistered web context: /example
22:55:17,736 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-4) HV000001: Hibernate Validator 5.1.3.Final
22:55:17,801 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-3) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 109ms
22:55:17,817 INFO  [org.jboss.as.repository] (DeploymentScanner-threads - 1) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/standalone/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
22:55:17,817 INFO  [org.jboss.as.server] (DeploymentScanner-threads - 1) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")</pre></div><p>And in the <code class="literal">deployments</code> folder, a new file named <code class="literal">example.war.undeployed</code> has been created. How do we redeploy it now? Delete the two marker files, or create a new one named <code class="literal">example.war.dodeploy</code>.</p></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec43"/>How it works…</h2></div></div></div><p>To recap what we've <a id="id102" class="indexterm"/>learned so far, marker files <a id="id103" class="indexterm"/>always have the same name as the application plus the suffix. The following table summarizes all the available markers:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Suffix</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.dodeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>User generated to indicate that the given content should be deployed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.skipdeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>User generated to indicate that the given content should skip auto-deploy as long as the file is present. This allows you to modify the exploded content without having the scanner initiate redeploy in the middle of the update. Same is true for zipped content.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.isdeploying</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that it has noticed a <code class="literal">.dodeploy</code> file or new or updated auto-deploy mode content and is in the process of deploying the content. This marker file will be deleted when the deployment process completes, so you may not see it for small size artifacts.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.deployed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that the given content has been deployed. If you delete this file, the content will be undeployed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.failed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that the given content has failed in its deploying process. In the file, you will find information about what went wrong during deployment. Note that with auto-deploy mode, removing this file will make the deployment eligible for deployment again.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.isundeploying</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that it has noticed that a <code class="literal">.deployed</code> file has been deleted and the content is being undeployed. This marker file will be deleted when the undeployment process completes, so you may not see it for small size artifacts.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.undeployed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that the given content has been undeployed. If you delete this file, there will be no impact at all.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.pending</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Placed by the deployment scanner service to indicate that it has noticed the need to deploy content but has not yet instructed the server to deploy it.</p>
<p>This <a id="id104" class="indexterm"/>file is created if the scanner detects that <a id="id105" class="indexterm"/>some auto-deploy content is still in the process of being copied or if there is some problem that prevents auto-deployment. The scanner will not instruct the server to deploy or undeploy any content (not just the directly affected content) as long as this condition holds.</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Connecting to the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Connecting to the CLI</h1></div></div></div><p>There are three <a id="id106" class="indexterm"/>ways to manage your WildFly, that is, by editing the XML file, the Console and the CLI.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">First of all, editing the XML directly can be error-prone, as it can waste you precious seconds; moreover, every change requires a server restart.</li><li class="listitem" style="list-style-type: disc">The Console gives you visual editing features, but it's not complete. The Web Console can perform just a subset of all the available actions that you can execute using the CLI.</li><li class="listitem" style="list-style-type: disc">CLI stands for Command Line Interface, and it is a tool that you are recommended to use to manage your WildFly application server.</li></ul></div><p>Why the CLI? Most of the time, for security reasons, you connect to enterprise environments via SSH and are thus not able to see the Web Console at all. CLI WildFly comes in handy for this purpose.</p><p>CLI is a powerful tool <a id="id107" class="indexterm"/>that gives you full control over WildFly; you can deploy and undeploy applications, create and manage data sources, manage logging, change system properties, stop and start instances, and more. Working with the CLI also helps you understand the WildFly core logic so you can really become an expert WildFly administrator. Nevertheless, if you really want a GUI as well, you can have the CLI in GUI version; just execute the following command while you have your WildFly running:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh --gui</pre></div><p>The following screenshot depicts the CLI GUI tool:</p><div class="mediaobject"><img src="graphics/3744_02_09.jpg" alt="Connecting to the CLI"/><div class="caption"><p>CLI GUI tool</p></div></div><p>Now, it's time to play around with the CLI. Let's see what you can do!</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec44"/>Getting ready</h2></div></div></div><p>As the CLI is a management <a id="id108" class="indexterm"/>tool, you will need to have your WildFly instance up and running. In this case too, we will use the default standalone configuration.</p><p>Open a terminal window and start WildFly:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh
...
22:12:23,600 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3087ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec45"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's open a terminal window:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type connect to connect to the server or help for the list of supported commands.
[disconnected /]</pre></div></li><li class="listitem">Once in, we need to connect to the running instance. By typing the command <code class="literal">connect</code>, the tool connects to the instance with the default parameters, which is <code class="literal">localhost:9990</code>.<div class="informalexample"><pre class="programlisting">[disconnected /] connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">You can also connect to the CLI directly from the command line by passing the --connect parameter as follows:<div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /]</pre></div><p>From now on, we will connect directly to the CLI without having to connect to it from the inside.</p></li><li class="listitem">Now try the <a id="id109" class="indexterm"/>command listing <code class="literal">ls</code> (as you would do in Linux):<div class="mediaobject"><img src="graphics/3744_02_10.jpg" alt="How to do it…"/></div></li><li class="listitem">The list command gives you all the components that you can operate on, pretty much what you can see editing the <code class="literal">standalone.xml</code>. In fact, listing the subsystems, you will see all the subsystems present declared in <code class="literal">standalone.xml</code>:<div class="mediaobject"><img src="graphics/3744_02_11.jpg" alt="How to do it…"/></div></li></ol></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec46"/>There's more…</h2></div></div></div><p>Remember that the <span class="emphasis"><em>Tab</em></span> key on your keyboard is your friend. If you don't remember a command, just hit <span class="emphasis"><em>Tab</em></span>. If you don't remember how to complete a command, just hit <span class="emphasis"><em>Tab</em></span>. Hitting the <span class="emphasis"><em>Tab</em></span> key will show all the possible solutions within your current context.</p><p>There are two others special characters within the CLI: <code class="literal">/</code> (the forward slash) and <code class="literal">:</code> (the colon). The forward slash <a id="id110" class="indexterm"/>is used to navigate through the contexts, while the colon is used to invoke method operation within the last selected context. Check the next recipe for an example.</p></div></div>
<div class="section" title="Checking the server-state via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Checking the server-state via the CLI</h1></div></div></div><p>In this recipe, we will <a id="id111" class="indexterm"/>learn how to check the server status. WildFly may have different status depending on its phase: starting, stopping, started, and <a id="id112" class="indexterm"/>stopped. Sometimes, just checking its status at the OS level by looking for its process might not be enough.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec47"/>Getting ready</h2></div></div></div><p>As the CLI is a management tool, you will need to have your WildFly instance up and running. Also for this recipe, we will rely on the default standalone configuration.</p><p>Open a terminal window and start WildFly:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/standalone.sh
...
22:12:23,600 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 3226ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec48"/>How to do it…</h2></div></div></div><p>In a new terminal window, type in the following:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect
[standalone@localhost:9990 /] :read-attribute(name=server-state)
{
    "outcome" =&gt; "success",
    "result" =&gt; "running"
}
[standalone@localhost:9990 /]</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec49"/>How it works…</h2></div></div></div><p>As you connect to the host-controller, you are just in the root of your configuration. Thus, you can invoke an operation on it, and to do that, you need to start with the <code class="literal">:</code> (colon) symbol.</p><p>In our example we used the <code class="literal">read-attribute</code> method, but you could have any of the available ones. To see them <a id="id113" class="indexterm"/>is as easy as hitting the <span class="emphasis"><em>Tab</em></span> key right after the <a id="id114" class="indexterm"/>colon symbol, as follows:</p><div class="mediaobject"><img src="graphics/3744_02_12.jpg" alt="How it works…"/></div><p>Getting back to our server state, we received two responses: one saying that our invocation was successful, and the second one reporting the result, <span class="strong"><strong>running</strong></span>.</p></div></div>
<div class="section" title="Deploying an application via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>Deploying an application via the CLI</h1></div></div></div><p>In this <a id="id115" class="indexterm"/>recipe, we will learn how to deploy an application using the CLI. Here we will use just the basic options but keep in mind that you have several options during deployments, which we will analyze deeply in the chapter dedicated <a id="id116" class="indexterm"/>to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec50"/>Getting ready</h2></div></div></div><p>In this recipe, and in the following one as well, we will need an application to test our configuration. For this recipe, we will need the application named <code class="literal">example</code> that you can find in my GitHub repository. If you skipped the <span class="emphasis"><em>Managing applications using the deployments folder</em></span> recipe, please refer to it to download the source code and the projects that you will need.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec51"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With your WildFly instance up and running, open up a terminal and connect to the CLI as usual:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now we need to tell the CLI to deploy our application as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] deploy example.war
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">And let's <a id="id117" class="indexterm"/>have a look at the <code class="literal">server.log</code> files:<div class="informalexample"><pre class="programlisting">23:02:29,511 INFO  [org.jboss.as.repository] (management-handler-thread - 3) WFLYDR0001: Content added at location /home/luigi/WFC/wildfly/standalone/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
23:02:29,517 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-6) WFLYSRV0027: Starting deployment of "example.war" (runtime-name: "example.war")
23:02:29,613 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0021: Registered web context: /example
23:02:29,641 INFO  [org.jboss.as.server] (management-handler-thread - 3) WFLYSRV0010: Deployed "example.war" (runtime-name : "example.war")</pre></div></li><li class="listitem">Now, let's check it for deployment from the CLI:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] deployment-info --name=example.war
NAME        RUNTIME-NAME PERSISTENT ENABLED STATUS
example.war example.war  true       true    OK     
[standalone@localhost:9990 /]</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec52"/>How it works…</h2></div></div></div><p>I emphasized a log line to take your attention. As you can see, WildFly automatically saves its artifacts <a id="id118" class="indexterm"/>into its <code class="literal">data/content</code> folder. In that folder, you will find a lot of folders with hashed names that contain the artifact. The artifact is then renamed as <code class="literal">content</code>.</p><p>If you try to see the <code class="literal">content</code> file information using the <code class="literal">unzip</code> command, you will find your artifact <a id="id119" class="indexterm"/>structure as seen in the following screenshot:</p><div class="mediaobject"><img src="graphics/3744_02_13.jpg" alt="How it works…"/></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec53"/>There's more…</h2></div></div></div><p>You can also deploy an artifact disabled, with status stopped, and enable it at your convenience as follows:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] deploy example.war --disabled</pre></div><p>This will just add the artifact into the <code class="literal">data/content</code> folder of WildFly in your running-mode, to enable it later:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] deploy --name=example.war</pre></div><p>There is also a <a id="id120" class="indexterm"/>reference to the deployment inside the <code class="literal">standalone.xml</code> configuration file; open it and scroll down to the end.</p><div class="mediaobject"><img src="graphics/3744_02_14.jpg" alt="There's more…"/><div class="caption"><p>Standalone.xml updated after a deploy</p></div></div><p>Yes, you will find the <code class="literal">name</code> and the <code class="literal">runtime-name</code> along with the hash. In the <span class="emphasis"><em>How it works...</em></span> section, I showed you where the deployment really persists, and in that case, it was stored into the <code class="literal">$WILDFLY_HOME/standalone/data/content/</code> folder.</p><p>Did you notice it? The first two characters of the <code class="literal">sha1</code> value denote the first folder, the rest of the <code class="literal">sha1</code> hash is the subfolder that contains the artifact renamed as <code class="literal">content</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip03"/>Tip</h3><p>Getting the original deployment file can sometimes save your life, especially when dealing with a production environment, where last minute works are not "integrated" that much. Be safe with your backup.</p></div></div><p>Let's have a look at the <code class="literal">deployments</code> folder now. It's empty. That is because everything goes into the runtime <code class="literal">data/content</code> folder. Try to stop the instance and copy the <code class="literal">example.war</code> <a id="id121" class="indexterm"/>application into the <code class="literal">deployments</code> folder.</p><p>Now start the <a id="id122" class="indexterm"/>instance again. What do you get? Something similar to the following:</p><div class="informalexample"><pre class="programlisting">23:16:54,708 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
23:16:54,934 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
23:16:55,003 INFO  [org.jboss.as] (MSC service thread 1-6) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
23:16:56,170 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 20) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
<span class="strong"><strong>23:16:56,243 ERROR [org.jboss.as.controller.management-operation] (Controller Boot Thread) WFLYCTL0013: Operation ("add") failed - address: ([("deployment" =&gt; "example.war")]) - failure description: "WFLYCTL0212: Duplicate resource [(\"deployment\" =&gt; \"example.war\")]"</strong></span>
<span class="strong"><strong>23:16:56,249 FATAL [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0056: Server boot has failed in an unrecoverable manner; exiting. See previous messages for details.</strong></span>
23:16:56,260 INFO  [org.jboss.as.server] (Thread-2) WFLYSRV0220: Server shutdown has been requested.
23:16:56,285 INFO  [org.jboss.as] (MSC service thread 1-3) WFLYSRV0050: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) stopped in 16ms</pre></div><p>This is because you tried to deploy the same artifact twice, once using the CLI and once using the <code class="literal">deployment</code> folder. There is a listener called <code class="literal">deployment-scanner</code> that is triggered whenever you modify the content of the <code class="literal">deployment</code> folder. By the way, you can solve the preceding problem using the CLI, or by removing the auto-generated XML code into <code class="literal">standalone.xml</code> and leaving the artifact in the <code class="literal">deployments</code> folder.</p></div></div>
<div class="section" title="Undeploying an application via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Undeploying an application via the CLI</h1></div></div></div><p>In this recipe, we will <a id="id123" class="indexterm"/>learn how to undeploy an application <a id="id124" class="indexterm"/>using the CLI. As per the <code class="literal">deploy</code> command, we will use just the basic available options. We will analyze the <code class="literal">undeploy</code> command deeply, later in the book.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec54"/>Getting ready</h2></div></div></div><p>This recipe follows the previous one, which is <span class="emphasis"><em>Deploying an application via CLI</em></span>. This means that we will find the <code class="literal">example</code> application ready to be <code class="literal">undeployed</code>. If you skipped the previous recipe, follow the instructions that it provides, or alternatively provide yourself with an application to undeploy.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec55"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With your <a id="id125" class="indexterm"/>WildFly instance up and running, open a terminal and connect to the CLI as usual:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">Now we need to tell the CLI to undeploy our application as follows:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] undeploy example.war
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">And the <code class="literal">server.log</code> logs the following:<div class="informalexample"><pre class="programlisting">23:19:50,912 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) WFLYUT0022: Unregistered web context: /example
23:19:50,961 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-2) HV000001: Hibernate Validator 5.1.3.Final
23:19:51,010 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-5) WFLYSRV0028: Stopped deployment example.war (runtime-name: example.war) in 115ms
23:19:51,058 INFO  [org.jboss.as.repository] (management-handler-thread - 1) WFLYDR0002: Content removed from location /home/luigi/WFC/wildfly/standalone/data/content/21/7dd6250d5bc4afcabdffb0b25c99db92239b5a/content
23:19:51,059 INFO  [org.jboss.as.server] (management-handler-thread - 1) WFLYSRV0009: Undeployed "example.war" (runtime-name: "example.war")</pre></div></li></ol></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec56"/>There's more…</h2></div></div></div><p>If you did a copy and <a id="id126" class="indexterm"/>paste of the previous command, you wouldn't have noticed a helpful feature of the <code class="literal">undeploy</code> command.</p><p>You can tell the <a id="id127" class="indexterm"/>CLI to list all the deployments first, so you can choose the right one to undeploy using the following command:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] undeploy -l
NAME        RUNTIME-NAME ENABLED STATUS
example.war example.war  true    OK     

[standalone@localhost:9990 /]</pre></div></div></div>
<div class="section" title="Executing commands in batch mode via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec27"/>Executing commands in batch mode via the CLI</h1></div></div></div><p>In this recipe, we <a id="id128" class="indexterm"/>will learn how to invoke <a id="id129" class="indexterm"/>commands in the batch mode. Actually, you <a id="id130" class="indexterm"/>can declare and prepare a list of commands to execute, and execute them sequentially at once. The batch mode gives you consistency among your operations and configuration.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec57"/>Getting ready</h2></div></div></div><p>Get our WildFly instance up and running; from the folder where we downloaded the GitHub repository, <code class="literal">WFC/github/wildfly-cookbook</code>, copy the <code class="literal">example.war</code> and <code class="literal">simple.war</code> applications into the <code class="literal">$JBOSS_HOME</code> folder and connect to the CLI.</p><p>If you can find the applications, you probably need to compile the projects. I'll show you how to do it for the <code class="literal">simple</code> application, and the same applies to the others. Open a terminal and do as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github/wildfly-cookbook
$ cd simple
$ mvn -e clean package
   
$ cp target/simple.war ~/WFC/wildfly/</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec58"/>How to do it…</h2></div></div></div><p>We are going to do the following operation in sequence:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Deploy <code class="literal">example.war</code>.</li><li class="listitem">Deploy <code class="literal">simple.war</code>.</li><li class="listitem">Let's go to the CLI:<div class="informalexample"><pre class="programlisting">$ cd ~/WFC/wildfly
$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /] batch
[standalone@localhost:9990 / #] deploy example.war
[standalone@localhost:9990 / #] deploy simple.war
[standalone@localhost:9990 / #] run-batch
The batch executed successfully
[standalone@localhost:9990 /]</pre></div></li><li class="listitem">And the <a id="id131" class="indexterm"/><code class="literal">server.log</code> logs the <a id="id132" class="indexterm"/>following:<div class="informalexample"><pre class="programlisting">...
07:33:02,191 INFO  [org.jboss.as.repository] (management-handler-thread - 4) JBAS014900: Content added at location /home/lfugaro/wildfly/standalone/data/content/7a/a7c67cb54e0affa9d60cf98230e0c17efd1119/content
07:33:02,205 INFO  [org.jboss.as.repository] (management-handler-thread - 4) JBAS014900: Content added at location /home/lfugaro/wildfly/standalone/data/content/e0/2abb62b1b29f97f532ef1501910d64af194b21/content
07:33:02,227 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) JBAS015876: Starting deployment of "simple.war" (runtime-name: "simple.war")
07:33:02,227 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-7) JBAS015876: Starting deployment of "example.war" (runtime-name: "example.war")
07:33:02,689 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-1) JBAS017534: Registered web context: /simple
07:33:02,689 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-6) JBAS017534: Registered web context: /example
07:33:02,746 INFO  [org.jboss.as.server] (management-handler-thread - 4) JBAS018559: Deployed "simple.war" (runtime-name : "simple.war")
07:33:02,746 INFO  [org.jboss.as.server] (management-handler-thread - 4) JBAS018559: Deployed "example.war" (runtime-name : "example.war")</pre></div></li></ol></div></div></div>
<div class="section" title="Reloading a server configuration via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec28"/>Reloading a server configuration via the CLI</h1></div></div></div><p>In this <a id="id133" class="indexterm"/>recipe, we will learn how to reload the server <a id="id134" class="indexterm"/>configuration, without the need for a full restart. Often, there are changes that need the server to be reloaded. Most of the time you realize that a specific setting needs a different value just after a server startup or during tests. So, instead of stopping and starting the all application server, you can just reload the configuration, unless the change involves the JVM or settings that are needed at boot time.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec59"/>Getting ready</h2></div></div></div><p>We have already seen how to reload a server while playing with IPs and port binding, but it's worth mentioning again.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec60"/>How to do it…</h2></div></div></div><p>The command <a id="id135" class="indexterm"/>itself is pretty easy:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /] reload
[standalone@localhost:9990 /]</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec61"/>How it works…</h2></div></div></div><p>Basically, the <code class="literal">reload</code> command issues, in sequence, a <code class="literal">stop</code> for all the WildFly active services and a <code class="literal">start</code>, which starts up the services again. This should give you important information. The JVM remains the same. If you test the active process at the OS level before and after issuing <a id="id136" class="indexterm"/>the <code class="literal">reload</code> command, you will notice that the processes' IDs are the same.</p><div class="informalexample"><pre class="programlisting">$ ps -efa | grep java | grep -v grep
luigi     <span class="strong"><strong>4915</strong></span>  4879 80 16:07 pts/3    00:00:11 /home/luigi/WFC/jdk8/bin/java -D[Standalone] -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -Dorg.jboss.boot.log.file=/home/luigi/WFC/wildfly/standalone/log/server.log -Dlogging.configuration=file:/home/luigi/WFC/wildfly/standalone/configuration/logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.standalone -Djboss.home.dir=/home/luigi/WFC/wildfly -Djboss.server.base.dir=/home/luigi/WFC/wildfly/standalone
luigi     <span class="strong"><strong>5031</strong></span>  5023 36 16:07 pts/2    00:00:01 /home/luigi/WFC/jdk8/bin/java -Djboss.modules.system.pkgs=com.sun.java.swing -Dlogging.configuration=file:/home/luigi/WFC/wildfly/bin/jboss-cli-logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.cli --connect</pre></div><p>Last but not least, your CLI does not disconnect.</p></div></div>
<div class="section" title="Shutting down and restarting an instance via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec29"/>Shutting down and restarting an instance via the CLI</h1></div></div></div><p>In this <a id="id137" class="indexterm"/>recipe, we will learn how to stop a WildFly <a id="id138" class="indexterm"/>instance via the CLI, or alternatively, restart it via the CLI.The <a id="id139" class="indexterm"/>restart option is in contrast to the <a id="id140" class="indexterm"/><code class="literal">reload</code> command of the previous recipe.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec62"/>Getting ready</h2></div></div></div><p>Start up your WildFly so that we can directly connect to it via the CLI, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/wildfly
$ ./bin/standalone.sh</pre></div></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec63"/>How to do it...</h2></div></div></div><p>The command itself is pretty easy:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /] shutdown
[disconnected /]</pre></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec64"/>How it works...</h2></div></div></div><p>The preceding command stops everything and drops you off from the CLI. Hence, in case you need to restart your WildFly instance, you need to execute the <code class="literal">standalone.sh</code> script again, along with any parameter previously defined.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec65"/>There's more...</h2></div></div></div><p>Alternatively, if what you really need is a full stop and start, you can rely on the <code class="literal">--restart=true</code> option for the <code class="literal">shutdown</code> command.</p><p>Before executing the <code class="literal">shutdown</code> command with the <code class="literal">restart</code> option, take note of the process ID (PID) of the WildFly instance, as follows:</p><div class="informalexample"><pre class="programlisting">$ ps -efa | grep java | grep -v grep
luigi     5031  5023  0 16:07 pts/2    00:00:03 /home/luigi/WFC/jdk8/bin/java -Djboss.modules.system.pkgs=com.sun.java.swing -Dlogging.configuration=file:/home/luigi/WFC/wildfly/bin/jboss-cli-logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.cli --connect
luigi     <span class="strong"><strong>5285</strong></span>  5249 99 16:29 pts/3    00:00:09 /home/luigi/WFC/jdk8/bin/java -D[Standalone] -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -Dorg.jboss.boot.log.file=/home/luigi/WFC/wildfly/standalone/log/server.log -Dlogging.configuration=file:/home/luigi/WFC/wildfly/standalone/configuration/logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.standalone -Djboss.home.dir=/home/luigi/WFC/wildfly -Djboss.server.base.dir=/home/luigi/WFC/wildfly/standalone</pre></div><p>Okay, now go back into the CLI and do as follows:</p><div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] shutdown --restart=true
[standalone@localhost:9990 /]</pre></div><p>The first visible <a id="id141" class="indexterm"/>difference is that your CLI doesn't <a id="id142" class="indexterm"/>disconnect. Now let's go back to the terminal and list the <a id="id143" class="indexterm"/>available processes at the OS level, as done <a id="id144" class="indexterm"/>previously:</p><div class="informalexample"><pre class="programlisting">$ ps -efa | grep java | grep -v grep
luigi     5421  5413 10 16:29 pts/2    00:00:01 /home/luigi/WFC/jdk8/bin/java -Djboss.modules.system.pkgs=com.sun.java.swing -Dlogging.configuration=file:/home/luigi/WFC/wildfly/bin/jboss-cli-logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.cli --connect
luigi     <span class="strong"><strong>5482</strong></span>  5249 99 16:29 pts/3    00:00:10 /home/luigi/WFC/jdk8/bin/java -D[Standalone] -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true -Dorg.jboss.boot.log.file=/home/luigi/WFC/wildfly/standalone/log/server.log -Dlogging.configuration=file:/home/luigi/WFC/wildfly/standalone/configuration/logging.properties -jar /home/luigi/WFC/wildfly/jboss-modules.jar -mp /home/luigi/WFC/wildfly/modules org.jboss.as.standalone -Djboss.home.dir=/home/luigi/WFC/wildfly -Djboss.server.base.dir=/home/luigi/WFC/wildfly/standalone</pre></div><p>This is probably the most important difference with the <code class="literal">reload</code> command. You get a completely new JVM, a different process ID at the OS level. The preceding command executed into the CLI completely shuts down the current instance and starts up a new one, as shown in the following log entries:</p><div class="informalexample"><pre class="programlisting">...
10:43:31,997 INFO  [org.jboss.as.server] (management-handler-thread - 2) WFLYSRV0211: Suspending server
10:43:32,002 INFO  [org.jboss.as.server] (Thread-2) WFLYSRV0220: Server shutdown has been requested.
10:43:32,016 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-10) WFLYUT0019: Host default-host stopping
10:43:32,017 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-1) WFLYJCA0010: Unbound data source [java:jboss/datasources/ExampleDS]
10:43:32,025 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-11) WFLYJCA0019: Stopped Driver service with driver-name = h2
10:43:32,058 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-1) WFLYUT0008: Undertow HTTP listener default suspending
10:43:32,065 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-1) WFLYUT0007: Undertow HTTP listener default stopped, was bound to /0.0.0.0:8080
10:43:32,066 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-5) WFLYUT0004: Undertow 1.2.0.Beta10 stopping
10:43:32,152 INFO  [org.jboss.as] (MSC service thread 1-2) WFLYSRV0050: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) stopped in 130ms
Restarting JBoss...
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
10:43:32,639 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.2.Final
10:43:32,858 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.4.Final
10:43:32,936 INFO  [org.jboss.as] (MSC service thread 1-7) WFLYSRV0049: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) starting
10:43:34,064 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 22) WFLYCTL0028: Attribute enabled is deprecated, and it might be removed in future version!
10:43:34,088 INFO  [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0039: Creating http management service using socket-binding (management-http)
10:43:34,120 INFO  [org.xnio] (MSC service thread 1-2) XNIO version 3.3.0.Final
10:43:34,130 INFO  [org.xnio.nio] (MSC service thread 1-2) XNIO NIO Implementation Version 3.3.0.Final
10:43:34,186 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 38) WFLYCLINF0001: Activating Infinispan subsystem.
10:43:34,185 INFO  [org.wildfly.extension.io] (ServerService Thread Pool -- 37) WFLYIO001: Worker 'default' has auto-configured to 16 core threads with 128 task threads based on your 8 available processors
10:43:34,193 INFO  [org.jboss.remoting] (MSC service thread 1-2) JBoss Remoting version 4.0.8.Final
10:43:34,220 INFO  [org.jboss.as.naming] (ServerService Thread Pool -- 46) WFLYNAM0001: Activating Naming Subsystem
10:43:34,230 INFO  [org.jboss.as.security] (ServerService Thread Pool -- 53) WFLYSEC0002: Activating Security Subsystem
10:43:34,228 INFO  [org.jboss.as.connector.subsystems.datasources] (ServerService Thread Pool -- 33) WFLYJCA0004: Deploying JDBC-compliant driver class org.h2.Driver (version 1.3)
10:43:34,242 WARN  [org.jboss.as.txn] (ServerService Thread Pool -- 54) WFLYTX0013: Node identifier property is set to the default value. Please make sure it is unique.
10:43:34,242 INFO  [org.jboss.as.security] (MSC service thread 1-10) WFLYSEC0001: Current PicketBox version=4.9.0.Beta2
10:43:34,245 INFO  [org.jboss.as.jsf] (ServerService Thread Pool -- 44) WFLYJSF0007: Activated the following JSF Implementations: [main]
10:43:34,294 INFO  [org.jboss.as.webservices] (ServerService Thread Pool -- 56) WFLYWS0002: Activating WebServices Extension
10:43:34,311 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0003: Undertow 1.2.0.Beta10 starting
10:43:34,328 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-3) WFLYUT0003: Undertow 1.2.0.Beta10 starting
10:43:34,305 INFO  [org.jboss.as.connector] (MSC service thread 1-7) WFLYJCA0009: Starting JCA Subsystem (IronJacamar 1.2.3.Final)
10:43:34,350 INFO  [org.jboss.as.connector.deployers.jdbc] (MSC service thread 1-9) WFLYJCA0018: Started Driver service with driver-name = h2
10:43:34,421 INFO  [org.jboss.as.naming] (MSC service thread 1-12) WFLYNAM0003: Starting Naming Service
10:43:34,421 INFO  [org.jboss.as.mail.extension] (MSC service thread 1-14) WFLYMAIL0001: Bound mail session [java:jboss/mail/Default]
10:43:34,616 INFO  [org.wildfly.extension.undertow] (ServerService Thread Pool -- 55) WFLYUT0014: Creating file handler for path /home/wildfly/WFC/wildfly/welcome-content
10:43:34,651 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-16) WFLYUT0012: Started server default-server.
10:43:34,670 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-16) WFLYUT0018: Host default-host starting
10:43:34,749 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-11) WFLYUT0006: Undertow HTTP listener default listening on /0.0.0.0:8080
10:43:34,882 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-2) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
10:43:34,948 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-5) WFLYDS0013: Started FileSystemDeploymentService for directory /home/wildfly/WFC/wildfly/standalone/deployments
10:43:35,080 INFO  [org.jboss.ws.common.management] (MSC service thread 1-2) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Beta3
[standalone@localhost:9990 /] 10:43:35,314 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://0.0.0.0:9990/management
10:43:35,320 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://0.0.0.0:9990
10:43:35,321 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.0.Beta2 (WildFly Core 1.0.0.Beta2) started in 2990ms - Started 202 of 379 services (210 services are lazy, passive or on-demand)</pre></div><p>Remember that <a id="id145" class="indexterm"/>the PID changes, so if you are monitoring <a id="id146" class="indexterm"/>your instance per PID, consider updating <a id="id147" class="indexterm"/>your <a id="id148" class="indexterm"/>monitoring tool/script as well!</p></div></div>
<div class="section" title="Suspending and resuming an instance via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec30"/>Suspending and resuming an instance via the CLI</h1></div></div></div><p>In this <a id="id149" class="indexterm"/>recipe, we will learn how to suspend an instance without <a id="id150" class="indexterm"/>killing active requests. Once the running <a id="id151" class="indexterm"/>requests are completed, the next ones will not be <a id="id152" class="indexterm"/>accepted. This is a new feature available in WildFly 9.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec66"/>Getting ready</h2></div></div></div><p>To test this recipe, we will need the application named <code class="literal">grace</code> that you can find in my GitHub repository. If you skipped the <span class="emphasis"><em>Managing applications using the deployments folder</em></span> recipe, please refer to it to download all the source code and the projects that you will need.</p><p>Start up your WildFly so we can directly connect to it via the CLI, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/wildfly
$ ./bin/standalone.sh</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec67"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, deploy the application <code class="literal">grace.war</code>. Once the application has been deployed, open it using a browser at the following URL <code class="literal">http://127.0.0.1:8080/grace</code><p>This will hit the <code class="literal">index.jsp</code> page which increments a counter and then sleeps for 10 seconds, just to simulate a long running request.</p></li><li class="listitem">While running, open a terminal window and connect to the CLI as usual. Once there, do as follows:<div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /] :suspend</pre></div></li><li class="listitem">Now, going back on the browser, your request should be done and you should see a page similar to the following one:<div class="mediaobject"><img src="graphics/3744_02_15.jpg" alt="How to do it…"/></div></li><li class="listitem">On the other hand, to resume the instance, just invoke the following command:<div class="informalexample"><pre class="programlisting">[standalone@localhost:9990 /] :resume</pre></div></li></ol></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec68"/>How it works…</h2></div></div></div><p>The command itself is <a id="id153" class="indexterm"/>pretty easy. What you should know is what happens <a id="id154" class="indexterm"/>to the next user's requests. The next user would <a id="id155" class="indexterm"/>get the following page:</p><div class="mediaobject"><img src="graphics/3744_02_16.jpg" alt="How it works…"/></div><p>Obviously, you could handle the HTTP <span class="strong"><strong>503</strong></span> code using a special page to warn the users about the technical problems due to the system's upgrade.</p><p>On the WildFly logs you should catch the following entry:</p><div class="informalexample"><pre class="programlisting">16:38:05,374 INFO  [org.jboss.as.server] (management-handler-thread - 7) WFLYSRV0211: Suspending server</pre></div><p>The <code class="literal">resume</code> command is pretty easy as well. What needs to be noticed is that the user will not lose his current and active session, which is a really great feature from the user's point of view.</p><p>On the WildFly logs, you <a id="id156" class="indexterm"/>should catch the following entry:</p><div class="informalexample"><pre class="programlisting">16:38:25,347 INFO  [org.jboss.as.server] (management-handler-thread - 8) WFLYSRV0212: Resuming server</pre></div><p>Now if you go back to the <a id="id157" class="indexterm"/>application and refresh the page, you should see the <a id="id158" class="indexterm"/>counter increasing from where it stopped, as <a id="id159" class="indexterm"/>depicted in the following image:</p><div class="mediaobject"><img src="graphics/3744_02_17.jpg" alt="How it works…"/></div></div></div>
<div class="section" title="Backing up your configuration file via the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec31"/>Backing up your configuration file via the CLI</h1></div></div></div><p>In this recipe, we <a id="id160" class="indexterm"/>will learn how to backup our <a id="id161" class="indexterm"/>configuration via the CLI. Essentially, the <a id="id162" class="indexterm"/>CLI backs up the <code class="literal">standalone.xml</code> file by copying it into the <code class="literal">snapshot</code>.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec69"/>Getting ready</h2></div></div></div><p>Start up your WildFly so that we can directly connect to it via the CLI, as follows:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/wildfly
$ ./bin/standalone.sh</pre></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec70"/>How to do it…</h2></div></div></div><p>The command itself is pretty easy:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect
[standalone@localhost:9990 /] :take-snapshot  
{
    "outcome" =&gt; "success",
    "result" =&gt; "/home/luigi/WFC/wildfly/standalone/configuration/standalone_xml_history/snapshot/20150301-165737562standalone.xml"
}</pre></div><p>That's it! A backup of <a id="id163" class="indexterm"/>the <code class="literal">standalone.xml</code> file <a id="id164" class="indexterm"/>gets copied into the <code class="literal">snapshot</code> folder, named by prefixing the file with the current date and time.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip04"/>Tip</h3><p>Always back up your configuration, especially when operating in a production environment.</p></div></div></div></div></body></html>