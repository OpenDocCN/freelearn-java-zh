<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Configuring and Deploying to GlassFish</h1>
                </header>
            
            <article>
                
<p>At the time of writing, GlassFish 5 was the only released Java EE 8 compliant application server, as such, all the example code was tested against GlassFish, however, they should work on any Java EE 8 compliant application server.</p>
<p>Readers wanting to use GlassFish to run the example code can follow the instructions in this appendix to set it up.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Obtaining GlassFish</h1>
                </header>
            
            <article>
                
<p>GlassFish can be downloaded from <a href="https://javaee.github.io/glassfish/download"><span class="URLPACKT">https://javaee.github.io/glassfish/download</span></a><a href="https://glassfish.dev.java.net/"><span class="InternetLink">.</span></a></p>
<div class="CDPAlignCenter CDPAlign"><a href="https://glassfish.dev.java.net/"><img src="assets/7fa74480-eb9a-45da-a1cb-01989bc02efe.png" style="width:56.58em;height:42.00em;"/></a><a href="https://glassfish.dev.java.net/"/></div>
<p><span class="WW-DefaultParagraphFont1">The Java EE specification has the concept of profiles, the Web Profile implements a subset of the full Java EE specification and is missing some features, such as JMS and some EJB features. To be able to successfully deploy all examples in the book, we should download the version of GlassFish implementing the full Java EE 8 specification by clicking the link labeled</span> <span class="packt_screen">GlassFish 5.0 - Full Platform</span><span class="WW-DefaultParagraphFont1">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing GlassFish</h1>
                </header>
            
            <article>
                
<p><span class="WW-DefaultParagraphFont1">GlassFish 5.0 is distributed as a zip file; installing GlassFish is as simple as extracting the zip file to a directory of our choosing.</span></p>
<p><span class="WW-DefaultParagraphFont1">GlassFish assumes some dependencies are present in your system.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlassFish dependencies</h1>
                </header>
            
            <article>
                
<p>In order to install GlassFish 5, a recent Java SE version must be installed on your workstation (Java SE 8 required<span class="WW-DefaultParagraphFont1">), and the Java executable must be in your system PATH. Java SE 8 can be downloaded at</span> <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html"><span class="URLPACKT">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</span></a><span class="WW-DefaultParagraphFont1">.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Performing the installation</h1>
                </header>
            
            <article>
                
<p><span class="WW-DefaultParagraphFont1">Once the JDK has been installed, the GlassFish installation can begin by simply extracting the downloaded compressed file:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/b628d16d-a2ca-4a9d-b1ed-8599153a3725.png" style="width:25.42em;height:25.67em;"/></div>
<div class="packt_infobox"><span class="WW-DefaultParagraphFont1">All modern operating systems, including Linux, Windows, and macOS, include out-of-the-box support for extracting compressed ZIP files, consult your operating system documentation for details.</span></div>
<p>After extracting the zip file, a new directory named glassfish5 will be created, this new directory contains our GlassFish installation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Starting GlassFish</h1>
                </header>
            
            <article>
                
<p><span class="WW-DefaultParagraphFont1">To start GlassFish from the command line, change the directory to</span> <kbd>[glassfish installation directory]/glassfish5/bin</kbd><span class="WW-DefaultParagraphFont1">, and execute the following command:</span></p>
<pre><strong><span class="WW-DefaultParagraphFont1">./asadmin start-domain</span></strong></pre>
<div class="packt_infobox"><span class="WW-DefaultParagraphFont1">The preceding command, and most commands shown in this chapter assume a Unix or Unix-like operating system, such as Linux or macOS. For Windows systems, the initial <kbd>./</kbd> is not necessary.</span></div>
<p><span class="WW-DefaultParagraphFont1">A few short seconds after executing the preceding command, we should see a message similar to the following at the bottom of the terminal:</span></p>
<pre><strong><span class="NormalPACKTChar">Waiting for domain1 to start ..............</span>
    </strong>
    <strong>
<span class="NormalPACKTChar">Successfully started the domain : domain1</span>
    </strong>
    <strong>
<span class="NormalPACKTChar">domain  Location: /home/heffel/glassfish-5/glassfish5/glassfish/domains/domain1</span>
    </strong>
    <strong>
<span class="NormalPACKTChar">Log File: /home/heffel/glassfish- <br/> 5/glassfish5/glassfish/domains/domain1/logs/server.log</span>
    </strong>
    <strong>
<span class="NormalPACKTChar">Admin Port: 4848</span>
    </strong>
    <br/><strong><span class="NormalPACKTChar">Command start-domain executed successfully.</span></strong></pre>
<p><span class="WW-DefaultParagraphFont1">We can then open a browser window and type the following URL in the browser's location text field:</span> <kbd><span class="InternetLink">http://localhost:8080</span></kbd><span class="DefaultParagraphFont1">.</span></p>
<p><span class="WW-DefaultParagraphFont1">If everything went well, we should see a page indicating that your GlassFish server is now running:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/beb06925-bef7-468b-b5c2-ae2870bb7e44.png" style="width:55.75em;height:29.25em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying our first Java EE application</h1>
                </header>
            
            <article>
                
<p>To further test that our GlassFish installation is running properly, we will deploy a WAR (Web ARchive) file and make sure it deploys and executes properly. Before moving on, please download the <kbd>simpleapp.war</kbd> file from this book's code bundle.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying an application through the web console</h1>
                </header>
            
            <article>
                
<p>To deploy <kbd>simpleapp.war</kbd>, open a browser and navigate to the following URL: <kbd><span class="InternetLink">http://localhost:4</span><span class="InternetLink">8</span><span class="InternetLink">4</span><span class="InternetLink">8</span></kbd><span class="WW-DefaultParagraphFont1">. You should be greeted with the default GlassFish Server administration page:</span></p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/05ae681e-0b3b-4786-85fd-c6c25238a09b.png" style="width:57.75em;height:33.00em;"/></div>
<p>By default, GlassFish is installed in development mode, in this mode, it is not necessary to enter a username and password to access the GlassFish web console. In production environments, it is highly advisable to configure the web console so that it is password protected.</p>
<p>At this point, we should click the <span class="packt_screen">Deploy an Application</span> item under the <span class="packt_screen">Deployment</span> section in the main screen.</p>
<p>To deploy our application, we should select the <span class="packt_screen">Local Packaged File or Directory That Is Accessible from GlassFish Server</span> radio button, and either type the path to our WAR file or select it by clicking the <span class="packt_screen">Browse Files...</span> button:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/dea4e6ab-3ecc-4407-acef-ce8d5ae1f4e3.png" style="width:65.33em;height:25.33em;"/></div>
<p class="mce-root CDPAlignCenter CDPAlign CDPAlignLeft">After we have selected our WAR file, a number of input fields allowing us to specify several options are shown. For our purposes, all defaults are fine, we can simply click the <span class="packt_screen">OK</span> button at the top right of the page:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/8ac3a873-a1ad-4c22-9d11-7bbcec171326.png" style="width:41.25em;height:42.08em;"/></div>
<p>Once we deploy our application, the GlassFish web console displays the <span class="packt_screen">Applications</span> window, with our application listed as one of the deployed applications:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/e6bb2420-560d-414d-92bf-ba9185319940.png" style="width:57.25em;height:14.00em;"/></div>
<p>To execute the <kbd>simpleapp</kbd> application, type the following URL in the browser 's location text field: <span class="URLPACKT"><kbd>http://localhost:8080/simpleapp-1.0/simpleServlet</kbd>.</span> The resulting page should look like this:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/30ee7363-b8cc-437a-b01b-06b8d2f721e4.png" style="width:58.67em;height:14.00em;"/></div>
<p>That's it! We have successfully deployed our first Java EE application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Undeploying an application through the GlassFish Admin Console</h1>
                </header>
            
            <article>
                
<p>To undeploy the application we just deployed, log in to the GlassFish Admin Console by typing the following URL in the browser: <kbd><span class="InternetLink">http://localhost:4848</span></kbd><span class="NormalPACKTChar">.</span></p>
<p><span class="NormalPACKTChar">Then, either click the</span> <span class="packt_screen">Applications</span> <span class="NormalPACKTChar">menu item in the navigation pane on the left or click the</span> <span class="packt_screen">List Deployed Applications</span> <span class="NormalPACKTChar">item on the administration console's home page.</span></p>
<p><span class="NormalPACKTChar">Either way, should take us to the application management page:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/6cc6b8e8-103c-4fd9-b926-ad51ed26cbdc.png" style="width:51.58em;height:13.08em;"/></div>
<p><span class="NormalPACKTChar">The application can be undeployed simply by selecting it from the list of deployed applications and clicking the</span> <span class="packt_screen">Undeploy</span> <span class="NormalPACKTChar">button above the list of deployed applications:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/69674e79-0231-4d59-afc4-265f7df74255.png" style="width:52.00em;height:13.58em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deploying an application through the command line</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">There are two ways in which an application can be deployed through the command line: it can be done by copying the artifact we want to deploy to an</span> <kbd>autodeploy</kbd> <span class="NormalPACKTChar">directory or by using GlassFish's</span> <kbd><span class="CommandLinePACKTChar">asadmin</span></kbd> <span class="NormalPACKTChar">command-line utility.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Autodeploy directory</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Now that we have undeployed the <kbd>simpleapp.war</kbd> file, we are ready to deploy it using the command line. To deploy the application in this manner, simply copy</span> <kbd>simpleapp.war</kbd> <span class="NormalPACKTChar">to</span> <kbd>[glassfish installation directory]/glassfish4/glassfish/domains/domain1/autodeploy</kbd><span class="NormalPACKTChar">. The application will automatically be deployed just by copying it to this directory.</span></p>
<p><span class="NormalPACKTChar">We can verify that the application has successfully been deployed by looking at the server log. The server log can be found at</span> <kbd>[glassfish installation directory]/glassfish4/glassfish/domains/domain1/logs/server.log</kbd><span class="NormalPACKTChar">. The last few lines of this file should look something like this:</span></p>
<pre>    <strong>[2017-11-22T19:02:41.206-0500] [glassfish 5.0] [INFO] [] [javax.enterprise.system.tools.deployment.common] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395361206] [levelValue: 800] [[</strong>
    <strong>  visiting unvisited references]]</strong>
    
    <strong>[2017-11-22T19:02:41.237-0500] [glassfish 5.0] [INFO] [AS-WEB-GLUE-00172] [javax.enterprise.web] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395361237] [levelValue: 800] [[</strong>
    <strong>  Loading application [simpleapp-1.0] at [/simpleapp-1.0]]]</strong>
    
    <strong>[2017-11-22T19:02:41.246-0500] [glassfish 5.0] [INFO] [] [javax.enterprise.system.core] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395361246] [levelValue: 800] [[</strong>
    <strong>  simpleapp-1.0 was successfully deployed in 50 milliseconds.]]</strong>
    
    <strong>[2017-11-22T19:02:41.247-0500] [glassfish 5.0] [INFO] [NCLS-DEPLOYMENT-02035] [javax.enterprise.system.tools.deployment.autodeploy] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395361247] [levelValue: 800] [[</strong>
    <br/>  <strong>[AutoDeploy] Successfully autodeployed : /home/heffel/glassfish-5/glassfish5/glassfish/domains/domain1/autodeploy/simpleapp-1.0.war.]]
  </strong></pre>
<p><span class="NormalPACKTChar">We can, of course, also verify the deployment by navigating to the URL for the application, which will be the same one we used when deploying through the web console,</span> <kbd><span class="InternetLink">http://localhost:8080/simpleapp/simpleservlet</span></kbd><span class="URLPACKT">,</span> <span class="NormalPACKTChar">the application should execute properly.</span></p>
<p><span class="NormalPACKTChar">An application deployed this way can be undeployed by simply deleting the artifact (the WAR file, in our case) from the <kbd>autodeploy</kbd> directory. After deleting the file, we should see a message similar to the following in the server log:</span></p>
<pre>    <strong>[2017-11-22T19:04:23.198-0500] [glassfish 5.0] [INFO] [NCLS-DEPLOYMENT-02026] [javax.enterprise.system.tools.deployment.autodeploy] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395463198] [levelValue: 800] [[</strong>
    <strong>  Autoundeploying application:  simpleapp-1.0]]</strong>
    
    <strong>[2017-11-22T19:04:23.218-0500] [glassfish 5.0] [INFO] [NCLS-DEPLOYMENT-02035] [javax.enterprise.system.tools.deployment.autodeploy] [tid: _ThreadID=91 _ThreadName=AutoDeployer] [timeMillis: 1511395463218] [levelValue: 800] [[</strong>
    <strong>  [AutoDeploy] Successfully autoundeployed : /home/heffel/glassfish-5/glassfish5/glassfish/domains/domain1/autodeploy/simpleapp-1.0.war.]]</strong>
  </pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The asadmin command-line utility</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">An alternate way of deploying an application through the command line is to use the following command:</span></p>
<pre><strong><span class="NormalPACKTChar">asadmin deploy [path to file]/simpleapp-1.0.war</span></strong></pre>
<div class="packt_infobox">The preceding command must be run from the <span class="CommandLinePACKTChar"><kbd>[glassfish installation directory]/glassfish4/bin</kbd></span>.</div>
<p><span class="NormalPACKTChar">We should see confirmation on the command-line terminal letting us know that the file was deployed successfully:</span></p>
<pre><strong>Application deployed with name simpleapp-1.0.</strong>
    <br/><strong>Command deploy executed successfully.</strong></pre>
<p><span class="NormalPACKTChar">The server log file should show a message similar to the following:</span></p>
<pre>    <strong>[2017-11-22T19:06:36.342-0500] [glassfish 5.0] [INFO] [AS-WEB-GLUE-00172] [javax.enterprise.web] [tid: _ThreadID=128 _ThreadName=admin-listener(6)] [timeMillis: 1511395596342] [levelValue: 800] [[</strong>
    <strong>  Loading application [simpleapp-1.0] at [/simpleapp-1.0]]]</strong>
    
    <strong>[2017-11-22T19:06:36.349-0500] [glassfish 5.0] [INFO] [] [javax.enterprise.system.core] [tid: _ThreadID=128 _ThreadName=admin-listener(6)] [timeMillis: 1511395596349] [levelValue: 800] [[</strong>
    <br/> <strong> simpleapp-1.0 was successfully deployed in 51 milliseconds.]]
  </strong></pre>
<p><span class="NormalPACKTChar">The <kbd>asadmin</kbd> executable can be used to undeploy an application as well by issuing a command like the following:</span></p>
<pre><strong>asadmin undeploy simpleapp-1.0</strong></pre>
<p><span class="NormalPACKTChar">The following message should be shown at the bottom of the terminal window:</span></p>
<pre><strong>[2017-11-22T19:06:36.349-0500] [glassfish 5.0] [INFO] [] [javax.enterprise.system.core] [tid: _ThreadID=128 _ThreadName=admin-listener(6)] [timeMillis: 1511395596349] [levelValue: 800] [[</strong><br/><strong>simpleapp-1.0 was successfully deployed in 51 milliseconds.]]</strong></pre>
<p><span class="NormalPACKTChar">Please note that the file extension is not used to undeploy the application, the argument to <kbd>asadmin</kbd> undeploy should be the application name, which defaults to the WAR file name (minus the extension).</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">GlassFish domains</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Alert readers might have noticed that the</span> <kbd>autodeploy</kbd> <span class="NormalPACKTChar">directory is under a</span> <kbd>domains/domain1</kbd> <span class="NormalPACKTChar">subdirectory. GlassFish has a concept of</span> <strong>domains</strong>. <span class="NormalPACKTChar">Domains allow a collection of related applications to be deployed together. Several domains can be started concurrently. GlassFish domains behave like individual GlassFish instances, a default domain called <kbd>domain1</kbd> is created when installing GlassFish.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating domains</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Additional domains can be created from the command line by issuing the following command:</span></p>
<pre><strong><span class="CommandLinePACKTChar">asadmin create-domain domainname</span></strong> </pre>
<p><span class="NormalPACKTChar">The preceding command takes several parameters to specify ports where the domain will listen for several services (HTTP, Admin, JMS, IIOP, secure HTTP, and so on); type the following command in the command line to see its parameters:</span></p>
<pre><strong><span class="NormalPACKTChar">asadmin create-domain --help</span><br/></strong></pre>
<p><span class="NormalPACKTChar">If we want several domains to execute concurrently on the same server, these ports must be chosen carefully since specifying the same ports for different services (or even the same service across domains) will prevent one of the domains from working properly.</span></p>
<p><span class="NormalPACKTChar">The default ports for the default <kbd>domain1</kbd> domain are listed in the following table:</span></p>
<table class="table">
<tbody>
<tr>
<td>
<p><strong>Service</strong></p>
</td>
<td>
<p><strong>Port</strong></p>
</td>
</tr>
<tr>
<td>
<p>Admin</p>
</td>
<td>
<p>4848</p>
</td>
</tr>
<tr>
<td>
<p>HTTP</p>
</td>
<td>
<p>8080</p>
</td>
</tr>
<tr>
<td>
<p>Java Messaging System (JMS)</p>
</td>
<td>
<p>7676</p>
</td>
</tr>
<tr>
<td>
<p>Internet Inter-ORB Protocol (IIOP)</p>
</td>
<td>
<p>3700</p>
</td>
</tr>
<tr>
<td>
<p>Secure HTTP (HTTPS)</p>
</td>
<td>
<p>8181</p>
</td>
</tr>
<tr>
<td>
<p>Secure IIOP</p>
</td>
<td>
<p>3820</p>
</td>
</tr>
<tr>
<td>
<p>Mutual Authorization IIOP</p>
</td>
<td>
<p>3920</p>
</td>
</tr>
<tr>
<td>
<p>Java Management Extensions (JMX) Administration</p>
</td>
<td>
<p>8686</p>
</td>
</tr>
</tbody>
</table>
<p>Please note that when creating a domain, the only port that needs to be specified is the admin port, if other ports are not specified, the default ports listed in the table will be used. Care must be taken when creating a domain, since, as explained above, two domains cannot run concurrently in the same server if any of their services listen for connections on the same port.</p>
<p>An alternate method of creating a domain without having to specify ports for every service is to issue the following command:</p>
<pre><strong>asadmin create-domain --portbase [port number] domainname</strong></pre>
<p>The value of the <kbd>--portbase</kbd> <span class="NormalPACKTChar">parameter dictates the base port for the domain; ports for the different services will be offsets of the given port number. The following table lists the ports assigned to all the different services:</span></p>
<table class="table">
<tbody>
<tr>
<td>
<p><strong>Service</strong></p>
</td>
<td>
<p><strong>Port</strong></p>
</td>
</tr>
<tr>
<td>
<p>Admin</p>
</td>
<td>
<p>portbase + 48</p>
</td>
</tr>
<tr>
<td>
<p>HTTP</p>
</td>
<td>
<p>portbase + 80</p>
</td>
</tr>
<tr>
<td>
<p>Java Messaging System (JMS)</p>
</td>
<td>
<p>portbase + 76</p>
</td>
</tr>
<tr>
<td>
<p>Internet Inter-ORB Protocol (IIOP)</p>
</td>
<td>
<p>portbase + 37</p>
</td>
</tr>
<tr>
<td>
<p>Secure HTTP (HTTPS)</p>
</td>
<td>
<p>portbase + 81</p>
</td>
</tr>
<tr>
<td>
<p>Secure IIOP</p>
</td>
<td>
<p>portbase + 38</p>
</td>
</tr>
<tr>
<td>
<p>Mutual Authorization IIOP</p>
</td>
<td>
<p>portbase + 39</p>
</td>
</tr>
<tr>
<td>
<p>Java Management Extensions (JMX) Administration</p>
</td>
<td>
<p>portbase + 86</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Of course, care must be taken when choosing the value for portbase, making sure that none of the assigned ports collide with any other domain.</p>
<p>As a rule of thumb, creating domains using a portbase number greater than 8000 and divisible by 1000 should create domains that don't conflict with each other, for example, it should be safe to create a domain using a portbase of 9000, another one using a portbase of 10000, so on and so forth.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting domains</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Deleting a domain is very simple, it can be accomplished by issuing the following command in the command line:</span></p>
<pre><strong><span class="NormalPACKTChar">asadmin delete-domain domainname</span><br/></strong></pre>
<p><span class="NormalPACKTChar">We should see a message like the following on the terminal window:</span></p>
<pre><strong>Command delete-domain executed successfully.</strong></pre>
<p><span class="NormalPACKTChar">Please use the preceding command with care; once a domain is deleted, it cannot be easily recreated (all deployed applications will be gone, as well as any connection pools, datasources, and so on).</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Stopping a domain</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">A domain that is running can be stopped by issuing the following command:</span></p>
<pre><strong><span class="NormalPACKTChar">asadmin stop-domain domainname</span><br/></strong></pre>
<p><span class="NormalPACKTChar">This command will stop the domain named <kbd>domainname</kbd>.</span></p>
<p><span class="NormalPACKTChar">If only one domain is running, the</span> <kbd>domainname</kbd> <span class="NormalPACKTChar">argument is optional.</span></p>
<div class="packt_infobox"><span class="NormalPACKTChar">This book assumes the reader is working with the default domain called <kbd>domain1</kbd> and the default ports. If this is not the case, the instructions given need to be modified to match the appropriate domain and port.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up database connectivity</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Any non-trivial Java EE application will connect to a Relational Database Management Server (RDBMS). Supported RDBMS systems include JavaDB, Oracle, Derby, Sybase, DB2, Pointbase, MySQL, PostgreSQL, Informix, Cloudscape, and SQL Server. In this section, we will demonstrate how to set up GlassFish to communicate with a MySQL database, the procedure is similar for other RDBMS systems.</span></p>
<div class="packt_infobox"><span class="NormalPACKTChar">GlassFish comes bundled with an RDBMS called JavaDB. This RDBMS is based on Apache Derby. To limit the downloads and configuration needed to follow this book's code, most examples needing an RDBMS use the bundled JavaDB RDBMS. The instructions in this section are for illustrating how to connect GlassFish to a third party RDBMS.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up connection pools</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Opening and closing database connections is a relatively slow operation. For performance reasons, GlassFish and other Java EE application servers keep a pool of open database connections. When a deployed application requires a database connection, one is provided from the pool, when the application no longer needs the database connection, said connection is returned to the pool.</span></p>
<p><span class="NormalPACKTChar">The first step to follow when setting up a connection pool is to copy the JAR file containing the JDBC driver for our RDBMS in the</span> <kbd>lib</kbd> <span class="NormalPACKTChar">directory of the domain (consult your RDBMS documentation for information on where to obtain this JAR file). If the GlassFish domain where we want to add the connection pool is running when copying the JDBC driver, it must be restarted for the change to take effect. The domain can be restarted by executing</span> <kbd>asadmin restart-domain</kbd><span class="NormalPACKTChar">.</span></p>
<p><span class="NormalPACKTChar">Once the JDBC driver has been copied to the appropriate location and the application server has been restarted, log in to the admin console by pointing the browser to</span> <kbd><span class="InternetLink">http://localhost:4848</span></kbd> <span class="NormalPACKTChar">.</span></p>
<p><span class="NormalPACKTChar">Then click</span> <span class="packt_screen">Resources|JDBC|JDBC Connection Pools</span><span class="NormalPACKTChar">, the browser should now look something like this:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/0803e2a0-e32d-44d5-a3bd-1460f84af583.png" style="width:57.33em;height:17.50em;"/></div>
<p class="mce-root CDPAlignLeft CDPAlign"><span class="NormalPACKTChar">Click the</span> <span class="packt_screen">New...</span> <span class="NormalPACKTChar">button; after entering the appropriate values for our RDBMS, the main area of the page should look something like this:</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/5db315c0-d3f9-48d6-8141-677eabae7213.png" style="width:40.50em;height:17.58em;"/></div>
<p><span class="NormalPACKTChar">After clicking the</span> <span class="packt_screen">Next</span> <span class="NormalPACKTChar">button, we should see a page like the following:</span></p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/e1b6ae96-fd60-4c92-a897-00c88bfee4f7.png" style="width:41.83em;height:28.75em;"/></div>
<p class="mce-root CDPAlignLeft CDPAlign"><span class="NormalPACKTChar">Most of the default values on the top portion of this page are sensible.</span> <span class="MsoCommentReference">S</span><span class="NormalPACKTChar">croll all the way down and enter the appropriate property values for our RDBMS (at a minimum, username, password, and URL), then click the</span> <span class="packt_screen">Finish</span> <span class="NormalPACKTChar">button at the top right of the screen.</span></p>
<p><span class="NormalPACKTChar">Property names vary depending on the RDBMS we are using, but usually, there is a URL property where we should enter the JDBC URL for our database, plus username and password properties where we should enter authentication credentials for our database.</span></p>
<p><span class="NormalPACKTChar">Our newly-created connection pool should now be visible in the list of connection pools:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/d1793281-a688-4e71-9327-b2aa07594c06.png" style="width:55.92em;height:18.25em;"/></div>
<p><span class="NormalPACKTChar">In some cases, the GlassFish domain may need to be restarted after setting up a new connection pool.</span></p>
<p><span class="NormalPACKTChar">We can verify that our connection pool was successfully set up by clicking its</span> <span class="packt_screen">Pool Name</span><span class="NormalPACKTChar">, then clicking the</span> <span class="packt_screen">Ping</span> <span class="NormalPACKTChar">button on the resulting page:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/ac013cf0-b60c-4abb-b33d-17ec205dd728.png" style="width:54.42em;height:35.92em;"/></div>
<p><span class="NormalPACKTChar">Our connection pool is now ready to be used by our applications.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up data sources</h1>
                </header>
            
            <article>
                
<p><span class="NormalPACKTChar">Java EE applications don't access connection pools directly, instead, they access a data source that points to a connection pool. To set up a new data source, click the</span> <span class="packt_screen">JDBC Resources</span> <span class="NormalPACKTChar">menu item on the left-hand side of the web console, then click the</span> <span class="packt_screen">New...</span> <span class="NormalPACKTChar">button.</span></p>
<p><span class="NormalPACKTChar">After filling out the appropriate information for our new data source, the main area of the web console should look something like this:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/c1aa1ae4-f510-441f-9c13-4d1056883aa4.png" style="width:53.17em;height:25.75em;"/></div>
<p><span class="NormalPACKTChar">After clicking the</span> <span class="packt_screen">OK</span> <span class="NormalPACKTChar">button, we can see our newly created data source:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/95fd10b8-6d0b-472a-a9b5-2e6aa84c51c4.png" style="width:53.08em;height:17.58em;"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting JMS resources</h1>
                </header>
            
            <article>
                
<p>Before we can start writing code to take advantage of the JMS API, we need to configure some GlassFish resources. Specifically, we need to set up a <strong>JMS Connection Factory</strong>, a <strong>message queue</strong>, and a <strong>message topic</strong>.</p>
<div class="packt_infobox">Java EE 7 and Java EE 8 require all compliant application servers to provide a default JMS connection factory. GlassFish, being a fully compliant Java EE 8 application server (and the Java EE 8 reference implementation), complies with this requirement, so, strictly speaking, we don't really need to set up a connection factory. In many cases we may need to set one up, therefore in the following section, we illustrate how it can be done.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up a JMS connection factory</h1>
                </header>
            
            <article>
                
<p>The easiest way to set up a JMS connection factory is via GlassFish's web console. As previously mentioned from, <a href="fe161634-abd6-4ffc-9b5a-1e1b82cb0fe1.xhtml" target="_blank">Chapter 1</a>, <em>Introduction to Java EE</em>, that the web console can be accessed by starting our domain by entering the following command on the command line:</p>
<pre><strong>asadmin start-domain domain1</strong> </pre>
<p>We can then point the browser to <kbd><span class="URLPACKT">http://localhost:4848</span></kbd> <span class="WW-DefaultParagraphFont">and log in:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/b33c9d3f-7df1-40f5-95a4-1cfcd04eb594.png" style="width:64.17em;height:31.25em;"/></div>
<p><span class="WW-DefaultParagraphFont">A connection factory can be added by expanding the</span> <span class="packt_screen">Resources</span> <span class="WW-DefaultParagraphFont">node in the tree at the left-hand side of the web console, expanding the</span> <span class="packt_screen">JMS Resources</span> <span class="WW-DefaultParagraphFont">node and clicking the</span> <span class="packt_screen">Connection Factories</span> <span class="WW-DefaultParagraphFont">node, then clicking the</span> <span class="packt_screen">New...</span> <span class="WW-DefaultParagraphFont">button in the main area of the web console:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/842e41f4-5ab2-4e97-b4fd-296d5c724dd0.png" style="width:41.67em;height:41.08em;"/></div>
<p><span class="WW-DefaultParagraphFont">For our purposes, we can take most of the defaults; the only thing we need to do is enter a</span> <span class="packt_screen">Pool Name</span> <span class="WW-DefaultParagraphFont">and pick a resource type for our connection factory.</span></p>
<div class="packt_infobox"><span class="WW-DefaultParagraphFont">It is always a good idea to use a pool name starting with <kbd>jms/</kbd> when picking a name for JMS resources. This way, JMS resources can be easily identified when browsing a JNDI tree.</span></div>
<p><span class="WW-DefaultParagraphFont">In the text field labeled</span> <span class="packt_screen">JNDI Name</span><span class="WW-DefaultParagraphFont">, enter</span> <kbd>jms/GlassFishBookConnectionFactory</kbd><span class="WW-DefaultParagraphFont">. </span></p>
<p><span class="WW-DefaultParagraphFont">The</span> <span class="packt_screen">Resource Type</span> <span class="WW-DefaultParagraphFont">drop-down has three options:</span></p>
<ul>
<li><kbd>javax.jms.TopicConnectionFactory</kbd>: Used to create a connection factory that creates JMS topics for JMS clients using the pub/sub messaging domain</li>
<li><kbd>javax.jms.QueueConnectionFactory</kbd>: U<span class="WW-DefaultParagraphFont">sed to create a connection factory that creates JMS queues for JMS clients using the PTP messaging domain</span></li>
<li><kbd>javax.jms.ConnectionFactory</kbd>: U<span class="WW-DefaultParagraphFont">sed to create a connection factory that creates either JMS topics or JMS queues</span></li>
</ul>
<p><span class="WW-DefaultParagraphFont">For our example, we will select</span> <kbd>javax.jms.ConnectionFactory</kbd><span class="WW-DefaultParagraphFont">; this way we can use the same connection factory for all of our examples, those using the PTP messaging domain, and those using the pub/sub messaging domain.</span></p>
<p><span class="WW-DefaultParagraphFont">After entering the</span> <span class="packt_screen">Pool Name</span> <span class="WW-DefaultParagraphFont">for our connection factory, selecting a connection factory type and, optionally, entering a description for our connection factory, we must click the</span> <span class="packt_screen">OK</span> <span class="WW-DefaultParagraphFont">button for the changes to take effect:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/f8e9df00-6f3d-49ef-8cab-ed6469c9b550.png" style="width:54.83em;height:14.75em;"/></div>
<p><span class="WW-DefaultParagraphFont">We should then see our newly-created connection factory listed in the main area of the GlassFish web console.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up a JMS message queue</h1>
                </header>
            
            <article>
                
<p><span class="WW-DefaultParagraphFont">A JMS message queue can be added by expanding the</span> <span class="packt_screen">Resources</span> <span class="WW-DefaultParagraphFont">node in the tree at the left-hand side of the web console, expanding the</span> <span class="packt_screen">JMS Resources</span> <span class="WW-DefaultParagraphFont">node and clicking the</span> <span class="packt_screen">Destination Resources</span> <span class="WW-DefaultParagraphFont">node, then clicking the</span> <span class="packt_screen">New...</span> <span class="WW-DefaultParagraphFont">button in the main area of the web console:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/34c1a572-761b-4df6-9068-68805973053d.png"/></div>
<p><span class="WW-DefaultParagraphFont">In our example, the JNDI name of the message queue is</span> <kbd>jms/GlassFishBookQueue</kbd><span class="WW-DefaultParagraphFont">. The resource type for message queues must be</span> <kbd>javax.jms.Queue</kbd><span class="WW-DefaultParagraphFont">. Additionally, a</span> <span class="packt_screen">Physical Destination Name</span> <span class="WW-DefaultParagraphFont">must be entered. In the preceding example, we use</span> <kbd>GlassFishBookQueue</kbd> <span class="WW-DefaultParagraphFont">as the value for this field.</span></p>
<p><span class="WW-DefaultParagraphFont">After clicking the</span> <span class="packt_screen">New...</span> <span class="WW-DefaultParagraphFont">button, entering the appropriate information for our message queue, and clicking</span> <span class="packt_screen">OK</span>, <span class="WW-DefaultParagraphFont">we should see the newly created queue:</span></p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/0559c254-e894-42a6-b6ab-e490a9712660.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up a JMS message topic</h1>
                </header>
            
            <article>
                
<p>Setting up a JMS message topic in GlassFish is very similar to setting up a message queue.</p>
<p>In the GlassFish web console, expand the <span class="packt_screen">Resources</span> node in the tree at the left-hand side, then expand the <span class="packt_screen">JMS Resouces</span> node, click the <span class="packt_screen">Destination</span> node, then click the <span class="packt_screen">New...</span> button in the main area of the web console:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/53c80bf0-f458-4b60-8818-d0c8925557fd.png"/></div>
<p>Our examples will use a <span class="packt_screen">JNDI Name</span> of <kbd>jms/GlassFishBookTopic</kbd>. Since this is a message topic, the <span class="packt_screen">Resource Type</span> must be <kbd>javax.jms.Topic</kbd>. The <span class="packt_screen">Description</span> field is optional. The <span class="packt_screen">Physical Destination Name</span> property is required; for our example, we will use <kbd>GlassFishBookTopic</kbd> as the value for the <span class="packt_screen">Name</span> property.</p>
<p>After clicking the <span class="packt_screen">OK</span> button, we can see our newly created message topic:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/6ef4f7d0-623b-4fdc-8e74-62ff6fd1f689.png" style="width:63.92em;height:17.67em;"/></div>
<p>Now that we have set up a connection factory, a message queue, and a message topic, we are ready to start writing code using the JMS API.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Configuring durable subscribers</h1>
                </header>
            
            <article>
                
<p>Like we mentioned before, the easiest way to add a connection factory is through the GlassFish web console. Recall that, to add a JMS connection factory through the GlassFish web console, we need to expand the <span class="packt_screen">Resources</span> node on the left-hand side, then expand the <span class="packt_screen">JMS Resources</span> node, click the <span class="packt_screen">Connection Factories</span> node, then click the <span class="packt_screen">New...</span> button in the main area of the page. Our next example will use the settings displayed in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class=" image-border" src="assets/2fb6ce47-b5f4-48a2-afc5-436e6af7422d.png" style="width:40.42em;height:14.75em;"/></div>
<p>Before clicking the <span class="packt_screen">OK</span> button, we need to scroll to the bottom of the page, click the <span class="packt_screen">Add Property</span> button, and enter a new property named <kbd>ClientId</kbd>. Our example will use <kbd>ExampleId</kbd> as the value for this property:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d1f08e8b-23ed-4028-b6e8-720b2be7dd98.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this appendix, we discussed how to download and install GlassFish. We also discussed several methods of deploying the Java EE application through the GlassFish web console, through the <kbd>asadmin</kbd> command and by copying the file to the <kbd>autodeploy</kbd> directory. We also discussed basic GlassFish administration tasks, such as setting up domains and setting up database connectivity by adding connection pools and data sources.</p>


            </article>

            
        </section>
    </body></html>