<html><head></head><body><div class="chapter" title="Chapter&#xA0;12.&#xA0;Facelets Templating"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter 12. Facelets Templating</h1></div></div></div><p>In this chapter, we will cover several aspects of Facelets templating and some related aspects.</p><p>JSF is defined as a component-based application development framework. When we say Facelets, we mean friendly page development, reusability of code, templating, composition components, custom logic tags, expression functions, high-performance rendering, optimized compilation time, and so on. But what actually is Facelets? Well, Facelets represents a<a id="id1433" class="indexterm"/> <span class="strong"><strong>VDL</strong></span> (<span class="strong"><strong>View Declaration Language</strong></span>), and initially, it was created as an alternative to JSP. During JSF 1.1 and 1.2, this view handler can be used only after a separate download and configuration, while JSP was the default view handler. Things started to change with JSF 2.0, when the mismatch between JSF and JSP allowed Facelets to become the standard and default VDL, while JSP was deprecated. Starting with JSF 2.2, this concept was seriously fortified and Facelets was boosted with new features and capabilities.</p><div class="section" title="A brief overview of the Facelets tags"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec98"/>A brief overview of the Facelets tags</h1></div></div></div><p><span class="strong"><strong>Templating</strong></span><a id="id1434" class="indexterm"/> is a concept based on code reusability. Templates, or tiles, represent the portions of reusable code<a id="id1435" class="indexterm"/> that can be puzzled together to obtain JSF pages. In order to accomplish this, we exploit a handful of tags from <a class="ulink" href="http://xmlns.jcp.org/jsf/facelets">http://xmlns.jcp.org/jsf/facelets</a> namespace.</p><p>Usually, prefixed with <code class="literal">ui</code>, these tags are listed as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:composition&gt;</code> tag (<code class="literal">TagHandler</code>): This defines a page composition that<a id="id1436" class="indexterm"/> can use a template (any content outside of this tag is ignored). The <code class="literal">template</code> attribute is optional <a id="id1437" class="indexterm"/>and is used for indicating a template to which the enclosed content should be applied. Multiple compositions can use the same template, thus encapsulating and reusing the layout. Facelets will paste the enclosed content into the component's hierarchy, usually under <code class="literal">UIViewRoot</code>. The <code class="literal">&lt;ui:composition&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:composition template="<span class="emphasis"><em>template_path</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:define&gt;</code> tag (<code class="literal">TagHandler</code>): This defines the content that is inserted into<a id="id1438" class="indexterm"/> a page by a template. It may appear<a id="id1439" class="indexterm"/> in the <code class="literal">&lt;ui:composition&gt;</code>, <code class="literal">&lt;ui:component&gt;</code>, <code class="literal">&lt;ui:decorate&gt;</code>, and <code class="literal">&lt;ui:fragment&gt;</code> tags and it has a matching <code class="literal">&lt;ui:insert&gt;</code> tag, which is capable of inserting the defined content into a page. Most commonly, it appears in the <code class="literal">&lt;ui:composition&gt;</code> tag. The <code class="literal">&lt;ui:define&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:define name="<span class="emphasis"><em>ui_insert_name</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:insert&gt;</code> tag (<code class="literal">TagHandler</code>): This inserts the content into a template. Usually, that <a id="id1440" class="indexterm"/>content is defined by <a id="id1441" class="indexterm"/>the <code class="literal">&lt;ui:define&gt;</code> tag in a <code class="literal">&lt;ui:composition&gt;</code>, <code class="literal">&lt;ui:component&gt;</code>, <code class="literal">&lt;ui:decorate&gt;</code>, or <code class="literal">&lt;ui:fragment&gt;</code> tag. This tag indicates the exact place where the content will be inserted. When the <code class="literal">name</code> attribute is missing, Facelets will add the body content of this tag to the view. The <code class="literal">&lt;ui:insert&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:insert name="<span class="emphasis"><em>ui_insert_name</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:include&gt;</code> tag (<code class="literal">TagHandler</code>): This is used to encapsulate and reuse content from multiple<a id="id1442" class="indexterm"/> pages. The included content<a id="id1443" class="indexterm"/> can be plain XHTML and XHTML pages that have either a <code class="literal">&lt;ui:composition&gt;</code> tag or a <code class="literal">&lt;ui:component&gt;</code> tag. This tag can be easily combined with <code class="literal">&lt;ui:param&gt;</code> to provide parameters to the included pages, but is also combined with the <code class="literal">&lt;ui:fragment&gt;</code>, <code class="literal">&lt;ui:decorate&gt;</code>, and <code class="literal">&lt;ui:insert&gt;</code> tags. This is one of the most used tags since it sustains the idea of reusing templated code. The <code class="literal">&lt;ui:include&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:include src="<span class="emphasis"><em>filename_to_include_path</em></span>"&gt;</pre></div><p>Starting with JSF 2.2, the <code class="literal">UIViewRoot.restoreViewScopeState(FacesContext context, Object state)</code> method was added to allow the use of view scoped beans for EL expressions in the template from which the component tree is built. This means that the following code is useful:</p><div class="informalexample"><pre class="programlisting">&lt;ui:include src="#{<span class="emphasis"><em>viewScopedBean.includeFileName</em></span>}"/&gt; </pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:param&gt;</code> tag (<code class="literal">TagHandler</code>): This passes parameters to an included file or a<a id="id1444" class="indexterm"/> template. It is<a id="id1445" class="indexterm"/> used in the <code class="literal">&lt;ui:include&gt;</code>, <code class="literal">&lt;ui:composition&gt;</code>, or <code class="literal">&lt;ui:decorate&gt;</code> tags. A parameter is characterized by a name-value pair—both can be string literals or EL expressions. In the included file or template, the parameter is available via EL. The <code class="literal">&lt;ui:param&gt;</code> tag is used in the following<a id="id1446" class="indexterm"/> manner:<div class="informalexample"><pre class="programlisting">&lt;ui:param name="<span class="emphasis"><em>param_name</em></span>" value="<span class="emphasis"><em>param_value</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:repeat&gt;</code> tag (<code class="literal">ComponentHandler</code>): This is used as an alternative for loop tags<a id="id1447" class="indexterm"/> such as <code class="literal">&lt;c:forEach&gt;</code> and <code class="literal">&lt;h:dataTable&gt;</code>. Since <code class="literal">&lt;ui:repeat&gt;</code> is a<a id="id1448" class="indexterm"/> component handler, while <code class="literal">&lt;c:forEach&gt;</code> is a tag handler, you have to pay attention when you choose between them! The <code class="literal">&lt;ui:repeat&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="<span class="emphasis"><em>some_collection</em></span>" var="<span class="emphasis"><em>var_name</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:debug&gt;</code> tag (<code class="literal">ComponentHandler</code>): This defines a debug component in the component tree<a id="id1449" class="indexterm"/> capable to capture debugging information<a id="id1450" class="indexterm"/> such as component tree, scoped variables, and view state. By default, this information appears in a debug pop-up window when you press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>D</em></span> (in Windows OS). You can alter the <span class="emphasis"><em>D</em></span> key by explicitly setting another keyboard using the optional <code class="literal">hotkey</code> attribute. The <code class="literal">&lt;ui:debug&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:debug hotkey="<span class="emphasis"><em>key</em></span>" /&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:component&gt;</code> tag (<code class="literal">ComponentHandler</code>): This is similar to <code class="literal">&lt;ui:composition&gt;</code>, only <a id="id1451" class="indexterm"/>that it defines a component <a id="id1452" class="indexterm"/>directly into the component tree without an associated template. The <code class="literal">&lt;ui:component&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:component&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:fragment&gt;</code> tag (<code class="literal">ComponentHandler</code>): Again, this is similar to <code class="literal">&lt;ui:component&gt;</code> tag, but doesn't ignore the content outside this tag. Its main skill consists<a id="id1453" class="indexterm"/> of the <code class="literal">rendered</code> attribute, which is<a id="id1454" class="indexterm"/> very useful for deciding if the enclosed content will be displayed or not. This tag doesn't produce client-side effects, which makes it a great alternative to <code class="literal">&lt;h:panelGroup&gt;</code>, which has the client side effect of producing the <code class="literal">&lt;span&gt;</code> or <code class="literal">&lt;div&gt;</code> tags. If you want to work with <code class="literal">&lt;h:panelGroup&gt;</code> without producing the <code class="literal">&lt;span&gt;</code> or <code class="literal">&lt;div&gt;</code> tags, then skip adding an explicit ID to it. An <code class="literal">&lt;h:panelGroup&gt;</code> tag produces a <code class="literal">&lt;span&gt;</code> tag if it has an explicit ID, and a <code class="literal">&lt;div&gt;</code> tag if it has an explicit ID and the value of the <code class="literal">layout</code> attribute set to the <code class="literal">block</code> value. The <code class="literal">&lt;ui:fragment&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:fragment&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:decorate&gt;</code> tag (<code class="literal">TagHandler</code>): This is similar to the <code class="literal">&lt;ui:composition&gt;</code> tag, but doesn't ignore the content outside this tag. This is a nice<a id="id1455" class="indexterm"/> feature, since it<a id="id1456" class="indexterm"/> allows us to apply any element in the page to a template. The <code class="literal">template</code> attribute is mandatory. The <code class="literal">&lt;ui:decorate&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:decorate template="<span class="emphasis"><em>template_path</em></span>"&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The <code class="literal">&lt;ui:remove&gt;</code> tag: This<a id="id1457" class="indexterm"/> removes the content <a id="id1458" class="indexterm"/>from a page. The <code class="literal">&lt;ui:remove&gt;</code> tag is used in the following manner:<div class="informalexample"><pre class="programlisting">&lt;ui:remove&gt;</pre></div></li></ul></div><p>You can read about further <a id="id1459" class="indexterm"/>details of these tags at <a class="ulink" href="http://docs.oracle.com/javaee/7/javaserverfaces/2.2/vdldocs/facelets/ui/tld-summary.html">http://docs.oracle.com/javaee/7/javaserverfaces/2.2/vdldocs/facelets/ui/tld-summary.html</a>.</p></div></div>
<div class="section" title="Creating a simple template &#x2013; PageLayout"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec99"/>Creating a simple template – PageLayout</h1></div></div></div><p>When these eleven<a id="id1460" class="indexterm"/> tags combine their skills, we can create amazing templates. For example, let's suppose that we want to create the template from the following diagram and we name it <code class="literal">PageLayout</code>:</p><div class="mediaobject"><img src="graphics/6466EN_12_01.jpg" alt="Creating a simple template – PageLayout"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note186"/>Note</h3><p>Notice that with just a few clicks, NetBeans can generate the code behind several templates of Facelets, including the preceding abstractization. But, this time we will write it manually, in order to exemplify the Facelets tags. While NetBeans provides a compact code, based on a single XHTML page, we will write an expanded approach using six XHTML pages. In this way, you will have two ways of writing this kind of template.</p></div></div><p>As you can see, there are five distinctive sections: <span class="strong"><strong>Header</strong></span>, <span class="strong"><strong>Footer</strong></span>, <span class="strong"><strong>Left</strong></span>, <span class="strong"><strong>Center</strong></span>, and <span class="strong"><strong>Right</strong></span>. For each of these sections, we will write a separate XHTML page. The header is generated in the <code class="literal">topDefault.xhtml</code> page, that simply uses the <code class="literal">&lt;ui:composition&gt;</code> tag to provide the default content as follows:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8' ?&gt; 
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html 
<span class="strong"><strong>  </strong></span>
  &gt;

  &lt;h:body&gt;
    &lt;ui:composition&gt;
      &lt;h1&gt;This is default header&lt;/h1&gt;
    &lt;/ui:composition&gt;
  &lt;/h:body&gt;
&lt;/html&gt;</pre></div><p>The same approach can be<a id="id1461" class="indexterm"/> used for the remaining four sections. Just replace the default header text and create the following XHTMLs: <code class="literal">bottomDefault.xhtml</code> for the footer, <code class="literal">contentDefault.xhtml</code> for the center, <code class="literal">leftDefault.xhtml</code> for the left-hand side, and <code class="literal">rightDefault.xhtml</code> for the right-hand side.</p><p>These five XHTMLs are like five pieces of the puzzle and they serve as the default content for our template. Now, we can compose the puzzle (this is known as the template file or simply the template) by writing an XHTML page that uses the <code class="literal">&lt;ui:insert&gt;</code> and <code class="literal">&lt;ui:include&gt;</code> tags as shown in the following code—this is <code class="literal">layout.xhtml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8' ?&gt; 
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html 
  
  &gt;

  &lt;h:head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
    &lt;h:outputStylesheet name="css/default.css"/&gt;
    &lt;h:outputStylesheet name="css/cssLayout.css"/&gt;
    &lt;title&gt;My Template&lt;/title&gt;
  &lt;/h:head&gt;

  &lt;h:body&gt;
    &lt;div id="top"&gt;
      &lt;ui:insert name="top"&gt;
        &lt;ui:include src="/template/default/topDefault.xhtml" /&gt;
      &lt;/ui:insert&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;div id="left"&gt;
        &lt;ui:insert name="left"&gt;
          &lt;ui:include src="/template/default/leftDefault.xhtml" /&gt;
        &lt;/ui:insert&gt;
      &lt;/div&gt;
      &lt;div id="right"&gt;
        &lt;ui:insert name="right"&gt;
          &lt;ui:include src="/template/default/rightDefault.xhtml" /&gt;
        &lt;/ui:insert&gt;
      &lt;/div&gt;
      &lt;div id="content"&gt;
        &lt;ui:insert name="content"&gt;
          &lt;ui:include src="/template/default/contentDefault.xhtml" /&gt;
        &lt;/ui:insert&gt;
      &lt;/div&gt;
  &lt;/div&gt;
  &lt;div id="bottom"&gt;
    &lt;ui:insert name="bottom"&gt;
      &lt;ui:include src="/template/default/bottomDefault.xhtml" /&gt;
    &lt;/ui:insert&gt;
  &lt;/div&gt;
 &lt;/h:body&gt;
&lt;/html&gt;</pre></div><p>Each section was<a id="id1462" class="indexterm"/> represented by an <code class="literal">&lt;ui:insert&gt;</code> tag and the default content was included using <code class="literal">&lt;ui:include&gt;</code>. Some <code class="literal">&lt;div&gt;</code> tags and CSS were used for arranging and styling the pieces of the puzzle in the main template file.</p><p>Now, the template, as shown in the following code, is ready to be used in <code class="literal">index.xhtml</code>; this is known as the<a id="id1463" class="indexterm"/> <span class="strong"><strong>template client</strong></span>:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html 
  
  &gt;
  &lt;h:head&gt;
    &lt;title&gt;&lt;/title&gt;
  &lt;/h:head&gt;
  &lt;h:body&gt;
    &lt;ui:composition template="template/layout.xhtml" /&gt;           
  &lt;/h:body&gt;
&lt;/html&gt;</pre></div><p>At this moment, we can alter the default content of our template using the <code class="literal">&lt;ui:define&gt;</code> tag, for example, if we want to replace the text that appears in the center section. This is the default content, with the <span class="strong"><strong>Rafael Nadal Home Page</strong></span> text, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">...
&lt;ui:composition template="template/layout.xhtml"&gt;  
  &lt;ui:define name="content"&gt;
    Rafael Nadal Home Page
  &lt;/ui:define&gt;   
&lt;/ui:composition&gt;
...</pre></div><p>In the same way, you<a id="id1464" class="indexterm"/> can redefine the content for the remaining four sections. The complete application is named <code class="literal">ch12_1</code>.</p><p>This is a pretty simple template that can serve us as support for presenting the rest of Facelets tags. We will continue with several punctual examples for <code class="literal">&lt;ui:param&gt;</code>, <code class="literal">&lt;ui:decorate&gt;</code>, <code class="literal">&lt;ui:fragment&gt;</code>, <code class="literal">&lt;ui:repeat&gt;</code>, and so on.</p></div>
<div class="section" title="Passing parameters via &lt;ui:param&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec100"/>Passing parameters via &lt;ui:param&gt;</h1></div></div></div><p>The <code class="literal">&lt;ui:param&gt;</code> tag is<a id="id1465" class="indexterm"/> a tag handler that is capable of sending parameters to an included file or to a template. A quick example will make<a id="id1466" class="indexterm"/> you understand how <code class="literal">&lt;ui:param&gt;</code> works. In the following code, we are in the template client, <code class="literal">index.xhtml</code>, and we send a parameter to the template file, <code class="literal">layout.xhtml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;ui:composition template="template/layout.xhtml"&gt;  
<span class="strong"><strong>  &lt;ui:param name="playername" value="Rafael " /&gt;</strong></span>
&lt;/ui:composition&gt;</pre></div><p>We can also access this parameter in <code class="literal">layout.xhtml</code> using its name via EL. We can do that anywhere in the template file; for example, we can use this parameter for creating a new parameter to be sent to an included file, in this case, to the <code class="literal">contentDefault.xhtml</code> file, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;div id="content"&gt;
  &lt;ui:insert name="content"&gt;
    &lt;ui:include src="/template/default/contentDefault.xhtml"&gt;
<span class="strong"><strong>      &lt;ui:param name="playernamesurname" value="#{playername} Nadal" /&gt;</strong></span>
    &lt;/ui:include&gt;
  &lt;/ui:insert&gt;
&lt;/div&gt;</pre></div><p>From the same template, we can send parameters to different included pages. Besides the <code class="literal">playernamesurname</code> parameter, let's send one to the <code class="literal">topDefault.xhtml</code> page using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:insert name="top"&gt;
  &lt;ui:include src="/template/default/topDefault.xhtml"&gt;
<span class="strong"><strong>    &lt;ui:param name="headertext" value="This is default header (passed through ui:param)" /&gt;</strong></span>
  &lt;/ui:include&gt;
&lt;/ui:insert&gt;</pre></div><p>Next, send one<a id="id1467" class="indexterm"/> parameter to the <code class="literal">bottomDefault.xhtml</code> page using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:insert name="bottom"&gt;
  &lt;ui:include src="/template/default/bottomDefault.xhtml"&gt;
<span class="strong"><strong>    &lt;ui:param name="footertext" value="This is default footer (passed through ui:param)" /&gt;</strong></span>
  &lt;/ui:include&gt;
&lt;/ui:insert&gt;</pre></div><p>Now, the <code class="literal">playernamesurname</code> parameter<a id="id1468" class="indexterm"/> is accessible via EL in the <code class="literal">contentDefault.xhtml</code> page <a id="id1469" class="indexterm"/>as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:composition&gt;
<span class="strong"><strong>  #{playernamesurname} (passed through ui:param)</strong></span>
&lt;/ui:composition&gt;</pre></div><p>Moreover, <code class="literal">headertext</code> and <code class="literal">footertext</code> are accessible via EL in the <code class="literal">topDefault.xhtml</code> and <code class="literal">bottomDefault.xhtml</code> pages. Now, the result of using <code class="literal">&lt;ui:param&gt;</code> will be as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_02.jpg" alt="Passing parameters via &lt;ui:param&gt;"/></div><p>The complete application is called <code class="literal">ch12_11</code>.</p></div>
<div class="section" title="Passing bean properties and action methods via &lt;ui:param&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec101"/>Passing bean properties and action methods via &lt;ui:param&gt;</h1></div></div></div><p>In the previous example, you saw how to exploit <code class="literal">&lt;ui:param&gt;</code> for sending literal strings to a template or<a id="id1470" class="indexterm"/> included page, but <code class="literal">&lt;ui:param&gt;</code> can be used for more<a id="id1471" class="indexterm"/> than this. Let's suppose<a id="id1472" class="indexterm"/> that we have the following code of the bean, <code class="literal">TemplatesBean</code>:</p><div class="informalexample"><pre class="programlisting">@Named
@ViewScoped
public class TemplatesBean implements Serializable {
    
  private String msgTopDefault="";
  private String msgBottomDefault="";
  private String msgCenterDefault="No center content ...press the below button!";

  //getters and setters
   
  public void topAction(String msg){
    this.msgTopDefault = msg;
  }
    
  public void bottomAction(String msg){
    this.msgBottomDefault = msg;
  }
    
  public void centerAction(){
    this.msgCenterDefault="This is default content";
  }    
}</pre></div><p>Further, we want to <a id="id1473" class="indexterm"/>display the value of the <code class="literal">msgCenterDefault</code> property<a id="id1474" class="indexterm"/> in <code class="literal">contentDefault.xhtml</code>. Of course, this is very easy to accomplish using the following line of code:</p><div class="informalexample"><pre class="programlisting">&lt;h:outputText value=#{templatesBean.msgCenterDefault} /&gt;</pre></div><p>But we want to pass the name of the bean and the name of the property via <code class="literal">&lt;ui:param&gt;</code>. This can be accomplished using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:insert name="content"&gt;
  &lt;ui:include src="/template/default/contentDefault.xhtml"&gt;
<span class="strong"><strong>    &lt;ui:param name="templatesBeanName" value="#{templatesBean}"/&gt;</strong></span>
<span class="strong"><strong>    &lt;ui:param name="contentPropertyName" value="msgCenterDefault"/&gt;</strong></span>
  &lt;/ui:include&gt;
&lt;/ui:insert&gt;</pre></div><p>Next, in <code class="literal">contentDefault.xhtml</code>, you can display the value of the <code class="literal">msgCenterDefault</code> property as shown in the following line of code:</p><div class="informalexample"><pre class="programlisting">&lt;h:outputText value="#{templatesBeanName[contentPropertyName]}"/&gt;</pre></div><p>Well, that was easy! But how about calling<a id="id1475" class="indexterm"/> the <code class="literal">centerAction</code> method, which modifies the value of the <a id="id1476" class="indexterm"/>
<code class="literal">msgCenterDefault</code> property? For this, we add the method name between single quotes, in square brackets, followed by a pair of parentheses indicating a method without arguments, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:form&gt;
  &lt;h:commandButton value="Center Button" action="#{templatesBeanName['centerAction']()}"/&gt;
&lt;/h:form&gt;</pre></div><p>Finally, we want to call the <code class="literal">topAction</code> (or <code class="literal">bottomAction</code>) method. This time, we want to pass via <code class="literal">&lt;ui:param&gt;</code> the<a id="id1477" class="indexterm"/> bean name, action<a id="id1478" class="indexterm"/> method name, and<a id="id1479" class="indexterm"/> the argument value. For this, we will write the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:insert name="top"&gt;
  &lt;ui:include src="/template/default/topDefault.xhtml"&gt;
<span class="strong"><strong>    &lt;ui:param name="templatesBeanName" value="#{templatesBean}"/&gt;</strong></span>
<span class="strong"><strong>    &lt;ui:param name="topActionName" value="topAction"/&gt;                    </strong></span>
<span class="strong"><strong>    &lt;ui:param name="arg" value="Hello from topDefault.xhtml .."/&gt;       </strong></span>
  &lt;/ui:include&gt;
&lt;/ui:insert&gt;</pre></div><p>In <code class="literal">topDefault.xhtml</code>, we<a id="id1480" class="indexterm"/> can exploit the information passed through these three parameters, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:form&gt;
  &lt;h:commandButton value="Top Button" action="#{templatesBeanName[topActionName](arg)}"/&gt;                
&lt;/h:form&gt;</pre></div><p>In the following screenshot, you can see that everything worked as expected:</p><div class="mediaobject"><img src="graphics/6466EN_12_03.jpg" alt="Passing bean properties and action methods via &lt;ui:param&gt;"/></div><p>The complete application is named <code class="literal">ch12_13</code>.</p><p>A <code class="literal">&lt;ui:param&gt;</code> value can<a id="id1481" class="indexterm"/> be accessed <a id="id1482" class="indexterm"/>from a managed bean, as <a id="id1483" class="indexterm"/>shown in<a id="id1484" class="indexterm"/> the following code:</p><div class="informalexample"><pre class="programlisting">FaceletContext faceletContext = (FaceletContext) FacesContext.getCurrentInstance().getAttributes().
    get(FaceletContext.FACELET_CONTEXT_KEY);
String paramValue = (String) faceletContext.getAttribute("param");</pre></div></div>
<div class="section" title="Exploiting the &lt;ui:decorate&gt; and &lt;ui:fragment&gt; tags"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec102"/>Exploiting the &lt;ui:decorate&gt; and &lt;ui:fragment&gt; tags</h1></div></div></div><p>First, let's talk about the <code class="literal">&lt;ui:decorate&gt;</code> tag. As its name suggests, this tag is used for decorating pieces of a page. Unlike <code class="literal">&lt;ui:composition&gt;</code>, this tag doesn't ignore the content that is not<a id="id1485" class="indexterm"/> enclosed in it, which may be an added advantage<a id="id1486" class="indexterm"/> sometimes. Well, a simple<a id="id1487" class="indexterm"/> example is shown in the following code (the <code class="literal">template</code> attribute<a id="id1488" class="indexterm"/> is mandatory):</p><div class="informalexample"><pre class="programlisting">&lt;?xml version='1.0' encoding='UTF-8' ?&gt;
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html 
  
  &gt;

  &lt;h:head&gt;
    &lt;title&gt;&lt;/title&gt;
  &lt;/h:head&gt;
  &lt;h:body&gt;
    &lt;h:outputText value="You can see this header text thanks to ui:decorate!"/&gt;
<span class="strong"><strong>      &lt;ui:decorate template="template/layout.xhtml"&gt;  </strong></span>
<span class="strong"><strong>        &lt;ui:define name="content"&gt;</strong></span>
<span class="strong"><strong>          Rafael Nadal Website</strong></span>
<span class="strong"><strong>        &lt;/ui:define&gt;</strong></span>
<span class="strong"><strong>      &lt;/ui:decorate&gt;</strong></span>
    &lt;h:outputText value="You can see this footer text thanks to ui:decorate!"/&gt;
  &lt;/h:body&gt;
&lt;/html&gt;</pre></div><p>The preceding snippet produces the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_04.jpg" alt="Exploiting the &lt;ui:decorate&gt; and &lt;ui:fragment&gt; tags"/></div><p>The complete<a id="id1489" class="indexterm"/> example is named <code class="literal">ch12_10</code>. Basically, this example decorates a page with a template and proves the effect of the <code class="literal">&lt;ui:decorate&gt;</code> tag against the <code class="literal">&lt;ui:composition&gt;</code> tag. However, let's see a better example of decorating a part of a page.</p><p>In this example, we<a id="id1490" class="indexterm"/> will decorate a <code class="literal">&lt;div&gt;</code> element with an <code class="literal">&lt;ul&gt;</code> list. The items of list <code class="literal">&lt;li&gt;</code> come from two separated pages, and the technique for <a id="id1491" class="indexterm"/>accomplishing this is based on nested <code class="literal">&lt;ui:decorate&gt;</code> tags. The template client, <code class="literal">index.xhtml</code>, uses <code class="literal">&lt;ui:decorate&gt;</code> to decorate the <code class="literal">&lt;div&gt;</code> element with a template that contains the <code class="literal">&lt;ul&gt;</code> list, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:body&gt;
  &lt;div style="border:2px solid; border-radius:25px;width:180px;"&gt;
<span class="strong"><strong>    &lt;ui:decorate template="/files/ul.xhtml"/&gt;</strong></span>
  &lt;/div&gt;
&lt;/h:body&gt;</pre></div><p>Furthermore, the <code class="literal">ul.xhtml</code> template provides the <code class="literal">&lt;ul&gt;</code> list and a part of <code class="literal">&lt;li&gt;</code> items, but also uses the <code class="literal">&lt;ui:decorate&gt;</code> tag to decorate the <code class="literal">&lt;ul&gt;</code> list with the remaining <code class="literal">&lt;li&gt;</code> items, which are available via the <code class="literal">li.xhtml</code> template, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ul&gt;
  &lt;li style="color: red;"&gt;Andy Murray&lt;/li&gt; 
<span class="strong"><strong>    &lt;ui:decorate template="/files/li.xhtml"/&gt;</strong></span>
  &lt;li style="color: red;"&gt;Stanislas Wawrinka&lt;/li&gt;
&lt;/ul&gt;</pre></div><p>The <code class="literal">li.xhtml</code> template uses the <code class="literal">&lt;ui:fragment&gt;</code> tag<a id="id1492" class="indexterm"/> to provide the rest of the <code class="literal">&lt;li&gt;</code> list. But since <code class="literal">&lt;ui:fragment&gt;</code> doesn't block the unclosed content, we can slip some <code class="literal">&lt;li&gt;</code> items outside of it as well, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;li style="color: green;"&gt;John Isner&lt;/li&gt;
  &lt;ui:fragment&gt;
    &lt;li&gt;Rafael Nadal&lt;/li&gt;
    &lt;li&gt;Roger Federer&lt;/li&gt;
    &lt;li&gt;Novak Djokovic&lt;/li&gt;
  &lt;/ui:fragment&gt;
&lt;li style="color: green;"&gt;Fabio Fognini&lt;/li&gt;</pre></div><p>Done! We have especially used different colors for <code class="literal">&lt;li&gt;</code> items. This is very useful, because it really helps us<a id="id1493" class="indexterm"/> understand how the page is composed using the <code class="literal">&lt;ui:decorate&gt;</code> tag. Please refer to the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_05.jpg" alt="Exploiting the &lt;ui:decorate&gt; and &lt;ui:fragment&gt; tags"/></div><p>The complete application is named <code class="literal">ch12_24</code>.</p><p>The same result can be obtained using different kinds of approaches. But, another one that can be used as a templating technique consists in replacing the <code class="literal">&lt;ui:decorate&gt;</code> tag from the <code class="literal">ul.xhtml</code> template with a combination of the <code class="literal">&lt;ui:insert&gt;</code>, <code class="literal">&lt;ui:define&gt;</code>, and <code class="literal">&lt;ui:include&gt;</code> tags. In order to do that, we change the <code class="literal">ul.xhtml</code> template using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ul&gt;
  &lt;li style="color: red;"&gt;Andy Murray&lt;/li&gt;
<span class="strong"><strong>    &lt;ui:insert name="content"/&gt;</strong></span>
  &lt;li style="color: red;"&gt;Stanislas Wawrinka&lt;/li&gt;
&lt;/ul&gt;</pre></div><p>This will change the code for the template client to the following:</p><div class="informalexample"><pre class="programlisting">&lt;h:body&gt;
  &lt;div style="border:2px solid; border-radius:25px;width:180px;"&gt;
    &lt;ui:decorate template="/files/ul.xhtml"&gt;
<span class="strong"><strong>      &lt;ui:define name="content"&gt;</strong></span>
<span class="strong"><strong>        &lt;ui:include src="/files/li.xhtml"/&gt;</strong></span>
<span class="strong"><strong>      &lt;/ui:define&gt;</strong></span>
    &lt;/ui:decorate&gt;
  &lt;/div&gt;
&lt;/h:body&gt;</pre></div><p>The complete<a id="id1494" class="indexterm"/> application is named <code class="literal">ch12_23</code>.</p></div>
<div class="section" title="Iterating with &lt;ui:repeat&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec103"/>Iterating with &lt;ui:repeat&gt;</h1></div></div></div><p>The <code class="literal">&lt;ui:repeat&gt;</code> tag<a id="id1495" class="indexterm"/> is a component handler that is capable of iterating over a collection, and at each iteration, it adds a copy of its child elements in the component tree. We can say that <code class="literal">&lt;ui:repeat&gt;</code> acts as a <code class="literal">&lt;h:dataTable&gt;</code> tag without rendering an HTML table. Of course, you can do that explicitly, by wrapping its mechanism in a <code class="literal">&lt;table&gt;</code>, <code class="literal">&lt;tr&gt;</code>, and <code class="literal">&lt;td&gt;</code> suite (you will see an example in the upcoming section, <span class="emphasis"><em>Using the jsfc attribute</em></span>).</p><p>It contains a set of very handy attributes that deserve to be mentioned before an example. Besides the well known attributes, <code class="literal">value</code> (representing the collection to iterate as <code class="literal">java.lang.Object</code>) and <code class="literal">var</code> (representing the iterator as <code class="literal">java.lang.Object</code>), we have––all the following attributes that are optional:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">step</code>: This attribute<a id="id1496" class="indexterm"/> allows us to indicate, as an <code class="literal">int</code> value, the number of items that will be skipped for each iteration. By default, the <code class="literal">&lt;ui:repeat&gt;</code> tag iterates over each item of the collection, which<a id="id1497" class="indexterm"/> indicates a <code class="literal">step</code> attribute equal to 1, and indicates that the process starts with the first one item.</li><li class="listitem" style="list-style-type: disc"><code class="literal">size</code>: This is the<a id="id1498" class="indexterm"/> size<a id="id1499" class="indexterm"/> of the collection over which to iterate; it has to be evaluated to an <code class="literal">int</code> value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">offset</code>: By default, <code class="literal">&lt;ui:repeat&gt;</code> begins the iteration process from the first item of the collection. This attribute allows us to jump over a number of items, by telling<a id="id1500" class="indexterm"/> Facelets to start the iteration process <a id="id1501" class="indexterm"/>for a certain offset. This offset is settled before the iteration process begins; it has to be evaluated to an <code class="literal">int</code> value.</li><li class="listitem" style="list-style-type: disc"><code class="literal">varStatus</code>: This attribute reveals the status<a id="id1502" class="indexterm"/> of the<a id="id1503" class="indexterm"/> current item via a POJO object. An explicit example of using it will follow shortly, but for now let's have several examples of iterating different kinds of Java collections.</li></ul></div><p>A simple example of iterating an <code class="literal">ArrayList</code> collection looks like the following code (the same approach can be applied to any <code class="literal">java.util.List</code> package):</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t"&gt;
  &lt;h:outputText value="#{t}" /&gt;
&lt;/ui:repeat&gt;</pre></div><p>However, <code class="literal">&lt;ui:repeat&gt;</code> can also iterate over a <code class="literal">HashSet</code> collection using the <code class="literal">toArray</code> method, as follows (the same approach can be applied to <code class="literal">TreeSet</code> and <code class="literal">LinkedHashSet</code>):</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataHashSet.toArray()}" var="t"&gt;
  &lt;h:outputText value="#{t}" /&gt;
&lt;/ui:repeat&gt;</pre></div><p>Or, even more, <code class="literal">&lt;ui:repeat&gt;</code> can also<a id="id1504" class="indexterm"/> iterate over a <code class="literal">Map</code> collection (<code class="literal">HashMap</code>, <code class="literal">TreeMap</code>, and <code class="literal">LinkedHashMap</code>) using <a id="id1505" class="indexterm"/>the following approaches:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The following is the code for the first approach:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataHashMap.entrySet().toArray()}" var="t"&gt;
  &lt;h:outputText value="key:#{t.key} value:#{t.value}" /&gt;
&lt;/ui:repeat&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The following is the code for the second approach:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataHashMap.keySet().toArray()}" var="t"&gt;
  &lt;h:outputText value="key:#{t} value:#{myBean.dataHashMap.get(t)}" /&gt;
&lt;/ui:repeat&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The following is the code for the third approach:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataHashMap.values().toArray()}" var="t"&gt;
  &lt;h:outputText value="#{t}" /&gt;
&lt;/ui:repeat&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">The following is the code for the fourth approach:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataHashMap.entrySet()}" var="t"&gt;
  &lt;ui:repeat value="#{t.toArray()}" var="q"&gt;
    &lt;h:outputText value="key:#{q.key} value:#{q.value}" /&gt;
  &lt;/ui:repeat&gt;
&lt;/ui:repeat&gt;</pre></div></li></ul></div><p>The preceding examples<a id="id1506" class="indexterm"/> iterate the entire collection. But if you want to iterate only the items from even positions, then we can bring the <code class="literal">step</code> attribute into the scene, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t" step="2"&gt;   &lt;h:outputText value="#{t}"/&gt;
&lt;/ui:repeat&gt;</pre></div><p>For odd items, you may want to combine the powers of the <code class="literal">step</code> and <code class="literal">offset</code> attributes, using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t" step="2" offset="1"&gt;
  &lt;h:outputText value="#{t}"/&gt;     
&lt;/ui:repeat&gt;</pre></div><p>Another common approach for displaying even/odd items consists<a id="id1507" class="indexterm"/> of using the <code class="literal">varStatus</code> attribute. The POJO object, representing the value of this attribute, contains several read-only<a id="id1508" class="indexterm"/> JavaBeans properties. Between these properties, we have the even and odd properties, which can be easily used in combination with <code class="literal">&lt;ui:fragment&gt;</code>, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For the even properties, the code is given as follows:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t" varStatus="vs"&gt;
  &lt;ui:fragment rendered="#{vs.even}"&gt;
    &lt;h:outputText value="#{vs.index}. #{t.player}"/&gt;
  &lt;/ui:fragment&gt;
&lt;/ui:repeat&gt;</pre></div></li><li class="listitem" style="list-style-type: disc">For the odd properties, the code is given as follows:<div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t" varStatus="vs"&gt;
  &lt;ui:fragment rendered="#{vs.odd}"&gt;
    &lt;h:outputText value="#{vs.index}. #{t.player}"/&gt;
  &lt;/ui:fragment&gt;
&lt;/ui:repeat&gt;</pre></div></li></ul></div><p>The entire set of properties is exposed in the following snippet of code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{myBean.dataArrayList}" var="t" varStatus="vs"&gt;
  Index: #{vs.index}
  First: #{vs.first}
  Last: #{vs.last}
  Begin: #{vs.begin}
  End: #{vs.end}
  Step: #{vs.step}
  Current: #{vs.current}
  Even: #{vs.even}   
  Odd: #{vs.odd}
&lt;/ui:repeat&gt;</pre></div><p>All the preceding examples<a id="id1509" class="indexterm"/> presented are united under the complete application named <code class="literal">ch12_6</code>.</p></div>
<div class="section" title="Working with &lt;ui:include&gt; and &lt;f:viewParam&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec104"/>Working with &lt;ui:include&gt; and &lt;f:viewParam&gt;</h1></div></div></div><p>You may think that combining <code class="literal">&lt;ui:include&gt;</code> with <code class="literal">&lt;f:viewParam&gt;</code> is a strange combination, and maybe it is. But, as you know, <code class="literal">&lt;ui:include&gt;</code> is able to encapsulate<a id="id1510" class="indexterm"/> and reuse content from multiple pages, while <code class="literal">&lt;f:viewParam&gt;</code> can be useful for adding view parameters in links (using the GET query string). This<a id="id1511" class="indexterm"/> means that we can take parameters passed on the current page via <code class="literal">&lt;f:viewParam&gt;</code> and use them in <code class="literal">&lt;ui:include&gt;</code>.</p><p>For example, in the current page, we can include a random page, or a page whose name was hardcoded as the value of a view parameter in an outcome. We can also use the <code class="literal">includeViewParams</code> attribute<a id="id1512" class="indexterm"/> to tell other pages to include the same content as the current page. These three examples are just on open gate to more scenarios. The following example speaks for itself:</p><div class="informalexample"><pre class="programlisting">&lt;h:head&gt;
  &lt;title&gt;&lt;/title&gt;
  &lt;f:metadata&gt;
    &lt;f:viewParam name="in" value="#{randomInBean.in}"/&gt;
  &lt;/f:metadata&gt;
&lt;/h:head&gt;
&lt;h:body&gt;
  &lt;ui:include src="#{randomInBean.in}"/&gt;

  &lt;h:button value="Tell mypage.xhtml To Include The Same Page As You Did" outcome="mypage.xhtml" includeViewParams="true"/&gt;
  &lt;h:button value="Random Page" outcome="index.xhtml" 
    includeViewParams="false"/&gt;

  &lt;h:button value="Include in_index_A.xhtml Page" outcome="index.xhtml?in=in_index_A.xhtml"/&gt;
  &lt;h:button value="Include in_index_B.xhtml Page" outcome="index.xhtml?in=in_index_B.xhtml"/&gt;
  &lt;h:button value="Include in_index_C.xhtml Page" outcome="index.xhtml?in=in_index_C.xhtml"/&gt;               
&lt;/h:body&gt;</pre></div><p>The code for <code class="literal">RandomInBean</code> is as follows:</p><div class="informalexample"><pre class="programlisting">@Named
@RequestScoped
public class RandomInBean {

  private String in = "";

  public RandomInBean() {
    int in_rnd = new Random().nextInt(3);
    if (in_rnd == 0) {
      in = "in_index_A.xhtml";
    } else if (in_rnd == 1) {
      in = "in_index_B.xhtml";
    } else if (in_rnd == 2) {
      in = "in_index_C.xhtml";
    }       
  }

  public String getIn() {        
    return in;
  }

  public void setIn(String in) {
    this.in = in;
  }
}</pre></div><p>So, we have several <a id="id1513" class="indexterm"/>buttons to prove the symbiosis between the <code class="literal">&lt;ui:include&gt;</code> and <code class="literal">&lt;f:viewParam&gt;</code> tags. First, we have three buttons labeled <span class="strong"><strong>Include in_index_A.xhtml Page</strong></span>, <span class="strong"><strong>Include in_index_B.xhtml Page</strong></span>, and <span class="strong"><strong>Include in_index_C.xhtml Page</strong></span>. All three act the same way; they pass a view parameter<a id="id1514" class="indexterm"/> named <code class="literal">in</code>. The value of the view parameter is a string literal, and represents the page that should be included. This will generate a URL of the following type:</p><p><code class="literal">http://localhost:8080/ch12_12/faces/index.xhtml?in=in_index_B.xhtml</code></p><p>So, conforming to this URL, the <code class="literal">&lt;ui:include&gt;</code> tag will include the <code class="literal">in_index_B.xhtml</code> page.</p><p>Further, we have a button labeled <span class="strong"><strong>Random Page</strong></span>. This button will randomly choose between those three pages. In order to obtain this, we need to add <code class="literal">includeViewParams="false"</code>, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:button value="Random Page" outcome="index.xhtml" includeViewParams="false"/&gt;</pre></div><p>Finally, we can tell other pages to include the same content as the current page. When you click on the button labeled <span class="strong"><strong>Tell mypage.xhtml To Include The Same Page As You Did</strong></span>, the <code class="literal">mypage.xhtml</code> page will include the same page as the current page. For this, we need to<a id="id1515" class="indexterm"/> add <code class="literal">includeViewParams="true"</code>.</p><p>The complete <a id="id1516" class="indexterm"/>application is named <code class="literal">ch12_12</code>.</p></div>
<div class="section" title="Working with &lt;ui:include&gt; and &lt;ui:param&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec105"/>Working with &lt;ui:include&gt; and &lt;ui:param&gt;</h1></div></div></div><p>The <code class="literal">&lt;ui:include&gt;</code> and <code class="literal">&lt;ui:param&gt;</code> tags are two tag handlers that can be used for accomplishing many<a id="id1517" class="indexterm"/> kinds of tasks; as <a id="id1518" class="indexterm"/>long as we keep in mind that tag handlers are efficient only when the view tree is built, we can exploit them for our benefit. For example, we can use them to generate a tree node structure as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_06.jpg" alt="Working with &lt;ui:include&gt; and &lt;ui:param&gt;"/></div><p>In order to accomplish this task, we will spice up the <code class="literal">&lt;ui:include&gt;</code> and <code class="literal">&lt;ui:param&gt;</code> tags with a dash of JSTL (the <code class="literal">&lt;c:if&gt;</code> and <code class="literal">&lt;c:forEach&gt;</code> tag handlers) and recursivity.</p><p>First, we need a class that represents the abstractization of the tree node concept. Basically, a tree node representation is a hierarchical structure of labels that can be recursively traversed. Based on this, we can write a generic tree node class as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class GenericTreeNode {

  private final List&lt;GenericTreeNode&gt; descendants;
  private final String label;

  public GenericTreeNode(String label, GenericTreeNode... descendants) {
    this.label = label;
    this.descendants = Arrays.asList(descendants);
  }

  public boolean isHasDescendants() {
    return !descendants.isEmpty();
  }

  public List&lt;GenericTreeNode&gt; getDescendants() {
    return descendants;
  }

  public String getLabel() {
    return label;
  }
}</pre></div><p>This class can serve a bean capable of <a id="id1519" class="indexterm"/>defining a particular<a id="id1520" class="indexterm"/> tree node, as follows:</p><div class="informalexample"><pre class="programlisting">@Named
@RequestScoped
public class TreeNodeBean {

  private GenericTreeNode root = new GenericTreeNode("Players",new GenericTreeNode("Rafael Nadal",new GenericTreeNode("2013", new GenericTreeNode("Roland Garros", new GenericTreeNode("Winner")), new GenericTreeNode("Wimbledon", new GenericTreeNode("First round"))),new GenericTreeNode("2014", new GenericTreeNode("..."))),new GenericTreeNode("Roger Federer",new GenericTreeNode("2013"), new GenericTreeNode("...")));

  public GenericTreeNode getRoot() {
    return root;
  }
}</pre></div><p>The interesting<a id="id1521" class="indexterm"/> part is how to display this structure as a tree node. HTML provides the <code class="literal">&lt;ul&gt;</code> and <code class="literal">&lt;li&gt;</code> tags that are able to represent data as a list. Moreover, nested <code class="literal">&lt;ul&gt;</code> tags output a hierarchical structure, which is very useful since it spears us for finding a custom representation. In order to reflect the tree node defined in <code class="literal">TreeNodeBean</code>, we write a page named <code class="literal">node.xhtml</code> capable of autoinclusion in an iterative-recursive process using the <code class="literal">&lt;ui:include&gt;</code> tag, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;h:body&gt;
  &lt;ui:composition&gt;  
    &lt;li&gt;#{node.label} 
      &lt;c:if test="#{node.hasDescendants}"&gt;
        &lt;ul&gt;
          &lt;c:forEach items="#{node.descendants}" var="node"&gt;
            &lt;ui:include src="node.xhtml" /&gt;
          &lt;/c:forEach&gt;
        &lt;/ul&gt;
      &lt;/c:if&gt;
    &lt;/li&gt;
  &lt;/ui:composition&gt;
&lt;/h:body&gt;</pre></div><p>The <code class="literal">node</code> parameter<a id="id1522" class="indexterm"/> is passed via <code class="literal">&lt;ui:param&gt;</code> from the main page named <code class="literal">index.xhtml</code>. From the main page, we pass the tree node root. Furthermore, in <code class="literal">node.xhtml</code>, we iterate the descendants of the root in a<a id="id1523" class="indexterm"/> recursive approach<a id="id1524" class="indexterm"/> and display each node as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:body&gt;
  &lt;ul&gt;
    &lt;ui:include src="node.xhtml"&gt;
      &lt;ui:param name="node" value="#{treeNodeBean.root}" /&gt;
    &lt;/ui:include&gt;
  &lt;/ul&gt;
&lt;/h:body&gt;</pre></div><p>If you didn't find this example useful, at least keep in mind that <code class="literal">&lt;ui:include&gt;</code> can be used in a recursive process. The complete application is named <code class="literal">ch12_14</code>.</p></div>
<div class="section" title="Debugging with &lt;ui:debug&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec106"/>Debugging with &lt;ui:debug&gt;</h1></div></div></div><p>The <code class="literal">&lt;ui:debug&gt;</code> tag (<code class="literal">ComponentHandler</code>) defines a debug component in the component tree that is<a id="id1525" class="indexterm"/> capable of capturing debugging information such as component tree, scoped variables, and view state. For example, you can add the <code class="literal">&lt;ui:debug&gt;</code> tag into a template using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:debug hotkey="q" rendered="true"/&gt;</pre></div><p>Now, when you press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>Q</em></span>, you will see something like the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_07.jpg" alt="Debugging with &lt;ui:debug&gt;"/></div><p>The complete <a id="id1526" class="indexterm"/>application is named <code class="literal">ch12_9</code>. The <code class="literal">&lt;ui:debug&gt;</code> tag was added in <code class="literal">layout.xhtml</code>.</p></div>
<div class="section" title="Removing the content with &lt;ui:remove&gt;"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec107"/>Removing the content with &lt;ui:remove&gt;</h1></div></div></div><p>The <code class="literal">&lt;ui:remove&gt;</code> tag is used for removing the content. This tag is rarely used, but a perfect example <a id="id1527" class="indexterm"/>of this is removing comments of type <code class="literal">&lt;!-- --&gt;</code>. You probably thought of something like the following line:</p><div class="informalexample"><pre class="programlisting">&lt;!-- &lt;h:outputText value="I am a comment!"/&gt; --&gt;</pre></div><p>It doesn't have any side effects on the HTML rendered code. Well, that isn't true, because in the HTML source code, you will see something similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_08.jpg" alt="Removing the content with &lt;ui:remove&gt;"/></div><p>But if we encapsulate this in <code class="literal">&lt;ui:remove&gt;</code>, then the preceding client side effect will not be produced anymore, which has the following code.</p><div class="informalexample"><pre class="programlisting">&lt;ui:remove&gt;
  &lt;!-- &lt;h:outputText value="I am a comment!"/&gt; --&gt;
&lt;/ui:remove&gt;</pre></div><p>The same effect will have the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:remove&gt;
  &lt;h:outputText value="I am a comment!"/&gt;
&lt;/ui:remove&gt;</pre></div><p>In order to remove comments from the generated HTML code, you add the <code class="literal">context</code> parameter in <code class="literal">web.xml</code>, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;javax.faces.FACELETS_SKIP_COMMENTS&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><p>Alternatively, for<a id="id1528" class="indexterm"/> backwards compatibility with existing Facelets tag libraries, the code is given as follows:</p><div class="informalexample"><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;facelets.SKIP_COMMENTS&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><p>The complete application is named <code class="literal">ch12_8</code>.</p></div>
<div class="section" title="Using the jsfc attribute"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec108"/>Using the jsfc attribute</h1></div></div></div><p>Facelets comes with an attribute named <code class="literal">jsfc</code>. Its main goal consists in converting HTML elements in JSF<a id="id1529" class="indexterm"/> components (the HTML prototype in the JSF page). For example, in the following code, we have an HTML form converted into a JSF form:</p><div class="informalexample"><pre class="programlisting">&lt;form jsfc="h:form"&gt;
  &lt;input type="text" jsfc="h:inputText" value="#{nameBean.name}" /&gt;
  &lt;input type="submit" jsfc="h:commandButton" value="Send"/&gt;
&lt;/form&gt;</pre></div><p>This attribute stands for fast prototyping and is easy to use. The following is another example—this time the <code class="literal">jsfc</code> attribute is combined with <code class="literal">&lt;ui:repeat&gt;</code> for generating a <code class="literal">&lt;table&gt;</code> tag:</p><div class="informalexample"><pre class="programlisting">&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Ranking&lt;/th&gt;
      &lt;th&gt;Player&lt;/th&gt;
      &lt;th&gt;Age&lt;/th&gt;
      &lt;th&gt;Coach&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr jsfc="ui:repeat" value="#{playersBean.dataArrayList}" var="t"&gt;
      &lt;td&gt;#{t.ranking}&lt;/td&gt;
      &lt;td&gt;#{t.player}&lt;/td&gt;
      &lt;td&gt;#{t.age}&lt;/td&gt;
      &lt;td&gt;#{t.coach}&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</pre></div><p>The first example<a id="id1530" class="indexterm"/> is named <code class="literal">ch12_7</code> and the second one is named <code class="literal">ch12_25</code>.</p></div>
<div class="section" title="Extending the PageLayout template"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec109"/>Extending the PageLayout template</h1></div></div></div><p>Remember the <code class="literal">PageLayout</code> template developed at the beginning of this chapter? Well, that is a decent template, but let's extend it so it becomes a bit more realistic. Usually, a web template contains the<a id="id1531" class="indexterm"/> sections title, login, search, logo, header, menu, left, center, right, and footer over and above the five sections that we have used. It would also be nice to have a template that allows us to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remove sections without side effects and without manually removing orphan CSS code (usually, you can remove a section by writing an empty <code class="literal">&lt;ui:define&gt;</code> tag, but this will not remove the corresponding CSS code for that section). Moreover, an empty <code class="literal">&lt;ui:define&gt;</code> tag will still have a side effect of type the empty <code class="literal">&lt;div&gt;</code> tag or the empty <code class="literal">&lt;span&gt;</code> or <code class="literal">&lt;td&gt;</code> tag. This happens because, usually, <code class="literal">&lt;ui:define&gt;</code> is wrapped in a <code class="literal">&lt;div&gt;</code>, <code class="literal">&lt;span&gt;</code>, or <code class="literal">&lt;td&gt;</code> tag.</li><li class="listitem" style="list-style-type: disc">Set the width of the template, that is, the left and right panels without altering CSS. These are common adjustments; therefore we can expose them via <code class="literal">&lt;ui:param&gt;</code> and spear the page author to scroll through CSS files.</li><li class="listitem" style="list-style-type: disc">Add a menu section. We can provide support for adding it via <code class="literal">&lt;ui:include&gt;</code> as a separate file or having a convention mechanism that allows the page author to add it much easily.</li></ul></div><p>At the end, the template will look like the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_09.jpg" alt="Extending the PageLayout template"/></div><p>There is no secret that most websites place the content in multiple columns, which are created using the <code class="literal">&lt;div&gt;</code> or <code class="literal">&lt;table&gt;</code> elements. Afterwards, these elements are positioned in the page using<a id="id1532" class="indexterm"/> CSS. Basically, this is the main idea behind most templates, and this one is no exception. In the following diagram, you can see the layout of our template, which is based on the <code class="literal">&lt;div&gt;</code> elements (in the diagram, you can see each <code class="literal">&lt;div&gt;</code> ID):</p><div class="mediaobject"><img src="graphics/6466EN_12_10.jpg" alt="Extending the PageLayout template"/></div><p>Well, since each section is wrapped in a <code class="literal">&lt;div&gt;</code> element, we can easily remove it using the <code class="literal">&lt;ui:fragment&gt;</code> tag and its <code class="literal">rendered</code> attribute. We can wrap each section in a <code class="literal">&lt;ui:fragment&gt;</code> tag and remove it by setting the value of the <code class="literal">rendered</code> attribute to <code class="literal">false</code> via a <code class="literal">&lt;ui:param&gt;</code> tag. This will remove the section without any side effects. When a section is removed, we need to skip loading the corresponding CSS code. For this, we can split the CSS files<a id="id1533" class="indexterm"/> into the following three categories:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A CSS file that holds general styles for templates (usually this is a small file)</li><li class="listitem" style="list-style-type: disc">A CSS file that holds styles for positioning each section on a page (usually this is a small file)</li><li class="listitem" style="list-style-type: disc">A CSS file per section, which holds styles specific to each section (these can be pretty large files)</li></ul></div><p>Having this structure, we<a id="id1534" class="indexterm"/> can easily decide not to load the CSS code for the sections that have been removed. This can be accomplished in the <code class="literal">&lt;h:outputStylesheet&gt;</code> tag with a simple condition based <a id="id1535" class="indexterm"/>on the same parameters passed for removing the sections. When a section is removed, we load an empty CSS file named <code class="literal">dummy.css</code> for it.</p><p>So, the template file (<code class="literal">layout.xhtml</code>) may be changed to the following:</p><div class="informalexample"><pre class="programlisting">&lt;h:head&gt;
  &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /&gt;
  &lt;h:outputStylesheet name="css/default.css"/&gt;
  &lt;h:outputStylesheet name="css/cssLayout.css"/&gt;    
  &lt;h:outputStylesheet name="#{title eq false ? 'css/dummy.css' : 'css/titleStyle.css'}"/&gt;  
  &lt;h:outputStylesheet name="#{loginsearch eq false ? 'css/dummy.css' : 'css/login_and_searchStyle.css'}"/&gt;
  &lt;h:outputStylesheet name="#{top eq false ? 'css/dummy.css' : 'css/topStyle.css'}"/&gt;
...
&lt;/h:head&gt;

&lt;h:body&gt;        
  &lt;div id="wrapper" style="width: #{empty wrapperWidth ? '100%' : wrapperWidth}"&gt;
    &lt;ui:fragment rendered="#{empty title ? true : title}"&gt;                
      &lt;div id="title"&gt;
        &lt;ui:insert name="title"&gt;
          &lt;ui:include src="/template/default/titleDefault.xhtml"/&gt;
        &lt;/ui:insert&gt;
      &lt;/div&gt;     
    &lt;/ui:fragment&gt;
 ...
    &lt;ui:fragment rendered="#{empty bottom ? true : bottom}"&gt;
      &lt;div id="bottom"&gt;
        &lt;ui:insert name="bottom"&gt;
          &lt;ui:include src="/template/default/bottomDefault.xhtml"/&gt;
        &lt;/ui:insert&gt;
      &lt;/div&gt;
    &lt;/ui:fragment&gt;
  &lt;/div&gt;
&lt;/h:body&gt;</pre></div><p>So, in the template client, we can easily remove a section (for example, the title section), using the following line of code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:param name="title" value="false"/&gt;</pre></div><p>At this moment, in <a id="id1536" class="indexterm"/>the template client, we can easily use <code class="literal">&lt;ui:define&gt;</code> to provide our content to the template, and <code class="literal">&lt;ui:param&gt;</code> for the following settings:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Remove the title section: This sets the <code class="literal">title</code> parameter<a id="id1537" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the login and search sections: This sets the <a id="id1538" class="indexterm"/><code class="literal">loginsearch</code> parameter to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove only login section: This sets the <code class="literal">login</code> parameter<a id="id1539" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove only search section: This sets the <code class="literal">search</code> parameter<a id="id1540" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the logo section: This sets the <code class="literal">logo</code> parameter<a id="id1541" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the top section: This sets the <code class="literal">top</code> parameter<a id="id1542" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the menu section: This sets the <code class="literal">menu</code> parameter<a id="id1543" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the left section: This sets the <code class="literal">left</code> parameter<a id="id1544" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the right section: This sets the <code class="literal">right</code> parameter<a id="id1545" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Remove the bottom section: This sets the <code class="literal">bottom</code> parameter<a id="id1546" class="indexterm"/> to <code class="literal">false</code></li><li class="listitem" style="list-style-type: disc">Set template fixed width: This sets the <code class="literal">wrapperWidth</code> parameter<a id="id1547" class="indexterm"/> to <span class="emphasis"><em>widthpx</em></span></li><li class="listitem" style="list-style-type: disc">Set left panel fixed width: This sets the <code class="literal">leftWidth</code> parameter<a id="id1548" class="indexterm"/> to <span class="emphasis"><em>widthpx</em></span> (default 150px)</li><li class="listitem" style="list-style-type: disc">Set right fixed width: This sets the <code class="literal">rightWidth</code> parameter<a id="id1549" class="indexterm"/> to <span class="emphasis"><em>widthpx</em></span> (default 150px)</li></ul></div><p>Now, let's focus on adding a menu. The template user can define a menu in a separate file, as long as it respects the following simple convention of writing:</p><div class="informalexample"><pre class="programlisting">&lt;h:body&gt;
  &lt;ui:composition&gt;
    &lt;ul&gt;
      &lt;li&gt;
        &lt;h:link value="..." outcome="..."/&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;h:link value="..." outcome="..."/&gt;
      &lt;/li&gt;
    ...
    &lt;/ul&gt;                
  &lt;/ui:composition&gt;
&lt;/h:body&gt;</pre></div><p>This file can be included as follows:</p><div class="informalexample"><pre class="programlisting">&lt;ui:define name="menu"&gt;
  &lt;ui:include src="<span class="emphasis"><em>myMenu</em></span>.xhtml"/&gt;
&lt;/ui:define&gt;</pre></div><p>Another approach consists of passing menu items via <code class="literal">&lt;ui:param&gt;</code> using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:param name="items" value="<span class="emphasis"><em>item</em></span>#<span class="emphasis"><em>outcome</em></span>,<span class="emphasis"><em>item</em></span>#<span class="emphasis"><em>outcome</em></span>,..."/&gt;</pre></div><p>This will work<a id="id1550" class="indexterm"/> because the <code class="literal">menuDefault.xhtml</code> page provides a default implementation that looks like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:composition&gt;
  &lt;c:if test="${not empty items}"&gt;
   &lt;ul&gt;                
    &lt;ui:repeat value="${fn:split(items, ',')}" var="t"&gt;
      &lt;li&gt;                        
        &lt;h:link value="${fn:substringBefore(t, '#')}" outcome="${fn:substringAfter(t, '#')}"/&gt;
      &lt;/li&gt;
     &lt;/ui:repeat&gt;
    &lt;/ul&gt;            
  &lt;/c:if&gt;
&lt;/ui:composition&gt;</pre></div><p>The complete application is named <code class="literal">ch12_18</code>. In the application <code class="literal">ch12_19</code>, you can see a usage example of this template, which looks similar to the following screenshot:</p><div class="mediaobject"><img src="graphics/6466EN_12_11.jpg" alt="Extending the PageLayout template"/></div><p>Notice that we<a id="id1551" class="indexterm"/> have dropped the search and right panel sections.</p></div>
<div class="section" title="Facelets' programmatic aspects"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec110"/>Facelets' programmatic aspects</h1></div></div></div><p>In the second part of this chapter, we will focus more on several programmatic aspects of Facelets. We will start with a new feature of JSF 2.2 regarding <code class="literal">FaceletFactory</code>, which produces Facelets relative to the context of the underlying implementation.</p><div class="section" title="FaceletFactory considerations"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec122"/>FaceletFactory considerations</h2></div></div></div><p>In JSF 2.0, the <code class="literal">FaceletFactory</code> class <a id="id1552" class="indexterm"/>was not accessible via the standard API for accessing<a id="id1553" class="indexterm"/> factories, <code class="literal">FactoryFinder</code>. This means that something like the following line was not working:</p><div class="informalexample"><pre class="programlisting">FaceletFactory faceletFactory = (FaceletFactory)
FactoryFinder.getFactory(javax.faces.view.facelets.FaceletFactory);</pre></div><p>But starting with JSF 2.2, the preceding snippet of code should work. At least this is what the list of JSF 2.2 features said. Unfortunately, it doesn't work because the specification doesn't contain a class named <code class="literal">javax.faces.view.facelets.FaceletFactory</code>. In Mojarra 2.2.6 implementation, the <code class="literal">FaceletFactory</code> class doesn't even exist; there is a public class named <code class="literal">com.sun.faces.facelets.impl.DefaultFaceletFactory</code>. On the other hand, in MyFaces 2.2.2, we have the abstract class, <code class="literal">org.apache.myfaces.view.facelets.FaceletFactory</code>. So, keep these aspects in mind when you decide to use, decorate, or write a new <code class="literal">FaceletFactory</code> class.</p><p>In the near<a id="id1554" class="indexterm"/> future, we <a id="id1555" class="indexterm"/>may have the ability to programmatically create a Facelet and call the <code class="literal">apply</code> method in order to build a component tree.</p></div><div class="section" title="Working with FaceletCache"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec123"/>Working with FaceletCache</h2></div></div></div><p>Starting with JSF 2.1, Facelets are created and cached via the <code class="literal">FaceletCache</code> API. The cache handles two <a id="id1556" class="indexterm"/>different kinds of Facelets: <span class="strong"><strong>View Facelets</strong></span> and <span class="strong"><strong>View Metadata Facelets</strong></span>. For each type, the <code class="literal">FaceletCache</code> API provides a method that returns/creates a cached instance based<a id="id1557" class="indexterm"/> on the URL that is passed (<code class="literal">getFacelet</code>/<code class="literal">getViewMetadataFacelet</code>) and a method capable of determining whether a cached Facelet instance exists for the given URL (<code class="literal">isFaceletCached</code>/<code class="literal">isViewMetadataFaceletCached</code>).</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note187"/>Note</h3><p><span class="strong"><strong>View Metadata Facelets</strong></span><a id="id1558" class="indexterm"/> is a special kind of Facelet that corresponds to <code class="literal">ViewDeclarationLanguage.getViewMetadata(javax.faces.context.FacesContext, java.lang.String)</code>.</p></div></div><p>Facelets instances are created in the <code class="literal">getFacelet</code>/<code class="literal">getViewMetadataFacelet</code> method using the public static interface, <code class="literal">FaceletCache.MemberFactory</code>; this interface is responsible for the creation of Facelet or View Metadata Facelet instances using a method named <code class="literal">newInstance(URL key)</code>. The <code class="literal">getFacelet</code> method<a id="id1559" class="indexterm"/> has access to <code class="literal">FaceletCache.MemberFactory</code> via the protected method, <code class="literal">getMemberFactory</code>. The <code class="literal">getViewMetadataFacelet</code> method<a id="id1560" class="indexterm"/> has access to the same interface via the protected method, <code class="literal">getMetadataMemberFactory</code>.</p><p>The <code class="literal">FaceletCache</code> API's instances are obtained from <code class="literal">FaceletCacheFactory</code>. This is a factory class that provides two methods: <code class="literal">getFaceletCache</code> and <code class="literal">getWrapped</code>. The first one returns a <code class="literal">FaceletCache</code> instance, the latter one returns an instance of the class being wrapped.</p><p>In order to return a custom <code class="literal">FaceletCache</code> instance, we can start with a custom implementation of <code class="literal">FaceletCacheFactory</code>, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class CustomFaceletCacheFactory extends FaceletCacheFactory {

  private FaceletCacheFactory faceletCacheFactory;

  public CustomFaceletCacheFactory() {}

  public CustomFaceletCacheFactory(FaceletCacheFactory faceletCacheFactory) {
    this.faceletCacheFactory = faceletCacheFactory;
  }

  @Override
  public FaceletCache getFaceletCache() {
    return new CustomFaceletCache();
  }

  @Override
  public FaceletCacheFactory getWrapped() {
    return this.faceletCacheFactory;
  }
}</pre></div><p>This factory has to be<a id="id1561" class="indexterm"/> configured<a id="id1562" class="indexterm"/> in <code class="literal">faces-config.xml</code> using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;factory&gt;
  &lt;facelet-cache-factory&gt;           
    book.beans.CustomFaceletCacheFactory
  &lt;/facelet-cache-factory&gt;
&lt;/factory&gt;</pre></div><p>Now, our <code class="literal">CustomFaceletCache</code> class<a id="id1563" class="indexterm"/> will override the <code class="literal">getFacelet</code> and <code class="literal">getViewMetadataFacelet</code> methods for disabling the cache mechanism; our implementation will not cache Facelets. The code of the <code class="literal">CustomFaceletCache</code> class is as follows:</p><div class="informalexample"><pre class="programlisting">public class CustomFaceletCache extends FaceletCache&lt;Facelet&gt; {

  public CustomFaceletCache() {}

  @Override
  public Facelet getFacelet(URL url) throws IOException {
    MemberFactory&lt;Facelet&gt; memberFactory = getMemberFactory();
    Facelet facelet = memberFactory.newInstance(url);

    return facelet;
  }

  @Override
  public boolean isFaceletCached(URL url) {
    return false;
  }

  @Override
  public Facelet getViewMetadataFacelet(URL url) throws IOException {
    MemberFactory&lt;Facelet&gt; metadataMemberFactory = getMetadataMemberFactory();
    Facelet facelet = metadataMemberFactory.newInstance(url);

    return facelet;
  }

  @Override
  public boolean isViewMetadataFaceletCached(URL url) {
    return false;
  }

  public FaceletCache&lt;Facelet&gt; getWrapped() {
    return this;
  }
}</pre></div><p>The complete application is named <code class="literal">ch12_15</code>.</p><p>In order to update the cache, JSF performs<a id="id1564" class="indexterm"/> periodic checks of Facelets views changes. In the development stage, you<a id="id1565" class="indexterm"/> may need to perform this check much often than in production. For this, you can set the <code class="literal">javax.faces.FACELETS_REFRESH_PERIOD</code> context parameter<a id="id1566" class="indexterm"/> as shown in the following example (the value represents the number of seconds between two consecutive checks):</p><div class="informalexample"><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt; javax.faces.FACELETS_REFRESH_PERIOD&lt;/param-name&gt;
  &lt;param-value&gt;2&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><p>Alternatively, for backwards compatibility with existing Facelets tag libraries, the following is the code:</p><div class="informalexample"><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;facelets.REFRESH_PERIOD&lt;/param-name&gt;
  &lt;param-value&gt;2&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><p>If you want to<a id="id1567" class="indexterm"/> disable these checks, then set the <code class="literal">javax.faces.FACELETS_REFRESH_PERIOD</code> (or <code class="literal">facelets.REFRESH_PERIOD</code>) parameter to <code class="literal">-1</code>.</p></div><div class="section" title="ResourceResolver swallowed by ResourceHandler"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec124"/>ResourceResolver swallowed by ResourceHandler</h2></div></div></div><p>JSF 2.0 promotes the <code class="literal">ResourceResolver</code> class<a id="id1568" class="indexterm"/> as the custom approach for loading Facelets views from other locations beside the application web root (like a hook that allows us to alter<a id="id1569" class="indexterm"/> the way that the Facelets loads template files). Custom locations represent any location for which we can write a URL.</p><p>For example, let's <a id="id1570" class="indexterm"/>suppose that the Facelets views of our <code class="literal">PageLayout</code> template are stored on the local machine, in the <code class="literal">facelets</code> folder in <code class="literal">D:</code>. A custom <code class="literal">ResourceResolver</code> class can load the Facelets views from this location—just override the <code class="literal">resolveUrl</code> method, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class CustomResourceResolver extends ResourceResolver {

  private ResourceResolver resourceResolver;

  public CustomResourceResolver(){}
    
  public CustomResourceResolver(ResourceResolver resourceResolver){
    this.resourceResolver = resourceResolver;
  }

  @Override
  public URL resolveUrl(String path) {

    URL result = null;
    if (path.startsWith("/template")) {
      try {
        result = new URL("file:///D:/facelets/" + path);
      } catch (MalformedURLException ex) {
        Logger.getLogger(CustomResourceResolver.class.getName()).log(Level.SEVERE, null, ex);
      }
    } else {
      result = resourceResolver.resolveUrl(path);
    }

  return result;
  } 
}</pre></div><p>A custom <code class="literal">ResourceResolver</code> class is recognized by JSF if we configure it properly in the <code class="literal">web.xml</code> file, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;context-param&gt;
  &lt;param-name&gt;javax.faces.FACELETS_RESOURCE_RESOLVER&lt;/param-name&gt;
  &lt;param-value&gt;book.beans.CustomResourceResolver&lt;/param-value&gt;
&lt;/context-param&gt;</pre></div><p>However, starting with JSF 2.2, we can skip this configuration and use the <code class="literal">@FaceletsResourceResolver</code> annotation<a id="id1571" class="indexterm"/> as follows:</p><div class="informalexample"><pre class="programlisting">@FaceletsResourceResolver
public class CustomResourceResolver extends ResourceResolver {
...</pre></div><p>The complete application<a id="id1572" class="indexterm"/> using the <code class="literal">web.xml</code> configuration is named <code class="literal">ch12_2</code>. The same application,<a id="id1573" class="indexterm"/> using the <code class="literal">@FaceletsResourceResolver</code> annotation, is named <code class="literal">ch12_5</code>.</p><p>On the <a id="id1574" class="indexterm"/>other hand, the <code class="literal">ResourceHandler</code> class is recommended to be used for serving different kinds of resources to the client, such as CSS, JS, and images; see the <span class="emphasis"><em>Configuring resource handlers</em></span> section in <a class="link" href="ch05.html" title="Chapter 5. JSF Configurations Using XML Files and Annotations – Part 2">Chapter 5</a>, <span class="emphasis"><em>JSF Configurations Using XML Files and Annotations – Part 2</em></span>. By default, the preferred location of <code class="literal">ResourceHandler</code> is the <code class="literal">/resources</code> folder (or <code class="literal">META-INF/resources</code> on the <code class="literal">CLASSPATH</code>). A custom <code class="literal">ResourceHandler</code> class is recognized by JSF if we configure it properly in the <code class="literal">faces-config.xml file</code>, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;application&gt;
  &lt;resource-handler&gt;<span class="emphasis"><em>fully_qualified_class_name</em></span>&lt;/resource-handler&gt;
&lt;/application&gt;</pre></div><p>Since this was a pretty awkward approach, JSF 2.2 unifies these classes into a single one. More exactly, the functionality of the <code class="literal">ResourceResolver</code> class has been merged into the <code class="literal">ResourceHandler</code> class, and the <code class="literal">ResourceResolver</code> class itself has been deprecated. The main result of this action was a new method in <code class="literal">ResourceHandler</code> named <code class="literal">createViewResource</code>. The purpose of this method is to replace the <code class="literal">resolveUrl</code> method. So, instead of loading Facelets views from custom locations via <code class="literal">ResourceResolver</code>, we can use a custom <code class="literal">ResourceHandler</code> class and a <code class="literal">createViewResource</code> method, as<a id="id1575" class="indexterm"/> shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class CustomResourceHandler extends ResourceHandlerWrapper {

  private ResourceHandler resourceHandler;

  public CustomResourceHandler() {}

  public CustomResourceHandler(ResourceHandler resourceHandler) {
    this.resourceHandler = resourceHandler;
  }
    
  @Override
  public Resource createResource(String resourceName, String libraryOrContractName) {

    //other kinds of resources, such as scripts and stylesheets
    return getWrapped().createResource(resourceName, libraryOrContractName);
  }

  @Override
  public ViewResource createViewResource(FacesContext context, String resourceName) {
    ViewResource viewResource;
    if (resourceName.startsWith("/template")) {
      viewResource = new CustomViewResource(resourceName);
    } else {
      viewResource = getWrapped().
      createViewResource(context, resourceName);
    }

    return viewResource;
  }

  @Override
  public ResourceHandler getWrapped() {
    return this.resourceHandler;
  }
}</pre></div><p>When the <code class="literal">ResourceResolver</code> class was<a id="id1576" class="indexterm"/> deprecated, the existing type <code class="literal">javax.faces.application.Resource</code> class has<a id="id1577" class="indexterm"/> been given a base class named <code class="literal">javax.faces.application.ViewResource</code>. This class contains a single method named <code class="literal">getURL</code>. So, when a Facelets view should be loaded from a custom location, we tell JSF to use our <code class="literal">CustomViewResource</code> class as follows:</p><div class="informalexample"><pre class="programlisting">public class CustomViewResource extends ViewResource {

  private String resourceName;

  public CustomViewResource(String resourceName) {
    this.resourceName = resourceName;
  }

  @Override
  public URL getURL() {
    URL url = null;
    try {
      url = new URL("file:///D:/facelets/" + resourceName);
    } catch (MalformedURLException ex) {
      Logger.getLogger(CustomViewResource.class.getName()).log(Level.SEVERE, null, ex);
    }
  return url;
  }
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note188"/>Note</h3><p>The <code class="literal">createViewResource</code> method<a id="id1578" class="indexterm"/> provides several advantages, because it <span class="emphasis"><em>is applicable to general view resources and by default is functional equivalent to the existing</em></span> <code class="literal">createResource</code> <span class="emphasis"><em>method. Besides being much more consistent, this means it's now also possible to load Facelets from a JAR file without needing to provide a custom resolver</em></span>.</p></div></div><p>The complete application is named <code class="literal">ch12_3</code>.</p><p>For backward compatibility, JSF<a id="id1579" class="indexterm"/> will let the <a id="id1580" class="indexterm"/>default resolver<a id="id1581" class="indexterm"/> to call the new <code class="literal">createViewResource</code> method as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class CustomResourceResolver extends ResourceResolver {
...
  @Override
  public URL resolveUrl(String path) {

    URL result;
    if (path.startsWith("/template")) {
      ViewResource viewResource = new CustomViewResource(path);
      result = viewResource.getURL();
    } else {
      FacesContext facesContext = FacesContext.getCurrentInstance();
      ResourceHandler resourceHandler = facesContext.getApplication().getResourceHandler();
      result = resourceHandler.createViewResource(facesContext, path).getURL();
    }

  return result;
  }
}</pre></div><p>The<a id="id1582" class="indexterm"/> complete<a id="id1583" class="indexterm"/> application is named <code class="literal">ch12_4</code>.</p></div><div class="section" title="Include Facelets programmatically"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec125"/>Include Facelets programmatically</h2></div></div></div><p>You already know how<a id="id1584" class="indexterm"/> to include Facelets using the <code class="literal">&lt;ui:include&gt;</code> tag. But, sometimes you may need to<a id="id1585" class="indexterm"/> programmatically reproduce something like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:include src="/files/fileA.xhtml"&gt;
  &lt;ui:param name="bparam" value="string_literal"/&gt;
&lt;/ui:include&gt;
&lt;ui:include src="/files/fileB.xhtml"&gt;
  &lt;ui:param name="cparam" value="#{managed_bean_property}"/&gt;
&lt;/ui:include&gt;
&lt;ui:include src="/files/fileC.xhtml"/&gt;</pre></div><p>Programmatically speaking, the same thing can be accomplished if you know: how to obtain access to <code class="literal">FaceletContext</code>, how to use the <code class="literal">FaceletContext.includeFacelet</code> method, and how<a id="id1586" class="indexterm"/> to set attributes using <code class="literal">FaceletContext.setAttribute</code>. For example, the programmatic version of the preceding snippet of code is:</p><div class="informalexample"><pre class="programlisting">public void addFaceletAction() throws IOException {

  FacesContext context = FacesContext.getCurrentInstance();
  FaceletContext faceletContext = (FaceletContext) context.getAttributes().get(FaceletContext.FACELET_CONTEXT_KEY);

  faceletContext.includeFacelet(context.getViewRoot(), "/files/fileA.xhtml");
  faceletContext.setAttribute("bparam", "file B - text as ui:param via string literal...");
  faceletContext.includeFacelet(context.getViewRoot(), "/files/fileB.xhtml");
  faceletContext.setAttribute("cparam", cfiletext);
  faceletContext.includeFacelet(context.getViewRoot(), "/files/fileC.xhtml");
}</pre></div><p>The complete<a id="id1587" class="indexterm"/> application is named <code class="literal">ch12_22</code>.</p></div><div class="section" title="Creating a TagHandler class"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec126"/>Creating a TagHandler class</h2></div></div></div><p>You already<a id="id1588" class="indexterm"/> know that several Facelets tags<a id="id1589" class="indexterm"/> are tag handlers, while the others are component handlers—in <a class="link" href="ch10.html" title="Chapter 10. JSF Custom Components">Chapter 10</a>, <span class="emphasis"><em>JSF Custom Components</em></span>, you saw how to write a <code class="literal">ComponentHandler</code> class for a custom component. In this section, you will see how to write a <code class="literal">TagHandler</code> class.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note189"/>Note</h3><p>Tag handlers are efficient only when the view tree is built.</p></div></div><p>In order to write a <code class="literal">TagHandler</code> class, you need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Extend the <code class="literal">TagHandler</code> class and override the <code class="literal">apply</code> method; this method process changes on a particular <code class="literal">UIComponent</code> class. Access the tag attributes via the <code class="literal">getAttribute</code> and <code class="literal">getRequiredAttribute</code> methods, which returns a <code class="literal">TagAttribute</code> instance that exposes the attribute value, namespace, local name, tag (the latter is new in JSF 2.2, see the <code class="literal">getTag</code>/<code class="literal">setTag</code> documentation), and so on. Moreover, use the <code class="literal">tag</code> and <code class="literal">tagId</code> fields to refer to the <code class="literal">Tag</code> instance corresponding to this <code class="literal">TagHandler</code> instance. Delegate control to the next tag handler using the <code class="literal">nextHandler</code> field.</li><li class="listitem">Write a <code class="literal">*taglib.xml</code> file to configure the tag namespace, name, and handler class.</li><li class="listitem">Indicate the location of the <code class="literal">*taglib.xml</code> file using the <code class="literal">javax.faces.FACELETS_LIBRARIES</code> context parameter in the <code class="literal">web.xml</code> file.</li></ol></div><p>For example, let's suppose <a id="id1590" class="indexterm"/>that we need the following functionality: we provide a piece of text, the number of times it should be displayed, and the possibility to be displayed in uppercase. We may think of a tag as follows:</p><div class="informalexample"><pre class="programlisting">&lt;t:textrepeat text="Vamos Rafa!" repeat="10" uppercase="yes"/&gt; </pre></div><p>A <code class="literal">TagHandler</code> class can<a id="id1591" class="indexterm"/> be the response to our need. First, we extend the <code class="literal">TagHandler</code> class, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class CustomTagHandler extends TagHandler {

  protected final TagAttribute text;
  protected final TagAttribute repeat;
  protected final TagAttribute uppercase;

  public CustomTagHandler(TagConfig config) {
    super(config);
    this.text = this.getRequiredAttribute("text");
    this.repeat = this.getRequiredAttribute("repeat");
    this.uppercase = this.getAttribute("uppercase");
  }

  @Override
  public void apply(FaceletContext ctx, UIComponent parent) throws IOException {
    String s = "";
    UIOutput child = new HtmlOutputText();
    for (int i = 0; i &lt; Integer.valueOf(repeat.getValue()); i++) {
      s = s + text.getValue() + " ";
    }

    if (uppercase != null) {
      if (uppercase.getValue().equals("yes")) {
        s = s.toUpperCase();
      } else {
        s = s.toLowerCase();
      }
    }

    child.setValue(s);
    parent.getChildren().add(child);

    nextHandler.apply(ctx, parent);
  }
}   </pre></div><p>Furthermore, you need to write the <code class="literal">*taglib.xml</code> file and <a id="id1592" class="indexterm"/>configure<a id="id1593" class="indexterm"/> it in the <code class="literal">web.xml</code> file. The complete application is named <code class="literal">ch12_17</code>.</p></div><div class="section" title="Writing custom Facelets taglib functions"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec127"/>Writing custom Facelets taglib functions</h2></div></div></div><p>When you need <a id="id1594" class="indexterm"/>a value to be evaluated directly in EL, then Facelets taglib functions (or expression functions) are<a id="id1595" class="indexterm"/> a great solution. For example, let's say that we want to encrypt/decrypt text and the result to be placed directly into an EL expression. In order to do this, you need to perform the following general steps of writing a function:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Write a Java <code class="literal">public final</code> class.</li><li class="listitem">In this class, implement the desired functionality using <code class="literal">public static</code> methods.</li><li class="listitem">Write a <code class="literal">*taglib.xml</code> file for linking the <code class="literal">public static</code> methods (functions) with JSF pages. For each <code class="literal">static</code> method, you need to specify the name (<code class="literal">&lt;function-name&gt;</code>), the fully qualified class name that contains the <code class="literal">static</code> method (<code class="literal">&lt;function-class&gt;</code>), and the declaration of the <code class="literal">static</code> method (<code class="literal">&lt;function-signature&gt;</code>).</li><li class="listitem">Indicate the location of the <code class="literal">*taglib.xml</code> file using the <code class="literal">javax.faces.FACELETS_LIBRARIES</code> context parameter in the <code class="literal">web.xml</code> file.</li></ol></div><p>So, based on these steps, we can write a class that contains two functions, one for encryption and one for decryption, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public final class DESFunction {

  ...

  public static String encrypt(String str) {
  ...
  }

  public static String decrypt(String str) {
  ...
  }
}</pre></div><p>The <code class="literal">*taglib.xml</code> file is<a id="id1596" class="indexterm"/> straightforward as can be seen in the following snippet:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;facelet-taglib 
  
  
  xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
  http://java.sun.com/xml/ns/javaee/web-facelettaglibrary_2_0.xsd"version="2.0"&gt;

  &lt;namespace&gt;http://packt.com/encrypts&lt;/namespace&gt;

  &lt;function&gt;
    &lt;function-name&gt;encrypt&lt;/function-name&gt;
    &lt;function-class&gt;book.beans.DESFunction&lt;/function-class&gt;
    &lt;function-signature&gt;String encrypt(java.lang.String)
    &lt;/function-signature&gt;
  &lt;/function&gt;
    
  &lt;function&gt;
    &lt;function-name&gt;decrypt&lt;/function-name&gt;
    &lt;function-class&gt;book.beans.DESFunction&lt;/function-class&gt;
    &lt;function-signature&gt;String decrypt(java.lang.String)
    &lt;/function-signature&gt;
  &lt;/function&gt;
&lt;/facelet-taglib&gt;</pre></div><p>After you configure the<a id="id1597" class="indexterm"/> preceding <code class="literal">*taglib.xml</code> file in <code class="literal">web.xml</code>, you can try to call the encrypt/decrypt functions, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;h:outputText value="#{des:encrypt('Rafael Nadal')}"/&gt;
&lt;h:outputText value="#{des:decrypt('9QnQL04/hGbJj/PqukPb9A==')}"/&gt;</pre></div><p>The complete application<a id="id1598" class="indexterm"/> is named <code class="literal">ch12_16</code>.</p></div></div>
<div class="section" title="Facelets pitfalls"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec111"/>Facelets pitfalls</h1></div></div></div><p>It is a well-known fact that JSF pitfalls are not easy to understand and fix. This is mostly because their roots <a id="id1599" class="indexterm"/>originate in: JSF life cycle, bad practices of using listeners and events, misunderstandings regarding EL processing and evaluation, conflicting combinations of tag handlers with components, and so on.</p><p>In this section, we will focus on three common Facelets pitfalls.</p><div class="section" title="AJAX and &lt;ui:repeat&gt;"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec128"/>AJAX and &lt;ui:repeat&gt;</h2></div></div></div><p>There is a common scenario to<a id="id1600" class="indexterm"/> use AJAX for<a id="id1601" class="indexterm"/> re-rendering the content of an <code class="literal">&lt;ui:repeat&gt;</code> tag. It is<a id="id1602" class="indexterm"/> absolutely intuitive to write something like the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:form&gt;
  &lt;ui:repeat id="playersId" value="#{playersBean.dataArrayList}" var="t"&gt;
    &lt;h:outputText value="#{t.player}" /&gt;
  &lt;/ui:repeat&gt;            
  &lt;h:commandButton value="Half It" action="#{playersBean.halfAction()}"&gt;
    &lt;f:ajax execute="@form" render="playersId" /&gt;
  &lt;/h:commandButton&gt;
&lt;/h:form&gt; </pre></div><p>So, initially, there is a list of <span class="emphasis"><em>n</em></span> players and when we click on the button labeled <span class="strong"><strong>Half It</strong></span>, we want to remove half of the players and re-render the list. The problem is that the preceding snippet of code will not work as expected, because the <code class="literal">&lt;ui:repeat&gt;</code> tag doesn't render HTML code; therefore, there will be no HTML element with the ID, <code class="literal">playersId</code>. Instead of seeing a list with only five players, we will get a <code class="literal">malformedXML</code> error.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note190"/>Note</h3><p>This more of a pitfall of using JSF AJAX with components that do not get rendered as expected.</p></div></div><p>A simple workaround will be to enclose the <code class="literal">&lt;ui:repeat&gt;</code> tag inside a <code class="literal">&lt;div&gt;</code> tag, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:form&gt; 
  &lt;h:panelGroup id="playersId" layout="block"&gt;
    &lt;ui:repeat value="#{playersBean.dataArrayList}" var="t"&gt;
      &lt;h:outputText value="#{t.player}" /&gt;
    &lt;/ui:repeat&gt;
  &lt;/h:panelGroup&gt;
  &lt;h:commandButton value="Half It" action="#{playersBean.halfAction()}"&gt;               
    &lt;f:ajax execute="@form" render="playersId" /&gt;
  &lt;/h:commandButton&gt;
&lt;/h:form&gt;  </pre></div><p>The complete application is named <code class="literal">ch12_26</code>.</p></div><div class="section" title="Exemplifying &lt;c:if&gt; versus &lt;ui:fragment&gt;"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec129"/>Exemplifying &lt;c:if&gt; versus &lt;ui:fragment&gt;</h2></div></div></div><p>Another common scenario<a id="id1603" class="indexterm"/> is to render a table data<a id="id1604" class="indexterm"/> based on a <code class="literal">&lt;c:if&gt;</code> condition, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;h:dataTable value="#{playersBean.dataArrayList}" var="t"&gt;
  &lt;h:column&gt;                
    &lt;c:if test="#{t.age gt 26}"&gt;
      &lt;h:outputText value="#{t.player}, #{t.age}"/&gt;
    &lt;/c:if&gt;
  &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre></div><p>Again, the result <a id="id1605" class="indexterm"/>will not be as expected. The problem is that <code class="literal">&lt;c:if&gt;</code> is a tag handler; therefore, it is efficiently reflected when the tree is built. A perfect workaround will be to replace <code class="literal">&lt;c:if&gt;</code> with the <code class="literal">&lt;ui:fragment&gt;</code> tag, which is a component handler. The <code class="literal">rendered</code> attribute of <code class="literal">&lt;ui:fragment&gt;</code> can successfully replace the <code class="literal">&lt;c:if&gt;</code> test using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:dataTable value="#{playersBean.dataArrayList}" var="t"&gt;
  &lt;h:column&gt;
    &lt;ui:fragment rendered="#{t.age gt 26}"&gt;
      &lt;h:outputText value="#{t.player}, #{t.age}"/&gt;
    &lt;/ui:fragment&gt;
  &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre></div><p>Alternatively, in an even simpler way, use the <code class="literal">rendered</code> attribute of <code class="literal">&lt;h:outputText&gt;</code>; this approach is particular to this example:</p><div class="informalexample"><pre class="programlisting">&lt;h:dataTable value="#{playersBean.dataArrayList}" var="t"&gt;
  &lt;h:column&gt;   
    &lt;h:outputText value="#{t.player}, #{t.age}" rendered="#{t.age gt 26}"/&gt; 
  &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre></div><p>Instead, even cooler, using a lambda expression (EL 3.0), you can write the following code:</p><div class="informalexample"><pre class="programlisting">&lt;h:dataTable value="#{(playersBean.dataArrayList.stream().filter((p)-&gt;p.age gt 26 )).toList()}" var="t"&gt;
  &lt;h:column&gt;                               
    &lt;h:outputText value="#{t.player}, #{t.age}"/&gt;
  &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre></div><p>The complete application is named <code class="literal">ch12_20</code>.</p></div><div class="section" title="Exemplifying &lt;c:forEach&gt; versus &lt;ui:repeat&gt;"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec130"/>Exemplifying &lt;c:forEach&gt; versus &lt;ui:repeat&gt;</h2></div></div></div><p>Apparently, you may think that<a id="id1606" class="indexterm"/> the <code class="literal">&lt;ui:repeat&gt;</code>/<code class="literal">&lt;ui:include&gt;</code> pair is the perfect choice for including a list of Facelets pages using the following code:</p><div class="informalexample"><pre class="programlisting">&lt;ui:repeat value="#{filesBean.filesList}" var="t"&gt;
  &lt;ui:include src="#{t}"/&gt;
&lt;/ui:repeat&gt;</pre></div><p>Well, the <code class="literal">&lt;ui:include&gt;</code> tag <a id="id1607" class="indexterm"/>is a tag handler; therefore it will be available when the view is built, while the <code class="literal">&lt;ui:repeat&gt;</code> tag is a<a id="id1608" class="indexterm"/> component handler available during the rendering process. In other words, when <code class="literal">&lt;ui:include&gt;</code> needs the <code class="literal">t</code> variable, <code class="literal">&lt;ui:repeat&gt;</code> is not available. Therefore, <code class="literal">&lt;ui:repeat&gt;</code> should be replaced by a tag handler, as <code class="literal">&lt;c:forEach&gt;</code>, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;c:forEach items="#{filesBean.filesList}" var="t"&gt;
  &lt;ui:include src="#{t}"/&gt;
&lt;/c:forEach&gt;</pre></div><p>The complete application is named <code class="literal">ch12_21</code>.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec112"/>Summary</h1></div></div></div><p>Facelets is a large subject with many interesting aspects which are pretty hard to cover in a few chapters of a book. As you know, there are books entirely dedicated to Facelets, but I hope that in the final three chapters I managed to cover a decent part of the JSF 2.2 default VDL. Probably, the most used part of Facelets is templating; therefore, I have tried to cover some handy techniques for writing flexible and cool templates. Of course, besides skills and techniques, writing templates is also a test of the imagination. Once we master the Facelets tags and choose the right techniques, we are ready to start writing templates. If we choose some naming conventions as well, then we can easily share our templates with the JSF world, like Mamadou Lamine Ba tried in a Java.Net project at <a class="ulink" href="https://weblogs.java.net/blog/lamineba/archive/2011/10/03/conventional-ui-design-facelets-and-jsf-22">https://weblogs.java.net/blog/lamineba/archive/2011/10/03/conventional-ui-design-facelets-and-jsf-22</a>. In addition, if we spice up our template files with some Facelets programmatic tricks, then we can really rock the world of JSF templating!</p></div></body></html>