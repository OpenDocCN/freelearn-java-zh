<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Securing JEE Applications</h1>
                
            
            <article>
                
<p class="calibre3">In the previous chapter, we learned how to deploy JEE applications in the cloud. In this chapter, we will learn how to secure JEE applications—specifically, how to perform authentication and authorization.</p>
<p class="calibre3">We will cover the following topics:</p>
<ul class="calibre10">
<li class="calibre11">Securing JEE web applications using deployment descriptors</li>
<li class="calibre11">Securing JEE web applications using annotations</li>
<li class="calibre11">Securing web services</li>
<li class="calibre11">Security enhancements in JEE 8</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Authentication and authorization in JEE</h1>
                
            
            <article>
                
<p class="calibre3">Authentication is the process of verifying that the user is who he or she is claiming to be. This is typically done by asking the user to provide a username and password. Another way to verify the client identity is by asking for client certificates. In this chapter, we will look at password authentication only.</p>
<p class="calibre3">Authorization is the process of determining whether a user is allowed to perform certain actions in the application. The JEE specification allows role-based authorization. In the application, you specify roles that can perform an action, or access a resource, and then add users to these roles.</p>
<p class="calibre3">Unfortunately, securing JEE applications, as per JEE specifications, is not completely server-independent. There are parts of the configuration that are common across servers, and there are parts that are specific to server vendors. Common configurations are mostly done in <kbd class="calibre13">web.xml</kbd> or by using annotations. But, server-specific configurations vary from vendor to vendor. In this chapter, we will learn how to secure JEE applications in GlassFish and Tomcat servers.</p>
<p class="calibre3">But, before we learn details about securing applications, we need to understand certain terms commonly used in configurations, in the context of security:</p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">User</strong>: A client requesting access to a protected resource in an application</li>
<li class="calibre11"><strong class="calibre1">Group</strong>: A set of users with similar characteristics</li>
<li class="calibre11"><strong class="calibre1">Role</strong>: Determines what resources can be accessed in an application, by a user or group, with that particular role</li>
<li class="calibre11"><strong class="calibre1">Realm</strong>: Can be considered a security domain, with its own users, groups, and storage method</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Modifying a database to save authentication information</h1>
                
            
            <article>
                
<p class="calibre3">In this chapter, we will use a database to authenticate users. Other methods used to store security information include files and LDAP. We will need to update our <kbd class="calibre13">course_management</kbd> database with tables to store information about users and groups. Let's create three tables—<kbd class="calibre13">User</kbd>, <kbd class="calibre13">Groups</kbd>, and <kbd class="calibre13">User_Group</kbd>:</p>
<div class="packt_figure1"><img src="../images/00268.jpeg" class="calibre257"/></div>
<div class="packt_figure1">Figure 14.1: New tables for authentication</div>
<p class="calibre3">The <kbd class="calibre13">User</kbd> table stores the username and password. The <kbd class="calibre13">Groups</kbd> table stores the group names. We will group names directly into roles later. The <kbd class="calibre13">User_Group</kbd> table is a joint table, joining the <kbd class="calibre13">User</kbd> and <kbd class="calibre13">Groups</kbd> tables. One user can be in many groups, and one group can have many users.</p>
<p class="calibre3">To simplify mapping information from the preceding tables when configuring realms in JEE servers, we will create a view, named <kbd class="calibre13">user_group_view</kbd>, that makes information from all the preceding tables available in one view. The DDL script for the view is as follows:</p>
<pre class="calibre25">CREATE<br class="title-page-name"/>VIEW `user_group_view` AS<br class="title-page-name"/>    SELECT<br class="title-page-name"/>        `user`.`user_name` AS `user_name`,<br class="title-page-name"/>        `groups`.`group_name` AS `group_name`,<br class="title-page-name"/>        `user`.`password` AS `password`<br class="title-page-name"/>    FROM<br class="title-page-name"/>        ((`user`<br class="title-page-name"/>        JOIN `groups`)<br class="title-page-name"/>        JOIN `user_group`)<br class="title-page-name"/>    WHERE<br class="title-page-name"/>        ((`user`.`id` = `user_group`.`user_id`)<br class="title-page-name"/>            AND (`groups`.`id` = `user_group`.`group_id`))</pre>
<p class="calibre3">If you already have the <kbd class="calibre13">course_management</kbd> schema from earlier chapters, then run the script in the <span class="calibre12"><kbd class="calibre13">add_auth_tables.sql</kbd> </span>file (the file is in the source code folder for this chapter). If you are using <kbd class="calibre13">MySQLWorkbench</kbd>, you can run the script as follows:</p>
<ol class="calibre14">
<li value="1" class="calibre11">Make sure <kbd class="calibre13">course_management</kbd> is the default schema; right-click on the schema and select the <span>Set as Default Schema</span> option.</li>
<li value="2" class="calibre11">Select the <span>File</span> | <span>Open SQL Script </span>menu, and then select the <kbd class="calibre13">add_auth_tables.sql</kbd> file. The file will open in a new tab.</li>
<li value="3" class="calibre11">Click on the <span>Execute</span> icon in the toolbar to execute this script.</li>
<li value="4" class="calibre11">Right-click on the <span>course_management</span> schema and select the <span>Refresh All</span> option. Make sure the new tables and the view are created in the schema.</li>
</ol>
<p class="calibre3">For testing purpose, let's insert the following data in the <kbd class="calibre13">user</kbd> table<strong class="calibre5">:</strong></p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52"><strong class="calibre1">ID</strong></td>
<td class="calibre52"><strong class="calibre1">user_name</strong></td>
<td class="calibre52"><strong class="calibre1">password</strong></td>
</tr>
<tr class="calibre51">
<td class="calibre52"><kbd class="calibre13">1</kbd></td>
<td class="calibre52"><kbd class="calibre13">user1</kbd></td>
<td class="calibre52"><kbd class="calibre13">user1_pass</kbd></td>
</tr>
<tr class="calibre51">
<td class="calibre52"><kbd class="calibre13">2</kbd></td>
<td class="calibre52"><kbd class="calibre13">user2</kbd></td>
<td class="calibre52"><kbd class="calibre13">user2_pass</kbd></td>
</tr>
</tbody>
</table>
<p class="calibre3"><kbd class="calibre13">Groups</kbd><strong class="calibre5">:</strong></p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52"><strong class="calibre1">ID</strong></td>
<td class="calibre52"><strong class="calibre1">group_name</strong></td>
</tr>
<tr class="calibre51">
<td class="calibre52"><kbd class="calibre13">1</kbd></td>
<td class="calibre52"><kbd class="calibre13">admin</kbd></td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3"><kbd class="calibre13">User_Group</kbd><strong class="calibre5">:</strong></p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52"><strong class="calibre1">user_ID</strong></td>
<td class="calibre52"><strong class="calibre1">group_ID</strong></td>
</tr>
<tr class="calibre51">
<td class="calibre52"><kbd class="calibre13">1</kbd></td>
<td class="calibre52"><kbd class="calibre13">1</kbd></td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">As per the preceding data, <kbd class="calibre13">user1</kbd> is in the admin group, and <kbd class="calibre13">user2</kbd> is not in any group.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Securing applications in GlassFish</h1>
                
            
            <article>
                
<p class="calibre3">We will use the <em class="calibre21">Course Management</em> application that we developed in <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a>, <em class="calibre21">Creating JEE Applications with EJB</em>, to add security features. Follow these steps to import projects:</p>
<ol class="calibre14">
<li value="1" class="calibre11">Create a new Eclipse workspace for this chapter.</li>
<li value="2" class="calibre11">Copy all the projects in the source code folder for <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a><span>, </span><em class="calibre2">Creating JEE Applications with EJB,</em> inside the <kbd class="calibre13">with-maven</kbd> folder, to the current workspace.</li>
<li value="3" class="calibre11">Import all the projects into the new workspace (open the <span>File</span> | <span>Import</span> menu and then select <span>Maven</span> | <span>Existing Maven Projects</span>).</li>
</ol>
<p class="calibre3">You should now have the following projects in your Eclipse workspace: <kbd class="calibre13">CourseManagementMavenEAR</kbd>, <kbd class="calibre13">CourseManagementMavenEJBClient</kbd>, <kbd class="calibre13">CourseManagementMavenEJBs</kbd>, and <kbd class="calibre13">CourseManagementMavenWebApp</kbd>. Let's now learn how to protect access to JSPs in a folder.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Protecting access to folders in web applications</h1>
                
            
            <article>
                
<p class="calibre3">To protect any resources in a web folder, you need to declare security constraints in <kbd class="calibre13">web.xml</kbd>. In the security constraints, you can declare URLs that are to be protected, and which roles can access the protected URLs. Open <kbd class="calibre13">web.xml</kbd> in the <kbd class="calibre13">CourseManagementMavenWebApp</kbd> <span class="calibre12">project</span><span class="calibre12"> </span><span class="calibre12">and add the following declarations within the </span><kbd class="calibre13">&lt;web-app&gt;</kbd> <span class="calibre12">tag:</span></p>
<pre class="calibre25">&lt;security-constraint&gt;<br class="title-page-name"/>    &lt;display-name&gt;Admin resources&lt;/display-name&gt;<br class="title-page-name"/>    &lt;web-resource-collection&gt;<br class="title-page-name"/>        &lt;web-resource-name&gt;admins&lt;/web-resource-name&gt;<br class="title-page-name"/>        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;<br class="title-page-name"/>    &lt;/web-resource-collection&gt;<br class="title-page-name"/>    &lt;auth-constraint&gt;<br class="title-page-name"/>        &lt;role-name&gt;admin &lt;/role-name&gt;<br class="title-page-name"/>    &lt;/auth-constraint&gt;<br class="title-page-name"/>    &lt;!--         <br class="title-page-name"/>    &lt;user-data-constraint&gt;<br class="title-page-name"/>        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;<br class="title-page-name"/>    &lt;/user-data-constraint&gt;<br class="title-page-name"/>    --&gt;<br class="title-page-name"/>&lt;/security-constraint&gt;<br class="title-page-name"/>&lt;security-role&gt;<br class="title-page-name"/>    &lt;description&gt;Admins&lt;/description&gt;<br class="title-page-name"/>    &lt;role-name&gt;admin&lt;/role-name&gt;<br class="title-page-name"/>&lt;/security-role&gt;</pre>
<p class="calibre3">Here, we are declaring all the resources accessed with the <kbd class="calibre13">/admin/*</kbd><q class="calibre207"> </q><span class="calibre12">URL</span><span class="calibre12"> </span><span class="calibre12">to be protected, and also that only users in the</span> <kbd class="calibre13">admin</kbd> <span class="calibre12">role can access these resources. We are also declaring the</span> <kbd class="calibre13">admin</kbd> <span class="calibre12">role using the </span><kbd class="calibre13">&lt;security-role&gt;</kbd> <span class="calibre12">tag. If you want the URL resources to be accessed only over SSL (using HTTPS), then set</span> <kbd class="calibre13">&lt;transport-guarantee&gt;</kbd> <span class="calibre12">to</span> <kbd class="calibre13">CONFIDENTIAL</kbd><span class="calibre12">. However, you will need to obtain (buy) an SSL certificate from certificate authorities, such as Verisign, and install it on the server.</span></p>
<div class="packt_tip"><br class="calibre26"/>
See <a href="https://www.verisign.com/en_US/website-presence/website-optimization/ssl-certificates/index.xhtml" class="calibre17">https://www.verisign.com/en_US/website-presence/website-optimization/ssl-certificates/index.xhtml</a> for details about SSL certificates.</div>
<p class="calibre3">Each server has a different process for installing the certificates. However, we will not discuss how to install an SSL certificate in this book. Therefore, the <kbd class="calibre13">&lt;user-data-constraint&gt;</kbd> configuration is described in the preceding code.</p>
<div class="packt_infobox"><br class="calibre26"/>
See <a href="https://javaee.github.io/tutorial/security-webtier002.html#specifying-security-constraints" class="calibre17">https://javaee.github.io/tutorial/security-webtier002.html#specifying-security-constraints</a> for more details on security constraints.</div>
<p class="calibre3">At this point, let’s see how the application works. Before deploying the application in GlassFish, let's create a protected resource. Since we have protected all the <span class="calibre12">accessed</span><span class="calibre12"> </span><span class="calibre12">resources using the </span><kbd class="calibre13">/admin/*</kbd> <span class="calibre12">URL, create a folder named</span> <kbd class="calibre13">admin</kbd> <span class="calibre12">in the </span><kbd class="calibre13">src/main/webapp</kbd> <span class="calibre12">folder. Inside this folder, create</span> <kbd class="calibre13">admin.jsp</kbd> <span class="calibre12">using the following content:</span></p>
<pre class="calibre25">&lt;!DOCTYPE HTML&gt;<br class="title-page-name"/>&lt;html&gt;<br class="title-page-name"/>&lt;head&gt;<br class="title-page-name"/>&lt;title&gt;Course Management Admin&lt;/title&gt;<br class="title-page-name"/>&lt;/head&gt;<br class="title-page-name"/>&lt;body&gt;<br class="title-page-name"/>       Welcome to Course Management Admin&lt;br&gt;<br class="title-page-name"/>&lt;/body&gt;<br class="title-page-name"/>&lt;/html&gt;</pre>
<div class="packt_infobox"><br class="calibre26"/>
Refer to the <q class="calibre258">Configuring GlassFish server in Eclipse</q> section in <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre17">Chapter 7</a>, <em class="calibre129">Creating JEE Applications with EJB</em>, for information on adding the GlassFish 5 Server to your Eclipse workspace.</div>
<p class="calibre3">We need to build two applications: <kbd class="calibre13">CourseManagementMavenWebApp</kbd> and <kbd class="calibre13">CourseManagementMavenEAR</kbd>. The EAR project is just a container project; the real content is served from <kbd class="calibre13">CourseManagementMavenWebApp</kbd>. So, we need to build both projects. Right-click on <kbd class="calibre13">CourseManagementMavenWebApp</kbd> in Eclipse <span class="calibre12">Project Explorer</span>, and select <span class="calibre12">Run As</span> | <span class="calibre12">Maven Install</span>. Do the same for the <kbd class="calibre13">CourseManagementMavenEAR</kbd><q class="calibre207"> </q><span class="calibre12">project.</span><span class="calibre12"> </span><span class="calibre12">Then, deploy</span> <kbd class="calibre13">CourseManagementMavenEAR-1.ear</kbd> <span class="calibre12">from the target folder in GlassFish 5.</span></p>
<div class="packt_infobox">To deploy the application in GlassFish 5, browse to <kbd class="calibre48">http://localhost:4848</kbd> and configure the datasource, as described in the <q class="calibre258">Configuring Datasource in GlassFish</q> s<span class="calibre23">ection</span><span class="calibre23"> i</span><span class="calibre23">n <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre17">Chapter 7</a>, <em class="calibre129">Creating JEE Applications with EJB</em>. Then, click on the <span class="calibre23">Application</span> node and deploy</span> <kbd class="calibre48">CourseManagementMavenEAR-1.ear</kbd><q class="calibre258">.</q></div>
<p class="calibre3">Once the application is deployed, browse to <kbd class="calibre13">http://localhost:8080/CourseManagementMavenWebApp/course.xhtml</kbd> and make sure the page can be accessed without any authentication required, because this is an unprotected resource/page. Now, try to browse to <kbd class="calibre13">http://localhost:8080/CourseManagementMavenWebApp/admin/admin.jsp</kbd>. Since we have marked the <kbd class="calibre13">/admin/*</kbd> URL pattern as a protected resource, the browser pops up this authentication dialog box:</p>
<div class="packt_figure1"><img src="../images/00269.jpeg" class="calibre259"/></div>
<div class="packt_figure1">Figure 14.2: Browser authentication dialog box</div>
<p class="calibre3">We have not configured our application to authenticate the user. So, authentication will fail in the preceding dialog box, no matter what you enter as the username and password. Let’s fix this by configuring the database to authenticate users in GlassFish.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Configuring a JDBC realm in GlassFish</h1>
                
            
            <article>
                
<p class="calibre3">GlassFish supports different realms for JEE authentication; for example, file, LDAP, and JDBC realms. We are going to create a JDBC realm, which will use the information stored in the <kbd class="calibre13">User</kbd>, <kbd class="calibre13">Groups</kbd><span class="calibre12">,</span> and <kbd class="calibre13">User_Groups</kbd> tables (exposed by <kbd class="calibre13">user_group_view</kbd>).</p>
<p class="calibre3">To create a new JDBC realm in GlassFish, browse to the GlassFish admin page (<kbd class="calibre13">http://localhost:4848</kbd>), and in the navigation menu on the left-hand side, go to <span class="calibre12">Configurations</span> | <span class="calibre12">server-config</span> | <span class="calibre12">Security</span> | <span class="calibre12">Realms</span>. On the <span class="calibre12">Realms</span> page, click on the <span class="calibre12">New</span> button.</p>
<div class="packt_figure1"><img src="../images/00270.jpeg" class="calibre260"/></div>
<div class="packt_figure1">Figure 14.3: Creating a JDBC realm on the GlassFish admin page</div>
<p class="calibre3">Enter the following information into the form:</p>
<p class="calibre3">Class name</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><strong class="calibre5">Field name</strong></p>
</td>
<td class="calibre262">
<p class="calibre3"><strong class="calibre5">Value</strong></p>
</td>
<td class="calibre263">
<p class="calibre3"><strong class="calibre5">Notes</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Name</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">courseManagementJDBCRealm</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3"> </p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"> </p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">com.sun.enterprise.security.auth.realm.jdbc.JDBCRealm</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">Select from the drop-down menu.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">JAAS Context</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">jdbcRealm</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3"> </p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">JNDI</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">jdbc/CourseManagement</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The JDBC data source we have created. See <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a><span class="calibre12">, </span><em class="calibre21">Creating JEE Applications with EJB,</em> for more details.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">User Table</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">user_group_view</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The table containing the user information. We specify the view that we created earlier.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Username Column</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">user_name</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The username column in our <kbd class="calibre13">user_group_view</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Password Column</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">password</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The password column in our <kbd class="calibre13">user_group_view</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Group Table</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">user_group_view</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The group data is also exposed through our <kbd class="calibre13">user_group_view</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Group Table Username Column</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">user_name</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">In <kbd class="calibre13">user_group_view</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Group Name Column</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">group_name</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">In <kbd class="calibre13">user_group_view</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Password Encryption Algorithm</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">AES</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The algorithm to encrypt passwords in the database. We are pre-populated passwords outside the application. So, this does not have much impact on our example.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre261">
<p class="calibre3"><span class="calibre12">Digest Algorithm</span></p>
</td>
<td class="calibre262">
<p class="calibre3"><kbd class="calibre13">none</kbd></p>
</td>
<td class="calibre263">
<p class="calibre3">The passwords we entered in the table are not hashed, so enter <kbd class="calibre13">none</kbd> here.</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">Click on the <span class="calibre12">OK</span> button to create the realm. </p>
<p class="calibre3">We need to tell our application to use the JDBC realm created earlier. This is configured in the <kbd class="calibre13">web.xml</kbd> of the application, in the <kbd class="calibre13">&lt;login-config&gt;</kbd> tag. Two authentication methods are supported in <kbd class="calibre13">&lt;long-config&gt;</kbd>: basic and form-based.</p>
<p class="calibre3">In basic authentication, the browser displays the login form, just as in <em class="calibre21">Figure 14.2</em>. In fact, this is the default authentication method, so in the absence of the <kbd class="calibre13">&lt;login-config&gt;</kbd> tag in our <kbd class="calibre13">web.xml</kbd> previously, the server defaults to basic authentication.</p>
<p class="calibre3">In form-based authentication, you can specify the login <span class="calibre12">page</span><span class="calibre12">. This gives you a chance to customize the login experience.</span></p>
<p class="calibre3">Let's first configure the realm using basic authentication.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Basic authentication with the JDBC realm in GlassFish</h1>
                
            
            <article>
                
<p class="calibre3">We will make some changes to the tags we added to configure security in the <em class="calibre21">Protecting access to folders in web applications</em><q class="calibre207"> </q><span class="calibre12">section</span><span class="calibre12">. Here are the changes:</span></p>
<ol class="calibre14">
<li value="1" class="calibre11">Rename <kbd class="calibre13">role-name</kbd> from <kbd class="calibre13">admin</kbd> to <kbd class="calibre13">admin-role</kbd></li>
<li value="2" class="calibre11">Remove the <kbd class="calibre13">&lt;security-role&gt;</kbd> tag</li>
<li value="3" class="calibre11">Add the <kbd class="calibre13">&lt;login-config&gt;</kbd> tag</li>
</ol>
<p class="calibre3">Here is what the changed declaration should look like:</p>
<pre class="calibre25">&lt;security-constraint&gt;<br class="title-page-name"/>    &lt;display-name&gt;Admin resources&lt;/display-name&gt;<br class="title-page-name"/>    &lt;web-resource-collection&gt;<br class="title-page-name"/>        &lt;web-resource-name&gt;admins&lt;/web-resource-name&gt;<br class="title-page-name"/>        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;<br class="title-page-name"/>    &lt;/web-resource-collection&gt;<br class="title-page-name"/>    &lt;auth-constraint&gt;<br class="title-page-name"/>        &lt;role-name&gt;admin-role&lt;/role-name&gt;<br class="title-page-name"/>    &lt;/auth-constraint&gt;<br class="title-page-name"/>&lt;/security-constraint&gt;<br class="title-page-name"/>&lt;login-config&gt;<br class="title-page-name"/>    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;<br class="title-page-name"/>    &lt;realm-name&gt;courseManagementJDBCRealm&lt;/realm-name&gt;<br class="title-page-name"/>&lt;/login-config&gt;</pre>
<p class="calibre3">Note that we specified the name of the realm we configured (on the GlassFish admin page) in the <kbd class="calibre13">&lt;login-config&gt;</kbd> tag. We removed <kbd class="calibre13">&lt;security-role&gt;</kbd> because roles are now saved in the database, in the <span class="calibre12">Groups</span> table. However, we need to map the roles declared in <kbd class="calibre13">web.xml</kbd> to groups in the database.  This mapping is done in <kbd class="calibre13">glassfish-web.xml</kbd>. Create <kbd class="calibre13">glassfish-web.xml</kbd> in the same folder as that of <kbd class="calibre13">web.xml</kbd>, that is, <kbd class="calibre13">src/main/webapp/WEB-INF</kbd>, in the <kbd class="calibre13">CourseManagementMavenWebApp</kbd><q class="calibre207"> </q><span class="calibre12">project.</span><span class="calibre12"> Add the following content to it:</span></p>
<pre class="calibre25">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br class="title-page-name"/>&lt;!DOCTYPE glassfish-web-app PUBLIC "-//GlassFish.org//DTD GlassFish Application Server 3.1 Servlet 3.0//EN" "http://glassfish.org/dtds/glassfish-web-app_3_0-1.dtd"&gt;<br class="title-page-name"/>&lt;glassfish-web-app error-url=""&gt;<br class="title-page-name"/>    &lt;security-role-mapping&gt;<br class="title-page-name"/>       &lt;role-name&gt;admin-role&lt;/role-name&gt;<br class="title-page-name"/>       &lt;group-name&gt;admin&lt;/group-name&gt;<br class="title-page-name"/>    &lt;/security-role-mapping&gt;<br class="title-page-name"/>&lt;/glassfish-web-app&gt;</pre>
<p class="calibre3">Here, we are mapping <span class="calibre12">admin-role</span>, which we declared in <kbd class="calibre13">web.xml</kbd>, with the <span class="calibre12">admin</span> group in the <span class="calibre12">Groups</span> table in the database.</p>
<p class="calibre3">Now, build the <kbd class="calibre13">CourseManagementMavenWebApp</kbd> and <kbd class="calibre13">CourseManagementMavenEAR</kbd> <span class="calibre12">projects</span><span class="calibre12"> </span><span class="calibre12">(in the same order) by right-clicking on the projects and selecting</span> <span class="calibre12">Run As</span> <span class="calibre12">|</span> <span class="calibre12">Maven Install</span><span class="calibre12">, and then deploy the application in GlassFish as described in the </span><em class="calibre21">Protecting access to folders in web applications</em><q class="calibre207"> </q><span class="calibre12">section.</span><span class="calibre12"> </span></p>
<p class="calibre3">Browse to <kbd class="calibre13">http://localhost:8080/CourseManagementMavenWebApp/admin/admin.jsp</kbd>. This time, the browser should display the contents of <kbd class="calibre13">admin.jsp</kbd>, once you enter the valid admin credentials; that is, the username as <kbd class="calibre13">user1</kbd>, and the password as <kbd class="calibre13">user1_pass</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Form-based authentication with a JDBC realm in GlassFish</h1>
                
            
            <article>
                
<p class="calibre3">Let's change basic authentication to form-based authentication, so that we can customize the login page. We need to update <kbd class="calibre13">&lt;login-config&gt;</kbd> in <kbd class="calibre13">web.xml</kbd>. Replace the previous <kbd class="calibre13">&lt;login-config&gt;</kbd> block with the following:</p>
<pre class="calibre25">&lt;login-config&gt;<br class="title-page-name"/>    &lt;auth-method&gt;FORM&lt;/auth-method&gt;<br class="title-page-name"/>    &lt;realm-name&gt;courseManagementJDBCRealm&lt;/realm-name&gt;<br class="title-page-name"/>    &lt;form-login-config&gt;<br class="title-page-name"/>        &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;<br class="title-page-name"/>        &lt;form-error-page&gt;/login-error.jsp&lt;/form-error-page&gt;<br class="title-page-name"/>    &lt;/form-login-config&gt;<br class="title-page-name"/>&lt;/login-config&gt;</pre>
<p class="calibre3">We have replaced <kbd class="calibre13">&lt;auth-method&gt;</kbd> from <span class="calibre12">BASIC</span> to <span class="calibre12">FORM</span>. For form-based authentication, we need to specify <span class="calibre12">form-login-page</span>, which we have specified as <kbd class="calibre13">login.jsp</kbd>. <span class="calibre12">form-error-page</span> is optional, but we have set that to <kbd class="calibre13">login-error.jsp</kbd>.</p>
<p class="calibre3">The next step is to create <kbd class="calibre13">login.jsp</kbd> and <kbd class="calibre13">login-error.jsp</kbd>. Create both the files in the <kbd class="calibre13">src/main/webapp</kbd> <span class="calibre12">folder</span><span class="calibre12"> with the following contents.</span></p>
<p class="calibre3">Here is the source code of <kbd class="calibre13">login.jsp</kbd>. We have configured it as the login page in <kbd class="calibre13">&lt;form-login-page&gt;</kbd>, as shown in the preceding code block:</p>
<pre class="calibre25">&lt;!DOCTYPE HTML&gt;<br class="title-page-name"/>&lt;html&gt;<br class="title-page-name"/>&lt;head&gt;<br class="title-page-name"/>&lt;title&gt;Admin Login&lt;/title&gt;<br class="title-page-name"/>&lt;/head&gt;<br class="title-page-name"/>&lt;body&gt;<br class="title-page-name"/>    &lt;form method=post action="j_security_check"&gt;<br class="title-page-name"/>        &lt;table&gt;<br class="title-page-name"/>            &lt;tr&gt;<br class="title-page-name"/>                &lt;td&gt;User Name: &lt;/td&gt;<br class="title-page-name"/>                &lt;td&gt;&lt;input type="text" name="j_username"&gt;&lt;/td&gt;<br class="title-page-name"/>            &lt;/tr&gt;<br class="title-page-name"/>            &lt;tr&gt;<br class="title-page-name"/>               &lt;td&gt;Password: &lt;/td&gt;<br class="title-page-name"/>               &lt;td&gt;&lt;input type="password" name="j_password"&gt;&lt;/td&gt;<br class="title-page-name"/>            &lt;/tr&gt;<br class="title-page-name"/>            &lt;tr&gt;<br class="title-page-name"/>                &lt;td colspan="2"&gt;&lt;input type="submit" value="Login"&gt;&lt;/td&gt;<br class="title-page-name"/>            &lt;/tr&gt;<br class="title-page-name"/>        &lt;/table&gt;<br class="title-page-name"/>    &lt;/form&gt;<br class="title-page-name"/>&lt;/body&gt;<br class="title-page-name"/>&lt;/html&gt;</pre>
<p class="calibre3">For form-based authentication to work, there are certain requirements:</p>
<ol class="calibre14">
<li value="1" class="calibre11">The form action must be set to <kbd class="calibre13">j_security_check</kbd></li>
<li value="2" class="calibre11">The username input field must be named <kbd class="calibre13">j_username</kbd></li>
<li value="3" class="calibre11">The password input field must be named <kbd class="calibre13">j_password</kbd></li>
</ol>
<p class="calibre3">Here is the source code of<span class="calibre12"> </span><kbd class="calibre13">login-error.jsp</kbd>. We have configured it as the error page in<span class="calibre12"> </span><kbd class="calibre13">&lt;form-error-page&gt;</kbd>, as shown in the previous code block:</p>
<pre class="calibre25">&lt;!DOCTYPE HTML&gt;<br class="title-page-name"/>&lt;html&gt;<br class="title-page-name"/>&lt;head&gt;<br class="title-page-name"/>&lt;title&gt;Login Failed&lt;/title&gt;<br class="title-page-name"/>&lt;/head&gt;<br class="title-page-name"/>&lt;body&gt;<br class="title-page-name"/>       Invalid user name or password&lt;br&gt;<br class="title-page-name"/>       &lt;a href="&lt;%=request.getContextPath()%&gt;/admin/admin.jsp"&gt;Try Again&lt;/a&gt;<br class="title-page-name"/>&lt;/body&gt;<br class="title-page-name"/>&lt;/html&gt;</pre>
<p class="calibre3">The error page shows the error message and displays the link to try again. Even though the link <span class="calibre12">Try Again</span> points to <kbd class="calibre13">admin.jsp</kbd>, because it is a protected resource, the user will be redirected to <kbd class="calibre13">login.jsp</kbd>. If the login is successful, then redirection to <kbd class="calibre13">admin.jsp</kbd> will happen.</p>
<p class="calibre3">It would be nice to provide an option to log out after the user has successfully logged in. This option can be added to <kbd class="calibre13">admin.jsp</kbd>. Add a link to log out in <kbd class="calibre13">admin.jsp</kbd> as follows:</p>
<pre class="calibre25">&lt;!DOCTYPE HTML&gt;<br class="title-page-name"/>&lt;html&gt;<br class="title-page-name"/>&lt;head&gt;<br class="title-page-name"/>&lt;title&gt;Course Management Admin&lt;/title&gt;<br class="title-page-name"/>&lt;/head&gt;<br class="title-page-name"/>&lt;body&gt;<br class="title-page-name"/>       Welcome to Course Management Admin&lt;br&gt;<br class="title-page-name"/>       &lt;a href="../logout.jsp"&gt;Logout&lt;/a&gt;<br class="title-page-name"/>&lt;/body&gt;<br class="title-page-name"/>&lt;/html&gt;</pre>
<p class="calibre3">Create <kbd class="calibre13">logout.jsp</kbd> in the same folder as <kbd class="calibre13">login.jsp</kbd> with the following content:</p>
<pre class="calibre25">&lt;%@ page session="true"%&gt;<br class="title-page-name"/>Logged out &lt;%=request.getRemoteUser()%&gt;<br class="title-page-name"/>&lt;% session.invalidate(); %&gt;</pre>
<p class="calibre3">The logout page simply calls <kbd class="calibre13">session.invalidate()</kbd> to log the user out.</p>
<p class="calibre3">To see form-based authentication in action, build the <kbd class="calibre13">CourseManagementMavenWebApp</kbd> and <kbd class="calibre13">CourseManagementMavenEAR</kbd> proj<span class="calibre12">ects</span><span class="calibre12"> </span><span class="calibre12">(in the same order) by right-clicking on the projects and selecting</span> <span class="calibre12">Run As</span> <span class="calibre12">|</span> <span class="calibre12">Maven Install</span><span class="calibre12">, and then deploy the application in GlassFish, as described in the </span><em class="calibre21">Protecting access to folders in web applications</em><q class="calibre207"> </q><span class="calibre12">section.</span><span class="calibre12"> </span></p>
<p class="calibre3">Browse to <kbd class="calibre13">http://localhost:8080/CourseManagementMavenWebApp/admin/admin.jsp</kbd>. This time, the browser should display <kbd class="calibre13">login.jsp</kbd>, with the login form, instead of its own pop-up window for authentication.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Securing applications in Tomcat</h1>
                
            
            <article>
                
<p class="calibre3">In this section, we will learn how to protect resources in the Tomcat server. To keep the example consistent with the one we learned in the previous section for GlassFish, we will protect all pages in the <kbd class="calibre13">admin</kbd> folder. We will use the <kbd class="calibre13">CourseManagementJDBC</kbd> project we created in <a href="part0073.html#25JP20-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 4</a>, <em class="calibre21">Creating JEE Database Applications</em>, to get started. Recall that in <a href="https://cdp.packtpub.com/java_ee_development_with_eclipse___third_edition/wp-admin/post.php?post=378&amp;action=edit#post_216" class="calibre9">Chapter 4</a><span class="calibre12">, </span><em class="calibre21">Creating JEE Database Applications</em>, we deployed this project in the Tomcat server. Perform the following steps to import a project into the new workspace for this chapter and configure Tomcat:</p>
<ol class="calibre14">
<li value="1" class="calibre11">Copy the <kbd class="calibre13">CourseManagementJDBC</kbd> project from the <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a><span>, </span><em class="calibre2">Creating JEE Applications with EJB,</em> project folder to the current workspace. Import the project into the new workspace (open the <span>File</span> | <span>Import</span> menu and then select <span>Maven</span> | <span>Existing Maven Projects</span>).</li>
<li value="2" class="calibre11">Configure Tomcat, as described in the <em class="calibre2">Configuring Tomcat in Eclipse</em><q class="calibre207"> </q>section in <a href="part0008.html#7K4G0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 1</a>, <em class="calibre2">Introducing JEE and Eclipse</em>. </li>
<li value="3" class="calibre11">Make sure the application is added to the server and runs as expected. See the <em class="calibre2">Running JSP in Tomcat</em> section in <a href="part0037.html#1394Q0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 2</a>, <em class="calibre2">Creating a Simple JEE Web Application</em>.</li>
<li value="4" class="calibre11">Copy the <kbd class="calibre13">admin</kbd> folder from <kbd class="calibre13">CourseManagementMavenWebApp</kbd> (see the previous section in this chapter) to <kbd class="calibre13">src/main/webapp</kbd> in the <kbd class="calibre13">CourseManagementJDBC</kbd> project. So, the code to protect the admin folder is the same for projects in GlassFish and Tomcat.</li>
</ol>
<p class="calibre3">So, now you should have the <kbd class="calibre13">CourseManagementJDBC</kbd> project and Tomcat configured in Eclipse.</p>
<p class="calibre3">We will now modify <kbd class="calibre13">web.xml</kbd> to add security constraints, as we did in the previous section for GlassFish:</p>
<pre class="calibre25">&lt;security-constraint&gt;<br class="title-page-name"/>    &lt;display-name&gt;Admin resources&lt;/display-name&gt;<br class="title-page-name"/>    &lt;web-resource-collection&gt;<br class="title-page-name"/>        &lt;web-resource-name&gt;admins&lt;/web-resource-name&gt;<br class="title-page-name"/>        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;<br class="title-page-name"/>    &lt;/web-resource-collection&gt;<br class="title-page-name"/>    &lt;auth-constraint&gt;<br class="title-page-name"/>        &lt;role-name&gt;admin&lt;/role-name&gt;<br class="title-page-name"/>    &lt;/auth-constraint&gt;<br class="title-page-name"/>&lt;/security-constraint&gt;<br class="title-page-name"/>&lt;login-config&gt;<br class="title-page-name"/>    &lt;auth-method&gt;FORM&lt;/auth-method&gt;<br class="title-page-name"/>    &lt;form-login-config&gt;<br class="title-page-name"/>        &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;<br class="title-page-name"/>        &lt;form-error-page&gt;/login-error.jsp&lt;/form-error-page&gt;<br class="title-page-name"/>    &lt;/form-login-config&gt;<br class="title-page-name"/>&lt;/login-config&gt; </pre>
<p class="calibre3">There are two differences in the preceding configuration compared with the same for GlassFish:</p>
<ul class="calibre10">
<li class="calibre11">There is no need to map <kbd class="calibre13">role-name</kbd> to group names as we did in GlassFish. Therefore, the role name is changed from <kbd class="calibre13">admin-role</kbd> to just <kbd class="calibre13">admin</kbd> in <kbd class="calibre13">&lt;auth-constaint&gt;</kbd>.</li>
<li class="calibre11">There is no need for the <kbd class="calibre13">&lt;realm-name&gt;</kbd> tag in <kbd class="calibre13">&lt;login-config&gt;</kbd>.</li>
</ul>
<p class="calibre3">Let's now configure the JDBC realm in Tomcat by adding the <kbd class="calibre13">&lt;realm&gt;</kbd> tag in <kbd class="calibre13">server.xml</kbd>. If you are using Tomcat configured in Eclipse to run the application, then you can access <kbd class="calibre13">server.xml</kbd> by expanding the <span class="calibre12">Servers</span> node in <span class="calibre12">Project Explorer</span>:</p>
<div class="packt_figure1"><img src="../images/00271.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 14.4: Access of server.xml in the Tomcat server configured in Eclipse</div>
<p class="calibre3">If you are running Tomcat outside Eclipse, then you will find <kbd class="calibre13">server.xml</kbd> at <kbd class="calibre13">$CATALINA_BASE/conf/server.xml</kbd>.</p>
<p class="calibre3">Add the following realm tag in <kbd class="calibre13">server.xml</kbd>, inside the <kbd class="calibre13">&lt;Engine defaultHost="localhost" name="Catalina"&gt;</kbd> node:</p>
<pre class="calibre25">&lt;Realm  className="org.apache.catalina.realm.JDBCRealm"<br class="title-page-name"/>    driverName="com.mysql.jdbc.Driver"<br class="title-page-name"/>    connectionURL="jdbc:mysql://localhost:3306/course_management"<br class="title-page-name"/>    connectionName="&lt;your-db-username&gt;"<br class="title-page-name"/>    connectionPassword="&lt;your-db-password&gt;"<br class="title-page-name"/>    userTable="user_group_view"<br class="title-page-name"/>    userNameCol="user_name"<br class="title-page-name"/>    userCredCol="password"<br class="title-page-name"/>    userRoleTable="user_group_view"<br class="title-page-name"/>    roleNameCol="group_name" /&gt;</pre>
<p class="calibre3">The Tomcat admin module needs to access our MySQL database, so we need to make the MySQL JDBC driver available to the admin module. Copy the MySQL JDBC driver in <kbd class="calibre13">&lt;tomcat-install-dir&gt;/lib</kbd>. You can download the driver from <a href="https://dev.mysql.com/downloads/connector/j/" class="calibre9">https://dev.mysql.com/downloads/connector/j/</a>, if you haven't already done so.</p>
<p class="calibre3">That is all that is required to protect folders in Tomcat. Restart the server and browse to <kbd class="calibre13">http://localhost:8080/CourseManagementJDBC/admin/admin.jsp</kbd>. You should see the login page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Securing servlets using annotations</h1>
                
            
            <article>
                
<p class="calibre3">So far, we have seen declarative syntax for specifying security constraints; that is, by specifying <kbd class="calibre13">&lt;security-constraint&gt;</kbd> in <kbd class="calibre13">web.xml</kbd>. However, security constraints can also be specified using Java annotations, specifically for servlets. In this section, we will create <kbd class="calibre13">AdminServlet</kbd> and secure it with annotations. Follow the steps in the previous section to import the <kbd class="calibre13">CourseManagementJDBC</kbd> project from <kbd class="calibre13">Chapter09</kbd>, but rename it <kbd class="calibre13">CourseManagementJDBC-SecureAnnotations</kbd>, and import it into the workspace. Then, add only <kbd class="calibre13">&lt;login-config&gt;</kbd> in <kbd class="calibre13">web.xml</kbd>, but do not specify <kbd class="calibre13">&lt;security-constraint&gt;</kbd>:</p>
<pre class="calibre25">  &lt;login-config&gt;<br class="title-page-name"/>    &lt;auth-method&gt;FORM&lt;/auth-method&gt;<br class="title-page-name"/>    &lt;form-login-config&gt;<br class="title-page-name"/>      &lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;<br class="title-page-name"/>      &lt;form-error-page&gt;/login-error.jsp&lt;/form-error-page&gt;<br class="title-page-name"/>    &lt;/form-login-config&gt;<br class="title-page-name"/>  &lt;/login-config&gt;</pre>
<p class="calibre3">Make sure you have copied <kbd class="calibre13">login.jsp</kbd> and <kbd class="calibre13">login-error.jsp</kbd>, as described in the previous section.</p>
<p class="calibre3">Now create a servlet named <kbd class="calibre13">AdminServlet</kbd> in the <kbd class="calibre13">packt.book.jee.eclipse.ch4.servlet</kbd> package, with the following content:</p>
<pre class="calibre25">package packt.book.jee.eclipse.ch4.servlet;<br class="title-page-name"/>// skipping imports to save space<br class="title-page-name"/>@WebServlet("/AdminServlet")<br class="title-page-name"/>@ServletSecurity(@HttpConstraint(rolesAllowed = "admin"))<br class="title-page-name"/>public class AdminServlet extends HttpServlet {<br class="title-page-name"/>    private static final long serialVersionUID = 1L;<br class="title-page-name"/>    public AdminServlet() {<br class="title-page-name"/>        super();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    protected void doGet(HttpServletRequest request, HttpServletResponse response)<br class="title-page-name"/>        throws ServletException, IOException {<br class="title-page-name"/>        try {<br class="title-page-name"/>            request.authenticate(response);<br class="title-page-name"/>            response.getWriter()<br class="title-page-name"/>                    .append("Served at: ").append(request.getContextPath());<br class="title-page-name"/>        } finally {<br class="title-page-name"/>            response.getWriter().close();<br class="title-page-name"/>        }      <br class="title-page-name"/>     }<br class="title-page-name"/><br class="title-page-name"/>    protected void doPost(HttpServletRequest request, <br class="title-page-name"/>        HttpServletResponse response) throws ServletException, IOException {<br class="title-page-name"/>        doGet(request, response);<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="calibre3"><kbd class="calibre13">@ServletSecurity(@HttpConstraint(rolesAllowed = "admin"))</kbd> specifies the security constraint for the servlet. With this annotation, we are allowing only users in the admin role to access the servlet. If you browse to <kbd class="calibre13">http://localhost:8080/CourseManagementJDBC-SecurityAnnotations/AdminServlet</kbd>, you should see the login page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Securing web services</h1>
                
            
            <article>
                
<p class="calibre3">The process of securing web services is similar to that of protecting a web URL, and we have seen two examples of that in previous sections. We specify <kbd class="calibre13">&lt;security-constraint&gt;</kbd> and <kbd class="calibre13">&lt;login-config&gt;</kbd> in <kbd class="calibre13">web.xml</kbd>. Let’s see how to protect the REST web service we developed in <a href="part0176.html#57R300-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 9</a>, <em class="calibre21">Creating Web Services:</em></p>
<ol class="calibre14">
<li value="1" class="calibre11">Copy and import the <kbd class="calibre13">CourseManagementREST</kbd> and <kbd class="calibre13">CourseManagementRESTClient</kbd> projects from <kbd class="calibre13">Chapter09</kbd> into the workspace for this chapter. As the names suggests, the first project is the REST service, and the second project is a standalone client application that calls the web service.</li>
<li value="2" class="calibre11">Deploy the <kbd class="calibre13">CourseManagementREST</kbd> project in Tomcat (see the previous section for details on how to do this).</li>
<li value="3" class="calibre11"><span>Make sure the <kbd class="calibre13">testGetCoursesJSON</kbd> method is called from the <kbd class="calibre13">main</kbd> method in </span><kbd class="calibre13">CourseManagementClient.java</kbd> from the <em class="calibre2">CourseManagementRESTClient</em> project.</li>
<li value="4" class="calibre11">Run the application (right-click on the file in <span>Project Explorer</span> and select <span>Run As</span> | <span>Java Application</span>), and verify that the service is working fine.</li>
</ol>
<p class="calibre3">To secure the web service using basic authentication, add the following configuration in <kbd class="calibre13">web.xml</kbd>:</p>
<pre class="calibre25">:&lt;security-constraint&gt;<br class="title-page-name"/>    &lt;display-name&gt;Admin resources&lt;/display-name&gt;<br class="title-page-name"/>    &lt;web-resource-collection&gt;<br class="title-page-name"/>        &lt;web-resource-name&gt;admins&lt;/web-resource-name&gt;<br class="title-page-name"/>            &lt;url-pattern&gt;/services/*&lt;/url-pattern&gt;<br class="title-page-name"/>        &lt;/web-resource-collection&gt;<br class="title-page-name"/>        &lt;auth-constraint&gt;<br class="title-page-name"/>            &lt;role-name&gt;admin&lt;/role-name&gt;<br class="title-page-name"/>        &lt;/auth-constraint&gt;<br class="title-page-name"/> &lt;/security-constraint&gt;<br class="title-page-name"/>&lt;login-config&gt;<br class="title-page-name"/>    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;<br class="title-page-name"/>&lt;/login-config&gt;   </pre>
<p class="calibre3">With the above configuration, we are protecting any URL containing <kbd class="calibre13">/services/</kbd>. We have also specified that only the <span class="calibre12">admin</span> role can access this URL and the method of authentication is <span class="calibre12">BASIC</span>.</p>
<p class="calibre3">Now, add the <kbd class="calibre13">&lt;Realm&gt;</kbd> configuration in <kbd class="calibre13">server.xml</kbd> of Tomcat, as described in the previous section. If you run <kbd class="calibre13">CourseManagementClient.java</kbd> at this point, you will get an <span class="calibre12">Unauthorized</span> error. This is because the client application is not sending the authentication information—that is, the username and password<span class="calibre12">—</span>along with the <kbd class="calibre13">GET</kbd> request. For the basic authentication method, this information should be passed in the <kbd class="calibre13">authorization</kbd> header. The value of this header parameter should be set as <kbd class="calibre13">Basic</kbd>, followed by the base64-encoded <kbd class="calibre13">username:password</kbd> string; for example, <kbd class="calibre13">authorization: Basic dXNlcjE6dXNlcjFfcGFzcw==</kbd>.</p>
<p class="calibre3">In the preceding header, <kbd class="calibre13">dXNlcjE6dXNlcjFfcGFzcw==</kbd> is the base64-encoded format of the <kbd class="calibre13">user1:user1_pass</kbd> string.</p>
<p class="calibre3">Let's now modify the <kbd class="calibre13">testGetCoursesJSON</kbd> method in <kbd class="calibre13">CourseManagementClient.java</kbd> to pass the preceding header information. Here is the code you need to add just before checking the response status:</p>
<pre class="calibre25">String userName = "user1";<br class="title-page-name"/>String password = "user1_pass";<br class="title-page-name"/>String authString = userName + ":" + password;<br class="title-page-name"/>String encodedAuthStr =  Base64.<em class="calibre2">getEncoder</em>().encodeToString(authString.getBytes());<br class="title-page-name"/>//Execute HTTP get method<br class="title-page-name"/>Response response = webTarget.request(MediaType.<strong class="calibre1"><em class="calibre2">APPLICATION_JSON</em></strong>).header(HttpHeaders.<strong class="calibre1"><em class="calibre2">AUTHORIZATION</em></strong>, "Basic " + encodedAuthStr).get();</pre>
<p class="calibre3">Note that <kbd class="calibre13">java.util.Base64</kbd> is available in JDK 1.8 onward. If you are using a version lower than 1.8, you can use <kbd class="calibre13">org.apache.commons.codec.binary.Base64</kbd> from Apache <kbd class="calibre13">commons-codec</kbd>. Add the following dependency in <kbd class="calibre13">pom.xml</kbd>:</p>
<pre class="calibre25">&lt;dependency&gt;<br class="title-page-name"/>    &lt;groupId&gt;commons-codec&lt;/groupId&gt;<br class="title-page-name"/>    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;<br class="title-page-name"/>    &lt;version&gt;1.11&lt;/version&gt;<br class="title-page-name"/>&lt;/dependency&gt;</pre>
<p class="calibre3">Right-click on the project and select <span class="calibre12">Run As</span> | <span class="calibre12">Maven Install</span>. Then, encode <kbd class="calibre13">String</kbd> by calling:</p>
<pre class="calibre25">encodedAuthStr =  new String(org.apache.commons.codec.binary.Base64.encodeBase64(authString.getBytes()));</pre>
<p class="calibre3">When you run the application now, the web service should execute without any errors.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Security enhancements in JEE 8</h1>
                
            
            <article>
                
<p class="calibre3">JEE 8 has incorporated Java EE Security API 1.0 (JSR 375, <a href="https://javaee.github.io/security-spec/" class="calibre9">https://javaee.github.io/security-spec/</a>). Enhancements in these APIs are broadly classed into four categories: </p>
<ul class="calibre10">
<li class="calibre11">Support for the Servlet 4.0 authentication mechanism. You can specify the type of authentication in servlets using annotations. For example, <kbd class="calibre13">@BasicAuthenticationMechanismDefinition</kbd> for basic authentication, <kbd class="calibre13">@FormAuthenticationMechanismDefinition</kbd> for form-based authentication, and <kbd class="calibre13">@CustomFormAuthenticationMechanismDefinition</kbd> for custom authentication. For more information, refer to <a href="https://javaee.github.io/security-spec/spec/jsr375-spec.html#authentication-mechanism" class="calibre9">https://javaee.github.io/security-spec/spec/jsr375-spec.html#authentication-mechanism</a>.</li>
<li class="calibre11">Identity Store APIs. By implementing the Identity Store interface, you can specify how user, password, and group information is made available to JEE authentication and authorization APIs. You can make your security-related code portable across JEE 8 containers by implementing this interface. For more information, refer to <a href="https://javaee.github.io/security-spec/spec/jsr375-spec.html#_introduction_2" class="calibre9">https://javaee.github.io/security-spec/spec/jsr375-spec.html#_introduction_2</a>.</li>
<li class="calibre11">New <kbd class="calibre13">SecurityContext</kbd> APIs provide consistent APIs for acquiring information about users and roles. For more information, refer to <a href="https://javaee.github.io/security-spec/spec/jsr375-spec.html#security-context" class="calibre9">https://javaee.github.io/security-spec/spec/jsr375-spec.html#security-context</a>.</li>
<li class="calibre11"> The new <kbd class="calibre13">HttpAuthenticationMechanism</kbd> API gives you complete control over how you want to implement security in your application programmatically. For more information, refer to <a href="https://javaee.github.io/security-api/apidocs/javax/security/enterprise/authentication/mechanism/http/HttpAuthenticationMechanism.html" class="calibre9">https://javaee.github.io/security-api/apidocs/javax/security/enterprise/authentication/mechanism/http/HttpAuthenticationMechanism.html</a>.</li>
</ul>
<p class="calibre3">We will not cover all the preceding enhancements in this chapter, but we will take a look at the first three APIs in some detail.</p>
<p class="calibre3">We have seen, in the previous sections of this chapter, how configuration of security is not uniform across containers. Specifically, the mapping of roles to groups is not uniform. This problem can be addressed by using new JEE 8 security APIs. Let's see how this can be done by developing an application. Refer to the <kbd class="calibre13">CourseManagementMavenWebApp-jee8</kbd> <span class="calibre12">project </span><span class="calibre12">in the source code for this chapter. </span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Implementing portable security in JEE 8</h1>
                
            
            <article>
                
<p class="calibre3">We will modify <kbd class="calibre13">CourseManagementMavenWebApp</kbd> from <a href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a>, <em class="calibre21">Creating JEE Applications with EJB</em>, in this section. This project was part of the EJB <kbd class="calibre13">CourseManagementMavenEAR<q class="calibre264"> </q></kbd><span class="calibre12">project,</span><span class="calibre12"> but in this section, we will work with </span><kbd class="calibre13">CourseManagementMavenWebApp</kbd> <span class="calibre12">independently. Copy the </span><kbd class="calibre13">CourseManagementMavenWebApp</kbd> <span class="calibre12">project from</span> <kbd class="calibre13">Chapter07</kbd><span class="calibre12">, as </span><kbd class="calibre13">CourseManagementMavenWebApp-jee8</kbd> <span class="calibre12">in the Eclipse workspace for this chapter.</span></p>
<p class="calibre3">We will modify this project to provide the following functionality:</p>
<ul class="calibre10">
<li class="calibre11"><kbd class="calibre13">AdminServlet</kbd> is a protected servlet requiring login. We will implement the basic authentication</li>
<li class="calibre11">There are three possible user roles: <span>admin</span>, <span>manager</span>, and <span>user</span></li>
<li class="calibre11">Only users in the admin role can see the admin page, served by <kbd class="calibre13">AdminServlet</kbd></li>
<li class="calibre11">Only users in the manager role can see the management page, served by <kbd class="calibre13">ManagementServlet</kbd></li>
</ul>
<p class="calibre3">JEE 8 security APIs require <span class="calibre12"><strong class="calibre5">Contexts and Dependency Injection</strong> (<strong class="calibre5">CDI</strong>) to be enabled in the application. We just need to create an</span> empty <kbd class="calibre13">beans.xml</kbd> <span class="calibre12">file in the </span><kbd class="calibre13">src/main/webapp/WEB-INF</kbd> <span class="calibre12">folder to enable CDI.</span></p>
<p class="calibre3">Next, we need to add the following Maven dependency in <kbd class="calibre13">pom.xml</kbd> to make the JEE 8 APIs available in the application:</p>
<pre class="calibre25"><span><span> </span><span> </span></span><span>&lt;</span>dependency<span>&gt;<br class="title-page-name"/></span><span><span> </span><span> </span><span> </span></span><span>&lt;</span>groupId<span>&gt;</span><span>javax</span><span>&lt;/</span>groupId<span>&gt;<br class="title-page-name"/></span><span><span> </span><span> </span><span> </span></span><span>&lt;</span>artifactId<span>&gt;</span><span>javaee</span><span>-</span><span>api</span><span>&lt;/</span>artifactId<span>&gt;<br class="title-page-name"/></span><span><span> </span><span> </span><span> </span></span><span>&lt;</span>version<span>&gt;</span><span>8.0</span><span>&lt;/</span>version<span>&gt;<br class="title-page-name"/></span><span> </span><span> </span><span> </span><span>&lt;</span><span>scope</span><span>&gt;</span>provided<span>&lt;/</span><span>scope</span><span>&gt;<br class="title-page-name"/></span><span><span> </span><span> </span></span><span>&lt;/</span>dependency<span>&gt;</span></pre>
<p class="calibre3">Let's create a class called <kbd class="calibre13">ApplicationConfig</kbd> (in the <kbd class="calibre13">packt.book.jee.eclipse.ch7.web.servlet</kbd> package) to declare all user roles allowed in the application. Here is the source code for the <span class="calibre12"><kbd class="calibre13">ApplicationConfig</kbd> class:</span></p>
<pre class="calibre25"><span>package</span> packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/><span>import</span> javax.annotation.security.DeclareRoles;<br class="title-page-name"/><span>import</span> javax.enterprise.context.ApplicationScoped;<br class="title-page-name"/><span>@DeclareRoles</span><span>({</span>"admin"<span>, </span>"user"<span>, </span>"manager"<span>})<br class="title-page-name"/></span>@ApplicationScoped<br class="title-page-name"/><span>public</span> <span>class</span> ApplicationConfig {}</pre>
<p class="calibre3">Now, let's create two servlets, <kbd class="calibre13">AdminServlet</kbd> and <kbd class="calibre13">ManagementServlet</kbd>, in the <span class="calibre12"><kbd class="calibre13">packt.book.jee.eclipse.ch7.web.servlet</kbd> package. If you create these classes using the Eclipse wizard, then it adds the servlet declarations and mappings in <kbd class="calibre13">web.xml</kbd>. If you are not using the Eclipse wizard, then either add the declarations and mappings manually, or add the <kbd class="calibre13">@WebServlet</kbd> annotation in the servlet classes. </span>Here is the source code for <kbd class="calibre13">AdminServlet</kbd>:</p>
<pre class="calibre25">package packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/><br class="title-page-name"/>// skipped imports<br class="title-page-name"/><br class="title-page-name"/>@BasicAuthenticationMechanismDefinition()<br class="title-page-name"/>@ServletSecurity(@HttpConstraint(rolesAllowed = {"admin", "manager"} ))<br class="title-page-name"/>public class AdminServlet extends HttpServlet {<br class="title-page-name"/> <br class="title-page-name"/> private static final long serialVersionUID = 1L;<br class="title-page-name"/> <br class="title-page-name"/> @Inject<br class="title-page-name"/> private SecurityContext securityContext;<br class="title-page-name"/> <br class="title-page-name"/> public AdminServlet() {<br class="title-page-name"/> super();<br class="title-page-name"/> }<br class="title-page-name"/><br class="title-page-name"/> protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<br class="title-page-name"/> if (securityContext.isCallerInRole("manager")) {<br class="title-page-name"/> request.getRequestDispatcher("/ManagementServlet").forward(request, response);<br class="title-page-name"/> } else {<br class="title-page-name"/> response.getWriter().append("Welcome to Admin Page!");<br class="title-page-name"/> }<br class="title-page-name"/> }<br class="title-page-name"/><br class="title-page-name"/> protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<br class="title-page-name"/> doGet(request, response);<br class="title-page-name"/> }<br class="title-page-name"/>}</pre>
<p class="calibre3">The servlet allows access to only the <span class="calibre12">admin</span> and <span class="calibre12">manager</span> roles, using the <kbd class="calibre13">@ServletSecurity</kbd> annotation. The servlet also specifies the basic authentication type using <kbd class="calibre13">@BasicAuthenticationMechanismDefinition</kbd>. We also ask the JEE container to inject an instance of <span class="calibre12"><kbd class="calibre13">SecurityContext</kbd>, which is used in the <kbd class="calibre13">doGet</kbd> method to check the user's role. If the user is in the <span class="calibre12">manager</span> role, then the request is forwarded to <kbd class="calibre13">ManagementServlet</kbd>, otherwise, access is granted to the current servlet. Note the call to </span><kbd class="calibre13">securityContext.isCallerInRole</kbd> to check the user's role.</p>
<p class="calibre3">Here is the source code for <kbd class="calibre13">ManagementServlet</kbd>:</p>
<pre class="calibre25">package packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/>// skipped imports<br class="title-page-name"/>@BasicAuthenticationMechanismDefinition(realmName="basic")<br class="title-page-name"/>@ServletSecurity(@HttpConstraint(rolesAllowed = {"manager"} ))<br class="title-page-name"/>public class ManagementServlet extends HttpServlet {<br class="title-page-name"/> private static final long serialVersionUID = 1L;<br class="title-page-name"/> <br class="title-page-name"/> public ManagementServlet() {<br class="title-page-name"/>   super();<br class="title-page-name"/> }<br class="title-page-name"/><br class="title-page-name"/> protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<br class="title-page-name"/> response.getWriter().append("Welcome to Management Page!");<br class="title-page-name"/> }<br class="title-page-name"/><br class="title-page-name"/> protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<br class="title-page-name"/> doGet(request, response);<br class="title-page-name"/> }<br class="title-page-name"/>}</pre>
<p class="calibre3">The preceding servlet also uses basic authentication, and allows access only <span class="calibre12">to users </span><span class="calibre12">in the</span><span class="calibre12"> </span><span class="calibre12">manager</span> <span class="calibre12">role.</span></p>
<p class="calibre3">With the preceding annotations, no declarative configuration is required for <kbd class="calibre13">web.xml</kbd> or any custom container-specific file. But, how do we tell security APIs who are valid users and roles? We do that by implementing the <kbd class="calibre13">IdentityStore</kbd> interface. Create the <kbd class="calibre13">SimpleMapIdentityStore</kbd> class in the <kbd class="calibre13">packt.book.jee.eclipse.ch7.web.servlet</kbd> package. This class should implement the <kbd class="calibre13">IdentityStore</kbd> interface:</p>
<pre class="calibre25">package packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/><br class="title-page-name"/>// skipped imports<br class="title-page-name"/><br class="title-page-name"/>@ApplicationScoped<br class="title-page-name"/>public class SimpleMapIdentityStore implements IdentityStore {<br class="title-page-name"/> class UserInfo {<br class="title-page-name"/>   String userName;<br class="title-page-name"/>   String password;<br class="title-page-name"/>   String role;<br class="title-page-name"/> <br class="title-page-name"/>   public UserInfo(String userName, String password, String role) {<br class="title-page-name"/>     this.userName = userName;<br class="title-page-name"/>     this.password = password;<br class="title-page-name"/>     this.role = role;<br class="title-page-name"/>   }<br class="title-page-name"/> }<br class="title-page-name"/> <br class="title-page-name"/> private HashMap&lt;String, UserInfo&gt; store = new HashMap&lt;&gt;();<br class="title-page-name"/> <br class="title-page-name"/> public SimpleMapIdentityStore() {<br class="title-page-name"/>   UserInfo user1 = new UserInfo("user1", "user1_pass", "admin");<br class="title-page-name"/>   UserInfo user2 = new UserInfo("user2", "user2_pass", "user");<br class="title-page-name"/>   UserInfo user3 = new UserInfo("user3", "user3_pass", "manager");<br class="title-page-name"/>   store.put(user1.userName, user1);<br class="title-page-name"/>   store.put(user2.userName, user2);<br class="title-page-name"/>   store.put(user3.userName, user3);<br class="title-page-name"/> }<br class="title-page-name"/> <br class="title-page-name"/> public CredentialValidationResult validate(UsernamePasswordCredential usernamePasswordCredential) {<br class="title-page-name"/>   String userName = usernamePasswordCredential.getCaller();<br class="title-page-name"/>   String password = usernamePasswordCredential.getPasswordAsString(); <br class="title-page-name"/> <br class="title-page-name"/>   UserInfo userInfo = this.store.get(userName.toLowerCase());<br class="title-page-name"/>   if (userInfo == null || !userInfo.password.equals(password)) {<br class="title-page-name"/>     return INVALID_RESULT;<br class="title-page-name"/>   }<br class="title-page-name"/> <br class="title-page-name"/>   return new CredentialValidationResult(userInfo.userName, new HashSet&lt;&gt;(asList(userInfo.role)));<br class="title-page-name"/> } <br class="title-page-name"/>}</pre>
<p class="calibre3">It is important that the preceding class is annotated with <kbd class="calibre13">@ApplicationScoped</kbd>, so that it is available throughout the application, and CDI can inject it. We have hardcoded users and roles in a <kbd class="calibre13">HashMap</kbd> in the preceding class, but you can write the code to get users and roles from any source, such as a database, LDAP, or a file. In the application, there can be more than one <kbd class="calibre13">IdentityStore</kbd><span class="calibre12"><span class="calibre12">. The container would call the  </span></span><kbd class="calibre13">validate</kbd> method of each one. In the <kbd class="calibre13">validate</kbd> method, we are first verifying that the username and password are valid, and then returning an instance of <kbd class="calibre13">CredentialValidationResult</kbd>, with the roles of the user attached to it.</p>
<p class="calibre3">Build the application (right-click on the project and select <span class="calibre12">Run As</span> | <span class="calibre12">Maven Install</span>), and deploy it in the GlassFish 5 Server, as described in previous sections. Make sure the context of the application is set to <kbd class="calibre13">/CourseManagementMavenWebApp-jee8</kbd>. You can verify this on the GlassFish admin page by editing the deployed application and verifying the value of the <span class="calibre12">Context Root</span> field.  Then browse to <kbd class="calibre13">http://localhost:8080/CourseManagementMavenWebApp-jee8/AdminServlet</kbd>. If you log in with <span class="calibre12">user1</span> credentials, then the admin page will be displayed. If you log in as <span class="calibre12">user3</span>, then the management page will be displayed. Access to all other users is blocked. You would need to close the browser window to try to log in with different users, because once logged in, the user credentials are remembered till the session is invalidated. The application can be easily extended to add a logout option, as we did in previous sections.</p>
<p class="calibre3">In the previous example, we have created a custom identity store. You can implement any code in this to acquire user information, from either a database or LDAP. But, JEE security APIs provide built-in annotations for accessing a database and LDAP as identity stores; that is, <kbd class="calibre13">@DatabaseIdentityStoreDefinition</kbd> and <kbd class="calibre13">@LdapIdentityStoreDefinition</kbd><span class="calibre12">. For example, we could modify the </span><kbd class="calibre13">ApplicationConfig</kbd> class to declare a database identity store as follows: </p>
<pre class="calibre25">package packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/><br class="title-page-name"/>import javax.enterprise.context.ApplicationScoped;<br class="title-page-name"/>import javax.security.enterprise.identitystore.DatabaseIdentityStoreDefinition;<br class="title-page-name"/>import javax.security.enterprise.identitystore.PasswordHash;<br class="title-page-name"/><br class="title-page-name"/>@DatabaseIdentityStoreDefinition (<br class="title-page-name"/> dataSourceLookup = "jdbc/CourseManagement",<br class="title-page-name"/> callerQuery = "select password from user_group_view where user_name = ?",<br class="title-page-name"/> groupsQuery = "select group_name from user_group_view where user_name = ?",<br class="title-page-name"/> hashAlgorithm = PasswordHash.class,<br class="title-page-name"/> priority = 10 <br class="title-page-name"/>)<br class="title-page-name"/>@ApplicationScoped<br class="title-page-name"/>public class ApplicationConfig {<br class="title-page-name"/>}</pre>
<p class="calibre3">We need to pass the JNDI lookup name for the JDBC resource, which is <kbd class="calibre13">jdbc/CourseManagement</kbd>, and SQL queries to validate the username and password and to get groups. These are similar to the SQL queries we configured when creating a <span class="calibre12">Realm</span> on the GlassFish admin page, but with the new security APIs, making the configuration more portable. See <a href="https://javaee.github.io/security-spec/spec/jsr375-spec.html#_annotations_and_built_in_identitystore_beans" class="calibre9">https://javaee.github.io/security-spec/spec/jsr375-spec.html#_annotations_and_built_in_identitystore_beans</a> for more details on <kbd class="calibre13">IdentityStore</kbd> annotations.</p>
<p class="calibre3">In the preceding example, we have used the basic authentication type. But, you can use form-based authentication using the <kbd class="calibre13">@FormAuthenticationMechanismDefinition</kbd> annotation. For example, we could replace <kbd class="calibre13">@BasicAuthenticationMechanismDefinition</kbd> with  <kbd class="calibre13">@FormAuthenticationMechanismDefinition</kbd>, <span class="calibre12">as follows:</span></p>
<pre class="calibre25">package packt.book.jee.eclipse.ch7.web.servlet;<br class="title-page-name"/>// ...<br class="title-page-name"/>@FormAuthenticationMechanismDefinition(<br class="title-page-name"/> loginToContinue = @LoginToContinue(<br class="title-page-name"/> loginPage = "/loginServlet",<br class="title-page-name"/> errorPage = "/loginErrorServlet"<br class="title-page-name"/> )<br class="title-page-name"/>)<br class="title-page-name"/>@DeclareRoles({"admin"})<br class="title-page-name"/>@ServletSecurity(@HttpConstraint(rolesAllowed = "admin"))<br class="title-page-name"/>public class AdminServlet extends HttpServlet {<br class="title-page-name"/> ...<br class="title-page-name"/>}</pre>
<p class="calibre3">This configuration is similar to <kbd class="calibre13">&lt;form-login-config&gt;</kbd>, which we configured in <kbd class="calibre13">web.xml</kbd> in earlier examples. </p>
<p class="calibre3">Note that the new security APIs work mostly on Java classes, such as servlets, EJBs, and beans, but if you want to protect JSP pages, then you need to use the declarative configuration we learned in previous sections.</p>
<div class="packt_tip">Security in JEE<span class="calibre23"> is a very large topic, which can't be covered in a book of generic nature. The scope of this chapter is limited to securing JEE resources with a username and password. For detailed information on security in JEE, refer to <a href="https://javaee.github.io/tutorial/security-intro.html" target="_blank" class="calibre17">https://javaee.github.io/tutorial/security-intro.html</a>.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre3">In this chapter, we learned how to secure resources represented by URLs in JEE applications. The process to secure resources declaratively is not completely generic in JEE; part of it is common across all servers, specifically configurations in <kbd class="calibre13">web.xml</kbd>. Configuration of declarative security realms differs across servers. However, JEE 8 has added new Java EE Security APIs that make annotation-based configuration portable for Java classes.</p>
<p class="calibre3">We learned how to secure folders in GlassFish and Tomcat servers. We also learned how to secure RESTful web services and invoke them with security credentials in a client application.</p>


            </article>

            
        </section>
    </body></html>