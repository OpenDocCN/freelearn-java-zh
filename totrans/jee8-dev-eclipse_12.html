<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying JEE Applications in the Cloud</h1>
                
            
            <article>
                
<p class="calibre3">In the last chapter, we learned how to develop JEE microservices and deploy them in Docker containers.</p>
<p class="calibre3">In this chapter, we will learn how to deploy JEE applications in the cloud, specifically in <strong class="calibre5">Amazon Web Services</strong> (<span class="calibre12"><strong class="calibre5">AWS</strong>) c</span>loud and Google Cloud Platform, using Eclipse tools. The focus is going to be more on using Eclipse tools to deploy JEE applications in the cloud, rather than learning about a specific cloud platform.</p>
<p class="calibre3">In this chapter, we will cover the following topics:</p>
<ul class="calibre10">
<li class="calibre11">Deploying the JEE application in an AWS EC2 instance</li>
<li class="calibre11">Deploying the REST web service in AWS Beanstalk</li>
<li class="calibre11">Deploying a Docker container in Google Compute Engine</li>
<li class="calibre11">Deploying a RESTful web service in Google App Engine</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying in the cloud</h1>
                
            
            <article>
                
<p class="calibre3">There are many advantages to deploying applications in the cloud, such as scaling the application as per its load, and all the benefits of not having to maintain your own data center or physical machines. Other than hosting the application and flexibility, most cloud platforms also provide services like a database, file storage, messaging, and so on, which can be easily integrated into your applications.</p>
<p class="calibre3">Deployment services provided by cloud platforms can be broadly classified as follows:</p>
<ul class="calibre10">
<li class="calibre11"><strong class="calibre1">Infrastructure as a service (IaaS)</strong>: In this service, you get <strong class="calibre1">virtual machines</strong> (<span><strong class="calibre1">VMs</strong>) </span>with complete control. You can install any software on them and set up load balancing, storage, network, and security. It is like having your own data center in the cloud. Examples of IaaS are Amazon <strong class="calibre1">Elastic Compute Cloud</strong> (<strong class="calibre1"><span>EC2</span></strong>) and Google Compute Engine.</li>
<li class="calibre11"><strong class="calibre1">Platform as a service (PaaS)</strong>: In this service, you get VMs with OS and server software installed. Services like load balancing, security, network, and so on are also pre-configured for you (or made very easy to configure). Therefore, you can focus on just application deployment. You can take, for example, a WAR file and deploy it directly in a PaaS. Examples of PaaS are Amazon Elastic Beanstalk and Google App Engine.</li>
</ul>
<p class="calibre3">Though an IaaS offers more flexibility, it is more difficult to configure than a PaaS.</p>
<p class="calibre3">In the following sections, we will see how to deploy JEE applications in the aforementioned types of services in AWS and Google Cloud.</p>
<div class="packt_tip"><span class="calibre23">Note</span><strong class="calibre182"><br class="calibre26"/></strong><br class="calibre26"/>
This book, and this chapter in particular, explains deployment for development and testing, and not production. Deployment for production is a vast and complex topic and requires many considerations like security, scaling, and so on, which are not in the scope of this book.</div>
<p class="calibre3">You need to have accounts with cloud service providers you want to use in order to use the services. Depending on the services you use and the load on your servers, deployment to the cloud could cost you a lot of money. However, almost all cloud providers offer their services for free so that you can try them out for a limited period of time. To follow examples in this chapter, make sure you have accounts with AWS Cloud (<a href="https://aws.amazon.com/" class="calibre9">https://aws.amazon.com/</a>) and Google Cloud Platform (<a href="https://cloud.google.com" class="calibre9">https://cloud.google.com</a>).</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying in AWS Cloud</h1>
                
            
            <article>
                
<p class="calibre3">We will first create a user group and a user within it in AWS. When you set permissions on a user group, all users in that group also get the same permissions.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating the user group and user</h1>
                
            
            <article>
                
<p class="calibre3">We will perform the following steps to create a user group:</p>
<ol class="calibre14">
<li value="1" class="calibre11">Go to the AWS Management Console (<a href="https://console.aws.amazon.com/" class="calibre9">https://console.aws.amazon.com/</a>) and log in.</li>
<li value="2" class="calibre11">Select <span>Services</span> | <span>IAM (Identity &amp; Access Management)</span> from the menu at the top. </li>
<li value="3" class="calibre11">Select <span>Groups</span> from the list on the left-hand side.</li>
<li value="4" class="calibre11">Click the <span>Create New Group</span> button.</li>
<li value="5" class="calibre11">Follow the wizard to specify the group's name and attach the access policy. Let’s name the group <kbd class="calibre13">aws_eclipse_users</kbd>.</li>
<li value="6" class="calibre11">Select the <span>Administrator Access</span> policy for the group.</li>
</ol>
<p class="calibre3"><span class="calibre12">We will perform the following steps to create a user:</span></p>
<ol class="calibre14">
<li value="1" class="calibre11"><span>Select</span> <span>Users</span> <span>from the list on the left-hand side and click the</span> <span>Add User</span> <span>button.</span></li>
<li value="2" class="calibre11"><span>Let’s set</span> the <span>User Name</span> <span>as</span> <span>aws_eclipse_user</span><span>.</span></li>
<li value="3" class="calibre11"><span>In the</span> <span>Access Type</span> <span>options, select the</span> <span>AWS Management Console</span> <span>access option. The</span> <span>Require password reset</span> <span>option can be turned off if you so desire.</span></li>
<li value="4" class="calibre11"><span>Click the</span> <span>Next: Permission</span> <span>button and then select the group we created previously, which is</span> <span>aws_eclipse_users</span><span>.</span></li>
<li value="5" class="calibre11"><span>Follow the steps on the page to complete the workflow, which ultimately leads to you creating the user.</span></li>
</ol>
<p class="calibre3"><span class="calibre12">Now, you should have the</span> <span class="calibre12">aws_eclipse_users</span> <span class="calibre12">group with</span> <span class="calibre12">Administrator Access</span> <span class="calibre12">and</span> the <span class="calibre12">aws_eclipse_user user</span> <span class="calibre12">in that group.</span></p>
<p class="calibre3">The next step is to create an access key for the user. Go to the page that lists all users (click <span class="calibre12">Users</span> from the list on the left-hand side of the page) and click on the user <span class="calibre12">aws_eclipse_user</span>. Click on the <span class="calibre12">Security credentials</span> tab and then click the <span class="calibre12">Create access key</span> button. It creates an access key and displays <span class="calibre12">Access key ID</span> and <span class="calibre12">Secret access key</span>. Save this information for future use. AWS gives you the option to download the CSV file containing this information.</p>
<div class="packt_tip"><span class="calibre23">Note</span><br class="calibre26"/>
<br class="calibre26"/>
Both <span class="calibre23">Access Key ID</span> and <span class="calibre23">Secret Access Key</span> are required to access AWS services from Eclipse. This is the only place AWS shows the <span class="calibre23">Secret Access Key</span>. If you lose this information, it is not possible to get it back later, so make sure that you save this information.</div>
<p class="calibre3">Next, we will add a security group and specify inbound traffic rules for the same. In the AWS Management Console, go to <span class="calibre12">Services</span> | <span class="calibre12">EC2</span> | <span class="calibre12">Network &amp; Security</span> | <span class="calibre12">Security Groups</span> page. Click <span class="calibre12">Create Security Group</span> button. Enter <span class="calibre12"><span class="calibre12">Security group name</span> as</span> <kbd class="calibre13">eclipse-dev</kbd><span class="calibre12">. Enter any description (this is a mandatory field). Then create following inbound rules:<br class="calibre6"/></span></p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52"><span>Type</span></td>
<td class="calibre52"><span>Protocol</span></td>
<td class="calibre52"><span>Port Range</span></td>
<td class="calibre52"><span>Source</span></td>
</tr>
<tr class="calibre51">
<td class="calibre52">SSH</td>
<td class="calibre52">TCP</td>
<td class="calibre52">22</td>
<td class="calibre52">Anywhere (<em class="calibre2">see the note following this table</em>)</td>
</tr>
<tr class="calibre51">
<td class="calibre52">Custom TCP</td>
<td class="calibre52">TCP</td>
<td class="calibre52">8080</td>
<td class="calibre52">Anywhere</td>
</tr>
</tbody>
</table>
<div class="packt_tip"><span class="calibre23">Note</span><br class="calibre26"/>
<br class="calibre26"/>
SSH inbound rule above will give access to your EC2 instance from any IP. If you want to limit access, do not select source as <span class="calibre23">Anywhere</span>, but set specific IPs, selecting <span class="calibre23">Custom</span>.<br class="calibre26"/>
<br class="calibre26"/>
Because this chapter explains how to deploy JEE applications in xloud for development and testing, <span class="calibre23">Source</span> is selected as <span class="calibre23">Anywhere</span> (any IP).</div>
<p class="calibre3">The preceding security group will provide SSH access to any external IP on port 22 and TCP access on port 8080.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the AWS Toolkit for Eclipse</h1>
                
            
            <article>
                
<p class="calibre3">In this section, we will learn how to install the <span class="calibre12">AWS Toolkit</span> plugin in Eclipse. Go to the Eclipse menu's <span class="calibre12">Help</span> | <span class="calibre12">Eclipse Marketplace...</span>. Search for the <kbd class="calibre13">AWS Toolkit</kbd>:</p>
<div class="packt_figure1"><img src="../images/00242.jpeg" class="calibre244"/></div>
<div class="packt_figure1">Figure 13.1: Installing the AWS Toolkit for Eclipse</div>
<p class="calibre3">Install the plugin. We will see many features of this plugin later in this chapter. Visit <a href="http://docs.aws.amazon.com/toolkit-for-eclipse/v1/user-guide/welcome.html" class="calibre9">http://docs.aws.amazon.com/toolkit-for-eclipse/v1/user-guide/welcome.html</a> for the complete documentation.</p>
<p class="calibre3">We need to configure the plugin with the <span class="calibre12">Access Key ID</span> and <span class="calibre12">Secret Access Key</span> we created in the previous section. Open Eclipse <span class="calibre12">Preferences</span> and go to <span class="calibre12">AWS Toolkit</span> preferences:</p>
<div class="packt_figure1"> <img src="../images/00243.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.2: Setting the Access Key ID and Secret Access Key AWS Toolkit preferences</div>
<p class="calibre3">You can use the default profile or create a new profile. Enter the <span class="calibre12">Access Key ID</span> and <span class="calibre12">Secret Access Key</span> and click the <span class="calibre12">Apply and Close</span> button. This information will be used by the Eclipse plugin to access information about your configuration in AWS.</p>
<p class="calibre3">Once the authentication is successful, you can access most of the information that you can on the AWS Console web page from within Eclipse. Switch to the <span class="calibre12">AWS Management</span> perspective (select <span class="calibre12">Window</span> | <span class="calibre12">Perspective</span> | <span class="calibre12">Open Perspective</span> or click the <span class="calibre12">Open Perspective</span> toolbar button in the upper-right corner):</p>
<div class="packt_figure1"><img src="../images/00244.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.3: AWS Management perspective</div>
<p class="calibre3">Expand the <span class="calibre12">Amazon EC2</span> category in <span class="calibre12">AWS Explorer</span> and you will see options for viewing <span class="calibre12">EC2 AMIs</span>, <span class="calibre12">EC2 Instances</span>, and more. <strong class="calibre5">Amazon Machine Image</strong> (<strong class="calibre5"><span class="calibre12">AMI</span></strong>) can be considered a template from which multiple VM instances can be created.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Launching the EC2 instance</h1>
                
            
            <article>
                
<p class="calibre3">Now, let's create an EC2 instance from an AMI. If the EC2 AMI view is not already open in the <span class="calibre12">AWS Management</span> perspective in Eclipse, right-click on the <span class="calibre12">AMIs</span> node in <span class="calibre12">AWS Explorer</span> (see <em class="calibre21">Figure 13.3</em>) and select the <span class="calibre12">Open EC2 AMIs</span> view. This view could take a long time to load, because there are many AMIs available. We will select a Linux AMI that is available in the Free Tier (during your trial period). Unfortunately, it is not easy to search for this AMI in the Eclipse view because the view does not display or allow you to search AMIs based on their description. This means that you can’t search AMIs by typing <kbd class="calibre13">linux</kbd> into the search box. Surprisingly, the filter options for platforms in the view do not show the Linux option either, at least at the time of writing this book.</p>
<p class="calibre3">We are going to create an instance from AMI ID <kbd class="calibre13">ami-f63b1193</kbd> (you can see a better view of the list of AMIs when creating a new instance from the AWS Console web page). Type <kbd class="calibre13">ami-f63b1193</kbd> in the search box and you should see one result displayed in the view. Right-click on the AMI and select the <span class="calibre12">Launch</span> option:</p>
<div class="packt_figure1"><img src="../images/00245.jpeg" class="calibre245"/></div>
<div class="packt_figure1">Figure 13.4: Launching an instance from AMI</div>
<p class="calibre3">Select the appropriate <span class="calibre12">Instance Type</span>. For this example, we will select the <span class="calibre12">General Purpose Burstable Micro</span> type.</p>
<p class="calibre3">Select an <span class="calibre12">Availability Zone</span>. See <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" class="calibre9">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions</a> for a list of availability zones.</p>
<p class="calibre3">Next, select a <span class="calibre12">Key Pair</span> to connect to the instance from your host machine. If no key pairs are listed, click on the plus icon and add a new key pair. You just need to specify the name of the key and the location on your machine where it will be saved.</p>
<p class="calibre3">Next, select a security group for the new instance. We will select the <span class="calibre12">eclipse-dev</span> security group (the wizard does not let you finish unless you select a <span class="calibre12">Security Group</span> and <span class="calibre12">Key Pair</span>). Click <span class="calibre12">Finish</span>. The new instance will be added to the list of instances in the <span class="calibre12">EC2 Instances</span> view. Note the status of the instance. When you have just created the instance, the status will be <span class="calibre12">Pending</span>. This will change to <span class="calibre12">Running</span> once the instance is successfully launched. Right-click on the instance to see the available menu options on the instance:</p>
<div class="packt_figure1"><img src="../images/00246.jpeg" class="calibre246"/></div>
<div class="packt_figure1">Figure 13.5: The Context menu in the EC2 Instances view</div>
<p class="calibre3">To open a shell to execute OS commands, select the <span class="calibre12">Open Shell</span> option from the pop-up menu:</p>
<div class="packt_figure1"><img src="../images/00247.jpeg" class="calibre247"/></div>
<div class="packt_figure1">Figure 13.6: An opened shell in an AWS instance</div>
<p class="calibre3">We are going to use this option (<span class="calibre12">Open Shell</span>) to execute commands in our instance.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the CourseManagement EJB application in the EC2 instance</h1>
                
            
            <article>
                
<p class="calibre3">In <a target="_blank" href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a>, <em class="calibre21">Creating JEE Applications with EJB</em>, we developed an EJB application for <kbd class="calibre13">CourseManagement</kbd>. We will see how to deploy this application in the EC2 instance that we created in the previous section. We will need to install GlassFish 5 and MySQL server in the instance. Although you can install these servers on separate instances (which is recommended for a production setup), we are going to install both of them in the same instance so that we can reduce the number of steps for creating a new instance. Let’s start by installing the GlassFish 5 Server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the GlassFish 5 Server</h1>
                
            
            <article>
                
<p class="calibre3">At the time of writing this chapter, the Linux instance that's been created by AWS is preinstalled with JDK 7. However, we have been using JDK 8 in this book. Therefore, we will start by uninstalling JDK 7 and installing JDK 8. Open a shell in the instance from Eclipse (see the previous sections for details) and run the following commands:</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Commands</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo yum remove java-1.7.0-openjdk -y</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Removes JDK 7 from the instance.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo yum install java-1.8.0 -y</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Installs JDK 8.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">wget http://download.oracle.com/glassfish/5.0/release/glassfish-5.0.zip</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Downloads GlassFish 5.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">unzip glassfish-5.0.zip</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Unzips the downloaded GlassFish 5 ZIP file.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">glassfish5/glassfish/bin/asadmin --host localhost --port 4848 change-admin-password</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Changes the password of the server. Default installation comes with an admin user and no password set. We need to set a password for the remote admin of the server to work.<br class="calibre6"/>
Note that the user ID is admin and that the old password is empty (no password). Set a new password, for example, <kbd class="calibre13">admin</kbd>.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">glassfish5/glassfish/bin/startserv &gt; /dev/null 2&gt;&amp;1 &amp;</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Starts the server.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">curl localhost:8080</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Checks if the server is up.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">glassfish5/glassfish/bin/asadmin --host localhost --port 4848 enable-secure-admin</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Enables the remote admin of the GlassFish 5 Server. <br class="calibre6"/>
See the note following this table.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo glassfish5/glassfish/bin/asadmin<br class="title-page-name"/></strong><strong class="calibre1"><br class="title-page-name"/>   asadmin&gt; create-service</strong><strong class="calibre1"><br class="title-page-name"/></strong></pre></td>
<td class="calibre52">
<p class="calibre3">Creates a service so that it is started when the VM instance starts. After you run the <kbd class="calibre13">asadmin</kbd> command, run the <kbd class="calibre13">create-service</kbd> command at <kbd class="calibre13">asadmin&gt;</kbd> prompt.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">glassfish5/glassfish/bin/stopserv<br class="title-page-name"/><br class="title-page-name"/></strong><strong class="calibre1">glassfish5/glassfish/bin/startserv &gt; /dev/null 2&gt;&amp;1 &amp;</strong><strong class="calibre1"><br class="title-page-name"/></strong></pre></td>
<td class="calibre52">
<p class="calibre3">Stops and starts the server so that the preceding changes take effect.</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_tip"><span class="calibre23">Note</span><br class="calibre26"/>
<br class="calibre26"/>
Between writing this chapter and publishing of the book, the functionality to enable secure admin broke in GlassFish 5 if used with JDK version above 1.8.0.151. Remote access to GlassFish 5 administration console fails with the following error (logged on <kbd class="calibre48">glassfish/domains/domain1logs/server.log</kbd>):<br class="calibre26"/>
<br class="calibre26"/>
<kbd class="calibre48">java.lang.NoClassDefFoundError: sun/security/ssl/SupportedEllipticPointFormatsExtension</kbd><br class="calibre26"/>
<br class="calibre26"/>
You can refer to the GlassFish 5 bug at <a href="https://github.com/javaee/glassfish/issues/22407" class="calibre17">https://github.com/javaee/glassfish/issues/22407</a>.</div>
<p class="calibre3">Now, we need to instruct AWS to allow TCP requests at port <kbd class="calibre13">4848</kbd> (for admin), <kbd class="calibre13">8080</kbd> (for access web applications), and <kbd class="calibre13">3306</kbd> (for remote connection to MySQL server) on this instance. We will do this by setting inbound rules on the security group on the instance. Recall that in the previous section we had selected the <span class="calibre12">eclipse-dev</span> security group. We need to set inbound rules on this group. Unfortunately, we can’t do this from the Eclipse plugin (at the time of writing this book). Login to AWS Console on the web and go to <span class="calibre12">Services</span> | <span class="calibre12">EC2</span> and then to <span class="calibre12">NETWORK &amp; SECURITY</span> | <span class="calibre12">Security Groups</span>. Right-click on the security group <span class="calibre12">eclipse-user</span> and select the <span class="calibre12">Edit inbound rules </span>option. Add rules to allow TCP traffic from the IP of your machine (from where you will remotely access the instance; you can use sites like <a href="https://www.whatismyip.com/what-is-my-public-ip-address/" class="calibre9">https://www.whatismyip.com/what-is-my-public-ip-address/</a> to find the real IP address of your machine):</p>
<div class="packt_figure1"><img src="../images/00248.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.7: Setting inbound rules on the security group</div>
<p class="calibre3">Note that if your machine receives a dynamic IP, then you will have to update it on the preceding page.</p>
<div class="packt_infobox"><br class="calibre26"/>
You can now browse to the admin site of GlassFish 5 on your instance—go to <kbd class="calibre48">https://&lt;your-instance-public-address&gt;:4848</kbd>. You can find the public address from Eclipse view EC2 Instances, or from the AWS Console online.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the MySQL server</h1>
                
            
            <article>
                
<p class="calibre3">As mentioned previously, we will install the MySQL server in the same EC2 instance. You can also use an RDS instance from AWS, which is what Amazon recommends for MySQL databases. RDS has many advantages, but to keep things short, we will install MySQL in the same VM instance. Make sure that a shell is open on the instance, as explained earlier, and execute the following commands:</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Commands</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo yum install mysql-server -y</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Installs MySQL</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo chkconfig mysqld on</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Activates the MySQL service</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo service mysqld start</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Starts the MySQL service</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">mysqladmin -u root password [your_new_pwd]</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Sets the password</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">mysqladmin -u root -p create course_management</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Creates <kbd class="calibre13">course_management</kbd> database</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">create user 'eclipse-user'@'%' identified by ‘enter_password_for_new_user’</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Creates a new user</p>
<p class="calibre3"> </p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"> <strong class="calibre1">mysql -u root -p</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Logs in to MySQL from the command line</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">create user 'eclipse-user'@'%' identified by ‘password_for_eclipse_user’;</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Execute this at <kbd class="calibre13">mysql&gt;</kbd> prompt to create a new user called <kbd class="calibre13">eclipse-user</kbd></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">grant all privileges on *.* to 'eclipse-user'@'%' with grant option;</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Grants privileges to the new user</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">exit</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Exits the MySQL console</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">You can now connect to this instance of the MySQL server from your host machine. But before you try to connect to the server, make sure that you have set an inbound rule on the EC2 instance to allow a connection from your machine (IP) on port <kbd class="calibre13">3306</kbd> (see <em class="calibre21">Figure 13.7</em>). You can then either connect from the Terminal (command line) or use MySQL Workbench (see <a target="_blank" href="part0008.html#7K4G0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 1</a>, <em class="calibre21">Introducing JEE and Eclipse</em><q class="calibre207">,</q> for more information on installing MySQL Workbench). Use the public DNS name of the instance to connect.</p>
<p class="calibre3">Create tables in this database as described in <a target="_blank" href="part0073.html#25JP20-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 4</a>, <em class="calibre21">Creating JEE Database Applications</em>. Alternatively, use <kbd class="calibre13">course_management.sql</kbd>, which is in the <kbd class="calibre13">CourseManagementEAR</kbd> folder in the source code for this chapter, to import the tables. In MySQL Workbench, select the <span class="calibre12">Server</span> | <span class="calibre12">Data Import</span> menu. Select <span class="calibre12">Import from Self-Contained File</span> and enter the path to <kbd class="calibre13">course_management.sql</kbd>. Select <span class="calibre12">course_management</span> as the <span class="calibre12">Default Target Schema</span>. Select <span class="calibre12">Dump Structure and Data</span>. Then, click the <span class="calibre12">Start Import</span> button.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Configuring the datasource in the GlassFish 5 Server</h1>
                
            
            <article>
                
<p class="calibre3">To configure our data source in the GlassFish 5 Server, we first need to download the MySQL JDBC driver. You can find a link to download the driver at <a href="https://dev.mysql.com/downloads/connector/j/" class="calibre9">https://dev.mysql.com/downloads/connector/j/</a>. Execute the following commands in the shell that is open for our EC2 instance:</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Commands</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">wget https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.45.zip</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Downloads the driver</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">unzip mysql-connector-java-5.1.45.zip </strong></pre></td>
<td class="calibre52">
<p class="calibre3">Unzips the file</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">cp mysql-connector-java-5.1.45/mysql-connector-java-5.1.45-bin.jar glassfish5/glassfish//domains/domain1//lib/ext/</strong></pre>
<p class="calibre3"> </p>
</td>
<td class="calibre52">
<p class="calibre3">Copies the driver JAR file to a folder in the GlassFish Server classpath</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">Restart the EC2 instance (this is necessary so that GlassFish 5 can load the MySQL JAR file). Then, follow the instructions in the <em class="calibre21">Configuring the datasource in Glassfish</em> section in <a target="_blank" href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a>, <em class="calibre21">Creating JEE Applications with EJB</em>. Make sure that you use the domain name of your EC2 instance instead of localhost (specifically in <span class="calibre12">Additional Properties</span> when setting up the JDBC Connection Pool) when configuring the datasource. You can access the Admin console of GlassFish 5 by browsing to <kbd class="calibre13">https://&lt;enter_domain_name_of_ec2_instance&gt;:4848</kbd>.</p>
<p class="calibre3">Once you configure the connection pool and JDBC datasource in the GlassFish Admin console, deploy <kbd class="calibre13">CourseManagementMavenEAR-1.ear</kbd>. This is the same EAR file we created in <a target="_blank" href="part0129.html#3R0OI0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 7</a>, <em class="calibre21">Creating JEE Applications with EJB</em>, in the <kbd class="calibre13">CourseManagementMavenEAR</kbd> project (and dependent projects). For your convenience, the same EAR file is made available in the <kbd class="calibre13">CourseManagementEAR</kbd> folder in the source code for this chapter. In the Admin console, click <span class="calibre12">Applications</span> from the left-hand menu bar. Then, click the <span class="calibre12">Deploy</span> button. Select <kbd class="calibre13">CourseManagementMavenEAR-1.ear</kbd> from the <kbd class="calibre13">CourseManagementEAR</kbd> folder and deploy the application.</p>
<p class="calibre3">Once the application is deployed successfully, you should be able to browse to <kbd class="calibre13">http://&lt;ec2_instance_domain_name&gt;:8080/CourseManagementMavenWebApp/course.xhtml</kbd> and see a list of Courses (or an empty list if there is no data).</p>
<p class="calibre3">You can save the preceding setup as a template by creating an AMI and creating future instances based on that AMI. To create an AMI from a running instance, browse to the AWS Console and select the <span class="calibre12">Services</span> | <span class="calibre12">EC2</span> option. Then, go to the running instances list. Right-click on the instance you want to create an image from and select <span class="calibre12">Create Image</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the CourseManagmenet REST service using Elastic Beanstalk</h1>
                
            
            <article>
                
<p class="calibre3">Elastic Beanstalk (EBS) is a PaaS (Platform as a Service) offering from AWS (<a href="https://aws.amazon.com/elasticbeanstalk/" class="calibre9">https://aws.amazon.com/elasticbeanstalk/</a>). The idea is that you focus mostly on developing your application and leave configuration of servers (including installation of required software), load balancing, log file management, and so on to the PaaS provider. However, you do not have as much control over the servers in Elastic Beanstalk as you would when provisioning your own EC2 instances.</p>
<p class="calibre3">EBS provides preconfigured hosting solutions for different platforms, including one for Java. It provides servers with Tomcat preconfigured. You simply upload your WAR file and the application is deployed. In this section, we will learn how to deploy a RESTful web service in EBS.</p>
<p class="calibre3">Recall that we developed the <kbd class="calibre13">CourseManagmenetREST</kbd> service in <a target="_blank" href="part0176.html#57R300-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 9</a>, <em class="calibre21">Creating Web Services</em>. We will deploy the same service using EBS in a Tomcat EBS platform. Make sure that you have created the WAR file for the <kbd class="calibre13">CourseManagmenetREST</kbd> project—import the project in Eclipse, if you haven't already done so, right-click on the project in <span class="calibre12">Project Explorer</span>, and select <span class="calibre12">Run As</span> | <span class="calibre12">Maven Install</span>. This will create the <kbd class="calibre13">CourseManagementREST-1.war</kbd> file in the <kbd class="calibre13">target</kbd> folder. We will deploy this WAR file using EBS in a Tomcat server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating Elastic Beanstalk application from Eclipse</h1>
                
            
            <article>
                
<p class="calibre3">We will first create a server for the EBS Tomcat platform in Eclipse. Go to the <span class="calibre12">Servers</span> view in Eclipse. In the default <span class="calibre12">JEE</span> perspective, this view is located in one of the tabs at the bottom, below editors. Right-click it and select <span class="calibre12">New</span> | <span class="calibre12">Server</span>:</p>
<div class="packt_figure1"><img src="../images/00249.jpeg" class="calibre248"/></div>
<div class="packt_figure1">Figure 13.8: Adding the Elastic Beanstalk server in Eclipse</div>
<p class="calibre3">From the <span class="calibre12">Amazon Web Services</span> group, select <span class="calibre12">AWS Elastic Beanstalk for Tomcat 8</span>, or whichever is the latest Tomcat configuration that's available. Keep the other default options. Click <span class="calibre12">Next</span>:</p>
<div class="packt_figure1"><img src="../images/00250.jpeg" class="calibre249"/></div>
<div class="packt_figure1">Figure 13.9: Configuring the EBS application and environment</div>
<p class="calibre3">Select the option to <span class="calibre12">Create a new application</span>. Let’s name this application <kbd class="calibre13">CourseManagementREST</kbd> and the environment <kbd class="calibre13">CourseManagementREST-env</kbd>. Since we are deploying a web application, either select <span class="calibre12">Single Instance Web Server Environment</span> or <span class="calibre12">Load Balanced Web Server Environment</span> from the <span class="calibre12">Type</span> drop-down box. The third type, <span class="calibre12">Worker Environment</span>, is normally used for long-running batch applications. Click <span class="calibre12">Next</span>. At this point, the plugin may warn you that the <span class="calibre12">IAM operation is not allowed</span>. Click <span class="calibre12">OK</span> to proceed:</p>
<div class="packt_figure1"><img src="../images/00251.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.10: Selecting the instance profile and service role for the EBS application</div>
<p class="calibre3">Keep the default values on the <span class="calibre12">Permissions</span> page and click <span class="calibre12">Next</span>:</p>
<div class="packt_figure1"><img src="../images/00252.jpeg" class="calibre250"/></div>
<div class="packt_figure1">Figure 13.11: Selecting the key pair for EBS deployment</div>
<p class="calibre3">Check the <span class="calibre12">Deploy with a key pair</span> option and select a key from the list. If no key pairs are listed, click on the plus icon and add a new key pair. You just need to specify the name of the key and the location on your machine where it will be saved. Click <span class="calibre12">Next</span>.</p>
<p class="calibre3">If you have already imported the <kbd class="calibre13">CourseManagementREST</kbd> project from <a target="_blank" href="part0176.html#57R300-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 9</a>, <em class="calibre21">Creating Web Services</em>, in the Eclipse workspace, then it will appear as an application that is available to deploy. Click the <span class="calibre12">Add</span> button to move it to the <span class="calibre12">Configured</span> list:</p>
<div class="packt_figure1"><img src="../images/00253.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.12: Adding the application to deploy in EBS</div>
<p class="calibre3">Click <span class="calibre12">Finish</span>. The EBS server we just added should appear in the <span class="calibre12">Servers</span> view:</p>
<div class="packt_figure1"><img src="../images/00254.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.13: Servers view with the EBS server added</div>
<p class="calibre3">Click the <span class="calibre12">Start</span> button (or right-click on the server and select the <span class="calibre12">Start</span> option). Eclipse asks for the version label for your deployment:</p>
<div class="packt_figure1"><img src="../images/00255.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.14: Setting the version label for EBS deployment</div>
<p class="calibre3">Set the label (or keep the default one) and click <span class="calibre12">OK</span>. Once the server is started (you can check the status in the <span class="calibre12">Servers</span> view—make sure that the status is <span class="calibre12">Started</span>), browse to <kbd class="calibre13">http://&lt;your-ebs-app-domain&gt;/services/course/get/1</kbd>. You should see the XML output with details of course ID 1.</p>
<p class="calibre3">To find the domain name of your EBS server, double-click on the server in the <span class="calibre12">Servers</span> view. This will display server properties in the editor:</p>
<div class="packt_figure1"><img src="../images/00256.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.15: EBS server properties</div>
<p class="calibre3">You can find the domain name in the <span class="calibre12">Environment URL</span> link. Click on the other tabs to see more information about the configuration of your server. Clicking on the <span class="calibre12">Log</span> tab shows your server log, which will be useful for troubleshooting problems.</p>
<p class="calibre3">If you want to see EC2 instances created by AWS for your Beanstalk application, click on the <span class="calibre12">Environment Resources</span> tab:</p>
<div class="packt_figure1"><img src="../images/00257.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.16: EC2 instances in EBS</div>
<p class="calibre3">Right-click on the instance row and select <span class="calibre12">Open Shell</span>. This can also be useful for troubleshooting the application. Note that any changes (like installing software) you make to the EC2 instance in EBS will be lost when a new version of the app is deployed.</p>
<p class="calibre3">You can see EBS applications and environments in <span class="calibre12">AWS Explorer</span> in Eclipse:</p>
<div class="packt_figure1"><img src="../images/00258.jpeg" class="calibre251"/></div>
<div class="packt_figure1">Figure 13.17: Browsing EBS applications and environments in AWS Explorer</div>
<p class="calibre3">Login to the AWS Console and go to <span class="calibre12">Services</span> | <span class="calibre12">Elastic Beanstalk</span> to see all your applications and environments, including ones created from Eclipse:</p>
<div class="mce-root1"><img src="../images/00259.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.18: EBS dashboard</div>
<p class="calibre3">If you have a WAR file to deploy/update, click the <span class="calibre12">Upload and Deploy</span> button and select the WAR file you want to deploy.</p>
<p class="calibre3"><span class="calibre12">You can modify the configuration of your environment by clicking the </span><span class="calibre12">Configuration</span> <span class="calibre12">link, which is just below the</span> <span class="calibre12">Dashboard</span><span class="calibre12">. Options in the configuration page allow you to modify settings for instances, capacity, the load balancer, security settings, and more. If your application uses a database, then you can configure that too.</span></p>
<p class="calibre3">You can browse the application, <kbd class="calibre13">CourseManagementREST</kbd>, by opening <kbd class="calibre13">&lt;environment url in fig 13.15&gt;/services/course/get/1</kbd>.  </p>
<div class="packt_tip">For some reason if the application does not get deployed properly from Eclipse then redeploy the application from AWS Console by click on <span class="calibre23">Upload and Deploy</span> button in <em class="calibre129">Fig 13.18</em> and browse to the WAR file created in the <kbd class="calibre48">target</kbd> folder of the project (if the WAR file was not created, then right-click on the project and select <span class="calibre23">Run As</span> | <span class="calibre23">Maven Install</span>). </div>
<p class="calibre3">Elastic Beanstalk can significantly save time in deploying applications to the cloud. It requires a lot less setup and configuration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying in Google Cloud</h1>
                
            
            <article>
                
<p class="calibre3">In this section, we will see how to deploy JEE applications in Google Compute Engine (IaaS offering) and Google App Engine (PaaS offering). Compute Engine (<a href="https://cloud.google.com/compute/" class="calibre9">https://cloud.google.com/compute/</a>) can be considered an AWS EC2 counterpart, and App Engine (<a href="https://cloud.google.com/appengine" class="calibre9">https://cloud.google.com/appengine</a> ) an Elastic Beanstalk counterpart. You need to have a Google account to login to Cloud Console at <a href="https://console.cloud.google.com" class="calibre9">https://console.cloud.google.com</a>. You need to have at least one project created in Google Cloud to deploy applications. When you login to the Cloud Console, it will prompt you to create a project if there are no projects already available:</p>
<div class="packt_figure1"><img src="../images/00260.jpeg" class="calibre252"/></div>
<div class="packt_figure1">Figure 13.19: Creating a Google Cloud project from the Dashboard</div>
<p class="calibre3">All you need to enter in the <span class="calibre12">Create Project</span> page is the name of the project. The <span class="calibre12">Project ID</span> will be automatically selected for you. You should keep this Project ID handy, because many SDK commands need a Project ID as one of their parameters.</p>
<p class="calibre3">If you already have projects, but want to create a new project for this book, open the Google Cloud Console web page and go to the <span class="calibre12">IAM &amp; admin</span> | <span class="calibre12">Manage resources</span> page. Click the <span class="calibre12">Create Project</span> link on the page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Setting up Google Cloud Tools</h1>
                
            
            <article>
                
<p class="calibre3">Setting up Google Cloud Tools requires multiple steps. Let’s start with installing the SDK.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing the Google Cloud SDK</h1>
                
            
            <article>
                
<p class="calibre3">Download the SDK from <a href="https://cloud.google.com/sdk/" class="calibre9">https://cloud.google.com/sdk/</a>. Unzip it and run the following command from the <kbd class="calibre13">bin</kbd> folder:</p>
<pre class="calibre25"><strong class="calibre1">gcloud init</strong></pre>
<p class="calibre3">See <a href="https://cloud.google.com/sdk/docs/initializing" class="calibre9">https://cloud.google.com/sdk/docs/initializing</a> for more options regarding initializing the SDK.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing Java extensions for the App Engine SDK</h1>
                
            
            <article>
                
<p class="calibre3">Run the following command (make sure that the Cloud SDK is installed and configured):</p>
<pre class="calibre25"><strong class="calibre1">gcloud components install app-engine-java</strong></pre>
<p class="calibre3">See <a href="https://cloud.google.com/sdk/docs/managing-components" class="calibre9">https://cloud.google.com/sdk/docs/managing-components</a> for details on managing Google Cloud components.</p>
<p class="calibre3">Next, set the default project name for <kbd class="calibre13">gcloud</kbd> commands:</p>
<pre class="calibre25"><strong class="calibre1">gcloud config set project &lt;your-project-name-here&gt;</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing Google Cloud Tools for Eclipse</h1>
                
            
            <article>
                
<p class="calibre3">To install the plugin for Google Cloud in Eclipse, open <span class="calibre12">Eclipse Marketplace</span> (select the menu <span class="calibre12">Help</span> | <span class="calibre12">Eclipse Marketplace...</span>). Search for <span class="calibre12">Google Cloud Tools</span>:</p>
<div class="packt_figure1"><img src="../images/00261.jpeg" class="calibre253"/></div>
<div class="packt_figure1">Figure 13.20: Installing the Google Cloud Tools plugin from the Marketplace</div>
<div class="mce-root1"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Setting Eclipse Preferences for Google Cloud Tools</h1>
                
            
            <article>
                
<p class="calibre3">Open Eclipse <span class="calibre12">Preferences</span> and go to the <span class="calibre12">Google Cloud Tools</span> preferences:</p>
<div class="packt_figure1"><img src="../images/00262.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.21: Setting the SDK path in Google Cloud Tools preferences</div>
<p class="calibre3">Enter the path to the folder where you unzipped the SDK in the <span class="calibre12">SDK location</span> field.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying the application in Google Compute Engine</h1>
                
            
            <article>
                
<p class="calibre3">In this section, we will create an instance of a VM in Google Compute Engine and deploy a JEE application in it. Once we create a VM, we can follow the same steps we did to install the GlassFish Server and the <em class="calibre21">Course Management</em> application in the EC2 instance in the preceding <em class="calibre21">Installing the CourseManagement EJB application in an EC2 instance</em> section. But let’s deploy a different application in the Compute Engine. In the last chapter, we saw how to deploy JEE applications in Docker containers. So, let’s install Docker in a VM in Compute Engine and deploy the <kbd class="calibre13">CourseManagement</kbd> service in it. But first, let’s create a VM. Unfortunately, at the time of writing this book, <span class="calibre12">Google Cloud Tools</span> for Eclipse does not provide much support for working with Compute Engine. Therefore, we will be using either the Google Cloud Console web page or Terminal on the host machine. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a VM instance in Google Compute Engine</h1>
                
            
            <article>
                
<p class="calibre3">Login to the Google Cloud Console (<a href="https://console.cloud.google.com" class="calibre9">https://console.cloud.google.com</a>) and go to the <span class="calibre12">Compute Engine</span> | <span class="calibre12">VM Instances</span> page. Click the <span class="calibre12">Create Instance</span> link. Create an instance using <span class="calibre12">Debian GNU/Linux boot disk</span>. Make sure to select the <span class="calibre12">Allow HTTP traffic</span> and <span class="calibre12">Allow HTTPS traffic</span> options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Installing Docker in a VM instance</h1>
                
            
            <article>
                
<p class="calibre3">In the VM instances page, select the instance you want to use and drop down the <span class="calibre12">SSH</span> options (in the <span class="calibre12">Connect</span> column in the table):</p>
<div class="packt_figure1"><img src="../images/00263.jpeg" class="calibre254"/></div>
<div class="packt_figure1">Figure 13.22: Opening an SSH connection to a VM instance</div>
<p class="calibre3">Select <span class="calibre12">Open in browser window</span>. This option opens a browser window and opens a SSH shell in the VM instance. Run the following commands in the shell to install Docker:</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Command</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo apt-get update</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Gets the latest version of packages and dependencies</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">curl -fsSL get.docker.com -o get-docker.sh</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Downloads the Docker installer script</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo sh get-docker.sh</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Runs the installer script</p>
</td>
</tr>
</tbody>
</table>
<div class="packt_infobox"><br class="calibre26"/>
See <a href="https://docs.docker.com/install/linux/docker-ce/debian/" class="calibre17">https://docs.docker.com/install/linux/docker-ce/debian/</a> for more information on installing Docker on a Debian distribution.</div>
<p class="calibre3">Once Docker is installed, we need to execute a few commands so that the Docker command can be called without using <kbd class="calibre13">sudo</kbd> (Docker runs as the root):</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Command</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo groupadd docker</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Creates a Docker user group. It probably already exists.</p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo usermod -aG docker $USER</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Adds a current user to the Docker group.</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">See <a href="https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user" class="calibre9">https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user</a> for more details.</p>
<p class="calibre3">Log out of the shell and log back in (close the shell window and open a new shell window). If all of the preceding commands have been executed successfully, then you should be able to run the <kbd class="calibre13">docker ps</kbd> command without <kbd class="calibre13">sudo</kbd>.</p>
<p class="calibre3">Next, we will install <kbd class="calibre13">docker-compose</kbd> in the instance (see <a href="https://docs.docker.com/compose/install/" class="calibre9">https://docs.docker.com/compose/install/</a>). Execute the following commands (the version number might be different in the command to install <kbd class="calibre13">docker-compose</kbd>):</p>
<table border="1" class="calibre49">
<tbody class="calibre50">
<tr class="calibre51">
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Command</strong></p>
</td>
<td class="calibre52">
<p class="calibre3"><strong class="calibre5">Description</strong></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo curl -L https://github.com/docker/compose/releases/download/1.18.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Downloads <kbd class="calibre13">docker-compose</kbd></p>
</td>
</tr>
<tr class="calibre51">
<td class="calibre52">
<pre class="calibre25"><strong class="calibre1">sudo chmod +x /usr/local/bin/docker-compose</strong></pre></td>
<td class="calibre52">
<p class="calibre3">Makes <kbd class="calibre13">docker-compose</kbd> executable</p>
</td>
</tr>
</tbody>
</table>
<p class="calibre3"> </p>
<p class="calibre3">We created <kbd class="calibre13">docker-compose</kbd> deployment configuration in <span class="calibre12"><a href="part0229.html#6QCGQ0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 12</a>, </span><em class="calibre21">Microservices</em>. We will deploy the same in the VM instance we have created in this section. The source code for this chapter includes a folder named <kbd class="calibre13">coursemanagement-docker-compose</kbd>. Upload all files in that folder to the VM instance. You can either upload from the browser shell window or use the <kbd class="calibre13">gcloud</kbd> command from your host machine. In the browser shell, click on the Settings icon in the upper-right corner and select the <span class="calibre12">Upload File</span> option. Upload all of the files that are in the <kbd class="calibre13">coursemanagement-docker-compose</kbd> folder. To upload from Terminal, execute the following <kbd class="calibre13">gcloud</kbd> command after changing the folder to <kbd class="calibre13">coursemanagement-docker-compose</kbd>:</p>
<pre class="calibre25"><strong class="calibre1">gcloud compute scp * &lt;your-instance-name-here&gt;:~/</strong></pre>
<p class="calibre3">This command copies all of the files in the current folder (which in our case is <kbd class="calibre13">coursemanagement-docker-compose</kbd>) to the user’s home folder in the instance.</p>
<p class="calibre3">Whichever method you use to upload the files, make sure that you have the following files in the VM instance:</p>
<ul class="calibre10">
<li class="calibre11"><kbd class="calibre13">course-management-db.dockerfile</kbd></li>
<li class="calibre11"><kbd class="calibre13">course-management-service.dockerfile</kbd></li>
<li class="calibre11"><kbd class="calibre13">docker-compose.yml</kbd></li>
<li class="calibre11"><kbd class="calibre13">course-management-db.sql</kbd></li>
<li class="calibre11"><kbd class="calibre13">coursemanagementspring-0.0.1-SNAPSHOT.jar</kbd></li>
</ul>
<p class="calibre3">In the browser shell for the VM instance, execute the following command to set up the database and REST service in Docker containers:</p>
<pre class="calibre25"><strong class="calibre1">docker-compose up -d</strong></pre>
<p class="calibre3">See <a href="part0229.html#6QCGQ0-d43a3a5ee6dd4ebc9d7c7e1cc8d7df55" class="calibre9">Chapter 12</a>, <em class="calibre21">Microservices</em>, for more details on the preceding files and the command. Once the command is executed successfully, browse to <kbd class="calibre13">http://&lt;instance_external_ip&gt;/course_management/courses</kbd>. You will just see an empty JSON array, because there is no data in the database. You can find the external IP of your instance from the <span class="calibre12">Compute Engine</span> | <span class="calibre12">VM Instances</span> page.</p>
<p class="calibre3">Run the <kbd class="calibre13">docker-compose down</kbd> command to shut down the containers.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying the application in Google App Engine</h1>
                
            
            <article>
                
<p class="calibre3">App Engine is Google’s <strong class="calibre5">Platform as a Service</strong> (<strong class="calibre5"><span class="calibre12">PaaS</span></strong>) offering, similar to Elastic Beanstalk from Amazon. In the section <q class="calibre207">Creating Elastic Beanstalk application from Eclipse</q>, we deployed the <kbd class="calibre13">CourseManagementREST</kbd> service using Elastic Beanstalk. In this section, we will learn how to deploy the same service using Google App Engine.</p>
<p class="calibre3">Let’s make a copy of the <kbd class="calibre13">CourseManagementREST</kbd> project. Right-click on the project in Eclipse <span class="calibre12">Project Explorer</span> and select <span class="calibre12">Copy</span>. Right-click anywhere in <span class="calibre12">Project Explorer</span> and select <span class="calibre12">Paste</span>. Eclipse will prompt you to name the project. Let’s name it <kbd class="calibre13">CourseManagementREST-GAE</kbd>. We will deploy this project using Google App Engine.</p>
<p class="calibre3">Let’s configure our project as an App Engine project. Right-click on the <span class="calibre12">CourseManagementREST-GAE</span> project in <span class="calibre12">Project Explorer</span> and select <span class="calibre12">Configure</span> | <span class="calibre12">Convert to App Engine Standard Project</span>.</p>
<div class="packt_tip">If you are creating a new project for deployment to Google App Engine, then go to the <span class="calibre23">File</span> | <span class="calibre23">New</span> | <span class="calibre23">Google App Engine Standard Java Project</span> menu. Or, go to the drop-down menu from the <span class="calibre23">Google Cloud Platform</span> icon in the toolbar and select <span class="calibre23">Create New Project</span> | <span class="calibre23">Google App Engine Standard Java Project</span>.</div>
<p class="calibre3">Before we deploy the project, remove <kbd class="calibre13">web.xml</kbd> from the <kbd class="calibre13">src/main/webapp/WEB-INF</kbd> folder. Google App Engine’s Java platform uses the Jetty server and it does not need <kbd class="calibre13">web.xml</kbd> for this deployment.</p>
<div class="packt_tip"><span class="calibre23">You may see an error stating <kbd class="calibre48">web.xml is missing and &lt;failOnMissingWebXml&gt; is set to true pom.xml</kbd> after deleting <kbd class="calibre48">web.xml</kbd>. To suppress this error, add the following property in <kbd class="calibre48">pom.xml</kbd>:<br class="calibre26"/></span><br class="calibre26"/>
<kbd class="calibre48"><span class="calibre23">&lt;properties&gt;</span></kbd><br class="calibre26"/>
<kbd class="calibre48"><span class="calibre23">    &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;   </span></kbd><br class="calibre26"/>
<kbd class="calibre48"><span class="calibre23">&lt;/properties&gt;</span></kbd></div>
<p class="calibre3">To test this application locally, go to the <span class="calibre12">Servers</span> view, right-click on it, and select <span class="calibre12">New</span> | <span class="calibre12">Server</span>. Then, expand the <span class="calibre12">Google</span> group and select <span class="calibre12">App Engine Standard</span>:</p>
<div class="packt_figure1"><img src="../images/00264.jpeg" class="calibre255"/></div>
<div class="packt_figure1">Figure 13.23: Creating a local App Engine server</div>
<p class="calibre3">Click <span class="calibre12">Next</span> and add the <span class="calibre12">CourseManagementREST-GAE</span> project for deployment:</p>
<div class="packt_figure1"><img src="../images/00265.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.24: Adding the CourseManagementREST-GAE project for deployment</div>
<p class="calibre3">Click <span class="calibre12">Finish</span> and start the server from the <span class="calibre12">Server</span> view. Then, browse to <kbd class="calibre13">http://localhost:8080/services/course/get/1</kbd> to verify that the application has been deployed properly.</p>
<div class="packt_tip">If you get errors regarding the JDK version in <kbd class="calibre48">pom.xml</kbd>, add the following section in <kbd class="calibre48">pom.xml</kbd>, above the dependencies section:<br class="calibre26"/>
<br class="calibre26"/>
<kbd class="calibre48">&lt;properties&gt;</kbd><br class="calibre26"/>
<kbd class="calibre48">  &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;</kbd><br class="calibre26"/>
<kbd class="calibre48">  &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;</kbd><br class="calibre26"/>
<kbd class="calibre48">&lt;/properties&gt;</kbd></div>
<p class="calibre3">Before you deploy this project to Google App Engine, you should make sure that an application has been created in Google App Engine. Browse to <a href="https://console.cloud.google.com/appengine" class="calibre9">https://console.cloud.google.com/appengine</a> and check if any application exists. If not, you can create an application from that page. Alternately, you can run the following command in Terminal:</p>
<pre class="calibre25"><strong class="calibre1">gcloud app create</strong></pre>
<p class="calibre3">To deploy this project to Google App Engine, select the project in <span class="calibre12">Project Explorer</span> and the drop-down menu from the <span class="calibre12">Google Cloud Platform</span> toolbar button:</p>
<div class="packt_figure1"><img src="../images/00266.jpeg" class="calibre29"/></div>
<div class="packt_figure1">Figure 13.25: Deploying the project to Google App Engine</div>
<p class="calibre3">Select the <span class="calibre12">Deploy to App Engine Standard...</span> menu:</p>
<div class="packt_figure1"><img src="../images/00267.jpeg" class="calibre256"/></div>
<div class="packt_figure1">Figure 13.26: Setting deployment parameters for Google App Engine</div>
<p class="calibre3">Select your Google account from the drop-down menu, if not already selected, and then select the Google Cloud project you want the application deployed to.</p>
<p class="calibre3">Once the project is deployed, browse to <kbd class="calibre13">https://&lt;your_project_id&gt;.appsport.com/services/course/get/1</kbd> to verify it.</p>
<p class="calibre3">To stop the application, you need to disable the application—open <a href="https://console.cloud.google.com" class="calibre9">https://console.cloud.google.com</a> and go to <span class="calibre12">App Engine</span> | <span class="calibre12">Settings</span> and click the <span class="calibre12">Disable Application</span> button.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre3">In this chapter, we learned about two types of cloud deployment services provided by Amazon and Google. One is IaaS and the other is PaaS. PaaS lets you deploy your application in a pre-configured environment, while IaaS gives you complete control over deployment configuration. The IaaS offering from Amazon is called EC2 and the one from Google is called Compute Engine. The PaaS offering from Amazon is called Elastic Beanstalk and the one from Google is called App Engine.</p>
<p class="calibre3">We deployed the <kbd class="calibre13">CourseManagement</kbd> EJB application in the GlassFish Server in an instance of Amazon EC2. We then deployed the <kbd class="calibre13">CourseManagementREST</kbd> service in Elastic Beanstalk.</p>
<p class="calibre3">Then, we deployed a Docker container with the <kbd class="calibre13">CourseManagement</kbd> service in an instance of Google Compute Engine. Lastly, we deployed the <kbd class="calibre13">CourseManagementREST</kbd> service in Google App Engine.</p>
<p class="calibre3">In the next chapter, we will learn how to secure JEE applications.</p>


            </article>

            
        </section>
    </body></html>