<html><head></head><body>
<div id="_idContainer052">
<h1 class="chapter-number" id="_idParaDest-128"><a id="_idTextAnchor135"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-129"><a id="_idTextAnchor136"/><span class="koboSpan" id="kobo.2.1">Securing Jakarta EE Applications</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Jakarta EE Security standardizes application security across all Jakarta EE-compliant application servers. </span><span class="koboSpan" id="kobo.3.2">The API includes standardized access to identity stores, which allow a uniform way of retrieving user credentials from a relational or </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">Lightweight Directory Access Protocol</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">LDAP</span></strong><span class="koboSpan" id="kobo.7.1">) database, as well as allowing us to implement access to custom identity stores. </span><span class="koboSpan" id="kobo.7.2">Jakarta EE Security includes authentication mechanism support, allowing us to authenticate a user in a standard way. </span><span class="koboSpan" id="kobo.7.3">Several authentication mechanisms are supported, such as the basic authentication supported by most browsers, client certificates, and </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">HTML forms.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">The following topics will be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">this chapter:</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.11.1">Identity stores</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.12.1">Authentication mechanisms</span></span></li>
</ul>
<p class="callout-heading"><span class="koboSpan" id="kobo.13.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.14.1">Example source code for this chapter can be found on GitHub at the following </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">link: </span></span><a href="https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch10_src"><span class="No-Break"><span class="koboSpan" id="kobo.16.1">https://github.com/PacktPublishing/Jakarta-EE-Application-Development/tree/main/ch10_src</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.17.1">.</span></span></p>
<h1 id="_idParaDest-130"><a id="_idTextAnchor137"/><span class="koboSpan" id="kobo.18.1">Identity stores</span></h1>
<p><span class="koboSpan" id="kobo.19.1">Identity stores </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.20.1">provide access to a persistence storage system, such as a relational or LDAP database, where user credentials are stored. </span><span class="koboSpan" id="kobo.20.2">The Jakarta EE Security API supports relational and LDAP databases directly, and it allows us to integrate with custom identity stores, </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">if necessary.</span></span></p>
<h2 id="_idParaDest-131"><a id="_idTextAnchor138"/><span class="koboSpan" id="kobo.22.1">Setting up an identity store stored in a relational database</span></h2>
<p><span class="koboSpan" id="kobo.23.1">To </span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.24.1">authenticate a secured resource, such as a servlet or RESTful web service, against credentials stored in a relational database, annotate an application-scoped CDI bean with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.25.1">@DatabaseIdentityStoreDefinition</span></strong><span class="koboSpan" id="kobo.26.1"> annotation, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.28.1">
package net.ensode.javaee8book.httpauthdatabaseidentitystore.security;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.29.1">@DatabaseIdentityStoreDefinition(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.30.1">  dataSourceLookup = "java:global/jdbc/userauthdbDatasource",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.31.1">    callerQuery =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.32.1">      "select password from users where USERNAME = ?",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.33.1">    groupsQuery =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.34.1">      "select g.GROUP_NAME from USER_GROUPS ug, users u, "</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.35.1">        + "GROUPS g where ug.USER_ID = u.user_id and "</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.36.1">        + "g.GROUP_ID= ug.GROUP_ID and u.USERNAME=?"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.37.1">)</span></strong><span class="koboSpan" id="kobo.38.1">
@ApplicationScoped
public class ApplicationConfig {
}</span></pre> <p><span class="koboSpan" id="kobo.39.1">In our </span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.40.1">example, the JNDI name for the JDBC connection for the relational database containing user credentials is </span><strong class="source-inline"><span class="koboSpan" id="kobo.41.1">java:global/jdbc/userauthdbDatasource</span></strong><span class="koboSpan" id="kobo.42.1">, which is the value we provided to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.43.1">dataSourceLookup</span></strong><span class="koboSpan" id="kobo.44.1"> attribute of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.45.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.46.1">DatabaseIdentityStoreDefinition</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.47.1"> annotation.</span></span></p>
<p><span class="koboSpan" id="kobo.48.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.49.1">callerQuery</span></strong><span class="koboSpan" id="kobo.50.1"> parameter of </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">@DatabaseIdentityStoreDefinition</span></strong><span class="koboSpan" id="kobo.52.1"> is used to specify the SQL query used to retrieve the username and password for the user we are authenticating. </span><span class="koboSpan" id="kobo.52.2">The values retrieved from the database must match the values provided by the user (via an authentication mechanism, which we will discuss in the </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">next section).</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">Most secured </span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.55.1">applications have different types of users, separated into roles; for example, an application could have “regular” users plus administrators. </span><span class="koboSpan" id="kobo.55.2">Administrators would be allowed to perform certain actions that regular users would not. </span><span class="koboSpan" id="kobo.55.3">For example, administrators could be able to reset user passwords and add or remove users from the system. </span><span class="koboSpan" id="kobo.55.4">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">groupsQuery</span></strong><span class="koboSpan" id="kobo.57.1"> attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">@DatabaseIdentityStoreDefinition</span></strong><span class="koboSpan" id="kobo.59.1"> allows us to retrieve all roles for </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">the user.</span></span></p>
<h2 id="_idParaDest-132"><a id="_idTextAnchor139"/><span class="koboSpan" id="kobo.61.1">Setting up an identity store stored in an LDAP database</span></h2>
<p><span class="koboSpan" id="kobo.62.1">To </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.63.1">secure resources against credentials stored in an LDAP database, we need to annotate the resource to be secured (such as a servlet or RESTful web service) with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">@LdapIdentityStoreDefinition</span></strong><span class="koboSpan" id="kobo.65.1"> annotation; the following example illustrates how to </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">do this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.67.1">
package com.ensode.jakartaeebook.httpauthdatabaseidentitystore.servlet;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.68.1">@LdapIdentityStoreDefinition(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.69.1">        url = "ldap://myldapserver:33389/",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.70.1">        callerBaseDn = "ou=caller,dc=packtpub,dc=com",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.71.1">        groupSearchBase = "ou=group,dc=packtpub,dc=com")</span></strong><span class="koboSpan" id="kobo.72.1">
@WebServlet(name = "ControllerServlet", urlPatterns = {"/controller"})
public class ControllerServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req,
      HttpServletResponse res)
            throws ServletException, IOException {
        System.out.println("doGet() invoked");
    }
}</span></pre> <p><span class="koboSpan" id="kobo.73.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">url</span></strong><span class="koboSpan" id="kobo.75.1"> attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">@LdapIdentityStoreDefinition</span></strong><span class="koboSpan" id="kobo.77.1"> is used to specify the URL of the</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.78.1"> LDAP server containing user credentials for our application; its </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">callerBaseDn</span></strong><span class="koboSpan" id="kobo.80.1"> attribute is used to specify the LDAP base distinguished name to verify user credentials supplied by the user, and, finally, its </span><strong class="source-inline"><span class="koboSpan" id="kobo.81.1">groupSearchBase</span></strong><span class="koboSpan" id="kobo.82.1"> attribute is used to retrieve the roles for </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">the user.</span></span></p>
<h2 id="_idParaDest-133"><a id="_idTextAnchor140"/><span class="koboSpan" id="kobo.84.1">Custom identity stores</span></h2>
<p><span class="koboSpan" id="kobo.85.1">In </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.86.1">some cases, we may need to integrate our application security with an identity store not directly supported by the Security API. </span><span class="koboSpan" id="kobo.86.2">For example, we</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.87.1"> may have a requirement to integrate with an existing commercial security product. </span><span class="koboSpan" id="kobo.87.2">For such cases, the Jakarta EE Security API allows us to roll out our own identity </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">store definition.</span></span></p>
<p><span class="koboSpan" id="kobo.89.1">To handle custom identity stores, we need to create an application-scoped CDI bean (refer to </span><a href="B21231_02.xhtml#_idTextAnchor022"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.90.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.91.1">), and the bean must implement the </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">IdentityStore</span></strong><span class="koboSpan" id="kobo.93.1"> interface, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.95.1">
package com.ensode.jakartaeebook.security.basicauthexample;
//imports omitted for brevity
@ApplicationScoped
public class DummyIdentityStore implements IdentityStore {
  Set&lt;String&gt; adminRoleSet;
  Set userRoleSet;
  Set userAdminRoleSet;
  @PostConstruct
  public void init() {
    adminRoleSet = new HashSet&lt;&gt;(Arrays.asList("admin"));
    userRoleSet = new HashSet&lt;&gt;(Arrays.asList("user"));
    userAdminRoleSet = new HashSet&lt;&gt;(Arrays.asList("user",
      "admin"));
  }
  </span><strong class="bold"><span class="koboSpan" id="kobo.96.1">@Override</span></strong><span class="koboSpan" id="kobo.97.1">
  </span><strong class="bold"><span class="koboSpan" id="kobo.98.1">public CredentialValidationResult validate(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.99.1">   Credential credential) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.100.1">   UsernamePasswordCredential usernamePasswordCredential =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.101.1">     (UsernamePasswordCredential) credential;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.102.1">    CredentialValidationResult credentialValidationResult;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.103.1">    if (usernamePasswordCredential.compareTo(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.104.1">      "david", "secret")) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.105.1">      credentialValidationResult = new</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.106.1">        CredentialValidationResult("david", adminRoleSet);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.107.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.108.1">    else if (usernamePasswordCredential.compareTo(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.109.1">      "alan", "iforgot")) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.110.1">      credentialValidationResult =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.111.1">        new CredentialValidationResult("alan", userAdminRoleSet);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.112.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.113.1">    else if (usernamePasswordCredential.compareTo("alice",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.114.1">     "password")) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.115.1">      credentialValidationResult = new</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.116.1">        CredentialValidationResult("alice", userRoleSet);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.117.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.118.1">    else {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.119.1">      credentialValidationResult =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.120.1">        CredentialValidationResult.INVALID_RESULT;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.121.1">    }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.122.1">    return credentialValidationResult;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.123.1">  }</span></strong><span class="koboSpan" id="kobo.124.1">
}</span></pre> <p><span class="koboSpan" id="kobo.125.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">validate()</span></strong><span class="koboSpan" id="kobo.127.1"> method</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.128.1"> is defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">IdentityStore</span></strong><span class="koboSpan" id="kobo.130.1"> interface provided by the security </span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.131.1">API in our example. </span><span class="koboSpan" id="kobo.131.2">We implement this method so that we can use custom validation in </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">our application.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.133.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.134.1">In our example, we are hard coding valid credentials into the code; do not do this for real applications as this would be a major </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">security risk.</span></span></p>
<p><span class="koboSpan" id="kobo.136.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">validate()</span></strong><span class="koboSpan" id="kobo.138.1"> method defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">IdentityStore</span></strong><span class="koboSpan" id="kobo.140.1"> interface accepts an instance of a class implementing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">Credential</span></strong><span class="koboSpan" id="kobo.142.1"> interface as its sole argument. </span><span class="koboSpan" id="kobo.142.2">In the body of our method, we cast it down to </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">UserNamePasswordCredential</span></strong><span class="koboSpan" id="kobo.144.1">, and then we invoke its </span><strong class="source-inline"><span class="koboSpan" id="kobo.145.1">compareTo()</span></strong><span class="koboSpan" id="kobo.146.1"> method, passing the expected username and password. </span><span class="koboSpan" id="kobo.146.2">If the provided credentials match either one of the expected set of credentials, then we allow the user to successfully log in. </span><span class="koboSpan" id="kobo.146.3">We do this by returning an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">CredentialValidationResult</span></strong><span class="koboSpan" id="kobo.148.1"> containing the username and </span><strong class="source-inline"><span class="koboSpan" id="kobo.149.1">Set</span></strong><span class="koboSpan" id="kobo.150.1"> containing all the roles that the user has in </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">our application.</span></span></p>
<p><span class="koboSpan" id="kobo.152.1">If the supplied credentials don’t match either of the expected credentials, then we prevent the user from logging in by </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">returning </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">CredentialValidationResult.INVALID_RESULT</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.156.1">Now that we have seen how to access user credential information via identity stores, we’ll focus our attention on the different authentication mechanisms provided by </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">Jakarta EE.</span></span></p>
<h1 id="_idParaDest-134"><a id="_idTextAnchor141"/><span class="koboSpan" id="kobo.158.1">Authentication mechanisms</span></h1>
<p><span class="koboSpan" id="kobo.159.1">Authentication mechanisms </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.160.1">provide a way for the user to provide their credentials so that they can be authenticated against an </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">identity store.</span></span></p>
<p><span class="koboSpan" id="kobo.162.1">The Jakarta EE Security API provides support for the HTTP Basic authentication mechanism provided by most browsers, as well as form authentication, which is the most common authentication mechanism where users provide their credentials via an </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">HTML form.</span></span></p>
<p><span class="koboSpan" id="kobo.164.1">Form authentication by default submits a form to the security servlet provided by the Jakarta EE implementation. </span><span class="koboSpan" id="kobo.164.2">If we need more flexibility or to better align with other Jakarta EE technologies, the Security API provides custom form authentication as well, which allows us as application developers to have more control over how to authenticate users attempting to access </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">our application.</span></span></p>
<h2 id="_idParaDest-135"><a id="_idTextAnchor142"/><span class="koboSpan" id="kobo.166.1">Basic authentication mechanism</span></h2>
<p><span class="koboSpan" id="kobo.167.1">A </span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.168.1">basic authentication mechanism can</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.169.1"> be achieved by annotating the resource as secure (i.e, a servlet or RESTful web service) with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">BasicAuthenticationMechanismDefinition</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.172.1"> annotation:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.173.1">
package com.ensode.jakartaeebook.security.basicauthexample;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.174.1">@BasicAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.175.1">
@WebServlet(name = "SecuredServlet", urlPatterns = {"/securedServlet"})
</span><strong class="bold"><span class="koboSpan" id="kobo.176.1">@ServletSecurity(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.177.1">        @HttpConstraint(rolesAllowed = "admin"))</span></strong><span class="koboSpan" id="kobo.178.1">
public class SecuredServlet extends HttpServlet {
  @Override
   protected void doGet(HttpServletRequest request,
      HttpServletResponse response) throws Exception {
      response.getOutputStream().print(
        "Congratulations, login successful.");
  }
}</span></pre> <p><span class="koboSpan" id="kobo.179.1">We declare</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.180.1"> the user roles </span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.181.1">that are allowed to access the secured resource via the </span><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">@HttpConstraint</span></strong><span class="koboSpan" id="kobo.183.1"> annotation, which is an attribute of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">@ServletSecurity</span></strong><span class="koboSpan" id="kobo.185.1"> annotation. </span><span class="koboSpan" id="kobo.185.2">In our example, only users with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">admin</span></strong><span class="koboSpan" id="kobo.187.1"> role are allowed to access the </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">secured resource.</span></span></p>
<p><span class="koboSpan" id="kobo.189.1">Using basic authentication will cause a window to pop up in the browser asking for a username and a password, as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.190.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.191.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.193.1"><img alt="Figure 10.1 – Basic authentication login prompt" src="image/B21231_10_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.194.1">Figure 10.1 – Basic authentication login prompt</span></p>
<p><span class="koboSpan" id="kobo.195.1">If the user </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.196.1">enters the correct </span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.197.1">credentials and has the necessary role, access is granted to the protected resource, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.198.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.199.1">.2</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.200.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.201.1"><img alt="Figure 10.2 – Successful basic authentication" src="image/B21231_10_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.202.1">Figure 10.2 – Successful basic authentication</span></p>
<p><span class="koboSpan" id="kobo.203.1">If the user enters incorrect credentials, the login popup will show up again, allowing the user to re-enter </span><span class="No-Break"><span class="koboSpan" id="kobo.204.1">their credentials.</span></span></p>
<p><span class="koboSpan" id="kobo.205.1">If the user enters the correct credentials but does not have the appropriate role to access the protected resource, the server will return an HTTP 403 error code, indicating that the user is forbidden from accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">protected resource.</span></span></p>
<h2 id="_idParaDest-136"><a id="_idTextAnchor143"/><span class="koboSpan" id="kobo.207.1">Form authentication mechanism</span></h2>
<p><span class="koboSpan" id="kobo.208.1">Another </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.209.1">way we can authenticate our users is to develop an HTML form to collect the user’s credentials, and then</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.210.1"> delegate authentication to the Jakarta EE Security API. </span><span class="koboSpan" id="kobo.210.2">The first step when following this approach is to develop an HTML page containing a form where the user can log in to the application, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">following example:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.212.1">&lt;form method="POST" action="j_security_check"&gt;</span></strong><span class="koboSpan" id="kobo.213.1">
  &lt;table cellpadding="0" cellspacing="0" border="0"&gt;
    &lt;tr&gt;
      &lt;td align="right"&gt;Username:&amp;nbsp;&lt;/td&gt;
      &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.214.1">&lt;input type="text" name="j_username"&gt;</span></strong><span class="koboSpan" id="kobo.215.1">&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td align="right"&gt;Password:&amp;nbsp;&lt;/td&gt;
      &lt;td&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.216.1">&lt;input type="password" name="j_password"&gt;</span></strong><span class="koboSpan" id="kobo.217.1">&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;/td&gt;
      &lt;td&gt;&lt;input type="submit" value="Login"&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/form&gt;</span></pre> <p><span class="koboSpan" id="kobo.218.1">As seen in the example, the HTML form used for logging in must submit an HTTP POST request, and the value for its </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">action</span></strong><span class="koboSpan" id="kobo.220.1"> attribute must be </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">j_security_check</span></strong><span class="koboSpan" id="kobo.222.1">. </span><span class="koboSpan" id="kobo.222.2">Now, </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">j_security_check</span></strong><span class="koboSpan" id="kobo.224.1"> maps to a servlet provided by the Jakarta EE Security API. </span><span class="koboSpan" id="kobo.224.2">We don’t need to develop any validation logic ourselves. </span><span class="koboSpan" id="kobo.224.3">The form must have a couple of input fields, one for the username and one for the password. </span><span class="koboSpan" id="kobo.224.4">The names for these fields must be </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">j_username</span></strong><span class="koboSpan" id="kobo.226.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">j_password</span></strong><span class="koboSpan" id="kobo.228.1"> respectively; the security servlet provided by the Jakarta EE API will retrieve these values and authenticate the </span><span class="No-Break"><span class="koboSpan" id="kobo.229.1">user automatically.</span></span></p>
<p><span class="koboSpan" id="kobo.230.1">Additionally, we </span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.231.1">need to</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.232.1"> provide an HTML page where the user will be redirected if login fails. </span><span class="koboSpan" id="kobo.232.2">The page can have any valid HTML markup. </span><span class="koboSpan" id="kobo.232.3">In our example, we simply provide an error message and a link to direct the user back to the login page so that they can try to log </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">in again:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.234.1">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; 
      charset=UTF-8"&gt;
    &lt;title&gt;Login Error&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    There was an error logging in.
</span><span class="koboSpan" id="kobo.234.2">    &lt;br /&gt;
    &lt;a href="login.html"&gt;Try again&lt;/a&gt;
  &lt;/body&gt;
&lt;/html&gt;</span></pre> <p><span class="koboSpan" id="kobo.235.1">On the server side, all we need to do is annotate the secured resource with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">@FormAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.237.1"> annotation, which will let the Jakarta EE Security API know we are using form-based authentication, and what HTML pages to use to log in or to display when logging </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">in fails:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.239.1">
package com.ensode.jakartaeebook.httpauthdbidentitystore;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.240.1">@FormAuthenticationMechanismDefinition(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.241.1">  loginToContinue = @LoginToContinue(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.242.1">  loginPage = "/login.html",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.243.1">  errorPage = "/loginerror.html")</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.244.1">)</span></strong><span class="koboSpan" id="kobo.245.1">
@DatabaseIdentityStoreDefinition(
  //attributes omitted for brevity
)
@WebServlet("/securedServlet")
@ServletSecurity(
        @HttpConstraint(rolesAllowed = {"admin"}))
public class SecuredServlet extends HttpServlet {
  @Override
  protected void doGet(HttpServletRequest request, HttpServletResponse 
    response)
          throws ServletException, IOException {
    response.getWriter().write("Congratulations, login successful.");
  }
}</span></pre> <p><span class="koboSpan" id="kobo.246.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">@FormAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.248.1"> annotation has a required </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">loginToContinue</span></strong><span class="koboSpan" id="kobo.250.1"> attribute. </span><span class="koboSpan" id="kobo.250.2">The value of this attribute must be an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">@LoginToContinue</span></strong><span class="koboSpan" id="kobo.252.1"> annotation. </span><strong class="source-inline"><span class="koboSpan" id="kobo.253.1">@LoginToContinue</span></strong><span class="koboSpan" id="kobo.254.1"> has two required attributes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">loginPage</span></strong><span class="koboSpan" id="kobo.256.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">errorPage</span></strong><span class="koboSpan" id="kobo.258.1">. </span><span class="koboSpan" id="kobo.258.2">The value of these attributes must indicate the path for</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.259.1"> the login page and the </span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.260.1">path of the page to display in case of authentication </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">failure, respectively.</span></span></p>
<p><span class="koboSpan" id="kobo.262.1">After building and deploying our code, and then attempting to access a protected resource, the user is automatically redirected to our </span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">login page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.264.1"><img alt="Figure 10.3 – Form authentication mechanism" src="image/B21231_10_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.265.1">Figure 10.3 – Form authentication mechanism</span></p>
<p><span class="koboSpan" id="kobo.266.1">If the </span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.267.1">user enters the correct credentials </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.268.1">and has the appropriate role, then access to the protected resource is granted, as illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.269.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.270.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer048">
<span class="koboSpan" id="kobo.272.1"><img alt="Figure 10.4 – Successful form authentication" src="image/B21231_10_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.273.1">Figure 10.4 – Successful form authentication</span></p>
<p><span class="koboSpan" id="kobo.274.1">If invalid credentials are entered, then the user is directed to our custom error page, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.275.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.276.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer049">
<span class="koboSpan" id="kobo.278.1"><img alt="Figure 10.5 – Unsuccessful form authentication" src="image/B21231_10_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.279.1">Figure 10.5 – Unsuccessful form authentication</span></p>
<h2 id="_idParaDest-137"><a id="_idTextAnchor144"/><span class="koboSpan" id="kobo.280.1">Custom form authentication mechanism</span></h2>
<p><span class="koboSpan" id="kobo.281.1">Another</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.282.1"> way we can authenticate users in our application is to use a </span><strong class="bold"><span class="koboSpan" id="kobo.283.1">custom form authentication mechanism</span></strong><span class="koboSpan" id="kobo.284.1">. </span><span class="koboSpan" id="kobo.284.2">This </span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.285.1">type of authentication mechanism is useful when we want to integrate our application with a web framework, such as Jakarta Faces. </span><span class="koboSpan" id="kobo.285.2">In our next example, we will illustrate how to do just that: integrating the Jakarta EE Security API with Jakarta Faces via custom </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">form authentication.</span></span></p>
<p><span class="koboSpan" id="kobo.287.1">To use custom form authentication in our applications, we need to use the aptly named </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">@CustomFormAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.289.1"> annotation, as illustrated in the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.291.1">
package com.ensode.jakartaeebook.httpauthdbidentitystore;
//imports omitted for brevity
</span><strong class="bold"><span class="koboSpan" id="kobo.292.1">@CustomFormAuthenticationMechanismDefinition(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.293.1">    loginToContinue = @LoginToContinue(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.294.1">        loginPage="/faces/login.xhtml",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.295.1">        errorPage=""</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.296.1">    )</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.297.1">)</span></strong><span class="koboSpan" id="kobo.298.1">
@DatabaseIdentityStoreDefinition(
  //attributes omitted for brevity
)
@WebServlet("/securedServlet")
@ServletSecurity(
        @HttpConstraint(rolesAllowed = {"admin"}))
public class SecuredServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request,
      HttpServletResponse response)
      throws ServletException, IOException {
        response.getWriter().write(
          "Congratulations, login successful.");
    }
}</span></pre> <p><span class="koboSpan" id="kobo.299.1">Just like </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">@FormAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.301.1"> we saw previously, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">@CustomFormAuthenticationMechanismDefinition</span></strong><span class="koboSpan" id="kobo.303.1"> annotation has a </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">loginToContinue</span></strong><span class="koboSpan" id="kobo.305.1"> attribute that takes an instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.306.1">@LoginToContinue</span></strong><span class="koboSpan" id="kobo.307.1"> annotation as its value. </span><span class="koboSpan" id="kobo.307.2">In this case, since we are integrating with Jakarta Faces, the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">loginPage</span></strong><span class="koboSpan" id="kobo.309.1"> attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.310.1">@LoginToContinue</span></strong><span class="koboSpan" id="kobo.311.1"> must point to the path of a Facelets page used for the user to log in. </span><span class="koboSpan" id="kobo.311.2">When using Jakarta Faces to authenticate the user, it is</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.312.1"> expected that the login page will display an error message if authentication fails. </span><span class="koboSpan" id="kobo.312.2">Therefore, we need to leave the </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">errorPage</span></strong><span class="koboSpan" id="kobo.314.1"> attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">@</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">LoginToContinue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.317.1"> blank.</span></span></p>
<p><span class="koboSpan" id="kobo.318.1">Our</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.319.1"> login page is a standard Facelets page that collects user credentials and redirects to a CDI bean that acts as </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">a controller:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.321.1">
&lt;h:form&gt;
  &lt;h:messages/&gt;
  &lt;h:panelGrid columns="2"&gt;
    &lt;h:outputLabel for="userName" value="User Name:"/&gt;
    </span><strong class="bold"><span class="koboSpan" id="kobo.322.1">&lt;h:inputText id="userName" value="#{user.userName}"/&gt;</span></strong><span class="koboSpan" id="kobo.323.1">
    &lt;h:outputLabel for="password" value="Password: "/&gt;
    &lt;h:inputSecret id="password" value="#{user.password}"/&gt;
    &lt;h:panelGroup/&gt;
    </span><strong class="bold"><span class="koboSpan" id="kobo.324.1">&lt;h:commandButton action="#{loginController.login()}"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.325.1">    value="Login"/&gt;</span></strong><span class="koboSpan" id="kobo.326.1">
  &lt;/h:panelGrid&gt;
&lt;/h:form&gt;</span></pre> <p><span class="koboSpan" id="kobo.327.1">Our</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.328.1"> login page</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.329.1"> has input fields for </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">userName</span></strong><span class="koboSpan" id="kobo.331.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">password</span></strong><span class="koboSpan" id="kobo.333.1">, and it stores those values in a CDI named bean (not shown as it is trivial) via value binding expressions. </span><span class="koboSpan" id="kobo.333.2">When the user clicks on the </span><strong class="bold"><span class="koboSpan" id="kobo.334.1">Login</span></strong><span class="koboSpan" id="kobo.335.1"> button, controls go to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.336.1">loginController</span></strong><span class="koboSpan" id="kobo.337.1"> CDI named bean that performs the </span><span class="No-Break"><span class="koboSpan" id="kobo.338.1">actual authentication:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.339.1">
package com.ensode.jakartaeebook.httpauthdbidentitystore.customauth;
//imports omitted for brevity
@Named
@RequestScoped
public class LoginController {
    </span><strong class="bold"><span class="koboSpan" id="kobo.340.1">@Inject</span></strong><span class="koboSpan" id="kobo.341.1">
    </span><strong class="bold"><span class="koboSpan" id="kobo.342.1">private SecurityContext securityContext;</span></strong><span class="koboSpan" id="kobo.343.1">
    @Inject
    private User user;
    public void login() {
        FacesContext facesContext = FacesContext.getCurrentInstance();
        ExternalContext externalContext = facesContext.
</span><span class="koboSpan" id="kobo.343.2">          getExternalContext();
        HttpServletRequest httpServletRequest =
          HttpServletRequest) externalContext.getRequest();
        HttpServletResponse httpServletResponse =
          (HttpServletResponse) externalContext.getResponse();
        </span><strong class="bold"><span class="koboSpan" id="kobo.344.1">UsernamePasswordCredential usernamePasswordCredential =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.345.1">      new UsernamePasswordCredential(user.getUserName(),</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.346.1">      </span></strong><strong class="bold"><span class="koboSpan" id="kobo.347.1">user.getPassword());</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.348.1">    AuthenticationParameters authenticationParameters =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.349.1">      AuthenticationParameters.withParams().credential(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.350.1">      usernamePasswordCredential);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.351.1">      AuthenticationStatus authenticationStatus =</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.352.1">        securityContext.authenticate</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.353.1">        (httpServletRequest, httpServletResponse,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.354.1">          authenticationParameters);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.355.1">    if (authenticationStatus.equals(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.356.1">      AuthenticationStatus.SEND_CONTINUE)) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.357.1">        facesContext.responseComplete();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.358.1">    } else if(authenticationStatus.equals(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.359.1">        AuthenticationStatus.SEND_FAILURE)) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.360.1">        FacesMessage facesMessage = new FacesMessage(</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.361.1">          "Login error");</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.362.1">            facesContext.addMessage(null, facesMessage);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.363.1">      }</span></strong><span class="koboSpan" id="kobo.364.1">
    }
}</span></pre> <p><span class="koboSpan" id="kobo.365.1">In our </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">LoginController</span></strong><span class="koboSpan" id="kobo.367.1"> class, we need to inject an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">jakarta.security.enterprise.SecurityContext</span></strong><span class="koboSpan" id="kobo.369.1"> since we will need it for authentication. </span><span class="koboSpan" id="kobo.369.2">We implement the authentication logic in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">login()</span></strong><span class="koboSpan" id="kobo.371.1"> method. </span><span class="koboSpan" id="kobo.371.2">The first thing we need to do is create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">UsernamePasswordCredential</span></strong><span class="koboSpan" id="kobo.373.1">, passing the user-entered username and password as parameters to </span><span class="No-Break"><span class="koboSpan" id="kobo.374.1">its constructor.</span></span></p>
<p><span class="koboSpan" id="kobo.375.1">We then </span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.376.1">create an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">jakarta.security.enterprise.authentication.mechanism.http.AuthenticationParameters</span></strong><span class="koboSpan" id="kobo.378.1"> by invoking the static </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">withParams()</span></strong><span class="koboSpan" id="kobo.380.1"> method on </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">AuthenticationParameters</span></strong><span class="koboSpan" id="kobo.382.1">, then invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">credential()</span></strong><span class="koboSpan" id="kobo.384.1"> method on the resulting instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">AuthenticationParameters</span></strong><span class="koboSpan" id="kobo.386.1">, and passing the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">UserNamePasswordCredential</span></strong><span class="koboSpan" id="kobo.388.1"> we just created as a parameter. </span><span class="koboSpan" id="kobo.388.2">This returns yet another instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.389.1">AuthenticationParameters</span></strong><span class="koboSpan" id="kobo.390.1">, which we can use to actually validate the </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">user-entered credentials.</span></span></p>
<p><span class="koboSpan" id="kobo.392.1">We </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.393.1">validate user-entered credentials by invoking the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">authenticate()</span></strong><span class="koboSpan" id="kobo.395.1"> method on our </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">SecurityContext</span></strong><span class="koboSpan" id="kobo.397.1"> instance, passing the HTTP </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">Request</span></strong><span class="koboSpan" id="kobo.399.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">Response</span></strong><span class="koboSpan" id="kobo.401.1"> objects as parameters, as well as the instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">AuthenticationParameters</span></strong><span class="koboSpan" id="kobo.403.1"> containing the user-entered credentials. </span><span class="koboSpan" id="kobo.403.2">This method invocation will return an instance of </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">AuthenticationStatus</span></strong><span class="koboSpan" id="kobo.405.1">. </span><span class="koboSpan" id="kobo.405.2">We need to check the returned instance to determine whether the user entered </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">valid credentials.</span></span></p>
<p><span class="koboSpan" id="kobo.407.1">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">SecurityContext.authenticate()</span></strong><span class="koboSpan" id="kobo.409.1"> returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">AuthenticationStatus.SEND_CONTINUE</span></strong><span class="koboSpan" id="kobo.411.1">, then the user-entered credentials are valid, and we can allow the user to access the requested resource. </span><span class="koboSpan" id="kobo.411.2">If instead, the method returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">AuthenticationStatus.SEND_FAILURE</span></strong><span class="koboSpan" id="kobo.413.1">, then the user-entered credentials are invalid, and we need to prevent the user from accessing the </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">protected resource.</span></span></p>
<p><span class="koboSpan" id="kobo.415.1">After deploying and running our application, when a user attempts to access a protected resource, he is automatically redirected to a login page, which in this case, since we are using custom form authentication, is implemented using Jakarta Faces. </span><span class="koboSpan" id="kobo.415.2">This is illustrated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.416.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.417.1">.6</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer050">
<span class="koboSpan" id="kobo.419.1"><img alt="Figure 10.6 – Custom form authentication" src="image/B21231_10_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.420.1">Figure 10.6 – Custom form authentication</span></p>
<p><span class="koboSpan" id="kobo.421.1">Entering </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.422.1">correct credentials directs the user to the protected resource (not shown) while entering incorrect </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.423.1">credentials directs the user back to the login page, which should show an appropriate error message as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.424.1">Figure 10</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.425.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer051">
<span class="koboSpan" id="kobo.427.1"><img alt="Figure 10.7 – Custom form authentication failure" src="image/B21231_10_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.428.1">Figure 10.7 – Custom form authentication failure</span></p>
<p><span class="koboSpan" id="kobo.429.1">It is worth noting that custom form authentication is flexible enough to integrate with any web application framework, although it is most commonly used with Jakarta Faces as discussed in </span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">this section.</span></span></p>
<h1 id="_idParaDest-138"><a id="_idTextAnchor145"/><span class="koboSpan" id="kobo.431.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.432.1">In this chapter, we covered the Jakarta Security API. </span><span class="koboSpan" id="kobo.432.2">We discussed the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.434.1">How to access different types of identity stores to retrieve user credentials, such as relational databases or </span><span class="No-Break"><span class="koboSpan" id="kobo.435.1">LDAP databases</span></span></li>
<li><span class="koboSpan" id="kobo.436.1">How the Security API provides the ability to integrate with custom identity stores, in case we need to access one not directly supported, and how to use different authentication mechanisms to allow access to our secured Jakarta </span><span class="No-Break"><span class="koboSpan" id="kobo.437.1">EE applications</span></span></li>
<li><span class="koboSpan" id="kobo.438.1">How to implement the basic authentication mechanism provided by all </span><span class="No-Break"><span class="koboSpan" id="kobo.439.1">web browsers</span></span></li>
<li><span class="koboSpan" id="kobo.440.1">How to implement a form-based authentication mechanism, where we provide custom HTML pages used </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">for authentication</span></span></li>
<li><span class="koboSpan" id="kobo.442.1">How to use custom form authentication, so that we can integrate our application security with a web framework such as </span><span class="No-Break"><span class="koboSpan" id="kobo.443.1">Jakarta Faces</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.444.1">Using the security features provided by Jakarta EE allows us to develop secure applications. </span><span class="koboSpan" id="kobo.444.2">The API is flexible enough to allow integration with arbitrary data stores, as well as any Java web </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">application framework.</span></span></p>
</div>
</body></html>