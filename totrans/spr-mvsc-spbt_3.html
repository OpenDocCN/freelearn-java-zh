<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Advanced Spring Boot Features"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Advanced Spring Boot Features</h1></div></div></div><p>In the previous lesson, we extended our microservice with exception handling, HATEOAS, caching, and internationalization. In this lesson, let's turn our attention to deploying our services to production. To be able to deploy the services to production, we need to be able to set up and create functionality to configure, deploy, and monitor services.</p><p>The following are some of the questions we will answer during this lesson:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How to externalize application configuration?</li><li class="listitem" style="list-style-type: disc">How to use profiles to configure environment-specific values?</li><li class="listitem" style="list-style-type: disc">How to deploy our application to the Cloud?</li><li class="listitem" style="list-style-type: disc">What is an embedded server? How can you use Tomcat, Jetty, and Undertow?</li><li class="listitem" style="list-style-type: disc">What monitoring features does Spring Boot Actuator provide?</li><li class="listitem" style="list-style-type: disc">How can you be a more productive developer with Spring Boot?</li></ul></div><div class="section" title="Externalised Configuration"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec23"/>Externalised Configuration</h1></div></div></div><p>Applications are typically built once (in JAR or WAR) and then deployed into multiple environments. The following figure shows some of the different environments an application can be deployed to:</p><div class="mediaobject"><img alt="Externalised Configuration" src="graphics/03_01.jpg"/></div><p>In each of the preceding environments, an application typically has the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Connections to databases</li><li class="listitem" style="list-style-type: disc">Connections to multiple services</li><li class="listitem" style="list-style-type: disc">Specific environment configurations</li></ul></div><p>It is a good practice to externalize configurations that change between different environments into a configuration file or database.</p><p>Spring Boot provides a flexible, standardized approach for externalized configuration.</p><p>In this section, we will look at the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">How can properties from <code class="literal">application.properties</code> be used inside our services?</li><li class="listitem" style="list-style-type: disc">How do type-safe Configuration Properties make application configuration a cakewalk?</li><li class="listitem" style="list-style-type: disc">What kind of support does Spring Boot provide for <span class="strong"><strong>Spring Profiles</strong></span>?</li><li class="listitem" style="list-style-type: disc">How can you configure properties in <code class="literal">application.properties</code>?</li></ul></div><p>In Spring Boot, <code class="literal">application.properties</code> is the default file from which configuration values are picked up. Spring Boot can pick the <code class="literal">application.properties</code> file from anywhere on the classpath. Typically, <code class="literal">application.properties</code> is located at <code class="literal">src\main\resources</code>, as shown in the following screenshot:</p><div class="mediaobject"><img alt="Externalised Configuration" src="graphics/03_02.jpg"/></div><p>In <a class="link" href="ch02.html" title="Chapter 2. Extending Microservices">Lesson 2</a>, <span class="emphasis"><em>Extending Microservices</em></span>, we looked at examples of customizing Spring Security using configuration in <code class="literal">application.properties</code>:</p><div class="informalexample"><pre class="programlisting">    security.basic.enabled=false
    management.security.enabled=false
    security.user.name=user-name
    security.user.password=user-password
    security.oauth2.client.clientId: clientId
    security.oauth2.client.clientSecret: clientSecret
    security.oauth2.client.authorized-grant-types:                
    authorization_code,refresh_token,password
    security.oauth2.client.scope: openid</pre></div><p>Similar to these, all other Spring Boot starters, modules, and frameworks can be customized through configuration in <code class="literal">application.properties</code>. In the next section, let's look at some of the configuration options Spring Boot provides for these frameworks.</p><div class="section" title="Customizing Frameworks Through application.properties"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec35"/>Customizing Frameworks Through application.properties</h2></div></div></div><p>In this section, we will discuss some of the important things that can be configured through <code class="literal">application.properties</code>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>For the complete list, refer to <a class="ulink" href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#common-application-properties">https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#common-application-properties</a>.</p></div></div><div class="section" title="Logging"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec42"/>Logging</h3></div></div></div><p>Some of the things that can be configured are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The location of the logging configuration file</li><li class="listitem" style="list-style-type: disc">the location of the log file</li><li class="listitem" style="list-style-type: disc">Logging level</li></ul></div><p>The following snippet shows a few examples:</p><div class="informalexample"><pre class="programlisting"># Location of the logging configuration file.
  logging.config=
# Log file name.
  logging.file=
# Configure Logging level. 
# Example `logging.level.org.springframework=TRACE`
  logging.level.*=</pre></div></div><div class="section" title="Embedded Server Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec43"/>Embedded Server Configuration</h3></div></div></div><p>An embedded server is one of the most important features of Spring Boot. Some of the embedded server features that can be configured through application properties include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Server ports</li><li class="listitem" style="list-style-type: disc">SSL support and configuration</li><li class="listitem" style="list-style-type: disc">Access log configuration</li></ul></div><p>The following snippet shows some of the embedded server features that can be configured through application properties:</p><div class="informalexample"><pre class="programlisting"># Path of the error controller.
server.error.path=/error 
# Server HTTP port
server.port=8080
# Enable SSL support.
server.ssl.enabled=
# Path to key store with SSL certificate
server.ssl.key-store=
# Key Store Password
server.ssl.key-store-password=
# Key Store Provider
server.ssl.key-store-provider=
# Key Store Type
server.ssl.key-store-type=
# Should we enable access log of Tomcat?
server.tomcat.accesslog.enabled=false
# Maximum number of connections that server can accept
server.tomcat.max-connections=</pre></div></div><div class="section" title="Spring MVC"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec44"/>Spring MVC</h3></div></div></div><p>Spring MVC can be extensively configured through <code class="literal">application.properties</code>. Listed here are some of the important configurations:</p><div class="informalexample"><pre class="programlisting"># Date format to use. For instance `dd/MM/yyyy`.
 spring.mvc.date-format=
# Locale to use.
 spring.mvc.locale=
# Define how the locale should be resolved.
 spring.mvc.locale-resolver=accept-header
# Should "NoHandlerFoundException" be thrown if no Handler is found?
 spring.mvc.throw-exception-if-no-handler-found=false
# Spring MVC view prefix. Used by view resolver.
 spring.mvc.view.prefix=
# Spring MVC view suffix. Used by view resolver.
 spring.mvc.view.suffix=</pre></div></div><div class="section" title="Spring Starter Security"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec45"/>Spring Starter Security</h3></div></div></div><p>Spring Security can be extensively configured through <code class="literal">application.properties</code>. The following examples show some of the important configuration options related to Spring Security:</p><div class="informalexample"><pre class="programlisting"># Set true to Enable basic authentication
 security.basic.enabled=true
# Provide a Comma-separated list of uris you would want to secure
 security.basic.path=/**
# Provide a Comma-separated list of paths you don't want to secure
 security.ignored=
# Name of the default user configured by spring security
 security.user.name=user
# Password of the default user configured by spring security. 
 security.user.password=
# Roles granted to default user
 security.user.role=USER</pre></div></div><div class="section" title="Data Sources, JDBC, and JPA"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec46"/>Data Sources, JDBC, and JPA</h3></div></div></div><p>Data Sources, JDBC, and JPA can also be extensively configured through <code class="literal">application.properties</code>. Listed here are some of the important options:</p><div class="informalexample"><pre class="programlisting"># Fully qualified name of the JDBC driver. 
 spring.datasource.driver-class-name=
# Populate the database using 'data.sql'.
 spring.datasource.initialize=true
# JNDI location of the datasource.
 spring.datasource.jndi-name=
# Name of the datasource.
 spring.datasource.name=testdb
# Login password of the database.
 spring.datasource.password=
# Schema (DDL) script resource references.
 spring.datasource.schema=
# Db User to use to execute DDL scripts
 spring.datasource.schema-username=
# Db password to execute DDL scripts
 spring.datasource.schema-password=
# JDBC url of the database.
 spring.datasource.url=
# JPA - Initialize the schema on startup.
 spring.jpa.generate-ddl=false
# Use Hibernate's newer IdentifierGenerator for AUTO, TABLE and SEQUENCE.
 spring.jpa.hibernate.use-new-id-generator-mappings=
# Enable logging of SQL statements.
 spring.jpa.show-sql=false</pre></div></div><div class="section" title="Other Configuration Options"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec47"/>Other Configuration Options</h3></div></div></div><p>Some other things that can be configured through <code class="literal">application.properties</code> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Profiles</li><li class="listitem" style="list-style-type: disc">HTTP message converters (Jackson/JSON)</li><li class="listitem" style="list-style-type: disc">Transaction management</li><li class="listitem" style="list-style-type: disc">Internationalization</li></ul></div><p>The following examples show some of the configuration options:</p><div class="informalexample"><pre class="programlisting"># Comma-separated list (or list if using YAML) of active profiles.
 spring.profiles.active=
# HTTP message conversion. jackson or gson
 spring.http.converters.preferred-json-mapper=jackson
# JACKSON Date format string. Example `yyyy-MM-dd HH:mm:ss`.
 spring.jackson.date-format=
# Default transaction timeout in seconds.
 spring.transaction.default-timeout=
# Perform the rollback on commit failures.
 spring.transaction.rollback-on-commit-failure=
# Internationalization : Comma-separated list of basenames
 spring.messages.basename=messages
# Cache expiration for resource bundles, in sec. -1 will cache for ever
 spring.messages.cache-seconds=-1</pre></div></div></div><div class="section" title="Custom Properties in Application.Properties"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec36"/>Custom Properties in Application.Properties</h2></div></div></div><p>Until now, we have looked at using prebuilt properties provided by Spring Boot for various frameworks. In this section, we will look at creating our application-specific configuration that can also be configured in <code class="literal">application.properties</code>.</p><p>Let's consider an example. We want to be able to interact with an external service. We want to be able to externalize the configuration of the URL of this service.</p><p>The following example shows how we would want to configure the external service in <code class="literal">application.properties</code>:</p><div class="informalexample"><pre class="programlisting">   somedataservice.url=http://abc.service.com/something</pre></div><p>We want to use the value of the <code class="literal">somedataservice.url</code> property in our data service. The following snippet shows how we can do that in an example data service.</p><div class="informalexample"><pre class="programlisting">    @Component
    public class SomeDataService {
      @Value("${somedataservice.url}")
      private String url;
      public String retrieveSomeData() {
        // Logic using the url and getting the data
       return "data from service";
      }
    }</pre></div><p>A couple of important things to note are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@Component public class SomeDataService</code>: The data service bean is managed by Spring because of the <code class="literal">@Component</code> annotation.</li><li class="listitem" style="list-style-type: disc"><code class="literal">@Value("${somedataservice.url}")</code>: The value of <code class="literal">somedataservice.url</code> will be autowired into the <code class="literal">url</code>variable. The <code class="literal">url</code> value can be used in the methods of the bean.</li></ul></div><div class="section" title="Configuration properties - Type-Safe Configuration Management"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec48"/>Configuration properties - Type-Safe Configuration Management</h3></div></div></div><p>While the <code class="literal">@Value</code> annotation provides dynamic configuration, it also has several drawbacks:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">If we want to use three property values in a service, we would need to autowire them using <code class="literal">@Value</code> three times.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">@Value</code> annotations and the keys of the messages would be spread across the application. If we want to find the list of the configurable values in an application, we have to search through the application for <code class="literal">@Value</code>annotations.</li></ul></div><p>Spring Boot provides a better approach to application configuration through the strongly typed <code class="literal">ConfigurationProperties</code> feature. This allows us to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Have all the properties in a predefined bean structure</li><li class="listitem" style="list-style-type: disc">This bean would act as the centralized store for all application properties</li><li class="listitem" style="list-style-type: disc">The configuration bean can be autowired wherever application configuration is needed</li></ul></div><p>An example configuration bean is shown as follows:</p><div class="informalexample"><pre class="programlisting">    @Component
    @ConfigurationProperties("application")
    public class ApplicationConfiguration {
      private boolean enableSwitchForService1;
      private String service1Url;
      private int service1Timeout;
      public boolean isEnableSwitchForService1() {
        return enableSwitchForService1;
      }
     public void setEnableSwitchForService1
     (boolean enableSwitchForService1) {
        this.enableSwitchForService1 = enableSwitchForService1;
      }
     public String getService1Url() {
       return service1Url;
     }
     public void setService1Url(String service1Url) {
       this.service1Url = service1Url;
     }
     public int getService1Timeout() {
       return service1Timeout;
     }
     public void setService1Timeout(int service1Timeout) {
       this.service1Timeout = service1Timeout;
    }
  }</pre></div><p>A couple of important things to note are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@ConfigurationProperties("application")</code> is the annotation for an externalized configuration. We can add this annotation to any class to bind to external properties. The value in the double quotes--application--is used as a prefix while binding external configuration to this bean.</li><li class="listitem" style="list-style-type: disc">We are defining multiple configurable values in the bean.</li><li class="listitem" style="list-style-type: disc">Getters and setters are needed since binding happens through Java beans property descriptors.</li></ul></div><p>The following snippet shows how the values for these properties can be defined in <code class="literal">application.properties</code>:</p><div class="informalexample"><pre class="programlisting">    application.enableSwitchForService1=true
    application.service1Url=http://abc-dev.service.com/somethingelse
    application.service1Timeout=250</pre></div><p>A couple of important things to note are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">application</code>: The prefix is defined as part of <code class="literal">@ConfigurationProperties("application")</code> while defining the configuration bean</li><li class="listitem" style="list-style-type: disc">Values are defined by appending the prefix to the name of the property</li></ul></div><p>We can use configuration properties in other beans by autowiring <code class="literal">ApplicationConfiguration</code> into the bean:</p><div class="informalexample"><pre class="programlisting">    @Component
    public class SomeOtherDataService {
      @Autowired
      private ApplicationConfiguration configuration;
      public String retrieveSomeData() {
        // Logic using the url and getting the data
        System.out.println(configuration.getService1Timeout());
        System.out.println(configuration.getService1Url());
        System.out.println(configuration.isEnableSwitchForService1());
        return "data from service";
      }
    }</pre></div><p>A couple of important things to note are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">@Autowired private ApplicationConfiguration configuration</code>: <code class="literal">ApplicationConfiguration</code> is autowired into <code class="literal">SomeOtherDataService</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">configuration.getService1Timeout(), configuration.getService1Url(), configuration.isEnableSwitchForService1()</code>: Values can be accessed in bean methods using the getter methods on the configuration bean</li></ul></div><p>By default, any failure in binding externally configured values to configuration properties bean would result in the failure of the server start up. This prevents problems that arise because of misconfigured applications running in production.</p><p>Let's use the misconfigure service timeout to see what happens:</p><div class="informalexample"><pre class="programlisting">    application.service1Timeout=SOME_MISCONFIGURATION</pre></div><p>The application will fail to start up with an error.</p><div class="informalexample"><pre class="programlisting">***************************
 APPLICATION FAILED TO START
 ***************************
Description:
Binding to target com.mastering.spring.springboot.configuration.ApplicationConfiguration@79d3473e failed:

Property: application.service1Timeout
Value: SOME_MISCONFIGURATION
Reason: Failed to convert property value of type 'java.lang.String' to required type 'int' for property 'service1Timeout'; nested exception is org.springframework.core.convert.ConverterNotFoundException: No converter found capable of converting from type [java.lang.String] to type [int]

Action:
Update your application's configuration</pre></div></div></div><div class="section" title="Profiles"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec37"/>Profiles</h2></div></div></div><p>Until now, we looked at how to externalize application configuration to a property file, <code class="literal">application.properties</code>. What we want to be able to do is have different values for the same property in different environments.</p><p>Profiles provide a way to provide different configurations in different environments.</p><p>The following snippet shows how to configure an active profile in <code class="literal">application.properties</code>:</p><div class="informalexample"><pre class="programlisting">    spring.profiles.active=dev</pre></div><p>Once you have an active profile configured, you can define properties specific to that profile in <code class="literal">application-{profile-name}.properties</code>. For <code class="literal">dev</code> profile, the name of the properties file would be <code class="literal">application-dev.properties</code>. The following example shows the configuration in <code class="literal">application-dev.properties</code>:</p><div class="informalexample"><pre class="programlisting">    application.enableSwitchForService1=true
    application.service1Url=http://abc-dev.service.com/somethingelse
    application.service1Timeout=250</pre></div><p>The values in <code class="literal">application-dev.properties</code> will override the default configuration in <code class="literal">application.properties</code>if the active profile is <code class="literal">dev</code>.</p><p>We can have configurations for multiple environments, as shown here:</p><div class="mediaobject"><img alt="Profiles" src="graphics/03_03.jpg"/></div><div class="section" title="Profiles-Based Bean Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl3sec49"/>Profiles-Based Bean Configuration</h3></div></div></div><p>Profiles can also be used to define different beans or different bean configurations in different environments. All classes marked with <code class="literal">@Component</code> or <code class="literal">@Configuration</code> can also be marked with an additional <code class="literal">@Profile</code> annotation to specify the profile in which the bean or configuration is enabled.</p><p>Let's consider an example. An application needs different caches enabled in different environments. In the <code class="literal">dev</code> environment, it uses a very simple cache. In production, we would want to use a distributed cache. This can be implemented using profiles.</p><p>The following bean shows the configuration enabled in a <code class="literal">dev</code> environment:</p><div class="informalexample"><pre class="programlisting">    @Profile("dev")
    @Configuration
    public class DevSpecificConfiguration {
      @Bean
      public String cache() {
        return "Dev Cache Configuration";
      }
    }</pre></div><p>The following bean shows the configuration enabled in a production environment:</p><div class="informalexample"><pre class="programlisting">    @Profile("prod")
    @Configuration
    public class ProdSpecificConfiguration {
      @Bean
      public String cache() {
        return "Production Cache Configuration - Distributed Cache";
      }
   }</pre></div><p>Based on the active profile configured, the respective configuration is picked up. Note that we are not really configuring a distributed cache in this example. We are returning a simple string to illustrate that profiles can be used to implement these kinds of variations.</p></div></div><div class="section" title="Other Options for Application Configuration Values"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec38"/>Other Options for Application Configuration Values</h2></div></div></div><p>Until now, the approaches we took to configure application properties was using the key value pairs from either <code class="literal">application.properties</code> or <code class="literal">application-{profile-name}.properties</code>.</p><p>Spring Boot provides a number of other ways to configure application properties.</p><p>Listed here are some of the important ways of providing application configuration:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Command-line arguments</li><li class="listitem" style="list-style-type: disc">Creating a system property with the name <code class="literal">SPRING_APPLICATION_JSON</code> and including the JSON configuration</li><li class="listitem" style="list-style-type: disc"><code class="literal">ServletConfig init</code> parameters</li><li class="listitem" style="list-style-type: disc"><code class="literal">ServletContext init</code> parameters</li><li class="listitem" style="list-style-type: disc">Java System properties (<code class="literal">System.getProperties()</code>)</li><li class="listitem" style="list-style-type: disc">Operating system environment variables</li><li class="listitem" style="list-style-type: disc">Profile-specific application properties outside of <code class="literal">.jar</code>, somewhere in the classpath of the application (<code class="literal">application-{profile}.properties</code>)</li><li class="listitem" style="list-style-type: disc">Profile-specific application properties packaged inside your <code class="literal">.jar</code> (<code class="literal">application-{profile}.properties</code> and YAML variants)</li><li class="listitem" style="list-style-type: disc">Application properties outside the <code class="literal">.jar</code></li><li class="listitem" style="list-style-type: disc">Application properties packaged inside the <code class="literal">.jar</code></li></ul></div><p>More information can be found in the Spring Boot documentation at: <a class="ulink" href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-external-config">http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#boot-features-external-config</a>.</p><p>The approaches at the top of this list have higher priority than those at the bottom of the list. For example, if a command-line argument with the name <code class="literal">spring.profiles.active</code> is provided when launching the application, it would override any configuration provided through <code class="literal">application.properties</code> because command-line arguments have higher preference.</p><p>This provides great flexibility in determining how you would want to configure your application in different environments.</p></div><div class="section" title="YAML Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec39"/>YAML Configuration</h2></div></div></div><p>Spring Boot also supports YAML to configure your properties.</p><p>
<span class="strong"><strong>YAML</strong></span> is an abbreviation for <span class="strong"><strong>YAML Ain't Markup Language</strong></span>. It is a human readable structured format. YAML is commonly used for configuration files.</p><p>To understand basic syntax of YAML, look at the example below (<code class="literal">application.yaml</code>). This shows how our application configuration can be specified in YAML.</p><div class="informalexample"><pre class="programlisting">spring:
   profiles:
      active: prod
security:
   basic:
      enabled: false
   user:
      name=user-name
      password=user-password
oauth2:
   client:
      clientId: clientId
      clientSecret: clientSecret
      authorized-grant-types: authorization_code,refresh_token,password
      scope: openid
application:
   enableSwitchForService1: true
   service1Url: http://abc-dev.service.com/somethingelse
   service1Timeout: 250</pre></div><p>As you can see, the YAML configuration is much more readable than <code class="literal">application.properties</code>, as it allows better grouping of properties.</p><p>Another advantage of YAML is that it allows you to specify the configuration for multiple profiles in a single configuration file. The following snippet shows an example:</p><div class="informalexample"><pre class="programlisting">application:
  service1Url: http://service.default.com
---	
spring:
  profiles: dev
  application:
    service1Url: http://service.dev.com
---
spring:
   profiles: prod
   application:
    service1Url: http://service.prod.com</pre></div><p>In this example, <code class="literal">http://service.dev.com</code> will be used in the <code class="literal">dev</code> profile, and <code class="literal">http://service.prod.com</code> is used in the <code class="literal">prod</code> profile. In all other profiles, <code class="literal">http://service.default.com</code> will be used as the service URL.</p></div></div></div>
<div class="section" title="Embedded Servers"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Embedded Servers</h1></div></div></div><p>One of the important concepts Spring Boot brings in is embedded servers.</p><p>Let's first understand the difference between traditional Java web application deployment and this new concept called embedded server.</p><p>Traditionally, with Java web applications, we build <span class="strong"><strong>Web Application Archive</strong></span> (<span class="strong"><strong>WAR</strong></span>) or <span class="strong"><strong>Enterprise Application Archive</strong></span> (<span class="strong"><strong>EAR</strong></span>) and deploy them into servers. Before we can deploy a WAR on the server, we need a web server or an application server installed on the server. The application server would be on top of the Java instance installed on the server. So, we need Java and an application (or web server) installed on the machine before we can deploy our application. The following figure shows an example installation in Linux:</p><div class="mediaobject"><img alt="Embedded Servers" src="graphics/03_04.jpg"/></div><p>Spring Boot brings in the concept of embedded servers, where the web server is part of the application deployable--JAR. To deploy applications using embedded servers, it is sufficient if Java is installed on the server. The following figure shows an example installation:</p><div class="mediaobject"><img alt="Embedded Servers" src="graphics/03_05.jpg"/></div><p>When we build any application with Spring Boot, the default is to build a JAR. With <code class="literal">spring-boot-starter-web</code>, the default embedded server is Tomcat.</p><p>When we use <code class="literal">spring-boot-starter-web</code>, a few Tomcat-related dependencies can be seen in the Maven dependencies section. These dependencies will be included as part of the application deployment package:</p><div class="mediaobject"><img alt="Embedded Servers" src="graphics/03_06.jpg"/></div><p>To deploy the application, we need to build a JAR. We can build a JAR using the command below:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mvn clean install</strong></span>
</pre></div><p>The following screenshot shows the structure of the JAR created.</p><p>
<code class="literal">BOOT-INF\classes</code> contains all application-related class files (from <code class="literal">src\main\java</code>) as well as the application properties from <code class="literal">src\main\resources</code>:</p><div class="mediaobject"><img alt="Embedded Servers" src="graphics/03_07.jpg"/></div><p>Some of the libraries in <code class="literal">BOOT-INF\lib</code> are shown in the following screenshot:</p><div class="mediaobject"><img alt="Embedded Servers" src="graphics/03_08.jpg"/></div><p>
<code class="literal">BOOT-INF\lib</code> contains all the JAR dependencies of the application. There are three Tomcat-specific JARs among these. These three JARs enable the launch of an embedded Tomcat service when the application is run as a Java application. Because of this, a Java installation is sufficient to deploy this application on a server.</p><div class="section" title="Switching to Jetty and Undertow"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec40"/>Switching to Jetty and Undertow</h2></div></div></div><p>The following screenshot shows the changes needed in order to switch to using Jetty embedded server:</p><div class="mediaobject"><img alt="Switching to Jetty and Undertow" src="graphics/3.9.jpg"/></div><p>All that we need to do is exclude the Tomcat starter dependency in <code class="literal">spring-boot-starter-web</code> and include a dependency in <code class="literal">spring-boot-starter-jetty</code>.</p><p>You can now see a number of Jetty dependencies in the Maven dependencies section. The following screenshot shows a few of the Jetty-related dependencies:</p><div class="mediaobject"><img alt="Switching to Jetty and Undertow" src="graphics/03_09.jpg"/></div><p>Switching to Undertow is equally easy. Use <code class="literal">spring-boot-starter-undertow</code> instead of <code class="literal">spring-boot-starter-jetty</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt;
   &lt;/dependency&gt;</pre></div></div><div class="section" title="Building a WAR file"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec41"/>Building a WAR file</h2></div></div></div><p>Spring Boot also provides the option of building a traditional WAR file instead of using a JAR.</p><p>First, we need to change our packaging in <code class="literal">pom.xml</code> to <code class="literal">WAR</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;packaging&gt;war&lt;/packaging&gt;</pre></div><p>We would want to prevent tomcat server to be embedded as a dependency in the WAR file. We can do this by modifying the dependency on the embedded server (Tomcat in the following example) to have a scope of provided. The following snippet shows the exact details:</p><div class="informalexample"><pre class="programlisting">    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;
      &lt;scope&gt;provided&lt;/scope&gt;
   &lt;/dependency&gt;</pre></div><p>When you build the WAR file, Tomcat dependencies are not included. We can use this WAR to deploy on an application server, such as WebSphere or Weblogic, or a web server, such as Tomcat.</p></div></div>
<div class="section" title="Developer Tools"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec25"/>Developer Tools</h1></div></div></div><p>Spring Boot provides tools that can improve the experience of developing Spring Boot applications. One of these is Spring Boot developer tools.</p><p>To use Spring Boot developer tools, we need to include a dependency:</p><div class="informalexample"><pre class="programlisting">    &lt;dependencies&gt;
     &lt;dependency&gt;
       &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
       &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
       &lt;optional&gt;true&lt;/optional&gt;
     &lt;/dependency&gt;
   &lt;/dependencies&gt;</pre></div><p>Spring Boot developer tools, by default, disables the caching of view templates and static files. This enables a developer to see the changes as soon as they make them.</p><p>Another important feature is the automatic restart when any file in the classpath changes. So, the application automatically restarts in the following scenarios:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">When we make a change to a controller or a service class</li><li class="listitem" style="list-style-type: disc">When we make a change to the property file</li></ul></div><p>The advantages of Spring Boot developer tools are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The developer does not need to stop and start the application each time. The application is automatically restarted as soon as there is a change.</li><li class="listitem" style="list-style-type: disc">The restart feature in Spring Boot developer tools is intelligent. It only reloads the actively developed classes. It does not reload the third-party JARs (using two different class-loaders). Thereby, the restart when something in the application changes is much faster compared to cold-starting an application.</li></ul></div><div class="section" title="Live Reload"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec42"/>Live Reload</h2></div></div></div><p>Another useful Spring Boot developer tools feature is <span class="strong"><strong>live reload</strong></span>. You can download a specific plugin for your browser from <a class="ulink" href="http://livereload.com/extensions/">http://livereload.com/extensions/</a>.</p><p>You can enable live reload by clicking on the button in the browser. The button in the Safari browser is shown in the following screenshot. It's in the top-left corner beside the address bar.</p><div class="mediaobject"><img alt="Live Reload" src="graphics/03_10.jpg"/></div><p>If there are code changes made on the pages or services that are shown in the browser, they are auto-refreshed with new content. There is no need to hit that refresh button anymore!</p></div></div>
<div class="section" title="Spring Boot Actuator"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec26"/>Spring Boot Actuator</h1></div></div></div><p>When an application is deployed into production:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We want to know immediately if some service goes down or is very slow</li><li class="listitem" style="list-style-type: disc">We want to know immediately if any of the servers does not have sufficient free space or memory</li></ul></div><p>This is called <span class="strong"><strong>application monitoring</strong></span>.</p><p>
<span class="strong"><strong>Spring Boot Actuator</strong></span> provides a number of production-ready monitoring features.</p><p>We will add Spring Boot Actuator by adding a simple dependency:</p><div class="informalexample"><pre class="programlisting">    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
     &lt;/dependency&gt;
   &lt;/dependencies&gt;</pre></div><p>As soon as the actuator is added to an application, it enables a number of endpoints. When we start the application, we see a number of added new mappings. The following screenshot shows an extract of these new mappings from the start up log:</p><p> </p><div class="mediaobject"><img alt="Spring Boot Actuator" src="graphics/03_18.jpg"/></div><p>
</p><p>The actuator exposes a number of endpoints. The actuator endpoint (<code class="literal">http://localhost:8080/application</code>) acts as a discovery for all other endpoints. The following screenshot shows the response when we execute the request from a Postman:</p><div class="mediaobject"><img alt="Spring Boot Actuator" src="graphics/03_11.jpg"/></div><div class="section" title="HAL Browser"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec43"/>HAL Browser</h2></div></div></div><p>A number of these endpoints expose a lot of data. To be able to visualize the information better, we will add an <span class="strong"><strong>HAL Browser</strong></span> to our application:</p><div class="informalexample"><pre class="programlisting">    &lt;dependency&gt;
      &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
      &lt;artifactId&gt;spring-data-rest-hal-browser&lt;/artifactId&gt;
    &lt;/dependency&gt;</pre></div><p>Spring Boot Actuator exposes REST APIs around all the data captured from the Spring Boot application and environment. The HAL Browser enables visual representation around the Spring Boot Actuator API:</p><div class="mediaobject"><img alt="HAL Browser" src="graphics/03_12.jpg"/></div><p>When we launch <code class="literal">http://localhost:8080/application</code> in the browser, we can see all the URLs exposed by actuator.</p><div class="mediaobject"><img alt="HAL Browser" src="graphics/03_13.jpg"/></div><p>Let's browse all the information exposed by actuator as part of different endpoints through the HAL Browser.</p></div><div class="section" title="Configuration Properties"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec44"/>Configuration Properties</h2></div></div></div><p>The <code class="literal">configprops</code> endpoint provides information about configuration options that can be configured through application properties. It basically is a collated list of all <code class="literal">@ConfigurationProperties</code>. The following screenshot shows <code class="literal">configprops</code> in HAL Browser:</p><div class="mediaobject"><img alt="Configuration Properties" src="graphics/03_14.jpg"/></div><p>To illustrate a known example, the following section from the service response shows the configuration options available for Spring MVC:</p><div class="informalexample"><pre class="programlisting">"spring.mvc-  org.springframework.boot.autoconfigure.web.WebMvcProperties": {
   "prefix": "spring.mvc",
   "properties": {
                   "dateFormat": null,
                   "servlet": {
                     "loadOnStartup": -1
                  },
   "staticPathPattern": "/**",
   "dispatchOptionsRequest": true,
   "dispatchTraceRequest": false,
   "locale": null,
   "ignoreDefaultModelOnRedirect": true,
   "logResolvedException": true,
   "async": {
              "requestTimeout": null
            },
   "messageCodesResolverFormat": null,
   "mediaTypes": {},
   "view": {
             "prefix": null,
             "suffix": null
           },
   "localeResolver": "ACCEPT_HEADER",
   "throwExceptionIfNoHandlerFound": false
    }
 }</pre></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>To provide configuration for Spring MVC, we combine the prefix with the path in properties. For example, to configure <code class="literal">loadOnStartup</code>, we use a property with the name <code class="literal">spring.mvc.servlet.loadOnStartup</code>.</p></div></div></div><div class="section" title="Environment Details"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec45"/>Environment Details</h2></div></div></div><p>The <span class="strong"><strong>environment </strong></span>(<span class="strong"><strong>env</strong></span>) endpoint provides information about the operating system, JVM installation, classpath, system environment variable, and the values configured in various application properties files. The following screenshot shows the environment endpoint in the HAL Browser:</p><div class="mediaobject"><img alt="Environment Details" src="graphics/03_15.jpg"/></div><p>An extract from the response from the <code class="literal">/application/env</code> service is shown here. It shows a few system details as well as the details from application configuration:</p><div class="informalexample"><pre class="programlisting">"systemEnvironment": {
    "JAVA_MAIN_CLASS_13377": "com.mastering.spring.springboot.Application",
    "PATH": "/usr/bin:/bin:/usr/sbin:/sbin",
    "SHELL": "/bin/bash",
    "JAVA_STARTED_ON_FIRST_THREAD_13019": "1",
    "APP_ICON_13041": "../Resources/Eclipse.icns",
    "USER": "rangaraokaranam",
    "TMPDIR": "/var/folders/y_/x4jdvdkx7w94q5qsh745gzz00000gn/T/",
    "SSH_AUTH_SOCK": "/private/tmp/com.apple.launchd.IcESePQCLV/Listeners",
    "XPC_FLAGS": "0x0",
    "JAVA_STARTED_ON_FIRST_THREAD_13041": "1",
    "APP_ICON_11624": "../Resources/Eclipse.icns",
    "LOGNAME": "rangaraokaranam",
    "XPC_SERVICE_NAME": "0",
    "HOME": "/Users/rangaraokaranam"
  },
  "applicationConfig: [classpath:/application-prod.properties]": {
    "application.service1Timeout": "250",
    "application.service1Url": "http://abc-    prod.service.com/somethingelse",
    "application.enableSwitchForService1": "false"
  },</pre></div></div><div class="section" title="Health"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec46"/>Health</h2></div></div></div><p>The health service provides details of the disk space and status of the application. The following screenshot shows the service executed from the HAL Browser:</p><div class="mediaobject"><img alt="Health" src="graphics/03_16.jpg"/></div></div><div class="section" title="Mappings"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec47"/>Mappings</h2></div></div></div><p>The mappings endpoint provides information about different service endpoints that are exposed from the application:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">URI</li><li class="listitem" style="list-style-type: disc">Request methods</li><li class="listitem" style="list-style-type: disc">Bean</li><li class="listitem" style="list-style-type: disc">Controller methods exposing the service</li></ul></div><p>Mappings provides a collated list of all <code class="literal">@RequestMapping</code> paths. An extract from the response of the <code class="literal">/application/mappings</code> endpoint is shown here:</p><div class="informalexample"><pre class="programlisting">"{[/welcome-internationalized],methods=[GET]}": {
   "bean": "requestMappingHandlerMapping",
   "method": "public java.lang.String 
    com.mastering.spring.springboot.controller.
    BasicController.msg(java.uti l.Locale)"
 },
 "{[/welcome],methods=[GET]}": {
    "bean": "requestMappingHandlerMapping",
    "method": "public java.lang.String 
     com.mastering.spring.springboot.controller.
     BasicController.welcome()"
 },
 "{[/welcome-with-object],methods=[GET]}": {
     "bean": "requestMappingHandlerMapping",
     "method": "public com.mastering.spring.springboot.
      bean.WelcomeBeancom.mastering.spring.springboot.
      controller.BasicController.welcomeWithObject()"
 },
 "{[/welcome-with-parameter/name/{name}],methods=[GET]}": {
      "bean": "requestMappingHandlerMapping",
      "method": "public 
       com.mastering.spring.springboot.bean.WelcomeBean   
       com.mastering.spring.springboot.controller.
       BasicController.welcomeWithParameter(java.lang.String)"
 },
 "{[/users/{name}/todos],methods=[POST]}": {
       "bean": "requestMappingHandlerMapping",
       "method": "org.springframework.http.ResponseEntity&lt;?&gt;    
        com.mastering.spring.springboot.controller.
        TodoController.add(java.lang.String,com.mastering.spring.
        springboot.bean.Todo)"
  },
 "{[/users/{name}/todos],methods=[GET]}": {
        "bean": "requestMappingHandlerMapping",
        "method": "public java.util.List&lt;com.mastering.spring.
         springboot.bean.Todo&gt; 
         com.mastering.spring.springboot.controller.
         TodoController.retrieveTodos(java.lang.String)"
 },
 "{[/users/{name}/todos/{id}],methods=[GET]}": {
        "bean": "requestMappingHandlerMapping",
        "method": "public 
         org.springframework.hateoas.Resource&lt;com.mastering.
         spring.springboot.bean.Todo&gt;  
         com.mastering.spring.springboot.controller.
         TodoController.retrieveTodo(java.lang.String,int)"
 },</pre></div></div><div class="section" title="Beans"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec48"/>Beans</h2></div></div></div><p>The beans endpoint provides the details about the beans that are loaded into the Spring context. This is useful in debugging any problems related to Spring context.</p><div class="informalexample"><pre class="programlisting">An extract from the response of the <code class="literal">/application/beans</code> endpoint is shown below:   {
     "bean": "basicController",
     "aliases": [],
     "scope": "singleton",
     "type": "com.mastering.spring.springboot.
      controller.BasicController",
     "resource": "file [/in28Minutes/Workspaces/
      SpringTutorial/mastering-spring-lesson-5-6-  
      7/target/classes/com/mastering/spring/springboot/
      controller/BasicController.class]",
      "dependencies": [
                     "messageSource"
                    ]
   },
   {
      "bean": "todoController",
      "aliases": [],
      "scope": "singleton",
      "type": "com.mastering.spring.springboot.
       controller.TodoController",
       "resource": "file [/in28Minutes/Workspaces/SpringTutorial/
       mastering-spring-lesson-5-6-
       7/target/classes/com/mastering/spring/
       springboot/controller/TodoController.class]",
       "dependencies": [
                      "todoService"
                     ]
    }</pre></div><p>It shows the details for two beans: <code class="literal">basicController</code> and <code class="literal">todoController</code>. You can see the following details for all the beans:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The name of the bean and its aliases</li><li class="listitem" style="list-style-type: disc">The scope of the bean</li><li class="listitem" style="list-style-type: disc">The type of the bean</li><li class="listitem" style="list-style-type: disc">The exact location of the class from which this bean is created</li><li class="listitem" style="list-style-type: disc">Dependencies of the bean</li></ul></div></div><div class="section" title="Metrics"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec49"/>Metrics</h2></div></div></div><p>The metrics endpoint shows some of the important metrics about the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Server--free memory, processors, uptime, and so on</li><li class="listitem" style="list-style-type: disc">JVM--details about the heap, threads, garbage collection, sessions, and so on</li><li class="listitem" style="list-style-type: disc">Responses provided by application services</li></ul></div><p>An extract from the response of the <code class="literal">/application/metrics</code> endpoint is shown as follows:</p><div class="informalexample"><pre class="programlisting">{
 "mem": 481449,
 "mem.free": 178878,
 "processors": 4,
 "instance.uptime": 1853761,
 "uptime": 1863728,
 "systemload.average": 2.3349609375,
 "heap.committed": 413696,
 "heap.init": 65536,
 "heap.used": 234817,
 "heap": 932352,
 "nonheap.committed": 69248,
 "nonheap.init": 2496,
 "nonheap.used": 67754,
 "nonheap": 0,
 "threads.peak": 23,
 "threads.daemon": 21,
 "threads.totalStarted": 30,
 "threads": 23,
 "classes": 8077,
 "classes.loaded": 8078,
 "classes.unloaded": 1,
 "gc.ps_scavenge.count": 15,
 "gc.ps_scavenge.time": 242,
 "gc.ps_marksweep.count": 3,
 "gc.ps_marksweep.time": 543,
 "httpsessions.max": -1,
 "httpsessions.active": 0,
 "gauge.response.actuator": 8,
 "gauge.response.mappings": 12,
 "gauge.response.beans": 83,
 "gauge.response.health": 14,
 "gauge.response.root": 9,
 "gauge.response.heapdump": 4694,
 "gauge.response.env": 6,
 "gauge.response.profile": 12,
 "gauge.response.browser.star-star": 10,
 "gauge.response.actuator.root": 2,
 "gauge.response.configprops": 272,
 "gauge.response.actuator.star-star": 13,
 "counter.status.200.profile": 1,
 "counter.status.200.actuator": 8,
 "counter.status.200.mappings": 1,
 "counter.status.200.root": 5,
 "counter.status.200.configprops": 1,
 "counter.status.404.actuator.star-star": 3,
 "counter.status.200.heapdump": 1,
 "counter.status.200.health": 1,
 "counter.status.304.browser.star-star": 132,
 "counter.status.302.actuator.root": 4,
 "counter.status.200.browser.star-star": 37,
 "counter.status.200.env": 2,
 "counter.status.302.root": 5,
 "counter.status.200.beans": 1,
 "counter.status.200.actuator.star-star": 210,
 "counter.status.302.actuator": 1
 }</pre></div></div><div class="section" title="Auto-Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec50"/>Auto-Configuration</h2></div></div></div><p>Auto-configuration is one of the most important features of Spring Boot. The auto-configuration endpoint (<code class="literal">/application/autoconfig</code>) exposes the details related to auto-configuration. It shows both positive matches and negative matches with details about why a particular auto-configuration succeeded or failed.</p><p>The following extract shows some of the positive matches from the response:</p><div class="informalexample"><pre class="programlisting">"positiveMatches": {
  "AuditAutoConfiguration#auditListener": [
   {
     "condition": "OnBeanCondition",
     "message": "@ConditionalOnMissingBean (types:     
      org.springframework.boot.actuate.audit.
      listener.AbstractAuditListener; SearchStrategy: all) did not find 
      any beans"
   }
 ],
 "AuditAutoConfiguration#authenticationAuditListener": [
 {
   "condition": "OnClassCondition",
   "message": "@ConditionalOnClass found required class
   'org.springframework.security.authentication.
   event.AbstractAuthenticationEvent'"
 },</pre></div><p>The following extract shows some of the negative matches from the response:</p><div class="informalexample"><pre class="programlisting">"negativeMatches": {
  "CacheStatisticsAutoConfiguration.
   CaffeineCacheStatisticsProviderConfiguration": [
 {
   "condition": "OnClassCondition",
   "message": "@ConditionalOnClass did not find required class  
   'com.github.benmanes.caffeine.cache.Caffeine'"
 }
 ],
   "CacheStatisticsAutoConfiguration.
   EhCacheCacheStatisticsProviderConfiguration": [
 {
   "condition": "OnClassCondition",
   "message": "@ConditionalOnClass did not find required classes
   'net.sf.ehcache.Ehcache',   
   'net.sf.ehcache.statistics.StatisticsGateway'"
 }
 ],</pre></div><p>All these details are very useful in order to debug auto-configuration.</p></div><div class="section" title="Debugging"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec51"/>Debugging</h2></div></div></div><p>Three of the actuator endpoints are useful when debugging problems:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">/application/heapdump</code>: Provides a heap dump</li><li class="listitem" style="list-style-type: disc"><code class="literal">/application/trace</code>: Provides a trace of the last few requests serviced by the application</li><li class="listitem" style="list-style-type: disc"><code class="literal">/application/dump</code>: Provides a thread dump</li></ul></div></div></div>
<div class="section" title="Deploying an Application to Cloud"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec27"/>Deploying an Application to Cloud</h1></div></div></div><p>Spring Boot has great support for most popular Cloud <span class="strong"><strong>Platform as a Service</strong></span> (<span class="strong"><strong>PaaS</strong></span>) providers.</p><p>Some of the popular ones are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Cloud Foundry</li><li class="listitem" style="list-style-type: disc">Heroku</li><li class="listitem" style="list-style-type: disc">OpenShift</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Amazon Web Services</strong></span> (<span class="strong"><strong>AWS</strong></span>)</li></ul></div><p>In this section, we will focus on deploying our application to Cloud Foundry.</p><div class="section" title="Cloud Foundry"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec52"/>Cloud Foundry</h2></div></div></div><p>The Cloud Foundry Java buildpack has excellent support for Spring Boot. We can deploy standalone applications based on JARs as well as the traditional Java EE WAR applications.</p><p>Cloud Foundry provides a Maven plugin to deploy applications:</p><div class="informalexample"><pre class="programlisting">&lt;build&gt;
   &lt;plugins&gt;
      &lt;plugin&gt;
         &lt;groupId&gt;org.cloudfoundry&lt;/groupId&gt;
         &lt;artifactId&gt;cf-maven-plugin&lt;/artifactId&gt;
         &lt;version&gt;1.1.2&lt;/version&gt;
      &lt;/plugin&gt;
   &lt;/plugins&gt;
&lt;/build&gt;</pre></div><p>Before we can deploy our application, we need to configure the application with a target and a space to deploy the application to.</p><p>The following are the steps involved:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We need to create a pivotal Cloud Foundry account at: <a class="ulink" href="https://account.run.pivotal.io/sign-up">https://account.run.pivotal.io/sign-up</a>.</li><li class="listitem" style="list-style-type: disc">Once we have an account, we can log in at <a class="ulink" href="https://run.pivotal.io">https://run.pivotal.io</a> to create an organization and space. Have the org and space details ready as we need them in order to deploy the application.</li></ul></div><p>We can update the plugin with the configuration of <code class="literal">org</code> and <code class="literal">space</code>:</p><div class="informalexample"><pre class="programlisting">&lt;build&gt;
   &lt;plugins&gt;
      &lt;plugin&gt;
         &lt;groupId&gt;org.cloudfoundry&lt;/groupId&gt;
         &lt;artifactId&gt;cf-maven-plugin&lt;/artifactId&gt;
         &lt;version&gt;1.1.2&lt;/version&gt;
         &lt;configuration&gt;
            &lt;target&gt;http://api.run.pivotal.io&lt;/target&gt;
            &lt;org&gt;in28minutes&lt;/org&gt;
            &lt;space&gt;development&lt;/space&gt;
            &lt;memory&gt;512&lt;/memory&gt;
            &lt;env&gt;
               &lt;ENV-VAR-NAME&gt;prod&lt;/ENV-VAR-NAME&gt;
            &lt;/env&gt;
         &lt;/configuration&gt;
      &lt;/plugin&gt;
   &lt;/plugins&gt;
&lt;/build&gt;</pre></div><p>We need to log in to Cloud Foundry using the Maven plugin on command prompt or terminal:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mvn cf:login -Dcf.username=&lt;&lt;YOUR-USER-ID&gt;&gt; -Dcf.password=&lt;&lt;YOUR-PASSWORD&gt;&gt;</strong></span>
</pre></div><p>If everything is successful, you will see a message, as shown here:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong> [INFO] ------------------------------------------------------------------</strong></span>
<span class="strong"><strong> [INFO] Building Your First Spring Boot Example 0.0.1-SNAPSHOT</strong></span>
<span class="strong"><strong> [INFO] -----------------------------------------------------------------</strong></span>
<span class="strong"><strong> [INFO]</strong></span>
<span class="strong"><strong> [INFO] --- cf-maven-plugin:1.1.2:login (default-cli) @ springboot-for-beginners-example ---</strong></span>
<span class="strong"><strong> [INFO] Authentication successful</strong></span>
<span class="strong"><strong> [INFO] -----------------------------------------------------------------</strong></span>
<span class="strong"><strong> [INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong> [INFO] -----------------------------------------------------------------</strong></span>
<span class="strong"><strong> [INFO] Total time: 14.897 s</strong></span>
<span class="strong"><strong> [INFO] Finished at: 2017-02-05T16:49:52+05:30</strong></span>
<span class="strong"><strong> [INFO] Final Memory: 22M/101M</strong></span>
<span class="strong"><strong> [INFO] -----------------------------------------------------------------</strong></span>
</pre></div><p>Once you are able to log in, you can push the application to Cloud Foundry:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>mvn cf:push</strong></span>
</pre></div><p>Once we execute the command, Maven will compile, run tests, build the application JAR or WAR, and then deploy it to the Cloud:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong> [INFO] Building jar: /in28Minutes/Workspaces/SpringTutorial/springboot-for-beginners-example-rest-service/target/springboot-for-beginners-example-0.0.1-SNAPSHOT.jar</strong></span>
<span class="strong"><strong> [INFO]</strong></span>
<span class="strong"><strong> [INFO] --- spring-boot-maven-plugin:1.4.0.RELEASE:repackage (default) @ springboot-for-beginners-example ---</strong></span>
<span class="strong"><strong> [INFO]</strong></span>
<span class="strong"><strong> [INFO] &lt;&lt;&lt; cf-maven-plugin:1.1.2:push (default-cli) &lt; package @ springboot-for-beginners-example &lt;&lt;&lt;</strong></span>
<span class="strong"><strong> [INFO]</strong></span>
<span class="strong"><strong> [INFO] --- cf-maven-plugin:1.1.2:push (default-cli) @ springboot-for-beginners-example ---</strong></span>
<span class="strong"><strong> [INFO] Creating application 'springboot-for-beginners-example'</strong></span>
<span class="strong"><strong> [INFO] Uploading '/in28Minutes/Workspaces/SpringTutorial/springboot-for-beginners-example-rest-service/target/springboot-for-beginners-example-0.0.1-SNAPSHOT.jar'</strong></span>
<span class="strong"><strong> [INFO] Starting application</strong></span>
<span class="strong"><strong> [INFO] Checking status of application 'springboot-for-beginners-example'</strong></span>
<span class="strong"><strong> [INFO] 1 of 1 instances running (1 running)</strong></span>
<span class="strong"><strong> [INFO] Application 'springboot-for-beginners-example' is available at 'http://springboot-for-beginners-example.cfapps.io'</strong></span>
<span class="strong"><strong> [INFO] ----------------------------------------------------------------- [INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong> [INFO] ----------------------------------------------------------------- [INFO] Total time: 02:21 min</strong></span>
<span class="strong"><strong> [INFO] Finished at: 2017-02-05T16:54:55+05:30</strong></span>
<span class="strong"><strong> [INFO] Final Memory: 29M/102M</strong></span>
<span class="strong"><strong> [INFO] -----------------------------------------------------------------</strong></span>
</pre></div><p>Once the application is up and running on the Cloud, we can use the URL from the log to launch the application: <a class="ulink" href="http://springboot-for-beginners-example.cfapps.io">http://springboot-for-beginners-example.cfapps.io</a>.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>You can find more information about the Java Build Pack of Cloud Foundry at <a class="ulink" href="https://docs.run.pivotal.io/buildpacks/java/build-tool-int.html#maven">https://docs.run.pivotal.io/buildpacks/java/build-tool-int.html#maven</a>.</p></div></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec28"/>Summary</h1></div></div></div><p>Spring Boot makes developing Spring-based applications easy. It enables us to create production-ready applications very quickly.</p><p>In this lesson, we understood the different external configuration options provided by Spring Boot. We looked at embedded servers and deployed a test application to a PaaS Cloud platform--Cloud Foundry. We explored how to monitor our application in the production using Spring Boot Actuator. At the end, we looked at the features that make a developer more productive--Spring Boot developer tools and live reload.</p><p>With this, we've come to the end of this book. I hope you'd a smooth journey and gained a lot of knowledge on building microservices with Spring Boot.</p><p>I wish you all the best for your future projects. Keep learning and exploring!</p></div>
<div class="section" title="Assessments"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec29"/>Assessments</h1></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The ________ endpoint provides information about the operating system, JVM installation, classpath, system environment variable, and the values configured in various application properties files.</li><li class="listitem">Which of the following is provided by cloud to Cloud Foundry?<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Software as a Service</li><li class="listitem">Platform as a Service </li><li class="listitem">Infrastructure as a Service</li><li class="listitem">All of the above</li></ol></div></li><li class="listitem">State whether True or False: Spring MVC can be extensively configured through <code class="literal">application.properties</code>.</li><li class="listitem">Which of the following actuator endpoints provides a trace of the last few requests serviced by the application when debugging.<div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem"><code class="literal">/applications/trace</code></li><li class="listitem"><code class="literal">/application/tracing</code></li><li class="listitem"><code class="literal">/app/trace</code></li><li class="listitem"><code class="literal">/apps/tracing</code></li></ol></div></li><li class="listitem">_________ makes developing Spring-based applications easy as it enables you to create production-ready applications very quickly.</li></ol></div></div></body></html>