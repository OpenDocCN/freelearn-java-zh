<html><head></head><body>
<div id="_idContainer014">
<h1 class="chapter-number" id="_idParaDest-16"><a id="_idTextAnchor015"/><span class="koboSpan" id="kobo.1.1">1</span></h1>
<h1 id="_idParaDest-17"><a id="_idTextAnchor016"/><span class="koboSpan" id="kobo.2.1">Building the Case for TDD</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Before we dive into what </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">test-driven development</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">TDD</span></strong><span class="koboSpan" id="kobo.7.1">) is and how to use it, we’re going to need </span><a id="_idIndexMarker000"/><span class="koboSpan" id="kobo.8.1">to understand why we need it. </span><span class="koboSpan" id="kobo.8.2">Every seasoned developer knows that bad code is easier to write than good code. </span><span class="koboSpan" id="kobo.8.3">Even good code seems to get worse over </span><span class="No-Break"><span class="koboSpan" id="kobo.9.1">time. </span><span class="koboSpan" id="kobo.9.2">Why?</span></span></p>
<p><span class="koboSpan" id="kobo.10.1">In this chapter, we will review the technical failures that make source code difficult to work with. </span><span class="koboSpan" id="kobo.10.2">We’ll consider the effect that bad code has on both the team and the business bottom line. </span><span class="koboSpan" id="kobo.10.3">By the end of the chapter, we’ll have a clear picture of the anti-patterns we need to avoid in </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">our code.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1">In this chapter, we’re going to cover the following </span><span class="No-Break"><span class="koboSpan" id="kobo.13.1">main topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.14.1">Writing </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">code badly</span></span></li>
<li><span class="koboSpan" id="kobo.16.1">Recognizing </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">bad code</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Decreasing </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">team performance</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Diminishing </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">business outcomes</span></span><a id="_idTextAnchor017"/></li>
</ul>
<h1 id="_idParaDest-18"><a id="_idTextAnchor018"/><span class="koboSpan" id="kobo.22.1">Writing code badly</span></h1>
<p><span class="koboSpan" id="kobo.23.1">As every </span><a id="_idIndexMarker001"/><span class="koboSpan" id="kobo.24.1">developer knows, it seems a lot easier to write bad code than to engineer good code. </span><span class="koboSpan" id="kobo.24.2">We can define good code as being easy to understand and safe to change. </span><span class="koboSpan" id="kobo.24.3">Bad code is therefore the opposite of this, where it is very difficult to read the code and understand what problem it is supposed to be solving. </span><span class="koboSpan" id="kobo.24.4">We fear changing bad code – we know that we are likely to </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">break something.</span></span></p>
<p><span class="koboSpan" id="kobo.26.1">My own troubles with bad code go all the way back to my first program of note. </span><span class="koboSpan" id="kobo.26.2">This was a program written for a school competition, which aimed to assist realtors to help their customers find the perfect house. </span><span class="koboSpan" id="kobo.26.3">Written on the 8-bit Research Machines 380Z computer at school, this was 1981’s answer </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">to Rightmove.</span></span></p>
<p><span class="koboSpan" id="kobo.28.1">In those pre-web days, it existed as a simple desktop application with a green-screen text-based user interface. </span><span class="koboSpan" id="kobo.28.2">It did not have to handle millions, never mind billions, of users. </span><span class="koboSpan" id="kobo.28.3">Nor did it have to handle millions of houses. </span><span class="koboSpan" id="kobo.28.4">It didn’t even have a nice </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">user interface.</span></span></p>
<p><span class="koboSpan" id="kobo.30.1">As a</span><a id="_idIndexMarker002"/><span class="koboSpan" id="kobo.31.1"> piece of code, it was a couple of thousand lines of </span><em class="italic"><span class="koboSpan" id="kobo.32.1">Microsoft Disk BASIC 9</span></em><span class="koboSpan" id="kobo.33.1"> code. </span><span class="koboSpan" id="kobo.33.2">There was no code structure to speak of, just thousands of lines resplendent with uneven line numbers and festooned with global variables. </span><span class="koboSpan" id="kobo.33.3">To add an even greater element of challenge, BASIC limited every variable to a two-letter name. </span><span class="koboSpan" id="kobo.33.4">This made every name in the code utterly incomprehensible. </span><span class="koboSpan" id="kobo.33.5">The source code was intentionally written to have as few spaces in it as possible in order to save memory. </span><span class="koboSpan" id="kobo.33.6">When you only had 32KB of RAM to fit all of the program code, the data, and the operating system in, every </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">byte mattered.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">The program only offered its user basic features. </span><span class="koboSpan" id="kobo.35.2">The user interface was of its time, using only text-based forms. </span><span class="koboSpan" id="kobo.35.3">It predated graphical operating systems by a decade. </span><span class="koboSpan" id="kobo.35.4">The program also had to implement its own data storage system, using files on 5.25-inch floppy disks. </span><span class="koboSpan" id="kobo.35.5">Again, affordable database components were of the future. </span><span class="koboSpan" id="kobo.35.6">The main feature of the program in question was that users could search for houses within certain price ranges and feature sets. </span><span class="koboSpan" id="kobo.35.7">They could filter by terms such as the number of bedrooms or </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">price range.</span></span></p>
<p><span class="koboSpan" id="kobo.37.1">However, the code itself really was a mess. </span><span class="koboSpan" id="kobo.37.2">See for yourself – here is a photograph of the </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">original listing:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<span class="koboSpan" id="kobo.39.1"><img alt="Figure 1.1 – The estate agent code listing" src="image/Figure_1.1_B18384.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.40.1">Figure 1.1 – The estate agent code listing</span></p>
<p><span class="koboSpan" id="kobo.41.1">This horror is the original paper listing of one of the development versions. </span><span class="koboSpan" id="kobo.41.2">It is, as you can see, completely unreadable. </span><span class="koboSpan" id="kobo.41.3">It’s not just you. </span><span class="koboSpan" id="kobo.41.4">Nobody would be able to read it easily. </span><span class="koboSpan" id="kobo.41.5">I can’t and I wrote it. </span><span class="koboSpan" id="kobo.41.6">I would go as far as to say it is a mess, </span><em class="italic"><span class="koboSpan" id="kobo.42.1">my mess</span></em><span class="koboSpan" id="kobo.43.1">, crafted by me, one keystroke at </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">a time.</span></span></p>
<p><span class="koboSpan" id="kobo.45.1">This kind </span><a id="_idIndexMarker003"/><span class="koboSpan" id="kobo.46.1">of code is a nightmare to work with. </span><span class="koboSpan" id="kobo.46.2">It fails our definition of good code. </span><span class="koboSpan" id="kobo.46.3">It is not at all easy to read that listing and understand what the code is supposed to be doing. </span><span class="koboSpan" id="kobo.46.4">It is not safe to change that code. </span><span class="koboSpan" id="kobo.46.5">If we attempted to, we would find that we could never be certain about whether we have broken some feature or not. </span><span class="koboSpan" id="kobo.46.6">We would also have to manually retest the entire application. </span><span class="koboSpan" id="kobo.46.7">This would </span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">be time-consuming.</span></span></p>
<p><span class="koboSpan" id="kobo.48.1">Speaking of testing, I never thoroughly tested that code. </span><span class="koboSpan" id="kobo.48.2">It was all manually tested without even following a formal test plan. </span><span class="koboSpan" id="kobo.48.3">At best, I would have run a handful of </span><strong class="bold"><span class="koboSpan" id="kobo.49.1">happy path </span></strong><span class="koboSpan" id="kobo.50.1">manual tests. </span><span class="koboSpan" id="kobo.50.2">These</span><a id="_idIndexMarker004"/><span class="koboSpan" id="kobo.51.1"> were the kind of tests that would confirm that you could add or delete a house, and that some representative searches worked, but that was all. </span><span class="koboSpan" id="kobo.51.2">There was no way I ever tested every path through that code. </span><span class="koboSpan" id="kobo.51.3">I just guessed that it </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">would work.</span></span></p>
<p><span class="koboSpan" id="kobo.53.1">If the data handling had failed, I would not have known what had happened. </span><span class="koboSpan" id="kobo.53.2">I never tried it. </span><span class="koboSpan" id="kobo.53.3">Did every possible search combination work? </span><span class="koboSpan" id="kobo.53.4">Who knew? </span><span class="koboSpan" id="kobo.53.5">I certainly had no idea. </span><span class="koboSpan" id="kobo.53.6">I had even less patience to go through all that tedious manual testing. </span><span class="koboSpan" id="kobo.53.7">It worked, enough to win an award of sorts, but it was still </span><span class="No-Break"><span class="koboSpan" id="kobo.54.1">bad code.</span></span></p>
<h2 id="_idParaDest-19"><a id="_idTextAnchor019"/><span class="koboSpan" id="kobo.55.1">Understanding why bad code is written</span></h2>
<p><span class="koboSpan" id="kobo.56.1">In my case, it was</span><a id="_idIndexMarker005"/><span class="koboSpan" id="kobo.57.1"> simply down to a lack of knowledge. </span><span class="koboSpan" id="kobo.57.2">I did not know how to write good code. </span><span class="koboSpan" id="kobo.57.3">But there are also other reasons unrelated to skill. </span><span class="koboSpan" id="kobo.57.4">Nobody ever sets out to write bad code intentionally. </span><span class="koboSpan" id="kobo.57.5">Developers do the best job they can with the tools available and to the best of their ability at </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">that time.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1">Even with the right skills, several common issues can result in </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">bad code:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.61.1">A lack of time to refine the code due to </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">project deadlines</span></span></li>
<li><span class="koboSpan" id="kobo.63.1">Working with legacy code whose structure prevents new code from being </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">added cleanly</span></span></li>
<li><span class="koboSpan" id="kobo.65.1">Adding a short-term fix for an urgent production fault and then never </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">reworking it</span></span></li>
<li><span class="koboSpan" id="kobo.67.1">Unfamiliarity with the subject area of </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">the code</span></span></li>
<li><span class="koboSpan" id="kobo.69.1">Unfamiliarity with the local idioms and </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">development styles</span></span></li>
<li><span class="koboSpan" id="kobo.71.1">Inappropriately using idioms from a different </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">programming language</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.73.1">Now that we’ve seen an </span><a id="_idIndexMarker006"/><span class="koboSpan" id="kobo.74.1">example of code that is difficult to work with, and understood how it came about, let’s turn to the obvious next question: how can we recognize </span><span class="No-Break"><span class="koboSpan" id="kobo.75.1">bad </span><a id="_idTextAnchor020"/><span class="koboSpan" id="kobo.76.1">code?</span></span></p>
<h1 id="_idParaDest-20"><a id="_idTextAnchor021"/><span class="koboSpan" id="kobo.77.1">Recognizing bad code</span></h1>
<p><span class="koboSpan" id="kobo.78.1">Admitting that our code is difficult to work with is one thing, but to move past that and write good code, we need to understand </span><em class="italic"><span class="koboSpan" id="kobo.79.1">why</span></em><span class="koboSpan" id="kobo.80.1"> code is bad. </span><span class="koboSpan" id="kobo.80.2">Let’s identify the </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">technical is</span><a id="_idTextAnchor022"/><span class="koboSpan" id="kobo.82.1">sues.</span></span></p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor023"/><span class="koboSpan" id="kobo.83.1">Bad variable names</span></h2>
<p><span class="koboSpan" id="kobo.84.1">Good code is self-describing and safe to change. </span><span class="koboSpan" id="kobo.84.2">Bad code </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">is not.</span></span></p>
<p><span class="koboSpan" id="kobo.86.1">Names </span><a id="_idIndexMarker007"/><span class="koboSpan" id="kobo.87.1">are the most critical factor in deciding whether code</span><a id="_idIndexMarker008"/><span class="koboSpan" id="kobo.88.1"> will be easy to work with or not. </span><span class="koboSpan" id="kobo.88.2">Good names tell the reader clearly what to expect. </span><span class="koboSpan" id="kobo.88.3">Bad names do not. </span><span class="koboSpan" id="kobo.88.4">Variables should be named according to what they contain. </span><span class="koboSpan" id="kobo.88.5">They should answer “</span><em class="italic"><span class="koboSpan" id="kobo.89.1">why would I want to use this data? </span><span class="koboSpan" id="kobo.89.2">What will it </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.90.1">tell me?</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">”</span></span></p>
<p><span class="koboSpan" id="kobo.92.1">A string variable that has been named </span><strong class="source-inline"><span class="koboSpan" id="kobo.93.1">string</span></strong><span class="koboSpan" id="kobo.94.1"> is badly named. </span><span class="koboSpan" id="kobo.94.2">All we know is that it is a string. </span><span class="koboSpan" id="kobo.94.3">This does not tell us what is in the variable or why we would want to use it. </span><span class="koboSpan" id="kobo.94.4">If that string represented a surname, then by simply calling it </span><strong class="source-inline"><span class="koboSpan" id="kobo.95.1">surname</span></strong><span class="koboSpan" id="kobo.96.1">, we would have helped future readers of our code understand our intentions much better. </span><span class="koboSpan" id="kobo.96.2">They would be able to easily see that this variable holds a surname and should not be used for any </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">other purpose.</span></span></p>
<p><span class="koboSpan" id="kobo.98.1">The two-letter variable names we saw in the listing in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.99.1">Figure 1</span></em></span><em class="italic"><span class="koboSpan" id="kobo.100.1">.1</span></em><span class="koboSpan" id="kobo.101.1"> represented a limitation of the BASIC language. </span><span class="koboSpan" id="kobo.101.2">It was not possible to do better at the time, but as we could see, they were not helpful. </span><span class="koboSpan" id="kobo.101.3">It is much harder to understand what </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">sn</span></strong><span class="koboSpan" id="kobo.103.1"> means than </span><strong class="source-inline"><span class="koboSpan" id="kobo.104.1">surname</span></strong><span class="koboSpan" id="kobo.105.1">, if that’s what the variable stores. </span><span class="koboSpan" id="kobo.105.2">To carry that even further, if we decide to hold a surname in a variable named </span><strong class="source-inline"><span class="koboSpan" id="kobo.106.1">x</span></strong><span class="koboSpan" id="kobo.107.1">, we have made things really difficult for readers of our code. </span><span class="koboSpan" id="kobo.107.2">They now have two problems </span><span class="No-Break"><span class="koboSpan" id="kobo.108.1">to solve:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.109.1">They have to reverse-engineer the code to work out that </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">x</span></strong><span class="koboSpan" id="kobo.111.1"> is used to hold </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">a surname</span></span></li>
<li><span class="koboSpan" id="kobo.113.1">They have to mentally map </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">x</span></strong><span class="koboSpan" id="kobo.115.1"> with the concept of surname every time that they </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">use it</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.117.1">It is so</span><a id="_idIndexMarker009"/><span class="koboSpan" id="kobo.118.1"> much easier when we use descriptive names for all our data, such as local variables, method parameters, and object fields. </span><span class="koboSpan" id="kobo.118.2">In </span><a id="_idIndexMarker010"/><span class="koboSpan" id="kobo.119.1">terms of more general guidelines, the following Google style guide is a good </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">source: </span></span><a href="https://google.github.io/styleguide/javaguide.html#s5-naming"><span class="No-Break"><span class="koboSpan" id="kobo.121.1">https://google.github.io/styleguide/javaguide.html#s5-naming</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.122.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.123.1">Best practice for naming variables</span></p>
<p class="callout"><span class="koboSpan" id="kobo.124.1">Describe the data contained, not the </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">data type.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">We now have a better idea of how to go about naming variables. </span><span class="koboSpan" id="kobo.126.2">Now, let’s look at how to name functions, methods, and </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">classes </span><a id="_idTextAnchor024"/><span class="koboSpan" id="kobo.128.1">properly.</span></span></p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor025"/><span class="koboSpan" id="kobo.129.1">Bad function, method, and class names</span></h2>
<p><span class="koboSpan" id="kobo.130.1">The names</span><a id="_idIndexMarker011"/><span class="koboSpan" id="kobo.131.1"> of functions, methods, and classes all follow a similar pattern. </span><span class="koboSpan" id="kobo.131.2">In good code, function names tell us why we should call that</span><a id="_idIndexMarker012"/><span class="koboSpan" id="kobo.132.1"> function. </span><span class="koboSpan" id="kobo.132.2">They describe what they will do for us as users of that function. </span><span class="koboSpan" id="kobo.132.3">The focus is on the outcome – what will have happened by the time the function returns. </span><span class="koboSpan" id="kobo.132.4">We do not describe</span><a id="_idIndexMarker013"/><span class="koboSpan" id="kobo.133.1"> how that function is implemented. </span><span class="koboSpan" id="kobo.133.2">This is important. </span><span class="koboSpan" id="kobo.133.3">It allows us to change our implementation of that function later if that becomes advantageous, and the name will still describe the </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">outcome clearly.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">A function named </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">calculateTotalPrice</span></strong><span class="koboSpan" id="kobo.137.1"> is clear about what it is going to do for us. </span><span class="koboSpan" id="kobo.137.2">It will calculate the total price. </span><span class="koboSpan" id="kobo.137.3">It won’t have any surprising side effects. </span><span class="koboSpan" id="kobo.137.4">It won’t try and do anything else. </span><span class="koboSpan" id="kobo.137.5">It will do what it says it will. </span><span class="koboSpan" id="kobo.137.6">If we abbreviate that name to </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">ctp</span></strong><span class="koboSpan" id="kobo.139.1">, then it becomes much less clear. </span><span class="koboSpan" id="kobo.139.2">If we call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">func1</span></strong><span class="koboSpan" id="kobo.141.1">, then it tells us absolutely nothing at all that </span><span class="No-Break"><span class="koboSpan" id="kobo.142.1">is useful.</span></span></p>
<p><span class="koboSpan" id="kobo.143.1">Bad names force us to reverse-engineer every decision made every time we read the code. </span><span class="koboSpan" id="kobo.143.2">We have to pore through the code to try and find out what it is used for. </span><span class="koboSpan" id="kobo.143.3">We should not have to do this. </span><span class="koboSpan" id="kobo.143.4">Names should be abstractions. </span><span class="koboSpan" id="kobo.143.5">A good name will speed up our ability to understand code by condensing a bigger-picture understanding into a </span><span class="No-Break"><span class="koboSpan" id="kobo.144.1">few words.</span></span></p>
<p><span class="koboSpan" id="kobo.145.1">You can think</span><a id="_idIndexMarker014"/><span class="koboSpan" id="kobo.146.1"> of the function name as a heading. </span><span class="koboSpan" id="kobo.146.2">The code inside the function is the body of text. </span><span class="koboSpan" id="kobo.146.3">It works just the same way that the</span><a id="_idIndexMarker015"/><span class="koboSpan" id="kobo.147.1"> text you’re reading now has a heading, </span><em class="italic"><span class="koboSpan" id="kobo.148.1">Recognizing bad code</span></em><span class="koboSpan" id="kobo.149.1">, which gives us a general idea of the content in the paragraphs that follow. </span><span class="koboSpan" id="kobo.149.2">From</span><a id="_idIndexMarker016"/><span class="koboSpan" id="kobo.150.1"> reading the heading, we expect the paragraphs to be about recognizing bad code, nothing more and </span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">nothing less.</span></span></p>
<p><span class="koboSpan" id="kobo.152.1">We want to be able to skim-read our software through its </span><em class="italic"><span class="koboSpan" id="kobo.153.1">headings</span></em><span class="koboSpan" id="kobo.154.1"> – the function, method, class, and variable names – so that we can focus on what we want to do now, rather than relearning what was done in </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">the past.</span></span></p>
<p><span class="koboSpan" id="kobo.156.1">Method names are treated identically to function names. </span><span class="koboSpan" id="kobo.156.2">They both describe an action to be taken. </span><span class="koboSpan" id="kobo.156.3">Similarly, you can apply the same rules for function names to </span><span class="No-Break"><span class="koboSpan" id="kobo.157.1">method names.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.158.1">Best practice for method and function names</span></p>
<p class="callout"><span class="koboSpan" id="kobo.159.1">Describe the outcome, not </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">the implementation.</span></span></p>
<p><span class="koboSpan" id="kobo.161.1">Again, class names follow descriptive rules. </span><span class="koboSpan" id="kobo.161.2">A class often represents a single concept, so its name should describe that concept. </span><span class="koboSpan" id="kobo.161.3">If a class represents the user profile data in our system, then a class name of </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">UserProfile</span></strong><span class="koboSpan" id="kobo.163.1"> will help readers of our code to </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">understand that.</span></span></p>
<h3><span class="koboSpan" id="kobo.165.1">A name’s length depends on namespacing</span></h3>
<p><span class="koboSpan" id="kobo.166.1">One further tip </span><a id="_idIndexMarker017"/><span class="koboSpan" id="kobo.167.1">applies to all names with regard to their length. </span><span class="koboSpan" id="kobo.167.2">The name should be fully descriptive but its length depends on a few factors. </span><span class="koboSpan" id="kobo.167.3">We can choose shorter names when one of the </span><span class="No-Break"><span class="koboSpan" id="kobo.168.1">following applies:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.169.1">The named variable has a small scope of only a </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">few lines</span></span></li>
<li><span class="koboSpan" id="kobo.171.1">The class name itself provides the bulk of </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">the description</span></span></li>
<li><span class="koboSpan" id="kobo.173.1">The name exists within some other namespace, such as a </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">class name</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.175.1">Let’s look at a code example for each case to make </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">this clear.</span></span></p>
<p><span class="koboSpan" id="kobo.177.1">The following </span><a id="_idIndexMarker018"/><span class="koboSpan" id="kobo.178.1">code calculates the total of a list of values, using a short variable </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">name, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">total</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.182.1">
int calculateTotal(List&lt;Integer&gt; values) {
    int total = 0;
    for ( Integer v : values ) {
        total += v;
    }
    return total ;
}</span></pre>
<p><span class="koboSpan" id="kobo.183.1">This works well because it is clear that </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">total</span></strong><span class="koboSpan" id="kobo.185.1"> represents the total of all values. </span><span class="koboSpan" id="kobo.185.2">We do not need a name that is any longer given the context around it in the code. </span><span class="koboSpan" id="kobo.185.3">Perhaps an even better example lies in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">v</span></strong><span class="koboSpan" id="kobo.187.1"> loop variable. </span><span class="koboSpan" id="kobo.187.2">It has a one-line scope, and within that scope, it is quite clear that </span><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">v</span></strong><span class="koboSpan" id="kobo.189.1"> represents the current value within the loop. </span><span class="koboSpan" id="kobo.189.2">We could use a longer name such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">currentValue</span></strong><span class="koboSpan" id="kobo.191.1"> instead. </span><span class="koboSpan" id="kobo.191.2">However, does this add any clarity? </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">Not really.</span></span></p>
<p><span class="koboSpan" id="kobo.193.1">In the following method, we have a parameter with the short </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">name </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">gc</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.197.1">
private void draw(GraphicsContext gc) {
    // code using gc omitted
}</span></pre>
<p><span class="koboSpan" id="kobo.198.1">The reason we can choose such a short name is that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">GraphicsContext</span></strong><span class="koboSpan" id="kobo.200.1"> class carries most of the description already. </span><span class="koboSpan" id="kobo.200.2">If this were a more general-purpose class, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">String</span></strong><span class="koboSpan" id="kobo.202.1">, for example, then this short name technique would </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">be unhelpful.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">In this final code example, we are using the short method name </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.206.1">draw()</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.208.1">
public class ProfileImage {
    public void draw(WebResponse wr) {
        // Code omitted
    }
}</span></pre>
<p><span class="koboSpan" id="kobo.209.1">The class name here is highly descriptive. </span><span class="koboSpan" id="kobo.209.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">ProfileImage</span></strong><span class="koboSpan" id="kobo.211.1"> class name we’ve used in our system is one that is commonly used to describe the avatar or photograph that shows on a user’s profile page. </span><span class="koboSpan" id="kobo.211.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">draw()</span></strong><span class="koboSpan" id="kobo.213.1"> method is responsible for writing the image data to a </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">WebResponse</span></strong><span class="koboSpan" id="kobo.215.1"> object. </span><span class="koboSpan" id="kobo.215.2">We could choose a longer method name, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">drawProfileImage()</span></strong><span class="koboSpan" id="kobo.217.1">, but that simply repeats information that has already been made clear given the name of the class. </span><span class="koboSpan" id="kobo.217.2">Details such as this are what give Java its reputation for</span><a id="_idIndexMarker019"/><span class="koboSpan" id="kobo.218.1"> being verbose, which I feel is unfair; it is often us Java programmers who are verbose, rather than </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">Java itself.</span></span></p>
<p><span class="koboSpan" id="kobo.220.1">We’ve seen how properly naming things makes our code easier to understand. </span><span class="koboSpan" id="kobo.220.2">Let’s take a look at the next big problem that we see in bad code – using constructs that make logic e</span><a id="_idTextAnchor026"/><span class="koboSpan" id="kobo.221.1">rrors </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">more likely.</span></span></p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor027"/><span class="koboSpan" id="kobo.223.1">Error-prone constructs</span></h2>
<p><span class="koboSpan" id="kobo.224.1">Another</span><a id="_idIndexMarker020"/><span class="koboSpan" id="kobo.225.1"> tell-tale sign of bad code is that it uses error-prone constructs and designs. </span><span class="koboSpan" id="kobo.225.2">There are always several ways of doing the same thing in code. </span><span class="koboSpan" id="kobo.225.3">Some of them provide more scope to introduce mistakes than others. </span><span class="koboSpan" id="kobo.225.4">It therefore makes sense to choose ways of coding that actively </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">avoid errors.</span></span></p>
<p><span class="koboSpan" id="kobo.227.1">Let’s compare two different versions of a function to calculate a total value and analyze where errors might </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">creep in:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.229.1">
 int calculateTotal(List&lt;Integer&gt; values) {
    int total = 0;
    for ( int i=0; i&lt;values.size(); i++) {
        total += values.get(i);
    }
    return total ;
}</span></pre>
<p><span class="koboSpan" id="kobo.230.1">The previous </span><a id="_idIndexMarker021"/><span class="koboSpan" id="kobo.231.1">listing is a simple method that will take a list of integers and return their total. </span><span class="koboSpan" id="kobo.231.2">It’s the sort of code that has been around</span><a id="_idIndexMarker022"/><span class="koboSpan" id="kobo.232.1"> since </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">Java 1.0.2</span></strong><span class="koboSpan" id="kobo.234.1">. </span><span class="koboSpan" id="kobo.234.2">It works, yet it is error prone. </span><span class="koboSpan" id="kobo.234.3">In order for this code to be correct, we need to get several </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">things right:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.236.1">Making sure that </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">total</span></strong><span class="koboSpan" id="kobo.238.1"> is initialized to </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">0</span></strong><span class="koboSpan" id="kobo.240.1"> and not some </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">other value</span></span></li>
<li><span class="koboSpan" id="kobo.242.1">Making sure that our </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">i</span></strong><span class="koboSpan" id="kobo.244.1"> loop index is initialized </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">0</span></strong></span></li>
<li><span class="koboSpan" id="kobo.247.1">Making sure that we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">&lt;</span></strong><span class="koboSpan" id="kobo.249.1"> and not </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">&lt;=</span></strong><span class="koboSpan" id="kobo.251.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">==</span></strong><span class="koboSpan" id="kobo.253.1"> in our </span><span class="No-Break"><span class="koboSpan" id="kobo.254.1">loop comparison</span></span></li>
<li><span class="koboSpan" id="kobo.255.1">Making sure that we increment the </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">i</span></strong><span class="koboSpan" id="kobo.257.1"> loop index by </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">exactly one</span></span></li>
<li><span class="koboSpan" id="kobo.259.1">Making sure that we add the value from the current index in the list </span><span class="No-Break"><span class="koboSpan" id="kobo.260.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">total</span></strong></span></li>
</ul>
<p><span class="koboSpan" id="kobo.262.1">Experienced programmers do tend to get all this right first time. </span><span class="koboSpan" id="kobo.262.2">My point is that there is a </span><em class="italic"><span class="koboSpan" id="kobo.263.1">possibility</span></em><span class="koboSpan" id="kobo.264.1"> of getting any or all of these things wrong. </span><span class="koboSpan" id="kobo.264.2">I’ve seen mistakes made where </span><strong class="source-inline"><span class="koboSpan" id="kobo.265.1">&lt;=</span></strong><span class="koboSpan" id="kobo.266.1"> has been used instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">&lt;</span></strong><span class="koboSpan" id="kobo.268.1"> and the code fails with an </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">ArrayIndexOutOfBounds</span></strong><span class="koboSpan" id="kobo.270.1"> exception as a result. </span><span class="koboSpan" id="kobo.270.2">Another easy mistake is to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">=</span></strong><span class="koboSpan" id="kobo.272.1"> in the line that adds to the total value instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">+=</span></strong><span class="koboSpan" id="kobo.274.1">. </span><span class="koboSpan" id="kobo.274.2">This has the effect of returning only the last value, not the total. </span><span class="koboSpan" id="kobo.274.3">I have even made that mistake as a pure </span><em class="italic"><span class="koboSpan" id="kobo.275.1">typo</span></em><span class="koboSpan" id="kobo.276.1"> – I honestly thought I had typed the right thing but I was typing quickly and </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">I hadn’t.</span></span></p>
<p><span class="koboSpan" id="kobo.278.1">It is clearly much better for us to </span><em class="italic"><span class="koboSpan" id="kobo.279.1">avoid</span></em><span class="koboSpan" id="kobo.280.1"> these kinds of errors entirely. </span><span class="koboSpan" id="kobo.280.2">If an error cannot happen, then it will not happen. </span><span class="koboSpan" id="kobo.280.3">This is a process I call </span><em class="italic"><span class="koboSpan" id="kobo.281.1">designing out errors</span></em><span class="koboSpan" id="kobo.282.1">. </span><span class="koboSpan" id="kobo.282.2">It is a fundamental clean-code practice. </span><span class="koboSpan" id="kobo.282.3">To see how we could do this to our previous example, let’s look at the </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.284.1">
int calculateTotal(List&lt;Integer&gt; values) {
    return values.stream().mapToInt(v -&gt; v).sum();
}</span></pre>
<p><span class="koboSpan" id="kobo.285.1">This code does the same thing, yet it is inherently safer. </span><span class="koboSpan" id="kobo.285.2">We have no </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">total</span></strong><span class="koboSpan" id="kobo.287.1"> variable, so we cannot initialize that incorrectly, nor can we forget to add values to it. </span><span class="koboSpan" id="kobo.287.2">We have no loop and so no loop index variable. </span><span class="koboSpan" id="kobo.287.3">We cannot use the wrong comparison for the loop end and so cannot get an </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">ArrayIndexOutOfBounds</span></strong><span class="koboSpan" id="kobo.289.1"> exception. </span><span class="koboSpan" id="kobo.289.2">There is simply far less that can go wrong in this implementation of the code. </span><span class="koboSpan" id="kobo.289.3">It generally makes the code clearer to read as well. </span><span class="koboSpan" id="kobo.289.4">This, in turn, helps with onboarding new developers, code reviews, adding new features, and </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">pair programming.</span></span></p>
<p><span class="koboSpan" id="kobo.291.1">Whenever </span><a id="_idIndexMarker023"/><span class="koboSpan" id="kobo.292.1">we have a choice to use code with fewer parts that could go wrong, we should choose that approach. </span><span class="koboSpan" id="kobo.292.2">We can make life easier for ourselves and our colleagues by choosing to keep our code as error-free and simple as possible. </span><span class="koboSpan" id="kobo.292.3">We can use more robust constructs to give bugs fewer places </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">to hide.</span></span></p>
<p><span class="koboSpan" id="kobo.294.1">It is worth mentioning that both versions of the code have an integer overflow bug. </span><span class="koboSpan" id="kobo.294.2">If we add integers together whose total is beyond the allowable range of -2147483648 to 2147483647, then the code will produce the wrong result. </span><span class="koboSpan" id="kobo.294.3">The point still stands, however: the later version has fewer places where things can go wrong. </span><em class="italic"><span class="koboSpan" id="kobo.295.1">Structurally</span></em><span class="koboSpan" id="kobo.296.1">, it is </span><span class="No-Break"><span class="koboSpan" id="kobo.297.1">simpler code.</span></span></p>
<p><span class="koboSpan" id="kobo.298.1">Now that we have seen how to avoid the kinds of errors that are typical of bad code, let’s turn to other problem areas: </span><a id="_idTextAnchor028"/><span class="koboSpan" id="kobo.299.1">coupling </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">and cohesion.</span></span></p>
<h2 id="_idParaDest-24"><a id="_idTextAnchor029"/><span class="koboSpan" id="kobo.301.1">Coupling and cohesion</span></h2>
<p><span class="koboSpan" id="kobo.302.1">If we have a </span><a id="_idIndexMarker024"/><span class="koboSpan" id="kobo.303.1">number of Java </span><a id="_idIndexMarker025"/><span class="koboSpan" id="kobo.304.1">classes, </span><strong class="bold"><span class="koboSpan" id="kobo.305.1">coupling</span></strong><span class="koboSpan" id="kobo.306.1"> describes the relationship between those </span><a id="_idIndexMarker026"/><span class="koboSpan" id="kobo.307.1">classes, while </span><strong class="bold"><span class="koboSpan" id="kobo.308.1">cohesion</span></strong><span class="koboSpan" id="kobo.309.1"> describes</span><a id="_idIndexMarker027"/><span class="koboSpan" id="kobo.310.1"> the relationships between the methods inside </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">each one.</span></span></p>
<p><span class="koboSpan" id="kobo.312.1">Our software designs become easier to work with once we get the amounts of coupling and cohesion right. </span><span class="koboSpan" id="kobo.312.2">We will learn techniques to help us do this in </span><a href="B18384_07.xhtml#_idTextAnchor128"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.313.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.314.1">, </span><em class="italic"><span class="koboSpan" id="kobo.315.1">Driving Design–TDD and SOLID</span></em><span class="koboSpan" id="kobo.316.1">. </span><span class="koboSpan" id="kobo.316.2">For now, let’s understand the problems that we will face when we get this wrong, starting with th</span><a id="_idTextAnchor030"/><span class="koboSpan" id="kobo.317.1">e problem of </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">low cohesion.</span></span></p>
<h3><span class="koboSpan" id="kobo.319.1">Low cohesion inside a class</span></h3>
<p><strong class="bold"><span class="koboSpan" id="kobo.320.1">Low cohesion</span></strong><span class="koboSpan" id="kobo.321.1"> describes</span><a id="_idIndexMarker028"/><span class="koboSpan" id="kobo.322.1"> code that has many different</span><a id="_idIndexMarker029"/><span class="koboSpan" id="kobo.323.1"> ideas all lumped together in it in a single place. </span><span class="koboSpan" id="kobo.323.2">The following UML class diagram shows an example of a class with low cohesion among </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">its methods:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<span class="koboSpan" id="kobo.325.1"><img alt="Figure 1.2 – Low cohesion" src="image/Figure_1.2_B18384.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.326.1">Figure 1.2 – Low cohesion</span></p>
<p><span class="koboSpan" id="kobo.327.1">The code</span><a id="_idIndexMarker030"/><span class="koboSpan" id="kobo.328.1"> in this class attempts to combine too many responsibilities. </span><span class="koboSpan" id="kobo.328.2">They are not all obviously related – we are writing to a database, sending out welcome emails, and rendering web pages. </span><span class="koboSpan" id="kobo.328.3">This large variety of responsibilities makes our class harder to understand and harder to change. </span><span class="koboSpan" id="kobo.328.4">Consider the different reasons we may need to change </span><span class="No-Break"><span class="koboSpan" id="kobo.329.1">this class:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.330.1">Changes to the </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">database technology</span></span></li>
<li><span class="koboSpan" id="kobo.332.1">Changes to the web </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">view layout</span></span></li>
<li><span class="koboSpan" id="kobo.334.1">Changes to the web template </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">engine technology</span></span></li>
<li><span class="koboSpan" id="kobo.336.1">Changes to the email template </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">engine technology</span></span></li>
<li><span class="koboSpan" id="kobo.338.1">Changes to the news feed </span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">generation algorithm</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.340.1">There are many reasons why we would need to change the code in this class. </span><span class="koboSpan" id="kobo.340.2">It is always better to give classes a more precise focus, so that there are fewer reasons to change them. </span><span class="koboSpan" id="kobo.340.3">Ideally, any given piece of code should only have one reason to </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">be changed.</span></span></p>
<p><span class="koboSpan" id="kobo.342.1">Understanding code with low cohesion is hard. </span><span class="koboSpan" id="kobo.342.2">We are forced to understand many different ideas at once. </span><span class="koboSpan" id="kobo.342.3">Internally, the code is very interconnected. </span><span class="koboSpan" id="kobo.342.4">Changing one method often forces a change in others because of this. </span><span class="koboSpan" id="kobo.342.5">Using the class is difficult, as we need to construct it with all its dependencies. </span><span class="koboSpan" id="kobo.342.6">In our example, we have a mixture of templating engines, a database, and code for creating a web page. </span><span class="koboSpan" id="kobo.342.7">This also makes the class very difficult to test. </span><span class="koboSpan" id="kobo.342.8">We need to set up all these things before we can run test methods against that class. </span><span class="koboSpan" id="kobo.342.9">Reuse is limited with a class like this. </span><span class="koboSpan" id="kobo.342.10">The class is very tightly bound to the mix of features that are rolled </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">into it.</span></span></p>
<h3><span class="koboSpan" id="kobo.344.1">High coupling between classes</span></h3>
<p><span class="koboSpan" id="kobo.345.1">High coupling</span><a id="_idIndexMarker031"/><span class="koboSpan" id="kobo.346.1"> describes where one</span><a id="_idIndexMarker032"/><span class="koboSpan" id="kobo.347.1"> class needs to connect to several others before it can be used. </span><span class="koboSpan" id="kobo.347.2">This makes it difficult to use in isolation. </span><span class="koboSpan" id="kobo.347.3">We need those supporting classes to be set up and working correctly before we can use our class. </span><span class="koboSpan" id="kobo.347.4">For the same reason, we cannot fully understand that class without understanding the many interactions it has. </span><span class="koboSpan" id="kobo.347.5">As an example, the following UML class diagram shows classes with a high degree of coupling between </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">each other:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<span class="koboSpan" id="kobo.349.1"><img alt="Figure 1.3 – High coupling" src="image/Figure_1.3_B18384.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.350.1">Figure 1.3 – High coupling</span></p>
<p><span class="koboSpan" id="kobo.351.1">In this fictitious example of a sales tracking system, several of the classes need to interact with each other. </span><span class="koboSpan" id="kobo.351.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.352.1">User</span></strong><span class="koboSpan" id="kobo.353.1"> class in the middle couples to four other classes: </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">Inventory</span></strong><span class="koboSpan" id="kobo.355.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">EmailService</span></strong><span class="koboSpan" id="kobo.357.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.358.1">SalesAppointment</span></strong><span class="koboSpan" id="kobo.359.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">SalesReport</span></strong><span class="koboSpan" id="kobo.361.1">. </span><span class="koboSpan" id="kobo.361.2">This makes it harder to use and test than a class that couples to fewer other classes. </span><span class="koboSpan" id="kobo.361.3">Is the coupling here too high? </span><span class="koboSpan" id="kobo.361.4">Maybe not, but we can imagine other designs that would reduce it. </span><span class="koboSpan" id="kobo.361.5">The main thing is to be aware of the degree of coupling that classes have in our designs. </span><span class="koboSpan" id="kobo.361.6">As soon as we spot classes with many connections to others, we know we are going to have a problem understanding, maintaining, and </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">testing them.</span></span></p>
<p><span class="koboSpan" id="kobo.363.1">We’ve seen how the technical elements of high coupling and low cohesion make our code difficult to work with, but there is a social aspect to bad code as well. </span><span class="koboSpan" id="kobo.363.2">Let’s consider the effect bad code</span><a id="_idTextAnchor031"/><span class="koboSpan" id="kobo.364.1"> has on the </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">development team.</span></span></p>
<h1 id="_idParaDest-25"><a id="_idTextAnchor032"/><span class="koboSpan" id="kobo.366.1">Decreasing team performance</span></h1>
<p><span class="koboSpan" id="kobo.367.1">A good way </span><a id="_idIndexMarker033"/><span class="koboSpan" id="kobo.368.1">to look at bad code is code lacking the technical practices that help other developers understand what it </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">is doing.</span></span></p>
<p><span class="koboSpan" id="kobo.370.1">When you’re coding solo, it doesn’t matter so much. </span><span class="koboSpan" id="kobo.370.2">Bad code will just slow you down and feel a little demoralizing at times. </span><span class="koboSpan" id="kobo.370.3">It does not affect anybody else. </span><span class="koboSpan" id="kobo.370.4">However, most professionals code in development teams, which is a whole different ball game. </span><span class="koboSpan" id="kobo.370.5">Bad code really slows a </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">team down.</span></span></p>
<p><span class="koboSpan" id="kobo.372.1">The following two studies are interesting as far as this </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">is concerned:</span></span></p>
<ul>
<li><a href="https://dl.acm.org/doi/abs/10.1145/3194164.3194178"><span class="No-Break"><span class="koboSpan" id="kobo.374.1">https://dl.acm.org/doi/abs/10.1145/3194164.3194178</span></span></a></li>
<li><a href="https://www.sciencedirect.com/science/article/abs/pii/S0164121219301335"><span class="No-Break"><span class="koboSpan" id="kobo.375.1">https://www.sciencedirect.com/science/article/abs/pii/S0164121219301335</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.376.1">The first </span><a id="_idIndexMarker034"/><span class="koboSpan" id="kobo.377.1">study shows that developers waste up to 23% of their time on bad code. </span><span class="koboSpan" id="kobo.377.2">The second study shows that in 25% of cases of working with bad code, developers are forced to increase the amount of bad code still further. </span><span class="koboSpan" id="kobo.377.3">In these two studies, the</span><a id="_idIndexMarker035"/><span class="koboSpan" id="kobo.378.1"> term </span><strong class="bold"><span class="koboSpan" id="kobo.379.1">technical debt</span></strong><span class="koboSpan" id="kobo.380.1"> is used, rather than referring to bad code. </span><span class="koboSpan" id="kobo.380.2">There is a difference in intention between the two terms. </span><span class="koboSpan" id="kobo.380.3">Technical debt is code that is shipped with known technical deficiencies in order to meet a deadline. </span><span class="koboSpan" id="kobo.380.4">It is tracked and managed with the intention that it will later be replaced. </span><span class="koboSpan" id="kobo.380.5">Bad code might have the same defects, but it lacks the redeeming quality </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">of intentionality.</span></span></p>
<p><span class="koboSpan" id="kobo.382.1">It is all too easy to check in code that has been easy to write but will be hard to read. </span><span class="koboSpan" id="kobo.382.2">When I do that, I have effectively placed a tax on the team. </span><span class="koboSpan" id="kobo.382.3">The next developer to pull my changes will have to figure out what on earth they need to do and my bad code will have made that </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">much harder.</span></span></p>
<p><span class="koboSpan" id="kobo.384.1">We’ve all been there. </span><span class="koboSpan" id="kobo.384.2">We start a piece of work, download the latest code, and then just stare at our screens for ages. </span><span class="koboSpan" id="kobo.384.3">We see variable names that make no sense, mixed up with tangled code that really does not explain itself very well at all. </span><span class="koboSpan" id="kobo.384.4">It’s frustrating for us personally, but it has a real cost in a programming business. </span><span class="koboSpan" id="kobo.384.5">Every minute we spend not understanding code is a minute where money is being spent on us achieving nothing. </span><span class="koboSpan" id="kobo.384.6">It’s not what we dreamed of when we signed up to be </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">a developer.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">Bad code disrupts every future developer who has to read the code, even us, the original authors. </span><span class="koboSpan" id="kobo.386.2">We forget what we previously meant. </span><span class="koboSpan" id="kobo.386.3">Bad code means more time spent by developers fixing mistakes, instead of adding value. </span><span class="koboSpan" id="kobo.386.4">It means more time is lost on fixing bugs in production that should have been </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">easily preventable.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">Worse still, this problem compounds. </span><span class="koboSpan" id="kobo.388.2">It is like interest on a bank loan. </span><span class="koboSpan" id="kobo.388.3">If we leave bad code in place, the next feature will involve adding workarounds for the bad code. </span><span class="koboSpan" id="kobo.388.4">You may see extra conditionals appear, giving the code yet more execution paths and creating more places for bugs to hide. </span><span class="koboSpan" id="kobo.388.5">Future features build on top of the original bad code and all of its workarounds. </span><span class="koboSpan" id="kobo.388.6">It creates code where most of what we read is simply working around what never worked well in the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">first place.</span></span></p>
<p><span class="koboSpan" id="kobo.390.1">Code of this kind </span><a id="_idIndexMarker036"/><span class="koboSpan" id="kobo.391.1">drains the motivation out of developers. </span><span class="koboSpan" id="kobo.391.2">The team starts spending more time working around problems than they spend adding value to the code. </span><span class="koboSpan" id="kobo.391.3">None of this is </span><em class="italic"><span class="koboSpan" id="kobo.392.1">fun</span></em><span class="koboSpan" id="kobo.393.1"> for the typical developer. </span><span class="koboSpan" id="kobo.393.2">It’s not fun for anybody on </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">the team.</span></span></p>
<p><span class="koboSpan" id="kobo.395.1">Project managers lose track of the project status. </span><span class="koboSpan" id="kobo.395.2">Stakeholders lose confidence in the team’s ability to deliver. </span><span class="koboSpan" id="kobo.395.3">Costs overrun. </span><span class="koboSpan" id="kobo.395.4">Deadlines slip. </span><span class="koboSpan" id="kobo.395.5">Features get quietly cut, just to claw back a little slack in the schedule. </span><span class="koboSpan" id="kobo.395.6">Onboarding new developers becomes painful, to the point of awkwardness, whenever they see the </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">awful code.</span></span></p>
<p><span class="koboSpan" id="kobo.397.1">Bad code leaves the whole team unable to perform to the level they are capable of. </span><span class="koboSpan" id="kobo.397.2">This, in turn, does not make for a happy development team. </span><span class="koboSpan" id="kobo.397.3">Beyond unhappy developers, it also negatively impacts business outcomes. </span><span class="koboSpan" id="kobo.397.4">Let</span><a id="_idTextAnchor033"/><span class="koboSpan" id="kobo.398.1">’s understand </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">those consequences.</span></span></p>
<h1 id="_idParaDest-26"><a id="_idTextAnchor034"/><span class="koboSpan" id="kobo.400.1">Diminishing business outcomes</span></h1>
<p><span class="koboSpan" id="kobo.401.1">It’s not</span><a id="_idIndexMarker037"/><span class="koboSpan" id="kobo.402.1"> just the development team who suffers from the effects of bad code. </span><span class="koboSpan" id="kobo.402.2">It’s bad for the </span><span class="No-Break"><span class="koboSpan" id="kobo.403.1">entire business.</span></span></p>
<p><span class="koboSpan" id="kobo.404.1">Our poor users end up paying for software that doesn’t work, or at least that doesn’t work properly. </span><span class="koboSpan" id="kobo.404.2">There are many ways that bad code can mess up a user’s day, whether as a result of lost data, unresponsive user interfaces, or any kind of intermittent fault. </span><span class="koboSpan" id="kobo.404.3">Each one of these can be caused by something as trivial as setting a variable at the wrong time or an off-by-one error in a </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">conditional somewhere.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">The users see neither any of that nor the thousands of lines of code that we got right. </span><span class="koboSpan" id="kobo.406.2">They just see their missed payment, their lost document that took 2 hours to type, or that fantastic </span><em class="italic"><span class="koboSpan" id="kobo.407.1">last-chance</span></em><span class="koboSpan" id="kobo.408.1"> ticket deal that simply never happened. </span><span class="koboSpan" id="kobo.408.2">Users have little patience for things like this. </span><span class="koboSpan" id="kobo.408.3">Defects of this kind can easily lose us a </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">valuable customer.</span></span></p>
<p><span class="koboSpan" id="kobo.410.1">If we are lucky, users will fill out a bug report. </span><span class="koboSpan" id="kobo.410.2">If we are really lucky, they will let us know what they were doing at the time and provide us with the right steps to reproduce the fault. </span><span class="koboSpan" id="kobo.410.3">But most users will just hit delete on our app. </span><span class="koboSpan" id="kobo.410.4">They’ll cancel future subscriptions and ask for refunds. </span><span class="koboSpan" id="kobo.410.5">They’ll go to review sites and let the world know just how useless our app and </span><span class="No-Break"><span class="koboSpan" id="kobo.411.1">company are.</span></span></p>
<p><span class="koboSpan" id="kobo.412.1">At this point, it isn’t merely bad code; it is a commercial liability. </span><span class="koboSpan" id="kobo.412.2">The failures and honest human errors in our code base are long forgotten. </span><span class="koboSpan" id="kobo.412.3">Instead, we were just a competitor business that came and went in a blaze </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">of negativity.</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">Decreased revenue leads to decreased </span><a id="_idIndexMarker038"/><span class="koboSpan" id="kobo.415.1">market share, a reduced </span><strong class="bold"><span class="koboSpan" id="kobo.416.1">Net Promoter Score®™</span></strong><span class="koboSpan" id="kobo.417.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.418.1">NPS</span></strong><span class="koboSpan" id="kobo.419.1">), disappointed shareholders, and all the other things that make your C-suite lose sleep at night. </span><span class="koboSpan" id="kobo.419.2">Our bad code has become a problem at the </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">business level.</span></span></p>
<p><span class="koboSpan" id="kobo.421.1">This isn’t hypothetical. </span><span class="koboSpan" id="kobo.421.2">There </span><a id="_idIndexMarker039"/><span class="koboSpan" id="kobo.422.1">have been several incidents where software failures have cost the business. </span><span class="koboSpan" id="kobo.422.2">Security breaches for Equifax, Target, and even the Ashley Madison site all resulted in losses. </span><span class="koboSpan" id="kobo.422.3">The Ariane rocket resulted in the loss of both spacecraft and satellite payload, a total cost of billions of dollars! </span><span class="koboSpan" id="kobo.422.4">Even minor incidents resulting in downtime for e-commerce systems can soon have costs mounting, while consumer trust </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">crashes down.</span></span></p>
<p><span class="koboSpan" id="kobo.424.1">In each case, the failures may have been small errors in comparatively few lines of code. </span><span class="koboSpan" id="kobo.424.2">Certainly, they will have been avoidable in some way. </span><span class="koboSpan" id="kobo.424.3">We know that humans make mistakes, and that all software is built by humans, yet a little extra help may have been all it would have taken to stop these disasters </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">from unfolding.</span></span></p>
<p><span class="koboSpan" id="kobo.426.1">The advantage of finding failures early is shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">following diagram:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<span class="koboSpan" id="kobo.428.1"><img alt="Figure 1.4 – Costs of defect discovery" src="image/Figure_1.4_B18384.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.429.1">Figure 1.4 – Costs of defect discovery</span></p>
<p><span class="koboSpan" id="kobo.430.1">In the </span><a id="_idIndexMarker040"/><span class="koboSpan" id="kobo.431.1">previous figure, the cost of the repair of a defect gets higher the later it </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">is found:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.433.1">Found by a failing test </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">before code:</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.435.1">The cheapest and fastest way to discover a defect is by writing a test for a feature before we write the production code. </span><span class="koboSpan" id="kobo.435.2">If we write the production code that we expect should make the test pass, but instead the test fails, we know there is a problem in </span><span class="No-Break"><span class="koboSpan" id="kobo.436.1">our code.</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.437.1">Found by a failing test </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">after code:</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.439.1">If we write the production code for a feature, and then write a test afterward, we may find defects in our production code. </span><span class="koboSpan" id="kobo.439.2">This happens a little later in the development cycle. </span><span class="koboSpan" id="kobo.439.3">We will have wasted a little more time before discovering </span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">the defect.</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.441.1">Found during </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">manual QA:</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.443.1">Many teams</span><a id="_idIndexMarker041"/><span class="koboSpan" id="kobo.444.1"> include </span><strong class="bold"><span class="koboSpan" id="kobo.445.1">Quality Assurance (QA)</span></strong><span class="koboSpan" id="kobo.446.1"> engineers. </span><span class="koboSpan" id="kobo.446.2">After code has been written by a developer, the QA engineer will manually test the code. </span><span class="koboSpan" id="kobo.446.3">If a defect is found here, this means significant time has passed since the developer first wrote the code. </span><span class="koboSpan" id="kobo.446.4">Rework will have to </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">be done.</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.448.1">Found by the end user once code is </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">in production:</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.450.1">This is as bad as it gets. </span><span class="koboSpan" id="kobo.450.2">The code has been shipped to production and end users are using it. </span><span class="koboSpan" id="kobo.450.3">An end user finds a bug. </span><span class="koboSpan" id="kobo.450.4">The bug has to be reported, triaged, a fix scheduled for development, then retested by QA then redeployed to production. </span><span class="koboSpan" id="kobo.450.5">This is the slowest and most expensive path to discovering </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">a defect.</span></span></p>
<p><span class="koboSpan" id="kobo.452.1">The earlier</span><a id="_idIndexMarker042"/><span class="koboSpan" id="kobo.453.1"> we find the fault, the less time and money we will have to spend on correcting it. </span><span class="koboSpan" id="kobo.453.2">The ideal is to have a failing test before we even write a line of code. </span><span class="koboSpan" id="kobo.453.3">This approach also helps us design our code. </span><span class="koboSpan" id="kobo.453.4">The later we leave it to find a mistake, the more trouble it causes </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">for everyone.</span></span></p>
<p><span class="koboSpan" id="kobo.455.1">We’ve seen how low-quality code gives rise to defects and is bad for business. </span><span class="koboSpan" id="kobo.455.2">The earlier we detect failures, the better it is for us. </span><span class="koboSpan" id="kobo.455.3">Leaving defects in production code is both difficult and </span><a id="_idIndexMarker043"/><span class="koboSpan" id="kobo.456.1">expensive to fix, and negatively affects our </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">business reputation.</span></span></p>
<h1 id="_idParaDest-27"><a id="_idTextAnchor035"/><span class="koboSpan" id="kobo.458.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.459.1">We can now recognize bad code from its technical signs and appreciate the problems that it causes for both development teams and </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">business outcomes.</span></span></p>
<p><span class="koboSpan" id="kobo.461.1">What we need is a technique to help us avoid these problems. </span><span class="koboSpan" id="kobo.461.2">In the next chapter, we’ll take a look at how TDD helps us deliver clean, correct code that is a true </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">business asset.</span></span></p>
<h1 id="_idParaDest-28"><a id="_idTextAnchor036"/><span class="koboSpan" id="kobo.463.1">Questions and answers</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.464.1">Isn’t it enough to have </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">working code?</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.466.1">Sadly not. </span><span class="koboSpan" id="kobo.466.2">Code that meets user needs is an entry-level step with professional software. </span><span class="koboSpan" id="kobo.466.3">We also need code that we </span><em class="italic"><span class="koboSpan" id="kobo.467.1">know</span></em><span class="koboSpan" id="kobo.468.1"> works, and that the team can easily understand </span><span class="No-Break"><span class="koboSpan" id="kobo.469.1">and modify.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.470.1">Users don’t see the code. </span><span class="koboSpan" id="kobo.470.2">Why does it matter </span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">to them?</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.472.1">This is true. </span><span class="koboSpan" id="kobo.472.2">However, users expect things to work reliably, and they expect our software to be updated and improved continuously. </span><span class="koboSpan" id="kobo.472.3">This is only possible when the developers can work safely with the </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">existing code.</span></span></p>
<ol>
<li value="3"><span class="koboSpan" id="kobo.474.1">Is it easier to write good code or </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">bad code?</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.476.1">It is much harder to write good code, unfortunately. </span><span class="koboSpan" id="kobo.476.2">Good code does more than simply work correctly. </span><span class="koboSpan" id="kobo.476.3">It must also be easy to read, easy to change, and safe for our colleagues to work with. </span><span class="koboSpan" id="kobo.476.4">That’s why techniques such as TDD have an important role to play. </span><span class="koboSpan" id="kobo.476.5">We need all the help we can get to write clean code that helps </span><span class="No-Break"><span class="koboSpan" id="kobo.477.1">our colleagues.</span></span></p>
<h1 id="_idParaDest-29"><a id="_idTextAnchor037"/><span class="koboSpan" id="kobo.478.1">Further reading</span></h1>
<ul>
<li><span class="koboSpan" id="kobo.479.1">More about the loss of the Ariane </span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">rocket: </span></span><a href="https://www.esa.int/Newsroom/Press_Releases/Ariane_501_-_Presentation_of_Inquiry_Board_report"><span class="No-Break"><span class="koboSpan" id="kobo.481.1">https://www.esa.int/Newsroom/Press_Releases/Ariane_501_-_Presentation_of_Inquiry_Board_report</span></span></a></li>
</ul>
</div>
<div>
<div class="IMG---Figure" id="_idContainer015">
</div>
</div>
</body></html>