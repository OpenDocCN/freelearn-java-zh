<html><head></head><body>
  <div id="_idContainer059">
   <h1 class="chapterNumber">
    <a id="_idTextAnchor116">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     5
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-108">
    <a id="_idTextAnchor117">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Managing API Evolution
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3.1">
     Updating an API is a frequent and necessary process as business requirements evolve and new features are introduced.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     However, it requires careful decision-making to avoid breaking existing client integrations.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     Even small changes to an API’s structure, behavior, or response format can have significant impacts on consumers who depend on a stable, predictable interface.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.4.1">
     In this chapter, we will show you how to evolve your APIs while ensuring backward compatibility.
    </span>
    <span class="koboSpan" id="kobo.4.2">
     We will also discuss strategies for versioning APIs in cases when a breaking change is necessary, using the example of our product API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.5.1">
     We will begin the chapter by exploring
    </span>
    <a id="_idIndexMarker271">
    </a>
    <span class="koboSpan" id="kobo.6.1">
     different
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.7.1">
      versioning strategies
     </span>
    </strong>
    <span class="koboSpan" id="kobo.8.1">
     that can be applied to RESTful APIs.
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.9.1">
      Versioning
     </span>
    </strong>
    <span class="koboSpan" id="kobo.10.1">
     is a
    </span>
    <a id="_idIndexMarker272">
    </a>
    <span class="koboSpan" id="kobo.11.1">
     critical aspect of API design, as it ensures that your application can evolve over time without breaking existing client integrations.
    </span>
    <span class="koboSpan" id="kobo.11.2">
     We will examine several versioning techniques, such as URL versioning, query parameter versioning, HTTP header versioning, and content negotiation, while discussing the challenges each approach presents, including maintenance, compatibility, and complexity.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.12.1">
     Next, we’ll take our existing product API and introduce a breaking change, which will require us to implement a versioning strategy.
    </span>
    <span class="koboSpan" id="kobo.12.2">
     By evolving our API, we will ensure that clients using earlier versions remain unaffected while enabling new functionality for those adopting the latest version.
    </span>
    <span class="koboSpan" id="kobo.12.3">
     This process highlights the importance of backward compatibility and minimizing disruption for users, even as the API continues to evolve.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.13.1">
     Finally, we will explore the best practices for managing API evolution over time.
    </span>
    <span class="koboSpan" id="kobo.13.2">
     We will discuss how to gracefully deprecate old versions, effectively communicate changes with clients, and maintain multiple versions of an API without creating unnecessary complexity.
    </span>
    <span class="koboSpan" id="kobo.13.3">
     By the end of this chapter, you will have a solid understanding of how to implement versioning strategies that support long-term growth and stability for your APIs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.14.1">
     In this chapter, we will be covering the following topics:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.15.1">
      Versioning strategies
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.16.1">
      Implementing versioning in the product API
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.17.1">
      Managing API evolution
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-109">
    <a id="_idTextAnchor118">
    </a>
    <span class="koboSpan" id="kobo.18.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.19.1">
     In this chapter, we will evolve our product API.
    </span>
    <span class="koboSpan" id="kobo.19.2">
     To be able to follow along and use the code examples as they are printed in the book, you should have the product API code that was created in
    </span>
    <a href="B21843_02.xhtml#_idTextAnchor050">
     <em class="italic">
      <span class="koboSpan" id="kobo.20.1">
       Chapter 2
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.21.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.22.1">
     You can access the code for this chapter on GitHub at
    </span>
    <a href="https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter5">
     <span class="url">
      <span class="koboSpan" id="kobo.23.1">
       https://github.com/PacktPublishing/ Mastering-RESTful-Web-Services-with-Java/tree/main/chapter5
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.24.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-110">
    <a id="_idTextAnchor119">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     Versioning strategies
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.26.1">
     Versioning
    </span>
    <a id="_idIndexMarker273">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     refers to the practice of managing changes in an application over time by assigning distinct version numbers to different stages of the API’s life cycle.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     It ensures that updates to an API—such as new features or breaking changes—can be introduced without disrupting existing clients that rely on earlier versions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.28.1">
     Versioning became
    </span>
    <a id="_idIndexMarker274">
    </a>
    <span class="koboSpan" id="kobo.29.1">
     critical for REST APIs as the architecture of software systems shifted from monolithic to distributed systems.
    </span>
    <span class="koboSpan" id="kobo.29.2">
     In monolithic architectures, where the consumer and provider of a service typically reside within the same application, there is direct control over both ends of the communication.
    </span>
    <span class="koboSpan" id="kobo.29.3">
     When changes are made, they are applied uniformly across the entire system, ensuring that the consumer is always in sync with the provider.
    </span>
    <span class="koboSpan" id="kobo.29.4">
     Hence, the versioning of interfaces within a monolithic application is not necessary because the consumers are tightly coupled with the providers, and updates are deployed simultaneously without causing compatibility issues.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.30.1">
     However, with the rise of distributed systems and the adoption of REST APIs, which serve multiple independent clients (such as web browsers, mobile apps, and third-party services), the situation changed dramatically.
    </span>
    <span class="koboSpan" id="kobo.30.2">
     REST APIs expose services to the outside world, where different clients may use different versions of the API simultaneously.
    </span>
    <span class="koboSpan" id="kobo.30.3">
     This introduces a challenge—how do you update the API to introduce new features or fix issues without breaking functionality for existing clients?
    </span>
    <span class="koboSpan" id="kobo.30.4">
     Versioning solves this by allowing multiple versions of the API to coexist, ensuring backward compatibility, and enabling the API to evolve over time while still supporting older clients.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.31.1">
     Let’s see how we can apply versioning strategies to solve this problem.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.32.1">
     Before exploring
    </span>
    <a id="_idIndexMarker275">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     versioning strategies, it’s essential to distinguish between backward-compatible changes and breaking changes.
    </span>
    <span class="koboSpan" id="kobo.33.2">
     Understanding this distinction is crucial because, for breaking changes, updating the API version is necessary to ensure existing clients can continue to use the API smoothly.
    </span>
   </p>
   <p class="normal">
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.34.1">
      Breaking changes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.35.1">
     are modifications
    </span>
    <a id="_idIndexMarker276">
    </a>
    <span class="koboSpan" id="kobo.36.1">
     that disrupt existing client interactions with the API.
    </span>
    <span class="koboSpan" id="kobo.36.2">
     These changes typically necessitate a new API version to prevent breaking current integrations.
    </span>
    <span class="koboSpan" id="kobo.36.3">
     These
    </span>
    <a id="_idIndexMarker277">
    </a>
    <span class="koboSpan" id="kobo.37.1">
     are some examples of breaking changes:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.38.1">
       Removing an endpoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.39.1">
      : Deleting an existing API endpoint that clients rely on
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.40.1">
       Changing response data structure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.41.1">
      : Altering the format of response data, such as renaming or removing fields in the JSON response
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.42.1">
       Modifying required parameters
      </span>
     </strong>
     <span class="koboSpan" id="kobo.43.1">
      : Changing required parameters for an endpoint, which could cause existing requests to fail
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.44.1">
       Altering authentication methods
      </span>
     </strong>
     <span class="koboSpan" id="kobo.45.1">
      : Changing or removing existing authentication mechanisms or security protocols
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.46.1">
       Changing endpoint behavior
      </span>
     </strong>
     <span class="koboSpan" id="kobo.47.1">
      : Modifying the behavior of an endpoint so that it no longer performs as it did previously
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.48.1">
     In
    </span>
    <a id="_idIndexMarker278">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     contrast,
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.50.1">
      backward-compatible changes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.51.1">
     enhance or extend the API without disrupting existing clients.
    </span>
    <span class="koboSpan" id="kobo.51.2">
     Here are some examples:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.52.1">
       Adding new optional fields
      </span>
     </strong>
     <span class="koboSpan" id="kobo.53.1">
      : Introducing new fields to the response payload that are not required for existing clients
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.54.1">
       Adding new endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.55.1">
      : Creating new API endpoints that provide additional functionality without affecting existing ones
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.56.1">
       Extending response data
      </span>
     </strong>
     <span class="koboSpan" id="kobo.57.1">
      : Adding extra information to the response data that does not alter the existing structure
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.58.1">
       Adding new query parameters
      </span>
     </strong>
     <span class="koboSpan" id="kobo.59.1">
      : Introducing optional query parameters to existing endpoints that offer additional filtering or functionality
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.60.1">
       Enhancing documentation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.61.1">
      : Improving or expanding API documentation to provide more
     </span>
     <a id="_idIndexMarker279">
     </a>
     <span class="koboSpan" id="kobo.62.1">
      details without altering the API itself
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.63.1">
     Now that we understand the need for using versioning for breaking changes, let’s explore various versioning strategies, along with their advantages and disadvantages.
    </span>
    <span class="koboSpan" id="kobo.63.2">
     The most common strategies include the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.64.1">
      URL path versioning
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.65.1">
      Query parameter versioning
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.66.1">
      HTTP header versioning
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.67.1">
      Content negotiation
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.68.1">
     Let’s go deep into each versioning strategy and understand when to use one instead of the other.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-111">
    <a id="_idTextAnchor120">
    </a>
    <span class="koboSpan" id="kobo.69.1">
     URL path versioning
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.70.1">
     URL path versioning
    </span>
    <a id="_idIndexMarker280">
    </a>
    <span class="koboSpan" id="kobo.71.1">
     is one of the most common
    </span>
    <a id="_idIndexMarker281">
    </a>
    <span class="koboSpan" id="kobo.72.1">
     and straightforward strategies for versioning REST APIs.
    </span>
    <span class="koboSpan" id="kobo.72.2">
     This strategy is used by many companies, such as X, Google, GitLab, and others.
    </span>
    <span class="koboSpan" id="kobo.72.3">
     In this strategy, the version number is included directly within the API’s URL path, such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.73.1">
      https://api.product.com/v1/products.
     </span>
    </code>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.74.1">
     This approach makes it easy for both developers and clients to identify and access specific versions of an API without any ambiguity.
    </span>
    <span class="koboSpan" id="kobo.74.2">
     By embedding the version number in the URL path, API consumers have a clear and explicit way of requesting the desired version, ensuring that any integration remains stable even as the API evolves.
    </span>
    <span class="koboSpan" id="kobo.74.3">
     Additionally, the server can easily route incoming requests to the correct version of the code base, simplifying maintenance and deployment.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.75.1">
     URL path versioning provides several clear advantages for API management.
    </span>
    <span class="koboSpan" id="kobo.75.2">
     One of its primary benefits is that version numbers are directly visible in the URI, making it immediately clear which version of the API is being accessed.
    </span>
    <span class="koboSpan" id="kobo.75.3">
     Additionally, URL versioning integrates well with HTTP caching mechanisms, as different versions of the API are treated as distinct resources, allowing for the effective and independent caching of each version.
    </span>
    <span class="koboSpan" id="kobo.75.4">
     It also facilitates bookmarking and sharing, enabling users to save and reference specific versions of endpoints easily, ensuring consistency in interactions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.76.1">
     However, URL versioning also presents certain drawbacks.
    </span>
    <span class="koboSpan" id="kobo.76.2">
     Over time, maintaining multiple versions can lead to cluttered URIs, especially if multiple versions of the API are maintained simultaneously.
    </span>
    <span class="koboSpan" id="kobo.76.3">
     Moreover, once a version is embedded in the URL path, it becomes part of the API’s public contract.
    </span>
    <span class="koboSpan" id="kobo.76.4">
     Furthermore, the overhead associated with managing numerous URLs can increase complexity in both development and documentation processes.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.77.1">
     When
    </span>
    <a id="_idIndexMarker282">
    </a>
    <span class="koboSpan" id="kobo.78.1">
     implementing a new feature, breaking changes typically affect only a few specific endpoints, not the entire API.
    </span>
    <span class="koboSpan" id="kobo.78.2">
     If you update the version number
    </span>
    <a id="_idIndexMarker283">
    </a>
    <span class="koboSpan" id="kobo.79.1">
     for endpoints that haven’t changed, it can create unnecessary confusion for both clients and maintainers.
    </span>
    <span class="koboSpan" id="kobo.79.2">
     This approach makes it harder to understand how different versions of various endpoints should be used together, potentially complicating the integration process and hindering overall API clarity.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.80.1">
     Using URL paths for versioning is well-suited for many scenarios, particularly when clear and explicit versioning is crucial.
    </span>
    <span class="koboSpan" id="kobo.80.2">
     It is an excellent choice for APIs that are stable, with minimal expected changes that could introduce breaking modifications.
    </span>
    <span class="koboSpan" id="kobo.80.3">
     URL path versioning provides a straightforward approach to managing different versions, making it easier to track and maintain the API as it evolves.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-112">
    <a id="_idTextAnchor121">
    </a>
    <span class="koboSpan" id="kobo.81.1">
     Query parameter versioning
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.82.1">
     Query parameter versioning
    </span>
    <a id="_idIndexMarker284">
    </a>
    <span class="koboSpan" id="kobo.83.1">
     involves specifying the
    </span>
    <a id="_idIndexMarker285">
    </a>
    <span class="koboSpan" id="kobo.84.1">
     API version as a query parameter in the URL, such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.85.1">
      https://api.product.com/products?version=1
     </span>
    </code>
    <span class="koboSpan" id="kobo.86.1">
     .
    </span>
    <span class="koboSpan" id="kobo.86.2">
     This approach is commonly recommended in Microsoft’s guidelines.
    </span>
    <span class="koboSpan" id="kobo.86.3">
     This strategy makes it easier to implement and introduce new versions without modifying URL paths.
    </span>
    <span class="koboSpan" id="kobo.86.4">
     This can be particularly useful when you want to maintain a consistent endpoint path structure while still providing version-specific functionality.
    </span>
    <span class="koboSpan" id="kobo.86.5">
     It also allows versioning without creating a proliferation of URL paths.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.87.1">
     However, it has some drawbacks.
    </span>
    <span class="koboSpan" id="kobo.87.2">
     Clients must include the version parameter with every request, which adds an extra step in request construction.
    </span>
    <span class="koboSpan" id="kobo.87.3">
     Additionally, the API server must handle versioning logic based on query parameters, potentially complicating implementation and increasing processing overhead.
    </span>
    <span class="koboSpan" id="kobo.87.4">
     Furthermore, the version information is less visible in the URL, making it harder to quickly identify which version is being accessed.
    </span>
    <span class="koboSpan" id="kobo.87.5">
     This lack of clarity can cause confusion, especially when the versioning affects critical parts of the API’s functionality.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.88.1">
     Another concern is how query parameter versioning interacts with caching.
    </span>
    <span class="koboSpan" id="kobo.88.2">
     Since the version is embedded in the query string rather than the URL path, caching mechanisms may not handle it as effectively.
    </span>
    <span class="koboSpan" id="kobo.88.3">
     This can lead to complications in how different versions of the API are cached, potentially impacting performance and efficiency for clients who rely on caching to improve response times.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-113">
    <a id="_idTextAnchor122">
    </a>
    <span class="koboSpan" id="kobo.89.1">
     HTTP header versioning
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.90.1">
     HTTP header versioning
    </span>
    <a id="_idIndexMarker286">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     involves specifying
    </span>
    <a id="_idIndexMarker287">
    </a>
    <span class="koboSpan" id="kobo.92.1">
     the API version in the HTTP headers of a request.
    </span>
    <span class="koboSpan" id="kobo.92.2">
     This approach allows clients to indicate which version of the API they wish to use by including a custom header, such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.93.1">
      X-API-Version
     </span>
    </code>
    <span class="koboSpan" id="kobo.94.1">
     , in their requests.
    </span>
    <span class="koboSpan" id="kobo.94.2">
     GitHub is an example of an application that uses the HTTP header:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.95.1">curl --header "X-GitHub-Api-Version:2022-11-28" https://api.github.com/zen
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.96.1">
     This strategy keeps the URL clean and avoids cluttering it with versioning information.
    </span>
    <span class="koboSpan" id="kobo.96.2">
     It also provides a flexible and less intrusive way to manage versions, as it does not alter the endpoint paths or query strings.
    </span>
    <span class="koboSpan" id="kobo.96.3">
     Additionally, HTTP header versioning can facilitate smoother transitions between versions since the versioning information is separated from the URL being the resource identifier, reducing the risk associated with breaking changes for clients.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.97.1">
     However, HTTP header versioning presents some challenges.
    </span>
    <span class="koboSpan" id="kobo.97.2">
     Unlike URL versioning, the versioning information is not immediately visible in the URL, which can make debugging and documentation more complex.
    </span>
    <span class="koboSpan" id="kobo.97.3">
     This lack of visibility can hinder developers and clients when troubleshooting issues or understanding API versions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.98.1">
     Additionally, custom headers can lead to inconsistent implementation practices across different APIs.
    </span>
    <span class="koboSpan" id="kobo.98.2">
     When APIs use custom headers, it becomes challenging to establish uniform standards, which can confuse developers and users alike.
    </span>
    <span class="koboSpan" id="kobo.98.3">
     For example, one API might use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.99.1">
      X-Api-Version
     </span>
    </code>
    <span class="koboSpan" id="kobo.100.1">
     while another might use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.101.1">
      X-Version
     </span>
    </code>
    <span class="koboSpan" id="kobo.102.1">
     , leading to ambiguity and potential integration issues.
    </span>
    <span class="koboSpan" id="kobo.102.2">
     The use of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.103.1">
      X-
     </span>
    </code>
    <span class="koboSpan" id="kobo.104.1">
     prefix for custom headers has been deprecated since the introduction of RFC 6648 in 2012.
    </span>
    <span class="koboSpan" id="kobo.104.2">
     As an alternative, the content negotiation strategy leverages existing headers, avoiding the need for custom headers, and ensuring better adherence to standard practices.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-114">
    <a id="_idTextAnchor123">
    </a>
    <span class="koboSpan" id="kobo.105.1">
     Content negotiation
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.106.1">
     Content negotiation
    </span>
    <a id="_idIndexMarker288">
    </a>
    <span class="koboSpan" id="kobo.107.1">
     is one of the techniques
    </span>
    <a id="_idIndexMarker289">
    </a>
    <span class="koboSpan" id="kobo.108.1">
     used to handle versioning in RESTful APIs, allowing clients to specify the API version via HTTP headers rather than through the URL path.
    </span>
    <span class="koboSpan" id="kobo.108.2">
     The idea is to let the client request a particular version of the API by sending a specific
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.109.1">
      Accept
     </span>
    </code>
    <span class="koboSpan" id="kobo.110.1">
     header.
    </span>
    <span class="koboSpan" id="kobo.110.2">
     For example, a client might request version 1 of the API in JSON format by sending the following request:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.111.1">curl -X GET https://api.myproduct.com/resource \ -H "Accept: application/vnd.myapi.v1+json"
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.112.1">
     This technique of API versioning via content negotiation is closely related to HTTP header versioning, as both strategies rely on HTTP headers to specify the version.
    </span>
    <span class="koboSpan" id="kobo.112.2">
     The key difference is that content
    </span>
    <a id="_idIndexMarker290">
    </a>
    <span class="koboSpan" id="kobo.113.1">
     negotiation avoids creating custom HTTP headers, adhering to RFC 6648, which discourages custom headers.
    </span>
    <span class="koboSpan" id="kobo.113.2">
     Instead, this method uses
    </span>
    <a id="_idIndexMarker291">
    </a>
    <span class="koboSpan" id="kobo.114.1">
     standard headers such as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.115.1">
      Accept
     </span>
    </code>
    <span class="koboSpan" id="kobo.116.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.117.1">
      Content-Type
     </span>
    </code>
    <span class="koboSpan" id="kobo.118.1">
     to specify both the format and version of the response, promoting a cleaner and more standardized approach.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.119.1">
     This strategy is widely adopted by large organizations such as Adidas and Mambu.
    </span>
    <span class="koboSpan" id="kobo.119.2">
     The content negotiation strategy is aligned with the REST standard in that it follows the principle of content negotiation, where the client and server agree on the representation format and version via headers, keeping the interface flexible and compliant with RESTful best practices.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.120.1">
     Since our API is already implemented, we will adopt a content negotiation strategy to enable seamless evolution, allowing new features to be introduced without disrupting existing clients or causing breaking changes.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-115">
    <a id="_idTextAnchor124">
    </a>
    <span class="koboSpan" id="kobo.121.1">
     Implementing versioning in the product API
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.122.1">
     As our
    </span>
    <a id="_idIndexMarker292">
    </a>
    <span class="koboSpan" id="kobo.123.1">
     product API is already in use by other applications, it’s essential to maintain stability while continuing to evolve the API to meet new requirements.
    </span>
    <span class="koboSpan" id="kobo.123.2">
     One of the challenges in API development is balancing the need for enhancements while not disrupting existing consumers.
    </span>
    <span class="koboSpan" id="kobo.123.3">
     In this section, we will explore how to implement versioning in the product API to handle changes without causing breaking issues for clients.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.124.1">
     The
    </span>
    <a id="_idIndexMarker293">
    </a>
    <span class="koboSpan" id="kobo.125.1">
     product API currently returns a complete list of products without pagination.
    </span>
    <span class="koboSpan" id="kobo.125.2">
     To improve performance and scalability, we’ve decided to introduce pagination to the product list response.
    </span>
    <span class="koboSpan" id="kobo.125.3">
     This modification will change the current behavior, potentially disrupting users who rely on the existing output.
    </span>
    <span class="koboSpan" id="kobo.125.4">
     To prevent any impact on their workflows, we will implement a versioning strategy.
    </span>
    <span class="koboSpan" id="kobo.125.5">
     This approach will allow us to support the new paginated format for future clients while maintaining backward compatibility for existing consumers, ensuring that the API can evolve without interrupting service.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.126.1">
     As mentioned previously, we will use the content negotiation strategy to introduce pagination into our product API without breaking the existing functionality.
    </span>
    <span class="koboSpan" id="kobo.126.2">
     This strategy will allow us to evolve the
    </span>
    <a id="_idIndexMarker294">
    </a>
    <span class="koboSpan" id="kobo.127.1">
     API while letting clients specify the version they prefer through request headers.
    </span>
    <span class="koboSpan" id="kobo.127.2">
     By utilizing content negotiation, we can offer both the
    </span>
    <a id="_idIndexMarker295">
    </a>
    <span class="koboSpan" id="kobo.128.1">
     original product list format and the new paginated version, ensuring backward compatibility and giving clients flexibility in how they consume the API.
    </span>
    <span class="koboSpan" id="kobo.128.2">
     This method ensures a smooth transition for existing users while accommodating new requirements.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-116">
    <a id="_idTextAnchor125">
    </a>
    <span class="koboSpan" id="kobo.129.1">
     Updating our product API
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.130.1">
     Let’s
    </span>
    <a id="_idIndexMarker296">
    </a>
    <span class="koboSpan" id="kobo.131.1">
     enhance our API by adding new functionality to our list endpoint while maintaining backward compatibility.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.132.1">
     In our current API, we have the following code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.133.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.134.1">GetMapping</span></span><span class="koboSpan" id="kobo.135.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.136.1">Override</span></span><span class="koboSpan" id="kobo.137.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.138.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.139.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.140.1">List</span></span><span class="koboSpan" id="kobo.141.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.142.1">ProductOutput</span></span><span class="koboSpan" id="kobo.143.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.144.1">getProducts</span></span><span class="koboSpan" id="kobo.145.1">() {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.146.1">var</span></span><span class="koboSpan" id="kobo.147.1"> products = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.148.1">getAllProducts</span></span><span class="koboSpan" id="kobo.149.1">()
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.150.1">stream</span></span><span class="koboSpan" id="kobo.151.1">()
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.152.1">map</span></span><span class="koboSpan" id="kobo.153.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.154.1">productMapper</span></span><span class="koboSpan" id="kobo.155.1">::toProductOutput)
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.156.1">toList</span></span><span class="koboSpan" id="kobo.157.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.158.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.159.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.160.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.161.1">status</span></span><span class="koboSpan" id="kobo.162.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.163.1">HttpStatus</span></span><span class="koboSpan" id="kobo.164.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.165.1">OK</span></span><span class="koboSpan" id="kobo.166.1">)
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.167.1">body</span></span><span class="koboSpan" id="kobo.168.1">(products);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.169.1">
     Let’s create another method to handle version 2 of our API, which will include support for pagination.
    </span>
    <span class="koboSpan" id="kobo.169.2">
     To achieve this, we’ll add two
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.170.1">
      RequestParam
     </span>
    </code>
    <span class="koboSpan" id="kobo.171.1">
     annotations: one to specify the current page and another to define the limit of the number of results per page.
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.172.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.173.1">
       Design strategy to prevent backward-incompatible changes
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.174.1">
      Adding pagination in our example cannot be done without a breaking change because the response is a JSON array of the products, so there is no place for pagination information that is common for all products returned (the total number of pages).
     </span>
     <span class="koboSpan" id="kobo.174.2">
      A trick to prevent this situation is, instead of using a JSON array at the top level, to wrap the list (JSON array) in a JSON object even if it would have just one attribute.
     </span>
     <span class="koboSpan" id="kobo.174.3">
      This minimal additional overhead would allow us to evolve the API without introducing a breaking change.
     </span>
     <span class="koboSpan" id="kobo.174.4">
      We would just add optional pagination request parameters, and the pagination information could be added to the object at the root level of the response.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.175.1">
     You can see these
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.176.1">
      RequestParam
     </span>
    </code>
    <span class="koboSpan" id="kobo.177.1">
     annotations in the following code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.178.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.179.1">GetMapping</span></span><span class="koboSpan" id="kobo.180.1">(produces = </span><span class="hljs-string"><span class="koboSpan" id="kobo.181.1">"application/vnd.packt-v2+json"</span></span><span class="koboSpan" id="kobo.182.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.183.1">Override</span></span><span class="koboSpan" id="kobo.184.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.185.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.186.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.187.1">PaginatedProducts</span></span><span class="koboSpan" id="kobo.188.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.189.1">getProductsV2</span></span><span class="koboSpan" id="kobo.190.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.191.1">@RequestParam(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.192.1">    value = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.193.1">"page"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.194.1">, defaultValue = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.195.1">"0"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.196.1">) Integer page, @RequestParam(</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.197.1">    value = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.198.1">"limit"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.199.1">, defaultValue = </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.200.1">"10"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.201.1">) Integer limit</span></span><span class="koboSpan" id="kobo.202.1">) {
        final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.203.1">var</span></span><span class="koboSpan" id="kobo.204.1"> products = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.205.1">getAllProducts</span></span><span class="koboSpan" id="kobo.206.1">(
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.207.1">PageRequest</span></span><span class="koboSpan" id="kobo.208.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.209.1">of</span></span><span class="koboSpan" id="kobo.210.1">(page, limit));
    int totalPages = products.</span><span class="hljs-title"><span class="koboSpan" id="kobo.211.1">getTotalPages</span></span><span class="koboSpan" id="kobo.212.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.213.1">List</span></span><span class="koboSpan" id="kobo.214.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.215.1">ProductOutput</span></span><span class="koboSpan" id="kobo.216.1">&gt; output = products.</span><span class="hljs-title"><span class="koboSpan" id="kobo.217.1">stream</span></span><span class="koboSpan" id="kobo.218.1">()
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.219.1">map</span></span><span class="koboSpan" id="kobo.220.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.221.1">productMapper</span></span><span class="koboSpan" id="kobo.222.1">::toProductOutput)
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.223.1">toList</span></span><span class="koboSpan" id="kobo.224.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.225.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.226.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.227.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.228.1">status</span></span><span class="koboSpan" id="kobo.229.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.230.1">HttpStatus</span></span><span class="koboSpan" id="kobo.231.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.232.1">OK</span></span><span class="koboSpan" id="kobo.233.1">)
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.234.1">body</span></span><span class="koboSpan" id="kobo.235.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.236.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.237.1">PaginatedProducts</span></span><span class="koboSpan" id="kobo.238.1">(totalPages, output));
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.239.1">
     By adding
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.240.1">
      produces = "application/vnd.packt-v2+json"
     </span>
    </code>
    <span class="koboSpan" id="kobo.241.1">
     , we enable Spring to route any request with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.242.1">
      Accept
     </span>
    </code>
    <span class="koboSpan" id="kobo.243.1">
     header set to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.244.1">
      application/vnd.packt-v2+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.245.1">
     to the appropriate endpoint.
    </span>
    <span class="koboSpan" id="kobo.245.2">
     This allows clients
    </span>
    <a id="_idIndexMarker297">
    </a>
    <span class="koboSpan" id="kobo.246.1">
     to receive the response tailored to their version by specifying the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.247.1">
      Accept
     </span>
    </code>
    <span class="koboSpan" id="kobo.248.1">
     header in their API requests.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.249.1">
     We have also updated the API response to return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.250.1">
      PaginatedProducts
     </span>
    </code>
    <span class="koboSpan" id="kobo.251.1">
     class, which now includes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.252.1">
      totalPages
     </span>
    </code>
    <span class="koboSpan" id="kobo.253.1">
     attribute, as we can see in the following code.
    </span>
    <span class="koboSpan" id="kobo.253.2">
     This addition is crucial for the client to determine whether more resources are available or not:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.254.1">public record </span><span class="hljs-title"><span class="koboSpan" id="kobo.255.1">PaginatedProducts</span></span><span class="koboSpan" id="kobo.256.1">(@</span><span class="hljs-title"><span class="koboSpan" id="kobo.257.1">Schema</span></span><span class="koboSpan" id="kobo.258.1">(name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.259.1">"totalPages"</span></span><span class="koboSpan" id="kobo.260.1">,
    example = </span><span class="hljs-string"><span class="koboSpan" id="kobo.261.1">"10"</span></span><span class="koboSpan" id="kobo.262.1">) </span><span class="hljs-title"><span class="koboSpan" id="kobo.263.1">Integer</span></span><span class="koboSpan" id="kobo.264.1"> totalPages, </span><span class="hljs-title"><span class="koboSpan" id="kobo.265.1">List</span></span><span class="koboSpan" id="kobo.266.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.267.1">ProductOutput</span></span><span class="koboSpan" id="kobo.268.1">&gt; products) {}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.269.1">
     We opted to modify the response body to include this information, though other strategies could have been used to achieve the same goal, as we will explore in
    </span>
    <a href="B21843_06.xhtml#_idTextAnchor135">
     <em class="italic">
      <span class="koboSpan" id="kobo.270.1">
       Chapter 6
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.271.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.272.1">
     With the addition of this new endpoint (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.273.1">
      getProductsV2
     </span>
    </code>
    <span class="koboSpan" id="kobo.274.1">
     ), we need to update the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.275.1">
      ProductsQueryUseCase
     </span>
    </code>
    <span class="koboSpan" id="kobo.276.1">
     class to include the necessary implementation code.
    </span>
    <span class="koboSpan" id="kobo.276.2">
     In the following example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.277.1">
      getAllProducts
     </span>
    </code>
    <span class="koboSpan" id="kobo.278.1">
     method now accepts a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.279.1">
      Pageable
     </span>
    </code>
    <span class="koboSpan" id="kobo.280.1">
     object from Spring, which handles pagination details.
    </span>
    <span class="koboSpan" id="kobo.280.2">
     The method returns a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.281.1">
      Page
     </span>
    </code>
    <span class="koboSpan" id="kobo.282.1">
     object containing the list of products along with metadata such as the total number of pages:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.283.1">public interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.284.1">ProductsQueryUseCase</span></span><span class="koboSpan" id="kobo.285.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.286.1">Product</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.287.1">getProductById</span></span><span class="koboSpan" id="kobo.288.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.289.1">String</span></span><span class="koboSpan" id="kobo.290.1"> productId);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.291.1">Page</span></span><span class="koboSpan" id="kobo.292.1">&lt;? </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.293.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.294.1">Product</span></span><span class="koboSpan" id="kobo.295.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.296.1">getAllProducts</span></span><span class="koboSpan" id="kobo.297.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.298.1">Pageable</span></span><span class="koboSpan" id="kobo.299.1"> pageRequest);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.300.1">
     Additionally, adding
    </span>
    <a id="_idIndexMarker298">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     this endpoint requires us to change the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.302.1">
      ProductsApi
     </span>
    </code>
    <span class="koboSpan" id="kobo.303.1">
     interface and add the definition and documentation of our endpoint, as we can see in the following code block:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.304.1">public interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.305.1">ProductsApi</span></span><span class="koboSpan" id="kobo.306.1"> {
....
</span><span class="koboSpan" id="kobo.306.2">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.307.1">Operation</span></span><span class="koboSpan" id="kobo.308.1">(
        operationId = </span><span class="hljs-string"><span class="koboSpan" id="kobo.309.1">"getProducts_v2"</span></span><span class="koboSpan" id="kobo.310.1">,
        summary = </span><span class="hljs-string"><span class="koboSpan" id="kobo.311.1">"Retrieve all products"</span></span><span class="koboSpan" id="kobo.312.1">,
        responses = {
            @</span><span class="hljs-title"><span class="koboSpan" id="kobo.313.1">ApiResponse</span></span><span class="koboSpan" id="kobo.314.1">(responseCode = </span><span class="hljs-string"><span class="koboSpan" id="kobo.315.1">"200"</span></span><span class="koboSpan" id="kobo.316.1">,
                description = </span><span class="hljs-string"><span class="koboSpan" id="kobo.317.1">"A list of products"</span></span><span class="koboSpan" id="kobo.318.1">, content = {
                    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.319.1">Content</span></span><span class="koboSpan" id="kobo.320.1">(mediaType = </span><span class="hljs-string"><span class="koboSpan" id="kobo.321.1">"application/json"</span></span><span class="koboSpan" id="kobo.322.1">,
                        array = @</span><span class="hljs-title"><span class="koboSpan" id="kobo.323.1">ArraySchema</span></span><span class="koboSpan" id="kobo.324.1">(schema = @</span><span class="hljs-title"><span class="koboSpan" id="kobo.325.1">Schema</span></span><span class="koboSpan" id="kobo.326.1">(
                            implementation = </span><span class="hljs-title"><span class="koboSpan" id="kobo.327.1">PaginatedProducts</span></span><span class="koboSpan" id="kobo.328.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.329.1">class</span></span><span class="koboSpan" id="kobo.330.1">)))
                })
        }
)
</span><span class="hljs-title"><span class="koboSpan" id="kobo.331.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.332.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.333.1">PaginatedProducts</span></span><span class="koboSpan" id="kobo.334.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.335.1">getProductsV2</span></span><span class="koboSpan" id="kobo.336.1">(
     @</span><span class="hljs-title"><span class="koboSpan" id="kobo.337.1">Parameter</span></span><span class="koboSpan" id="kobo.338.1">(name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.339.1">"page"</span></span><span class="koboSpan" id="kobo.340.1">, description = </span><span class="hljs-string"><span class="koboSpan" id="kobo.341.1">"Number of current page"</span></span><span class="koboSpan" id="kobo.342.1">,
        required = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.343.1">false</span></span><span class="koboSpan" id="kobo.344.1">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.345.1">in</span></span><span class="koboSpan" id="kobo.346.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.347.1">ParameterIn</span></span><span class="koboSpan" id="kobo.348.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.349.1">QUERY</span></span><span class="koboSpan" id="kobo.350.1">, example = </span><span class="hljs-string"><span class="koboSpan" id="kobo.351.1">"0"</span></span><span class="koboSpan" id="kobo.352.1">)
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.353.1">Integer</span></span><span class="koboSpan" id="kobo.354.1"> page,
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.355.1">Parameter</span></span><span class="koboSpan" id="kobo.356.1">(name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.357.1">"limit"</span></span><span class="koboSpan" id="kobo.358.1">,
            description = </span><span class="hljs-string"><span class="koboSpan" id="kobo.359.1">"Size of elements per page"</span></span><span class="koboSpan" id="kobo.360.1">, required = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.361.1">false</span></span><span class="koboSpan" id="kobo.362.1">,
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.363.1">in</span></span><span class="koboSpan" id="kobo.364.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.365.1">ParameterIn</span></span><span class="koboSpan" id="kobo.366.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.367.1">QUERY</span></span><span class="koboSpan" id="kobo.368.1">, example = </span><span class="hljs-string"><span class="koboSpan" id="kobo.369.1">"10"</span></span><span class="koboSpan" id="kobo.370.1">) </span><span class="hljs-title"><span class="koboSpan" id="kobo.371.1">Integer</span></span><span class="koboSpan" id="kobo.372.1"> limit);
....
</span><span class="koboSpan" id="kobo.372.2">}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.373.1">
     Now that we have the documentation code, let’s see what our Swagger documentation looks like:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.374.1">
     <img alt="Figure 5.1 – Swagger UI" src="../Images/B21843_05_1.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.375.1">
     Figure 5.1 – Swagger UI
    </span>
   </p>
   <p class="normal">
    <em class="italic">
     <span class="koboSpan" id="kobo.376.1">
      Figure 5.1
     </span>
    </em>
    <span class="koboSpan" id="kobo.377.1">
     illustrates our API, showcasing the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.378.1">
      /api/products
     </span>
    </code>
    <span class="koboSpan" id="kobo.379.1">
     endpoint with two parameters and a new
    </span>
    <a id="_idIndexMarker299">
    </a>
    <span class="koboSpan" id="kobo.380.1">
     response format when the media type is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.381.1">
      application/vnd.packt-v2+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.382.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.383.1">
     By switching the media type to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.384.1">
      application/json
     </span>
    </code>
    <span class="koboSpan" id="kobo.385.1">
     , as we can see in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.386.1">
      Figure 5.2
     </span>
    </em>
    <span class="koboSpan" id="kobo.387.1">
     , the API will change the response to its previous behavior:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.388.1">
     <img alt="Figure 5.2 – Swagger UI" src="../Images/B21843_05_2.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.389.1">
     Figure 5.2 – Swagger UI
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.390.1">
     As shown, the API
    </span>
    <a id="_idIndexMarker300">
    </a>
    <span class="koboSpan" id="kobo.391.1">
     maintains backward compatibility by providing the original output for older clients.
    </span>
    <span class="koboSpan" id="kobo.391.2">
     However, our documentation still enforces parameters, even though they aren’t being used.
    </span>
    <span class="koboSpan" id="kobo.391.3">
     Unfortunately, OpenAPI 3.x does not support varying parameters based on content type.
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.392.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.393.1">
      Note
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.394.1">
      The upcoming OpenAPI 4.x, expected by the end of 2024, will address the limitation of supporting different query parameters according to the content type.
     </span>
     <span class="koboSpan" id="kobo.394.2">
      Since we are currently using 3.x, this feature is not supported in our implementation.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.395.1">
     With the new version implemented, it’s time to validate our changes and ensure everything functions as expected.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-117">
    <a id="_idTextAnchor126">
    </a>
    <span class="koboSpan" id="kobo.396.1">
     Testing and validating our product API
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.397.1">
     Now
    </span>
    <a id="_idIndexMarker301">
    </a>
    <span class="koboSpan" id="kobo.398.1">
     that
    </span>
    <a id="_idIndexMarker302">
    </a>
    <span class="koboSpan" id="kobo.399.1">
     our product API is equipped to support multiple versions, it’s time to test and validate the functionality.
    </span>
    <span class="koboSpan" id="kobo.399.2">
     We want to ensure that each version of the API behaves as expected, delivering the correct responses without breaking any existing functionality.
    </span>
    <span class="koboSpan" id="kobo.399.3">
     To achieve this, we can use tools such as Swagger for the graphical interface, or we can interact with the API directly via the
    </span>
    <a id="_idIndexMarker303">
    </a>
    <span class="koboSpan" id="kobo.400.1">
     command line using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.401.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.402.1">
     commands.
    </span>
    <span class="koboSpan" id="kobo.402.2">
     By testing both the
    </span>
    <a id="_idIndexMarker304">
    </a>
    <span class="koboSpan" id="kobo.403.1">
     original and updated versions, we can confirm that the API handles different versions correctly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.404.1">
     To retrieve the list of products using the first version of the API, you can execute the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.405.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.406.1">
     command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.407.1">curl -X 'GET' 'http://localhost:8080/api/products' -H 'accept: application/json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.408.1">
     This command sends a request to the API without specifying the version of the product API.
    </span>
    <span class="koboSpan" id="kobo.408.2">
     The expected result is a list of products in the original format, without pagination:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.409.1">[</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.410.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.411.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.412.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.413.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.414.1">Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.415.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.416.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.417.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.418.1">"AK21109"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.419.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.420.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.421.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.422.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.423.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.424.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.425.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.426.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.427.1">},</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.428.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.429.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.430.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.431.1">"Keyboard 08"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.432.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.433.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.434.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.435.1">"AK21108"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.436.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.437.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.438.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.439.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.440.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.441.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.442.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.443.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.444.1">},</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.445.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.446.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.447.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.448.1">"Keyboard 07"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.449.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.450.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.451.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.452.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.453.1">AK21107"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.454.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.455.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.456.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.457.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.458.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.459.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.460.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.461.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.462.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.463.1">]</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.464.1">
     Now, let’s try the same request passing the page and the limit, using the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.465.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.466.1">
     command:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.467.1">curl -X 'GET' 'http://localhost:8080/api/products?page=0&amp;limit=2' -H 'accept: application/json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.468.1">
     The output will remain the same as before, even though we’ve specified a limit of two items.
    </span>
    <span class="koboSpan" id="kobo.468.2">
     This occurs because the first version of our API wasn’t designed to handle pagination query parameters.
    </span>
    <span class="koboSpan" id="kobo.468.3">
     As a result, the API ignores these parameters and the full list of products is returned, adhering to the behavior defined in version 1.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.469.1">
     The code in our first version will return all available elements.
    </span>
    <span class="koboSpan" id="kobo.469.2">
     We implemented the second version by passing Spring’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.470.1">
      Pageable
     </span>
    </code>
    <span class="koboSpan" id="kobo.471.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.471.2">
     To adhere to the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.472.1">
      Don’t Repeat Yourself
     </span>
    </strong>
    <span class="koboSpan" id="kobo.473.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.474.1">
      DRY
     </span>
    </strong>
    <span class="koboSpan" id="kobo.475.1">
     ) principle, we must update the code from version 1, where all items are returned by default, and we have to set the size to the maximum possible value.
    </span>
    <span class="koboSpan" id="kobo.475.2">
     This ensures that the first version continues to function as expected without introducing pagination:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.476.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.477.1">GetMapping</span></span><span class="koboSpan" id="kobo.478.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.479.1">Override</span></span><span class="koboSpan" id="kobo.480.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.481.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.482.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.483.1">List</span></span><span class="koboSpan" id="kobo.484.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.485.1">ProductOutput</span></span><span class="koboSpan" id="kobo.486.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.487.1">getProducts</span></span><span class="koboSpan" id="kobo.488.1">() {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.489.1">var</span></span><span class="koboSpan" id="kobo.490.1"> products = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.491.1">getAllProducts</span></span><span class="koboSpan" id="kobo.492.1">(
        </span><code class="codeHighlighted" style="font-weight: bold;"><span class="koboSpan" id="kobo.493.1">PageRequest.ofSize(Integer.MAX_VALUE))</span></code><span class="koboSpan" id="kobo.494.1">
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.495.1">stream</span></span><span class="koboSpan" id="kobo.496.1">()
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.497.1">map</span></span><span class="koboSpan" id="kobo.498.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.499.1">productMapper</span></span><span class="koboSpan" id="kobo.500.1">::toProductOutput)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.501.1">toList</span></span><span class="koboSpan" id="kobo.502.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.503.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.504.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.505.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.506.1">status</span></span><span class="koboSpan" id="kobo.507.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.508.1">HttpStatus</span></span><span class="koboSpan" id="kobo.509.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.510.1">OK</span></span><span class="koboSpan" id="kobo.511.1">)
        .</span><span class="hljs-title"><span class="koboSpan" id="kobo.512.1">body</span></span><span class="koboSpan" id="kobo.513.1">(products);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.514.1">
     Now that we’ve confirmed that our API functions as expected for the previous version, let’s move on to testing the latest version.
    </span>
    <span class="koboSpan" id="kobo.514.2">
     To do this, we will use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.515.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.516.1">
     command shown here to verify the behavior of the updated API:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.517.1">curl -X 'GET' 'http://localhost:8080/api/products?page=0&amp;limit=2' -H 'accept: application/vnd.packt-v2+json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.518.1">
     The key
    </span>
    <a id="_idIndexMarker305">
    </a>
    <span class="koboSpan" id="kobo.519.1">
     difference in this command compared to the previous one is the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.520.1">
      Accept
     </span>
    </code>
    <span class="koboSpan" id="kobo.521.1">
     header, where we specify
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.522.1">
      application/vnd.packt-v2+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.523.1">
     .
    </span>
    <span class="koboSpan" id="kobo.523.2">
     By doing so, the Spring
    </span>
    <a id="_idIndexMarker306">
    </a>
    <span class="koboSpan" id="kobo.524.1">
     Framework will route the request to the version 2 endpoint of our API.
    </span>
    <span class="koboSpan" id="kobo.524.2">
     The expected output is a paginated list of products, reflecting the new behavior introduced in version 2:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.525.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.526.1">"totalPages"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.527.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.528.1">2</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.529.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.530.1">"products"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.531.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.532.1">[</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.533.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.534.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.535.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.536.1">"Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.537.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.538.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.539.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.540.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.541.1">AK21109"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.542.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.543.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.544.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.545.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.546.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.547.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.548.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.549.1">60</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.550.1">},</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.551.1">{</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.552.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.553.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.554.1">"Keyboard 08"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.555.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.556.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.557.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.558.1">"AK21108"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.559.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.560.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.561.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.562.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.563.1">,</span></span>
      <span class="hljs-attr"><span class="koboSpan" id="kobo.564.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.565.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.566.1">60</span></span>
    <span class="hljs-punctuation"><span class="koboSpan" id="kobo.567.1">}</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.568.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.569.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.570.1">
     As we can see from the output, the response contains only two items, and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.571.1">
      totalPages
     </span>
    </code>
    <span class="koboSpan" id="kobo.572.1">
     field
    </span>
    <a id="_idIndexMarker307">
    </a>
    <span class="koboSpan" id="kobo.573.1">
     reflects the pagination, adjusting the result according to the
    </span>
    <a id="_idIndexMarker308">
    </a>
    <span class="koboSpan" id="kobo.574.1">
     limit parameter we provided.
    </span>
    <span class="koboSpan" id="kobo.574.2">
     This demonstrates that the latest version handles pagination as expected.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.575.1">
     Now that we have confirmed the expected behavior for both version 1 and version 2, let us explore what happens when we attempt to access a non-existent version (let’s call it version 3).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.576.1">
     To do this, we can execute the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.577.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.578.1">
     command and observe the result:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.579.1">curl -X 'GET' 'http://localhost:8080/api/products?page=0&amp;limit=2' -H 'accept: application/vnd.packt-v3+json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.580.1">
     After executing it, the output will be the same as that obtained with version 1:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.581.1">[</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.582.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.583.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.584.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.585.1">"Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.586.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.587.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.588.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.589.1">"AK21109"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.590.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.591.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.592.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.593.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.594.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.595.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.596.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.597.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.598.1">},</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.599.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.600.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.601.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.602.1">"Keyboard 08"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.603.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.604.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.605.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.606.1">"AK21108"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.607.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.608.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.609.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.610.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.611.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.612.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.613.1">price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.614.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.615.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.616.1">},</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.617.1">{</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.618.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.619.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.620.1">"Keyboard 07"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.621.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.622.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.623.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.624.1">"AK21107"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.625.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.626.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.627.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.628.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.629.1">,</span></span>
    <span class="hljs-attr"><span class="koboSpan" id="kobo.630.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.631.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.632.1">60</span></span>
  <span class="hljs-punctuation"><span class="koboSpan" id="kobo.633.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.634.1">]</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.635.1">
     This
    </span>
    <a id="_idIndexMarker309">
    </a>
    <span class="koboSpan" id="kobo.636.1">
     behavior might not be ideal, as it could mislead the client into
    </span>
    <a id="_idIndexMarker310">
    </a>
    <span class="koboSpan" id="kobo.637.1">
     thinking version 3 exists.
    </span>
    <span class="koboSpan" id="kobo.637.2">
     This happens because, by default, the Spring Framework allows two media types:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.638.1">
      application/json
     </span>
    </code>
    <span class="koboSpan" id="kobo.639.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.640.1">
      application/*+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.641.1">
     .
    </span>
    <span class="koboSpan" id="kobo.641.2">
     As a result, any request with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.642.1">
      application/*+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.643.1">
     media type will be processed by the default method unless explicitly mapped to a different version, as in our second version.
    </span>
    <span class="koboSpan" id="kobo.643.2">
     Therefore, without specific handling, requests for version 3 may still be routed to the default version, giving an unintended response.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.644.1">
     To solve this problem, we can update our endpoint from version 1 and force it to accept only
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.645.1">
      application/json
     </span>
    </code>
    <span class="koboSpan" id="kobo.646.1">
     , as we can see in the following code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.647.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.648.1">GetMapping</span></span><span class="koboSpan" id="kobo.649.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.650.1">produces = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.651.1">MediaType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.652.1">.</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.653.1">APPLICATION_JSON_VALUE</span></strong></span><span class="koboSpan" id="kobo.654.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.655.1">Override</span></span><span class="koboSpan" id="kobo.656.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.657.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.658.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.659.1">List</span></span><span class="koboSpan" id="kobo.660.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.661.1">ProductOutput</span></span><span class="koboSpan" id="kobo.662.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.663.1">getProducts</span></span><span class="koboSpan" id="kobo.664.1">() {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.665.1">var</span></span><span class="koboSpan" id="kobo.666.1"> products = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.667.1">getAllProducts</span></span><span class="koboSpan" id="kobo.668.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.669.1">PageRequest</span></span><span class="koboSpan" id="kobo.670.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.671.1">ofSize</span></span><span class="koboSpan" id="kobo.672.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.673.1">Integer</span></span><span class="koboSpan" id="kobo.674.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.675.1">MAX_VALUE</span></span><span class="koboSpan" id="kobo.676.1">))
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.677.1">stream</span></span><span class="koboSpan" id="kobo.678.1">()
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.679.1">map</span></span><span class="koboSpan" id="kobo.680.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.681.1">productMapper</span></span><span class="koboSpan" id="kobo.682.1">::toProductOutput)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.683.1">toList</span></span><span class="koboSpan" id="kobo.684.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.685.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.686.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.687.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.688.1">status</span></span><span class="koboSpan" id="kobo.689.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.690.1">HttpStatus</span></span><span class="koboSpan" id="kobo.691.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.692.1">OK</span></span><span class="koboSpan" id="kobo.693.1">)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.694.1">body</span></span><span class="koboSpan" id="kobo.695.1">(products);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.696.1">
     After applying this solution, when we execute the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.697.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.698.1">
     command with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.699.1">
      application/vnd.packt-v3+json
     </span>
    </code>
    <span class="koboSpan" id="kobo.700.1">
     media type, we will encounter an error like so:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.701.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.702.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.703.1">type"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.704.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.705.1">"about:blank"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.706.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.707.1">"title"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.708.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.709.1">"Not Acceptable"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.710.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.711.1">"status"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.712.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.713.1">406</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.714.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.715.1">"detail"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.716.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.717.1">"Acceptable representations: [application/json,</span></span>
<span class="hljs-attr">    </span><span class="hljs-string"><span class="koboSpan" id="kobo.718.1">application/vnd.packt-v2+json]."</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.719.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.720.1">"instance"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.721.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.722.1">"/api/products"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.723.1">}</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.724.1">
     This error response helps the client easily identify the available versions of the endpoint.
    </span>
    <span class="koboSpan" id="kobo.724.2">
     By returning a clear error when an unsupported version is requested, we provide immediate feedback, guiding the client toward the correct version and improving overall API usability.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.725.1">
     Now that we’ve tested our solution and confirmed that it maintains the expected behavior from version 1 while introducing the new functionality in version 2, along with returning a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.726.1">
      406 Not Acceptable
     </span>
    </code>
    <span class="koboSpan" id="kobo.727.1">
     error for incorrect versions, we can shift our focus to managing these versions effectively as the API continues to evolve.
    </span>
    <span class="koboSpan" id="kobo.727.2">
     Let’s explore how to handle versioning as our API grows and adapts to future needs.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-118">
    <a id="_idTextAnchor127">
    </a>
    <span class="koboSpan" id="kobo.728.1">
     Managing API evolution
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.729.1">
     Managing the
    </span>
    <a id="_idIndexMarker311">
    </a>
    <span class="koboSpan" id="kobo.730.1">
     evolution of an API is a critical aspect of long-term API maintenance.
    </span>
    <span class="koboSpan" id="kobo.730.2">
     As applications grow and customer needs change, APIs must adapt and introduce new features while ensuring the stability and continuity of existing services.
    </span>
    <span class="koboSpan" id="kobo.730.3">
     Effective management of API evolution involves planning for changes, communicating clearly with API consumers, and implementing strategies that avoid breaking existing functionality while introducing improvements in a structured and predictable manner.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.731.1">
     To manage API evolution successfully, we should consider the key practices described in the following subsections.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-119">
    <a id="_idTextAnchor128">
    </a>
    <span class="koboSpan" id="kobo.732.1">
     Avoiding introducing breaking changes
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.733.1">
     As we
    </span>
    <a id="_idIndexMarker312">
    </a>
    <span class="koboSpan" id="kobo.734.1">
     discussed earlier, the best approach to evolving your API is to ensure that new changes don’t disrupt existing clients by maintaining backward compatibility.
    </span>
    <span class="koboSpan" id="kobo.734.2">
     This minimizes potential service interruptions and provides a smooth transition for users.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.735.1">
     To achieve this, it’s essential to clearly differentiate between breaking and non-breaking changes.
    </span>
    <span class="koboSpan" id="kobo.735.2">
     When introducing breaking changes, applying versioning is crucial to preserve the integrity of the current functionality while allowing new features to coexist.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-120">
    <a id="_idTextAnchor129">
    </a>
    <span class="koboSpan" id="kobo.736.1">
     Defining and applying a versioning strategy across your APIs
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.737.1">
     When
    </span>
    <a id="_idIndexMarker313">
    </a>
    <span class="koboSpan" id="kobo.738.1">
     a breaking change is necessary, applying a versioning strategy is essential.
    </span>
    <span class="koboSpan" id="kobo.738.2">
     There are many ways to version
    </span>
    <a id="_idIndexMarker314">
    </a>
    <span class="koboSpan" id="kobo.739.1">
     your API so, as discussed earlier, maintaining consistency in versioning is crucial for ensuring that clients can easily understand and interact with your API.
    </span>
    <span class="koboSpan" id="kobo.739.2">
     A clear and predictable versioning strategy enhances the user experience, making it simpler for clients to navigate and integrate with the API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.740.1">
     Having a well-defined REST guideline that outlines how to implement a versioning strategy consistently across all APIs, as mentioned in
    </span>
    <a href="B21843_01.xhtml#_idTextAnchor015">
     <em class="italic">
      <span class="koboSpan" id="kobo.741.1">
       Chapter 1
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.742.1">
     , is key, and establishing a unique versioning strategy provides numerous benefits, including improved usability and transparency for API consumers.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-121">
    <a id="_idTextAnchor130">
    </a>
    <span class="koboSpan" id="kobo.743.1">
     Updating and informing clients about new versions and deadlines
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.744.1">
     With multiple API
    </span>
    <a id="_idIndexMarker315">
    </a>
    <span class="koboSpan" id="kobo.745.1">
     versions in play, it is essential to establish clear migration guidelines and deprecation timelines.
    </span>
    <span class="koboSpan" id="kobo.745.2">
     Providing detailed information on how to transition between versions helps clients understand the process and prepare for changes.
    </span>
    <span class="koboSpan" id="kobo.745.3">
     This transparency is crucial for a smooth migration and the minimization of potential disruptions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.746.1">
     Maintaining an up-to-date changelog is equally important.
    </span>
    <span class="koboSpan" id="kobo.746.2">
     It offers clients a comprehensive view of recent updates, bug fixes, and new features, ensuring they are informed of any modifications.
    </span>
    <span class="koboSpan" id="kobo.746.3">
     A well-documented changelog supports clients in adapting to changes effectively and fosters a positive user experience.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-122">
    <a id="_idTextAnchor131">
    </a>
    <span class="koboSpan" id="kobo.747.1">
     Semantic versioning
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.748.1">
     Semantic versioning (
    </span>
    <span class="url">
     <span class="koboSpan" id="kobo.749.1">
      https://semver.org/
     </span>
    </span>
    <span class="koboSpan" id="kobo.750.1">
     ) is a widely adopted system that clearly communicates
    </span>
    <a id="_idIndexMarker316">
    </a>
    <span class="koboSpan" id="kobo.751.1">
     the scope and impact of changes in an API.
    </span>
    <span class="koboSpan" id="kobo.751.2">
     It uses a three-part format:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.752.1">
      MAJOR.MINOR.PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.753.1">
     .
    </span>
    <span class="koboSpan" id="kobo.753.2">
     For example, a major version change (e.g., from 1.x to 2.0.0) alerts clients that breaking changes have been introduced, giving them time to adapt.
    </span>
    <span class="koboSpan" id="kobo.753.3">
     In contrast, minor and patch updates (e.g., 1.1.0 or 1.0.1) reassure clients that improvements or bug fixes have been made without affecting compatibility.
    </span>
    <span class="koboSpan" id="kobo.753.4">
     This structured approach allows developers to quickly assess the nature of an update, minimizing the risk of breaking existing functionality.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.754.1">
     By implementing semantic versioning, we can offer clear guidelines and comprehensive changelogs to keep clients informed about updates.
    </span>
    <span class="koboSpan" id="kobo.754.2">
     This structured approach helps clients understand the significance of each version change, making it easier for them to prepare for major updates that may require action.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.755.1">
     For minor or patch updates, clients are notified of new features or bug fixes without immediate pressure to upgrade.
    </span>
    <span class="koboSpan" id="kobo.755.2">
     This balance ensures that clients stay informed and can choose to update at their convenience, maintaining a smooth and flexible user experience.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-123">
    <a id="_idTextAnchor132">
    </a>
    <span class="koboSpan" id="kobo.756.1">
     Marking old endpoints as deprecated
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.757.1">
     As
    </span>
    <a id="_idIndexMarker317">
    </a>
    <span class="koboSpan" id="kobo.758.1">
     part of the API evolution process, it’s important to clearly mark endpoints scheduled for deprecation to give clients ample time to transition to new versions.
    </span>
    <span class="koboSpan" id="kobo.758.2">
     Deprecating old endpoints helps signal to clients that updates are required.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.759.1">
     OpenAPI provides a way to mark any endpoint as deprecated, which is reflected in the Swagger UI.
    </span>
    <span class="koboSpan" id="kobo.759.2">
     This can be easily done using the following code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.760.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.761.1">Operation</span></span><span class="koboSpan" id="kobo.762.1">(
    deprecated = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.763.1">true</span></span><span class="koboSpan" id="kobo.764.1">,
    ....
</span><span class="koboSpan" id="kobo.764.2">)
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.765.1">
     When we add the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.766.1">
      deprecated
     </span>
    </code>
    <span class="koboSpan" id="kobo.767.1">
     attribute and view it in the Swagger UI, the output will look like
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.768.1">
      Figure 5.3
     </span>
    </em>
    <span class="koboSpan" id="kobo.769.1">
     .
    </span>
    <span class="koboSpan" id="kobo.769.2">
     However, we chose not to use this attribute here because OpenAPI 3.x currently doesn’t support deprecated endpoints with versioning based on content negotiation.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.770.1">
     <img alt="Figure 5.3 – Swagger UI: Monitoring the usage of deprecated endpoints" src="../Images/B21843_05_3.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.771.1">
     Figure 5.3 – Swagger UI: Monitoring the usage of deprecated endpoints
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.772.1">
     Monitoring the usage of deprecated endpoints is essential for ensuring a smooth transition when phasing out older versions of an API.
    </span>
    <span class="koboSpan" id="kobo.772.2">
     By tracking requests to these endpoints, you can determine how many clients are still using outdated functionality and evaluate their progress in migrating to newer versions.
    </span>
    <span class="koboSpan" id="kobo.772.3">
     This helps you make informed decisions about when to officially remove old versions, avoiding unexpected disruptions to your clients’ operations.
    </span>
    <span class="koboSpan" id="kobo.772.4">
     Additionally, it provides insights into which clients might need extra support or communication during the transition.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.773.1">
     Monitoring tools, such as Grafana, New Relic, Datadog, and Splunk, not only facilitate a smooth
    </span>
    <a id="_idIndexMarker318">
    </a>
    <span class="koboSpan" id="kobo.774.1">
     deprecation process but also help confirm the adoption of newer API versions.
    </span>
    <span class="koboSpan" id="kobo.774.2">
     These insights enable you to set practical timelines for deprecating endpoints, ensuring their removal does not disrupt clients and enhancing trust and reliability in your API’s development.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-124">
    <a id="_idTextAnchor133">
    </a>
    <span class="koboSpan" id="kobo.775.1">
     Removing old endpoints
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.776.1">
     Once you
    </span>
    <a id="_idIndexMarker319">
    </a>
    <span class="koboSpan" id="kobo.777.1">
     have established a deadline, communicated with your clients, and provided clear instructions for upgrading to the latest version, the next step is to remove the deprecated endpoints.
    </span>
    <span class="koboSpan" id="kobo.777.2">
     But, before finalizing the removal, it is crucial to verify that clients have successfully migrated to the newest version.
    </span>
    <span class="koboSpan" id="kobo.777.3">
     This process involves not only deleting the old code but also ensuring that all references and dependencies related to these endpoints are thoroughly cleaned up.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.778.1">
     By applying these principles, you can manage API evolution smoothly and effectively, minimizing the risk of disrupting existing clients while equipping them with the necessary tools and information to adapt seamlessly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.779.1">
     Establishing a well-defined versioning strategy, using semantic versioning, and properly deprecating old endpoints allows your API to grow with minimal disruption.
    </span>
    <span class="koboSpan" id="kobo.779.2">
     This approach ensures that your clients have sufficient time to transition, while you continue to improve and expand your API’s capabilities.
    </span>
    <span class="koboSpan" id="kobo.779.3">
     Ultimately, it promotes long-term stability and improves the developer experience by allowing your API to evolve sustainably over time.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-125">
    <a id="_idTextAnchor134">
    </a>
    <span class="koboSpan" id="kobo.780.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.781.1">
     In this chapter, we explored various versioning strategies for REST APIs and learned how to evolve our API while maintaining compatibility and ensuring a smooth transition to newer versions.
    </span>
    <span class="koboSpan" id="kobo.781.2">
     We also applied content negotiation versioning to our current API, specifically focusing on implementing pagination.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.782.1">
     In the next chapter, we will delve into more advanced topics, including enhanced pagination techniques, filtering, file uploads, and additional features to further refine your API.
    </span>
   </p>
  </div>
 </body></html>