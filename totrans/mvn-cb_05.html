<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Dependency Management"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Dependency Management</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Choosing the scope of dependency</li><li class="listitem" style="list-style-type: disc">Getting a report of dependencies</li><li class="listitem" style="list-style-type: disc">Getting into dependency and avoiding dependency hell</li><li class="listitem" style="list-style-type: disc">Downloading dependencies into a folder</li><li class="listitem" style="list-style-type: disc">Understanding SNAPSHOT dependencies</li><li class="listitem" style="list-style-type: disc">Handling dependency download errors</li><li class="listitem" style="list-style-type: disc">Detecting unused/undeclared dependencies</li><li class="listitem" style="list-style-type: disc">Manually installing dependencies that are not available in a repository</li><li class="listitem" style="list-style-type: disc">Dependency management using Eclipse</li><li class="listitem" style="list-style-type: disc">Dependency management using NetBeans</li><li class="listitem" style="list-style-type: disc">Dependency management using IntelliJ IDEA</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec48"/>Introduction</h1></div></div></div><p>One of the powerful features of Maven is managing the dependencies required by the project. It is rare for a project to be developed without using other dependencies. The typical issues in using dependencies relate to the number and choice of dependencies, their versions, and the transitive dependencies (a project dependency, in turn, being dependent on other dependencies).</p><p>Maven has a way of managing the dependencies, as well as providing users with enough flexibility to handle complexities, as they arise.</p></div></div>
<div class="section" title="Choosing the scope of dependency"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec49"/>Choosing the scope of dependency</h1></div></div></div><p>We may use a dependency <a id="id269" class="indexterm"/>for many reasons. Some of them may be required to compile and run the projects. There might be others only to run tests (for instance, <code class="literal">junit</code>). Then there may be dependencies that are required at runtime, say <code class="literal">logback</code>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec114"/>How to do it...</h2></div></div></div><p>Use the following steps to choose the scope of the dependency:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project we had created earlier.</li><li class="listitem">Observe the following section:<div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;3.8.1&lt;/version&gt;
      &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;</pre></div></li><li class="listitem">Remove the preceding lines of code and run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn compile</strong></span>
</pre></div></li><li class="listitem">Observe that it runs without any issues.</li><li class="listitem">Now, run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn test</strong></span>
</pre></div></li><li class="listitem">Note the following error:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Compiling 1 source file to C:\projects\apache-maven-cookbook\project-with</strong></span>
<span class="strong"><strong>-dependencies\target\test-classes</strong></span>
<span class="strong"><strong>[INFO] -------------------------------------------------------------</strong></span>
<span class="strong"><strong>[ERROR] COMPILATION ERROR:</strong></span>
<span class="strong"><strong>[INFO] -------------------------------------------------------------</strong></span>
<span class="strong"><strong>[ERROR] /C:/projects/apache-maven-cookbook/project-with-dependencies/src/test/java/com/packt/cookbook/AppTest.java:[3,23] package junit.framework does not exist</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec115"/>How it works...</h2></div></div></div><p>The Java source code <code class="literal">App.java</code> did not have any dependency. Only the source classes were compiled by <code class="literal">mvn</code> and thus, the command ran without any error.</p><p>The test <a id="id270" class="indexterm"/>code <code class="literal">AppTest.java</code> required the <code class="literal">junit</code> library to build. This is declared in the import statement in the code. The <code class="literal">mvn</code> test tried to compile the test classes, and as it did not find the dependency, it failed.</p><p>The following information needs to be specified to declare a dependency:</p><div class="informalexample"><pre class="programlisting">      &lt;groupId&gt;junit&lt;/groupId&gt;
      &lt;artifactId&gt;junit&lt;/artifactId&gt;
      &lt;version&gt;3.8.1&lt;/version&gt;</pre></div><p>The preceding three elements uniquely identify the dependency.</p><p>The fourth piece of information is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;scope&gt;test&lt;/scope&gt;</pre></div><p>By default, the <code class="literal">scope</code> is <code class="literal">compile</code>.</p><p>There are six different dependency scopes available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">compile</code>: This <a id="id271" class="indexterm"/>dependency is required for compilation. This automatically means it is required for testing as well as runtime (when the project is run).</li><li class="listitem" style="list-style-type: disc"><code class="literal">test</code>: This <a id="id272" class="indexterm"/>dependency is only required for tests. This means the dependency is typically in the test code. As the test code is not used to run the project, these dependencies are not required for runtime.</li><li class="listitem" style="list-style-type: disc"><code class="literal">runtime</code>: These<a id="id273" class="indexterm"/> dependencies are not required during compilation, but only required to run the project. One example would be the <code class="literal">logback</code> dependency if you are using <span class="strong"><strong>Simple Logging Facade for Java</strong></span> (<span class="strong"><strong>slf4j</strong></span>) <a id="id274" class="indexterm"/>to log and want to use <code class="literal">logback</code> binding.</li><li class="listitem" style="list-style-type: disc"><code class="literal">provided</code>: This <a id="id275" class="indexterm"/>tells Maven that dependency is required for compilation and runtime, but this dependency need not be packaged with the package for distribution. The dependency will be provided by the user. An example of this dependency is <code class="literal">servlet-api</code>. Typically, application servers have these libraries.</li><li class="listitem" style="list-style-type: disc"><code class="literal">system</code>: This is <a id="id276" class="indexterm"/>similar to the provided scope. Here, we need to explicitly provide the location of the JAR file. It is not looked up from the repository. This may be useful to specify a dependency that is not present in the repository:<div class="informalexample"><pre class="programlisting">  &lt;dependency&gt;
      &lt;groupId&gt;com.myorg&lt;/groupId&gt;
      &lt;artifactId&gt;some-jar&lt;/artifactId&gt;
      &lt;version&gt;2.0&lt;/version&gt;
      &lt;scope&gt;system&lt;/scope&gt;
      &lt;systemPath&gt;${basedir}/lib/some.jar&lt;/systemPath&gt;
    &lt;/dependency&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">import</code>: This is<a id="id277" class="indexterm"/> only used on a dependency of the <code class="literal">pom</code> type in the <code class="literal">dependencyManagement</code> section. It indicates that <a id="id278" class="indexterm"/>the specified pom should be replaced with the dependencies in that pom's <code class="literal">dependencyManagement</code> section. This is intended to centralize dependencies of large multi-module projects.</li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec116"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Manually installing dependencies that are not available in a repository</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Getting a report of dependencies"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec50"/>Getting a report of dependencies</h1></div></div></div><p>It is useful to get a list of <a id="id279" class="indexterm"/>dependencies for a Maven project in order to identify and troubleshoot problems. The Maven Dependency plugin helps us here.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec117"/>Getting ready</h2></div></div></div><p>To appreciate this, we need to have a fairly <a id="id280" class="indexterm"/>complex project that has several transitive dependencies. You can look at one such project at <a class="ulink" href="https://github.com/selendroid/demoproject-selendroid">https://github.com/selendroid/demoproject-selendroid</a>.</p><p>The project source code is available as a Git repository. A Git repository is typically downloaded by cloning it. To do this, install Git on your system. Refer to the <a id="id281" class="indexterm"/>Git setup link (<a class="ulink" href="https://help.github.com/articles/set-up-git/">https://help.github.com/articles/set-up-git/</a>) for detailed instructions.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec118"/>How to do it...</h2></div></div></div><p>Use the following steps, to get a list of dependencies for a Maven project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Clone the open source project <code class="literal">demoproject-selendroid</code>.</li><li class="listitem">Run the following Maven goal:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:list</strong></span>
</pre></div></li><li class="listitem">Observe the output as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_05_01.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec119"/>How it works...</h2></div></div></div><p>The Maven <a id="id282" class="indexterm"/>Dependency plugin has several goals to obtain information regarding dependencies as well as manage them.</p><p>Interestingly, this goal is not bound to any phase or lifecycle of Maven. This means, when the <code class="literal">mvn dependency:list</code> command is run, Maven runs the <code class="literal">list</code> goal and nothing else.</p><p>The <code class="literal">dependency:list</code> parameter tells Maven to run the <code class="literal">list</code> goal of the Maven Dependency plugin. This analyzes the pom file and generates a list of dependencies for the project.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec120"/>There's more...</h2></div></div></div><p>While the dependency list might be good enough for simple cases, a more interesting and useful one would be a dependency report in a tree format.</p><p>This can be done by running the <code class="literal">tree</code> goal of Maven Dependency plugin:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:tree</strong></span>
</pre></div><p>Running this on the<a id="id283" class="indexterm"/> preceding project gives the following output:</p><div class="mediaobject"><img src="graphics/6124OS_05_02.jpg" alt="There's more..."/></div><p>As we can see, this is a better representation of the transitivity of the dependencies. Now we know that which other dependencies are used, for instance, <code class="literal">commons-logging</code>.</p></div></div>
<div class="section" title="Getting into dependency and avoiding dependency hell"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec51"/>Getting into dependency and avoiding dependency hell</h1></div></div></div><p>As you use a number of dependencies, each of them in turn may also include further dependencies. A situation may come when there are multiple versions of the same dependencies in the project. This can often lead to errors.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec121"/>Getting ready</h2></div></div></div><p>To understand this, we need to have a fairly<a id="id284" class="indexterm"/> complex project that has several transitive dependencies. You can look at one such project at <a class="ulink" href="https://github.com/selendroid/demoproject-selendroid">https://github.com/selendroid/demoproject-selendroid</a>.</p><p>Clone the repository on your system. Now, we are ready to see how complex dependencies can get.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec122"/>How to do it...</h2></div></div></div><p>Use the following steps to avoid <a id="id285" class="indexterm"/>dependency hell:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:tree -Dverbose</strong></span>
</pre></div></li><li class="listitem">Note the output as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_05_03.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec123"/>How it works...</h2></div></div></div><p>As you can see, in the <a id="id286" class="indexterm"/>course of identifying the dependencies to be used in the project, Maven does a dependency analysis. This reveals two things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Two or more dependencies require the same version of another dependency. Maven includes a dependency only once.</li><li class="listitem" style="list-style-type: disc">Two or more dependencies require a different version of another dependency.</li></ul></div><p>Maven resolves this by supporting the <span class="emphasis"><em>nearest definition</em></span>, which means that it will use the version of the dependency closest to your project in the tree of dependencies.</p><p>This means it will not necessarily take either the <span class="emphasis"><em>latest</em></span> or the <span class="emphasis"><em>oldest</em></span> version. It will go by the version that it finds <span class="emphasis"><em>first</em></span> in the order of dependencies.</p><p>Where the project fails to work due to the incorrect version being used, the correct way to resolve is to explicitly define the desired version of the dependency in your pom file. By the previous strategy, this being the <span class="emphasis"><em>nearest definition</em></span> will get precedence over any other versions defined in any other dependency.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec124"/>There's more...</h2></div></div></div><p>Maven provides<a id="id287" class="indexterm"/> another way to handle the preceding scenario, namely, by using the <code class="literal">dependencyManagement</code> element.</p><p>This allows us to directly specify the versions of artifacts to be used when they are encountered in transitive dependencies or in dependencies where no version has been specified. In the example in the preceding section, the <code class="literal">guava</code> dependency was directly added to <code class="literal">demoproject-selendroid</code>, even though it was not directly used by the project. Instead, <code class="literal">demoproject-selendroid</code> can include <code class="literal">guava</code> as a dependency in its <code class="literal">dependencyManagement</code> section and directly control which version of <code class="literal">guava</code> is used when, or if, it is ever referenced.</p><p>There is no magic bullet to prevent dependency hell. Even if you manually manage the version of a library that gets included in your project by the preceding mechanism, it does not mean that other transitive dependencies, which depend on a different version of the same library, will suddenly become binary compatible with the managed version.</p></div></div>
<div class="section" title="Downloading dependencies into a folder"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Downloading dependencies into a folder</h1></div></div></div><p>Some projects may have a<a id="id288" class="indexterm"/> requirement for all the dependencies to be made <a id="id289" class="indexterm"/>available, say, in a folder. This could be to archive the dependencies used in a particular version of the build.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec125"/>How to do it...</h2></div></div></div><p>Use the following steps to download dependencies in the <code class="literal">target/dependency</code> folder:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let us open the demo project that we used in the previous recipe.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:copy-dependencies</strong></span>
</pre></div></li><li class="listitem">See the output in the <code class="literal">target/dependency</code> folder:<div class="mediaobject"><img src="graphics/6124OS_05_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec126"/>How it works...</h2></div></div></div><p>The <code class="literal">copy-dependencies</code> goal <a id="id290" class="indexterm"/>of the Maven Dependency plugin copies <a id="id291" class="indexterm"/>over all the dependencies used in the project, including transitive dependencies, to <code class="literal">target/dependency</code> folder of the project.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec127"/>There's more...</h2></div></div></div><p>This goal takes several parameters to handle various use cases, such as copying pom files of the dependencies, copying parent poms, preserving the folder structure of the repository, and so on.</p><p>The folder location can be changed by passing the following argument:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:copy-dependencies -DoutputDirectory=dependencies</strong></span>
</pre></div><p>The dependencies will now be copied over to the <code class="literal">dependencies</code> folder instead of the default <code class="literal">target/dependency</code> folder.</p><p>The folder structure of the repository can be preserved and the poms of the dependencies can be copied over by running the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:copy-dependencies -Dmdep.copyPom=true Dmdep.useRepositoryLayout=true</strong></span>
</pre></div><p>The resultant folder structure will be similar to the repository layout as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6124OS_05_05.jpg" alt="There's more..."/></div></div></div>
<div class="section" title="Understanding SNAPSHOT dependencies"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Understanding SNAPSHOT dependencies</h1></div></div></div><p>In Maven, a <code class="literal">SNAPSHOT</code> version<a id="id292" class="indexterm"/> is a version of the project/dependency that has not been released. This is indicated by suffixing <code class="literal">SNAPSHOT</code> to the version number. Here's an example:</p><div class="informalexample"><pre class="programlisting">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</pre></div><p>You will notice that the project we created using the Maven archetype quickstart had a <code class="literal">SNAPSHOT</code> version.</p><p>The version number specified before <code class="literal">-SNAPSHOT</code> is the version that the released project/dependency is expected to have. So, <code class="literal">1.0-SNAPSHOT</code> indicates <code class="literal">1.0</code> is not released yet.</p><p>As the <code class="literal">SNAPSHOT</code> version indicates software under development, Maven deals with these dependencies differently.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec128"/>How to do it...</h2></div></div></div><p>One would rarely use the<a id="id293" class="indexterm"/> <code class="literal">SNAPSHOT</code> version of an external dependency. If you are developing a multi-module project in your organization, chances are you will use <code class="literal">SNAPSHOT</code> versions of other modules required in your project.</p><p>Let us try the following contrived example:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open one of the projects that we have created.</li><li class="listitem">Add the following dependency:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;4.1.0.BUILD-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</pre></div></li><li class="listitem">Add the following code to specify the repository where the dependency is available:<div class="informalexample"><pre class="programlisting">&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;repository.spring.snapshot&lt;/id&gt;
        &lt;name&gt;Spring Snapshot Repository&lt;/name&gt;
        &lt;url&gt;http://repo.spring.io/snapshot&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting">C:\projects\apache-maven-cookbook\project-with-snapshot-dependencies&gt;mvn verify</pre></div></li><li class="listitem">Observe the following results:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Scanning for projects...</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Building Project with SNAPSHOT dependencies 1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>Downloading:http://repo.spring.io/snapshot/org/springframework/spring-context/4.1.2.BUILD-SNAPSHOT/maven-metadata.xml</strong></span>
<span class="strong"><strong>Downloaded:http://repo.spring.io/snapshot/org/springframework/spring-context/4.1.2.BUILD-SNAPSHOT/maven-metadata.xml (3 KB at 1.7 KB/sec)</strong></span>
<span class="strong"><strong>Downloading:http://repo.spring.io/snapshot/org/springframework/spring-context/4.1.2.BUILD-SNAPSHOT/spring-context-4.1.2.BUILD-20141107.161556-92.pom</strong></span>
<span class="strong"><strong>Downloaded:http://repo.spring.io/snapshot/org/springframework/spring-context/4.1.2.BUILD-SNAPSHOT/spring-context-4.1.2.BUILD-20141107.161556-92.pom (5 KB at 6.8 KB/sec)</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec129"/>How it works...</h2></div></div></div><p>The first thing you <a id="id294" class="indexterm"/>would have seen is the need to define a specific repository to download the dependencies. These dependencies are not available in the usual repositories. They reside separately in repositories called<a id="id295" class="indexterm"/> <span class="strong"><strong>snapshot repositories</strong></span>. In the preceding example, we specified the snapshot repository where the desired dependencies were available.</p><p>The second thing you would notice are the filenames. Each artifact that is being downloaded is appended with <code class="literal">20141107.161556-92</code>. This is a unique identifier for each <code class="literal">SNAPSHOT</code> version in the repository. This value changes each time a new <code class="literal">SNAPSHOT</code> version is available in the repository.</p><p>Maven treats <code class="literal">SNAPSHOT</code> versions differently from release versions.</p><p>For a release version, Maven checks if the artifact is available in the local repository that is already downloaded. If so, it does not attempt to fetch the same from the remote repositories.</p><p>For <code class="literal">SNAPSHOT</code> versions, even if the artifact is available locally, it checks the <code class="literal">SNAPSHOT</code> version for updates in the remote repository based on the update policy that can be configured.</p><p>By default, the update interval is once a day. This means, if Maven downloads a <code class="literal">SNAPSHOT</code> dependency at noon today, it will check for an update to it at noon tomorrow and not before that, irrespective of how many times you build the project.</p><p>The update interval can be specified in the repository section of the pom or settings file as follows:</p><div class="informalexample"><pre class="programlisting">&lt;updatePolicy&gt;always&lt;updatePolicy&gt;</pre></div><p>The choices<a id="id296" class="indexterm"/> are <code class="literal">always</code>, <code class="literal">daily</code> (default), <code class="literal">interval:X</code> (where <code class="literal">X</code> is an integer in minutes), or <code class="literal">never</code>. Let's discuss in brief about these choices:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">always</code>: This checks for updates for every Maven run.</li><li class="listitem" style="list-style-type: disc"><code class="literal">daily</code>: This checks for updates once a day. This does not necessarily mean exactly 24 hours from the last check; just once a day at the start of the day.</li><li class="listitem" style="list-style-type: disc"><code class="literal">interval:X</code>: This checks for updates after a specified time.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip09"/>Tip</h3><p>In a multi-module project, it is good to set the <code class="literal">updatePolicy</code> element value to <code class="literal">always</code> for intermodule dependencies.</p></div></div></li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec130"/>There's more...</h2></div></div></div><p>As mentioned earlier, there are separate repositories<a id="id297" class="indexterm"/> for release and <a id="id298" class="indexterm"/>snapshot versions. By default, snapshots are disabled for a release repository and vice versa. The <code class="literal">repository</code> element has separate <code class="literal">releases</code> and <code class="literal">snapshots</code> sub-elements where this can be specified:</p><div class="informalexample"><pre class="programlisting">       &lt;repository&gt;
          &lt;id&gt;my-repo&lt;/id&gt;
          &lt;name&gt;My Release Repo&lt;/name&gt;
          &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
            &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
            &lt;checksumPolicy&gt;fail&lt;/checksumPolicy&gt;
          &lt;/releases&gt;
          &lt;snapshots&gt;
            &lt;enabled&gt;false&lt;/enabled&gt;
            &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
            &lt;checksumPolicy&gt;fail&lt;/checksumPolicy&gt;
          &lt;/snapshots&gt;
          &lt;url&gt;http://my.repo.url&lt;/url&gt;
          &lt;layout&gt;default&lt;/layout&gt;
        &lt;/repository&gt;</pre></div><p>Typically, for a release repository, <code class="literal">enabled</code> will be <code class="literal">false</code> for <code class="literal">snapshots</code>. For a snapshot repository, <code class="literal">enabled</code> will be <code class="literal">true</code> for <code class="literal">snapshots</code> and <code class="literal">false</code> for <code class="literal">releases</code>. This is so that Maven looks at the right repository for the right artifacts and does not unnecessarily look at the wrong repositories each time it needs a dependency.</p><p>The <code class="literal">checksumPolicy</code> element <a id="id299" class="indexterm"/>tells Maven what to do in case the checksum of the downloaded dependency does not match the actual checksum. The value of <code class="literal">fail</code> will stop the build with a checksum error.</p></div></div>
<div class="section" title="Handling dependency download errors"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Handling dependency download errors</h1></div></div></div><p>There could be situations when a <a id="id300" class="indexterm"/>dependency might not be downloaded due to network problems or other issues. Sometimes, the error reported by Maven might not indicate the problem. It is good to know how to get around this problem.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec131"/>How to do it...</h2></div></div></div><p>It is difficult to simulate this problem in a normal scenario, but we can create a contrived scenario, by using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Modify the dependency version for JUnit in our simple project:<div class="informalexample"><pre class="programlisting">&lt;version&gt;3.9.1 &lt;/version&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn verify</strong></span>
</pre></div></li><li class="listitem">This will attempt to download the dependency and fail (as the version is invalid):<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Building simple-project 1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>Downloading:https://repo.maven.apache.org/maven2/junit/junit/3.9.1/junit-3.9.1.pom</strong></span>
<span class="strong"><strong>[WARNING] The POM for junit:junit:jar:3.9.1 is missing, no dependency information available</strong></span>
<span class="strong"><strong>Downloading:https://repo.maven.apache.org/maven2/junit/junit/3.9.1/junit-3.9.1.jar</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD FAILURE</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Total time: 3.329 s</strong></span>
<span class="strong"><strong>[INFO] Finished at: 2014-11-08T15:59:33+05:30</strong></span>
<span class="strong"><strong>[INFO] Final Memory: 7M/154M</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[ERROR] Failed to execute goal on project simple-project: Could not resolve dependencies for project com.packt.cookbook:simple-project:jar:1.0-SNAPSHOT: Could not find artifact junit:junit:jar:3.9.1 in central (https://repo.maven.apache.org/maven2) -&gt; [Help 1]</strong></span>
</pre></div></li><li class="listitem">Run the <a id="id301" class="indexterm"/>command again and observe the results:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[ERROR] Failed to execute goal on project simple-project: Could not resolve dependencies for project com.packt.cookbook:simple-project:jar:1.0-SNAPSHOT: Failure to find junit:junit:jar:3.9.1 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced -&gt; [Help 1]</strong></span>
</pre></div></li><li class="listitem">Delete the folder <code class="literal">3.9.1</code> (or the files in the folder ending with <code class="literal">.lastUpdated</code>) in the local repo (<code class="literal">.m2/repository/junit/junit/3.9.1</code>) and retry.<p>The <code class="literal">resolution will not be attempted</code> error will go away and Maven will attempt to download the dependency again</p></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec132"/>How it works...</h2></div></div></div><p>Maven first downloads the pom file of the dependency. It analyzes the pom file and recursively downloads the transitive dependencies specified there. It then downloads the actual dependency file, typically, a JAR file.</p><p>When Maven fails to download an artifact, it creates a file with the same name as the artifact it failed to download, but suffixed with <code class="literal">.lastUpdated</code>. In the file, it puts information related to the download, as shown in the following example:</p><div class="informalexample"><pre class="programlisting">
<code class="literal">#NOTE: This is an Aether internal implementation file, its format can be changed without prior notice.</code>
<code class="literal">#Sat Nov 08 15:59:33 IST 2014</code>
<code class="literal">https\://repo.maven.apache.org/maven2/.lastUpdated=1415442573938</code>
<code class="literal">https\://repo.maven.apache.org/maven2/.error=</code>
</pre></div><p>When a request is made to Maven to download the dependency again, maven refers to the contents of this file to decide whether or not maven should reattempt. This is the case for release dependencies. The deletion of this file will ensure maven reattempts to download the dependency when asked.</p><p>We have seen how this works for SNAPSHOT dependencies in the <span class="emphasis"><em>Understanding the SNAPSHOT dependencies</em></span> recipe of this chapter.</p></div></div>
<div class="section" title="Detecting unused/undeclared dependencies"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Detecting unused/undeclared dependencies</h1></div></div></div><p>As your project becomes large and the number of dependencies increase (including transitive dependencies), it is good to know if we have ended up declaring dependencies that we are not using, or if we are using undeclared dependencies (which are brought in by transitive dependencies).</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec133"/>How to do it...</h2></div></div></div><p>Use the following steps to detect the <a id="id302" class="indexterm"/>unused/undeclared dependencies:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following Maven command on the <code class="literal">demo-selendroid</code> project that we used earlier:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:analyze</strong></span>
</pre></div></li><li class="listitem">Note the report generated:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[WARNING] Used undeclared dependencies found:</strong></span>
<span class="strong"><strong>[WARNING]    org.seleniumhq.selenium:selenium-api:jar:2.43.1:compile</strong></span>
<span class="strong"><strong>[WARNING]    org.hamcrest:hamcrest-library:jar:1.3:compile</strong></span>
<span class="strong"><strong>[WARNING]    io.selendroid:selendroid-common:jar:0.12.0:compile</strong></span>
<span class="strong"><strong>[WARNING] Unused declared dependencies found:</strong></span>
<span class="strong"><strong>[WARNING]    org.hamcrest:hamcrest-integration:jar:1.3:compile</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec134"/>How it works...</h2></div></div></div><p>As can be seen from the preceding report, Maven has identified a dependency used by the project that is not declared, for instance the <code class="literal">selenium-api</code> JAR file. It has also found a dependency that is declared in the pom file, but is not used by the project (<code class="literal">hamcrest-integration</code>). You could check if the removal causes any side-effect and if not, go ahead.</p><p>It is a good practice to explicitly define the dependency used in the project, specifying the version number instead of using it by means of a transitive dependency. This is because we have no control over the version or availability of this transitive dependency.</p><p>On the other hand, in order to have better control over dependency conflicts that we saw earlier, it may not be a bad idea to explicitly define versions of dependencies that are not directly required by our <a id="id303" class="indexterm"/>project but used by our dependencies.</p></div></div>
<div class="section" title="Manually installing dependencies that are not available in a repository"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Manually installing dependencies that are not available in a repository</h1></div></div></div><p>There may be situations <a id="id304" class="indexterm"/>where a library, which is not present in any Maven repository, needs to be used. We have seen one way to use it, that is, specifying it as a dependency with <code class="literal">system</code> scope and explicitly specifying the path to it.</p><p>The problem with this approach is that this dependency will not be available if you need to distribute your project as a library.</p><p>Maven provides a mechanism to install an artifact to your local repository so that you can declare and use it like other dependencies.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec135"/>How to do it...</h2></div></div></div><p>Use the following steps to manually install the dependencies that aren't available in a repository:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following dependency to the simple project that we created earlier:<div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
      &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
      &lt;artifactId&gt;apache-tomcat&lt;/artifactId&gt;
      &lt;version&gt;8.0.14&lt;/version&gt;
      &lt;type&gt;tar.gz&lt;/type&gt;
      &lt;/dependency&gt;</pre></div><p>The project will fail to compile with the error of a missing dependency</p></li><li class="listitem">Now run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>C:\projects\apache-maven-cookbook\project-with-dependency-not-in-repo&gt;mvn install:install-file -DgroupId=org.apache.tomcat -DartifactId=apache-tomcat -Dversion=8.0.14 -Dpackaging=tar.gz -Dfile=C:\Users\raghu\Downloads\apache-tomcat-8.0.14.tar.gz -DgeneratePom=true</strong></span>
</pre></div></li><li class="listitem">Note the result:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-install-plugin:2.4:install-file (default-cli) @ project-with-dependency-not-in-repo ---</strong></span>
<span class="strong"><strong>[INFO] Installing C:\Users\raghu\Downloads\apache-tomcat-8.0.14.tar.gz to C:\software\maven\org\apache\tomcat\apache-tomcat\8.0.14\apache-tomcat-8.0.14.tar.gz</strong></span>
<span class="strong"><strong>[INFO] Installing 
C:\Users\raghu\AppData\Local\Temp\mvninstall8295760271813162395.pom to C:\software\maven\org\apache\tomcat\apache-tomcat\8.0.14\apache-tomcat-8.0.14.pom</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec136"/>How it works...</h2></div></div></div><p>The<a id="id305" class="indexterm"/> <code class="literal">install-file</code> goal <a id="id306" class="indexterm"/>of the Maven Install plugin allows dependencies to be installed to the local repository. It takes <code class="literal">groupId</code>, <code class="literal">artifactId</code>, <code class="literal">version</code>, and <code class="literal">packaging</code> type as parameters so that it can place the dependency suitably in the repository as well as create a simple pom file for it.</p><p>This method is not ideal in a project with multiple developers, as each developer needs to perform this step manually. One way to deal with this is to install this dependency in a repository manager that is used by the organization. As the developers will be using this repository manager as a <code class="literal">mirror</code>, Maven will find the dependency from the <code class="literal">mirror</code> and proceed.</p><p>In such a case, we could use the <code class="literal">deploy</code> goal of the Maven deploy plugin to install the artifact to the remote repository.</p><p>Some remote repositories have access control. Maven allows access details to be specified in the <code class="literal">server</code> element. It is best to specify this in <code class="literal">settings.xml</code> as this file is specific to each user.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec137"/>There's more...</h2></div></div></div><p>Projects with dependencies that are installed by this method are again not distributable, as those using them will fail to find the dependencies.</p><p>Where projects are expected to be distributed and included by others as dependencies, a different approach needs to be followed—the static <span class="strong"><strong>in-project repository</strong></span><a id="id307" class="indexterm"/> solution. Use the following steps to follow the in-project repository approach:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a repository inside your project by adding the following in your pom file:<div class="informalexample"><pre class="programlisting">&lt;repository&gt;
    &lt;id&gt;in-project-repo&lt;/id&gt;
    &lt;releases&gt;
        &lt;checksumPolicy&gt;ignore&lt;/checksumPolicy&gt;
    &lt;/releases&gt;
    &lt;url&gt;file://${project.basedir}/lib&lt;/url&gt;
&lt;/repository&gt;</pre></div></li><li class="listitem">Use the following command to install the dependency to this repository:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn install:install-file -DgroupId=org.apache.tomcat -DartifactId=apache-tomcat -Dversion=8.0.14 -Dpackaging=tar.gz -Dfile=C:\Users\raghu\Downloads\apache-tomcat-8.0.14.tar.gz -DgeneratePom=true -DlocalRepositoryPath=lib</strong></span>
</pre></div></li></ol></div><p>What have we achieved? Now, the dependency is packaged along with the source code in the <code class="literal">lib</code> folder of our project and available for distribution. This is transparent to the user as they do not need to do anything special to access it.</p></div></div>
<div class="section" title="Dependency management using Eclipse"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Dependency management using Eclipse</h1></div></div></div><p>We have seen that the Eclipse IDE provides support for Maven projects and allows us to run Maven commands from the IDE. Let us now see how we can manage dependencies using Eclipse.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec138"/>How to do it...</h2></div></div></div><p>Use the following steps in <a id="id308" class="indexterm"/>Eclipse IDE to manage the<a id="id309" class="indexterm"/> dependencies:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the demoproject-selendroid file in Eclipse.</li><li class="listitem">Open the <code class="literal">pom.xml</code> file.</li><li class="listitem">Click on the <span class="strong"><strong>Dependencies</strong></span> tab as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_05_06.jpg" alt="How to do it..."/></div></li><li class="listitem">A new <a id="id310" class="indexterm"/>dependency can be added<a id="id311" class="indexterm"/> by clicking on the <span class="strong"><strong>Add…</strong></span> button (see in the preceding screenshot for the <span class="strong"><strong>Add...</strong></span> button):<div class="mediaobject"><img src="graphics/6124OS_05_07.jpg" alt="How to do it..."/></div><p>As you can see in the preceding screenshot, you can specify the values in the <span class="strong"><strong>Group Id:</strong></span>, <span class="strong"><strong>Artifact Id:</strong></span>, and <span class="strong"><strong>Version:</strong></span> textboxes along with the value in the <span class="strong"><strong>Scope</strong></span> dropdown. Alternately, you can search for an artifact in<a id="id312" class="indexterm"/> the <span class="strong"><strong>Enter groupId, artifactId or sha1 prefix or pattern (*):</strong></span> textbox, and eclipse will <a id="id313" class="indexterm"/>populate the relevant columns based on your selection in the <span class="strong"><strong>Search Results</strong></span> list.</p></li><li class="listitem">You can also see the dependency tree by clicking on the <span class="strong"><strong>Dependency Hierarchy</strong></span> tab:<div class="mediaobject"><img src="graphics/6124OS_05_08.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec139"/>How it works...</h2></div></div></div><p>As Eclipse has built-in support for Maven, it allows visualization of dependencies by parsing the pom file. It also calls various Maven commands (such as <code class="literal">dependency:tree</code>) internally to build the hierarchy and display the same.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec140"/>There's more...</h2></div></div></div><p>We saw that users <a id="id314" class="indexterm"/>can search for and add dependencies. For <a id="id315" class="indexterm"/>this to work, navigate to <span class="strong"><strong>Windows</strong></span> | <span class="strong"><strong>Preferences</strong></span> | <span class="strong"><strong>Maven</strong></span> and check the <span class="strong"><strong>Download repository index updates on startup</strong></span> option to download indexes, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6124OS_05_09.jpg" alt="There's more..."/></div><p>You may need to restart Eclipse for this to take effect. Also, you can enable the <span class="strong"><strong>Maven Repositories</strong></span> view (see in the preceding screenshot), see the repositories, and also update the index as required.</p></div></div>
<div class="section" title="Dependency management using NetBeans"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec58"/>Dependency management using NetBeans</h1></div></div></div><p>Like Eclipse, NetBeans <a id="id316" class="indexterm"/>also allows dependencies to be <a id="id317" class="indexterm"/>managed and viewed through the IDE. Unlike Eclipse, NetBeans displays a graphical view of the dependencies along with additional information, which makes it easy for developers to troubleshoot issues.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec141"/>How to do it...</h2></div></div></div><p>Use the following steps in the NetBeans IDE to manage the dependencies:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">demoproject-selendroid</code> file in NetBeans.</li><li class="listitem">Open the <code class="literal">pom.xml</code> file.</li><li class="listitem">Click on the <span class="strong"><strong>Graph</strong></span> tab:<div class="mediaobject"><img src="graphics/6124OS_05_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Hover over one of the dependencies in red (<span class="strong"><strong>commons-codec</strong></span>):<div class="mediaobject"><img src="graphics/6124OS_05_11.jpg" alt="How to do it..."/></div></li><li class="listitem">Hover over <a id="id318" class="indexterm"/>one of the dependencies<a id="id319" class="indexterm"/> in orange (<span class="strong"><strong>httpclient</strong></span>):<div class="mediaobject"><img src="graphics/6124OS_05_12.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec142"/>How it works...</h2></div></div></div><p>NetBeans creates a graph of all the project dependencies and displays the same. It colors the dependencies that have conflicts in red and those that have warnings in orange. On hovering, NetBeans displays details of the issues.</p><p>This allows the user to take suitable action.</p></div></div>
<div class="section" title="Dependency management using IntelliJ IDEA"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec59"/>Dependency management using IntelliJ IDEA</h1></div></div></div><p>Unlike Eclipse and NetBeans, viewing dependencies as graphs is only possible in the IntelliJ IDEA Ultimate version, which is commercial. The Community Edition does not support this option.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec143"/>How to do it...</h2></div></div></div><p>Use the following steps in <a id="id320" class="indexterm"/>IntelliJ Idea Ultimate version to <a id="id321" class="indexterm"/>manage the dependencies:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">demoproject-selendroid</code> file in the IntelliJ IDEA Ultimate edition.</li><li class="listitem">Right-click on the <code class="literal">pom.xml</code> file.<div class="mediaobject"><img src="graphics/6124OS_05_13.jpg" alt="How to do it..."/></div></li><li class="listitem">Click on the <span class="strong"><strong>Show Dependencies...</strong></span> option (See this option in the preceding screenshot) and observe the following screenshot:<div class="mediaobject"><img src="graphics/6124OS_05_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec144"/>How it works...</h2></div></div></div><p>IntelliJ IDEA has <a id="id322" class="indexterm"/>first-class support for Maven projects. It<a id="id323" class="indexterm"/> reads the <code class="literal">pom.xml</code> file of the project, parses it, and identifies all the dependencies, including transitive dependencies. It then displays the same in a graphical manner, allowing users to visualize the project.</p></div></div></body></html>