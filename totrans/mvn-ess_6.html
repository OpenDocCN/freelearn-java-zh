<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Maven Assemblies"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Maven Assemblies</h1></div></div></div><p>Maven provides an extensible architecture via plugins and lifecycles. Archive types such as <code class="literal">.jar</code>, <code class="literal">.war</code>, <code class="literal">.ear</code>, and many more are supported by plugins and associated lifecycles. The JAR plugin creates an artifact with the <code class="literal">.jar</code> extension and the relevant metadata, according to the JAR specification. The JAR file is, in fact, a ZIP file with the optional <code class="literal">META-INF</code> directory. You <a id="id287" class="indexterm"/>can find more details about the JAR specification<a id="id288" class="indexterm"/> from <a class="ulink" href="http://docs.oracle.com/javase/7/docs/technotes/guides/jar/jar.html">http://docs.oracle.com/javase/7/docs/technotes/guides/jar/jar.html</a>.</p><p>The JAR file aggregates a set of class files to build a single distribution unit. The WAR file aggregates a set of JAR files, Java classes, JSPs, images, and many more resources into a single distribution unit that can be deployed in a Java EE application server. However, when you build a product, you may need to aggregate many JAR files from different places, WAR files, README files, LICENSE files, and many more into a single ZIP file. To build such an archive, we can use the Maven <code class="literal">assembly</code> plugin.</p><p>The following figure shows the possible contents of a Maven assembly:</p><div class="mediaobject"><img src="graphics/B02157_06_01.jpg" alt="Maven Assemblies"/></div><p>In this chapter, we will discuss the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Maven assembly plugin</li><li class="listitem" style="list-style-type: disc">Assembly descriptor</li><li class="listitem" style="list-style-type: disc">Artifact/resource filters</li><li class="listitem" style="list-style-type: disc">End-to-end example to build a custom distribution archive</li></ul></div><p>The Maven <code class="literal">assembly</code> plugin produces a custom archive, which adheres to a user-defined layout. This custom archive is also known as the Maven assembly. In other words, a Maven assembly is a distribution unit, which is built according to a custom layout.</p><div class="section" title="The assembly plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec41"/>The assembly plugin</h1></div></div></div><p>Let's take a<a id="id289" class="indexterm"/> quick look at a real-world example, which uses the <code class="literal">assembly</code> plugin.</p><p>
<span class="strong"><strong>WSO2 Identity Server</strong></span> (<span class="strong"><strong>WSO2 IS</strong></span>) is an open source identity and entitlement management <a id="id290" class="indexterm"/>product distributed under the Apache 2.0 license as a ZIP file. The ZIP distribution is assembled using the Maven <code class="literal">assembly</code> plugin. Let's take a look at the root POM file of the <code class="literal">distribution</code> module of WSO2 IS, which <a id="id291" class="indexterm"/>builds the Identity Server distribution, available at <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/products/is/5.0.0/modules/distribution/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/products/is/5.0.0/modules/distribution/pom.xml</a>.</p><p>First, pay attention to the <code class="literal">plugins</code> section of the POM file. Here, you can see that <code class="literal">maven-assembly-plugin</code> is associated with the project. Inside the plugin configuration, you can define any number of executions with the <code class="literal">execution</code> element, which is a child element of the <code class="literal">executions</code> element, which has the following configuration:</p><div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;<span class="strong"><strong>maven-assembly-plugin</strong></span>&lt;/artifactId&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;<span class="strong"><strong>copy_components</strong></span>&lt;/id&gt;
          &lt;phase&gt;<span class="strong"><strong>test</strong></span>&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;<span class="strong"><strong>attached</strong></span>&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;configuration&gt;
            &lt;filters&gt;
              &lt;filter&gt;
                ${basedir}/src/assembly/filter.properties
              &lt;/filter&gt;
            &lt;/filters&gt;
            &lt;descriptors&gt;
              &lt;descriptor&gt;src/assembly/dist.xml&lt;/descriptor&gt;
            &lt;/descriptors&gt;
          &lt;/configuration&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
          &lt;id&gt;<span class="strong"><strong>dist</strong></span>&lt;/id&gt;
          &lt;phase&gt;<span class="strong"><strong>package</strong></span>&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;<span class="strong"><strong>attached</strong></span>&lt;/goal&gt;
          &lt;/goals&gt;
          &lt;configuration&gt;
            &lt;filters&gt;
              &lt;filter&gt;
                ${basedir}/src/assembly/filter.properties
              &lt;/filter&gt;
            &lt;/filters&gt;
            &lt;descriptors&gt;
              &lt;descriptor&gt;src/assembly/bin.xml&lt;/descriptor&gt;
              &lt;descriptor&gt;src/assembly/src.xml&lt;/descriptor&gt;
              &lt;descriptor&gt;src/assembly/docs.xml&lt;/descriptor&gt;
            &lt;/descriptors&gt;
          &lt;/configuration&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;</pre></div><p>If you look at the<a id="id292" class="indexterm"/> first <code class="literal">execution</code> element, it associates the <code class="literal">attached</code> goal of the <code class="literal">assembly</code> plugin with the <code class="literal">test</code> phase of the <code class="literal">default</code> lifecycle. In the same manner, the second <code class="literal">execution</code> element associates the <code class="literal">attached</code> goal with the <code class="literal">package</code> phase of the <code class="literal">default</code> lifecycle.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note36"/>Note</h3><p>The Maven <code class="literal">default</code> lifecycle includes: <code class="literal">validate</code>, <code class="literal">initialize</code>, <code class="literal">generate-sources</code>, <code class="literal">process-sources</code>, <code class="literal">generate-resources</code>, <code class="literal">process-resources</code>, <code class="literal">compile</code>, <code class="literal">process-classes</code>, <code class="literal">generate-test-sources</code>, <code class="literal">process-test-sources</code>, <code class="literal">generate-test-resources</code>, <code class="literal">process-test-resources</code>, <code class="literal">test-compile</code>, <code class="literal">process-test-classes</code>, <code class="literal">test</code>, <code class="literal">prepare-package</code>, <code class="literal">package</code>, <code class="literal">pre-integration-test</code>, <code class="literal">integration-test</code>, <code class="literal">post-integration-test</code>, <code class="literal">verify</code>, <code class="literal">install</code>, <code class="literal">deploy</code>.</p></div></div><p>Everything inside the <code class="literal">configuration</code> element is plugin specific. In this case, the Maven <code class="literal">assembly</code> plugin knows how to process the <code class="literal">filters</code> and <code class="literal">descriptors</code> elements.</p><p>In this particular example, only the <code class="literal">attached</code> goal of the <code class="literal">assembly</code> plugin is used. The <code class="literal">assembly</code> plugin introduces eight goals; however, six of them are deprecated, including the <code class="literal">attached</code> goal. It is not recommended to use any of the deprecated goals. Later, we'll see how to use the <code class="literal">single</code> goal of the <code class="literal">assembly</code> plugin instead of the deprecated <code class="literal">attached</code> goal. The <a id="id293" class="indexterm"/>following lists out the six deprecated goals of the <code class="literal">assembly</code> plugin. In case you are using any of them, you should migrate your project to use the <code class="literal">single</code> goal, except for the fourth one, the <code class="literal">unpack</code> goal. For that, you need to use the <code class="literal">unpack</code> goal of the Maven <code class="literal">dependency</code> plugin. The following lists out the six deprecated goals of the assembly plugin:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:assembly</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:attached</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:directory</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:unpack</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:directory-single</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">assembly:directory-inline</code></li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note37"/>Note</h3><p>More details<a id="id294" class="indexterm"/> about the Maven <code class="literal">assembly</code> plugin and its goals can be found at <a class="ulink" href="http://maven.apache.org/plugins/maven-assembly-plugin/plugin-info.html">http://maven.apache.org/plugins/maven-assembly-plugin/plugin-info.html</a>.</p></div></div></div></div>
<div class="section" title="The assembly descriptor"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec42"/>The assembly descriptor</h1></div></div></div><p>The <code class="literal">assembly</code> descriptor <a id="id295" class="indexterm"/>is an XML-based configuration, which defines how to build an assembly and how its content should be structured.</p><p>If we go back to our previous example, the <code class="literal">attached</code> goal of the <code class="literal">assembly</code> plugin creates a binary distribution according to the <code class="literal">assembly</code> descriptor, both in the <code class="literal">test</code> and the <code class="literal">package</code> phases of the <code class="literal">default</code> Maven lifecycle. The <code class="literal">assembly</code> descriptors for each phase can be specified under the <code class="literal">descriptors</code> element. As in the case of this particular example, there are multiple <code class="literal">descriptor</code> elements defined under the <code class="literal">descriptors</code> parent element. For the <code class="literal">package</code> phase, it has three assembly descriptors, as shown in the following configuration:</p><div class="informalexample"><pre class="programlisting">&lt;descriptors&gt;
   &lt;descriptor&gt;src/assembly/bin.xml&lt;/descriptor&gt;
   &lt;descriptor&gt;src/assembly/src.xml&lt;/descriptor&gt;
   &lt;descriptor&gt;src/assembly/docs.xml&lt;/descriptor&gt;
&lt;/descriptors&gt;</pre></div><p>Each <code class="literal">descriptor</code> element instructs the <code class="literal">assembly</code> plugin from where to load the descriptor, and each <code class="literal">descriptor</code> file will be executed sequentially in the defined order.</p><p>Let's take a look at the <code class="literal">src/assembly/bin.xml</code> file, which is shown here:</p><div class="informalexample"><pre class="programlisting">&lt;assembly&gt;
  &lt;formats&gt;
    &lt;format&gt;zip&lt;/format&gt;
  &lt;/formats&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>The file path in the descriptor element is given relative to the root POM file under the <code class="literal">distribution</code> module. You<a id="id296" class="indexterm"/> can find the complete <code class="literal">bin.xml</code> file at <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/products/is/5.0.0/modules/distribution/src/assembly/bin.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/products/is/5.0.0/modules/distribution/src/assembly/bin.xml</a>.</p></div></div><p>The value of the <code class="literal">format</code> element specifies the ultimate type of the artifact to be produced. It can be <code class="literal">zip</code>, <code class="literal">tar</code>, <code class="literal">tar.gz</code>, <code class="literal">tar.bz2</code>, <code class="literal">jar</code>, <code class="literal">dir</code>, or <code class="literal">war</code>. You can use the same assembly descriptor to create multiple formats. In that case, you need to include multiple <code class="literal">format</code> elements under the <code class="literal">formats</code> parent element.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>Even though you can specify the format of the assembly in the <code class="literal">assembly</code> descriptor, it is recommended to do it via the plugin configuration. In the plugin configuration, you can define different formats for your assembly, as shown in the following block of code. The benefit here is that you can have multiple Maven profiles to build different archive types. We will discuss Maven profiles in <a class="link" href="ch07.html" title="Chapter 7. Best Practices">Chapter 7</a>, <span class="emphasis"><em>Best Practices</em></span>:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;configuration&gt;
        <span class="strong"><strong>&lt;formats&gt;</strong></span>
<span class="strong"><strong>          &lt;format&gt;zip&lt;/format&gt;</strong></span>
        <span class="strong"><strong>&lt;/formats&gt;</strong></span>   
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div></div></div><div class="informalexample"><pre class="programlisting">  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;</pre></div><p>When the <a id="id297" class="indexterm"/>value of the <code class="literal">includeBaseDirectory</code> element is set to <code class="literal">false</code>, the artifact will be created with no base directory. If this is set to <code class="literal">true</code>, which is the default value, the artifact will be created under the base directory. You can specify a value for the base directory under the <code class="literal">baseDirectory</code> element. In most cases, the value of <code class="literal">includeBaseDirectory</code> is set to <code class="literal">false</code> so that the final distribution unit directly packs all the artifacts right under it, without having another root directory:</p><div class="informalexample"><pre class="programlisting">  &lt;fileSets&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;target/wso2carbon-core-4.2.0&lt;/directory&gt;
      &lt;outputDirectory&gt;wso2is-${pom.version}&lt;/outputDirectory&gt;
      &lt;excludes&gt;
        &lt;exclude&gt;**/*.sh&lt;/exclude&gt;</pre></div><p>Each <code class="literal">fileSet</code> element under the <code class="literal">fileSets</code> parent element specifies the set of files to be assembled to build the final archive. The first <code class="literal">fileSet</code> element instructs to copy all the content from <code class="literal">directory</code> (which is <code class="literal">target/wso2carbon-core-4.2.0</code>) to the <code class="literal">outputDirectory</code>, excluding all the files defined under each <code class="literal">exclude</code> element. If no exclusions are defined, then all the content inside the <code class="literal">directory</code> will be copied into the <code class="literal">outputDirectory</code>. In this particular case, the value of <code class="literal">${pom.version}</code> will be replaced by the <code class="literal">version</code> of the artifact, defined in the <code class="literal">pom.xml</code> file under the <code class="literal">distribution</code> module.</p><p>The first <code class="literal">exclude</code> element instructs not to copy any file having the extension <code class="literal">.sh</code> from anywhere inside <code class="literal">target/wso2carbon-core-4.2.0</code> to the <code class="literal">outputDirectory</code> element:</p><div class="informalexample"><pre class="programlisting">        &lt;exclude&gt;**/wso2server.bat&lt;/exclude&gt;
        &lt;exclude&gt;**/axis2services/sample01.aar&lt;/exclude&gt;</pre></div><p>The second <code class="literal">exclude</code> element instructs not to copy any file having the name <code class="literal">wso2server.bat</code> from anywhere inside <code class="literal">target/wso2carbon-core-4.2.0</code> to <code class="literal">outputDirectory</code>.</p><p>The third <code class="literal">exclude</code> element instructs not to copy the file <code class="literal">axis2services</code> /<code class="literal">sample01.aar</code> from <a id="id298" class="indexterm"/>anywhere inside <code class="literal">target/wso2carbon-core-4.2.0</code> to <code class="literal">outputDirectory</code>:</p><div class="informalexample"><pre class="programlisting">        &lt;exclude&gt;**/axis2services/Echo.aar&lt;/exclude&gt;
        &lt;exclude&gt;**/axis2services/Version.aar&lt;/exclude&gt;
        &lt;exclude&gt;**/pom.xml&lt;/exclude&gt;
        &lt;exclude&gt;**/version.txt&lt;/exclude&gt;
        &lt;exclude&gt;**/README*&lt;/exclude&gt;
        &lt;exclude&gt;**/carbon.xml&lt;/exclude&gt;
        &lt;exclude&gt;**/axis2/*&lt;/exclude&gt;
        &lt;exclude&gt;**/LICENSE.txt&lt;/exclude&gt;
        &lt;exclude&gt;**/INSTALL.txt&lt;/exclude&gt;
        &lt;exclude&gt;**/release-notes.html&lt;/exclude&gt;
        &lt;exclude&gt;**/claim-config.xml&lt;/exclude&gt;
        &lt;exclude&gt;**/log4j.properties&lt;/exclude&gt;
        &lt;exclude&gt;**/registry.xml&lt;/exclude&gt;
      &lt;/excludes&gt;
    &lt;/fileSet&gt;
      
    &lt;fileSet&gt;
      &lt;directory&gt;
       <span class="strong"><strong>../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/conf/identity</strong></span>
      &lt;/directory&gt;
      &lt;outputDirectory&gt;wso2is-${pom.version}/repository/conf/identity
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;**/*.xml&lt;/include&gt;</strong></span>
      &lt;/includes&gt;</pre></div><p>The <code class="literal">include</code> element instructs to copy only the files having the <code class="literal">.xml</code> extension from anywhere inside the <code class="literal">../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/conf/identity</code> directory to <code class="literal">outputDirectory</code>. If no <code class="literal">include</code> element is defined, everything will be included:</p><div class="informalexample"><pre class="programlisting">    &lt;/fileSet&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;
      <span class="strong"><strong>../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/resources/security/ldif</strong></span>
      &lt;/directory&gt;
            
      &lt;outputDirectory&gt;wso2is-${pom.version}/repository/resources/security/ldif
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;identityPerson.ldif&lt;/include&gt;</strong></span>
        <span class="strong"><strong>&lt;include&gt;scimPerson.ldif&lt;/include&gt;</strong></span>
        <span class="strong"><strong>&lt;include&gt;wso2Person.ldif&lt;/include&gt;</strong></span>
      &lt;/includes&gt;</pre></div><p>The three <code class="literal">include</code> elements mentioned in the preceding code instruct to copy only the files having <a id="id299" class="indexterm"/>specific names from anywhere inside the <code class="literal">../p2-profile-gen/target/wso2carbon-core/4.2.0/repository/resources/security/ldif</code> directory to the <code class="literal">outputDirectory</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;/fileSet&gt;

    &lt;fileSet&gt;
      &lt;directory&gt;
      <span class="strong"><strong>../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/deployment/server/webapps</strong></span>
      &lt;/directory&gt;
      &lt;outputDirectory&gt;${pom.artifactId}-${pom.version}/repository/deployment/server/webapps
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;oauth2.war&lt;/include&gt;</strong></span>
      &lt;/includes&gt;</pre></div><p>The <code class="literal">include</code> element instructs to copy only the WAR file with the name <code class="literal">oauth2.war</code> from anywhere inside the <code class="literal">../p2-profile-gen/target/wso2carbon-core/4.2.0/repository/resources/deployment/server/webappas</code> directory to the <code class="literal">outputDirectory</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;/fileSet&gt;

    &lt;fileSet&gt;
      &lt;directory&gt;
        ../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/deployment/server/webapps
      &lt;/directory&gt;
      &lt;outputDirectory&gt;${pom.artifactId}-${pom.version}/repository/deployment/server/webapps
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        &lt;include&gt;authenticationendpoint.war&lt;/include&gt;
      &lt;/includes&gt;
    &lt;/fileSet&gt;

    &lt;fileSet&gt;
      &lt;directory&gt;
        <span class="strong"><strong>../styles/service/src/main/resources/web/styles/css</strong></span>
      &lt;/directory&gt;
      &lt;outputDirectory&gt;${pom.artifactId}-${pom.version}/resources/allthemes/Default/admin
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;**/**.css&lt;/include&gt;</strong></span>
      &lt;/includes&gt;</pre></div><p>The <code class="literal">include</code> element<a id="id300" class="indexterm"/> instructs to copy any file with the extension <code class="literal">.css</code> from anywhere inside the <code class="literal">../styles/service/src/main/resources/web/styles/css</code> directory to the <code class="literal">outputDirectory</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;/fileSet&gt;

    &lt;fileSet&gt;
      &lt;directory&gt;
       <span class="strong"><strong>../p2-profile-gen/target/WSO2-CARBON-PATCH-4.2.0-0006</strong></span>
      &lt;/directory&gt;
      &lt;outputDirectory&gt;
        wso2is-${pom.version}/repository/components/patches/
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;**/patch0006/*.*&lt;/include&gt;</strong></span>
      &lt;/includes&gt;</pre></div><p>The <code class="literal">include</code> element instructs to copy all the files inside the <code class="literal">patch006</code> directory from anywhere inside the <code class="literal">../p2-profile-gen/target/WSO2-CARBON-PATCH-4.2.0-0006</code> directory to <code class="literal">outputDirectory</code>:</p><div class="informalexample"><pre class="programlisting">    &lt;/fileSet&gt;
  &lt;/fileSets&gt;

  &lt;files&gt;</pre></div><p>The <code class="literal">files</code> element is very much similar to the <code class="literal">fileSets</code> element in terms of the key functionality. Both can be used to control the contents of the assembly.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip06"/>Tip</h3><p>The <code class="literal">files</code>/<code class="literal">file</code> element should be used when you are fully aware of the exact source file location while the <code class="literal">fileSets</code>/<code class="literal">fileSet</code> element is much flexible in picking files from a source based on a defined pattern.</p></div></div><p>The <code class="literal">fileMode</code> element<a id="id301" class="indexterm"/> in the following snippet defines a set of permissions to be attached to the copied file. The permissions are defined as per the four <a id="id302" class="indexterm"/>digit octal notation. You can read more about the four digit octal notation from <a class="ulink" href="http://en.wikipedia.org/wiki/File_system_permissions#Octal_notation_and_additional_permissions">http://en.wikipedia.org/wiki/File_system_permissions#Octal_notation_and_additional_permissions</a>:</p><div class="informalexample"><pre class="programlisting">    &lt;file&gt;
      &lt;source&gt;../p2-profile-gen/target/WSO2-CARBON-PATCH-${carbon.kernel.version}-0006/lib/org.wso2.ciphertool-1.0.0-wso2v2.jar
      &lt;/source&gt;
      &lt;outputDirectory&gt;
        ${pom.artifactId}-${pom.version}/lib/
      &lt;/outputDirectory&gt;
      &lt;filtered&gt;true&lt;/filtered&gt;
      &lt;fileMode&gt;644&lt;/fileMode&gt;
    &lt;/file&gt;
  &lt;files&gt;
&lt;/assembly&gt;</pre></div><p>There are three <code class="literal">descriptor</code> elements defined under the <code class="literal">assembly</code> plugin for the <code class="literal">package</code> phase. The one we discussed earlier will create the binary distribution, while the <code class="literal">src/assembly/src.xml</code> and <code class="literal">src/assembly/docs.xml</code> files will create the source distribution and the documentation distribution respectively.</p><p>Let's also look at the <code class="literal">assembly</code> descriptor defined for the <code class="literal">test</code> phase:</p><div class="informalexample"><pre class="programlisting">&lt;descriptors&gt;
  &lt;descriptor&gt;src/assembly/dist.xml&lt;/descriptor&gt;
&lt;/descriptors&gt;</pre></div><p>This is quite short and only includes the configuration required to build the initial distribution of the WSO2 Identity Server. Even though this project does this at the <code class="literal">test</code> phase, it seems like it has no value. In this case, it seems like <code class="literal">maven-antrun-plugin</code>, which is also associated with the <code class="literal">package</code> phase, but prior to the definition of the <code class="literal">assembly</code> plugin,<a id="id303" class="indexterm"/> needs the ZIP file distribution. Ideally, you should not have the <code class="literal">assembly</code> plugin run at the <code class="literal">test</code> phase unless there is a very strong reason to do so. You may need the distribution ready to run the integration tests; however, the integration tests should be executed in the <code class="literal">integration-test</code> phase, which comes after the <code class="literal">package</code> phase. In most cases, the <code class="literal">assembly</code> plugin is associated with the <code class="literal">package</code> phase of the Maven <code class="literal">default</code> lifecycle.</p><p>The following code<a id="id304" class="indexterm"/> shows the assembly descriptor defined in <code class="literal">src/assembly/dist.xml</code> for the <code class="literal">test</code> phase:</p><div class="informalexample"><pre class="programlisting">&lt;assembly&gt;
  &lt;formats&gt;
    &lt;format&gt;zip&lt;/format&gt;
  &lt;/formats&gt;
  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
  &lt;fileSets&gt;
    &lt;!-- Copying p2 profile and osgi bundles--&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;
        ../p2-profile-gen/target/wso2carbon-core-4.2.0/repository/components
      &lt;/directory&gt;
      &lt;outputDirectory&gt;wso2is-${pom.version}/repository/components
      &lt;/outputDirectory&gt;
      &lt;excludes&gt;
        &lt;exclude&gt;**/eclipse.ini&lt;/exclude&gt;
        &lt;exclude&gt;**/*.lock&lt;/exclude&gt;
        &lt;exclude&gt;**/.data&lt;/exclude&gt;
        &lt;exclude&gt;**/.settings&lt;/exclude&gt;
      &lt;/excludes&gt;
    &lt;/fileSet&gt;
  &lt;/fileSets&gt;
  &lt;dependencySets&gt;
<span class="strong"><strong>    &lt;dependencySet&gt;</strong></span>
      &lt;outputDirectory&gt;
         wso2is-${pom.version}/repository/deployment/client/modules
      &lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;org.apache.rampart:rampart:mar&lt;/include&gt;</strong></span>
      &lt;/includes&gt;
<span class="strong"><strong>    &lt;/dependencySet&gt;</strong></span>
  &lt;/dependencySets&gt;
&lt;/assembly&gt;</pre></div><p>This<a id="id305" class="indexterm"/> configuration introduces a new element that we have not seen before, that is, <code class="literal">dependencySet</code>. The <code class="literal">dependencySet</code> element lets you include or exclude project dependencies to/from the final assembly that we are building. In the previous example, it adds the <code class="literal">rampart</code> module into the <code class="literal">outputDirectory</code> element. The value of the <code class="literal">include</code> element should be in the format of <code class="literal">groupdId:artifactId:type[:classifier][:version]</code>. Maven will first look for this artifact with the defined coordinates in its local Maven repository, and if found, it will copy it to the location defined under the <code class="literal">outputDirectory</code> element.</p><p>Unlike the <code class="literal">fileSet</code> and <code class="literal">file</code> elements, the <code class="literal">dependencySet</code> element does not define a concrete path to pick and copy the dependency from. Maven finds the artifacts via the defined coordinates. If you want to include a dependency just by its <code class="literal">groupId</code> element and the <code class="literal">artifactId</code> coordinates, then you can follow the pattern <code class="literal">groupdId:artifactId</code>. The particular artifact should be declared under the <code class="literal">dependencies</code> section of the POM file, which has the <code class="literal">assembly</code> plugin defined. You can find the following dependency definition for the <code class="literal">rampart</code> module in the POM file under the <code class="literal">distribution</code> module. If two versions of the same dependency are being defined in the same POM file (which is rather unlikely), then the last in the order will be copied:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.rampart&lt;/groupId&gt;
  &lt;artifactId&gt;rampart&lt;/artifactId&gt;
  &lt;type&gt;mar&lt;/type&gt;
  &lt;version&gt;1.6.1-wso2v12&lt;/version&gt;
&lt;/dependency&gt;</pre></div><p>You can also include a dependency by its <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">type</code>, as shown in the following configuration. Then, you can follow the pattern <code class="literal">groupdId:artifactId:type[:classifier]</code>. This is the exact pattern followed in the previous example:</p><div class="informalexample"><pre class="programlisting">&lt;includes&gt;
  <span class="strong"><strong>&lt;include&gt;org.apache.rampart:rampart:mar&lt;/include&gt;</strong></span>
&lt;/includes&gt;</pre></div><p>If you <a id="id306" class="indexterm"/>want to be more precise, you can also include the version into the pattern. In this case, it will look like this:</p><div class="informalexample"><pre class="programlisting">&lt;includes&gt;
  &lt;include&gt;
    <span class="strong"><strong>org.apache.rampart:rampart:mar:1.6.1-wso2v12</strong></span>
  &lt;/include&gt;
&lt;/includes&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>Most of the time we talk about four Maven coordinates; however, to be precise, there are five. A Maven artifact can be uniquely identified by these five coordinates: <code class="literal">groupdId:artifactId:type[:classifier]:version</code>. We have already discussed the four main coordinates, but not the <code class="literal">classifier</code>. This is very rarely used; it can be quite useful in a scenario where we build an artifact out of the same POM file but with multiple target environments. We will be talking about <code class="literal">classifiers</code> in detail in <a class="link" href="ch07.html" title="Chapter 7. Best Practices">Chapter 7</a>, <span class="emphasis"><em>Best Practices</em></span>.</p></div></div><p>The previous example only covered a very small subset of the <code class="literal">assembly</code> descriptor. You can find all available<a id="id307" class="indexterm"/> configuration options at <a class="ulink" href="http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html">http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html</a>, which is quite an exhaustive list.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip07"/>Tip</h3><p>It is a best practice or a convention to include all the assembly <code class="literal">descriptor</code> files inside a directory called <code class="literal">assembly</code>, though it is not mandatory.</p></div></div><p>Let's take a look at another real-world example with <span class="strong"><strong>Apache Axis2</strong></span>. Axis2 is an open source project released <a id="id308" class="indexterm"/>under the Apache 2.0 license. Axis2 has three types of distributions: a binary distribution as a ZIP file, a WAR file distribution, and a source distribution as a ZIP file. The binary ZIP distribution of Axis2 can be run on its own, while the WAR distribution must be deployed in a Java EE application server.</p><p>All three<a id="id309" class="indexterm"/> Axis2 distributions are created from the POM file inside the <code class="literal">distribution</code> module, which can be found at <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/distribution/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/distribution/pom.xml</a>.</p><p>This POM file associates the <code class="literal">single</code> goal of the Maven <code class="literal">assembly</code> plugin with the project, which<a id="id310" class="indexterm"/> initiates the process of creating the final distribution artifacts. The assembly configuration points to three different <code class="literal">assembly</code> descriptors—one for the ZIP distribution, the second for the WAR distribution, and the third for the source code distribution. The following code snippet shows the <code class="literal">assembly</code> plugin configuration:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;distribution-package&lt;/id&gt;
      &lt;phase&gt;package&lt;/phase&gt;
      &lt;goals&gt;
        <span class="strong"><strong>&lt;goal&gt;single&lt;/goal&gt;</strong></span>
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;finalName&gt;axis2-${project.version}&lt;/finalName&gt;
        <span class="strong"><strong>&lt;descriptors&gt;   </strong></span>
          <span class="strong"><strong>&lt;descriptor&gt;</strong></span>
<span class="strong"><strong>           src/main/assembly/war-assembly.xml</strong></span>
          <span class="strong"><strong>&lt;/descriptor&gt;</strong></span>
          <span class="strong"><strong>&lt;descriptor&gt;</strong></span>
<span class="strong"><strong>           src/main/assembly/src-assembly.xml</strong></span>
          <span class="strong"><strong>&lt;/descriptor&gt;</strong></span>
          <span class="strong"><strong>&lt;descriptor&gt;</strong></span>
<span class="strong"><strong>           src/main/assembly/bin-assembly.xml</strong></span>
          <span class="strong"><strong>&lt;/descriptor&gt;</strong></span>
        <span class="strong"><strong>&lt;/descriptors&gt;</strong></span>
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>Let's take a look at the <code class="literal">bin-assembly.xml</code> file—the <code class="literal">assembly</code> descriptor, which builds the ZIP distribution:</p><div class="informalexample"><pre class="programlisting">&lt;assembly&gt;
  &lt;id&gt;bin&lt;/id&gt;
  &lt;includeBaseDirectory&gt;true&lt;/includeBaseDirectory&gt; 
  &lt;baseDirectory&gt;axis2-${version}&lt;/baseDirectory&gt;
  &lt;formats&gt;
    &lt;!--&lt;format&gt;tar.gz&lt;/format&gt;  
    //uncomment,if tar.gz archive needed--&gt;
    <span class="strong"><strong>&lt;format&gt;zip&lt;/format&gt;</strong></span>
  &lt;/formats&gt;</pre></div><p>This is exactly <a id="id311" class="indexterm"/>what we discussed earlier, and exactly what we wanted to avoid due to the same reason as in the comment, in the preceding code snippet. If we want to build a <code class="literal">tar.gz</code> distribution, then we need to modify the file. Instead of doing that, we can move the <code class="literal">format</code> configuration element out of the <code class="literal">assembly</code> descriptor to the plugin configuration defined in the <code class="literal">pom.xml</code> file. Then, you can define multiple profiles and configure the archive type based on the profile:</p><div class="informalexample"><pre class="programlisting">  &lt;fileSets&gt;    
     ………………..
  &lt;/fileSets&gt;
    
  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      <span class="strong"><strong>&lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;</strong></span>
</pre></div><p>The <code class="literal">useProjectArtifact</code> configuration element instructs the plugin whether to include the artifact produced in this project build into the <code class="literal">dependencySet</code> element. By setting the value to <code class="literal">false</code>, we avoid it:</p><div class="informalexample"><pre class="programlisting">      &lt;outputDirectory&gt;lib&lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;*:*:jar&lt;/include&gt;</strong></span>
      &lt;/includes&gt;
      &lt;excludes&gt;
        <span class="strong"><strong>&lt;exclude&gt;</strong></span>
<span class="strong"><strong>         org.apache.geronimo.specs:geronimo-activation_1.1_spec:jar</strong></span>
        <span class="strong"><strong>&lt;/exclude&gt;</strong></span>
      &lt;/excludes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;
      &lt;outputDirectory&gt;lib/endorsed&lt;/outputDirectory&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;javax.xml.bind:jaxb-api:jar&lt;/include&gt;</strong></span>
      &lt;/includes&gt;
    &lt;/dependencySet&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;
      &lt;includes&gt;
        <span class="strong"><strong>&lt;include&gt;org.apache.axis2:axis2-webapp&lt;/include&gt;</strong></span>
      &lt;/includes&gt;
      <span class="strong"><strong>&lt;unpack&gt;true&lt;/unpack&gt;</strong></span>
</pre></div><p>The <code class="literal">includes</code> and <code class="literal">excludes</code> configuration elements will ensure that all the artifacts defined under the <code class="literal">dependencies</code> section of the <code class="literal">distribution/pom.xml</code> file will be included in the assembly, except the artifacts defined under the <code class="literal">excludes</code> configuration element. If you do not have any <code class="literal">include</code> elements, all the dependencies defined in the POM file will<a id="id312" class="indexterm"/> be included in the assembly, except what is defined under the <code class="literal">excludes</code> section.</p><p>Once the <code class="literal">unpack</code> configuration element is set to <code class="literal">true</code>, all the dependencies defined under the <code class="literal">include</code> elements will be unpacked into <code class="literal">outputDirectory</code>. The plugin is capable of unpacking <code class="literal">jar</code>, <code class="literal">zip</code>, <code class="literal">tar.gz</code>, and <code class="literal">tar.bz</code> archives. The <code class="literal">unpackOptions</code> configuration element, shown in the following configuration, can be used to filter out the content of the dependencies getting unpacked. According to the following configuration, only the files defined under the <code class="literal">include</code> elements under the <code class="literal">unpackOptions</code> element will be included; the rest will be ignored and won't be included in the assembly. In this particular case, <code class="literal">axis2-webapp</code> is a WAR file (which is defined under the <code class="literal">include</code> element of the previous configuration) and the <code class="literal">distributions/pom.xml</code> file has a dependency to it. This web app will be exploded (extracted), and then all the files inside the <code class="literal">WEB-INF/classes</code> and <code class="literal">axis2-web</code> directories will be copied into the <code class="literal">webapp</code> directory of the ZIP distribution, along with the <code class="literal">WEB-INF/web.xml</code> file:</p><div class="informalexample"><pre class="programlisting">      &lt;outputDirectory&gt;<span class="strong"><strong>webapp</strong></span>&lt;/outputDirectory&gt;
      <span class="strong"><strong>&lt;unpackOptions&gt;</strong></span>
        <span class="strong"><strong>&lt;includes&gt;</strong></span>
          <span class="strong"><strong>&lt;include&gt;WEB-INF/classes/**/*&lt;/include&gt;</strong></span>
          <span class="strong"><strong>&lt;include&gt;WEB-INF/web.xml&lt;/include&gt;</strong></span>
          <span class="strong"><strong>&lt;include&gt;axis2-web/**/*&lt;/include&gt;</strong></span>
        <span class="strong"><strong>&lt;/includes&gt;</strong></span>
      <span class="strong"><strong>&lt;/unpackOptions&gt;</strong></span>
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;
&lt;/assembly&gt;</pre></div><p>Now, let's take a look at <code class="literal">war-assembly.xml</code>—the assembly descriptor, which builds the WAR distribution. There is nothing new in this configuration, except the <code class="literal">outputFileNameMapping</code> configuration element. Since the value of the <code class="literal">format</code> element is set to <code class="literal">zip</code>, this <code class="literal">assembly</code> descriptor will produce an archive file conforming to the ZIP file specification. The value of the <code class="literal">outputFileNameMapping</code> configuration element gets applied to all the dependencies. The default value is parameterized: <code class="literal">${artifactId}-${version}${classifier?}.${extension}</code>. In this case, it's hardcoded to <code class="literal">axis2.war</code>, so the <code class="literal">axis2-webapp</code> artifact will be copied to the location defined under the <code class="literal">outputDirectory</code> element as <code class="literal">axis2.war</code>. Since there is no value defined for the <code class="literal">outputDirectory</code> element, the<a id="id313" class="indexterm"/> files will be copied to the root location, as shown here:</p><div class="informalexample"><pre class="programlisting">&lt;assembly&gt;
  &lt;id&gt;war&lt;/id&gt;
  &lt;includeBaseDirectory&gt;false&lt;/includeBaseDirectory&gt;
  &lt;formats&gt;
    &lt;format&gt;zip&lt;/format&gt;
  &lt;/formats&gt;
  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;
      &lt;includes&gt;
        &lt;include&gt;org.apache.axis2:axis2-webapp&lt;/include&gt;
      &lt;/includes&gt;
      &lt;outputFileNameMapping&gt;axis2.war&lt;/outputFileNameMapping&gt;
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;
  &lt;fileSets&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;../..&lt;/directory&gt;
      &lt;outputDirectory&gt;&lt;/outputDirectory&gt;
        &lt;includes&gt;
          &lt;include&gt;LICENSE.txt&lt;/include&gt;
          &lt;include&gt;NOTICE.txt&lt;/include&gt;
          &lt;include&gt;README.txt&lt;/include&gt;
          &lt;include&gt;release-notes.html&lt;/include&gt;
        &lt;/includes&gt;
      &lt;filtered&gt;true&lt;/filtered&gt;
    &lt;/fileSet&gt;
  &lt;/fileSets&gt;
&lt;/assembly&gt;</pre></div></div>
<div class="section" title="Artifact/resource filtering"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec43"/>Artifact/resource filtering</h1></div></div></div><p>We had a <code class="literal">filters</code> configuration, defined for the <code class="literal">assembly</code> plugin in the first example with the WSO2 Identity Server. This instructs the <code class="literal">assembly</code> plugin to apply the filter criteria defined in<a id="id314" class="indexterm"/> the provided filter or the set of filters for the files that are being copied to the final archive file. If you want to apply a filter to a given file, then you should set the value of the <code class="literal">filtered</code> element to <code class="literal">true</code>.</p><p>The following configuration shows how to define a filter:</p><div class="informalexample"><pre class="programlisting">&lt;filters&gt;
  &lt;filter&gt;${basedir}/src/assembly/filter.properties&lt;/filter&gt;
&lt;/filters&gt;</pre></div><p>Let's take a look at the file <code class="literal">${basedir}/src/assembly/filter.properties</code>. This file defines a set of name/value pairs. The name is a special placeholder, which should be enclosed between <code class="literal">${</code> and <code class="literal">}</code> in the file to be filtered, and it will be replaced by the value during the filtering process:</p><div class="informalexample"><pre class="programlisting">product.name=WSO2 Identity Server 
product.key=IS 
product.version=5.0.0 
hotdeployment=true 
hotupdate=true 
default.server.role=IdentityServer</pre></div></div>
<div class="section" title="Assembly help"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec44"/>Assembly help</h1></div></div></div><p>As we discussed earlier, the <code class="literal">assembly</code> plugin currently only has two active goals: <code class="literal">single</code> and <code class="literal">help</code>; all the others are deprecated. As we witnessed in the previous example, the <code class="literal">single</code> goal<a id="id315" class="indexterm"/> is responsible for creating the archive with <a id="id316" class="indexterm"/>all sorts of other configurations.</p><p>The following command shows how to execute the <code class="literal">help</code> goal of the <code class="literal">assembly</code> plugin. This has to be executed from a directory with a POM file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn assembly:help -Ddetail=true</strong></span>
</pre></div><p>If you see the following error when you run this command, you may not have the latest version. In that<a id="id317" class="indexterm"/> case, update the plugin version to 2.4.1 or<a id="id318" class="indexterm"/> later:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[ERROR] Could not find goal 'help' in plugin org.apache.maven.plugins:maven-assembly-plugin:2.2-beta-2 among available goals assembly, attach-assembly-descriptor, attach-component-descriptor, attached, directory-inline, directory, directory-single, single, unpack -&gt; [Help 1]</strong></span>
</pre></div></div>
<div class="section" title="A runnable standalone Maven project"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec45"/>A runnable standalone Maven project</h1></div></div></div><p>Since we have covered a lot of ground-related information of the Maven <code class="literal">assembly</code> plugin, let's see how to build a complete end-to-end runnable standalone project with the <code class="literal">assembly</code> plugin. You<a id="id319" class="indexterm"/> can find the complete sample at <a class="ulink" href="https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter06">https://svn.wso2.org/repos/wso2/people/prabath/maven-mini/chapter06</a>. Proceed with the following steps to create a runnable standalone Maven project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, create <a id="id320" class="indexterm"/>a directory structure, as shown here:<div class="informalexample"><pre class="programlisting">       |-pom.xml
       |-modules
         |- json-parser
            |- src/main/java/com/packt/json/JSONParser.java
            |- pom.xml
         |- distribution
            |- src/main/assembly/dist.xml
            |- pom.xml</pre></div></li><li class="listitem">The <code class="literal">JSONParser.java</code> file is a simple Java class, which reads a JSON file and prints to the console, as shown here:<div class="informalexample"><pre class="programlisting">package com.packt.json;

import java.io.File;
import java.io.FileReader;
import org.json.simple.JSONObject;

public class JSONParser {

  public static void main(String[] args) {

  FileReader fileReader;
  JSONObject json;

  org.json.simple.parser.JSONParser parser;
  parser = new org.json.simple.parser.JSONParser();

    try {

      if (args == null || args.length == 0 || args[0] == null || !new File(args[0]).exists())   
      {
        System.out.println("No valid JSON file provided");
      } else {
        fileReader = new FileReader(new File(args[0]));
        json = (JSONObject) parser.parse(fileReader);
      
        if (json != null) {
          System.out.println(json.toJSONString());
        }
      }
     } catch (Exception e) {
      e.printStackTrace();
     }
  }
}</pre></div></li><li class="listitem">Now, we <a id="id321" class="indexterm"/>can create a POM file under <code class="literal">modules/json-parser</code> to build our JAR file, as follows:<div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;json-parser&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;PACKT JSON Parser&lt;/name&gt;

  &lt;dependencies&gt;
     &lt;dependency&gt;
      &lt;groupId&gt;com.googlecode.json-simple
      &lt;/groupId&gt;
      &lt;artifactId&gt;json-simple&lt;/artifactId&gt;
      &lt;version&gt;1.1&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

&lt;/project&gt;</pre></div></li><li class="listitem">Once we are done with the <code class="literal">json-parser</code> module, the next step is to create the <code class="literal">distribution</code> module. The <code class="literal">distribution</code> module will have a POM file and an <code class="literal">assembly</code> descriptor. Let's first create the POM file under <code class="literal">modules/distribution</code>, which is shown here. This will associate two plugins with the project: <code class="literal">maven-assembly-plugin</code> and <code class="literal">maven-jar-plugin</code>. Both<a id="id322" class="indexterm"/> the plugins get executed in the <code class="literal">package</code> phase of the Maven <code class="literal">default</code> lifecycle. Since the <code class="literal">maven-assembly-plugin</code> is defined prior to the <code class="literal">maven-jar-plugin</code>, it will get executed first:<div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;json-parser-dist&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;PACKT JSON Parser Distribution&lt;/name&gt;

  &lt;dependencies&gt;
<span class="strong"><strong>&lt;!—</strong></span>
<span class="strong"><strong>Under the dependencies section we have to specify all the dependent jars that must be assembled into the final artifact. In this case we have two jar files. The first one is the external dependency that we used to parse the JSON file and the second one includes the class </strong></span>
<span class="strong"><strong>we wrote.</strong></span>
<span class="strong"><strong>--&gt;</strong></span>
    &lt;dependency&gt;
      &lt;groupId&gt;com.googlecode.json-simple&lt;/groupId&gt;
      &lt;artifactId&gt;json-simple&lt;/artifactId&gt;
      &lt;version&gt;1.1&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.packt&lt;/groupId&gt;
      &lt;artifactId&gt;json-parser&lt;/artifactId&gt;
      &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;distribution-package&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;single&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;finalName&gt;json-parser&lt;/finalName&gt;
              &lt;descriptors&gt;
                <span class="strong"><strong>&lt;descriptor&gt;</strong></span>
<span class="strong"><strong>                   src/main/assembly/dist.xml</strong></span>
                <span class="strong"><strong>&lt;/descriptor&gt;</strong></span>
              &lt;/descriptors&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;

<span class="strong"><strong>&lt;!—</strong></span>
<span class="strong"><strong>Even though the maven-jar-plugin is inherited from the super pom, here we have redefined it because we need to add some extra configurations. Since we need to make our final archive executable, we need to define the class to be executable in the jar manifest. Here we have set com.packt.json.JSONParser as our main class. Also – the classpath is set to the lib directory. If you look at the assembly descriptor used in the assembly plugin, you will notice that, the dependent jar files are copied into the lib directory. The manifest configuration in the maven-jar-plugin will result in the following manifest file (META-INF/MANIFEST.MF).</strong></span>

<span class="strong"><strong>Manifest-Version: 1.0</strong></span>
<span class="strong"><strong>Archiver-Version: Plexus Archiver</strong></span>
<span class="strong"><strong>Created-By: Apache Maven</strong></span>
<span class="strong"><strong>Built-By: prabath</strong></span>
<span class="strong"><strong>Build-Jdk: 1.6.0_65</strong></span>
<span class="strong"><strong>Main-Class: com.packt.json.JSONParser</strong></span>
<span class="strong"><strong>Class-Path: lib/json-simple-1.1.jar lib/json-parser-</strong></span>
<span class="strong"><strong>1.0.0.jar</strong></span>
<span class="strong"><strong>--&gt;</strong></span>

      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.3.1&lt;/version&gt;
        &lt;configuration&gt;
          &lt;archive&gt;
            <span class="strong"><strong>&lt;manifest&gt;</strong></span>
<span class="strong"><strong>             &lt;addClasspath&gt;true&lt;/addClasspath&gt;</strong></span>
<span class="strong"><strong>             &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;</strong></span>
<span class="strong"><strong>             &lt;mainClass&gt;com.packt.json.JSONParser</strong></span>
<span class="strong"><strong>             &lt;/mainClass&gt;</strong></span>
            <span class="strong"><strong>&lt;/manifest&gt;</strong></span>
          &lt;/archive&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;

    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;</pre></div></li><li class="listitem">The following<a id="id323" class="indexterm"/> configuration shows the <code class="literal">assembly</code> descriptor (<code class="literal">module/distribution/src/main/assembly/dist.xml</code>), corresponding to the <code class="literal">assembly</code> plugin defined in the previous step:<div class="informalexample"><pre class="programlisting">&lt;assembly&gt;
  &lt;id&gt;bin&lt;/id&gt;
  &lt;formats&gt;
    &lt;format&gt;zip&lt;/format&gt;
  &lt;/formats&gt;

  &lt;dependencySets&gt;
    &lt;dependencySet&gt;
      &lt;useProjectArtifact&gt;false&lt;/useProjectArtifact&gt;
      &lt;outputDirectory&gt;lib&lt;/outputDirectory&gt;
      &lt;unpack&gt;false&lt;/unpack&gt;
    &lt;/dependencySet&gt;
  &lt;/dependencySets&gt;

  &lt;fileSets&gt;
    &lt;fileSet&gt;
      &lt;directory&gt;${project.build.directory}&lt;/directory&gt;
      &lt;outputDirectory&gt;&lt;/outputDirectory&gt;
      <span class="strong"><strong>&lt;includes&gt;</strong></span>
<span class="strong"><strong>        &lt;include&gt;*.jar&lt;/include&gt;</strong></span>
<span class="strong"><strong>      &lt;/includes&gt;</strong></span>
    &lt;/fileSet&gt;
  &lt;/fileSets&gt;
&lt;/assembly&gt;</pre></div></li><li class="listitem">Now, we<a id="id324" class="indexterm"/> are done with the <code class="literal">distribution</code> module too. Next, we will create the root POM file, which aggregates both the <code class="literal">json-parser</code> and <code class="literal">distribution</code> modules, as follows:<div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt&lt;/groupId&gt;
  &lt;artifactId&gt;json-parser-aggregator&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;name&gt;PACKT JSON Parser Aggregator&lt;/name&gt;
  &lt;modules&gt;
    &lt;module&gt;modules/json-parser&lt;/module&gt;
    &lt;module&gt;modules/distribution&lt;/module&gt;
  &lt;/modules&gt;
&lt;/project&gt;</pre></div></li><li class="listitem">We are all set to build the project. From the root directory, type <code class="literal">mvn clean install</code>. This will produce the <code class="literal">json-parser-bin.zip</code> archive inside the <code class="literal">modules/distribution/target</code> directory. The output will be as follows:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[INFO] ----------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Reactor Summary:</strong></span>
<span class="strong"><strong>[INFO] </strong></span>
<span class="strong"><strong>[INFO] PACKT JSON Parser............... SUCCESS [  1.790 s]</strong></span>
<span class="strong"><strong>[INFO] PACKT JSON Parser Distribution.. SUCCESS [  0.986 s]</strong></span>
<span class="strong"><strong>[INFO] PACKT JSON Parser Aggregator.... SUCCESS [  0.014 s]</strong></span>
<span class="strong"><strong>[INFO] ----------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong>[INFO] ----------------------------------------------------</strong></span>
</pre></div></li><li class="listitem">Go to <code class="literal">modules/distribution/target</code> and unzip <code class="literal">json-parser-bin.zip</code>.</li><li class="listitem">To run the parser, type the following command, which will produce <code class="literal">No valid JSON file provided</code> as the output:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ java -jar json-parser/json-parser-dist-1.0.0.jar</strong></span>
</pre></div></li><li class="listitem">Once <a id="id325" class="indexterm"/>again, run the parser with a valid JSON file. You need to pass the path to the JSON file as an argument:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ java -jar json-parser/json-parser-dist-1.0.0.jar myjsonfile.json</strong></span>
</pre></div><p>The following is the output produced by the preceding command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong> "bookName"  : "Mastering Maven", "publisher" : "PACKT"</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li></ol></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec46"/>Summary</h1></div></div></div><p>In this chapter, we focused on the Maven <code class="literal">assembly</code> plugin. The <code class="literal">assembly</code> plugin provides a way of building custom archive files, aggregating many other custom configurations and resources. Most of the Java based products use the <code class="literal">assembly</code> plugin to build the final distribution artifacts. These can be a binary distribution, a source code distribution, or even a documentation distribution. This chapter covered real-world examples on how to use the Maven <code class="literal">assembly</code> plugin in detail, and finally, concluded with an end-to-end sample Maven project.</p><p>In the next chapter, we will discuss best practices in Maven.</p></div></body></html>