<html><head></head><body><div class="chapter" title="Chapter&#xA0;14.&#xA0;WildFly into the Cloud with OpenShift"><div class="titlepage"><div><div><h1 class="title"><a id="ch14"/>Chapter 14. WildFly into the Cloud with OpenShift</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Registering to OpenShift Online</li><li class="listitem" style="list-style-type: disc">Installing the WildFly cartridge for our first deployment</li><li class="listitem" style="list-style-type: disc">Taking control of your WildFly server via SSH</li><li class="listitem" style="list-style-type: disc">Deploying your code to OpenShift Online</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch14lvl1sec109"/>Introduction</h1></div></div></div><p>In this chapter, you will learn what OpenShift is, and how you can take advantage of it by deploying your application directly to the Internet on the cloud.</p><p>First of all, OpenShift is a <a id="id1043" class="indexterm"/><span class="strong"><strong>Platform as a Service</strong></span>, which stands for the famous acronym <span class="strong"><strong>PaaS</strong></span>. OpenShift is Red Hat's PaaS, and you can find it in three different versions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>OpenShift Origin</strong></span>: This <a id="id1044" class="indexterm"/>one is the free and open source version of OpenShift. You can find its code stream on GitHub at <a class="ulink" href="https://github.com/openshift/origin">https://github.com/openshift/origin</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>OpenShift Online</strong></span>: OpenShift <a id="id1045" class="indexterm"/>Online (OSO) is the version that we will use in this chapter. For the moment you just need to know that it's a free PaaS, where you can deploy your application based on your favorite environment. We will discuss it later in the chapter. OpenShift Online is available for free at <a class="ulink" href="https://www.openshift.com">https://www.openshift.com</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>OpenShift Enterprise</strong></span>: OpenShift <a id="id1046" class="indexterm"/>Enterprise (OSE) is the version for which Red Hat provides support at the enterprise level.</li></ul></div><p>As mentioned in the book <span class="emphasis"><em>Getting Started with OpenShift</em></span>, <span class="emphasis"><em>O'Reilly</em></span>:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>OSE is intended for customers who want stability and a production-ready install out of the box. Since stability is paramount, some of the features found in Origin or Online may not be in Enterprise for a release or two.</em></span></p></blockquote></div><p>Anyway, what is OpenShift all about? OpenShift is a lot of things, but from my experience, I think that the word self-provisioning is the one that fits it better. Developers and/or sysadmins can access the system and provision themselves their own environment, on the fly. Resources, runtime, network: all you need is there for you at one click.</p><p>Another thing OpenShift can do for you is autoscaling. If you deploy your application on OpenShift and flag the option for "autoscaling", whenever your site gets more traffic, your infrastructure scales; more "nodes" are added in order to handle more and more requests. Still, "automagically", whenever your application traffic decreases, OpenShift gets back the extra resources.</p><p>In OpenShift you need to understand three main concepts:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Gear</strong></span>: Think about it as a <a id="id1047" class="indexterm"/>server that provides you the resources that you need, such as RAM, CPU, and disk space. In OpenShift Online you can find three types of gear: small, medium, and large. They all have 1 GB of disk space. The small gear has 512 MB of RAM, medium gear has 1 GB of RAM, and the large gear has 2 GB of RAM.<div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip16"/>Tip</h3><p>OpenShift Online gives you three small gears for free. If you want more or want to get different types, you need to purchase them.</p></div></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Cartridge</strong></span>: Think of it as a <a id="id1048" class="indexterm"/>plugin. A cartridge is the host of your services or applications. For example, if you have a Java web application, your cartridge might be WildFly, JBoss AS, or Tomcat. Cartridges can be of two types:<div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Standalone</strong></span>: This is like WildFly, JBoss AS, and Vert.x; basically the application server that your application runs on</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Embedded</strong></span>: This is a functionality cartridge such as a database cartridge</li></ul></div></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Application</strong></span>: Without <a id="id1049" class="indexterm"/>turning around too much, it's your application that runs on OpenShift. OpenShift exposes three ports for incoming traffic: SSH on port 22, HTTP on port 80, and HTTPS on port 443.</li></ul></div><p>This is essentially the basics you need to know in order to work with OpenShift Online. A plus would be an understanding of the basis of Git (a distributed version control software), but we will see it when needed.</p><p>Let's begin!</p></div></div>
<div class="section" title="Registering to OpenShift Online"><div class="titlepage"><div><div><h1 class="title"><a id="ch14lvl1sec110"/>Registering to OpenShift Online</h1></div></div></div><p>In this recipe, you will <a id="id1050" class="indexterm"/>learn how to register for a free OpenShift Online account. This is a warm-up recipe, which will enable us to get acquainted with the overall infrastructure.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec312"/>Getting ready</h2></div></div></div><p>As we will operate just online, all you need to have is an Internet connection for the next 10 minutes.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec313"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a browser of your <a id="id1051" class="indexterm"/>choice and point it to <a class="ulink" href="http://www.openshift.com">http://www.openshift.com</a>.</li><li class="listitem">Once there, click on the <span class="strong"><strong>Online</strong></span> box (to the extreme left), as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_14_01.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift home page</p></div></div></li><li class="listitem">The next step is to fill <a id="id1052" class="indexterm"/>in the registration form by providing a valid, working e-mail ID and choosing a password, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/3744_14_02.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online registration form</p></div></div></li><li class="listitem">Once done, hit the <span class="strong"><strong>Sign Up</strong></span> button and wait for a confirmation mail, as warned in the following message:<div class="mediaobject"><img src="graphics/3744_14_03.jpg" alt="How to do it…"/><div class="caption"><p>Message warning for a confirmation mail</p></div></div></li><li class="listitem">You may need to <a id="id1053" class="indexterm"/>wait a few minutes and even check for it in the <span class="strong"><strong>Spam</strong></span> folder. The mail should look like the following screenshot:<div class="mediaobject"><img src="graphics/3744_14_04.jpg" alt="How to do it…"/><div class="caption"><p>The e-mail sent by OpenShift Online</p></div></div></li><li class="listitem">Click on the link labeled <span class="strong"><strong>Verify Your Account</strong></span> to activate your account.</li><li class="listitem">You will be prompted to accept the <span class="strong"><strong>OpenShift Service Agreement</strong></span> and <span class="strong"><strong>Red Hat Portal Terms of Use</strong></span>, as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_14_05.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift service agreement and Red Hat portal terms of use acceptance form</p></div></div></li><li class="listitem">If you want, you can also flag the <span class="strong"><strong>Sign me up for OpenShift email</strong></span> and click the <span class="strong"><strong>I Accept</strong></span> button.</li></ol></div><p>Great, you are now ready <a id="id1054" class="indexterm"/>to deploy into the cloud and provide your applications to the world!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec314"/>How it works…</h2></div></div></div><p>The process is pretty straightforward and quick. What is worth mentioning again, is the type of account you get.</p><p>Once you log in to your OpenShift Online account, at the upper-right corner of the screen, you can find your username with a down arrow. If you click on it, you will see a little menu; click on the first item labeled <span class="strong"><strong>My Account</strong></span>.</p><p>It should provide you with a page like the following:</p><div class="mediaobject"><img src="graphics/3744_14_06.jpg" alt="How it works…"/><div class="caption"><p>OpenShift Online "My Account" page</p></div></div><p>In that page there are four things that need to be noticed:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">On the left is your login e-mail and your account type; it's always better to check.</li><li class="listitem" style="list-style-type: disc">On the upper-right side of the screen is a grayed bold label specifying the <span class="strong"><strong>Free Plan</strong></span>.</li><li class="listitem" style="list-style-type: disc">Towards the bottom-center is the information that at the moment you are using zero (<span class="strong"><strong>0</strong></span>) gears out of three (<span class="strong"><strong>3</strong></span>), and that they are free. Also, at the same location, there is a hint that you can have a maximum of <span class="strong"><strong>16 Gears</strong></span>, not more! This is something you should consider when choosing between OpenShift Online and OpenShift Enterprise, which is totally customizable.</li><li class="listitem" style="list-style-type: disc">Last, but not least, is the <a id="id1055" class="indexterm"/><span class="strong"><strong>Upgrade Now</strong></span> button, which provides you with all the information that you need to upgrade to the <span class="strong"><strong>Bronze</strong></span> or <span class="strong"><strong>Silver</strong></span> Plans.</li></ul></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec315"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For all the services that <a id="id1056" class="indexterm"/>OpenShift Online provides and how it works, please refer to the documentation at <a class="ulink" href="https://www.openshift.com/walkthrough/how-it-works">https://www.openshift.com/walkthrough/how-it-works</a></li><li class="listitem" style="list-style-type: disc">If you are looking for documentation from a developer's point of view, you can go to <a class="ulink" href="https://developers.openshift.com">https://developers.openshift.com</a></li></ul></div></div></div>
<div class="section" title="Installing the WildFly cartridge for our first deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch14lvl1sec111"/>Installing the WildFly cartridge for our first deployment</h1></div></div></div><p>In this <a id="id1057" class="indexterm"/>recipe, you will learn how to configure the WildFly cartridge using your OpenShift Online account. If you still don't have an account, please refer to the first recipe of this chapter.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec316"/>Getting ready</h2></div></div></div><p>As we will operate online most of the time, you need to have an Internet connection. On the other hand, all we need locally is a web application to deploy.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">For this reason, download the entire repository named <code class="literal">wildfly-cookbook-oso</code>, from my GitHub account at <a class="ulink" href="https://github.com/foogaro/wildfly-cookbook-oso.git">https://github.com/foogaro/wildfly-cookbook-oso.git</a>.</li><li class="listitem">You can <code class="literal">git-clone</code> the <a id="id1058" class="indexterm"/>project or just download it as a ZIP archive. Either way, place the source in our <code class="literal">~/WFC/github</code> path. There you can find a project called <code class="literal">openshift-welcome</code>. To compile the project, execute the following commands:<div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github/wildfly-cookbook-oso
$ cd openshift-welcome
$ mvn clean package</pre></div></li><li class="listitem">In the <code class="literal">target</code> folder, generated by maven, you should find the <code class="literal">openshift-welcome.war</code> artifact ready to be deployed.</li></ol></div><p>Let's start for real now!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec317"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First things first; log in to your OSO account at <a class="ulink" href="https://openshift.redhat.com/app/console">https://openshift.redhat.com/app/console</a>.</li><li class="listitem">Use the e-mail and password chosen at the time of registration, as depicted in the following image:<div class="mediaobject"><img src="graphics/3744_14_07.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online login form</p></div></div></li><li class="listitem">Once there, the <a id="id1059" class="indexterm"/>first thing to do is to create an application, as depicted in the following screenshot:<div class="mediaobject"><img src="graphics/3744_14_08.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online welcome page</p></div></div></li><li class="listitem">Follow the <a id="id1060" class="indexterm"/><span class="strong"><strong>Create your first application now</strong></span> link. In the next page, select the WildFly cartridge, as shown in the following image:<div class="mediaobject"><img src="graphics/3744_14_09.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online list of most used cartridges</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>While writing the book, the latest available stable cartridge for WildFly is version 8.2.0.Final. Obviously, this is the application server which we will be using to provide our application.</p></div></div></li><li class="listitem">Next, we need <a id="id1061" class="indexterm"/>to configure our namespace, where all our applications will belong, and configure the application name; both of these together become the <span class="strong"><strong>Public URL</strong></span>, as shown in the following image:<div class="mediaobject"><img src="graphics/3744_14_10.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online—applications settings form</p></div></div></li><li class="listitem">What you need to change in the preceding form is the domain name, which is on the right side of the hyphen symbol (<span class="strong"><strong>-</strong></span>); I chose <code class="literal">wildflycookbook</code>. The domain name must be unique within OpenShift Online at <span class="strong"><strong>rhcloud.com</strong></span>. So choose your own domain name to which all your application names will belong.</li><li class="listitem">For this very <a id="id1062" class="indexterm"/>first try, leave all defaults as such and click the <span class="strong"><strong>Create Application</strong></span> button. It will take a few minutes to do all that's necessary—it took me 4 minutes.</li><li class="listitem">Then you will be asked if you will be changing the code:<div class="mediaobject"><img src="graphics/3744_14_11.jpg" alt="How to do it…"/></div></li><li class="listitem">For the moment, we just skip this step and click on the link labeled <span class="strong"><strong>Not now, continue</strong></span>—we will see the other option with a specific recipe, later in this chapter.</li><li class="listitem">The next page will be our recap page, which will give us all the information to manage our WildFly instance, such as deploying our applications.<div class="mediaobject"><img src="graphics/3744_14_12.jpg" alt="How to do it…"/></div></li><li class="listitem">The green box in the preceding screenshot, depicts the <span class="strong"><strong>Username</strong></span> and <span class="strong"><strong>Password</strong></span> of an administrator user—basically, a user bound to <code class="literal">ManagementRealm</code> with administrator privileges. By the way, in order to access the Web <a id="id1063" class="indexterm"/>Console, we need to use a tool called RHC which can forward for us all requests to port 9990 of the Admin console present in our new OpenShift Online environment.<p>There is one more thing to do which is to install the client tool named RHC, which will provide us with a command-line interface to manage the OSO locally from our PC.</p></li><li class="listitem">Open a terminal window and run the following commands:<div class="informalexample"><pre class="programlisting">$ sudo yum -y install rubygems git
$ sudo gem install rhc</pre></div></li><li class="listitem">Now that whole software has been installed, we need to setup the RHC tool, as follows:<div class="informalexample"><pre class="programlisting">$ rhc setup
OpenShift Client Tools (RHC) Setup Wizard

This wizard will help you upload your SSH keys, set your application namespace, and check that other programs like Git are properly installed.

If you have your own OpenShift server, you can specify it now. Just hit enter to use the server for OpenShift Online: openshift.redhat.com.
Enter the server hostname: |openshift.redhat.com|

You can add more servers later using 'rhc server'.

Login to openshift.redhat.com: luigi@foogaro.com
Password: ********

OpenShift can create and store a token on disk which allows to you to access the server without using your password. The key is stored in your home directory and should be kept secret.  You can delete the key at
any time by running 'rhc logout'.
Generate a token now? (yes|no) yes
Generating an authorization token for this client ... lasts about 1 month

Saving configuration to /home/luigi/.openshift/express.conf ... done

No SSH keys were found. We will generate a pair of keys for you.

    Created: /home/luigi/.ssh/id_rsa.pub

Your public SSH key must be uploaded to the OpenShift server to access code.  Upload now? (yes|no) yes

Since you do not have any keys associated with your OpenShift account, your new key will be uploaded as the 'default' key.

Uploading key 'default' ... done

Checking for git ... found git version 2.1.0

Checking common problems .. done

Checking for a domain ... wildflycookbook

Checking for applications ... found 1

  openshiftwelcome http://openshiftwelcome-wildflycookbook.rhcloud.com/

  You are using 1 of 3 total gears
  The following gear sizes are available to you: small

Your client tools are now configured.</pre></div><p>As you can see, the output fits my configuration. Yours should be similar, too.</p><p>Okay, let's go back to where we were. We were ready to deploy our application, but we needed to access the management console.</p></li><li class="listitem">Now we can do it <a id="id1064" class="indexterm"/>by first providing the following RHC command:<div class="informalexample"><pre class="programlisting">$ rhc port-forward openshiftwelcome
Checking available ports ... done
Forwarding ports ...

To connect to a service running on OpenShift, use the Local address

Service Local               OpenShift
------- -------------- ---- ----------------
java    127.0.0.1:3528  =&gt;  127.7.222.1:3528
java    127.0.0.1:8080  =&gt;  127.7.222.1:8080
java    127.0.0.1:9990  =&gt;  127.7.222.1:9990

Press CTRL-C to terminate port forwarding</pre></div><p>As described in the last line, keep this process running.</p></li><li class="listitem">Now let's open a browser and point it to the OpenShift Online Admin Console, at <code class="literal">http://127.0.0.1:9990</code>.</li><li class="listitem">When <a id="id1065" class="indexterm"/>requested, insert the credentials provided to you when we created our first application, in the green box.<p>You should now see the following page:</p><div class="mediaobject"><img src="graphics/3744_14_13.jpg" alt="How to do it…"/><div class="caption"><p>WildFly management console on OpenShift Online</p></div></div></li><li class="listitem">We <a id="id1066" class="indexterm"/>can deploy our application by clicking on the <span class="strong"><strong>Deployments</strong></span> tag:<div class="mediaobject"><img src="graphics/3744_14_14.jpg" alt="How to do it…"/><div class="caption"><p>Deployments management</p></div></div></li><li class="listitem">Click on the <a id="id1067" class="indexterm"/><span class="strong"><strong>Add</strong></span> button, and choose the <code class="literal">openshift-welcome.war</code> artifact that we previously compiled with the maven command. Once we have chosen it, enable and confirm it as follows:<div class="mediaobject"><img src="graphics/3744_14_15.jpg" alt="How to do it…"/><div class="caption"><p>Deploying the openshift-welcome.war application</p></div></div></li><li class="listitem">Once we have <a id="id1068" class="indexterm"/>successfully deployed the application, let's try it by opening it at <a class="ulink" href="http://openshiftwelcome-wildflycookbook.rhcloud.com">http://openshiftwelcome-wildflycookbook.rhcloud.com</a>.<p>That's our first application running on WildFly on OpenShift Online:</p><div class="mediaobject"><img src="graphics/3744_14_16.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift-welcome application up and running</p></div></div></li></ol></div><p>The page is designed to be as comprehensive as possible; I've also used the bold font style!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec318"/>How it works…</h2></div></div></div><p>Well, here the tough job is done by OpenShift Online. The only thing we have done essentially is install the Ruby programming language environment to be able to install and run the RHC tool, which is the client tool used to mange the OpenShift Online environment.</p><p>Let's recap what we have done during the deployment of our first application in the cloud.</p><p>First we have chosen the cartridge. As we have seen, there are many cartridges that we can use for our gear: WildFly, JBoss AS, Tomcat, Drupal, WordPress, Node.js, and <span class="strong"><strong>MongoDB Express Angular Node</strong></span> (<span class="strong"><strong>MEAN</strong></span>). There are many of them, and you can find <a id="id1069" class="indexterm"/>them all at the OpenShift Online site at <a class="ulink" href="https://openshift.redhat.com/app/console/application_types">https://openshift.redhat.com/app/console/application_types</a>.</p><p>Once we have <a id="id1070" class="indexterm"/>selected the WildFly cartridge, the platform asked us the <span class="strong"><strong>Public URL</strong></span> to be used to publish our application, as shown in the following image:</p><div class="mediaobject"><img src="graphics/3744_14_17.jpg" alt="How it works…"/><div class="caption"><p>The Public URL to publish the application</p></div></div><p>The URL, besides the suffix <span class="strong"><strong>.rhcloud.com</strong></span>, is composed using the application name and a namespace. The last one is essentially your domain, the one where all your applications reside. Remember, it has to be unique! In my case, I've chosen the namespace <code class="literal">wildflycookbook</code>.</p><p>As a matter of fact, the next time you create an application, you will be asked to give just the application name, as follows:</p><div class="mediaobject"><img src="graphics/3744_14_18.jpg" alt="How it works…"/><div class="caption"><p>Defining your application name to be used into the public URL</p></div></div><p>Still remaining on the same page, there was another option we could have chosen—scaling—as shown in the following image:</p><div class="mediaobject"><img src="graphics/3744_14_19.jpg" alt="How it works…"/><div class="caption"><p>Scaling option in OpenShift Online</p></div></div><p>This option would have given us the capability to automatically scale the application. In few words, as already mentioned in the introduction, OpenShift will create additional WildFly gears (as long as they are available in your plan) and a balancer gear, to scale horizontally, when the incoming traffic increases.</p><p>The next option would <a id="id1071" class="indexterm"/>have been the <span class="strong"><strong>Region</strong></span>, which is the location where the server would have run your gears: US, Europe, or Asia.</p><p>All gears of any size can be run in the <span class="strong"><strong>US</strong></span>; only production gears can be deployed to the <span class="strong"><strong>EU</strong></span> region (small.highcpu, medium, and large). The <span class="strong"><strong>Asia</strong></span> region is reserved for dedicated node service.</p><p>So, with the free plan, we can only choose the <span class="strong"><strong>US</strong></span> region, which is fine.</p><p>As you may have guessed from the name of the region (<code class="literal">aws-us-east-1</code>), OpenShift relies on the Amazon AWS, to create the servers. Because of the Amazon "pay-only-for-what-you-use" policy, whenever the incoming traffic to your site decreases, OpenShift gets back the extra resources.</p><p>Apart from the configuration settings, there was one setting I put into the application through the <code class="literal">WEB-INF/jboss-web.xml</code> JBoss specific descriptor file, which looks like this:</p><div class="informalexample"><pre class="programlisting">&lt;jboss-web&gt;
    &lt;context-root&gt;/&lt;/context-root&gt;
&lt;/jboss-web&gt;</pre></div><p>The preceding configuration sets the context root of the application to <code class="literal">/</code>, so we can access it by just providing the URL <a class="ulink" href="http://openshiftwelcome-wildflycookbook.rhcloud.com">http://openshiftwelcome-wildflycookbook.rhcloud.com</a>, without any additional context path.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec319"/>There's more…</h2></div></div></div><p>This recipe was a little long, and you have probably found yourself doing it in different ways. If so, you may have encountered this:</p><div class="mediaobject"><img src="graphics/3744_14_20.jpg" alt="There's more…"/><div class="caption"><p>Application in the idle state</p></div></div><p>This basically means <a id="id1072" class="indexterm"/>that your WildFly instance has stopped. Your application will not receive incoming traffic, and even the access to the WildFly management console will not work:</p><div class="informalexample"><pre class="programlisting">$ rhc port-forward openshiftwelcome
Checking available ports ... none
There are no available ports to forward for this application. Your application may be stopped or idled.</pre></div><p>The only way to move ahead is to restart the application.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>Keep in mind that after 48 hours of inactivity, or no-traffic at all, OpenShift Online puts your application back to the idle state. To keep your application away from the idle state, you can have a kind of cron job doing a simple HTTP GET to your site, once a day.</p></div></div></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec320"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">For all the services that OpenShift Online provides and how it works, please refer to the documentation at <a class="ulink" href="https://www.openshift.com/walkthrough/how-it-works">https://www.openshift.com/walkthrough/how-it-works</a></li><li class="listitem" style="list-style-type: disc">If you are looking for documentation from a developer's point of view, go to <a class="ulink" href="https://developers.openshift.com">https://developers.openshift.com</a></li></ul></div></div></div>
<div class="section" title="Taking control of your WildFly server via SSH"><div class="titlepage"><div><div><h1 class="title"><a id="ch14lvl1sec112"/>Taking control of your WildFly server via SSH</h1></div></div></div><p>In this recipe, you <a id="id1073" class="indexterm"/>will learn how to access the server where your WildFly is running. Accessing the server gives you some kind of comfort because, I guess, it's the way we usually work. There, you can see the WildFly process, its logs, its directory structures, and so on.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec321"/>Getting ready</h2></div></div></div><p>Before you can effectively go through this recipe, you should have an active OpenShift Online account, along with an application. In case you need to, you can follow recipe one for the registration process, and follow <span class="emphasis"><em>Installing the WildFly cartridge for our first deployment</em></span> recipe of this chapter to create your first application.</p><p>In this recipe, I will use the environment generated while creating the application <code class="literal">openshiftwelcome</code>; yours might be different but would conceptually be the same.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec322"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, let's log in to your OSO account, at <a class="ulink" href="https://openshift.redhat.com/app/console">https://openshift.redhat.com/app/console</a>.</li><li class="listitem">Then enter the username and password that you chose during the registration process.</li><li class="listitem">Once logged in, select the application that you have created, or create a new one as described in the second recipe. I'll select my <code class="literal">openshiftwelcome</code> application.<p>The following are my application details:</p><div class="mediaobject"><img src="graphics/3744_14_21.jpg" alt="How to do it…"/><div class="caption"><p>Application details</p></div></div><p>In the preceding screenshot, there are two sections on the right named <span class="strong"><strong>Source Code</strong></span> and <span class="strong"><strong>Remote Access</strong></span>.</p></li><li class="listitem">In the <span class="strong"><strong>Remote </strong></span><a id="id1074" class="indexterm"/><span class="strong"><strong>Access</strong></span> section, click on the <span class="strong"><strong>Want to log in to your application?</strong></span> label. It describes how to log in to the server which is hosting your application, obviously along with its cartridge.</li><li class="listitem">Open a terminal window and copy-paste the <code class="literal">ssh</code> command that the page is providing you. Mine is as follows:<div class="informalexample"><pre class="programlisting">$ ssh 54c0350afcf933691e0000dc@openshiftwelcome-wildflycookbook.rhcloud.com

    *********************************************************************

    You are accessing a service that is for use only by authorized users.
    If you do not have authorization, discontinue use at once.
    Any use of the services is subject to the applicable terms of the
    agreement which can be found at:
    https://www.openshift.com/legal

    *********************************************************************

    Welcome to OpenShift shell

    This shell will assist you in managing OpenShift applications.

    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!
    Shell access is quite powerful and it is possible for you to
    accidentally damage your application.  Proceed with care!
    If worse comes to worst, destroy your application with "rhc app delete"
    and recreate it
    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!

    Type "help" for more info.


[openshiftwelcome-wildflycookbook.rhcloud.com 54c0350afcf933691e0000dc]\&gt;</pre></div><p>Once there, you can view the WildFly logs and see everything else that you want to.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>Be careful, if you delete something that you shouldn't, you will need to create your application again.</p></div></div></li></ol></div><p>Let's take a look at the WildFly logs.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Execute the following:<div class="informalexample"><pre class="programlisting">[openshiftwelcome-wildflycookbook.rhcloud.com 54c0350afcf933691e0000dc]\&gt; tail -f wildfly/standalone/log/server.log
2015-01-23 11:17:20,864 INFO  [org.jboss.as.server] (XNIO-1 task-4) JBAS018559: Deployed "openshift-welcome.war" (runtime-name : "openshift-welcome.war")
2015-01-23 11:20:21,227 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) JBAS017535: Unregistered web context: /openshift-welcome
2015-01-23 11:20:21,379 INFO  [org.hibernate.validator.internal.util.Version] (MSC service thread 1-1) HV000001: Hibernate Validator 5.1.3.Final
2015-01-23 11:20:21,590 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) JBAS015877: Stopped deployment openshift-welcome.war (runtime-name: openshift-welcome.war) in 386ms
2015-01-23 11:20:21,676 INFO  [org.jboss.as.server] (XNIO-1 task-9) JBAS018558: Undeployed "openshift-welcome.war" (runtime-name: "openshift-welcome.war")
2015-01-23 11:20:21,677 INFO  [org.jboss.as.repository] (XNIO-1 task-9) JBAS014901: Content removed from location /var/lib/openshift/54c0350afcf933691e0000dc/wildfly/standalone/data/content/6a/2481425c24beff9c840891145f6ea0ae5d1058/content
2015-01-23 11:20:34,820 INFO  [org.jboss.as.repository] (XNIO-1 task-4) JBAS014900: Content added at location /var/lib/openshift/54c0350afcf933691e0000dc/wildfly/standalone/data/content/1b/65c52cbd69dc9f2fd0dbab59f1fb82c3c05038/content
2015-01-23 11:20:35,195 INFO  [org.jboss.as.server.deployment] (MSC service thread 1-2) JBAS015876: Starting deployment of "openshift-welcome.war" (runtime-name: "openshift-welcome.war")
2015-01-23 11:20:35,305 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) JBAS017534: Registered web context: /
2015-01-23 11:20:35,418 INFO  [org.jboss.as.server] (XNIO-1 task-8) JBAS018559: Deployed "openshift-welcome.war" (runtime-name : "openshift-welcome.war")</pre></div></li><li class="listitem">Obviously, you <a id="id1075" class="indexterm"/>are not limited to the logs; you can see the process, as follows:<div class="informalexample"><pre class="programlisting">[openshiftwelcome-wildflycookbook.rhcloud.com 54c0350afcf933691e0000dc]\&gt; ps -efa | grep java | grep -v grep
4028      94579  94303  0 Jan23 ?        00:08:07 /var/lib/openshift/54c0350afcf933691e0000dc/wildfly/usr/lib/jvm/jdk1.8.0_05/bin/java -D[Standalone] -server -Xmx256m -XX:MaxPermSize=102m -XX:+AggressiveOpts -Dorg.apache.tomcat.util.LOW_MEMORY=true -DOPENSHIFT_APP_UUID=54c0350afcf933691e0000dc -Dorg.jboss.resolver.warning=true -Djava.net.preferIPv4Stack=true -Dfile.encoding=UTF-8 -Djboss.node.name=openshiftwelcome-wildflycookbook.rhcloud.com -Djgroups.bind_addr= -Dorg.apache.coyote.http11.Http11Protocol.COMPRESSION=on -Dorg.jboss.boot.log.file=/var/lib/openshift/54c0350afcf933691e0000dc/wildfly//standalone/log/server.log -Dlogging.configuration=file:/var/lib/openshift/54c0350afcf933691e0000dc/wildfly//standalone/configuration/logging.properties -jar /var/lib/openshift/54c0350afcf933691e0000dc/wildfly//jboss-modules.jar -mp /var/lib/openshift/54c0350afcf933691e0000dc/app-root/runtime/repo//.openshift/config/modules:/var/lib/openshift/54c0350afcf933691e0000dc/wildfly//modules org.jboss.as.standalone -Djboss.home.dir=/var/lib/openshift/54c0350afcf933691e0000dc/wildfly/ -Djboss.server.base.dir=/var/lib/openshift/54c0350afcf933691e0000dc/wildfly//standalone -b 127.7.222.1 -bmanagement=127.7.222.1</pre></div></li><li class="listitem">Or you can see the server resources by executing the <code class="literal">htop</code> command:<div class="mediaobject"><img src="graphics/3744_14_22.jpg" alt="How to do it…"/></div></li></ol></div><p>Keep in mind that you can see and control everything as long as your user (the hash that identifies your application; mine is <code class="literal">54c0350afcf933691e0000dc</code>) has permissions.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec323"/>How it works…</h2></div></div></div><p>Whenever you create an <a id="id1076" class="indexterm"/>application, you are actually creating an environment along with a cartridge that enables your application. OpenShift Online creates everything for you, assigning the whole process a hash. That hash will be your username to log in to your server, and it also identifies your application. The rest of the process of how OpenShift creates things is out of the scope of this book.</p><p>If you want to learn more about how things work under the hood, I suggest you start with this book: <span class="emphasis"><em>Learning OpenShift</em></span>, <span class="emphasis"><em>Grant Shipley</em></span>, <span class="emphasis"><em>Packt Publishing</em></span>.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec324"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Make it a point to always refer to the official documentation, which, in this case, can be found at <a class="ulink" href="https://docs.openshift.org/">https://docs.openshift.org/</a></li></ul></div></div></div>
<div class="section" title="Deploying your code to OpenShift Online"><div class="titlepage"><div><div><h1 class="title"><a id="ch14lvl1sec113"/>Deploying your code to OpenShift Online</h1></div></div></div><p>In this recipe, you <a id="id1077" class="indexterm"/>will learn how to re-deploy an application <a id="id1078" class="indexterm"/>whenever the source code updates happen. This is done automatically for you by OpenShift Online, which triggers compilation and deployment every time a commit is applied to your code.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec325"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, we need a project on GitHub that we can use for our test. For this reason, I've created a project called <code class="literal">openshiftcoding-wildflycookbook</code> on my GitHub repository, available at <a class="ulink" href="https://github.com/foogaro/openshiftcoding-wildflycookbook">https://github.com/foogaro/openshiftcoding-wildflycookbook</a>.</li><li class="listitem">If you do not have an account on GitHub, this might be a good reason to have one. Sooner or later you will need one. To get started quickly, go to the GitHub site at <a class="ulink" href="https://github.com">https://github.com</a> and sign up. Once the registration process is complete, you will be ready to create a repository, which will host the source code of your application. If you don't have an application, you can borrow mine.</li><li class="listitem">Anyway, this time you don't have to download or <code class="literal">git-clone</code> my GitHub repository locally, as it will be used to feed the next OpenShift application. But we do need to install the <code class="literal">git</code> client tool. If you are using an OS similar to Red Hat, run the following command:<div class="informalexample"><pre class="programlisting">$ sudo yum -y install git</pre></div></li><li class="listitem">Once done, you can check that everything is installed successfully, by issuing the following command:<div class="informalexample"><pre class="programlisting">$ git version
git version 2.1.0</pre></div></li></ol></div><p>Okay, now we are ready to begin!</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec326"/>How to do it…</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First of all, you need to access your OpenShift Online account at the following address <a class="ulink" href="https://openshift.redhat.com/app/console">https://openshift.redhat.com/app/console</a>.</li><li class="listitem">Use the <a id="id1079" class="indexterm"/>e-mail and the password chosen at the <a id="id1080" class="indexterm"/>time of registration, as depicted in the following screenshot:<div class="mediaobject"><img src="graphics/3744_14_23.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online login form</p></div></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>If you don't have an OpenShift Online account yet, follow the registration process described in the first recipe of this chapter.</p></div></div></li><li class="listitem">Once you log in, on the main page, click the <span class="strong"><strong>Add Application…</strong></span> button to create a new application:<div class="mediaobject"><img src="graphics/3744_14_24.jpg" alt="How to do it…"/><div class="caption"><p>OpenShift Online initial console for adding a new application</p></div></div></li><li class="listitem">Next we need to select the WildFly cartridge. As there are tens of cartridges, we can <a id="id1081" class="indexterm"/>search for it by providing a <a id="id1082" class="indexterm"/>criteria filter, as depicted in the following screenshot:<div class="mediaobject"><img src="graphics/3744_14_25.jpg" alt="How to do it…"/><div class="caption"><p>Selecting the WildFly cartridge by filtering it</p></div></div></li><li class="listitem">Afterwards, select <a id="id1083" class="indexterm"/>the cartridge and fill in the <a id="id1084" class="indexterm"/>form with the details of our application, as follows:<div class="mediaobject"><img src="graphics/3744_14_26.jpg" alt="How to do it…"/><div class="caption"><p>Setting application details</p></div></div><p>In my case, I've called my application <code class="literal">openshiftcoding</code>. This time I've specified my GitHub repository, where my application is available, that is, at <a class="ulink" href="https://github.com/foogaro/openshiftcoding-wildflycookbook.git">https://github.com/foogaro/openshiftcoding-wildflycookbook.git</a>. You will need to specify yours.</p></li><li class="listitem">Complete the form by <a id="id1085" class="indexterm"/>leaving the other default <a id="id1086" class="indexterm"/>values as such and by clicking the <span class="strong"><strong>Create Application</strong></span> button. It may take few minutes to complete.</li><li class="listitem">Once the process is complete, you should see a page like the following:<div class="mediaobject"><img src="graphics/3744_14_27.jpg" alt="How to do it…"/><div class="caption"><p>Recap of the newly created application</p></div></div></li></ol></div><p>As you can see <a id="id1087" class="indexterm"/>from the preceding image, there is a section labeled <span class="strong"><strong>Making code changes</strong></span>, that describes what we need to do in order to modify the <a id="id1088" class="indexterm"/>source of our application, and have it automatically updated whenever we modify the code.</p><p>Therefore, open a terminal window and issue the <code class="literal">git clone</code> command identifying your application repository in OpenShift Online—it is not the one on GitHub, but will be cloned locally into the server that OpenShift will create for you.</p><p>These are the commands that I enter now:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github
$ mkdir git-openshift
$ cd git-openshift
$ git clone ssh://54c422b2fcf9338699000146@openshiftcoding-wildflycookbook.rhcloud.com/~/git/openshiftcoding.git/
Cloning into 'openshiftcoding'...
Warning: Permanently added the RSA host key for IP address '54.234.243.133' to the list of known hosts.
remote: Counting objects: 24, done.
remote: Compressing objects: 100% (18/18), done.
remote: Total 24 (delta 4), reused 24 (delta 4)
Receiving objects: 100% (24/24), done.
Resolving deltas: 100% (4/4), done.
Checking connectivity... done.</pre></div><p>We are now ready to change our source code, commit it, and see OpenShift compiling and deploying our application directly to our WildFly instance. To see all this beauty, we need to look at the logs.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal <a id="id1089" class="indexterm"/>window and issue the <a id="id1090" class="indexterm"/>following command:<div class="informalexample"><pre class="programlisting">$ ssh 54c422b2fcf9338699000146@openshiftcoding-wildflycookbook.rhcloud.com

    *********************************************************************

    You are accessing a service that is for use only by authorized users.
    If you do not have authorization, discontinue use at once.
    Any use of the services is subject to the applicable terms of the
    agreement which can be found at:
    https://www.openshift.com/legal

    *********************************************************************

    Welcome to OpenShift shell

    This shell will assist you in managing OpenShift applications.

    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!
    Shell access is quite powerful and it is possible for you to
    accidentally damage your application.  Proceed with care!
    If worse comes to worst, destroy your application with "rhc app delete"
    and recreate it
    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!

    Type "help" for more info.


[openshiftcoding-wildflycookbook.rhcloud.com 54c422b2fcf9338699000146]\&gt; tail -f wildfly/standalone/log/server.log
2015-01-24 17:56:23,264 INFO  [org.jboss.as.connector.deployment] (MSC service thread 1-5) JBAS010406: Registered connection factory java:/JmsXA
2015-01-24 17:56:23,337 INFO  [org.hornetq.ra] (MSC service thread 1-5) HornetQ resource adaptor started
2015-01-24 17:56:23,338 INFO  [org.jboss.as.connector.services.resourceadapters.ResourceAdapterActivatorService$ResourceAdapterActivator] (MSC service thread 1-5) IJ020002: Deployed: file://RaActivatorhornetq-ra
2015-01-24 17:56:23,355 INFO  [org.jboss.as.messaging] (MSC service thread 1-7) JBAS011601: Bound messaging object to jndi name java:jboss/DefaultJMSConnectionFactory
2015-01-24 17:56:23,355 INFO  [org.jboss.as.connector.deployment] (MSC service thread 1-5) JBAS010401: Bound JCA ConnectionFactory [java:/JmsXA]
<span class="strong"><strong>2015-01-24 17:56:23,835 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-4) JBAS017534: Registered web context: /</strong></span>
<span class="strong"><strong>2015-01-24 17:56:24,069 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 32) JBAS018559: Deployed "openshift-coding.war" (runtime-name : "openshift-coding.war")</strong></span>
2015-01-24 17:56:24,199 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://127.7.132.129:9990/management
2015-01-24 17:56:24,201 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://127.7.132.129:9990
2015-01-24 17:56:24,201 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.2.0.Final "Tweek" started in 10428ms - Started 294 of 425 services (178 services are lazy, passive or on-demand)</pre></div></li><li class="listitem">As you can see <a id="id1091" class="indexterm"/>from the preceding log that has been emphasized, our application is already there; in fact, if we open the public URL that we specified while creating the application, we can see it working, as follows:<div class="mediaobject"><img src="graphics/3744_14_28.jpg" alt="How to do it…"/><div class="caption"><p>The application needs to be updated</p></div></div><p>Okay, let's <a id="id1092" class="indexterm"/>update the source code. In <a id="id1093" class="indexterm"/>my case, I only have a JSP, and its code is the following:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html PUBLIC
"-//W3C//DTD XHTML 1.1 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;

&lt;html  xml:lang="en" lang="en"&gt;
&lt;head&gt;
    &lt;title&gt;WildFly::Cookbook&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;b&gt;We need to change some code here!&lt;/b&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div></li><li class="listitem">Let's add some color to the text as follows:<div class="informalexample"><pre class="programlisting">&lt;b style="color:red;"&gt;We need to change some code here!&lt;/b&gt;</pre></div></li><li class="listitem">Now, we can update <a id="id1094" class="indexterm"/>our code to the Git repository <a id="id1095" class="indexterm"/>from the first terminal window (where we cloned the Git repository from OpenShift), as follows:<div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github/git-openshift/openshiftcoding
$ git status
On branch master
Your branch is up-to-date with 'origin/master'.
Changes not staged for commit:
  (use "git add &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)
  modified:   src/main/webapp/index.jsp

no changes added to commit (use "git add" and/or "git commit -a")
$ git add .
$ git commit -m "Added red color to the text"
[master c89467c] Added red color to the text
 1 file changed, 1 insertion(+), 1 deletion(-)</pre></div></li><li class="listitem">Now, we need to push everything. Before doing that, let's grab the other terminal with the visible WildFly log. Now we can do the magic…<div class="informalexample"><pre class="programlisting">$ git push
warning: push.default is unset; its implicit value has changed in
Git 2.0 from 'matching' to 'simple'. To squelch this message
and maintain the traditional behavior, use:

  git config --global push.default matching

To squelch this message and adopt the new behavior now, use:

  git config --global push.default simple

When push.default is set to 'matching', git will push local branches
to the remote branches that already exist with the same name.

Since Git 2.0, Git defaults to the more conservative 'simple'
behavior, which only pushes the current branch to the corresponding
remote branch that 'git pull' uses to update the current branch.

See 'git help config' and search for 'push.default' for further information.
(the 'simple' mode was introduced in Git 1.7.11. Use the similar mode
'current' instead of 'simple' if you sometimes use older versions of Git)

Counting objects: 6, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (5/5), done.
Writing objects: 100% (6/6), 517 bytes | 0 bytes/s, done.
Total 6 (delta 2), reused 0 (delta 0)
remote: Stopping wildfly cart
remote: Sending SIGTERM to wildfly:455867 ...
remote: Building git ref 'master', commit c89467c
remote: Found pom.xml... attempting to build with 'mvn -e clean package -Popenshift -DskipTests'
remote: Apache Maven 3.0.4 (r1232336; 2012-12-18 14:36:37-0500)
remote: Maven home: /usr/share/java/apache-maven-3.0.4
remote: Java version: 1.8.0_05, vendor: Oracle Corporation
remote: Java home: /var/lib/openshift/54c422b2fcf9338699000146/wildfly/usr/lib/jvm/jdk1.8.0_05/jre
remote: Default locale: en_US, platform encoding: ANSI_X3.4-1968
remote: OS name: "linux", version: "2.6.32-504.3.3.el6.x86_64", arch: "i386", family: "unix"
remote: [INFO] Scanning for projects...
remote: [INFO]
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO] Building openshift-coding 1.0
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO]
remote: [INFO] --- maven-clean-plugin:2.4.1:clean (default-clean) @ openshift-coding ---
remote: [INFO]
remote: [INFO] --- maven-resources-plugin:2.5:resources (default-resources) @ openshift-coding ---
remote: [debug] execute contextualize
remote: [INFO] Using 'UTF-8' encoding to copy filtered resources.
remote: [INFO] Copying 1 resource
remote: [INFO]
remote: [INFO] --- maven-compiler-plugin:2.3.2:compile (default-compile) @ openshift-coding ---
remote: [INFO] No sources to compile
remote: [INFO]
remote: [INFO] --- maven-resources-plugin:2.5:testResources (default-testResources) @ openshift-coding ---
remote: [debug] execute contextualize
remote: [INFO] Using 'UTF-8' encoding to copy filtered resources.
remote: [INFO] skip non existing resourceDirectory /var/lib/openshift/54c422b2fcf9338699000146/app-root/runtime/repo/src/test/resources
remote: [INFO]
remote: [INFO] --- maven-compiler-plugin:2.3.2:testCompile (default-testCompile) @ openshift-coding ---
remote: [INFO] No sources to compile
remote: [INFO]
remote: [INFO] --- maven-surefire-plugin:2.10:test (default-test) @ openshift-coding ---
remote: [INFO] Tests are skipped.
remote: [INFO]
remote: [INFO] --- maven-war-plugin:2.4:war (default-war) @ openshift-coding ---
remote: [INFO] Packaging webapp
remote: [INFO] Assembling webapp [openshift-coding] in [/var/lib/openshift/54c422b2fcf9338699000146/app-root/runtime/repo/target/openshift-coding]
remote: [INFO] Processing war project
remote: [INFO] Copying webapp resources [/var/lib/openshift/54c422b2fcf9338699000146/app-root/runtime/repo/src/main/webapp]
remote: [INFO] Webapp assembled in [79 msecs]
remote: [INFO] Building war: /var/lib/openshift/54c422b2fcf9338699000146/app-root/runtime/repo/deployments/openshift-coding.war
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO] BUILD SUCCESS
remote: [INFO] ------------------------------------------------------------------------
remote: [INFO] Total time: 5.855s
remote: [INFO] Finished at: Sat Jan 24 18:19:48 EST 2015
remote: [INFO] Final Memory: 7M/79M
remote: [INFO] ------------------------------------------------------------------------
remote: Preparing build for deployment
remote: Deployment id is 9aac8674
remote: Activating deployment
remote: Deploying WildFly
remote: Starting wildfly cart
remote: Found 127.7.132.129:8080 listening port
remote: Found 127.7.132.129:9990 listening port
remote: /var/lib/openshift/54c422b2fcf9338699000146/wildfly/standalone/deployments /var/lib/openshift/54c422b2fcf9338699000146/wildfly
remote: /var/lib/openshift/54c422b2fcf9338699000146/wildfly
remote: CLIENT_MESSAGE: Artifacts deployed: ./openshift-coding.war
remote: -------------------------
remote: Git Post-Receive Result: success
remote: Activation status: success
remote: Deployment completed with status: success
To ssh://54c422b2fcf9338699000146@openshiftcoding-wildflycookbook.rhcloud.com/~/git/openshiftcoding.git/
   f2eba48..c89467c  master -&gt; master</pre></div><p>If you are familiar with <code class="literal">git</code>, you'll know that this push took a little longer than expected, but it did a lot of things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It stopped our WildFly</li><li class="listitem" style="list-style-type: disc">It updated the code</li><li class="listitem" style="list-style-type: disc">It issued a maven compilation, packaged our application as a <code class="literal">war</code></li><li class="listitem" style="list-style-type: disc">It copied our new application into the WildFly <code class="literal">deployments</code> folder</li><li class="listitem" style="list-style-type: disc">It started WildFly</li></ul></div></li><li class="listitem">And if you have <a id="id1096" class="indexterm"/>looked at the WildFly logs too, you should have noticed the following entries:<div class="informalexample"><pre class="programlisting">...
2015-01-24 18:19:36,758 INFO  [org.jboss.as] (MSC service thread 1-1) JBAS015950: WildFly 8.2.0.Final "Tweek" stopped in 1273ms
...
2015-01-24 18:20:13,374 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-5) JBAS017534: Registered web context: /
2015-01-24 18:20:13,673 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 32) JBAS018559: Deployed "openshift-coding.war" (runtime-name : "openshift-coding.war")
2015-01-24 18:20:13,871 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://127.7.132.129:9990/management
2015-01-24 18:20:13,879 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://127.7.132.129:9990
2015-01-24 18:20:13,879 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.2.0.Final "Tweek" started in 23656ms - Started 294 of 425 services (178 services are lazy, passive or on-demand)</pre></div></li><li class="listitem">Let's see if <a id="id1097" class="indexterm"/>everything worked correctly. Open the browser and go to <a class="ulink" href="http://openshiftcoding-wildflycookbook.rhcloud.com">http://openshiftcoding-wildflycookbook.rhcloud.com</a>.<p>You should see something like the following page:</p><div class="mediaobject"><img src="graphics/3744_14_29.jpg" alt="How to do it…"/><div class="caption"><p>Application updated through a git push</p></div></div></li></ol></div><p>Great, it worked!</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec327"/>How it works…</h2></div></div></div><p>OpenShift Online hides and does a lot of things under the hood, making our lives easier, much easier. The only thing that we actually did was on the development side.</p><p>To let OpenShift Online easily compile, package, and deploy our application, we need to instruct it about how to compile the source, how to package it, and where to deploy it. We can give these directives through the maven project file, the <code class="literal">pom.xml</code>.</p><p>The following is the <a id="id1098" class="indexterm"/>complete <code class="literal">pom.xml</code> file of the <code class="literal">openshiftcoding-wildflycookbook</code> project (also available at <a class="ulink" href="https://github.com/foogaro/openshiftcoding-wildflycookbook/blob/master/pom.xml">https://github.com/foogaro/openshiftcoding-wildflycookbook/blob/master/pom.xml</a>):</p><div class="informalexample"><pre class="programlisting">&lt;project  
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.packtpub.wildfly-cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;openshift-coding&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;name&gt;openshift-coding&lt;/name&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;/properties&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;openshift&lt;/id&gt;
            &lt;build&gt;
                &lt;finalName&gt;${project.name}&lt;/finalName&gt;
                &lt;plugins&gt;
                    &lt;plugin&gt;
                        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                        &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
                        &lt;version&gt;2.4&lt;/version&gt;
                        &lt;configuration&gt;
                            &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
                            &lt;outputDirectory&gt;deployments&lt;/outputDirectory&gt;
                            &lt;warName&gt;${project.name}&lt;/warName&gt;
                        &lt;/configuration&gt;
                    &lt;/plugin&gt;
                &lt;/plugins&gt;
            &lt;/build&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;

&lt;/project&gt;</pre></div><p>The key point here is the profile named <code class="literal">openshift</code>. By default, OSO uses Maven to compile the source code, asking to use the <code class="literal">openshift</code> profile. The profile that it finds will be used along with its settings; otherwise, the code will be just compiled and packaged, but OSO will not know where to deploy it.</p><p>The <code class="literal">openshift</code> profile that I've provided, defines (with the <code class="literal">build</code> tag ) the settings to be used during Maven's <a id="id1099" class="indexterm"/>build phase. Particularly, I've <a id="id1100" class="indexterm"/>used the standard <code class="literal">maven-war-plugin</code> and set the <code class="literal">outputDirectory</code> to <code class="literal">deployments</code>, which is the one that WildFly uses.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch14lvl2sec328"/>See also</h2></div></div></div><p>From a developer's point of view, I recommend that you refer to the official documentation at the following sites:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://docs.openshift.com">https://docs.openshift.com</a></li><li class="listitem" style="list-style-type: disc"><a class="ulink" href="https://developers.openshift.com/en/managing-modifying-applications.html">https://developers.openshift.com/en/managing-modifying-applications.html</a></li></ul></div></div></div></body></html>