<html><head></head><body><div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Deploying and Managing Applications on Major Java EE Servers</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">This chapter covers the following recipes:</p>
<ul class="calibre13">
<li class="calibre14">Apache TomEE usage</li>
<li class="calibre14">GlassFish usage</li>
<li class="calibre14">WildFly usage</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">One of the most important skills you should have as a Java EE developer is knowing how to work with the most used Java EE application servers in the market.</p>
<p class="mce-root">As we've stated in previous chapters, the standards involved in the Java EE ecosystem allow you to reuse most of the knowledge you already have no matter which server you are using.</p>
<p class="mce-root">However, when we are talking about deployment and some administration tasks, things could be different (and usually are). The differences are not in the way they work, but in the way they are done.</p>
<p class="mce-root">So, in this chapter, we will cover some important and common tasks for Apache TomEE, GlassFish, and WildFly.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Apache TomEE usage</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">If you have already used Apache Tomcat, you can consider yourself ready to use Apache TomEE. It is based on the Tomcat's core and implements the Java EE specs.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">First, you need to download it to your environment. At the time of writing, TomEE has no Java EE 8 compatible version (actually, there is only GlassFish 5). However, the tasks covered here shouldn't change in future versions as they are not attached to the Java EE specs.</p>
<p class="mce-root">To download it, just visit <a href="http://tomee.apache.org/downloads.html" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">http://tomee.apache.org/downloads.html</a>. This recipe in based on version 7.0.2 Plume.</p>
<p class="mce-root">Wherever possible, we will focus on doing tasks using the configuration files.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Refer to the following detailed tasks.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Deploying EAR, WAR, and JAR files</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">For EAR and WAR files, the deployment folder is:</p>
<p class="mce-root"><kbd class="calibre16">$TOMEE_HOME/webapps</kbd></p>
<p class="mce-root">For JAR files, the folder is:</p>
<p class="mce-root"><kbd class="calibre16">$TOMEE_HOME/lib</kbd></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating datasources and a connection pool</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To create a datasource and a connection pool to help you use databases in your project, edit the <kbd class="calibre16"><span class="calibre5">$TOMEE_HOME/conf/tomee.xml</span></kbd> file.</p>
<p class="mce-root">Inside the <kbd class="calibre16">&lt;tomee&gt;</kbd> node, insert a child node like this one:</p>
<pre class="calibre21">  &lt;Resource id="MyDataSouceDs" type="javax.sql.DataSource"&gt;<br class="calibre2"/>      jdbcDriver = org.postgresql.Driver<br class="calibre2"/>      jdbcUrl = jdbc:postgresql://[host]:[port]/[database]<br class="calibre2"/>      jtaManaged = true<br class="calibre2"/>      maxActive = 20<br class="calibre2"/>      maxIdle = 20<br class="calibre2"/>      minIdle = 0<br class="calibre2"/>      userName = user<br class="calibre2"/>      password = password<br class="calibre2"/>  &lt;/Resource&gt;</pre>
<p class="mce-root">The example targets PostgreSQL, so you will need to perform some changes for another database. Of course, you will also need to change the other parameters according to your needs.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Logging setup and rotate</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To configure the logging for Apache TomEE, edit the <kbd class="calibre16"><span class="calibre5">$TOMEE_HOME/conf/logging.properties</span></kbd> file. The file works with handlers like this:</p>
<pre class="calibre21">1catalina.org.apache.juli.AsyncFileHandler.level = FINE<br class="calibre2"/>1catalina.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs<br class="calibre2"/>1catalina.org.apache.juli.AsyncFileHandler.prefix = catalina.</pre>
<p class="mce-root">So, you can define the logging level, directory, and prefix according to your needs.</p>
<p class="mce-root">If you need to configure log rotation, just add these lines to your handler:</p>
<pre class="calibre21">1catalina.org.apache.juli.AsyncFileHandler<span class="calibre5">.limit = 1024<br class="calibre2"/></span>1catalina.org.apache.juli.AsyncFileHandler<span class="calibre5">.count = 10</span></pre>
<p class="mce-root">In this example, we are defining this file to rotate on every 1024 kilobytes (1 MB) and keep the last 10 files on our disk.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Starting and stopping</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To start the Apache TomEE, just execute this script:</p>
<p class="mce-root"><kbd class="calibre16">$TOMEE_HOME/bin/startup.sh</kbd></p>
<p class="mce-root">To stop it, execute the following script:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$TOMEE_HOME/bin/shutdown.sh</span></kbd></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Session clustering</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">If you want to build a cluster using Apache TomEE nodes, you need to edit the <kbd class="calibre16"><span class="calibre5">$TOMEE_HOME/conf/server.xml</span></kbd> file. Then, find this line:</p>
<pre class="calibre21">&lt;Engine name="Catalina" defaultHost="localhost"&gt;</pre>
<p class="mce-root">Insert a child node, like this:</p>
<pre class="calibre21">        &lt;Cluster <br class="calibre2"/>         className="org.apache.catalina.ha.tcp.SimpleTcpCluster"<br class="calibre2"/>                       channelSendOptions="8"&gt;<br class="calibre2"/><br class="calibre2"/>                &lt;Manager <br class="calibre2"/>                className="org.apache.catalina.ha.session<br class="calibre2"/>                         .DeltaManager"<br class="calibre2"/>                         expireSessionsOnShutdown="false"<br class="calibre2"/>                         notifyListenersOnReplication="true"/&gt;<br class="calibre2"/><br class="calibre2"/>                &lt;Channel <br class="calibre2"/>                 className="org.apache.catalina.tribes.group<br class="calibre2"/>                 .GroupChannel"&gt;<br class="calibre2"/>                  &lt;Membership                     <br class="calibre2"/>                  className="org.apache.catalina<br class="calibre2"/>                 .tribes.membership .McastService"<br class="calibre2"/>                              address="228.0.0.4"<br class="calibre2"/>                              port="45564"<br class="calibre2"/>                              frequency="500"<br class="calibre2"/>                              dropTime="3000"/&gt;<br class="calibre2"/>                  &lt;Receiver className="org.apache.catalina.tribes<br class="calibre2"/>                  .transport.nio.NioReceiver"<br class="calibre2"/>                            address="auto"<br class="calibre2"/>                            port="4000"<br class="calibre2"/>                            autoBind="100"<br class="calibre2"/>                            selectorTimeout="5000"<br class="calibre2"/>                            maxThreads="6"/&gt;<br class="calibre2"/><br class="calibre2"/>                  &lt;Sender className="org.apache.catalina.tribes<br class="calibre2"/>                  .transport.ReplicationTransmitter"&gt;<br class="calibre2"/>                    &lt;Transport className="org.apache.catalina.tribes<br class="calibre2"/>                   .transport.nio.PooledParallelSender"/&gt;<br class="calibre2"/>                  &lt;/Sender&gt;<br class="calibre2"/>                  &lt;Interceptor className="org.apache.catalina.tribes<br class="calibre2"/>                 .group.interceptors.TcpFailureDetector"/&gt;<br class="calibre2"/>                  &lt;Interceptor className="org.apache.catalina.tribes<br class="calibre2"/>                  .group.interceptors.MessageDispatchInterceptor"/&gt;<br class="calibre2"/>                &lt;/Channel&gt;<br class="calibre2"/><br class="calibre2"/>                &lt;Valve className="org.apache.catalina<br class="calibre2"/>                .ha.tcp.ReplicationValve"<br class="calibre2"/>                       filter=""/&gt;<br class="calibre2"/>                &lt;Valve className="org.apache.catalina<br class="calibre2"/>                .ha.session.JvmRouteBinderValve"/&gt;<br class="calibre2"/><br class="calibre2"/>                &lt;Deployer className="org.apache.catalina<br class="calibre2"/>                .ha.deploy.FarmWarDeployer"<br class="calibre2"/>                          tempDir="/tmp/war-temp/"<br class="calibre2"/>                          deployDir="/tmp/war-deploy/"<br class="calibre2"/>                          watchDir="/tmp/war-listen/"<br class="calibre2"/>                          watchEnabled="false"/&gt;<br class="calibre2"/><br class="calibre2"/>                &lt;ClusterListener className="org.apache.catalina<br class="calibre2"/>                .ha.session.ClusterSessionListener"/&gt;<br class="calibre2"/>        &lt;/Cluster&gt;</pre>
<p class="mce-root">This block will set up your server to run in a dynamic discovery cluster. What this means is that every server that runs in the same network using this configuration will become a new member in the cluster and so will share the alive sessions.</p>
<p class="mce-root">All these parameters are so important, so I really recommend you to keep all of them unless you are absolutely sure of what you are doing.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">The best way to set up a Java EE cluster today is using containers (specially Docker containers). So, I'd recommend that you have a look at <a href="1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">Chapter 11</a>, <em class="calibre17">Rising to the Cloud – Java EE, Containers, and Cloud Computing</em>. If you mix the content of that chapter with the content of this one, you will have a powerful environment for your application.</p>
<p class="mce-root">To allow your application to share its session with all the nodes in the cluster, you need to edit the <kbd class="calibre16">web.xml</kbd> file, find the <kbd class="calibre16">web-app</kbd> node, and insert this:</p>
<pre class="calibre21"><span class="calibre5">&lt;</span><span class="calibre5">distributable</span><span class="calibre5">/&gt;</span></pre>
<p class="mce-root">Without it, your session clustering will not work. You also need to keep all objects that you are holding in the session as serializable.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article class="calibre2">
                
<ul class="calibre13">
<li class="calibre14">For more information about Apache TomEE visit <a href="http://tomee.apache.org/" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">http://tomee.apache.org/</a></li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">GlassFish usage</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">The great thing about GlassFish is that it is the <strong class="calibre7">Reference Implementation</strong> (<strong class="calibre7">RI</strong>). So, whenever you have a new version of Java EE, being a developer, you already have the respective GlassFish version to try it.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">First, you need to download it to your environment. At the time of writing, GlassFish 5 is the only Java EE 8 server that has been released.</p>
<p class="mce-root">To download it, just visit <a href="https://javaee.github.io/glassfish/download" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">https://javaee.github.io/glassfish/download</a>. This recipe in based on version 5 (Java EE 8 compatible).</p>
<p class="mce-root">Wherever possible, we will focus on doing the tasks using the configuration files.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre8">Refer to the following detailed tasks.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Deploying EAR, WAR, and JAR files</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">For EAR and WAR files, the deployment folder is:</p>
<p class="mce-root"><kbd class="calibre16">$GLASSFISH_HOME/glassfish/domains/[domain_name]/autodeploy</kbd></p>
<p class="mce-root">Usually <kbd class="calibre16">domain_name</kbd> is <kbd class="calibre16">domain1</kbd>, unless you've changed it in the installation process.</p>
<p class="mce-root">For JAR files, the folder is:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$GLASSFISH_HOME</span>/glassfish/lib</kbd></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating datasources and a connection pool</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To create a datasource and a connection pool to help you use databases in your project, edit the <kbd class="calibre16"><span class="calibre5">$GLASSFISH_HOME/glassfish/domains/[domain_name]/config/domain.xml</span></kbd> file. Inside the <kbd class="calibre16">&lt;resources&gt;</kbd> node, insert a child node like this one:</p>
<pre class="calibre21">&lt;jdbc-connection-pool <br class="calibre2"/>  pool-resize-quantity="4" <br class="calibre2"/>  max-pool-size="64" <br class="calibre2"/>  max-wait-time-in-millis="120000" <br class="calibre2"/>  driver-classname="com.mysql.jdbc.Driver" <br class="calibre2"/>  datasource-classname="com.mysql.jdbc.jdbc2.optional<br class="calibre2"/>  .MysqlDataSource" <br class="calibre2"/>  steady-pool-size="16" <br class="calibre2"/>  name="MysqlPool" <br class="calibre2"/>  idle-timeout-in-seconds="600" <br class="calibre2"/>  res-type="javax.sql.DataSource"&gt;<br class="calibre2"/>      &lt;property name="databaseName" value="database"&gt;&lt;/property&gt;<br class="calibre2"/>      &lt;property name="serverName" value="[host]"&gt;&lt;/property&gt;<br class="calibre2"/>      &lt;property name="user" value="user"&gt;&lt;/property&gt;<br class="calibre2"/>      &lt;property name="password" value="password"&gt;&lt;/property&gt;<br class="calibre2"/>      &lt;property name="portNumber" value="3306"&gt;&lt;/property&gt;<br class="calibre2"/>&lt;/jdbc-connection-pool&gt;<br class="calibre2"/>&lt;jdbc-resource pool-name="MySqlDs" jndi-name="jdbc/MySqlDs"&gt;<br class="calibre2"/>&lt;/jdbc-resource&gt;</pre>
<p class="mce-root">Then, look for this node:</p>
<pre class="calibre21">&lt;server config-ref="server-config" name="server"&gt;</pre>
<p class="mce-root">Add this child to it:</p>
<pre class="calibre21">&lt;resource-ref ref="jdbc/MySqlDs"&gt;&lt;/resource-ref&gt;</pre>
<p class="mce-root"><span class="calibre8">The example targets MySQL, so you will need to perform some changes for another database. Of course, you will also need to change the other parameters according to your needs.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Logging setup and rotate</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To configure logging for GlassFish, edit the <kbd class="calibre16">$GLASSFISH_HOME/glassfish/domains/domain1/config/logging.properties</kbd> file:</p>
<p class="mce-root"><span class="calibre8">The file works with handlers like this:</span></p>
<pre class="calibre21">handlers=java.util.logging.ConsoleHandler<br class="calibre2"/>handlerServices=com.sun.enterprise.server.logging.GFFileHandler<br class="calibre2"/>java.util.logging.ConsoleHandler.formatter=com.sun.enterprise.server.logging.UniformLogFormatter<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.formatter=com.sun.enterprise.server.logging.ODLLogFormatter<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.file=${com.sun.aas.instanceRoot}/logs/server.log<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.rotationTimelimitInMinutes=0<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.flushFrequency=1<br class="calibre2"/>java.util.logging.FileHandler.limit=50000<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.logtoConsole=false<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.rotationLimitInBytes=2000000<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.excludeFields=<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.multiLineMode=true<br class="calibre2"/>com.sun.enterprise.server.logging.SyslogHandler.useSystemLogging=false<br class="calibre2"/>java.util.logging.FileHandler.count=1<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.retainErrorsStasticsForHours=0<br class="calibre2"/>log4j.logger.org.hibernate.validator.util.Version=warn<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.maxHistoryFiles=0<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler.rotationOnDateChange=false<br class="calibre2"/>java.util.logging.FileHandler.pattern=%h/java%u.log<br class="calibre2"/>java.util.logging.FileHandler.formatter=java.util.logging.XMLFormatter</pre>
<p class="mce-root">So, you can define the logging level, directory, format, and more according to your needs.</p>
<p class="mce-root">If you need to configure log rotation, you have to focus on these lines:</p>
<pre class="calibre21">com.sun.enterprise.server.logging.GFFileHandler<br class="calibre2"/>.rotationTimelimitInMinutes=0<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler<br class="calibre2"/>.rotationLimitInBytes=2000000<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler<br class="calibre2"/>.maxHistoryFiles=0<br class="calibre2"/>com.sun.enterprise.server.logging.GFFileHandler<br class="calibre2"/>.rotationOnDateChange=false</pre>
<p class="mce-root">In this example, we are defining this file to rotate on every 2000 kilobytes (2 MB) and will not rotate on date change. There's no limit for history files.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Starting and stopping</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To start GlassFish, just execute this script:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$GLASSFISH_HOME/bin</span><span class="calibre5">/asadmin start-domain --verbose</span></kbd></p>
<p class="mce-root">To stop it, excecute the following script:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$GLASSFISH_HOME/bin</span><span class="calibre5">/asadmin stop-domain</span></kbd></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Session clustering</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Building a cluster using GlassFish is a little tricky and involves using both command line and the admin panel, but it is completely doable! Let's check it out.</p>
<p class="mce-root">First, you need two or more instances (called nodes) up and running. You can do it in any way you like—each one running in a different machine, using virtual machines or containers (my favorite option). Either way you choose, the way of getting the cluster up is the same:</p>
<ol class="calibre19">
<li class="chapter">So, get your first node and open its admin panel:</li>
</ol>
<p class="calibre23"><kbd class="calibre16">https://[hostname]:4848</kbd></p>
<ol start="2" class="calibre19">
<li class="chapter">Click on the <span class="calibre5">Clusters</span> option in the left menu and then click on the <span class="calibre5">New</span> button.  Name the cluster <kbd class="calibre16">myCluster</kbd> and click on the <span class="calibre5">OK</span> button.</li>
<li class="chapter">Select your cluster from the list. In the opened page, select the <span class="calibre5">Instances</span> option in the tab and then click on <span class="calibre5">New</span>. Name the instance <kbd class="calibre16">node1</kbd> and click on <span class="calibre5">OK</span>.</li>
<li class="chapter">Now, go the <span class="calibre5">General</span> tab and click on the <span class="calibre5">Start Cluster</span> button. Voilá! Your cluster is up and running with your first node.</li>
<li class="chapter">Now, go to the second machine (VM, container, other server, or any server) with GlassFish already installed and run this command:</li>
</ol>
<pre class="mce-root2"><strong class="calibre3">$GLASSFISH_HOME/bin/asadmin --host [hostname_node1] --port 4848 create-local-instance --cluster myCluster node2</strong></pre>
<p class="calibre23">This will set the second machine as a member of the cluster. If you refresh the <span class="calibre8">Cluster</span> page on the first machine, you will see the new member (<kbd class="calibre16">node2</kbd>).</p>
<ol start="6" class="calibre19">
<li class="chapter">You will notice that <kbd class="calibre16">node2</kbd> has stopped. Click on it and in the new page click on the <span class="calibre5">Node</span> link (it will usually show the hostname of <kbd class="calibre16">node2</kbd><span class="calibre5"><span class="calibre5">).</span></span></li>
</ol>
<p class="mce-root"> </p>
<ol start="7" class="calibre19">
<li class="chapter">In the opened page, change the <span class="calibre5">Type</span> value to <kbd class="calibre16">SSH</kbd>. Some new fields will show up in a <kbd class="calibre16">SSH</kbd> section.</li>
<li class="chapter">Change <span class="calibre5"><span class="calibre5">SSH User Authentication</span> to <kbd class="calibre16">SSH Password</kbd> and fill the <span class="calibre5">SSH User Password</span> field with the proper password.</span></li>
<li class="chapter">Click on the <span class="calibre5">Save</span> button. If you run some SSH error (usually <kbd class="calibre16">connection refused</kbd>), set the <span class="calibre5">Force</span> option to <span class="calibre5">Enabled,</span> and click on <span class="calibre5">Save</span> button again.</li>
<li class="chapter">Go back to the command line on the machine hosting <kbd class="calibre16">node2</kbd> and run this command:</li>
</ol>
<pre class="mce-root2"><strong class="calibre3">$GLASSFISH_HOME/glassfish/lib/nadmin start-local-instance --node [node2_hostname] --sync normal node2</strong></pre>
<p class="mce-root">If everything went well, your <kbd class="calibre16">node2</kbd> should be up and running and you should now have a real cluster. You can repeat these steps how ever many times you need to add new nodes to your cluster.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">A common issue for this clustering with GlassFish arises when you don't have the SSH service running in your nodes; as there are tons of options of them for many operating systems, we won't cover each one of them here.</p>
<p class="mce-root"><span class="calibre8">The best way to set up a Java EE cluster today is using containers (specially Docker containers). So, I'd recommend that you have a look at <a href="1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">Chapter 11</a>,</span> <em class="calibre17">Rising to the Cloud – Java EE, Containers, and Cloud Computing</em><span class="calibre8">. If you mix that content with this, you will have a powerful environment for your application.</span></p>
<p class="mce-root">To allow your application to share its session with all the nodes in the cluster, you need to edit the <kbd class="calibre16">web.xml</kbd> file, find the <kbd class="calibre16">web-app</kbd> node, and insert this:</p>
<pre class="calibre21"><span class="calibre5">&lt;</span><span class="calibre5">distributable</span><span class="calibre5">/&gt;</span></pre>
<p class="mce-root">Without it, your session clustering will not work. <span class="calibre8">You need also to keep all objects that you are holding in the session as serializable.</span></p>
<p class="mce-root">Finally, there's a commercial version of GlassFish, which is Payara Server. If you are looking for support and other commercial perks, you should take a look at it.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article class="calibre2">
                
<ul class="calibre13">
<li class="calibre14">For more information about GlassFish, visit <a href="https://javaee.github.io/glassfish/" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">https://javaee.github.io/glassfish/</a>.</li>
</ul>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">WildFly usage</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">WildFly is another great Java EE implementation. It was known as <strong class="calibre7">JBoss AS</strong>, but changed its name some years ago (although we still have the JBoss EAP as the <em class="calibre17">enterprise-production ready</em> version). As its administration and use are slightly different from Apache TomEE and GlassFish, it's worth having a proper look at it.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">First, you need to download it to your environment. At the time of writing, WildFly has no Java EE 8-compatible version (actually there is only GlassFish 5). However, the tasks covered here shouldn't change in a future version, as they are not attached to the Java EE specs. To download it, just visit <a href="http://wildfly.org/downloads/" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">http://wildfly.org/downloads/</a>.</p>
<p class="mce-root">This recipe in based on version <span class="calibre8">11.0.0.Final</span> (<span class="calibre8">Java EE7 Full and Web Distribution</span>).</p>
<p class="mce-root">Wherever possible, we will focus on doing the tasks using the configuration files.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre8">Refer to the following detailed tasks.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Deploying EAR, WAR, and JAR files</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">For EAR and WAR files, the deployment folder is:</p>
<p class="mce-root"><kbd class="calibre16">$WILDFLY_HOME/standalone/deployments</kbd></p>
<p class="mce-root">For JAR files (like JDBC connections, for example), WildFly creates a flexible folder structure. So, the best way to distribute them is using its UI, as we will show in the connection pool topic (the next one).</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Creating datasources and a connection pool</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">Take the following steps to create your datasources and connection pool:</p>
<ol class="calibre19">
<li class="chapter"><span class="calibre5">To create a datasource and a connection pool to help you use databases in your project, start WildFly and visit the following URL:</span></li>
</ol>
<p class="calibre23"><kbd class="calibre16">http://localhost:9990/</kbd></p>
<ol start="2" class="calibre19">
<li class="chapter">Click on <span class="calibre5">Deployments</span> and then click on the <span class="calibre5">Add</span> button. In the opened page, select <span class="calibre5"><span class="calibre5">Upload a new deployment</span></span><span class="calibre5"> and click on the <span class="calibre5">Next</span> button. In the opened page, select the proper JDBC connector (we will use MySQL for this recipe) and click on <span class="calibre5">Next</span>.</span></li>
<li class="chapter">Verify the information in the opened page and click on <span class="calibre5">Finish</span>.</li>
<li class="chapter">Now that your JDBC connector is available in the server, you can go ahead and create your datasource. Go to <span class="calibre5">Home</span> in the administration panel and click on the <span class="calibre5">Configuration</span> option.</li>
<li class="chapter">In the opened page, follow this path:</li>
</ol>
<p class="calibre23"><span class="calibre8">Subsystems</span> | <span class="calibre8">Datasources</span> | <span class="calibre8">Non-XA</span> | <span class="calibre8">Datasource</span> | <span class="calibre8">Add</span></p>
<ol start="6" class="calibre19">
<li class="chapter">In the opened window select <span class="calibre5">MySQL Datasource</span> and click on <span class="calibre5">Next</span>. Then, fill the fields like this:</li>
</ol>
<ul class="calibre13">
<li class="calibre27"><span class="calibre5">Name</span>: <kbd class="calibre16">MySqlDS</kbd></li>
<li class="calibre27"><span class="calibre5">JNDI Name</span>: <kbd class="calibre16">java:/MySqlDS</kbd></li>
</ul>
<ol start="7" class="calibre19">
<li class="chapter">Click on <span class="calibre5">Next</span>. In the next page, click on <span class="calibre5">Detected Driver</span>, select the proper MySQL connector (the one you just uploaded) and click on <span class="calibre5">Next</span>.</li>
<li class="chapter">The last step is to fill the connection settings fields, like this:</li>
</ol>
<ul class="calibre13">
<li class="calibre14"><span class="calibre5"><span class="calibre5">Connection URL</span></span><span class="calibre5">: </span><kbd class="calibre16">jdbc:mysql://localhost:3306/sys</kbd></li>
<li class="calibre14"><span class="calibre5"><span class="calibre5">Username</span>: <kbd class="calibre16">root</kbd></span></li>
<li class="calibre14"><span class="calibre5"><span class="calibre5">Password</span>: <kbd class="calibre16">mysql</kbd></span></li>
</ul>
<ol start="9" class="calibre19">
<li class="chapter">Click on the <span class="calibre5">Next</span> button, review the information, and click on <span class="calibre5">Finish</span>. Your newly created connection will appear in the datasources list. You can click on the dropdown list and select <span class="calibre5">Test</span> to check whether everything is working well.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Logging setup and rotate</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To configure the logging for WildFly, edit the <span class="calibre8"><kbd class="calibre16">$WILDFLY_HOME/standalone/configuration/standalone.xml</kbd> </span>file.</p>
<p class="mce-root">To customize the logging properties, find the <kbd class="calibre16">&lt;profile&gt;</kbd> node and then find <kbd class="calibre16">&lt;subsystem xmlns='urn:jboss:domain:logging:3.0'&gt;</kbd> inside it.</p>
<p class="mce-root">It is based on handles like this:</p>
<pre class="calibre21">&lt;console-handler name="CONSOLE"&gt;<br class="calibre2"/>                &lt;level name="INFO"/&gt;<br class="calibre2"/>                &lt;formatter&gt;<br class="calibre2"/>                    &lt;named-formatter name="COLOR-PATTERN"/&gt;<br class="calibre2"/>                &lt;/formatter&gt;<br class="calibre2"/>            &lt;/console-handler&gt;<br class="calibre2"/>            &lt;periodic-rotating-file-handler name="FILE" <br class="calibre2"/>             autoflush="true"&gt;<br class="calibre2"/>                &lt;formatter&gt;<br class="calibre2"/>                    &lt;named-formatter name="PATTERN"/&gt;<br class="calibre2"/>                &lt;/formatter&gt;<br class="calibre2"/>                &lt;file relative-to="jboss.server.log.dir" <br class="calibre2"/>                 path="server.log"/&gt;<br class="calibre2"/>                &lt;suffix value=".yyyy-MM-dd"/&gt;<br class="calibre2"/>                &lt;append value="true"/&gt;<br class="calibre2"/>            &lt;/periodic-rotating-file-handler&gt;<br class="calibre2"/>            &lt;logger category="com.arjuna"&gt;<br class="calibre2"/>                &lt;level name="WARN"/&gt;<br class="calibre2"/>            &lt;/logger&gt;<br class="calibre2"/>            &lt;logger category="org.jboss.as.config"&gt;<br class="calibre2"/>                &lt;level name="DEBUG"/&gt;<br class="calibre2"/>            &lt;/logger&gt;<br class="calibre2"/>            &lt;logger category="sun.rmi"&gt;<br class="calibre2"/>                &lt;level name="WARN"/&gt;<br class="calibre2"/>            &lt;/logger&gt;<br class="calibre2"/>            &lt;root-logger&gt;<br class="calibre2"/>                &lt;level name="INFO"/&gt;<br class="calibre2"/>                &lt;handlers&gt;<br class="calibre2"/>                    &lt;handler name="CONSOLE"/&gt;<br class="calibre2"/>                    &lt;handler name="FILE"/&gt;<br class="calibre2"/>                &lt;/handlers&gt;<br class="calibre2"/>            &lt;/root-logger&gt;<br class="calibre2"/>            &lt;formatter name="PATTERN"&gt;<br class="calibre2"/>                &lt;pattern-formatter pattern=<br class="calibre2"/>                "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/&gt;<br class="calibre2"/>            &lt;/formatter&gt;<br class="calibre2"/>            &lt;formatter name="COLOR-PATTERN"&gt;<br class="calibre2"/>                &lt;pattern-formatter pattern="%K{level}%d<br class="calibre2"/>                {HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/&gt;<br class="calibre2"/>            &lt;/formatter&gt;</pre>
<p class="mce-root">By default, it will rotate daily:</p>
<pre class="calibre21">            &lt;periodic-rotating-file-handler name="FILE" <br class="calibre2"/>             autoflush="true"&gt;<br class="calibre2"/>                &lt;formatter&gt;<br class="calibre2"/>                    &lt;named-formatter name="PATTERN"/&gt;<br class="calibre2"/>                &lt;/formatter&gt;<br class="calibre2"/>                &lt;file relative-to="jboss.server.log.dir" <br class="calibre2"/>                 path="server.log"/&gt;<br class="calibre2"/>                &lt;suffix value=".yyyy-MM-dd"/&gt;<br class="calibre2"/>                &lt;append value="true"/&gt;<br class="calibre2"/>            &lt;/periodic-rotating-file-handler&gt;</pre>
<p class="mce-root">If you want it to rotate based on the size, you should remove the preceding handler and then insert this one:</p>
<pre class="calibre21">            &lt;size-rotating-file-handler name="FILE" autoflush="true"&gt;<br class="calibre2"/>                &lt;formatter&gt;<br class="calibre2"/>                    &lt;pattern-formatter pattern="%d{yyyy-MM-dd <br class="calibre2"/>                     HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/&gt;<br class="calibre2"/>                &lt;/formatter&gt;<br class="calibre2"/>                &lt;file relative-to="jboss.server.log.dir" <br class="calibre2"/>                path="server.log"/&gt;<br class="calibre2"/>                &lt;rotate-size value="2m"/&gt;<br class="calibre2"/>                &lt;max-backup-index value="5"/&gt;<br class="calibre2"/>                &lt;append value="true"/&gt;<br class="calibre2"/>            &lt;/size-rotating-file-handler&gt;</pre>
<p class="mce-root">In this case, the log will rotate when the file reaches 2 MB and will keep a history of five files in the backup.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Starting and stopping</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">To start GlassFish, just execute this script:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$WILDFLY_HOME/bin</span><span class="calibre5">/standalone.sh</span></kbd></p>
<p class="mce-root">To stop it, execute this script:</p>
<p class="mce-root"><kbd class="calibre16"><span class="calibre5">$WILDFLY_HOME/bin</span><span class="calibre5">/<span class="calibre5">jboss-cli.sh --connect command=:shutdown</span></span></kbd></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">Session clustering</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root">If you go to the <kbd class="calibre16"><span class="calibre5">$WILDFLY_HOME/standalone/configuration</span></kbd> folder, you will see these files:</p>
<ul class="calibre13">
<li class="calibre14"><kbd class="calibre16"><span class="calibre5">standalone.xml</span></kbd></li>
<li class="calibre14"><kbd class="calibre16"><span class="calibre5">standalone-ha.xml </span></kbd></li>
<li class="calibre14"><kbd class="calibre16"><span class="calibre5">standalone-full.xml </span></kbd></li>
<li class="calibre14"><kbd class="calibre16">standalone-full-ha.xml</kbd> </li>
</ul>
<p class="mce-root"><kbd class="calibre16">standalone.xml</kbd> is the default, with all default configuration. To build a cluster, we need to use the <kbd class="calibre16">standalone-ha.xml</kbd> file (<kbd class="calibre16">ha</kbd> comes from <strong class="calibre7">high availability</strong>), so rename it to end it as <kbd class="calibre16">standalone.xml</kbd>.</p>
<p class="mce-root">Then, you start the server. You should not do the following:</p>
<pre class="calibre21"><span class="calibre5">$WILDFLY_HOME/bin</span><span class="calibre5">/standalone.sh</span></pre>
<p class="mce-root">Instead, you should do this:</p>
<pre class="calibre21"><span class="calibre5">$WILDFLY_HOME/bin</span><span class="calibre5">/standalone.sh </span>-b 0.0.0.0 -bmanagement 0.0.0.0</pre>
<p class="mce-root">You should now do the same in whatever other nodes (machines, VMs, containers, and so on) that you want to get into the cluster. Of course, they need to be in the same network.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article class="calibre2">
                
<p class="mce-root"><span class="calibre8">The best way to set up a Java EE cluster today is using containers (specially Docker containers). So, I'd recommend that you have a look at the <a href="1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">Chapter 11</a>, </span> <em class="calibre17">Rising to the Cloud – Java EE, Containers, and Cloud Computing</em> <span class="calibre8">chapter. If you mix that content with this, you will have a powerful environment for your application.</span></p>
<p class="mce-root">To allow your application to share its session with all nodes in the cluster, you need to edit the <kbd class="calibre16">web.xml</kbd> file, find the <kbd class="calibre16">web-app</kbd> node, and insert this:</p>
<pre class="calibre21"><span class="calibre5">&lt;</span><span class="calibre5">distributable</span><span class="calibre5">/&gt;</span></pre>
<p class="mce-root">Without it, your session clustering will not work.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content" class="calibre1"><section class="calibre2">

                            <header class="calibre2">
                    <h1 class="header-title">See also</h1>
                </header>
            
            <article class="calibre2">
                
<ul class="calibre13">
<li class="calibre14">For more information about WildFly, visit <a href="http://wildfly.org/" target="_blank" class="pcalibre pcalibre3 pcalibre1 calibre12 pcalibre2">http://wildfly.org/</a></li>
</ul>
<p class="mce-root"> </p>


            </article>

            
        </section>
    </div>



  </body></html>