<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Building Cucumber Frameworks" id="aid-1KEEU1"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Building Cucumber Frameworks</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">Building a Web Automation framework</li><li class="listitem">Building a Mobile Automation framework</li><li class="listitem">Building a REST Automation framework</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec50"/>Introduction</h1></div></div></div><p>Cucumber is a platform to implement BDD and not automate applications. For automating applications, different APIs are available like Selenium Webdriver for the Web, Appium for mobile, and HTTP Client for REST Services. Until now, we have learned various Cucumber Features so that we can build a robust automation framework but we also need to integrate Cucumber with the APIs mentioned earlier so that we can have frameworks which automate real-time applications.</p><p>In this chapter, we will learn how to build frameworks to automate Web, REST, and Mobile applications.</p></div></div>
<div class="section" title="Building a Web Automation framework"><div class="titlepage" id="aid-1LCVG2"><div><div><h1 class="title"><a id="ch06lvl1sec51"/>Building a Web Automation framework</h1></div></div></div><p>
<span class="strong"><strong>Selenium</strong></span> is a Web<a id="id307" class="indexterm"/> Automation tool that has made life a lot easier for testers because of its <a id="id308" class="indexterm"/>capabilities and powers, and is the number one choice for testers to automate websites. That's the reason we have <a id="id309" class="indexterm"/>also chosen Selenium for our framework.</p><p>When we create a framework, we should keep in mind that adding new test cases and making changes to existing test cases should be fairly easy and simple.</p><p>Let's learn how we can create a robust Web Automation framework using Cucumber and Selenium, along with keeping maintainability and scalability in mind.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec95"/>Getting ready</h2></div></div></div><p>Install Firefox on your<a id="id310" class="indexterm"/> system as per the version supported by the latest Selenium version. For more information on Selenium and browser support, visit<a id="id311" class="indexterm"/> the web page at <a class="ulink" href="http://docs.seleniumhq.org/about/platforms.jsp">http://docs.seleniumhq.org/about/platforms.jsp</a>.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec96"/>How to do it…</h2></div></div></div><p>Let's first understand the test case that we will use in this framework. We will test the login<a id="id312" class="indexterm"/> functionality of <a class="ulink" href="https://github.com/">https://github.com/</a>. The following is the test case flow:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We open <a class="ulink" href="https://github.com/">https://github.com/</a> and click on <span class="strong"><strong>Sign in</strong></span>.</li><li class="listitem">We don't enter the username and password and click on <span class="strong"><strong>Sign in</strong></span>:<div class="mediaobject"><img src="../Images/image00174.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We verify the error message we get:<div class="mediaobject"><img src="../Images/image00175.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We will<a id="id313" class="indexterm"/> create a simple Maven project using the Eclipse Maven plugin. Click on <span class="strong"><strong>New</strong></span> in the Eclipse menu and follow the screenshots to create the Maven project named <code class="literal">CucumberWebAutomation</code>:<div class="mediaobject"><img src="../Images/image00176.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><div class="mediaobject"><img src="../Images/image00177.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p><div class="mediaobject"><img src="../Images/image00178.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Since it is<a id="id314" class="indexterm"/> a Maven project, we will update the <code class="literal">pom.xml</code> file for adding the dependencies of Cucumber and Selenium. As of now, this is what <code class="literal">pom.xml</code> looks like:<div class="informalexample"><pre class="programlisting">&lt;project   
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;CucumberWebAutomation&lt;/groupId&gt;
  &lt;artifactId&gt;CucumberWebAutomation&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;CucumberWebAutomation&lt;/name&gt;
  &lt;description&gt;Cucumber+Selenium project&lt;/description&gt;
&lt;/project&gt;</pre></div></li><li class="listitem">We will add the <code class="literal">properties</code> tag and define properties for the Cucumber and Selenium versions so that when we need to update the dependency version, we will need to do it only at one place. Add the following code to <code class="literal">pom.xml</code> inside the <code class="literal">&lt;project&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;selenium.version&gt;2.45.0&lt;/selenium.version&gt;
  &lt;cucumber.version&gt;1.2.2&lt;/cucumber.version&gt;
&lt;/properties&gt;</pre></div><div class="note" title="Note"><h3 class="title"><a id="note18"/>Note</h3><p>To check latest<a id="id315" class="indexterm"/> dependency version on Maven central repository, refer to <a class="ulink" href="http://search.maven.org/">http://search.maven.org/</a>.</p></div></li><li class="listitem">We will add <a id="id316" class="indexterm"/>dependency for Cucumber-JVM for BDD and Selenium-JVM for web automation. Please add the following code to <code class="literal">pom.xml</code> after the <code class="literal">&lt;/properties&gt;</code> tag:<div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;!-- cucumber --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-junit&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;

  &lt;!-- Selenium --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.seleniumhq.selenium&lt;/groupId&gt;
    &lt;artifactId&gt;selenium-java&lt;/artifactId&gt;
    &lt;version&gt;${selenium.version}&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div></li><li class="listitem">We will create the project structure and will keep similar files in the same package. Follow the steps shown in this screenshot and create the packages as mentioned:<div class="mediaobject"><img src="../Images/image00179.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Since it is a <a id="id317" class="indexterm"/>Cucumber project, we are going to add the <code class="literal">RunCukeTest.java</code> file to specify the configuration, such as the location of Feature files, the location of Step Definitions, the output location, and so on. Add the following class to the <code class="literal">CucumberOptions</code> package:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.cucumberOptions;

import org.junit.runner.RunWith;

import cucumber.api.CucumberOptions;
import cucumber.api.junit.Cucumber;

@RunWith(Cucumber.class)
@CucumberOptions(

  features = "src/test/java/com/cucumber/automation/bdt/features",
    glue = "com.cucumber.automation.bdt.stepDefinitions",
      plugin = { 
        "pretty",
          "html:target/cucumber",
  }
)
public class RunCukeTest {
}</pre></div></li><li class="listitem">Now it's time<a id="id318" class="indexterm"/> to add a Feature file to specify the requirements. We will add the <code class="literal">github_login.feature</code> file to the package features. This is how our Feature file look likes:<div class="informalexample"><pre class="programlisting">Feature: login Page
  In order to test login page
  As a Registered user
  I want to specify the login conditions

  Scenario: login without username and password
    Given user is on github homepage
    When user clicks on Sign in button
    Then user is displayed login screen
    When user clicks Sign in button
    Then user gets an error message "Incorrect username or password."</pre></div></li><li class="listitem">The next step is to add Step Definitions. The simplest way would be to run the project once and use the suggestions given by Cucumber. Add a <code class="literal">GithubLoginSD.java</code> file to the <code class="literal">stepDefinitions</code> package and it should have the following code:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class GithubLoginSD {

  @Given("^user is on github homepage$")
  public void user_is_on_github_homepage()  {  

  }

  @When("^user clicks on Sign in button$")
  public void user_clicks_on_Sign_in_button()  {  
 
  }

  @Then("^user is displayed login screen$")
  public void user_is_displayed_login_screen()  {
 
  }

  @When("^user clicks Sign in button$")
  public void user_clicks_Sign_in_button()  {  

  }

  @Then("^user gets an error message \"(.*?)\"$")
  public void user_gets_an_error_message(String arg1)  {

  }

}</pre></div></li><li class="listitem">Now we need<a id="id319" class="indexterm"/> to add Selenium functions, which can be used to invoke the Firefox browser and close the browser once the execution finishes. I am keeping this file very basic for simplicity purposes. Create the <code class="literal">DriverFactory.java</code> class in the <code class="literal">utils</code> package, and the code should look like this:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.utils;

import java.net.MalformedURLException;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.WebDriver;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.support.ui.WebDriverWait;


public class DriverFactory {

  public static WebDriver driver = null;
  public static WebDriverWait waitVar = null;

  public static String baseURL = "https://github.com/";

  /**
   *  This function is to invoke Selenium Webdriver
   * 
   * @throws MalformedURLException
   * @throws InterruptedException
   */
  public void createDriver() throws MalformedURLException,
  InterruptedException {

    driver = new FirefoxDriver();

    driver.manage().window().maximize();
    driver.manage().timeouts().implicitlyWait(15, TimeUnit.SECONDS);

    driver.get(baseURL);

    waitVar = new WebDriverWait(driver, 15);
  }

  /**
   * This function is to close driver instance
   */
  public void teardown() {
    driver.quit();
  }
}</pre></div></li><li class="listitem">Now we need<a id="id320" class="indexterm"/> to hook this code so that the browser can be initiated before each scenario and closed after each scenario. Create a <code class="literal">Hooks.java</code> file in the <code class="literal">stepdefinitions</code> package with the following code:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import java.net.MalformedURLException;

import com.cucumber.automation.utils.DriverFactory;

import cucumber.api.java.After;
import cucumber.api.java.Before;

public class Hooks {

  DriverFactory df = new DriverFactory();

@Before
  public void beforeScenario() throws MalformedURLException, InterruptedException{

  df.createDriver();
  }

@After
  public void afterScenario(){
  df.teardown();
  }
}</pre></div></li><li class="listitem">Now we will implement<a id="id321" class="indexterm"/> <span class="strong"><strong>Page Object Model</strong></span> (<span class="strong"><strong>POM</strong></span>) so that maintaining and extending the <a id="id322" class="indexterm"/>Selenium code will be fairly simple. I am also keeping the POM simple; you are free to extend it in your projects.<p>We will add the <code class="literal">page</code> object for the GitHub login page in the <code class="literal">web.pages</code> package and the code will look like this:</p><div class="informalexample"><pre class="programlisting">package com.cucumber.automation.web.pages;

import static org.junit.Assert.assertEquals;

import org.openqa.selenium.By;
import org.openqa.selenium.support.ui.ExpectedConditions;

import com.cucumber.automation.utils.DriverFactory;

public class LoginPage extends DriverFactory {

  /**
   * All locators will be mentioned here
   * 
   * For this example i am not using properties file for reading locators
   */

  By SigninLink = By.linkText("Sign in");
  By marketingSection = By.className("marketing-section-signup");
  By loginSection = By.className("auth-form-body");
  By SigninButton = By.name("commit");
  By errorMessage = By.xpath("//div[@id='site-container']/div/div");

  /**
   * All functions related to behavior will follow now
   */
public void ishomepageDisplayed() {
  waitVar.until(ExpectedConditions.presenceOfElementLocated(SigninLink));

  driver.findElement(SigninLink).isDisplayed();
  driver.findElement(marketingSection).isDisplayed();
}

public void clickSigninLink() {
  driver.findElement(SigninLink).click();
}

public void isloginsectionDisplayed() {
  waitVar.until(ExpectedConditions.presenceOfElementLocated(loginSection));
  waitVar.until(ExpectedConditions.presenceOfElementLocated(SigninButton));
}

public void clickSigninButton() {
  driver.findElement(SigninButton).click();
}

public void verifyErrorMessage(String msg) {
  waitVar.until(ExpectedConditions.presenceOfElementLocated(errorMessage));

  assertEquals(msg, driver.findElement(errorMessage).getText());
}
}</pre></div></li><li class="listitem">We will have to update<a id="id323" class="indexterm"/> the Step Definition files for the Selenium functions that we have just written. After adding all the functions, the code should look like this:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import com.cucumber.automation.web.pages.LoginPage;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class GithubLoginSD {

  LoginPage lp = new LoginPage();

  @Given("^user is on github homepage$")
  public void user_is_on_github_homepage()  {  
    lp.ishomepageDisplayed();
  }

  @When("^user clicks on Sign in button$")
  public void user_clicks_on_Sign_in_button()  {  
    lp.clickSigninLink();
  }

  @Then("^user is displayed login screen$")
  public void user_is_displayed_login_screen()  {
    lp.isloginsectionDisplayed();
  }

  @When("^user clicks Sign in button$")
  public void user_clicks_Sign_in_button()  {  
    lp.clickSigninButton();
  }

  @Then("^user gets an error message \"(.*?)\"$")
  public void user_gets_an_error_message(String arg1)  {
    lp.verifyErrorMessage(arg1);
  }

}</pre></div></li><li class="listitem">Our framework is<a id="id324" class="indexterm"/> ready to be executed. We can run this framework either from Eclipse or from the command line. Let's run this from the command line using <code class="literal">mvn test</code>. The following is the output:<div class="mediaobject"><img src="../Images/image00180.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec97"/>How it works…</h2></div></div></div><p>We have integrated<a id="id325" class="indexterm"/> Cucumber, Selenium, Maven, Java and Page Objects to design our Web Automation Framework. Cucumber is for implementing BDD, so that nontechnical people can also directly contribute to the development—Selenium for web automation, Java as a programming language, and Maven as a build tool.</p><p>Page Objects is a framework design approach for maintaining and accessing components and controls spread across test Scenarios. Page Objects creates a DSL for our tests so that if something changes on the page, we don't need to change the test; we just need to update the object that represents the page.</p></div></div>
<div class="section" title="Building a Mobile Automation framework"><div class="titlepage" id="aid-1MBG22"><div><div><h1 class="title"><a id="ch06lvl1sec52"/>Building a Mobile Automation framework</h1></div></div></div><p>
<span class="strong"><strong>Appium</strong></span> is an open source <a id="id326" class="indexterm"/>Mobile Automation tool that has made life a lot easier for testers because<a id="id327" class="indexterm"/> it supports both Android and iOS. It has extended Selenium API, so all the Selenium advantages <a id="id328" class="indexterm"/>plus the advantage of running test cases on multiple platforms makes it an obvious choice for mobile automation.</p><p>Let's learn how we can create a robust mobile automation framework using Cucumber and Appium, along with keeping maintainability and scalability in mind using the Page Object Model.</p><p>I am just giving a demo of Android app automation; the same project and framework can be used for iOS automation as well. I will also create placeholders for iOS packages for your reference, if you<a id="id329" class="indexterm"/> want to use a single framework for both Android and iOS apps.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec98"/>Getting ready</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Download and install <a id="id330" class="indexterm"/>Appium on your system and for more information, refer to <a class="ulink" href="http://appium.io/downloads.html">http://appium.io/downloads.html</a>.</li><li class="listitem">Download and install Android SDK Manager from <a class="ulink" href="http://developer.android.com/tools/help/sdk-manager.html">http://developer.android.com/tools/help/sdk-manager.html</a>.</li><li class="listitem">Download and install Android AVD Manager from <a class="ulink" href="http://developer.android.com/tools/help/avd-manager.html">http://developer.android.com/tools/help/avd-manager.html</a>.</li><li class="listitem">Create one Android <a id="id331" class="indexterm"/>virtual device to run the app. For more information, refer to <a class="ulink" href="http://developer.android.com/tools/devices/managing-avds.html">http://developer.android.com/tools/devices/managing-avds.html</a>.<div class="note" title="Note"><h3 class="title"><a id="note19"/>Note</h3><p>Running Android on Windows or running test cases on Appium is out of the scope of this book. Readers are expected to have basic mobile automation knowledge. We will focus on creating the Cucumber Appium framework.</p></div></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec99"/>How to do it…</h2></div></div></div><p>Let's first understand the test case that we will use in this framework. We will use Agile NCR app for Android for this recipe. Let me walk-through the test Steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">We open the <span class="strong"><strong>Agile NCR</strong></span> app and verify the home page:<div class="mediaobject"><img src="../Images/image00181.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We click on the<a id="id332" class="indexterm"/> <span class="strong"><strong>AGENDA</strong></span> option and verify the <span class="strong"><strong>AGENDA</strong></span> screen:<div class="mediaobject"><img src="../Images/image00182.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We click on the<a id="id333" class="indexterm"/> Back button and verify the home page.<div class="note" title="Note"><h3 class="title"><a id="note20"/>Note</h3><p>I have included this application in the project that can be found on GitHub.</p></div></li><li class="listitem">We are going to create a simple Maven project using the Eclipse Maven plugin. Use the same steps mentioned in first recipe to create the project and name it <code class="literal">CucumberMobileAutomation</code>.</li><li class="listitem">Since it is a Maven project, we will update the <code class="literal">pom.xml</code> file to add the dependencies of Cucumber and Appium. As of now, this is what the <code class="literal">pom.xml</code> file looks like:<div class="informalexample"><pre class="programlisting">&lt;project   
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;CucumberMobileAutomation&lt;/groupId&gt;
  &lt;artifactId&gt;CucumberMobileAutomation&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;CucumberMobileAutomation&lt;/name&gt;
  &lt;description&gt;Cucumber+Appium project&lt;/description&gt;

&lt;/project&gt;</pre></div></li><li class="listitem">We will add the <code class="literal">properties</code> tag and define the properties for the Cucumber and Appium versions, <a id="id334" class="indexterm"/>so that when we need to update the dependency version, we will need to do it only at one place. Add the following code to <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;appium.version&gt;2.2.0&lt;/appium.version&gt;
  &lt;cucumber.version&gt;1.2.2&lt;/cucumber.version&gt;
&lt;/properties&gt;</pre></div><div class="note" title="Note"><h3 class="title"><a id="note21"/>Note</h3><p>To check the latest <a id="id335" class="indexterm"/>dependency version on Maven central repository, refer to <a class="ulink" href="http://search.maven.org/">http://search.maven.org/</a>.</p></div></li><li class="listitem">We will add dependency for Cucumber-JVM for BDD and Appium-Java for mobile automation. Add the following code to <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;!-- cucumber --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-junit&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;

  &lt;!--  Appium --&gt;
  &lt;dependency&gt;
      &lt;groupId&gt;io.appium&lt;/groupId&gt;
      &lt;artifactId&gt;java-client&lt;/artifactId&gt;
      &lt;version&gt;${appium.version}&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div></li><li class="listitem">We will create the project structure and keep similar files in the same package. I am going<a id="id336" class="indexterm"/> to use the packages added for Android, and use the packages added for iOS are for reference purpose. Follow the steps shown in this screenshot and create the packages as mentioned:<div class="mediaobject"><img src="../Images/image00183.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Since it is a Cucumber project, we are going to add the <code class="literal">RunCukeTest.java</code> file to specify the <a id="id337" class="indexterm"/>configuration, such as the location of Feature files, location of step definitions, and output location, and so on. Add the following class to the <code class="literal">CucumberOptions</code> package:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.cucumberOptions;

import org.junit.runner.RunWith;

import cucumber.api.CucumberOptions;
import cucumber.api.junit.Cucumber;

@RunWith(Cucumber.class)
@CucumberOptions(

  features = "src/test/java/com/cucumber/automation/bdt/features",
      glue = "com.cucumber.automation.bdt.stepDefinitions",
        plugin = { 
          "pretty",
            "html:target/cucumber",
        }
)
public class RunCukeTest {
}</pre></div></li><li class="listitem">Now it's time to add a feature file to specify the requirements. We will add the <code class="literal">agile_ncr.feature</code> file to the package features. This is how our feature file look likes:<div class="informalexample"><pre class="programlisting">Feature: Agile NCR App
  In order to look at Agile NCR Conference
  As a Registered user
  I want to specify the flow to Agenda and Speakers

Scenario: Agenda
  Given user is on AgileNCR Home Page
  Then user gets an option Agenda
  When user selects Agenda
  Then user is on Agenda Screen
  When user chooses to go back
  Then user is on AgileNCR Home Page</pre></div></li><li class="listitem">The next step is to add Step Definitions. The simplest way would be to run the project once <a id="id338" class="indexterm"/>and use the suggestions given by Cucumber. Add the file <code class="literal">AgileNCRSD.java</code> to the <code class="literal">stepDefinitions</code> package, and it should contain the following code:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class AgileNCRSD {


  @Given("^user is on AgileNCR Home Page$")
  public void user_is_on_AgileNCR_Home_Page()  {
 
  }

  @Then("^user gets an option Agenda$")
  public void user_gets_an_option_Agenda()  {
 
  }

  @When("^user selects Agenda$")
  public void user_selects_Agenda()  {
 
  }

  @Then("^user is on Agenda Screen$")
  public void user_is_on_Agenda_Screen()  {

  }

  @When("^user chooses to go back$")
  public void user_chooses_to_go_back()  {

  }

}</pre></div></li><li class="listitem">Now, add the <code class="literal">.apk</code> file needed to run the <code class="literal">app</code> to the apps folder in <code class="literal">src/test/resources</code>.</li><li class="listitem">Then, we need to add the Appium functions, which can be used to invoke the Android app and close the app once the execution finishes. I am keeping this file very basic for <a id="id339" class="indexterm"/>simplicity purposes. Create the <code class="literal">AppiumFactory.java</code> class in the <code class="literal">utils</code> package and the code should look like this:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.utils;

import io.appium.java_client.android.AndroidDriver;

import java.io.File;
import java.net.MalformedURLException;
import java.net.URL;

import org.openqa.selenium.remote.DesiredCapabilities;
import org.openqa.selenium.support.ui.WebDriverWait;

public class AppiumFactory {

  public static AndroidDriver driver = null;
  public static WebDriverWait waitVar = null;

  /**
   * This function is to invoke Appium
   * 
   * @throws MalformedURLException
   * @throws InterruptedException
   */
  public void createDriver() throws MalformedURLException {

    // set up appium
    final File classpathRoot = new File(System.getProperty("user.dir"));
    final File appDir = new File(classpathRoot, "src/test/resources/apps");
    final File app = new File(appDir, "com.xebia.eventsapp_2.1.apk");

    final DesiredCapabilities capabilities = new DesiredCapabilities();
    capabilities.setCapability("platformName", "Android");
    capabilities.setCapability("deviceName", "Android Emulator");
    capabilities.setCapability("platformVersion", "4.4");
    capabilities.setCapability("app", app.getAbsolutePath());

    driver = new AndroidDriver(new URL("http://127.0.0.1:4723/wd/hub"),
    capabilities);

    waitVar = new WebDriverWait(driver, 90);

  }

  /**
   * This function is to close driver instance
   */
  public void teardown() {
    driver.quit();
  }
}</pre></div></li><li class="listitem">Now, we need to hook this code so that the browser can be initiated before each scenario and closed after each scenario. Create a <code class="literal">Hooks.java</code> file in the <code class="literal">stepdefinitions</code> package with the following code:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import java.net.MalformedURLException;
import com.cucumber.automation.utils.AppiumFactory;
import cucumber.api.java.After;
import cucumber.api.java.Before;

public class Hooks {

  AppiumFactory df = new AppiumFactory();
  
@Before
  public void beforeScenario() throws MalformedURLException, InterruptedException{
    df.createDriver();
  }
  
@After
  public void afterScenario(){
    df.teardown();
  }
}</pre></div></li><li class="listitem">Now, we will implement the POM, so that maintaining and extending Appium code will be fairly <a id="id340" class="indexterm"/>simple. I am also keeping the POM simple; you are free to extend it in your projects.<p>We will add two page objects, one for <code class="literal">HomePage</code> and the other for <code class="literal">AgendaPage</code>. The code for <code class="literal">HomePage.java</code> looks like this:</p><div class="informalexample"><pre class="programlisting">package com.cucumber.automation.mobile.pages.android;

import static org.junit.Assert.assertTrue;
import org.openqa.selenium.By;
import org.openqa.selenium.support.ui.ExpectedConditions;
import com.cucumber.automation.utils.AppiumFactory;

public class HomePage extends AppiumFactory {

  /**
   * All locators will be mentioned here
   * 
   * For this example i am not using properties file for reading locators
   */
    By homePageImage = By.id("com.xebia.eventsapp:id/home_banner_imageView");
    By agendaButton = By.id("com.xebia.eventsapp:id/home_agenda_title");

    By backButton = By.id("android:id/home");


  /**
   * All functions related to behavior will follow now
   */
  public void verifyHomePage(){
    waitVar.until(ExpectedConditions.presenceOfElementLocated(homePageImage));
    assertTrue(driver.findElement(homePageImage).isDisplayed());
  }
    
  public void verifyHomePageOptions(){
    waitVar.until(ExpectedConditions.presenceOfElementLocated(homePageImage));
    waitVar.until(ExpectedConditions.elementToBeClickable(agendaButton));
    
    assertTrue(driver.findElement(agendaButton).isDisplayed());
  }

  public void clickAgenda(){
    driver.findElement(agendaButton).click();
  }
}</pre></div><p>The<a id="id341" class="indexterm"/> code for <code class="literal">AgendaPage.java</code> looks like this:</p><div class="informalexample"><pre class="programlisting">package com.cucumber.automation.mobile.pages.android;

import static org.junit.Assert.*;
import org.openqa.selenium.By;
import org.openqa.selenium.support.ui.ExpectedConditions;
import com.cucumber.automation.utils.AppiumFactory;

public class AgendaPage extends AppiumFactory {

  // All the locators for Agenda page will be defined here
  By title = By.id("com.xebia.eventsapp:id/action_bar_custom_title");
  By AgendaList = By.className("android.widget.LinearLayout");

  By backButton = By.id("android:id/home");

  // All the behavior of Agenda page will be defined here in functions
  public void verifyAgendaPage() {
  
    waitVar.until(ExpectedConditions.presenceOfElementLocated(title));

    assertEquals("Agenda", driver.findElement(title).getText());
    assertTrue(driver.findElements(AgendaList).size() &gt;= 0);
  }

  public void clickBack() {
    driver.findElement(backButton).click();
  }

}</pre></div></li><li class="listitem">We will have to update the Step Definition files for the Selenium functions that we have just<a id="id342" class="indexterm"/> written. After adding all the functions, the code should look like this:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import com.cucumber.automation.mobile.pages.android.AgendaPage;
import com.cucumber.automation.mobile.pages.android.HomePage;

import cucumber.api.java.en.Given;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class AgileNCRSD {

  HomePage hp = new HomePage();
  AgendaPage ap = new AgendaPage();

  @Given("^user is on AgileNCR Home Page$")
  public void user_is_on_AgileNCR_Home_Page() {
    hp.verifyHomePage();
  }

  @Then("^user gets an option Agenda$")
  public void user_gets_an_option_Agenda() {
    hp.verifyHomePageOptions();
  }

  @When("^user selects Agenda$")
  public void user_selects_Agenda() {
    hp.clickAgenda();
  }

  @Then("^user is on Agenda Screen$")
  public void user_is_on_Agenda_Screen() {
    ap.verifyAgendaPage();
  }

  @When("^user chooses to go back$")
  public void user_chooses_to_go_back() {
    ap.clickBack();
  }

}</pre></div></li><li class="listitem">Our framework<a id="id343" class="indexterm"/> is ready. Before we can start the execution, we need to start the Appium server. Start the Appium server with the default settings, as shown in the following screenshot:<div class="mediaobject"><img src="../Images/image00184.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">We can run this framework either from Eclipse or from the command line. Let's run this<a id="id344" class="indexterm"/> from the command line using <code class="literal">mvn test</code>. The following is the output:<div class="mediaobject"><img src="../Images/image00185.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec100"/>How it works…</h2></div></div></div><p>We have integrated Cucumber, Appium, Maven, Java, and Page Objects to design our Mobile Automation framework. Cucumber is for implementing BDD, so that nontechnical people <a id="id345" class="indexterm"/>can also directly contribute to the development—Appium for web automation, Java as a programming language, and Maven as a build tool.</p><p>Page Objects is a framework design approach for maintaining and accessing components and controls spread across test Scenarios. Page Object creates a DSL for our tests; thus, if something changes on the page, we don't need to change the test; we just need to update the object that represents the page.</p></div></div>
<div class="section" title="Building a REST Automation framework"><div class="titlepage" id="aid-1NA0K2"><div><div><h1 class="title"><a id="ch06lvl1sec53"/>Building a REST Automation framework</h1></div></div></div><p>HTTP Client is an open source REST services library developed by Apache. I am using HTTP Client for this<a id="id346" class="indexterm"/> framework because this is a pure Java implementation and is very easy to use. We need to create an instance of the HTTP client and then just use <a id="id347" class="indexterm"/>one of the already defined functions.</p><p>Since there is no UI involved and there is a limit to the functions that we need to use, there is no need for the POM in this framework. Let's learn how we can create a robust REST automation framework using Cucumber and HTTP Client.</p><div class="note" title="Note"><h3 class="title"><a id="note22"/>Note</h3><p>I am just giving a demo of REST Services automation, the same project and framework can be used for SOAP automation as well.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec101"/>How to do it…</h2></div></div></div><p>Let's first understand the test case that we will use in this framework. I am going to test the  <code class="literal">GET</code> and <code class="literal">POST</code> methods. Let me walk-through the test Steps.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Send a <code class="literal">GET</code> request to<a id="id348" class="indexterm"/> the GitHub URL at <a class="ulink" href="https://api.github.com/users/ShankarGarg">https://api.github.com/users/ShankarGarg</a> to verify the user details.</li><li class="listitem">Send a <code class="literal">POST</code> request to<a id="id349" class="indexterm"/> the Apple service center at <a class="ulink" href="https://selfsolve.apple.com/wcResults.do">https://selfsolve.apple.com/wcResults.do</a> to register your device.</li><li class="listitem">We are going to create a simple Maven project using the Eclipse Maven plugin. Use the same steps mentioned in first recipe to create the project and name it <code class="literal">CucumberRESTAutomation</code>.</li><li class="listitem">Since it is a Maven project, we will update the <code class="literal">pom.xml</code> file for adding dependencies of Cucumber and Appium. As of now, this is how the <code class="literal">pom.xml</code> file looks like:<div class="informalexample"><pre class="programlisting">&lt;project  
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;CucumberRESTAutomation&lt;/groupId&gt;
  &lt;artifactId&gt;CucumberRESTAutomation&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;CucumberRESTAutomation&lt;/name&gt;
  &lt;description&gt;Cucumber+HTTP Client project&lt;/description&gt;
&lt;/project&gt;</pre></div></li><li class="listitem">We will add the <code class="literal">properties</code> tag and define the properties for the Cucumber and Appium versions, so that when we need to update the dependency version we will need to do it only at one place. Add the following code to <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;http.version&gt;4.4.1&lt;/http.version&gt;
  &lt;cucumber.version&gt;1.2.2&lt;/cucumber.version&gt;
&lt;/properties&gt;</pre></div><div class="note" title="Note"><h3 class="title"><a id="note23"/>Note</h3><p>To check the latest dependency version on<a id="id350" class="indexterm"/> Maven central repository, refer to <a class="ulink" href="http://search.maven.org/">http://search.maven.org/</a>.</p></div></li><li class="listitem">We will add <a id="id351" class="indexterm"/>dependency for Cucumber-JVM for BDD, Appium-java for mobile automation. Add the following code to <code class="literal">pom.xml</code>:<div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;!-- cucumber --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-java&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;info.cukes&lt;/groupId&gt;
    &lt;artifactId&gt;cucumber-junit&lt;/artifactId&gt;
    &lt;version&gt;${cucumber.version}&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
    
  &lt;!-- HTTPClient --&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
    &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
    &lt;version&gt;${http.version}&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div></li><li class="listitem">We will create the<a id="id352" class="indexterm"/> project structure and will keep similar files in the same package. Follow the steps shown in this screenshot and create the packages as mentioned:<div class="mediaobject"><img src="../Images/image00186.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li><li class="listitem">Since it is a Cucumber project, we are going to add the <code class="literal">RunCukeTest.java</code> file to specify the configuration, such as the location of feature files, the location of step definitions, the output location, and so on. Add the following class to the <code class="literal">CucumberOptions</code> package:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.cucumberOptions;

import org.junit.runner.RunWith;

import cucumber.api.CucumberOptions;
import cucumber.api.junit.Cucumber;

@RunWith(Cucumber.class)
@CucumberOptions(

  features = "src/test/java/com/cucumber/automation/bdt/features",
  glue = "com.cucumber.automation.bdt.stepDefinitions",
  plugin = { 
    "pretty",
      "html:target/cucumber",
  } 
)
public class RunCukeTest {
}</pre></div></li><li class="listitem">Now it's time<a id="id353" class="indexterm"/> to add the feature file to specify the requirements. We will add the <code class="literal">REST_Services.feature</code> file to the package features. This is how our feature file look likes:<div class="informalexample"><pre class="programlisting">Feature: SOA Test
  In order to test rest services
  As a Registered user
  I want to specify the rest services test conditions

  Scenario: GET Request - GIT Hub User details
    When user sends a GET request with "https://api.github.com/users/ShankarGarg"
    Then status code should be 200
    And response type should be "json"
    And response contains user name "Shankar Garg"

  Scenario: POST Request - Register a user
    When user sends a POST request to "https://selfsolve.apple.com/wcResults.do" with following details
      | key    | value        |
      | sn     | C2WGC14ADRJ7 |
      | cn     |              |
      | locale |              |
      | caller |              |
      | num    | 12345        |
    Then status code should be 200
    And response type should be "html"
    And response contains user name "C2WGC14ADRJ7"</pre></div></li><li class="listitem">The next step is to add Step Definitions. The simplest way would be run the project once and use the suggestions given by Cucumber. Add a <code class="literal">RESTServicesSD.java</code> file to the <code class="literal">stepDefinitions</code> package and it should have the following code:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import cucumber.api.DataTable;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class RestServicesSD {

  @When("^user sends a GET request with \"(.*?)\"$")
  public void user_sends_a_GET_request_with(String arg1) {
  }

  @Then("^status code should be (\\d+)$")
  public void status_code_should_be(int arg1) {
  }

  @Then("^response type should be \"(.*?)\"$")
  public void response_type_should_be(String arg1) {
  }

  @Then("^response contains user name \"(.*?)\"$")
  public void response_contains_user_name(String arg1) {
  }

  @When("^user sends a POST request to \"(.*?)\" with follwoing details$")
  public void user_sends_a_POST_request_to_with_follwoing_details(
      String arg1, DataTable arg2) {
    }

}</pre></div></li><li class="listitem">Now we need<a id="id354" class="indexterm"/> to add the HTTP Client functions, which can be used to send the <code class="literal">GET</code> and <code class="literal">POST</code> methods. For demonstration purposes, I am keeping the minimum required functions in the file.<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.REST;

import static org.junit.Assert.*;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.ParseException;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpUriRequest;
import org.apache.http.entity.ContentType;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;

import cucumber.api.DataTable;

public class RESTFactory {

  @SuppressWarnings("deprecation")
  HttpClient client = new DefaultHttpClient();
  static HttpResponse httpResponse = null;
  static String responseString = null;
  String getURL = "";

  public void getRequest(String url) throws ClientProtocolException, IOException{
    RequestConfig requestConfig = RequestConfig.custom().setConnectionRequestTimeout(20000).setConnectTimeout(20000).setSocketTimeout(20000).build();
    HttpClientBuilder builder = HttpClientBuilder.create().setDefaultRequestConfig(requestConfig);
    getURL = url;
    HttpUriRequest request = new HttpGet( url );

    httpResponse = builder.build().execute( request );

  }

  public void verifyStatusCode(int statusCode) throws ClientProtocolException, IOException {
    assertEquals(statusCode, httpResponse.getStatusLine().getStatusCode());
  }

  public void verifyResponseType(String type){
    String mimeType = ContentType.getOrDefault(httpResponse.getEntity()).getMimeType();
    assertTrue( mimeType.contains(type) );
  }

  public void verifyResponseData(String responseData) throws ParseException, IOException{
    HttpEntity entity = httpResponse.getEntity();
    responseString = EntityUtils.toString(entity, "UTF-8");

    assertTrue(responseString.contains(responseData));
  }

  public void postRequest(String url, DataTable payloadTable) throws ClientProtocolException, IOException{
    List&lt;List&lt;String&gt;&gt; payload = payloadTable.raw();

    HttpPost post = new HttpPost(url);
    List&lt;NameValuePair&gt; urlParameters = new ArrayList&lt;NameValuePair&gt;(1);

    for (int i=1; i&lt;payload.size();i++){
      urlParameters.add(new BasicNameValuePair(payload.get(i).get(0), payload.get(i).get(1)));
    }

    post.setEntity(new UrlEncodedFormEntity(urlParameters));

    httpResponse = client.execute(post);
  }
}</pre></div><div class="note" title="Note"><h3 class="title"><a id="note24"/>Note</h3><p>Readers are expected to know the basics about REST Services—the different functions such as <code class="literal">GET</code> and <code class="literal">POST</code> methods.</p></div></li><li class="listitem">We don't need any hooks files here because we don't need to invoke any<a id="id355" class="indexterm"/> browsers/apps before or after the test cases. If need be, we can always add the file later.</li><li class="listitem">We don't need the Page Object Model here because there are no UI pages that we need to maintain.</li><li class="listitem">We will have to <a id="id356" class="indexterm"/>update the Step Definition files for the HTTP functions that we have just written. After adding all the functions, the code should look like this:<div class="informalexample"><pre class="programlisting">package com.cucumber.automation.bdt.stepDefinitions;

import java.io.IOException;

import org.apache.http.ParseException;
import org.apache.http.client.ClientProtocolException;

import com.cucumber.automation.REST.RESTFactory;

import cucumber.api.DataTable;
import cucumber.api.java.en.Then;
import cucumber.api.java.en.When;

public class RestServicesSD {

  RESTFactory rt = new RESTFactory();

  @When("^user sends a GET request with \"(.*?)\"$")
  public void user_sends_a_GET_request_with(String url) throws ClientProtocolException, IOException {rt.getRequest(url);
}

  @Then("^status code should be (\\d+)$")
  public void status_code_should_be(int statuscode) throws ClientProtocolException, IOException {
    rt.verifyStatusCode(statuscode);
  }

  @Then("^response type should be \"(.*?)\"$")
  public void response_type_should_be(String type) {
    rt.verifyResponseType(type);
  }

  @Then("^response contains user name \"(.*?)\"$")
  public void response_contains_user_name(String userName) throws ParseException, IOException {
    rt.verifyResponseData(userName);
  }

  @When("^user sends a POST request to \"(.*?)\" with follwoing details$")
  public void user_sends_a_POST_request_to_with_follwoing_details(String url, DataTable payload) throws ClientProtocolException, IOException {
    rt.postRequest(url, payload);
  }
}</pre></div></li><li class="listitem">Our framework is ready and we can run this framework from either Eclipse or the Terminal. Let's run this from the command line using <code class="literal">mvn test</code>. The following is the output:<div class="mediaobject"><img src="../Images/image00187.jpeg" alt="How to do it…"/></div><p style="clear:both; height: 1em;"> </p></li></ol><div style="height:10px; width: 1px"/></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec102"/>How it works…</h2></div></div></div><p>We have integrated Cucumber, HTTP Client, Maven, Java and Page Objects to design our REST Services automation framework. Cucumber is for implementing BDD, so that nontechnical people can also directly contribute to the development—HTTP Client for REST automation, Java as a programming language, and Maven as a build tool.</p></div></div></body></html>