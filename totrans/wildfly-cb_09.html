<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Conquering the CLI"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Conquering the CLI</h1></div></div></div><p>In this chapter, you will learn the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Invoking server stop, start, and reload</li><li class="listitem" style="list-style-type: disc">Invoking server group stop, start, restart, and reload</li><li class="listitem" style="list-style-type: disc">Creating a server group</li><li class="listitem" style="list-style-type: disc">Creating a server</li><li class="listitem" style="list-style-type: disc">Managing an application – deploy, undeploy</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec83"/>Introduction</h1></div></div></div><p>In this chapter, you will learn how to use the CLI to alter the system's state. That is, changing different settings such as deployments and creating new servers. In the previous chapter, we saw how to grab information out of the CLI. The CLI also provides a method to execute the commands outside it, by specifying the WildFly to connect to and the command to execute.</p><p>Furthermore, WildFly provides you with an HTTP API, which can be used to perform actions and to retrieve information (most of these APIs are used to perform system monitoring analysis). In the previous chapter, we were using the CLI to grab information; thus via HTTP we have been using the GET verb of the HTTP protocol. In the following recipes, we will alter the state of the server by using the POST verb, along with the parameters that the WildFly HTTP API needs. The HTTP API only accepts JSON data, so we need to send the data that way.</p><p>We will use methods within both the operational modes— standalone and domain—whenever it makes sense, because with regard to the operational mode, you may have different entry points.</p><p>In this chapter, we will simulate/use remote WildFly instances, just as in the real scenario where you can apply the following recipes to connect to remote servers. It does not make sense to try the recipes in <code class="literal">localhost</code>, without seeing any authentication and authorization issues.</p><p>To simulate a remote server, you can eventually use VirtualBox or Docker, and then install WildFly as described in the first chapter.</p><p>I'm going to use WildFly running on a Linux container using the Docker tool version 1.5. You can obviously use a real remote server— it would be the same; what really counts is the WildFly platform being exposed.</p><p>By the way, the last chapter of this book is all about running WildFly within a Linux container, using Docker. So if you are totally new to Docker (where have you been hiding?), have a look at the last chapter of this book, or grab the excellent Docker book, <span class="emphasis"><em>The Docker Book</em></span>, <span class="emphasis"><em>James Turnbull</em></span> at <a class="ulink" href="http://www.dockerbook.com">http://www.dockerbook.com</a>.</p><p>My Docker <a id="id686" class="indexterm"/>configuration says the following:</p><div class="informalexample"><pre class="programlisting">DOCKER_HOST=tcp://192.168.59.103:2376</pre></div><p>Thus, my remote WildFly instance will be bound to that IP along with the usual WildFly ports, such as <code class="literal">8080</code>, <code class="literal">9990,</code> and <code class="literal">9999</code>. The management user is the same throughout the book with <code class="literal">wildfly</code> as the username and <code class="literal">cookbook.2015</code> as the password.</p></div></div>
<div class="section" title="Invoking server stop, start, and reload"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec84"/>Invoking server stop, start, and reload</h1></div></div></div><p>In this <a id="id687" class="indexterm"/>recipe, we will learn how to stop, start and reload a WildFly instance <a id="id688" class="indexterm"/>by invoking a command to the CLI. You may need to stop a <a id="id689" class="indexterm"/>server manually to correct a misconfiguration or to redeploy an application. Thus, knowing how to stop, start and reload a server is a must.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec227"/>Getting ready</h2></div></div></div><p>Remember, I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec228"/>How to do it…</h2></div></div></div><p>We will walk through the <code class="literal">stop</code>, <code class="literal">start</code>, <code class="literal">restart</code>, and <code class="literal">reload</code> commands separately to better explain their invocation, and eventually, the differences. For example, the <code class="literal">start</code> command only makes sense when running in the domain mode, as starting WildFly in the standalone mode is a manual operation.</p><div class="section" title="Stop"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec40"/>Stop</h3></div></div></div><p>Open a new terminal <a id="id690" class="indexterm"/>window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":shutdown(restart=false)"
{"outcome" =&gt; "success"}</pre></div><p>Obviously, after this command you need to start up WildFly manually. This is because the host-controller process went down along with the WildFly instance, and therefore, you cannot access the management interface to control your instance.</p><p>In case you are running WildFly in the domain mode, you first need to identify the host and the server that you want to stop, and then invoke the stop method, as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server-config=server-one:stop()"
{
    "outcome" =&gt; "success",
    "result" =&gt; "STOPPING"
}</pre></div></div><div class="section" title="Start"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec41"/>Start</h3></div></div></div><p>This command only makes <a id="id691" class="indexterm"/>sense in the domain mode, where you connect to the domain controller. Then you can push commands to the various active host-controllers, which bring WildFly instances up or down, as shown next.</p><p>Open a new terminal window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server-config=server-one:start()"
{
    "outcome" =&gt; "success",
    "result" =&gt; "STARTING"
}</pre></div></div><div class="section" title="Restart"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec42"/>Restart</h3></div></div></div><p>Open a new terminal <a id="id692" class="indexterm"/>window and run the following code:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":shutdown(restart=true)"
{"outcome" =&gt; "success"}</pre></div><p>As you were probably wondering in the preceding <code class="literal">stop</code> section, passing the <code class="literal">restart</code> argument set as <code class="literal">true</code> to the <a id="id693" class="indexterm"/><code class="literal">shutdown</code> method would have probably restarted the WildFly instance and, in fact, it did.</p><p>By the way, there is no counterpart to the domain mode. It would only be applicable for a server group, which is discussed later in this chapter.</p></div><div class="section" title="Reload"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec43"/>Reload</h3></div></div></div><p>Open a new terminal <a id="id694" class="indexterm"/>window and execute the following:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":reload()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined
}</pre></div><p>The <code class="literal">reload</code> method just shuts down all active WildFly services, unbinds resources, and then brings them all up back again, reloading the configuration.</p><p>If you are running WildFly in the domain mode, the purpose of the invocation remains the same— to reload the server configuration; you can do as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh --connect --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=":reload-servers()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec229"/>How it works…</h2></div></div></div><p>Here, we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define in the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec230"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="Curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec44"/>Curl</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a running WildFly instance, open a new terminal window and give the following commands:<div class="informalexample"><pre class="programlisting">$ curl --verbose http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation":"reload"}'</pre></div></li><li class="listitem">You should get the following output:<div class="informalexample"><pre class="programlisting">* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
&gt; POST /management/ HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt; Content-Type: application/json
&gt; Content-Length: 22
&gt;
* upload completely sent off: 22 out of 22 bytes
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="//unXxm6vjoNMTQzNTA1MTg1NDUyNtkzOlQPF6rdPZp9cTcQnhY=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 23 Jun 2015 09:30:44 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
&lt;html&gt;&lt;head&gt;&lt;title&gt;Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;401 - Unauthorized&lt;/body&gt;&lt;/html&gt;</pre></div><p>As you can see, <code class="literal">curl</code> complains about a digest authentication for <code class="literal">ManagementRealm</code>, which is the one used by the WildFly management interfaces.</p></li><li class="listitem">Let's give the username and password to the command, as follows:<div class="informalexample"><pre class="programlisting">$ curl --verbose --digest --user wildfly http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation":"reload"}'</pre></div></li><li class="listitem">You should get the following output:<div class="informalexample"><pre class="programlisting">Enter host password for user 'wildfly':
* Hostname was NOT found in DNS cache
*   Trying 192.168.59.103...
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; POST /management/ HTTP/1.1
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt; Content-Type: application/json
&gt; Content-Length: 0
&gt;
&lt; HTTP/1.1 401 Unauthorized
&lt; Connection: keep-alive
&lt; WWW-Authenticate: Digest realm="ManagementRealm",domain="/management",nonce="urmPLpGMJgkNMTQzNTA1MjEwMTI4NJYIEw20Br2YWefE0GbBBk8=",opaque="00000000000000000000000000000000",algorithm=MD5
&lt; Content-Length: 77
&lt; Content-Type: text/html
&lt; Date: Tue, 23 Jun 2015 09:30:44 GMT
&lt;
* Ignoring the response-body
* Connection #0 to host 192.168.59.103 left intact
* Issue another request to this URL: 'http://192.168.59.103:9990/management/'
* Found bundle for host 192.168.59.103: 0x7fc1104149d0
* Re-using existing connection! (#0) with host 192.168.59.103
* Connected to 192.168.59.103 (192.168.59.103) port 9990 (#0)
* Server auth using Digest with user 'wildfly'
&gt; POST /management/ HTTP/1.1
&gt; Authorization: Digest username="wildfly", realm="ManagementRealm", nonce="urmPLpGMJgkNMTQzNTA1MjEwMTI4NJYIEw20Br2YWefE0GbBBk8=", uri="/management/", response="0bbe505bc1af3907ff3a8ca960387829", opaque="00000000000000000000000000000000", algorithm="MD5"
&gt; User-Agent: curl/7.37.1
&gt; Host: 192.168.59.103:9990
&gt; Accept: */*
&gt; Content-Type: application/json
&gt; Content-Length: 22
&gt;
* upload completely sent off: 22 out of 22 bytes
&lt; HTTP/1.1 200 OK
&lt; Connection: keep-alive
&lt; Authentication-Info: nextnonce="oIOIlHtymVgNMTQzNTA1MjEwMTI4OZI07WcGItS8EhmrBTUgrCU="
&lt; Content-Type: application/json; charset=utf-8
&lt; Content-Length: 40
&lt; Date: Tue, 23 Jun 2015 09:30:44 GMT
&lt;
* Connection #0 to host 192.168.59.103 left intact
{"outcome" : "success", "result" : null}</pre></div></li><li class="listitem">Okay, it works; now remove the <code class="literal">--verbose</code> flag and execute the command again. You should get just the JSON output, after entering the password, as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation":"reload"}'
{"outcome" : "success", "result" : null}
$</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note32"/>Note</h3><p>I chose the <code class="literal">reload</code> method just to show you how to do it using the HTTP API.</p></div></div></li></ol></div></div></div></div>
<div class="section" title="Invoking server group stop, start, restart, and reload"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec85"/>Invoking server group stop, start, restart, and reload</h1></div></div></div><p>In this recipe, we <a id="id695" class="indexterm"/>will learn how to stop, start, restart, and reload a WildFly <a id="id696" class="indexterm"/>server group, by invoking a command to the CLI. As <a id="id697" class="indexterm"/>you should know by now, you can stop, start, restart, and reload a single server belonging to a server group. We will see all these <a id="id698" class="indexterm"/>commands using the CLI.</p><p>As we are talking about a server group, this recipe only makes sense with WildFly running in the domain mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec231"/>Getting ready</h2></div></div></div><p>Remember, I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec232"/>How to do it…</h2></div></div></div><p>We will walk through the <code class="literal">stop</code>, <code class="literal">start</code>, <code class="literal">restart,</code> and <code class="literal">reload</code> commands separately to better explain their invocation and eventual differences.</p><div class="section" title="Stop"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec45"/>Stop</h3></div></div></div><p>Open a new terminal <a id="id699" class="indexterm"/>window and execute the following code:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=main-server-group:stop-servers()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div><div class="section" title="Start"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec46"/>Start</h3></div></div></div><p>Open a new terminal <a id="id700" class="indexterm"/>window and run the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=main-server-group:start-servers()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div><div class="section" title="Restart"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec47"/>Restart</h3></div></div></div><p>Open a new terminal <a id="id701" class="indexterm"/>window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=main-server-group:restart-servers()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div><div class="section" title="Reload"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec48"/>Reload</h3></div></div></div><p>Open a new terminal <a id="id702" class="indexterm"/>window and run the following code:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=main-server-group:reload-servers()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec233"/>How it works…</h2></div></div></div><p>Here, we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define in the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /server-group=main-server-group:stop-servers()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}
[standalone@192.168.59.103:9990 /]</pre></div><p>The same applies for the other methods: <code class="literal">start-servers()</code>, <code class="literal">restart-servers()</code>, and <code class="literal">reload-servers()</code>.</p></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec234"/>There's more…</h2></div></div></div><p>WildFly provides one more <a id="id703" class="indexterm"/>API, which is the HTTP API. Let's try it with some network command-line tools such as <code class="literal">curl</code>.</p><div class="section" title="Curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec49"/>Curl</h3></div></div></div><p>With a running WildFly instance, open a new terminal window and execute the following code:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation":"restart-servers","address":[{"server-group":"main-server-group"}]}'
{"outcome" : "success", "result" : null, "server-groups" : null}</pre></div><p>That's it!</p></div></div></div>
<div class="section" title="Creating a server group"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec86"/>Creating a server group</h1></div></div></div><p>In this recipe, you <a id="id704" class="indexterm"/>will learn how to create a server group, by invoking a command to the CLI. This applies only within the domain mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec235"/>Getting ready</h2></div></div></div><p>Remember, I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec236"/>How to do it…</h2></div></div></div><p>Open a new terminal window and run the following code:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=next-server-group:add(profile=ha,socket-binding-group=ha-sockets)"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note33"/>Note</h3><p>The server group is ready to use without requiring any reload or restart. This means that it can be used to add servers to it. For the moment, it is just an empty server group. Later in this chapter, we will see how to add a server to a server group, using the CLI.</p></div></div><p>In case you need to remove the server group, just use the <code class="literal">remove</code> method on it, as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/server-group=next-server-group:remove()"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec237"/>How it works…</h2></div></div></div><p>Here, we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> <a id="id705" class="indexterm"/>parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[domain@192.168.59.103:9990 /] /server-group=next-server-group:add(profile=ha,socket-binding-group=ha-sockets)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}
[domain@192.168.59.103:9990 /]</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec238"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tool, such as <code class="literal">curl</code>.</p><p>With a running WildFly <a id="id706" class="indexterm"/>instance, open a new terminal window and run the following code:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation" : "composite", "address" : [], "steps" : [{"operation" : "add", "address" : {"server-group" : "next-server-group"}, "profile" : "ha", "socket-binding-group" : "ha-sockets"}]}'
{"outcome" : "success", "result" : {"step-1" : {"outcome" : "success"}}, "server-groups" : null}</pre></div></div></div>
<div class="section" title="Creating a server"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec87"/>Creating a server</h1></div></div></div><p>In this recipe, we <a id="id707" class="indexterm"/>will learn how to create a server by invoking a command to the CLI. This applies only to the domain mode.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec239"/>Getting ready</h2></div></div></div><p>Remember, I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec240"/>How to do it…</h2></div></div></div><p>Open a new terminal window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server-config=server-four:add(group=main-server-group, auto-start=true, socket-binding-port-offset=450)"
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div><p>Now the server is ready, you just need to start it manually. This can be achieved by starting the servers of the server group that your new server belongs to, in this case, <code class="literal">main-server-group</code>. Run the following code:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command=/server-group=main-server-group:start-servers()
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}</pre></div><p>The preceding command just starts the servers in the <code class="literal">STOPPED</code> state.</p></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec241"/>How it works…</h2></div></div></div><p>Here, we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><p>Using the CLI, it would be as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] /host=master/server-config=server-four:add(group=main-server-group, auto-start=true, socket-binding-port-offset=450)
{
    "outcome" =&gt; "success",
    "result" =&gt; undefined,
    "server-groups" =&gt; undefined
}
[standalone@192.168.59.103:9990 /]</pre></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec242"/>There's more…</h2></div></div></div><p>WildFly provides <a id="id708" class="indexterm"/>one more API, which is the HTTP API. Let's try it with some network command-line tools, such as <code class="literal">curl</code>.</p><div class="section" title="Curl"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec50"/>Curl</h3></div></div></div><p>With a running WildFly <a id="id709" class="indexterm"/>instance, open a new terminal window and execute the following commands:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"operation" : "composite", "address" : [], "steps" : [{"operation" : "add", "address" : [{"host" : "master"},{"server-config" : "server-four"}], "group" : "main-server-group", "auto-start" : "true", "socket-binding-port-offset" : "450"}]}'
{"outcome" : "success", "result" : {"step-1" : {"outcome" : "success"}}, "server-groups" : null}</pre></div></div></div></div>
<div class="section" title="Managing an application &#x2013; deploy, undeploy"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Managing an application – deploy, undeploy</h1></div></div></div><p>In this recipe, we <a id="id710" class="indexterm"/>will learn how to deploy and undeploy an application, and to check its status, on a running WildFly instance, by invoking a command to the CLI.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec243"/>Getting ready</h2></div></div></div><p>Remember, I'm running WildFly remotely, bound to <code class="literal">192.168.59.103</code> as IP. WildFly is already up and running.</p><p>For this recipe, we will need the application named <code class="literal">example</code>, which you can find in my GitHub repository. If you skipped the <span class="emphasis"><em>Managing applications using the deployments folder</em></span> recipe of <a class="link" href="ch02.html" title="Chapter 2. Running WildFly in Standalone Mode">Chapter 2</a>, <span class="emphasis"><em>Running WildFly in Standalone Mode</em></span>, please refer to it to download all the source code and projects that you will need.</p><p>To build the application, give the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd ~/WFC/github/wildfly-cookbook
$ cd example
$ mvn -e clean package</pre></div><p>Once done, copy the artifact <code class="literal">example.war</code> into your local <code class="literal">$WILDFLY_HOME</code> folder.</p></div><div class="section" title="How to do it…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec244"/>How to do it…</h2></div></div></div><p>We will walk through the <code class="literal">deploy</code>, <code class="literal">status</code>, and <code class="literal">undeploy</code> commands separately to better explain their differences when dealing with the standalone and domain modes.</p><div class="section" title="Deploy"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec51"/>Deploy</h3></div></div></div><p>Open a new terminal <a id="id711" class="indexterm"/>window and run the following commands:</p><div class="informalexample"><pre class="programlisting">$ cd $WILDFLY_HOME
$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="deploy example.war"</pre></div><p>In case you are running WildFly in the domain mode, the invocation is as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="deploy example.war --server-groups=main-server-group"</pre></div></div><div class="section" title="Status"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec52"/>Status</h3></div></div></div><p>If you need to <a id="id712" class="indexterm"/>check the deployment, you can execute the following code:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/deployment=example.war:read-attribute(name=status)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "OK"
}</pre></div><p>If you are running WildFly in the domain mode, we first need to know the server group that the application belongs to. We can do that by issuing the following command:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="deployment-info --name=example.war"
NAME        RUNTIME-NAME
example.war example.war

SERVER-GROUP       STATE
main-server-group  enabled
other-server-group not added</pre></div><p>If you already know the server group, you can check the deployment status directly to check the server it belongs to by invoking the following command:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="/host=master/server=server-one/deployment=example.war:read-attribute(name=status)"
{
    "outcome" =&gt; "success",
    "result" =&gt; "OK"
}</pre></div></div><div class="section" title="Undeploy"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec53"/>Undeploy</h3></div></div></div><p>In case you need to undeploy <a id="id713" class="indexterm"/>your application, just hit the following command:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="undeploy example.war"</pre></div><p>In case you are running WildFly in the domain mode, the invocation is as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh -c --controller=192.168.59.103:9990 --user=wildfly --password=cookbook.2015 --command="undeploy example.war --all-relevant-server-groups"</pre></div><p>That's it!</p></div></div><div class="section" title="How it works…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec245"/>How it works…</h2></div></div></div><p>Here, we are telling the <code class="literal">jboss-cli.sh</code> script to execute the command that we define within the <code class="literal">--command</code> parameter, and to return the result in the standard output.</p><div class="section" title="Deploy"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec54"/>Deploy</h3></div></div></div><p>Use the <a id="id714" class="indexterm"/>CLI as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] deploy example.war
[standalone@192.168.59.103:9990 /]</pre></div><p>Within the domain mode, you will have the following command:</p><div class="informalexample"><pre class="programlisting">[domain@192.168.59.103:9990 /] deploy example.war --server-groups=main-server-group
[domain@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div><div class="section" title="Status"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec55"/>Status</h3></div></div></div><p>Use the <a id="id715" class="indexterm"/>CLI as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] deployment-info example.war
{
    "outcome" =&gt; "success",
    "result" =&gt; "OK"
}
[standalone@192.168.59.103:9990 /]
Within the domain mode, you will have the following command:
[domain@192.168.59.103:9990 /] /host=master/server=server-one/deployment=example.war:read-attribute(name=status)
{
    "outcome" =&gt; "success",
    "result" =&gt; "OK"
}
[domain@192.168.59.103:9990 /]</pre></div></div><div class="section" title="Undeploy"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec56"/>Undeploy</h3></div></div></div><p>Use the <a id="id716" class="indexterm"/>CLI as follows:</p><div class="informalexample"><pre class="programlisting">$ ./bin/jboss-cli.sh
You are disconnected at the moment. Type 'connect' to connect to the server or 'help' for the list of supported commands.
[disconnected /] connect 192.168.59.103:9990
Authenticating against security realm: ManagementRealm
Username: wildfly
Password:
[standalone@192.168.59.103:9990 /] undeploy example.war
[standalone@192.168.59.103:9990 /]</pre></div><p>Within the domain mode, give the following command:</p><div class="informalexample"><pre class="programlisting">[domain@192.168.59.103:9990 /] undeploy example.war --all-relevant-server-groups
[domain@192.168.59.103:9990 /]</pre></div><p>By the way, you cannot manipulate the output.</p></div></div><div class="section" title="There's more…"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec246"/>There's more…</h2></div></div></div><p>WildFly provides one more API, which is the HTTP API. Let's try it with some network command-line tools, such as <code class="literal">curl</code>.</p><div class="section" title="Curl deployment"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec57"/>Curl deployment</h3></div></div></div><p>Let's deploy using <code class="literal">curl</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">With a <a id="id717" class="indexterm"/>running WildFly instance, open a new terminal window and execute the following command:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 -F "file=@example.war" http://192.168.59.103:9990/management/add-content

{"outcome" : "success", "result" : { "BYTES_VALUE" : "eqfGfLVOCv+p1gz5gjDgwX79ERk=" }}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note34"/>Note</h3><p>The file <code class="literal">example.war</code> should be placed in the same folder from which you are invoking the command.</p></div></div></li><li class="listitem">Okay, it works. But we just uploaded our file, we haven't deployed it yet. To deploy it, we need to grab the hash code that resulted from the <code class="literal">upload</code> command, and use it in the next one as follows:<div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management -X POST -H "Content-Type: application/json" -d '{"content":[{"hash": {"BYTES_VALUE" : "eqfGfLVOCv+p1gz5gjDgwX79ERk="}}], "address": [{"deployment":"example.war"}], "operation":"add", "enabled":"true"}'

{"outcome" : "success"}</pre></div><p>There you go! We have successfully deployed our interstellar web application.</p></li><li class="listitem">If you are running WildFly in the domain mode, the upload method is the same; thus, for effectively deploying the application, you can hit the following command:<div class="informalexample"><pre class="programlisting">$ curl  --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management -X POST -H "Content-Type: application/json" -d '{"content":[{"hash": {"BYTES_VALUE" : "eqfGfLVOCv+p1gz5gjDgwX79ERk="}}], "address": [{"deployment":"example.war"}], "server-groups":"main-server-group", "runtime-name":"example.war", "operation":"add", "enabled":"true"}'
{"outcome" : "success", "result" : null, "server-groups" : null}</pre></div></li></ol></div><p>That's it!</p></div><div class="section" title="Status"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec58"/>Status</h3></div></div></div><p>To check the status <a id="id718" class="indexterm"/>of your deployment, execute the following command:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management -X POST -H "Content-Type: application/json" -d '{"address": [{"deployment":"example.war"}],"operation":"read-attribute","name":"status"}'
{"outcome" : "success", "result" : "OK"}</pre></div><p>If you are running WildFly in the domain mode, you can run the following code:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management -X POST -H "Content-Type: application/json" -d '{"operation" : "read-resource", "address" : [{"deployment":"example.war"}], "json.pretty":1}'
{
    "outcome" : "success",
    "result" : {
        "content" : [{"hash" : {
            "BYTES_VALUE" : "eqfGfLVOCv+p1gz5gjDgwX79ERk="
        }}],
        "name" : "example.war",
        "runtime-name" : "example.war"
    }
}</pre></div><p>And that's all.</p></div><div class="section" title="Curl undeployment"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl3sec59"/>Curl undeployment</h3></div></div></div><p>Let's <a id="id719" class="indexterm"/>undeploy using <code class="literal">curl</code>:</p><div class="informalexample"><pre class="programlisting">$ curl --digest --user wildfly:cookbook.2015 http://192.168.59.103:9990/management/ -X POST -H "Content-Type: application/json" -d '{"address" : [{"deployment":"example.war"}],"operation":"undeploy"}'
{"outcome" : "success"}</pre></div><p>That's it!</p></div></div></div></body></html>