<html><head></head><body><div class="chapter" title="Chapter&#xA0;2.&#xA0;Mastering the MVC Architecture"><div class="titlepage"><div><div><h1 class="title"><a id="ch02"/>Chapter 2. Mastering the MVC Architecture</h1></div></div></div><p>In this chapter, we will discuss the MVC architecture principles and see how Spring MVC implements those.</p><p>We will continue to use the application from the previous chapter and build something more interesting. Our goal is to design a simple page where users can search for tweets corresponding to certain criteria and display them to our users.</p><p>To achieve this, we <a id="id79" class="indexterm"/>will use the Spring Social Twitter project, which is available at <a class="ulink" href="http://projects.spring.io/spring-social-twitter/">http://projects.spring.io/spring-social-twitter/</a>.</p><p>We will see how to make Spring MVC work with a modern template engine, Thymeleaf, and try to understand the inner mechanics of the framework. We will route our users through different views, and finally, we will give a stellar look to our application using WebJars and <a id="id80" class="indexterm"/>Materialize (<a class="ulink" href="http://materializecss.com">http://materializecss.com</a>).</p><div class="section" title="The MVC architecture"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec16"/>The MVC architecture</h1></div></div></div><p>I expect the <a id="id81" class="indexterm"/>meaning of the MVC acronym to be familiar to most. It stands for Model View Controller, and it is considered to be a very popular way to build a user interface by decoupling the data and the presentation layers.</p><div class="mediaobject"><img src="graphics/2117_02_01.jpg" alt="The MVC architecture"/></div><p>The MVC pattern<a id="id82" class="indexterm"/> became wildly popular after emerging from the world of Smalltalk and landing in the Ruby on Rails framework.</p><p>The architectural pattern features three layers:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The Model</strong></span>: This <a id="id83" class="indexterm"/>consists of various representations of the data your application knows about.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The View</strong></span>: This is<a id="id84" class="indexterm"/> made up of several representations of the data that will be displayed to your users.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>The Controller</strong></span>: This is<a id="id85" class="indexterm"/> the part of the application that will handle user interactions. It's a bridge between the model and the view.</li></ul></div><p>The idea behind MVC is to decouple the View from the Model. The model must be self-contained and ignorant of the UI. This basically allows the same data to be reused across multiple views. These views are different way to look at the data. Drill down or using different renderers (HTML, PDF) are good illustrations of this principle.</p><p>The Controller acts as a mediator between the user and the data. Its role is to control actions available to<a id="id86" class="indexterm"/> the end user, as well as routing through the different views of the application.</p></div></div>
<div class="section" title="MVC critics and best practices"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec17"/>MVC critics and best practices</h1></div></div></div><p>While MVC remains the<a id="id87" class="indexterm"/> go-to approach for designing a UI, many<a id="id88" class="indexterm"/> criticisms arose with its prevalence. Most critics are actually pointing a finger at the incorrect use of the pattern.</p><div class="section" title="Anemic Domain Model"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec15"/>Anemic Domain Model</h2></div></div></div><p>Eric Evans' influential book <span class="emphasis"><em>Domain Driven Design</em></span>, also abbreviated as <span class="strong"><strong>DDD</strong></span>, defines a set of architecture<a id="id89" class="indexterm"/> rules leading to a better integration of the business domain inside the code.</p><p>One of the core ideas is to take advantage of the object-oriented paradigms inside the domain objects. Going against this principle is sometimes referred to as <span class="strong"><strong>Anemic Domain Model</strong></span>. A good<a id="id90" class="indexterm"/> definition of this problem can be found on<a id="id91" class="indexterm"/> Martin Fowler's blog (<a class="ulink" href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">http://www.martinfowler.com/bliki/AnemicDomainModel.html</a>).</p><p>An Anemic Model typically exhibits the following symptoms:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The model is <a id="id92" class="indexterm"/>constituted from very simple <span class="strong"><strong>plain old Java objects</strong></span> (<span class="strong"><strong>POJO</strong></span>s) with only getters and setters</li><li class="listitem" style="list-style-type: disc">All the<a id="id93" class="indexterm"/> business logic is handled inside a service layer</li><li class="listitem" style="list-style-type: disc">Validation of the model is found outside this model, for instance, in controllers</li></ul></div><p>This can be a bad practice depending on the complexity of your business domain. Generally speaking, DDD practices require additional efforts to isolate the domain from the application logic.</p><p>Architecture is always a tradeoff. It is good to note that typical ways of designing a Spring application can lead to complicated maintenance somewhere along the road.</p><p>How to avoid domain anemia is explained here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The Service layer is good for application-level abstraction like transaction handling, not business logic.</li><li class="listitem" style="list-style-type: disc">Your domain should always be in a valid state. Leave validation inside the form objects using validators or JSR-303's validation annotations.</li><li class="listitem" style="list-style-type: disc">translate the inputs into meaningful domain objects.</li><li class="listitem" style="list-style-type: disc">Think of your data layer in term of repositories with domain queries (refer to Spring Data Specification, for example)</li><li class="listitem" style="list-style-type: disc">Decouple your domain logic from the underlying persistence framework</li><li class="listitem" style="list-style-type: disc">Use real objects as much as possible. For instance, manipulate the <code class="literal">FirstName</code> class rather than a string.</li></ul></div><p>There is much more<a id="id94" class="indexterm"/> to DDD than these simple rules: Entities, value<a id="id95" class="indexterm"/> types, Ubiquitous Language, Bounded Context, Onion Architecture, and anti corruption layers. I strongly encourage you to study these principles on your own. As far as we are concerned, with this book we will try to keep in mind the guidelines listed earlier as we craft our web application. These concerns will become more familiar to you as we advance through this book.</p></div><div class="section" title="Learning from the sources"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec16"/>Learning from the sources</h2></div></div></div><p>If you're familiar with Spring, you have probably already landed on Spring's website, <a class="ulink" href="http://spring.io">http://spring.io</a>. It is entirely made with Spring and the good news is that it is open source.</p><p>The code name<a id="id96" class="indexterm"/> of the project is sagan. It has numerous interesting features:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">A gradle multimodule project</li><li class="listitem" style="list-style-type: disc">Security integration</li><li class="listitem" style="list-style-type: disc">Github integration</li><li class="listitem" style="list-style-type: disc">Elasticsearch integration</li><li class="listitem" style="list-style-type: disc">A JavaScript frontend application</li></ul></div><p>The GitHub wiki associated with the project is really detailed and will help you get started easily with the project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note04"/>Note</h3><p>Visit the<a id="id97" class="indexterm"/> following URL if you're interested in the Spring's architecture of a real world application:</p><p>
<a class="ulink" href="https://github.com/spring-io/sagan">https://github.com/spring-io/sagan</a>
</p></div></div></div></div>
<div class="section" title="Spring MVC 1-0-1"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec18"/>Spring MVC 1-0-1</h1></div></div></div><p>In spring MVC, the model<a id="id98" class="indexterm"/> is a simple map encapsulated in the <code class="literal">Model</code> or <code class="literal">ModelAndView</code> classes of Spring MVC. It can come from a database, files, external services, and so on. It is up to you to define how to fetch the data and put it into the model. The recommended way of interacting with the data layer is through Spring Data libraries: Spring Data JPA, Spring Data MongoDB, and so on. There are a dozen projects<a id="id99" class="indexterm"/> related to Spring Data and I encourage you to take a look at <a class="ulink" href="http://projects.spring.io/spring-data">http://projects.spring.io/spring-data</a>.</p><p>The controller side of Spring MVC is handled through the use of the <code class="literal">@Controller</code> annotation. In a web application, the controller's role is to respond to HTTP requests. Classes annotated with the <code class="literal">@Controller</code> annotation will be picked up by Spring and given a chance to handle upcoming requests.</p><p>Via the <code class="literal">@RequestMapping</code> annotation, Controllers declare handling specific requests based on their HTTP method (<code class="literal">GET</code> or <code class="literal">POST</code> methods, for instance) and their URLs. The Controller then decides to either write content directly in the web response or route the application to a view and inject properties into that view.</p><p>A pure<a id="id100" class="indexterm"/> RESTful application would choose the first approach and expose a JSON or XML representation of the model directly in the HTTP response with the <code class="literal">@ResponseBody</code> annotation. In the case of a web application, this type of architecture is often associated with a frontend JavaScript framework such as Backbone.js, AngularJS, or React. In this case, the Spring application would then only handle the Model layer of the MVC model. We will study this kind of architecture in <a class="link" href="ch04.html" title="Chapter 4. File Upload and Error Handling">Chapter 4</a>, <span class="emphasis"><em>File Upload and Error Handling</em></span>.</p><p>With the second approach, the Model is passed to the View, which is rendered by a templating engine and then written to the response.</p><p>The view is often associated with a templating dialect, which will allow navigation inside the model. Popular dialects for templating are JSPs, FreeMarker, or Thymeleaf.</p><p>Hybrid approaches may take advantage of the templating engine to interact with some aspects of the application and then delegate the view layer to a frontend framework.</p></div>
<div class="section" title="Using Thymeleaf"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>Using Thymeleaf</h1></div></div></div><p>Thymeleaf is <a id="id101" class="indexterm"/>a templating engine that gets particular attention from the Spring community.</p><p>Its success is due <a id="id102" class="indexterm"/>mostly to its friendly syntax (it almost looks like HTML) and the ease with which it can be extended.</p><p>Various extensions are available and integrated with Spring Boot:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Support</p>
</th><th style="text-align: left" valign="bottom">
<p>Dependency</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Layouts</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">nz.net.ultraq.thymeleaf:thymeleaf-layout-dialect</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>HTML5 data-* attributes</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">com.github.mxab.thymeleaf.extras:thymeleaf-extras-data-attribute</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Internet Explorer conditional comments</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.thymeleaf.extras:thymeleaf-extras-conditionalcomments</code>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Support for spring security</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.thymeleaf.extras:thymeleaf-extras-springsecurity3</code>
</p>
</td></tr></tbody></table></div><p>A very good tutorial on<a id="id103" class="indexterm"/> Thymeleaf's integration with Spring can be found at <a class="ulink" href="http://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html">http://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html</a>.</p><p>Without <a id="id104" class="indexterm"/>further ado, let's add the <code class="literal">spring-boot-starter-thymeleaf</code> dependency to bootstrap the thymeleaf templating engine:</p><div class="informalexample"><pre class="programlisting">buildscript {
    ext {
        springBootVersion = '1.2.5.RELEASE'
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}") 
        classpath("io.spring.gradle:dependency-management-plugin:0.5.1.RELEASE")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'spring-boot' 
apply plugin: 'io.spring.dependency-management' 

jar {
    baseName = 'masterSpringMvc'
    version = '0.0.1-SNAPSHOT'
}
sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}


dependencies {
    compile 'org.springframework.boot:spring-boot-starter-web'
    <span class="strong"><strong>compile 'org.springframework.boot:spring-boot-starter-thymeleaf'</strong></span>
    testCompile 'org.springframework.boot:spring-boot-starter-test'
}

eclipse {
    classpath {
         containers.remove('org.eclipse.jdt.launching.JRE_CONTAINER')
         containers 'org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.8'
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.3'
}</pre></div><div class="section" title="Our first page"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Our first page</h2></div></div></div><p>We will <a id="id105" class="indexterm"/>now add the first page to our application. It will be located in <code class="literal">src/main/resources/templates</code>. Let's call the file <code class="literal">resultPage.html</code>:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html &gt;
&lt;head lang="en"&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;title&gt;Hello thymeleaf&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;span th:text="|Hello thymeleaf|"&gt;Hello html&lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>We can see from the very start that Thymeleaf integrates perfectly with html and its syntax almost feels natural.</p><p>The <code class="literal">th:text</code> value is put between pipes. It means that all the values inside the text will be concatenated.</p><p>It might seem a bit awkward at first, but in practice, text will rarely be hardcoded in our pages; so, Thymeleaf makes an opinionated design decision here.</p><p>Thymeleaf has a big advantage for web designers: everything that is dynamic inside the templates can fall back to a default value in the case where they are opened without the server running. Resource URLs can be specified relatively and every markup can contain placeholders. In our previous example, the text "Hello html" would not be displayed when the view is rendered in the context of our application, but it will if the file is opened directly with a<a id="id106" class="indexterm"/> web browser.</p><p>To speed up development, add this property to your <code class="literal">application.properties</code> file:</p><div class="informalexample"><pre class="programlisting">spring.thymeleaf.cache=false</pre></div><p>This will disable the view cache and cause templates to reload every time they are accessed.</p><p>Of course, this setting will need to be disabled when we go into production. We will see that in <a class="link" href="ch08.html" title="Chapter 8. Optimizing Your Requests">Chapter 8</a>, <span class="emphasis"><em>Optimizing Your Requests</em></span>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip10"/>Tip</h3><p>
<span class="strong"><strong>Reloading the views</strong></span>
</p><p>With the cache disabled, simply save your view with eclipse or use the <code class="literal">Build &gt; Make Project</code> action in IntelliJ to refresh the views after a change.</p></div></div><p>Lastly, we will need to modify our <code class="literal">HelloController</code> class. Instead of displaying plain text, it must now route to our freshly created view. To accomplish this, we will remove the <code class="literal">@ResponseBody</code> annotation. Doing so and still returning a string will tell Spring MVC to map this string to a view name instead of displaying a particular model directly in the response.</p><p>Here is what our controller now looks like:</p><div class="informalexample"><pre class="programlisting">@Controller
public class HelloController {

    @RequestMapping("/")
    public String hello() {
        return "resultPage";
    }
}</pre></div><p>In this example, the controller will redirect the user to the view name <code class="literal">resultPage</code>. The <code class="literal">ViewResolver</code> interface will then associate this name with our page.</p><p>Let's launch our application again and go to <code class="literal">http://localhost:8080</code>.</p><p>You will see the following page:</p><div class="mediaobject"><img src="graphics/2117_02_02.jpg" alt="Our first page"/></div></div></div>
<div class="section" title="Spring MVC architecture"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec20"/>Spring MVC architecture</h1></div></div></div><p>Let's take a step back<a id="id107" class="indexterm"/> from this spectacular new "Hello World" and try to understand what happened inside our web application. To do this, we will retrace the journey <a id="id108" class="indexterm"/>of the HTTP request our browser sent and the response it got from the server.</p><div class="section" title="DispatcherServlet"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>DispatcherServlet</h2></div></div></div><p>The entry <a id="id109" class="indexterm"/>point of every Spring web application is the <code class="literal">DispatcherServlet</code>. The<a id="id110" class="indexterm"/> following figure illustrates the Dispatcher Servlet architecture:</p><div class="mediaobject"><img src="graphics/2117_02_03.jpg" alt="DispatcherServlet"/></div><p>This is a classical <code class="literal">HttpServlet</code> class that dispatches HTTP requests to HandlerMapping. A <span class="strong"><strong>HandlerMapping</strong></span><a id="id111" class="indexterm"/> is an association of resources (URLs) and Controllers.</p><p>The appropriate methods—those annotated with <code class="literal">@RequestMapping</code> annotation—are then called on the <a id="id112" class="indexterm"/>Controller. In this method, the controller sets the<a id="id113" class="indexterm"/> model data and returns the view name to the dispatcher.</p><p>The <code class="literal">DispatcherServlet</code> will then interrogate the <code class="literal">ViewResolver</code> interface to find the corresponding implementation of the view.</p><p>In our case, the <code class="literal">ThymeleafAutoConfiguration</code> class has set up the view resolver for us.</p><p>You can see in the <code class="literal">ThymeleafProperties</code> class that the default prefix for our views is <code class="literal">classpath:/templates/</code> the default suffix is <code class="literal">.html</code>.</p><p>This means that, given the view name <code class="literal">resultPage</code>, the view resolver will look in the templates directory of our classpath, looking for a file called <code class="literal">resultPage.html</code>.</p><p>In our application our <code class="literal">ViewResolver</code> interface is static, but more advanced implementation can return different results given the request headers or the user's locale.</p><p>The view will<a id="id114" class="indexterm"/> finally be rendered and the result written to the <a id="id115" class="indexterm"/>response.</p></div><div class="section" title="Passing data to the view"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Passing data to the view</h2></div></div></div><p>Our first page is completely static; it does not really take advantage of the power of Spring MVC. Let's spice things up a little bit. What if the "Hello World" string, instead of being<a id="id116" class="indexterm"/> hardcoded, came from the server?</p><p>It would still be a lame "hello world" you say? Yes, but it will open up many more possibilities. Let's change our <code class="literal">resultPage.html</code> file to display a message coming from the model:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html &gt;
&lt;head lang="en"&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;title&gt;Hello thymeleaf&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;span th:text="${message}"&gt;Hello html&lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>Then, let's modify our controller so it puts this message inside this model:</p><div class="informalexample"><pre class="programlisting">@Controller
public class HelloController {

    @RequestMapping("/")
    public String hello(Model model) {
        model.addAttribute("message", "Hello from the controller");
        return "resultPage";
    }
}</pre></div><p>I know, the suspense is killing you! Let's see what <code class="literal">http://localhost:8080</code> looks like.</p><div class="mediaobject"><img src="graphics/2117_02_04.jpg" alt="Passing data to the view"/></div><p>The first<a id="id117" class="indexterm"/> thing to note is that we passed a new argument to the controller's method and that the <code class="literal">DispatcherServlet</code> provided the correct object for us. There are, in fact, many objects that can be injected into the controller's methods such as <code class="literal">HttpRequest</code> or <code class="literal">HttpResponse</code>, the <code class="literal">Locale</code>, the <code class="literal">TimeZone</code>, and the <code class="literal">Principal</code>, which represent an authenticated user. The full list of such objects is available in the documentation, which can be found at <a class="ulink" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-arguments">http://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-arguments</a>.</p></div></div>
<div class="section" title="Spring Expression Language"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec21"/>Spring Expression Language</h1></div></div></div><p>When using the <code class="literal">${}</code> syntax, you are in fact using <span class="strong"><strong>Spring Expression Language</strong></span> (<span class="strong"><strong>SpEL</strong></span>). There are <a id="id118" class="indexterm"/>several variants of EL available in the wild; SpEl is one of the most powerful variants.</p><p>Here is an overview of its main features:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Feature</p>
</th><th style="text-align: left" valign="bottom">
<p>Syntax</p>
</th><th style="text-align: left" valign="bottom">
<p>Explanation</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Accessing a list element</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">list[0]</code>
</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Accessing a map entry</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">map[key]</code>
</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Ternary operator</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">condition ? 'yes' : 'no'</code>
</p>
</td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Elvis operator</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">person ?: default</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Returns <code class="literal">default</code> if person's value is null</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Safe navigation</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">person?.name</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Returns <code class="literal">null</code> if person or her name is null</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Templating</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">'Your name is #{person.name}'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Injects values into a string</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Projections</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">${persons.![name]}</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Extracts the names of all the persons and puts them into a list</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Selection</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">persons.?[name == 'Bob']'</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Retrieves the person whose name is Bob inside a list</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Function call</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">person.sayHello()</code>
</p>
</td><td style="text-align: left" valign="top"> </td></tr></tbody></table></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>For complete<a id="id119" class="indexterm"/> reference, check the manual at <a class="ulink" href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html">http://docs.spring.io/spring/docs/current/spring-framework-reference/html/expressions.html</a>.</p></div></div><p>The SpEl usage is<a id="id120" class="indexterm"/> not limited to views. You can also use it in various places inside the Spring framework, for instance, when injecting properties inside beans with the <code class="literal">@Value</code> annotation.</p><div class="section" title="Getting data with a request parameter"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec20"/>Getting data with a request parameter</h2></div></div></div><p>We are able to display data coming from the server inside the view. However, what if we wanted to <a id="id121" class="indexterm"/>get input from the user? With the HTTP protocol, there are multiple ways to do this. The simplest way is to pass a query parameter to our URL.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>
<span class="strong"><strong>Query parameters</strong></span>
</p><p>You certainly know <a id="id122" class="indexterm"/>query parameters. They are found after the <code class="literal">?</code> character in a URL. They consist of a list of name and values separated by the &amp; symbol (Ampersand), for example, <code class="literal">page?var1=value1&amp;var2=value2</code>.</p></div></div><p>We can leverage this technique to ask our user for their name. Let's modify our <code class="literal">HelloController</code> class again:</p><div class="informalexample"><pre class="programlisting">@Controller
public class HelloController {

    @RequestMapping("/")
    public String hello(@RequestParam("name") String userName, Model model) {
        model.addAttribute("message", "Hello, " + userName);
        return "resultPage";
    }
}</pre></div><p>If we navigate to <code class="literal">localhost:8080/?name=Geoffroy</code>, we can see the following:</p><div class="mediaobject"><img src="graphics/2117_02_05.jpg" alt="Getting data with a request parameter"/></div><p>By default, the request parameter is mandatory. This means that if we were to navigate to <code class="literal">localhost:8080</code>, we would see an error message.</p><p>Looking <a id="id123" class="indexterm"/>at the <code class="literal">@RequestParam</code> code, we can see that in addition to the value parameter, there are two other attributes possible: <code class="literal">required</code> and <code class="literal">defaultValue</code>.</p><p>Therefore, we can change our code and specify a default value for our parameter or indicate that it is not required:</p><div class="informalexample"><pre class="programlisting">@Controller
public class HelloController {

    @RequestMapping("/")
    public String hello(@RequestParam(defaultValue = "world") String name, Model model) {
        model.addAttribute("message", "Hello, " + name);
        return "resultPage";
    }
}</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip11"/>Tip</h3><p>In Java 8, it is possible not to specify the value parameter. In that case, the name of the annotated method parameter will be used.</p></div></div></div></div>
<div class="section" title="Enough Hello Worlds, let's fetch tweets!"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec22"/>Enough Hello Worlds, let's fetch tweets!</h1></div></div></div><p>All right, the name <a id="id124" class="indexterm"/>of the book isn't "Mastering Hello Worlds", after all. With Spring, interrogating Twitter's API is really easy.</p><div class="section" title="Registering your application"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec21"/>Registering your application</h2></div></div></div><p>Before you<a id="id125" class="indexterm"/> start, you have to register <a id="id126" class="indexterm"/>your application in the Twitter developer console.</p><p>Go to <a class="ulink" href="https://apps.twitter.com">https://apps.twitter.com</a> and create a new application.</p><p>Give it the name you please. Under the website and Callback URL sections, just enter <code class="literal">http://127.0.0.1:8080</code>. This will allow you to test your application in development on your local <a id="id127" class="indexterm"/>machine.</p><div class="mediaobject"><img src="graphics/2117_2_11.jpg" alt="Registering your application"/></div><p>Now, navigate to the keys, access the token, and copy the <span class="strong"><strong>Consumer Key</strong></span> and the <span class="strong"><strong>Consumer Secret</strong></span>. We will use this in a moment. Take a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/2117_02_12.jpg" alt="Registering your application"/></div><p>By default, our <a id="id128" class="indexterm"/>application has read only permissions. This will be enough for our application, but you can tweak it if you wish.</p></div><div class="section" title="Setting up Spring Social Twitter"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec22"/>Setting up Spring Social Twitter</h2></div></div></div><p>We will add the<a id="id129" class="indexterm"/> following dependency to our <code class="literal">build.gradle</code> file:</p><div class="informalexample"><pre class="programlisting">compile 'org.springframework.boot:spring-boot-starter-social-twitter'</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>
<span class="strong"><strong>Spring Social</strong></span><a id="id130" class="indexterm"/> is a set of projects providing access to the public APIs of various social networks. Out of the box, Spring Boot provides integration with Twitter, Facebook, and LinkedIn. Spring Social includes<a id="id131" class="indexterm"/> about 30 projects overall, which can be found at <a class="ulink" href="http://projects.spring.io/spring-social/">http://projects.spring.io/spring-social/</a>.</p></div></div><p>Add the following two lines to the <code class="literal">application.properties</code>:</p><div class="informalexample"><pre class="programlisting">spring.social.twitter.appId= &lt;Consumer Key&gt;
spring.social.twitter.appSecret= &lt;Consumer Secret&gt;</pre></div><p>These are the keys associated with the application we just created.</p><p>You will learn more about OAuth in <a class="link" href="ch06.html" title="Chapter 6. Securing Your Application">Chapter 6</a>, <span class="emphasis"><em>Securing Your Application</em></span>. For now, we will just use those credentials to issue requests to Twitter's API on behalf of our application.</p></div><div class="section" title="Accessing Twitter"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec23"/>Accessing Twitter</h2></div></div></div><p>We can now <a id="id132" class="indexterm"/>use Twitter in our controller. Let's change its name to <code class="literal">TweetController</code> as a variable to reflect its new responsibility in a better manner:</p><div class="informalexample"><pre class="programlisting">@Controller
public class HelloController {

    @Autowired
    private Twitter twitter;

    @RequestMapping("/")
    public String hello(@RequestParam(defaultValue = "masterSpringMVC4") String search, Model model) {
        SearchResults searchResults = twitter.searchOperations().search(search);
        String text = searchResults.getTweets().get(0).getText();
        model.addAttribute("message", text);
        return "resultPage";
    }
}</pre></div><p>As you can see, the code searches for tweets matching the request parameter. If it all goes well, you will see the text of the first one being displayed on your screen:</p><div class="mediaobject"><img src="graphics/2117_02_06.jpg" alt="Accessing Twitter"/></div><p>Of course, if the search doesn't yield any result, our clumsy code will fail with an <code class="literal">ArrayOutOfBoundException</code>. So, do not hesitate to tweet to solve the problem!</p><p>What if we wanted to display a list of tweets? Let's modify the <code class="literal">resultPage.html</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html &gt;
&lt;head lang="en"&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;title&gt;Hello twitter&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
   <span class="strong"><strong> &lt;ul&gt;</strong></span>
<span class="strong"><strong>        &lt;li th:each="tweet : ${tweets}" th:text="${tweet}"&gt;Some tweet&lt;/li&gt;</strong></span>
<span class="strong"><strong>    &lt;/ul&gt;</strong></span>
&lt;/body&gt;
&lt;/html&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The <code class="literal">th:each</code> is a<a id="id133" class="indexterm"/> tag defined in Thymeleaf that allows it to iterate over a collection and assign each value to a variable inside a loop.</p></div></div><p>We will<a id="id134" class="indexterm"/> need to change our controller as well:</p><div class="informalexample"><pre class="programlisting">@Controller
public class TweetController {

    @Autowired
    private Twitter twitter;

    @RequestMapping("/")
    public String hello(@RequestParam(defaultValue = "masterSpringMVC4") String search, Model model) {
        SearchResults searchResults = twitter.searchOperations().search(search);
        <span class="strong"><strong>List&lt;String&gt; tweets =</strong></span>
<span class="strong"><strong>                searchResults.getTweets()</strong></span>
<span class="strong"><strong>                        .stream()</strong></span>
<span class="strong"><strong>                        .map(Tweet::getText)</strong></span>
<span class="strong"><strong>                        .collect(Collectors.toList());</strong></span>
<span class="strong"><strong>        model.addAttribute("tweets", tweets);</strong></span>
        return "resultPage";
    }
}</pre></div><p>Note that we are using Java 8 streams to collect only the messages from the tweets. The <code class="literal">Tweet</code> class contains many other attributes such as the sender, the retweet count, and so on. However, we will keep it simple for now, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/2117_02_07.jpg" alt="Accessing Twitter"/></div></div></div>
<div class="section" title="Java 8 streams and lambdas"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec23"/>Java 8 streams and lambdas</h1></div></div></div><p>You might not be familiar with lambdas yet. In Java 8, every collection gets a default method <code class="literal">stream()</code>, which gives access to functional-style operations.</p><p>These operations <a id="id135" class="indexterm"/>can be either intermediate operations returning a stream, and thus <a id="id136" class="indexterm"/>allowing chaining, or a terminal operation that returns a value.</p><p>The most famous <a id="id137" class="indexterm"/>intermediate operations are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">map</code>: This applies a <a id="id138" class="indexterm"/>method to every element of a list and returns the list of results</li><li class="listitem" style="list-style-type: disc"><code class="literal">filter</code>: This returns a list of every element matching a predicate</li><li class="listitem" style="list-style-type: disc"><code class="literal">reduce</code>: This projects a list into a single value using an operation and an accumulator</li></ul></div><p>Lambdas are shorthand syntax for function expressions. They can be coerced into a Single Abstract Method, an interface with only one function.</p><p>For instance, you can implement the <code class="literal">Comparator</code> interface as follows:</p><div class="informalexample"><pre class="programlisting">Comparator&lt;Integer&gt; c = (e1, e2) -&gt; e1 - e2;</pre></div><p>Within lambdas, the return keyword is implicitly its last expression.</p><p>The double colon operator we used earlier is a shortcut to get a reference to a function on a class,</p><div class="informalexample"><pre class="programlisting">Tweet::getText</pre></div><p>The preceding is equivalent to the following:</p><div class="informalexample"><pre class="programlisting">(Tweet t) -&gt; t.getText()</pre></div><p>The <code class="literal">collect</code> method allows us to call a terminal operation. The <code class="literal">Collectors</code> class is a set of terminal operations that will put results into lists, sets, or maps, allowing grouping, joining, and so on.</p><p>Calling the <code class="literal">collect(Collectors.toList())</code> method will produce a list with every element within the stream; in our case, the tweet names.</p></div>
<div class="section" title="Material design with WebJars"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec24"/>Material design with WebJars</h1></div></div></div><p>Our application is already great but it seriously leaves something to be desired in terms of aesthetics. You<a id="id139" class="indexterm"/> may have heard of material design. It is Google's take <a id="id140" class="indexterm"/>on flat design.</p><p>We will <a id="id141" class="indexterm"/>use Materialize (<a class="ulink" href="http://materializecss.com">http://materializecss.com</a>), a great looking responsive CSS and JavaScript library, just like Bootstrap.</p><div class="mediaobject"><img src="graphics/2117_02_08.jpg" alt="Material design with WebJars"/></div><p>We talked a bit about WebJars in <a class="link" href="ch01.html" title="Chapter 1. Setting Up a Spring Web Application in No Time">Chapter 1</a>, <span class="emphasis"><em>Setting Up a Spring Web Application in No Time</em></span>; we will <a id="id142" class="indexterm"/>now get to use them. Add jQuery and Materialize <a id="id143" class="indexterm"/>CSS to our dependencies:</p><div class="informalexample"><pre class="programlisting">compile 'org.webjars:materializecss:0.96.0'
compile 'org.webjars:jquery:2.1.4'</pre></div><p>The way a WebJar is organized is completely standardized. You will find the JS and CSS files of any library in <code class="literal">/webjars/{lib}/{version}/*.js</code>.</p><p>For instance, to add jQuery to our page, the following to a web page:</p><div class="informalexample"><pre class="programlisting">&lt;script src="/webjars/jquery/2.1.4/jquery.js"&gt;&lt;/script&gt;</pre></div><p>Let's modify our controller so that it gives us a list of all tweet objects instead of simple text:</p><div class="informalexample"><pre class="programlisting">package masterSpringMvc.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.social.twitter.api.SearchResults;
import org.springframework.social.twitter.api.Tweet;
import org.springframework.social.twitter.api.Twitter;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.List;

@Controller
public class TweetController {

    @Autowired
    private Twitter twitter;

    @RequestMapping("/")
    public String hello(@RequestParam(defaultValue = "masterSpringMVC4") String search, Model model) {
        SearchResults searchResults = twitter.searchOperations().search(search);
        List&lt;Tweet&gt; tweets = searchResults.getTweets();
        model.addAttribute("tweets", tweets);
        model.addAttribute("search", search);
        return "resultPage";
    }
}</pre></div><p>Let's<a id="id144" class="indexterm"/> include <a id="id145" class="indexterm"/>materialize CSS in our view:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html &gt;
&lt;head lang="en"&gt;
    &lt;meta charset="UTF-8"/&gt;
    &lt;title&gt;Hello twitter&lt;/title&gt;

    <span class="strong"><strong>&lt;link href="/webjars/materializecss/0.96.0/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/&gt;</strong></span>
&lt;/head&gt;
&lt;body&gt;
&lt;div class="row"&gt;

    &lt;h2 class="indigo-text center" th:text="|Tweet results for ${search}|"&gt;Tweets&lt;/h2&gt;

    &lt;ul class="collection"&gt;
        &lt;li class="collection-item avatar" th:each="tweet : ${tweets}"&gt;
            &lt;img th:src="${tweet.user.profileImageUrl}" alt="" class="circle"/&gt;
            &lt;span class="title" th:text="${tweet.user.name}"&gt;Username&lt;/span&gt;
            &lt;p th:text="${tweet.text}"&gt;Tweet message&lt;/p&gt;
        &lt;/li&gt;
    &lt;/ul&gt;

&lt;/div&gt;

<span class="strong"><strong>&lt;script src="/webjars/jquery/2.1.4/jquery.js"&gt;&lt;/script&gt;</strong></span>
<span class="strong"><strong>&lt;script src="/webjars/materializecss/0.96.0/js/materialize.js"&gt;&lt;/script&gt;</strong></span>
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>The result already looks way better!</p><div class="mediaobject"><img src="graphics/2117_02_10.jpg" alt="Material design with WebJars"/></div><div class="section" title="Using layouts"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec24"/>Using layouts</h2></div></div></div><p>The last thing we want to do is to put the reusable chunks of our UI into templates. To do this, we will <a id="id146" class="indexterm"/>use the <code class="literal">thymeleaf-layout-dialect</code> dependency, which is<a id="id147" class="indexterm"/> included in the <code class="literal">spring-boot-starter-thymeleaf</code> dependency of our project.</p><p>We will create a new file called <code class="literal">default.html</code> in <code class="literal">src/main/resources/templates/layout</code>. It will contain the code we will repeat from page to page:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html 
      &gt;
&lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/&gt;
    &lt;title&gt;Default title&lt;/title&gt;

    &lt;link href="/webjars/materializecss/0.96.0/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;section layout:fragment="content"&gt;
    &lt;p&gt;Page content goes here&lt;/p&gt;
&lt;/section&gt;

&lt;script src="/webjars/jquery/2.1.4/jquery.js"&gt;&lt;/script&gt;
&lt;script src="/webjars/materializecss/0.96.0/js/materialize.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>We will now modify the <code class="literal">resultPage.html</code> file so it uses the layout, which will simplify its contents:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html 
      
      layout:decorator="layout/default"&gt;
&lt;head lang="en"&gt;
    &lt;title&gt;Hello twitter&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="row" layout:fragment="content"&gt;

    &lt;h2 class="indigo-text center" th:text="|Tweet results for ${search}|"&gt;Tweets&lt;/h2&gt;

    &lt;ul class="collection"&gt;
        &lt;li class="collection-item avatar" th:each="tweet : ${tweets}"&gt;
            &lt;img th:src="${tweet.user.profileImageUrl}" alt="" class="circle"/&gt;
            &lt;span class="title" th:text="${tweet.user.name}"&gt;Username&lt;/span&gt;

            &lt;p th:text="${tweet.text}"&gt;Tweet message&lt;/p&gt;
        &lt;/li&gt;
    &lt;/ul&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>The <code class="literal">layout:decorator="layout/default"</code> will indicate where our layout can be found. We <a id="id148" class="indexterm"/>can then inject content into the different <code class="literal">layout:fragment</code> sections <a id="id149" class="indexterm"/>of the layout. Note that each template are valid HTML files. You can also override the title very easily.</p></div><div class="section" title="Navigation"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec25"/>Navigation</h2></div></div></div><p>We have a nice little tweet display application, but how are our users supposed to figure out that they <a id="id150" class="indexterm"/>need to supply a "search" request parameter?</p><p>It would be nice if<a id="id151" class="indexterm"/> we added a little form to our application.</p><p>Let's do something like this:</p><div class="mediaobject"><img src="graphics/2117_02_13.jpg" alt="Navigation"/></div><p>First, we need to modify our <code class="literal">TweetController</code> to add a second view to our application. The search page will be available directly at the root of our application and the result page when hit enter in the <code class="literal">search</code> field:</p><div class="informalexample"><pre class="programlisting">@Controller
public class TweetController {

    @Autowired
    private Twitter twitter;

    @RequestMapping("/")
    public String home() {
        return "searchPage";
    }

    @RequestMapping("/result")
    public String hello(@RequestParam(defaultValue = "masterSpringMVC4") String search, Model model) {
        SearchResults searchResults = twitter.searchOperations().search(search);
        List&lt;Tweet&gt; tweets = searchResults.getTweets();
        model.addAttribute("tweets", tweets);
        model.addAttribute("search", search);
        return "resultPage";
    }
}</pre></div><p>We will add another page to the <code class="literal">templates</code> folder called the <code class="literal">searchPage.html</code> file. It will contain a simple form, which will pass the search term to the result page via the <code class="literal">get</code> method:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html 
      
      layout:decorator="layout/default"&gt;
&lt;head lang="en"&gt;
    &lt;title&gt;Search&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class="row" layout:fragment="content"&gt;

    &lt;h4 class="indigo-text center"&gt;Please enter a search term&lt;/h4&gt;

    &lt;form action="/result" method="get" class="col s12"&gt;
        &lt;div class="row center"&gt;
            &lt;div class="input-field col s6 offset-s3"&gt;
                &lt;i class="mdi-action-search prefix"&gt;&lt;/i&gt;
                &lt;input id="search" name="search" type="text" class="validate"/&gt;
                &lt;label for="search"&gt;Search&lt;/label&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></div><p>This is <a id="id152" class="indexterm"/>very <a id="id153" class="indexterm"/>simple HTML and it works perfectly. You can try it now.</p><p>What if we wanted to disallow some search result? Let's say we want to display an error message if the user types in <code class="literal">struts</code>.</p><p>The best way to achieve this would be to modify the form to post the data. In the controller, we can then intercept what is posted and implement this business rule accordingly.</p><p>First, we need to change the form in the <code class="literal">searchPage</code>, which is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;form action="/result" method="get" class="col s12"&gt;</pre></div><p>Now, we change the form to this:</p><div class="informalexample"><pre class="programlisting">&lt;form action="/postSearch" method="post" class="col s12"&gt;</pre></div><p>We also need to handle this post on the server. Add this method to the <code class="literal">TweetController</code>:</p><div class="informalexample"><pre class="programlisting">@RequestMapping(value = "/postSearch", method = RequestMethod.POST)
public String postSearch(HttpServletRequest request,
    RedirectAttributes redirectAttributes) {
        String search = request.getParameter("search");
        redirectAttributes.addAttribute("search", search);
        return "redirect:result";
}</pre></div><p>There are <a id="id154" class="indexterm"/>several novelties here:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">In the request <a id="id155" class="indexterm"/>mapping annotation, we specify the HTTP method we want to handle, that is, <code class="literal">POST</code>.</li><li class="listitem" style="list-style-type: disc">We inject two attributes directly as method parameters. They are the request and <code class="literal">RedirectAttributes</code>.</li><li class="listitem" style="list-style-type: disc">We retrieve the value posted on the request and pass it on to the next view.</li><li class="listitem" style="list-style-type: disc">Instead of returning the name of the view, we make a redirection to a URL.</li></ul></div><p>The <code class="literal">RedirectAttributes</code> is a Spring model that will be specifically used to propagate values in a redirect scenario.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note09"/>Note</h3><p>
<span class="strong"><strong>Redirect/Forward</strong></span> are classical options in the context of a Java web application. They both <a id="id156" class="indexterm"/>change the view that is displayed on the user's browser. The difference is that <code class="literal">Redirect</code> will send a 302 header that will trigger<a id="id157" class="indexterm"/> navigation inside the browser, whereas <code class="literal">Forward</code> will not cause the URL to change. In Spring MVC, you can use either option simply by prefixing your method return strings with <code class="literal">redirect:</code> or <code class="literal">forward:</code>. In both cases, the string you return will not be resolved to a view like we saw earlier, but will instead trigger navigation to a specific URL.</p></div></div><p>The preceding example is a bit contrived, and we will see smarter form handling in the next chapter. If you put a breakpoint in the <code class="literal">postSearch</code> method, you will see that it will be called right after a post in our form.</p><p>So what about the error message?</p><p>Let's change the <code class="literal">postSearch</code> method:</p><div class="informalexample"><pre class="programlisting">@RequestMapping(value = "/postSearch", method = RequestMethod.POST)
public String postSearch(HttpServletRequest request,
    RedirectAttributes redirectAttributes) {
        String search = request.getParameter("search");
        if (search.toLowerCase().contains("struts")) {
                redirectAttributes.addFlashAttribute("error", "Try using spring instead!");
                return "redirect:/";
        }
        redirectAttributes.addAttribute("search", search);
        return "redirect:result";
}</pre></div><p>If the user's search terms contain "struts", we redirect them to the <code class="literal">searchPage</code> and add a little error<a id="id158" class="indexterm"/> message using flash attributes.</p><p>These special kinds of <a id="id159" class="indexterm"/>attributes live only for the time of a request and will disappear when the page is refreshed. This is very useful when we use the <code class="literal">POST-REDIRECT-GET</code> pattern, as we just did.</p><p>We will need to display this message in the <code class="literal">searchPage</code> result:</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html 
      
      layout:decorator="layout/default"&gt;
&lt;head lang="en"&gt;
    &lt;title&gt;Search&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div class="row" layout:fragment="content"&gt;

    &lt;h4 class="indigo-text center"&gt;Please enter a search term&lt;/h4&gt;

<span class="strong"><strong>    &lt;div class="col s6 offset-s3"&gt;</strong></span>
<span class="strong"><strong>        &lt;div id="errorMessage" class="card-panel red lighten-2" th:if="${error}"&gt;</strong></span>
<span class="strong"><strong>            &lt;span class="card-title" th:text="${error}"&gt;&lt;/span&gt;</strong></span>
<span class="strong"><strong>        &lt;/div&gt;</strong></span>

        &lt;form action="/postSearch" method="post" class="col s12"&gt;
            &lt;div class="row center"&gt;
                &lt;div class="input-field"&gt;
                    &lt;i class="mdi-action-search prefix"&gt;&lt;/i&gt;
                    &lt;input id="search" name="search" type="text" class="validate"/&gt;
                    &lt;label for="search"&gt;Search&lt;/label&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></div><p>Now, if users<a id="id160" class="indexterm"/> try<a id="id161" class="indexterm"/> to search for "struts2" tweets, they will get a useful and appropriate answer:</p><div class="mediaobject"><img src="graphics/2117_02_14.jpg" alt="Navigation"/></div></div></div>
<div class="section" title="The check point"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec25"/>The check point</h1></div></div></div><p>At the end of this chapter, you should have one controller, the <code class="literal">TweetController</code>, handling the<a id="id162" class="indexterm"/> search and the untouched generated configuration class, <code class="literal">MasterSpringMvcApplication</code>, in the <code class="literal">src/main/java</code> directory:</p><div class="mediaobject"><img src="graphics/2117_02_15.jpg" alt="The check point"/></div><p>In the <code class="literal">src/main/resources</code> directory, you should have one default layout and two pages using it.</p><p>In the <code class="literal">application.properties</code> file, we added the Twitter application credentials as well as a property <a id="id163" class="indexterm"/>telling Spring not to cache the templates to ease development:</p><div class="mediaobject"><img src="graphics/2117_02_16.jpg" alt="The check point"/></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec26"/>Summary</h1></div></div></div><p>In this chapter, you learned what it takes to make a good MVC architecture. We saw some of the inner workings of Spring MVC and used Spring Social Twitter with very little configuration. We can now design a beautiful web application, thanks to WebJars.</p><p>In the next chapter, we will ask the user to fill in their profile, so that we can fetch tweets they might like automatically. This will give you the opportunity to learn more about forms, formatting, validation, and internationalization.</p></div></body></html>