<html><head></head><body><div class="chapter" title="Chapter&#xA0;9.&#xA0;Multi-module Projects"><div class="titlepage"><div><div><h1 class="title"><a id="ch09"/>Chapter 9. Multi-module Projects</h1></div></div></div><p>In this chapter we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Understanding project inheritance</li><li class="listitem" style="list-style-type: disc">Understanding project aggregation</li><li class="listitem" style="list-style-type: disc">Combining inheritance and aggregation</li><li class="listitem" style="list-style-type: disc">Performing multi-module dependency management</li><li class="listitem" style="list-style-type: disc">Performing multi-module plugin management</li><li class="listitem" style="list-style-type: disc">Selectively building modules</li><li class="listitem" style="list-style-type: disc">Reporting for multi-module projects</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec86"/>Introduction</h1></div></div></div><p>Except for simple projects, most real-life projects have more than one module. Each of them can be developed independently. Some modules might depend on others. A project that uses these modules would want to ensure that it builds successfully with the appropriate versions of all the modules.</p><p>As we look at multiple modules, each module may use a number of dependencies. To avoid dependency hell, it is important that the versions of dependencies used by each module are managed well. There is also an opportunity to optimize on the dependencies and plugins to reduce the repetition of build scripts.</p></div></div>
<div class="section" title="Understanding project inheritance"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec87"/>Understanding project inheritance</h1></div></div></div><p>There are times when you <a id="id484" class="indexterm"/>might want a project to use values from another <code class="literal">.pom</code> file. You may be building a large software product, so you do not want to repeat the dependency and other elements multiple times.</p><p>Maven provides a feature called <span class="strong"><strong>project inheritance</strong></span> for this. Maven allows a number of elements specified in the parent pom file to be merged to the inheriting project. In fact, the super pom file is an example of project inheritance.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec216"/>Getting ready</h2></div></div></div><p>Maven is set up on your system and is verified to work. To do this, refer to <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec217"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project that<a id="id485" class="indexterm"/> has inheritance; project-with-inheritance in our case. This has a subfolder named <code class="literal">child</code>, which is the project that inherits from the parent.</li><li class="listitem">Update the parent pom file as follows:<div class="informalexample"><pre class="programlisting">    &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;project-with-inheritance&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</pre></div></li><li class="listitem">Create the pom file for <code class="literal">child</code> as follows:<div class="informalexample"><pre class="programlisting">  &lt;parent&gt;
      &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
      &lt;artifactId&gt;project-with-inheritance&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;/parent&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;artifactId&gt;child&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;
  &lt;name&gt;Child Project&lt;/name&gt;</pre></div></li><li class="listitem">Run the following Maven command in the <code class="literal">child</code> subfolder:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_09_07.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec218"/>How it works...</h2></div></div></div><p>We specified a <code class="literal">parent</code> element<a id="id486" class="indexterm"/> in the pom file of <code class="literal">child</code>. Here, we added the coordinates of the parent, namely <code class="literal">groupId</code>, <code class="literal">artifactId</code>, and <code class="literal">version</code>. We did not specify the <code class="literal">groupId</code> and <code class="literal">version</code> coordinates of the <code class="literal">child</code> project. We also did not specify any <code class="literal">properties</code> and <code class="literal">dependencies</code>.</p><p>In the parent pom file, we specified <code class="literal">properties</code> and <code class="literal">dependencies</code>.</p><p>Due to the relationship defined, when Maven runs on the <code class="literal">child</code> project, it inherits <code class="literal">groupId</code>, <code class="literal">version</code>, <code class="literal">properties</code>, and <code class="literal">dependencies</code> defined in the parent.</p><p>Interestingly, the parent pom file (<code class="literal">project-with-inheritance</code>) is oblivious to the fact that there is a <code class="literal">child</code> project.</p><p>However, this only works if the parent project is of the <code class="literal">pom</code> type.</p><p>How did Maven know where the parent pom is located? We did not specify a location in the pom file. This is because, by default, Maven looks for the parent pom in the parent folder of <code class="literal">child</code>. Otherwise, it attempts to download the parent pom from the repository.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec219"/>There's more...</h2></div></div></div><p>What if the parent pom is not in any repository? Also, what if it is in a different folder from the parent folder of the child? Let's see what happens:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a child project, where the parent project is not in the <code class="literal">parent</code> folder but in a subfolder (in our case, <code class="literal">parent</code>):<div class="mediaobject"><img src="graphics/6124OS_09_01.jpg" alt="There's more..."/></div></li><li class="listitem">Update the <a id="id487" class="indexterm"/>pom file of the child project as follows:<div class="informalexample"><pre class="programlisting">  &lt;parent&gt;
      &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
      &lt;artifactId&gt;parent&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
      &lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;
 &lt;/parent&gt; </pre></div></li><li class="listitem">Build the <code class="literal">child</code> project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li></ol></div><p>Maven now determines the location of the parent pom by virtue of the <code class="literal">relativePath</code> element, which indicates the folder where the parent pom is located. Using this, it builds the child project successfully.</p></div></div>
<div class="section" title="Understanding project aggregation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec88"/>Understanding project aggregation</h1></div></div></div><p>A key difference between <a id="id488" class="indexterm"/>inheritance and aggregation is that, aggregation is defined with a top-down approach, whereas inheritance is defined the other way around. In Maven, project aggregation is similar to project inheritance, except that the change is made in the parent pom instead of the child pom.</p><p>Maven uses the term <span class="strong"><strong>module</strong></span><a id="id489" class="indexterm"/> to define a child or subproject, which is part of a larger project. An aggregate project can build all the modules together. Also, a Maven command run on the parent pom or the pom file of the aggregate project will also apply to all the modules that it contains.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec220"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project <a id="id490" class="indexterm"/>that has aggregation; in our case <code class="literal">project-with-aggregation</code>. This has a subfolder named <code class="literal">aggregate-child</code>, which is the module that is aggregated by the parent project.</li><li class="listitem">Update the parent pom as follows:<div class="informalexample"><pre class="programlisting">    &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;project-with-aggregation&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</pre></div></li><li class="listitem">Add the <code class="literal">module</code> section and specify the child:<div class="informalexample"><pre class="programlisting">   &lt;modules&gt;
      &lt;module&gt;aggregate-child&lt;/module&gt;
   &lt;/module&gt;</pre></div></li><li class="listitem">Run the following Maven command in the <code class="literal">parent</code> folder:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>C:\projects\apache-maven-cookbook\project-with-aggregation&gt;mvn clean package</strong></span>
<span class="strong"><strong>[INFO] Scanning for projects...</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Reactor Build Order:</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] Aggregate child Project</strong></span>
<span class="strong"><strong>[INFO] project-with-aggregation</strong></span>
<span class="strong"><strong>…</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Reactor Summary:</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] Child Project ...................................... SUCCESS [  2.866 s]</strong></span>
<span class="strong"><strong>[INFO] project-with-aggregation ........................... SUCCESS [  0.004 s]</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec221"/>How it works...</h2></div></div></div><p>We specified the <code class="literal">child</code> project as<a id="id491" class="indexterm"/> a module in the aggregator pom. The child project is a normal Maven project, which has no information about the fact that there exists an aggregator pom.</p><p>When the aggregator project is built, it builds the child project in turn. You will notice the word <code class="literal">Reactor</code> in the Maven output. Reactor is a part of Maven, which allows it to execute a goal on a set of modules. While modules are discrete units of work; they can be gathered together using the reactor to build them simultaneously. The reactor determines the correct build order from the dependencies stated by each module.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec222"/>There's more...</h2></div></div></div><p>As in the case of inheritance, what the module is, is not a subfolder of the aggregator project, but a sibling.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update the <code class="literal">module</code> section as follows:<div class="informalexample"><pre class="programlisting">  &lt;modules&gt;
      &lt;module&gt;../aggregate-child&lt;/module&gt;
   &lt;/module&gt;
 </pre></div></li><li class="listitem">Build the aggregator project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li></ol></div><p>Maven now determines the location of the module by virtue of the path specified, which indicates the folder where the parent pom is located. By convention, the module name is expected to be identical to the folder name.</p></div></div>
<div class="section" title="Combining inheritance and aggregation"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec89"/>Combining inheritance and aggregation</h1></div></div></div><p>By using the project<a id="id492" class="indexterm"/> inheritance feature of <a id="id493" class="indexterm"/>Maven, we can share common build attributes such as <code class="literal">properties</code> and <code class="literal">dependencies</code> across all children. We can also aggregate modules and build them together.</p><p>When project inheritance is used, the parent is not aware of the child. In the case of project aggregation, each module is not aware of the aggregation.</p><p>We will now see how to combine and get the benefits of both.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec223"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open <a id="id494" class="indexterm"/>a multi-module<a id="id495" class="indexterm"/> project; in our case, <code class="literal">simple-multi-module</code>. This has a subfolder <code class="literal">child</code>, which is the module that is aggregated by the parent project.</li><li class="listitem">Update the parent pom as follows:<div class="informalexample"><pre class="programlisting">    &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;simple-multi-module&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</pre></div></li><li class="listitem">Add the <code class="literal">module</code> section and specify the child:<div class="informalexample"><pre class="programlisting">   &lt;modules&gt;
      &lt;module&gt;child&lt;/module&gt;</pre></div></li><li class="listitem"> Update the child pom to specify the <code class="literal">parent</code> element:<div class="informalexample"><pre class="programlisting">    &lt;parent&gt;
      &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
      &lt;artifactId&gt;simple-multi-module&lt;/artifactId&gt;
      &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
     &lt;/parent&gt;</pre></div></li><li class="listitem">Run the following Maven command in the parent folder:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Reactor Summary:</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] simple-multi-module ................................ SUCCESS [  0.162 s]</strong></span>
<span class="strong"><strong>[INFO] Child Project ...................................... SUCCESS [  2.411 s]</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec224"/>How it works...</h2></div></div></div><p>We have <a id="id496" class="indexterm"/>specified the <code class="literal">parent</code> <a id="id497" class="indexterm"/>element in the <code class="literal">child</code> pom to indicate who the parent is. We have also specified the <code class="literal">child</code> project as a module in the parent pom. Thus, both the relationships—inheritance and aggregation—are defined.</p><p>When we build the parent project, it automatically builds the child by virtue of the <code class="literal">modules</code> element. At the same time, the child project can be built independently as well.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec225"/>There's more...</h2></div></div></div><p>The child project need not necessarily be a subfolder of the parent project. If it is elsewhere, as we have seen in the earlier recipes, it can be one of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">relativePath</code>: <code class="literal">relativePath</code> of the <a id="id498" class="indexterm"/>parent element should point to the appropriate location of the parent</li><li class="listitem" style="list-style-type: disc"><code class="literal">module</code>: The <code class="literal">module</code> element<a id="id499" class="indexterm"/> should contain the appropriate path to the child project</li></ul></div></div></div>
<div class="section" title="Performing multi-module dependency management"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec90"/>Performing multi-module dependency management</h1></div></div></div><p>Dependency management<a id="id500" class="indexterm"/> is a mechanism to centralize dependency information. When there are a set of projects (or modules) that inherit a common parent, all information about the dependency can be put in the parent pom and the projects can have simpler references to them. This makes it easy to maintain the dependencies across multiple projects and reduces the<a id="id501" class="indexterm"/> issues that typically arise due to multiple versions of the same dependencies.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec226"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a multi-module project (<code class="literal">simple-multi-module</code>).</li><li class="listitem">Add a dependency for <code class="literal">junit</code> in the <code class="literal">dependencyManagement</code> section:<div class="informalexample"><pre class="programlisting">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;3.8.1&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</pre></div></li><li class="listitem">Update the <code class="literal">dependencies</code> section of the child project as follows:<div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
     &lt;dependency&gt;
       &lt;groupId&gt;junit&lt;/groupId&gt;
       &lt;artifactId&gt;junit&lt;/artifactId&gt;
     &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean test</strong></span>
</pre></div><p>Ensure<a id="id502" class="indexterm"/> that the build completes successfully.</p></li><li class="listitem">Run the Maven command to check the dependency:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:tree</strong></span>
</pre></div></li><li class="listitem">Observe the results:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ simple-multi-module</strong></span>
<span class="strong"><strong>---</strong></span>
<span class="strong"><strong>[INFO] com.packt.cookbook:simple-multi-module:pom:1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] Building Child Project 1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ child ---</strong></span>
<span class="strong"><strong>[INFO] com.packt.cookbook:child:jar:1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>[INFO] \- junit:junit:jar:3.8.1:test</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec227"/>How it works...</h2></div></div></div><p>Dependencies that are specified within the <code class="literal">dependencyManagement</code> section of the parent pom are available for use to all the child projects. The child project needs to choose the dependencies by explicitly specifying the required dependencies in the <code class="literal">dependencies</code> section. While doing this, the child projects can omit the <code class="literal">version</code> and <code class="literal">scope</code> information so that they are inherited from the parent.</p><p>You may ask, "Why <a id="id503" class="indexterm"/>have the <code class="literal">dependencyManagement</code> section when child projects inherit dependencies defined in the parent pom anyway?" The reason is, the parent centralizes dependencies across several projects. A child project typically needs only some of the dependencies that the parent defines and not all of them. The <code class="literal">dependencyManagement</code> section allows child projects to selectively choose these.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec228"/>There's more...</h2></div></div></div><p>The <code class="literal">dependencyManagement</code> section also helps address any surprises of Maven's dependency mediation. Dependency mediation is what determines what version of dependency will be used when multiple versions of an artifact are encountered. However, <code class="literal">dependencyManagement</code> takes precedence over dependency mediation and ensures that dependency mediation does not pick a version over the one specified in <code class="literal">dependencyManagement</code>.</p><p>It should be noted that dependencies on different versions are error prone and <code class="literal">dependencyManagement</code> cannot always save them from library version incompatibilities.</p></div></div>
<div class="section" title="Performing multi-module plugin management"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec91"/>Performing multi-module plugin management</h1></div></div></div><p>In multi-module projects, <code class="literal">pluginManagement</code> allows you <a id="id504" class="indexterm"/>to configure plugin information that can be used as required by child projects. The parent pom can define the configurations for various plugins used by different child projects. Each child project can chose the plugins that it needs for the build.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec229"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a multi-module<a id="id505" class="indexterm"/> project (<code class="literal">simple-multi-module</code>).</li><li class="listitem">Add a configuration for the Maven build helper plugin in the <code class="literal">pluginManagement</code> section to copy additional resources:<div class="informalexample"><pre class="programlisting">   &lt;pluginManagement&gt;
     &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;add-resource&lt;/id&gt;
            &lt;phase&gt;generate-resources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;add-resource&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;resources&gt;
                &lt;resource&gt;
                  &lt;directory&gt;src/resources/xml&lt;/directory&gt;
                  &lt;targetPath&gt;xml&lt;/targetPath&gt;
                &lt;/resource&gt;
                &lt;resource&gt;
                  &lt;directory&gt;src/resources/json&lt;/directory&gt;
                  &lt;targetPath&gt;json&lt;/targetPath&gt;
                    &lt;includes&gt;
                      &lt;include&gt;include.json&lt;/include&gt;
                    &lt;/includes&gt;
                    &lt;excludes&gt;
                      &lt;exclude&gt;exclude.json&lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/resource&gt;
              &lt;/resources&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
     &lt;/plugins&gt;
    &lt;/pluginManagement&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Run the <a id="id506" class="indexterm"/>following command to build the project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>    mvn clean test </strong></span>
</pre></div><p>Note that the additional resources are not getting copied in the child project.</p></li><li class="listitem">Now, use the corresponding plugin in the child project:<div class="informalexample"><pre class="programlisting">    &lt;build&gt;
       &lt;plugins&gt;
           &lt;plugin&gt;
               &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
               &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
           &lt;/plugin&gt;
       &lt;/plugins&gt;
   &lt;/build&gt;</pre></div></li><li class="listitem">Build the project again.</li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Copying 2 resources to xml</strong></span>
<span class="strong"><strong>[INFO] Copying 1 resource to json</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec230"/>How it works...</h2></div></div></div><p>We defined the<a id="id507" class="indexterm"/> Maven build helper plugin to copy resources from additional folders in the <code class="literal">pluginManagement</code> section of the parent pom. It is not available to the child pom until the child uses the plugin. When the child project did not define the plugin, the plugin definition in the parent pom had no effect. When the child project defined the plugin, it took effect and the additional resources got copied over.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec231"/>There's more...</h2></div></div></div><p>If a plugin is used as part of the build lifecycle, then its configuration in the <code class="literal">pluginManagement</code> section will take effect, even if not explicitly defined by the child. Let us see how this happens:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Define the Maven compiler plugin in <code class="literal">pluginManagement</code> of the parent pom:<div class="informalexample"><pre class="programlisting">  &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.2&lt;/version&gt;
            &lt;configuration&gt;
              &lt;source&gt;1.8&lt;/source&gt;
              &lt;target&gt;1.8&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
      &lt;plugin&gt;
&lt;/pluginManagement&gt;</pre></div></li><li class="listitem">Without adding the plugin to the child pom, run the following command using Java 7:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean test</strong></span>
</pre></div></li><li class="listitem">Observe the error:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.</strong></span>
<span class="strong"><strong>2:compile (default-compile) on project child: Fatal error compiling: invalid tar</strong></span>
<span class="strong"><strong>get release: 1.8 -&gt; [Help 1]</strong></span>
</pre></div></li></ol></div><p>What happened <a id="id508" class="indexterm"/>here? Even though the child pom did not define the Maven Compiler plugin, the configuration for the Maven Compiler plugin in the <code class="literal">pluginManagement</code> section of the parent pom took effect because the <code class="literal">compile</code> goal was part of the build lifecycle. As the configuration stipulated a Java 8 target, the compilation failed.</p><p>What if we do not want to inherit specific plugin configurations? Maven provides a way to do this. Let us see how:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update the preceding Maven Compiler plugin configuration as follows:<div class="informalexample"><pre class="programlisting">  &lt;pluginManagement&gt;
      &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.2&lt;/version&gt;
            &lt;inherited&gt;false&lt;/inherited&gt;
            &lt;configuration&gt;
              &lt;source&gt;1.8&lt;/source&gt;
              &lt;target&gt;1.8&lt;/target&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
      &lt;plugin&gt;
&lt;/pluginManagement&gt;</pre></div></li><li class="listitem">Now run the following using Java 7:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe that the project compiles without errors, though the plugin configuration specified Java 8.</li></ol></div><p>This is because the configuration was not inherited to the child module as we set the <code class="literal">inherited</code> element to <code class="literal">false</code>.</p></div></div>
<div class="section" title="Selectively building modules"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec92"/>Selectively building modules</h1></div></div></div><p>When a project has a number of <a id="id509" class="indexterm"/>modules, there may be situations when we might want to selectively build modules. One such situation could be because the module might run only on specific machines. Another reason could be that a module may have long-running tests that may make sense only in test servers.</p><p>Let us see how we can selectively build modules by using the <a id="id510" class="indexterm"/>
<span class="strong"><strong>profile</strong></span> feature of Maven.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec232"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a multi-module project that has two modules (<code class="literal">two-multi-module</code>), namely <code class="literal">common-one</code> and <code class="literal">dev-two</code>.</li><li class="listitem">In the parent pom, add one project to the <code class="literal">modules</code> section:<div class="informalexample"><pre class="programlisting">  &lt;modules&gt;
      &lt;module&gt;common-one&lt;/module&gt;
  &lt;/modules&gt;</pre></div></li><li class="listitem">Define a profile and include both modules:<div class="informalexample"><pre class="programlisting">&lt;profiles&gt;
      &lt;profile&gt;
          &lt;id&gt;dev&lt;/id&gt;
          &lt;modules&gt;
              &lt;module&gt;common-one&lt;/module&gt;
              &lt;module&gt;dev-two&lt;/module&gt;
          &lt;/modules&gt;
      &lt;/profile&gt;
  &lt;/profiles&gt;</pre></div></li><li class="listitem">Run the Maven command to build with the <code class="literal">dev</code> profile:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –P dev clean test</strong></span>
</pre></div></li><li class="listitem">Observe the result:<div class="mediaobject"><img src="graphics/6124OS_09_02.jpg" alt="How to do it..."/></div></li><li class="listitem">Run the Maven command to build without profile:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean test</strong></span>
</pre></div></li><li class="listitem">Observe the result:<div class="mediaobject"><img src="graphics/6124OS_09_03.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec233"/>How it works...</h2></div></div></div><p>When you have <a id="id511" class="indexterm"/>multiple modules and you want to control when specific<a id="id512" class="indexterm"/> ones should be built, the simplest way to achieve this is to define specific profiles and define modules within each of them. In our example, we created a <code class="literal">dev</code> profile to build both modules, <code class="literal">common-one</code> and <code class="literal">dev-two</code>. The default Maven build builds only the <code class="literal">common-one</code> module.</p><p>What we achieved is the ability to exclude or skip specific modules from build as required. As you saw, a profile can only extend the list of modules, so it cannot actually blacklist a module.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip15"/>Tip</h3><p>Similarly, we could define <code class="literal">pluginManagement</code> and <code class="literal">dependencyManagement</code> within profiles so that these take effect only for the profiles.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec234"/>There's more...</h2></div></div></div><p>Maven also provides command-line options<a id="id513" class="indexterm"/> to build modules selectively. Here are some of them with examples based on the <code class="literal">two-multi-module</code> Maven project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">-pl –projects</code>: This <a id="id514" class="indexterm"/>is a comma-separated list of projects to be built. An example for this is as follows:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package –pl common-one</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">–am</code>: This stands <a id="id515" class="indexterm"/>for <code class="literal">--also-make</code>: This builds projects required by the list if the project list is specified:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package –pl common-one –am </strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">–amd</code>: This<a id="id516" class="indexterm"/> stands for <code class="literal">--also-make-dependants</code>. This builds projects that depend on projects on the list (if project list is specified):<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package –pl common-one –amd</strong></span>
</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">-rf</code>: This stands<a id="id517" class="indexterm"/> for <code class="literal">–resume-from</code>. This resumes build from a specific project (useful in the case of failures in a multi-module build):<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –Pdev clean package –rf dev-two </strong></span>
</pre></div></li></ul></div></div></div>
<div class="section" title="Reporting for multi-module projects"><div class="titlepage"><div><div><h1 class="title"><a id="ch09lvl1sec93"/>Reporting for multi-module projects</h1></div></div></div><p>When we talk about generating a<a id="id518" class="indexterm"/> site report for a multi-module project, we refer to generating this for each module of the project and the parent project. In the case of the site report for a multi-module project, a couple of factors need to be taken into account. The first one is to test if the links between the parent and the modules work correctly. The other is to check if certain site reports can be aggregated instead of being reported individually for each module.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec235"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a multi-module project (<code class="literal">two-multi-module</code>) with two modules, one and two.</li><li class="listitem">Add the following command to the <code class="literal">reporting</code> section of the parent pom for <code class="literal">checkstyle</code>:<div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.13&lt;/version&gt;
        &lt;reportSets&gt;
          &lt;reportSet&gt;
            &lt;id&gt;aggregate&lt;/id&gt;
            &lt;inherited&gt;false&lt;/inherited&gt;
            &lt;reports&gt;
              &lt;report&gt;checkstyle-aggregate&lt;/report&gt;
            &lt;/reports&gt;
          &lt;/reportSet&gt;
        &lt;/reportSets&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem">Run the command to generate site report:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn test site</strong></span>
</pre></div></li><li class="listitem">Click on the <span class="strong"><strong>Checkstyle</strong></span> link in the site report:<div class="mediaobject"><img src="graphics/6124OS_09_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec236"/>How it works...</h2></div></div></div><p>When the <code class="literal">site</code> goal is<a id="id519" class="indexterm"/> run for a multi-module project, it generates the site report for all the modules in addition to the parent module. All the reports are separately generated for each module. However, plugins such as Checkstyle provide an option to generate aggregated report across all the modules of the project. This allows us to get a consolidated view of the Checkstyle violations across all the modules of the project.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip16"/>Tip</h3><p>Other reporting plugins such as FindBugs, PMD, and Cobertura support multi-module reporting. However, not all of them support the aggregation of reports. Other reporting plugins that allow aggregated reporting are Javadocs and JXR.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch09lvl2sec237"/>There's more...</h2></div></div></div><p>Though the site report generated for a multi-module project includes links to each child module, the links will not work correctly, as each module report is in the <code class="literal">target/site</code> folder of the respective module.</p><p>Let's see how we can verify that the modules are correctly linked in the report:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add a <code class="literal">distributionManagement</code> section in the parent pom:<div class="informalexample"><pre class="programlisting">&lt;distributionManagement&gt;
    &lt;site&gt;
      &lt;id&gt;packt&lt;/id&gt;
      &lt;url&gt;file:///C:/fullsite&lt;/url&gt;
    &lt;/site&gt;
  &lt;/distributionManagement&gt;</pre></div></li><li class="listitem">Run the following command to generate site report:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn test site</strong></span>
</pre></div></li><li class="listitem">Run the following command to stage the site:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn site:stage –DstagingDirectory=C:/fullsite</strong></span>
</pre></div></li><li class="listitem">Open the <a id="id520" class="indexterm"/>folder:<div class="mediaobject"><img src="graphics/6124OS_09_05.jpg" alt="There's more..."/></div></li></ol></div><p>You will notice that the site data for both the modules are now subfolders of the project site folder. Opening the index page of <code class="literal">fullsite</code> will allow us to navigate to each module site and ensure that the<a id="id521" class="indexterm"/> links are working:</p><div class="mediaobject"><img src="graphics/6124OS_09_06.jpg" alt="There's more..."/></div></div></div></body></html>