<html><head></head><body><div class="chapter" title="Chapter&#xA0;10.&#xA0;Java Development with Maven"><div class="titlepage"><div><div><h1 class="title"><a id="ch10"/>Chapter 10. Java Development with Maven</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Building a JAR project</li><li class="listitem" style="list-style-type: disc">Generating an executable JAR</li><li class="listitem" style="list-style-type: disc">Generating a JAR of the source code</li><li class="listitem" style="list-style-type: disc">Generating a JAR of the test classes</li><li class="listitem" style="list-style-type: disc">Building a WAR project</li><li class="listitem" style="list-style-type: disc">Building an EAR project</li><li class="listitem" style="list-style-type: disc">Building a pom project</li><li class="listitem" style="list-style-type: disc">Running a web project with Jetty</li><li class="listitem" style="list-style-type: disc">Running a web project with Tomcat</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec94"/>Introduction</h1></div></div></div><p>Maven is primarily a build tool for Java projects. Java projects can generate different types of binaries. Typically, the output of a Java project is a JAR file. For web applications, Java classes combined with other type of files result in a WAR or EAR file as well. Maven provides plugins and lifecycle phases to generate various types of binary artifacts for Java projects.</p></div></div>
<div class="section" title="Building a JAR project"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec95"/>Building a JAR project</h1></div></div></div><p>The default type <a id="id522" class="indexterm"/>of artifact generated by Maven is JAR. If the <code class="literal">packaging</code> element is absent, or specified as <code class="literal">jar</code>, Maven considers it a JAR project. A JAR project combines all the source classes along with the necessary project resources to a single file. This JAR file can be distributed for it to be used elsewhere.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec238"/>Getting ready</h2></div></div></div><p>Maven is set up on your system and is verified for work. To do this, refer to <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec239"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a simple <a id="id523" class="indexterm"/>Maven project, in our case <code class="literal">simple-project</code>.</li><li class="listitem">Verify that the type is absent or set to <code class="literal">jar</code>:<div class="informalexample"><pre class="programlisting">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
  &lt;artifactId&gt;simple-project&lt;/artifactId&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;</pre></div></li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ simple-project ---</strong></span>
<span class="strong"><strong>[INFO] Building jar: C:\Users\Deepa\Documents\apache-maven-cookbook\simple-project\target\simple-project-1.0-SNAPSHOT.jar</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec240"/>How it works...</h2></div></div></div><p>The <code class="literal">package</code> option is part of Maven's default lifecycle. When Maven is run with the <code class="literal">package</code> option, it runs all the phases up to and prior to it, in order. Maven first compiles the project, runs the tests, and then, based on the packaging type, invokes the suitable plugin to package. In our case, as we specified the packaging as <code class="literal">jar</code>, Maven used the <code class="literal">jar</code> goal of the Maven JAR plugin to create a JAR artifact in the <code class="literal">target</code> folder.</p></div><div class="section" title="See also"><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec241"/>See also</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="emphasis"><em>Generating an executable JAR</em></span> recipe in this chapter</li></ul></div></div></div>
<div class="section" title="Generating an executable JAR"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec96"/>Generating an executable JAR</h1></div></div></div><p>The JAR artifact generated by<a id="id524" class="indexterm"/> Maven works well when used as a dependency in another project. However, it cannot be run as an executable without manually specifying the main class and explicitly specifying the dependencies that the project uses in the classpath.</p><p>What if we want to create an executable JAR for the project? This may be useful when the JAR needs to be tested or the project is a simple tool that should be invoked without additional effort.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec242"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a simple <a id="id525" class="indexterm"/>Maven project (<code class="literal">project-with-executable-jar</code>):</li><li class="listitem">Add the following section in the <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">&lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.6&lt;/version&gt;
        &lt;configuration&gt;
          &lt;archive&gt;
            &lt;manifest&gt;
              &lt;addClasspath&gt;true&lt;/addClasspath&gt;
              &lt;mainClass&gt;com.packt.cookbook.App&lt;/mainClass&gt;
            &lt;/manifest&gt;
          &lt;/archive&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Add the plugin configuration to copy over the dependencies to the <code class="literal">target</code> folder:<div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.9&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;copy-dependencies&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;copy-dependencies&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
            &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;
              &lt;excludeArtifactIds&gt;junit&lt;/excludeArtifactIds&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe<a id="id526" class="indexterm"/> the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_10_01.jpg" alt="How to do it..."/></div></li><li class="listitem">Run the generated JAR file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>          java -jar project-with-executable-jar-1.0-SNAPSHOT.jar</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>C:\projects\apache-maven-cookbook\project-with-executable-jar\target&gt;java -jar project-with-executable-jar-1.0-SNAPSHOT.jar</strong></span>
<span class="strong"><strong>06:40:18.437 [main] INFO  com.packt.cookbook.App - Hello World</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec243"/>How it works...</h2></div></div></div><p>We have made the following configurations to the Maven JAR plugin in our<a id="id527" class="indexterm"/> <code class="literal">pom</code> file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Added classpath</strong></span>: This adds all the dependant JARs to the manifest classpath section</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Specified the main class</strong></span>: This information is again updated in the manifest</li></ul></div><p>We also added the <code class="literal">copy-dependencies</code> goal of the Maven Dependency plugin to copy over the required dependencies to the folder where the executable JAR is generated.</p><p>When we then run the executable JAR, it uses the manifest file to determine the main class as well as the dependencies, loads them, and runs.</p><p>Let us look at the <a id="id528" class="indexterm"/>manifest file generated:</p><div class="mediaobject"><img src="graphics/6124OS_10_02.jpg" alt="How it works..."/></div><p>Evidently, for this to work, the executable JAR should be accompanied by the dependencies that it uses. In the <span class="emphasis"><em>Creating an assembly</em></span> recipe in <a class="link" href="ch11.html" title="Chapter 11. Advanced Maven Usage">Chapter 11</a>, <span class="emphasis"><em>Advanced Maven Usage</em></span>, we will learn how to create an assembly with all the dependencies, which can be distributed more easily.</p></div></div>
<div class="section" title="Generating a JAR of the source code"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec97"/>Generating a JAR of the source code</h1></div></div></div><p>For many projects, it is useful to<a id="id529" class="indexterm"/> generate a JAR of the source code along with the artifact. The source thus generated can be imported to IDEs and used for browsing and debugging. Typically, the artifacts of most open source projects are accompanied by sources and Javadocs.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec244"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project for which you want to generate and attach the source code (<code class="literal">project-with-source-code</code>).</li><li class="listitem">Add the following plugin configuration to the <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.4&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;attach-sources&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;jar-no-fork&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Run the following <a id="id530" class="indexterm"/>Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ project-with-source-attached ---</strong></span>
<span class="strong"><strong>[INFO] Building jar: C:\projects\apache-maven-cookbook\project-with-source-attached\target\project-with-source-attached-1.0-SNAPSHOT.jar</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- maven-source-plugin:2.4:jar-no-fork (attach-sources) @ project-with-source-attached ---</strong></span>
<span class="strong"><strong>[INFO] Building jar: C:\projects\apache-maven-cookbook\project-with-source-attached\target\project-with-source-attached-1.0-SNAPSHOT-sources.jar</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
<span class="strong"><strong>[INFO] BUILD SUCCESS</strong></span>
<span class="strong"><strong>[INFO] -----------------------------------------------------------------------</strong></span>
</pre></div></li><li class="listitem">Examine the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_10_03.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec245"/>How it works...</h2></div></div></div><p>We added the Maven <a id="id531" class="indexterm"/>Source plugin to the <code class="literal">pom</code> file. We also configured the plugin to run the <code class="literal">jar-no-fork</code> goal during the package phase. The goal creates a JAR of the project source code and makes it available along with the project artifacts.</p><p>The <code class="literal">jar-no-fork</code> goal<a id="id532" class="indexterm"/> is used to bind the goal to the build lifecycle. To run the plugin and create the JAR independent of the lifecycle, the <code class="literal">jar</code> goal can be used as follows:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn source:jar</strong></span>
</pre></div><p>Subsequent phases (such as <code class="literal">install</code>) install the source artifact along with the project artifact.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec246"/>There's more...</h2></div></div></div><p>What if we want to attach the Javadoc instead of (or in addition to) sources? Let us do this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following plugin to the <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">  &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-javadoc-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.10.1&lt;/version&gt;
      &lt;executions&gt;
        &lt;execution&gt;
          &lt;id&gt;attach-javadocs&lt;/id&gt;
          &lt;phase&gt;package&lt;/phase&gt;
          &lt;goals&gt;
            &lt;goal&gt;jar&lt;/goal&gt;
          &lt;/goals&gt;
        &lt;/execution&gt;
      &lt;/executions&gt;
    &lt;/plugin&gt;</pre></div></li><li class="listitem">Build the aggregator project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_10_04.jpg" alt="There's more..."/></div></li></ol></div><p>Maven runs the <code class="literal">jar</code> goal <a id="id533" class="indexterm"/>of the Maven Javadoc plugin in addition to the <code class="literal">jar-no-fork</code> goal of the Maven Source plugin. Both the JARs are now created, in addition to the project artifacts, and are now available for distribution.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip17"/>Tip</h3><p>Besides sources, the test sources and test Javadocs can also be generated and attached, if relevant to the project.</p></div></div></div></div>
<div class="section" title="Generating a JAR of the test classes"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec98"/>Generating a JAR of the test classes</h1></div></div></div><p>There could be <a id="id534" class="indexterm"/>situations when you would want to use the test classes and resources of a project as a test dependency in another project. This is typically the case in multi-module projects, where a module depends on another module. There could be utility code in the test classes of a module that can be reused in another module.</p><p>One way to achieve this would be by creating a separate project to hold these classes. However, that is cumbersome and may be confusing as well.</p><p>Maven provides another way to achieve this.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec247"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project for which you want to create a test JAR (<code class="literal">project-with-test-jar</code>).</li><li class="listitem">Add the following plugin configuration to the <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.5&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;test-jar&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
       &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Run the <a id="id535" class="indexterm"/>following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-jar-plugin:2.5:jar (default-jar) @ project-with-test-jar ---</strong></span>
<span class="strong"><strong>[INFO] Building jar: C:\projects\apache-maven-cookbook\project-with-test-jar\tar</strong></span>
<span class="strong"><strong>get\project-with-test-jar-1.0-SNAPSHOT.jar</strong></span>
<span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- maven-jar-plugin:2.5:test-jar (default) @ project-with-test-jar ---</strong></span>
<span class="strong"><strong>[INFO] Building jar: C:\projects\apache-maven-cookbook\project-with-test-jar\tar</strong></span>
<span class="strong"><strong>get\project-with-test-jar-1.0-SNAPSHOT-tests.jar</strong></span>
</pre></div></li><li class="listitem">Examine the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_10_05.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec248"/>How it works...</h2></div></div></div><p>We specified a <code class="literal">test-jar</code> goal to the Maven JAR plugin. This asks Maven to generate a JAR of test classes and <a id="id536" class="indexterm"/>resources. This JAR can be installed along with the project artifact. It can also be specified as a dependency in another project as follows:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;project-with-test-jar&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;type&gt;test-jar&lt;/type&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip18"/>Tip</h3><p>One thing to note though is the test JAR does not bring its transitive test-scoped dependencies with it if you add a dependency on this. These dependencies, if required, need to be specified by hand.</p></div></div></div></div>
<div class="section" title="Building a WAR project"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec99"/>Building a WAR project</h1></div></div></div><p>So far, we have been building <a id="id537" class="indexterm"/>projects that generate a JAR artifact. When it comes to web applications, we typically create WAR artifacts. Maven supports the building of WAR artifacts. The packaging type <code class="literal">.war</code> indicates to Maven that it is a WAR artifact. Maven automatically invokes the corresponding lifecycle bindings.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec249"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following command from the command prompt:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn archetype:generate –DinteractiveMode=false  -DgroupId=com.packt.cookbook -DartifactId=simple-webapp -DarchetypeArtifactId=maven-archetype-webapp </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_10_06.jpg" alt="How to do it..."/></div></li><li class="listitem">Open the <a id="id538" class="indexterm"/>created <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
  &lt;artifactId&gt;simple-webapp&lt;/artifactId&gt;
  &lt;packaging&gt;war&lt;/packaging&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;name&gt;simple-webapp Maven Webapp&lt;/name&gt;
  &lt;url&gt;http://maven.apache.org&lt;/url&gt;
  &lt;build&gt;
    &lt;finalName&gt;simple-webapp&lt;/finalName&gt;
  &lt;/build&gt;</pre></div></li><li class="listitem">Run the command to build the project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_10_07.jpg" alt="How to do it..."/></div></li><li class="listitem">Check the <code class="literal">target</code> folder:<div class="informalexample"><pre class="programlisting">[Directory of C:\projects\apache-maven-cookbook\simple-webapp\target

18-12-2014  20:52    &lt;DIR&gt;          .
18-12-2014  20:52    &lt;DIR&gt;          ..
18-12-2014  20:52    &lt;DIR&gt;          classes
18-12-2014  20:52    &lt;DIR&gt;          maven-archiver
18-12-2014  20:52    &lt;DIR&gt;          simple-webapp
18-12-2014  20:52             2,226 simple-webapp.war</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec250"/>How it works...</h2></div></div></div><p>We used the Maven <a id="id539" class="indexterm"/>Archetype plugin to bootstrap a simple web project. This generated a <code class="literal">pom</code> file along with other contents for a web application. When you examine the <code class="literal">pom</code> file, you will notice that the <code class="literal">packaging</code> type is set to <code class="literal">war</code>.</p><p>Maven uses this information to invoke the <code class="literal">war</code> goal of the Maven plugin to create a WAR of the project contents.</p><p>Also, observe that we specified the <code class="literal">finalName</code> element. Maven uses this to create the name of the WAR artifact. In the absence of this element, Maven uses the default name, which would have been <code class="literal">simple-webapp-1.0-SNAPSHOT.war</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec251"/>There's more...</h2></div></div></div><p>The Maven WAR plugin<a id="id540" class="indexterm"/> can be used in many ways. The default option creates a WAR file. During development, we would want to speed up things by generating the WAR file in exploded form. To do this, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">simple-webapp</code> project.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn war:exploded</strong></span>
</pre></div></li><li class="listitem">Examine the content of the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_10_08.jpg" alt="There's more..."/></div></li></ol></div></div></div>
<div class="section" title="Building an EAR project"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec100"/>Building an EAR project</h1></div></div></div><p>Maven provides support to<a id="id541" class="indexterm"/> generate Java <span class="strong"><strong>EE Enterprise Archive</strong></span> (<span class="strong"><strong>EAR</strong></span>) files. These can be deployed in application servers such as JBoss, WebLogic, and WebSphere.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec252"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the following <a id="id542" class="indexterm"/>command from the command prompt:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn archetype:generate -DgroupId=com.packt.cookbook -DartifactId=simple-ear -DarchetypeArtifactId=wildfly-javaee7-webapp-ear-archetype -DarchetypeGroupId=org.wildfly.archetype -DinteractiveMode=false</strong></span>
</pre></div></li><li class="listitem">Observe the result:<div class="mediaobject"><img src="graphics/6124OS_10_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Build the <a id="id543" class="indexterm"/>generated project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Observe the generated output:<div class="mediaobject"><img src="graphics/6124OS_10_10.jpg" alt="How to do it..."/></div></li><li class="listitem">Open the <code class="literal">target</code> folder:<div class="mediaobject"><img src="graphics/6124OS_10_11.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec253"/>How it works...</h2></div></div></div><p>We used the Maven<a id="id544" class="indexterm"/> Archetype plugin to bootstrap a simple EAR project. It generated a multi-module project, which has an EJB module, web module, and a EAR module along with the aggregate pom file. When you examine the <code class="literal">pom</code> file of the EAR module, you will notice that the <code class="literal">packaging</code> type is set to <code class="literal">ear</code>.</p><p>Once built, Maven builds all the modules. In the EAR module, it uses the packaging information to invoke the <code class="literal">ear</code> goal of the Maven EAR plugin to create a EAR of the project contents.</p></div></div>
<div class="section" title="Building a pom project"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec101"/>Building a pom project</h1></div></div></div><p>There are many reasons why you <a id="id545" class="indexterm"/>may want to make a pom file available as an artifact. One reason is the aggregate project. An aggregate project must have the <code class="literal">pom</code> packaging type. Another reason could be a pom, which can be imported as a dependency. Whatever the reason, Maven provides support to build a pom project.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec254"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a simple pom project (<code class="literal">simple-pom-project</code>).</li><li class="listitem">Observe the <code class="literal">packaging</code> type:<div class="informalexample"><pre class="programlisting">&lt;groupId&gt;com.packt.cookbook&lt;/groupId&gt;
    &lt;artifactId&gt;simple-pom-project&lt;/artifactId&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;description&gt;Simple pom project&lt;/description&gt;</pre></div></li><li class="listitem">Build the project:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div><p>Note that only the <code class="literal">clean</code> goal is run.</p></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>    mvn clean install </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_10_12.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec255"/>How it works...</h2></div></div></div><p>The following are the <a id="id546" class="indexterm"/>default bindings for the <code class="literal">pom</code> packaging type:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">package: site:attach-descriptor</code>: This attaches a descriptor to the site report, if applicable</li><li class="listitem" style="list-style-type: disc"><code class="literal">install: install:install</code>: This installs the project in the local repository</li><li class="listitem" style="list-style-type: disc"><code class="literal">deploy: deploy:deploy</code>: This deploys the project to the remote repository</li></ul></div><p>As we can see, Maven does not run any other goals for the <code class="literal">pom</code> packaging type. However, if it sees <code class="literal">module</code> elements, it invokes the specified Maven goals on all the defined modules.</p><p>Also, various configurations, including <code class="literal">pluginManagement</code> and <code class="literal">dependencyManagement</code>, get inherited by all of the child projects.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec256"/>There's more...</h2></div></div></div><p>What if you had a reason to compile <a id="id547" class="indexterm"/>some source files or run some tests even though the packaging type is <code class="literal">pom</code>? This may not be a usual scenario, but it can be done by explicitly invoking the relevant plugin goals in the following way:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the simple pom project (<code class="literal">simple-pom-project</code>).</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean compiler:compile compiler:testCompile surefire:test jar:jar</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_10_13.jpg" alt="There's more..."/></div></li></ol></div><p>We now explicitly invoke the following goals:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">compiler:compile</code>: This compiles the source files</li><li class="listitem" style="list-style-type: disc"><code class="literal">compiler:testCompile</code>: This compiles test files</li><li class="listitem" style="list-style-type: disc"><code class="literal">surefire:test</code>: This runs tests</li><li class="listitem" style="list-style-type: disc"><code class="literal">jar:jar</code>: This creates a JAR artifact</li></ul></div><p>Maven does not prevent us from doing this.</p></div></div>
<div class="section" title="Running a web project with Jetty"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec102"/>Running a web project with Jetty</h1></div></div></div><p>When developing web<a id="id548" class="indexterm"/> applications, it is good to have a quick way to check <a id="id549" class="indexterm"/>if the application deploys successfully without errors. IDEs allow users to hot-deploy applications. Maven provides a mechanism to quickly run the project using Jetty. Jetty is a popular open source application server that can be used to deploy web projects. The Maven Jetty plugin allows applications to be deployed to Jetty and runs them as part of the Maven build process.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec257"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a simple web project (<code class="literal">simple-web-project</code>).</li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn org.eclipse.jetty:jetty-maven-plugin:run</strong></span>
</pre></div></li><li class="listitem">Observe the result:<div class="mediaobject"><img src="graphics/6124OS_10_14.jpg" alt="How to do it..."/></div></li><li class="listitem">Access the web<a id="id550" class="indexterm"/> application from the browser by going <a id="id551" class="indexterm"/>to <code class="literal">http://localhost:8080</code>.<div class="mediaobject"><img src="graphics/6124OS_10_15.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec258"/>How it works...</h2></div></div></div><p>The Maven Jetty<a id="id552" class="indexterm"/> plugin allows web applications to be deployed and tested <a id="id553" class="indexterm"/>using Jetty. The <code class="literal">run</code> goal is bound to the <code class="literal">package</code> phase. Maven runs all the phases prior to it. Jetty deploys the webapp from its sources; the webapp does not have to be built into a WAR. It looks for the relevant parts of the web application in the default Maven locations. Here are some instances:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">resources</code> in <code class="literal">src/main/webapp</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">classes</code> in <code class="literal">target/classes</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">web.xml</code> in <code class="literal">src/main/webapp/WEB-INF</code></li></ul></div><p>Jetty uses default values to start the server.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip19"/>Tip</h3><p>As Jetty is not an official Maven plugin, we have explicitly specified <code class="literal">groupId</code> (<code class="literal">org.eclipse.jetty</code>) and <code class="literal">artifactId</code> (<code class="literal">jetty-maven-plugin</code>) instead of the short plugin prefix. To use the short plugin prefix, add the following in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;pluginGroup&gt;org.eclipse.jetty&lt;/pluginGroup&gt;</pre></div><p>Then, Maven can be invoked as follows:</p><div class="informalexample"><pre class="programlisting">mvn jetty:run</pre></div></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec259"/>There's more...</h2></div></div></div><p>The Maven Jetty plugin provides several goals and configurations to help develop web applications.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the WAR file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn jetty:run-war</strong></span>
</pre></div><p>Jetty now builds the WAR file and then runs it:</p><div class="mediaobject"><img src="graphics/6124OS_10_16.jpg" alt="There's more..."/></div></li><li class="listitem">Run the exploded WAR file:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn jetty:run-exploded</strong></span>
</pre></div><p>Jetty now builds the WAR file, explodes it, and then runs it:</p><div class="mediaobject"><img src="graphics/6124OS_10_17.jpg" alt="There's more..."/></div></li></ol></div><p>There are some <a id="id554" class="indexterm"/>other <a id="id555" class="indexterm"/>goals that can be used as well:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">jetty:deploy-war</code>: This deploys an existing WAR file without building it</li><li class="listitem" style="list-style-type: disc"><code class="literal">jetty:start</code>: This starts the Jetty server</li><li class="listitem" style="list-style-type: disc"><code class="literal">jetty:stop</code>: This stops the Jetty server</li><li class="listitem" style="list-style-type: disc"><code class="literal">jetty:run-forked</code>: This runs the Jetty server in a Java virtual machine process different from Maven</li></ul></div></div></div>
<div class="section" title="Running a web project with Tomcat"><div class="titlepage"><div><div><h1 class="title"><a id="ch10lvl1sec103"/>Running a web project with Tomcat</h1></div></div></div><p>Tomcat is a<a id="id556" class="indexterm"/> popular <a id="id557" class="indexterm"/>open source application server. The Maven Tomcat plugin supports the ability to build and deploy Maven projects in Tomcat. In fact, there are two Maven Tomcat plugins, one for Tomcat 6 and another for Tomcat 7.</p><p>Let us look at how to run a web project with <a id="id558" class="indexterm"/>Tomcat 7. The steps will be identical<a id="id559" class="indexterm"/> for Tomcat 6, except that the plugin would be <code class="literal">tomcat6-maven-plugin</code> instead of <code class="literal">tomcat7-maven-plugin</code>, and the plugin prefix would be <code class="literal">tomcat6</code> instead of <code class="literal">tomcat7</code>.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec260"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a simple web project (<code class="literal">simple-web-project</code>).</li><li class="listitem">Run the following Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn org.apache.tomcat.maven:tomcat7-maven-plugin:run</strong></span>
</pre></div></li><li class="listitem">Observe the result:<div class="mediaobject"><img src="graphics/6124OS_10_18.jpg" alt="How to do it..."/></div></li><li class="listitem">Browse to the deployed webapp by visiting <code class="literal">http://localhost:8080/simple-webapp</code>:<div class="mediaobject"><img src="graphics/6124OS_10_19.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec261"/>How it works...</h2></div></div></div><p>The Maven Tomcat plugin <a id="id560" class="indexterm"/>allows web applications to be deployed and tested <a id="id561" class="indexterm"/>using Apache Tomcat. The <code class="literal">run</code> goal is bound to the <code class="literal">package</code> phase. Maven runs all the phases prior to it.</p><p>Tomcat uses default values to start the server.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip21"/>Tip</h3><p>As this is not an official Maven plugin, we have explicitly specified the <code class="literal">groupId</code> (<code class="literal">org.apache.tomcat.maven</code>) and the <code class="literal">artifactId</code> (<code class="literal">tomcat7-maven-plugin</code>) instead of the short plugin prefix. To use the short plugin prefix, add the following in the settings file:</p><div class="informalexample"><pre class="programlisting">&lt;pluginGroup&gt;org.apache.tomcat.maven&lt;/pluginGroup&gt;</pre></div><p>Then Maven can be invoked as follows:</p><div class="informalexample"><pre class="programlisting">mvn tomcat7:run</pre></div></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch10lvl2sec262"/>There's more...</h2></div></div></div><p>The Maven Tomcat7 plugin also supports goals to start and stop Tomcat, which can be used when running integration tests.</p><p>It also supports the creation of an executable JAR using embedded Tomcat. Let us see how to do this:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the web project for which you want to create an executable JAR (<code class="literal">project-with-executable-webapp</code>).</li><li class="listitem">Add the following plugin and configuration:<div class="informalexample"><pre class="programlisting">     &lt;plugins&gt;
       &lt;plugin&gt;
        &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
        &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;tomcat-run&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;exec-war-only&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;configuration&gt;
              &lt;path&gt;/&lt;/path&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li><li class="listitem">Run the JAR <a id="id562" class="indexterm"/>created in the <code class="literal">target</code> folder:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>java –jar project-with-executable-webapp-1.0-SNAPSHOT-war-exec.jar</strong></span>
</pre></div></li><li class="listitem">Observe <a id="id563" class="indexterm"/>the output:<div class="mediaobject"><img src="graphics/6124OS_10_20.jpg" alt="There's more..."/></div></li></ol></div><p>What we have now is a distributable web application using embedded Tomcat.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip23"/>Tip</h3><p>There is a bug due to which we need to use version 2.1 of the plugin rather than 2.2 for this to work.</p></div></div></div></div></body></html>