<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Exploring RemoteWebDriver</h1>
                </header>
            
            <article>
                
<p>So far, we have created our test cases and tried to execute them on various browsers. All of these tests were executed against the browsers that were installed on a local machine where the test cases reside. This may not be possible at all times. There is a high possibility that you may be working on Mac or Linux, but want to execute your tests on IE on a Windows machine. In this chapter, we will learn about the following topics:</p>
<ul>
<li>Executing test cases on a remote machine using <kbd>RemoteWebDriver</kbd></li>
<li>A detailed explanation of the JSON wire protocol</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introducing RemoteWebDriver</h1>
                </header>
            
            <article>
                
<p><kbd>RemoteWebDriver</kbd> is an implementation class of the <kbd>WebDriver</kbd> interface that a test-script developer can use to execute their test scripts via the <kbd>Selenium Standalone</kbd> server on a remote machine. There are two parts to <kbd>RemoteWebDriver</kbd>: a server and a client. Before we start working with them, let's rewind and see what we've been doing.</p>
<p>The following diagram explains what we've done so far:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/30719c03-0e04-4716-9be2-69f48bed2798.png" style=""/></div>
<p>The test script using <span class="packt_screen">WebDriver client</span> libraries, <span class="packt_screen">Chrome Driver</span> (or IE Driver or Gecko Driver for Firefox), and Chrome browser (or IE browser or Firefox browser) is sitting on the same machine. The browser is loading the web application, which may or may not be hosted remotely; anyway, this is outside the scope of our discussion. We will discuss different scenarios of test-script execution, as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/9f9b2309-f26b-4929-ad9b-cd6e360623e4.png" style=""/></div>
<p class="mce-root"/>
<p>The test script is located on a local machine, while the browsers are installed on a remote machine. In this scenario, <kbd>RemoteWebDriver</kbd> comes into the picture. As mentioned earlier, there are two components associated with <kbd>RemoteWebDriver</kbd>: the server and the client. Let's start with the <kbd>Selenium Standalone server</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding Selenium Standalone Server</h1>
                </header>
            
            <article>
                
<p><kbd>Selenium Standalone Server</kbd> is a component that listens on a port for various requests from a <kbd>RemoteWebDriver</kbd> client. Once it receives the requests, it forwards them to any of the following: Chrome Driver, IE Driver, or Gecko Driver for Firefox, whichever is requested by the <kbd>RemoteWebDriver</kbd> client.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Downloading Selenium Standalone Server</h1>
                </header>
            
            <article>
                
<p>Let's download <kbd>Selenium Standalone Server</kbd> and start running it. You can download it from <a href="https://www.seleniumhq.org/download/">https://www.seleniumhq.org/download/</a>, but, for our purposes, let's download a specific version of it, as we are using WebDriver Version 3.12.0.  This server JAR should be downloaded to the remote machine on which the browsers are located. Also, make sure the remote machine has Java Runtime installed on it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running the server</h1>
                </header>
            
            <article>
                
<p>Open your command-line tool on the remote machine and navigate to the location where you have downloaded the JAR file. Now, to start Selenium Standalone Server, execute the following command:</p>
<pre>java -jar selenium-server-standalone-3.12.0.jar</pre>
<p>The following screenshot shows what you should see in your console:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e9117392-b178-47a6-8963-4e363111fbf2.png" style=""/></div>
<p>Now the server has started and is listening on the <kbd>&lt;remote-machine-ip&gt;:4444</kbd> address for remote connections from the <kbd>RemoteWebDriver</kbd> client. The previously seen image (the second image in the <em>Introducing</em> <em>RemoteWebDriver</em> section) will appear as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/d7c3976d-4f18-41cf-aad9-7ae16e47f3c0.png" style=""/></div>
<p class="mce-root"/>
<p>On the remote machine, Selenium Standalone Server will interface between the test script and the browsers, as shown in the preceding diagram. The test script will first establish a connection with Selenium Standalone Server that will forward the commands to the browser installed on the remote machine.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding the RemoteWebDriver client</h1>
                </header>
            
            <article>
                
<p>Now that we have our Selenium Standalone server up and running, it's time for us to create the <kbd>RemoteWebDriver</kbd> client. Fortunately, we don't have to do much to create a <kbd>RemoteWebDriver</kbd> client. It's nothing but the language-binding client libraries that serve as a <kbd>RemoteWebDriver</kbd> client. <kbd>RemoteWebDriver</kbd> will translate the test-script requests or commands to JSON payload and send them across to the <kbd>RemoteWebDriver</kbd> server using the JSON wire protocol.</p>
<p>When you execute your tests locally, the WebDriver client libraries talk to the Chrome Driver, IE Driver, or Gecko Driver directly. Now when you try to execute your tests remotely, the WebDriver client libraries talk to <kbd>Selenium Standalone Server</kbd> and the server talks to either the Chrome Driver, the IE Driver, or the Gecko Driver for Firefox requested by the test script, using the <kbd>DesiredCapabilities</kbd> class. We will explore the <kbd>DesiredCapabilities</kbd> class in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Converting an existing test script to use the RemoteWebDriver server</h1>
                </header>
            
            <article>
                
<p>Let's take a test script that we have executed locally; that is, where the test scripts and the browser were on the same machine:</p>
<pre><span>@BeforeClass<br/></span><span>public void </span><span>setup</span>() {<br/><br/>    System.<span>setProperty</span>(<span>"webdriver.chrome.driver"</span><span>,<br/></span><span>            </span><span>"./src/test/resources/drivers/chromedriver"</span>)<span>;<br/></span><span>    </span><span>driver </span>= <span>new </span>ChromeDriver()<span>;<br/></span><span><br/></span>}</pre>
<p class="mce-root"/>
<p>The preceding test script creates an instance of Chrome Driver and launches the Chrome browser. Now, let's try to convert this test script to use <kbd>Selenium Standalone Server</kbd> that we started earlier. Before we do that, let's see the constructor of <kbd>RemoteWebDriver</kbd>, which is as follows:</p>
<pre>RemoteWebDriver(java.net.URL remoteAddress, Capabilities desiredCapabilities)</pre>
<p>The input parameters for the constructor include the address (hostname or IP) of <kbd>Selenium Standalone Server</kbd> running on the remote machine and the desired capabilities required for running the test (for example name of the browser and/or operating system). We will see these desired capabilities shortly.</p>
<p>Now, let's modify the test script to use <kbd>RemoteWebDriver</kbd>. Replace <kbd>WebDriver driver = new ChromeDriver();</kbd> with the following code:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() <span>throws </span>MalformedURLException {<br/><br/>   <strong> DesiredCapabilities caps = <span>new </span>DesiredCapabilities()<span>;<br/></span><span>    </span>caps.setBrowserName(<span>"chrome"</span>)<span>;<br/></span><span><br/></span><span>    </span><span>driver </span>= <span>new </span>RemoteWebDriver(<span>new </span>URL(<span>"http://10.172.10.1:4444/wd/hub"</span>)<span>, </span>caps)<span>;<br/></span><span>    </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span></strong><span><br/></span>}</pre>
<p>We have created a RemoteWebDriver instance that tries to connect to <kbd>http://10.172.10.1:4444/wd/hub</kbd>, where <kbd>Selenium Standalone Server</kbd> is running and listening for requests. Having done that, we also need to specify which browser your test case should get executed on. This can be done using the <kbd>DesiredCapabilities</kbd> instance.</p>
<div class="packt_infobox">For this example, the IP used is 10.172.10.1. However, in your case, it will be different. You need to obtain the IP of the machine where the Selenium Standalone Server is running and replace the example IP used in this book.</div>
<p>Before running tests, we need to restart the Selenium Standalone Server by specifying the path of ChromeDriver:</p>
<pre>java -jar -Dwebdriver.chrome.driver=chromedriver selenium-server-standalone-3.12.0.jar</pre>
<p>Running the following test with <kbd>RemoteWebDriver</kbd> will launch the Chrome browser and execute your test case on it. So the modified test case will look as follows:</p>
<pre><span>public class </span>SearchTest {<br/><br/>    WebDriver <span>driver</span><span>;<br/></span><span><br/></span><span>    </span><span>@BeforeMethod<br/></span><span>    </span><span>public void </span><span>setup</span>() <span>throws </span>MalformedURLException {<br/><br/>        <strong>DesiredCapabilities caps = <span>new </span>DesiredCapabilities()<span>;<br/></span><span>        </span>caps.setBrowserName(<span>"chrome"</span>)<span>;<br/></span><span><br/></span><span>        </span><span>driver </span>= <span>new </span>RemoteWebDriver(<span>new </span>URL(<span>"http://10.172.10.1:4444/wd/hub"</span>)<span>, </span>caps)<span>;<br/></span><span>        </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)</strong><span><strong>;</strong><br/></span><span><br/></span><span>    </span>}<br/><br/>    <span>@Test<br/></span><span>    </span><span>public void </span><span>searchProduct</span>() {<br/><br/>        <span>// find search box and enter search string<br/></span><span>        </span>WebElement searchBox = <span>driver</span>.findElement(By.<span>name</span>(<span>"q"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchBox.sendKeys(<span>"Phones"</span>)<span>;<br/></span><span><br/></span><span>        </span>WebElement searchButton =<br/>                <span>driver</span>.findElement(By.<span>className</span>(<span>"search-button"</span>))<span>;<br/></span><span><br/></span><span>        </span>searchButton.click()<span>;<br/></span><span><br/></span><span>        </span><span>assertThat</span>(<span>driver</span>.getTitle())<br/>                .isEqualTo(<span>"Search results for: 'Phones'"</span>)<span>;<br/></span><span>    </span>}<br/><br/>    <span>@AfterMethod<br/></span><span>    </span><span>public void </span><span>tearDown</span>() {<br/>        <span>driver</span>.quit()<span>;<br/></span><span>    </span>}<br/>}<br/><br/></pre>
<p class="mce-root"/>
<p>Now execute this test script from your local machine to establish a connection between the <kbd>RemoteWebDriver</kbd> client and <kbd>Selenium Standalone Server</kbd>. The Server will launch the Chrome browser. The following is the output you will see in the console where the Server is running:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/6b54e3cf-5a6c-4f61-abac-8d6b778165a7.png" style=""/></div>
<p>It says that a new session with the desired capabilities is being created. Once the session is established, a session ID will be printed to the console. At any point in time, you can view all of the sessions that are established with <kbd>Selenium Standalone Server</kbd> by navigating to the host or IP of the machine where the Selenium server is running <kbd>http://&lt;hostnameOrIP&gt;:4444/wd/hub</kbd>.</p>
<div class="packt_infobox">The Selenium Standalone Server, by default, listens to port number 4444. We can change the default port by passing the <kbd>-port</kbd> argument.</div>
<p>It will give the entire list of sessions that the server is currently handling. The screenshot of this is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/cd32ba9e-6810-4a76-8226-ca4ddd3f1974.png"/></div>
<p class="mce-root"/>
<p class="mce-root"/>
<p>This is a very basic portal that lets the test-script developer see all of the sessions created by the server and perform some basic operations on it, such as terminating a session, taking a screenshot of a session, loading a script to a session, and seeing all of the desired capabilities of a session. The following screenshot shows all of the default desired capabilities of our current session.</p>
<p>You can see the popup by hovering over the <strong>Capabilities</strong> link, as shown in the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/ff1d725e-48d5-4db2-9690-69e0f4cdb72e.png"/></div>
<p>Those are the default desired capabilities that are set implicitly by the server for this session. Now we have successfully established a connection between our test script, which is using a <kbd>RemoteWebDriver</kbd> client on one machine, and the Selenium Standalone Server on another machine. The original diagram of running the test scripts remotely is as follows:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/69ede412-cc68-453c-894d-8d89bc552a16.png" style=""/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using RemoteWebDriver for Firefox</h1>
                </header>
            
            <article>
                
<p>Using the Firefox browser to execute our test scripts is similar to using the Chrome browser, except for a couple of variations in how <kbd>GeckoDriver</kbd> is launched.</p>
<p>Let's see this by changing the test script that we used for the Chrome browser to the following script, using <kbd>"firefox"</kbd>:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() <span>throws </span>MalformedURLException {<br/><br/>    DesiredCapabilities caps = <span>new </span>DesiredCapabilities()<span>;<br/></span><strong><span>    </span>caps.setBrowserName(<span>"firefox"</span>)<span>;<br/></span><span>    </span>caps.setCapability(<span>"marionette"</span><span>, true</span>)</strong><span><strong>;</strong><br/></span><span><br/></span><span>    </span><span>driver </span>= <span>new </span>RemoteWebDriver(<span>new </span>URL(<span>"http://10.172.10.1:4444/wd/hub"</span>)<span>, </span>caps)<span>;<br/></span><span>    </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span><br/></span>}</pre>
<p>Before you try to execute this code, restart <kbd>Selenium Standalone Server</kbd> to use <kbd>GeckoDriver</kbd>:</p>
<pre class="mce-root">java -jar -Dwebdriver.gecko.driver=geckodriver selenium-server-standalone-3.12.0.jar</pre>
<p><span>Try executing the preceding test script now, and you should see the Firefox browser getting launched and executing your test commands. <kbd>Selenium Standalone Server</kbd></span> has started <kbd>GeckoDriver</kbd>, created a connection to it, and started executing the test-script commands. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using RemoteWebDriver for Internet Explorer</h1>
                </header>
            
            <article>
                
<p>For executing tests on the Internet Explorer driver, the steps are similar to what we did with the Chrome and Firefox browsers. </p>
<p>Let's see this by changing the test script that we used for the Chrome or Firefox browser to the following script, using<span> </span><kbd>"internet explorer"</kbd>:</p>
<pre><span>@BeforeMethod<br/></span><span>public void </span><span>setup</span>() <span>throws </span>MalformedURLException {<br/><br/>    DesiredCapabilities caps = <span>new </span>DesiredCapabilities()<span>;<br/></span><strong><span>    </span>caps.setBrowserName(<span>"internet explorer"</span>)<span>;<br/></span></strong><span><br/></span><span>    </span><span>driver </span>= <span>new </span>RemoteWebDriver(<span>new </span>URL(<span>"http://127.0.0.1:4444/wd/hub"</span>)<span>, </span>caps)<span>;<br/></span><span>    </span><span>driver</span>.get(<span>"http://demo-store.seleniumacademy.com/"</span>)<span>;<br/></span><span><br/></span>}</pre>
<p class="mce-root"/>
<p>Before you try to execute this code, restart<span> </span><kbd>Selenium Standalone Server</kbd><span> </span>to use<span> </span><kbd>InternetExplorerDriver</kbd>:</p>
<pre>java -jar -Dwebdriver.ie.driver=InternetExplorerDriver.exe selenium-server-standalone-3.12.0.jar</pre>
<p><span>Try executing the preceding test script now, and you should see the Internet Explorer browser getting launched and executing your test commands. <kbd>Selenium Standalone Server</kbd></span><span> </span>has started<span> </span><kbd>InternetExplorerDriver</kbd>, created a connection with it, and started executing the test-script commands.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Understanding the JSON wire protocol                                                            </h1>
                </header>
            
            <article>
                
<p>In many places, we have mentioned that WebDriver uses the JSON wire protocol to communicate between client libraries and different driver (that is, Chrome Driver, IE Driver, Gecko Driver, and so on) implementations. In this section, we will see exactly what it is and which different JSON APIs a client library should implement to talk to the drivers.</p>
<p><strong>JavaScript Object Notation (JSON)</strong> is used to represent objects with complex data structures. It is used primarily to transfer data between a server and a client on the web. It has become an industry standard for various REST web services, offering a strong alternative to XML.</p>
<p>A sample JSON file, saved as a <kbd>.json</kbd> file, will look as follows:</p>
<pre>{ <br/>   "firstname":"John",<br/>   "lastname":"Doe",<br/>   "address":{ <br/>      "streetnumber":"678",<br/>      "street":"Victoria Street",<br/>      "city":"Richmond",<br/>      "state":"Victoria",<br/>      "country":"Australia"<br/>   } "phone":"+61470315430"<br/>}</pre>
<p class="mce-root"/>
<p class="mce-root"/>
<p>A client can send a person's details to a server in the preceding JSON format, which the server can parse, and then create an instance of the person object for use in its execution. Later, the response can be sent back by the server to the client in the JSON format, the data of which the client can use to create an object of a class. This process of converting an object's data into the JSON format and JSON-formatted data into an object is called <strong>serialization</strong> and <strong>de-serialization</strong>, respectively, which is quite common in REST-based web services.</p>
<p>WebDriver uses the same approach to communicate between client libraries (language bindings) and drivers, such as Firefox Driver, IE Driver, and Chrome Driver. Similarly, the <kbd>RemoteWebDriver</kbd> client and <kbd>Selenium Standalone Server</kbd> use the JSON wire protocol to communicate among themselves. But all of these drivers use it under the hood, hiding all the implementation details from us and making our lives simpler. The list of APIs for various actions that we can take on a web page is as follows:</p>
<pre>/status /session /sessions /session/:sessionId /session/:sessionId/timeouts /session/:sessionId/timeouts/async_script /session/:sessionId/timeouts/implicit_wait /session/:sessionId/window_handle /session/:sessionId/window_handles /session/:sessionId/url /session/:sessionId/forward /session/:sessionId/back /session/:sessionId/refresh /session/:sessionId/execute /session/:sessionId/execute_async /session/:sessionId/screenshot /session/:sessionId/ime/available_engines /session/:sessionId/ime/active_engine<br/>. . .<br/>. . . /session/:sessionId/touch/flick /session/:sessionId/touch/flick /session/:sessionId/location /session/:sessionId/local_storage /session/:sessionId/local_storage/key/:key /session/:sessionId/local_storage/size /session/:sessionId/session_storage /session/:sessionId/session_storage/key/:key /session/:sessionId/session_storage/size /session/:sessionId/log /session/:sessionId/log/types /session/:sessionId/application_cache/status</pre>
<p>The complete documentation is available at <a href="https://github.com/SeleniumHQ/selenium/wiki/JsonWireProtocol">https://code.google.com/p/selenium/wiki/JsonWireProtocol</a>. The client libraries will translate your test-script commands into the JSON format and send the requests to the appropriate WebDriver API. The WebDriver will parse these requests and take necessary actions on the web page. Let's see that as an example. Suppose your test script has this code: <kbd>driver.get("http://www.google.com");</kbd>.</p>
<p>The client library will translate that into JSON by building a JSON payload (JSON document) and post the request to the appropriate API. In this case, the API that handles the <kbd>driver. get(URL)</kbd> method is <kbd>/session/:sessionId/url</kbd>.</p>
<p>The following code shows what happens in the client library layer behind the scenes before the request is sent to the driver; the request is sent to the RemoteWebDriver server running on 10.172.10.1:4444:</p>
<pre>HttpClient <span>httpClient </span>= <span>new </span>DefaultHttpClient()<span>;<br/></span>HttpPost <span>postMethod </span>= <span>new </span>HttpPost(<span>"http://10.172.10.1:4444/wd/hub/session/"</span>+sessionId+<span>"/url"</span>)<span>;<br/></span>JSONObject <span>jo</span>=<span>new </span>JSONObject()<span>;<br/></span>jo.put(<span>"url"</span><span>,</span><span>"http://www.google.com"</span>)<span>;<br/></span>StringEntity input = <span>new </span>StringEntity(jo.toString())<span>;<br/></span>input.setContentEncoding(<span>"UTF-8"</span>)<span>;<br/></span>input.setContentEncoding(<span>new </span>BasicHeader(HTTP.CONTENT_TYPE<span>, </span><span>"application/json"</span>))<span>;<br/></span>postMethod.setEntity(input)<span>;<br/></span>HttpResponse response = httpClient.execute(postMethod)<span>;</span></pre>
<p><kbd>Selenium Standalone Server</kbd> will forward that request to the driver; the driver will execute the test-script commands that arrive in the preceding format on the web application, under the test that is loaded in the browser.</p>
<p>The following diagram shows the dataflow at each stage:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/533c2ac8-3e20-4933-b012-db2dfac4bc58.png" style=""/></div>
<p>The preceding diagram shows the following:</p>
<ul>
<li>The first stage is communication between the test script and the client library. The data or command that flows between them is a call to the <kbd>get()</kbd> method of the driver: <kbd>driver.get("http://www.google.com");</kbd>.</li>
<li>The client library, as soon as it receives the preceding command, will convert it into the JSON format and communicate with <kbd>Selenium Standalone Server.</kbd></li>
<li>Next, <kbd>Selenium Standalone Server</kbd> forwards the JSON payload request to the Chrome Driver. </li>
<li>The Chrome Driver will communicate with the Chrome browser natively, and then the browser will send a request for the asked URL to load.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we learned about <kbd>RemoteWebDriver</kbd> and how to execute test scripts remotely on a different machine using <kbd>Selenium Standalone Server</kbd> and the <kbd>RemoteWebDriver</kbd> client. This enables Selenium WebDriver tests to be executed on remote machines with different browser and OS combinations. We also looked at the JSON wire protocol and how client libraries work behind the scenes to send and receive requests and responses to and from the drivers. </p>
<p>In the next <a href="e05d7bab-6892-4e1f-b54c-2e9866021371.xhtml"/>chapter, we will extend the usage of Selenium Standalone Server and RemoteWebDriver to create a Selenium Grid for cross-browser and distributed testing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Questions</h1>
                </header>
            
            <article>
                
<ol>
<li style="padding-left: 30px">With Selenium, we can execute tests on remote machine(s)— true or false</li>
<li style="padding-left: 30px">Which driver class is used to run tests on a remote machine?</li>
<li style="padding-left: 30px">Explain desired capabilities.</li>
<li style="padding-left: 30px">What protocol is used between the Selenium test and Selenium Standalone Server?</li>
<li style="padding-left: 30px">What is the default port used by Selenium Standalone Server?</li>
</ol>
<p class="mce-root"/>
<p class="mce-root"/>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Further information</h1>
                </header>
            
            <article>
                
<p><span>You can check out the following link for more information about the topics covered in this chapter:</span></p>
<ul>
<li>Selenium WebDriver W3C specification explains the WebDriver Protocol and all the endpoints: <a href="https://www.w3.org/TR/webdriver/">https://www.w3.org/TR/webdriver/</a></li>
</ul>


            </article>

            
        </section>
    </body></html>