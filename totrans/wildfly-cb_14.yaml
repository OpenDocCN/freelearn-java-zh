- en: Chapter 14. WildFly into the Cloud with OpenShift
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, you will learn the following recipes:'
  prefs: []
  type: TYPE_NORMAL
- en: Registering to OpenShift Online
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing the WildFly cartridge for our first deployment
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Taking control of your WildFly server via SSH
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deploying your code to OpenShift Online
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this chapter, you will learn what OpenShift is, and how you can take advantage
    of it by deploying your application directly to the Internet on the cloud.
  prefs: []
  type: TYPE_NORMAL
- en: 'First of all, OpenShift is a **Platform as a Service**, which stands for the
    famous acronym **PaaS**. OpenShift is Red Hat''s PaaS, and you can find it in
    three different versions:'
  prefs: []
  type: TYPE_NORMAL
- en: '**OpenShift Origin**: This one is the free and open source version of OpenShift.
    You can find its code stream on GitHub at [https://github.com/openshift/origin](https://github.com/openshift/origin).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**OpenShift Online**: OpenShift Online (OSO) is the version that we will use
    in this chapter. For the moment you just need to know that it''s a free PaaS,
    where you can deploy your application based on your favorite environment. We will
    discuss it later in the chapter. OpenShift Online is available for free at [https://www.openshift.com](https://www.openshift.com).'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**OpenShift Enterprise**: OpenShift Enterprise (OSE) is the version for which
    Red Hat provides support at the enterprise level.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'As mentioned in the book *Getting Started with OpenShift*, *O''Reilly*:'
  prefs: []
  type: TYPE_NORMAL
- en: '*OSE is intended for customers who want stability and a production-ready install
    out of the box. Since stability is paramount, some of the features found in Origin
    or Online may not be in Enterprise for a release or two.*'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Anyway, what is OpenShift all about? OpenShift is a lot of things, but from
    my experience, I think that the word self-provisioning is the one that fits it
    better. Developers and/or sysadmins can access the system and provision themselves
    their own environment, on the fly. Resources, runtime, network: all you need is
    there for you at one click.'
  prefs: []
  type: TYPE_NORMAL
- en: Another thing OpenShift can do for you is autoscaling. If you deploy your application
    on OpenShift and flag the option for "autoscaling", whenever your site gets more
    traffic, your infrastructure scales; more "nodes" are added in order to handle
    more and more requests. Still, "automagically", whenever your application traffic
    decreases, OpenShift gets back the extra resources.
  prefs: []
  type: TYPE_NORMAL
- en: 'In OpenShift you need to understand three main concepts:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Gear**: Think about it as a server that provides you the resources that you
    need, such as RAM, CPU, and disk space. In OpenShift Online you can find three
    types of gear: small, medium, and large. They all have 1 GB of disk space. The
    small gear has 512 MB of RAM, medium gear has 1 GB of RAM, and the large gear
    has 2 GB of RAM.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenShift Online gives you three small gears for free. If you want more or want
    to get different types, you need to purchase them.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '**Cartridge**: Think of it as a plugin. A cartridge is the host of your services
    or applications. For example, if you have a Java web application, your cartridge
    might be WildFly, JBoss AS, or Tomcat. Cartridges can be of two types:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Standalone**: This is like WildFly, JBoss AS, and Vert.x; basically the application
    server that your application runs on'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Embedded**: This is a functionality cartridge such as a database cartridge'
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Application**: Without turning around too much, it''s your application that
    runs on OpenShift. OpenShift exposes three ports for incoming traffic: SSH on
    port 22, HTTP on port 80, and HTTPS on port 443.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This is essentially the basics you need to know in order to work with OpenShift
    Online. A plus would be an understanding of the basis of Git (a distributed version
    control software), but we will see it when needed.
  prefs: []
  type: TYPE_NORMAL
- en: Let's begin!
  prefs: []
  type: TYPE_NORMAL
- en: Registering to OpenShift Online
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to register for a free OpenShift Online account.
    This is a warm-up recipe, which will enable us to get acquainted with the overall
    infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As we will operate just online, all you need to have is an Internet connection
    for the next 10 minutes.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Open a browser of your choice and point it to [http://www.openshift.com](http://www.openshift.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once there, click on the **Online** box (to the extreme left), as depicted in
    the following image:![How to do it…](img/3744_14_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift home page
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The next step is to fill in the registration form by providing a valid, working
    e-mail ID and choosing a password, as shown in the following screenshot:![How
    to do it…](img/3744_14_02.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online registration form
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once done, hit the **Sign Up** button and wait for a confirmation mail, as warned
    in the following message:![How to do it…](img/3744_14_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Message warning for a confirmation mail
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You may need to wait a few minutes and even check for it in the **Spam** folder.
    The mail should look like the following screenshot:![How to do it…](img/3744_14_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The e-mail sent by OpenShift Online
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click on the link labeled **Verify Your Account** to activate your account.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You will be prompted to accept the **OpenShift Service Agreement** and **Red
    Hat Portal Terms of Use**, as depicted in the following image:![How to do it…](img/3744_14_05.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift service agreement and Red Hat portal terms of use acceptance form
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If you want, you can also flag the **Sign me up for OpenShift email** and click
    the **I Accept** button.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Great, you are now ready to deploy into the cloud and provide your applications
    to the world!
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The process is pretty straightforward and quick. What is worth mentioning again,
    is the type of account you get.
  prefs: []
  type: TYPE_NORMAL
- en: Once you log in to your OpenShift Online account, at the upper-right corner
    of the screen, you can find your username with a down arrow. If you click on it,
    you will see a little menu; click on the first item labeled **My Account**.
  prefs: []
  type: TYPE_NORMAL
- en: 'It should provide you with a page like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works…](img/3744_14_06.jpg)'
  prefs: []
  type: TYPE_IMG
- en: OpenShift Online "My Account" page
  prefs: []
  type: TYPE_NORMAL
- en: 'In that page there are four things that need to be noticed:'
  prefs: []
  type: TYPE_NORMAL
- en: On the left is your login e-mail and your account type; it's always better to
    check.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: On the upper-right side of the screen is a grayed bold label specifying the
    **Free Plan**.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Towards the bottom-center is the information that at the moment you are using
    zero (**0**) gears out of three (**3**), and that they are free. Also, at the
    same location, there is a hint that you can have a maximum of **16 Gears**, not
    more! This is something you should consider when choosing between OpenShift Online
    and OpenShift Enterprise, which is totally customizable.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Last, but not least, is the **Upgrade Now** button, which provides you with
    all the information that you need to upgrade to the **Bronze** or **Silver** Plans.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For all the services that OpenShift Online provides and how it works, please
    refer to the documentation at [https://www.openshift.com/walkthrough/how-it-works](https://www.openshift.com/walkthrough/how-it-works)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are looking for documentation from a developer's point of view, you can
    go to [https://developers.openshift.com](https://developers.openshift.com)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing the WildFly cartridge for our first deployment
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to configure the WildFly cartridge using
    your OpenShift Online account. If you still don't have an account, please refer
    to the first recipe of this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As we will operate online most of the time, you need to have an Internet connection.
    On the other hand, all we need locally is a web application to deploy.
  prefs: []
  type: TYPE_NORMAL
- en: For this reason, download the entire repository named `wildfly-cookbook-oso`,
    from my GitHub account at [https://github.com/foogaro/wildfly-cookbook-oso.git](https://github.com/foogaro/wildfly-cookbook-oso.git).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You can `git-clone` the project or just download it as a ZIP archive. Either
    way, place the source in our `~/WFC/github` path. There you can find a project
    called `openshift-welcome`. To compile the project, execute the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: In the `target` folder, generated by maven, you should find the `openshift-welcome.war`
    artifact ready to be deployed.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Let's start for real now!
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: First things first; log in to your OSO account at [https://openshift.redhat.com/app/console](https://openshift.redhat.com/app/console).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the e-mail and password chosen at the time of registration, as depicted
    in the following image:![How to do it…](img/3744_14_07.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online login form
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once there, the first thing to do is to create an application, as depicted in
    the following screenshot:![How to do it…](img/3744_14_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online welcome page
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Follow the **Create your first application now** link. In the next page, select
    the WildFly cartridge, as shown in the following image:![How to do it…](img/3744_14_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online list of most used cartridges
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: While writing the book, the latest available stable cartridge for WildFly is
    version 8.2.0.Final. Obviously, this is the application server which we will be
    using to provide our application.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Next, we need to configure our namespace, where all our applications will belong,
    and configure the application name; both of these together become the **Public
    URL**, as shown in the following image:![How to do it…](img/3744_14_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online—applications settings form
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: What you need to change in the preceding form is the domain name, which is on
    the right side of the hyphen symbol (**-**); I chose `wildflycookbook`. The domain
    name must be unique within OpenShift Online at **rhcloud.com**. So choose your
    own domain name to which all your application names will belong.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For this very first try, leave all defaults as such and click the **Create Application**
    button. It will take a few minutes to do all that's necessary—it took me 4 minutes.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then you will be asked if you will be changing the code:![How to do it…](img/3744_14_11.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the moment, we just skip this step and click on the link labeled **Not now,
    continue**—we will see the other option with a specific recipe, later in this
    chapter.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next page will be our recap page, which will give us all the information
    to manage our WildFly instance, such as deploying our applications.![How to do
    it…](img/3744_14_12.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The green box in the preceding screenshot, depicts the **Username** and **Password**
    of an administrator user—basically, a user bound to `ManagementRealm` with administrator
    privileges. By the way, in order to access the Web Console, we need to use a tool
    called RHC which can forward for us all requests to port 9990 of the Admin console
    present in our new OpenShift Online environment.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: There is one more thing to do which is to install the client tool named RHC,
    which will provide us with a command-line interface to manage the OSO locally
    from our PC.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Open a terminal window and run the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Now that whole software has been installed, we need to setup the RHC tool,
    as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: As you can see, the output fits my configuration. Yours should be similar, too.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Okay, let's go back to where we were. We were ready to deploy our application,
    but we needed to access the management console.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Now we can do it by first providing the following RHC command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: As described in the last line, keep this process running.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Now let's open a browser and point it to the OpenShift Online Admin Console,
    at `http://127.0.0.1:9990`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When requested, insert the credentials provided to you when we created our first
    application, in the green box.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should now see the following page:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_14_13.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: WildFly management console on OpenShift Online
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: We can deploy our application by clicking on the **Deployments** tag:![How to
    do it…](img/3744_14_14.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deployments management
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Click on the **Add** button, and choose the `openshift-welcome.war` artifact
    that we previously compiled with the maven command. Once we have chosen it, enable
    and confirm it as follows:![How to do it…](img/3744_14_15.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Deploying the openshift-welcome.war application
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once we have successfully deployed the application, let's try it by opening
    it at [http://openshiftwelcome-wildflycookbook.rhcloud.com](http://openshiftwelcome-wildflycookbook.rhcloud.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'That''s our first application running on WildFly on OpenShift Online:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_14_16.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: OpenShift-welcome application up and running
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: The page is designed to be as comprehensive as possible; I've also used the
    bold font style!
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Well, here the tough job is done by OpenShift Online. The only thing we have
    done essentially is install the Ruby programming language environment to be able
    to install and run the RHC tool, which is the client tool used to mange the OpenShift
    Online environment.
  prefs: []
  type: TYPE_NORMAL
- en: Let's recap what we have done during the deployment of our first application
    in the cloud.
  prefs: []
  type: TYPE_NORMAL
- en: 'First we have chosen the cartridge. As we have seen, there are many cartridges
    that we can use for our gear: WildFly, JBoss AS, Tomcat, Drupal, WordPress, Node.js,
    and **MongoDB Express Angular Node** (**MEAN**). There are many of them, and you
    can find them all at the OpenShift Online site at [https://openshift.redhat.com/app/console/application_types](https://openshift.redhat.com/app/console/application_types).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Once we have selected the WildFly cartridge, the platform asked us the **Public
    URL** to be used to publish our application, as shown in the following image:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works…](img/3744_14_17.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The Public URL to publish the application
  prefs: []
  type: TYPE_NORMAL
- en: The URL, besides the suffix **.rhcloud.com**, is composed using the application
    name and a namespace. The last one is essentially your domain, the one where all
    your applications reside. Remember, it has to be unique! In my case, I've chosen
    the namespace `wildflycookbook`.
  prefs: []
  type: TYPE_NORMAL
- en: 'As a matter of fact, the next time you create an application, you will be asked
    to give just the application name, as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works…](img/3744_14_18.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Defining your application name to be used into the public URL
  prefs: []
  type: TYPE_NORMAL
- en: 'Still remaining on the same page, there was another option we could have chosen—scaling—as
    shown in the following image:'
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works…](img/3744_14_19.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Scaling option in OpenShift Online
  prefs: []
  type: TYPE_NORMAL
- en: This option would have given us the capability to automatically scale the application.
    In few words, as already mentioned in the introduction, OpenShift will create
    additional WildFly gears (as long as they are available in your plan) and a balancer
    gear, to scale horizontally, when the incoming traffic increases.
  prefs: []
  type: TYPE_NORMAL
- en: 'The next option would have been the **Region**, which is the location where
    the server would have run your gears: US, Europe, or Asia.'
  prefs: []
  type: TYPE_NORMAL
- en: All gears of any size can be run in the **US**; only production gears can be
    deployed to the **EU** region (small.highcpu, medium, and large). The **Asia**
    region is reserved for dedicated node service.
  prefs: []
  type: TYPE_NORMAL
- en: So, with the free plan, we can only choose the **US** region, which is fine.
  prefs: []
  type: TYPE_NORMAL
- en: As you may have guessed from the name of the region (`aws-us-east-1`), OpenShift
    relies on the Amazon AWS, to create the servers. Because of the Amazon "pay-only-for-what-you-use"
    policy, whenever the incoming traffic to your site decreases, OpenShift gets back
    the extra resources.
  prefs: []
  type: TYPE_NORMAL
- en: 'Apart from the configuration settings, there was one setting I put into the
    application through the `WEB-INF/jboss-web.xml` JBoss specific descriptor file,
    which looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The preceding configuration sets the context root of the application to `/`,
    so we can access it by just providing the URL [http://openshiftwelcome-wildflycookbook.rhcloud.com](http://openshiftwelcome-wildflycookbook.rhcloud.com),
    without any additional context path.
  prefs: []
  type: TYPE_NORMAL
- en: There's more…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'This recipe was a little long, and you have probably found yourself doing it
    in different ways. If so, you may have encountered this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![There''s more…](img/3744_14_20.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Application in the idle state
  prefs: []
  type: TYPE_NORMAL
- en: 'This basically means that your WildFly instance has stopped. Your application
    will not receive incoming traffic, and even the access to the WildFly management
    console will not work:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The only way to move ahead is to restart the application.
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Keep in mind that after 48 hours of inactivity, or no-traffic at all, OpenShift
    Online puts your application back to the idle state. To keep your application
    away from the idle state, you can have a kind of cron job doing a simple HTTP
    GET to your site, once a day.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For all the services that OpenShift Online provides and how it works, please
    refer to the documentation at [https://www.openshift.com/walkthrough/how-it-works](https://www.openshift.com/walkthrough/how-it-works)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are looking for documentation from a developer's point of view, go to
    [https://developers.openshift.com](https://developers.openshift.com)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Taking control of your WildFly server via SSH
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to access the server where your WildFly is
    running. Accessing the server gives you some kind of comfort because, I guess,
    it's the way we usually work. There, you can see the WildFly process, its logs,
    its directory structures, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Before you can effectively go through this recipe, you should have an active
    OpenShift Online account, along with an application. In case you need to, you
    can follow recipe one for the registration process, and follow *Installing the
    WildFly cartridge for our first deployment* recipe of this chapter to create your
    first application.
  prefs: []
  type: TYPE_NORMAL
- en: In this recipe, I will use the environment generated while creating the application
    `openshiftwelcome`; yours might be different but would conceptually be the same.
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: First, let's log in to your OSO account, at [https://openshift.redhat.com/app/console](https://openshift.redhat.com/app/console).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then enter the username and password that you chose during the registration
    process.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once logged in, select the application that you have created, or create a new
    one as described in the second recipe. I'll select my `openshiftwelcome` application.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The following are my application details:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_14_21.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Application details
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the preceding screenshot, there are two sections on the right named **Source
    Code** and **Remote Access**.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In the **Remote** **Access** section, click on the **Want to log in to your
    application?** label. It describes how to log in to the server which is hosting
    your application, obviously along with its cartridge.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open a terminal window and copy-paste the `ssh` command that the page is providing
    you. Mine is as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Once there, you can view the WildFly logs and see everything else that you want
    to.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: Be careful, if you delete something that you shouldn't, you will need to create
    your application again.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Let's take a look at the WildFly logs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Execute the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Obviously, you are not limited to the logs; you can see the process, as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Or you can see the server resources by executing the `htop` command:![How to
    do it…](img/3744_14_22.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Keep in mind that you can see and control everything as long as your user (the
    hash that identifies your application; mine is `54c0350afcf933691e0000dc`) has
    permissions.
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Whenever you create an application, you are actually creating an environment
    along with a cartridge that enables your application. OpenShift Online creates
    everything for you, assigning the whole process a hash. That hash will be your
    username to log in to your server, and it also identifies your application. The
    rest of the process of how OpenShift creates things is out of the scope of this
    book.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want to learn more about how things work under the hood, I suggest you
    start with this book: *Learning OpenShift*, *Grant Shipley*, *Packt Publishing*.'
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make it a point to always refer to the official documentation, which, in this
    case, can be found at [https://docs.openshift.org/](https://docs.openshift.org/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Deploying your code to OpenShift Online
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In this recipe, you will learn how to re-deploy an application whenever the
    source code updates happen. This is done automatically for you by OpenShift Online,
    which triggers compilation and deployment every time a commit is applied to your
    code.
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: First of all, we need a project on GitHub that we can use for our test. For
    this reason, I've created a project called `openshiftcoding-wildflycookbook` on
    my GitHub repository, available at [https://github.com/foogaro/openshiftcoding-wildflycookbook](https://github.com/foogaro/openshiftcoding-wildflycookbook).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you do not have an account on GitHub, this might be a good reason to have
    one. Sooner or later you will need one. To get started quickly, go to the GitHub
    site at [https://github.com](https://github.com) and sign up. Once the registration
    process is complete, you will be ready to create a repository, which will host
    the source code of your application. If you don't have an application, you can
    borrow mine.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Anyway, this time you don''t have to download or `git-clone` my GitHub repository
    locally, as it will be used to feed the next OpenShift application. But we do
    need to install the `git` client tool. If you are using an OS similar to Red Hat,
    run the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Once done, you can check that everything is installed successfully, by issuing
    the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Okay, now we are ready to begin!
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: First of all, you need to access your OpenShift Online account at the following
    address [https://openshift.redhat.com/app/console](https://openshift.redhat.com/app/console).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Use the e-mail and the password chosen at the time of registration, as depicted
    in the following screenshot:![How to do it…](img/3744_14_23.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online login form
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Tip
  prefs:
  - PREF_IND
  - PREF_H3
  type: TYPE_NORMAL
- en: If you don't have an OpenShift Online account yet, follow the registration process
    described in the first recipe of this chapter.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Once you log in, on the main page, click the **Add Application…** button to
    create a new application:![How to do it…](img/3744_14_24.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenShift Online initial console for adding a new application
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Next we need to select the WildFly cartridge. As there are tens of cartridges,
    we can search for it by providing a criteria filter, as depicted in the following
    screenshot:![How to do it…](img/3744_14_25.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Selecting the WildFly cartridge by filtering it
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Afterwards, select the cartridge and fill in the form with the details of our
    application, as follows:![How to do it…](img/3744_14_26.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Setting application details
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: In my case, I've called my application `openshiftcoding`. This time I've specified
    my GitHub repository, where my application is available, that is, at [https://github.com/foogaro/openshiftcoding-wildflycookbook.git](https://github.com/foogaro/openshiftcoding-wildflycookbook.git).
    You will need to specify yours.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Complete the form by leaving the other default values as such and by clicking
    the **Create Application** button. It may take few minutes to complete.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the process is complete, you should see a page like the following:![How
    to do it…](img/3744_14_27.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Recap of the newly created application
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: As you can see from the preceding image, there is a section labeled **Making
    code changes**, that describes what we need to do in order to modify the source
    of our application, and have it automatically updated whenever we modify the code.
  prefs: []
  type: TYPE_NORMAL
- en: Therefore, open a terminal window and issue the `git clone` command identifying
    your application repository in OpenShift Online—it is not the one on GitHub, but
    will be cloned locally into the server that OpenShift will create for you.
  prefs: []
  type: TYPE_NORMAL
- en: 'These are the commands that I enter now:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: We are now ready to change our source code, commit it, and see OpenShift compiling
    and deploying our application directly to our WildFly instance. To see all this
    beauty, we need to look at the logs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a terminal window and issue the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: As you can see from the preceding log that has been emphasized, our application
    is already there; in fact, if we open the public URL that we specified while creating
    the application, we can see it working, as follows:![How to do it…](img/3744_14_28.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The application needs to be updated
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Okay, let''s update the source code. In my case, I only have a JSP, and its
    code is the following:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Let''s add some color to the text as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Now, we can update our code to the Git repository from the first terminal window
    (where we cloned the Git repository from OpenShift), as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Now, we need to push everything. Before doing that, let's grab the other terminal
    with the visible WildFly log. Now we can do the magic…
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'If you are familiar with `git`, you''ll know that this push took a little longer
    than expected, but it did a lot of things:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: It stopped our WildFly
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: It updated the code
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: It issued a maven compilation, packaged our application as a `war`
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: It copied our new application into the WildFly `deployments` folder
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: It started WildFly
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
- en: 'And if you have looked at the WildFly logs too, you should have noticed the
    following entries:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Let's see if everything worked correctly. Open the browser and go to [http://openshiftcoding-wildflycookbook.rhcloud.com](http://openshiftcoding-wildflycookbook.rhcloud.com).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'You should see something like the following page:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![How to do it…](img/3744_14_29.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: Application updated through a git push
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Great, it worked!
  prefs: []
  type: TYPE_NORMAL
- en: How it works…
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: OpenShift Online hides and does a lot of things under the hood, making our lives
    easier, much easier. The only thing that we actually did was on the development
    side.
  prefs: []
  type: TYPE_NORMAL
- en: To let OpenShift Online easily compile, package, and deploy our application,
    we need to instruct it about how to compile the source, how to package it, and
    where to deploy it. We can give these directives through the maven project file,
    the `pom.xml`.
  prefs: []
  type: TYPE_NORMAL
- en: 'The following is the complete `pom.xml` file of the `openshiftcoding-wildflycookbook`
    project (also available at [https://github.com/foogaro/openshiftcoding-wildflycookbook/blob/master/pom.xml](https://github.com/foogaro/openshiftcoding-wildflycookbook/blob/master/pom.xml)):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: The key point here is the profile named `openshift`. By default, OSO uses Maven
    to compile the source code, asking to use the `openshift` profile. The profile
    that it finds will be used along with its settings; otherwise, the code will be
    just compiled and packaged, but OSO will not know where to deploy it.
  prefs: []
  type: TYPE_NORMAL
- en: The `openshift` profile that I've provided, defines (with the `build` tag )
    the settings to be used during Maven's build phase. Particularly, I've used the
    standard `maven-war-plugin` and set the `outputDirectory` to `deployments`, which
    is the one that WildFly uses.
  prefs: []
  type: TYPE_NORMAL
- en: See also
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'From a developer''s point of view, I recommend that you refer to the official
    documentation at the following sites:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://docs.openshift.com](https://docs.openshift.com)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[https://developers.openshift.com/en/managing-modifying-applications.html](https://developers.openshift.com/en/managing-modifying-applications.html)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
