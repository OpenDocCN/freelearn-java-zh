<html><head></head><body>
  <div id="_idContainer028">
   <h1 class="chapterNumber">
    <a id="_idTextAnchor050">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     2
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-48">
    <a id="_idTextAnchor051">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Exposing a RESTful API with Spring
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3.1">
     To implement REST APIs, in most chapters of this book, we are going to use
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.4.1">
      Spring Boot
     </span>
    </strong>
    <span class="koboSpan" id="kobo.5.1">
     .
    </span>
    <span class="koboSpan" id="kobo.5.2">
     As it is a
    </span>
    <a id="_idIndexMarker063">
    </a>
    <span class="koboSpan" id="kobo.6.1">
     well-known and popular framework, it is very likely that you are familiar with it or have used it before.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.7.1">
     However, the general API design principles are easily transferable to other Java technologies.
    </span>
    <span class="koboSpan" id="kobo.7.2">
     You will learn more about how we can apply these principles to other technologies in
    </span>
    <a href="B21843_11.xhtml#_idTextAnchor310">
     <em class="italic">
      <span class="koboSpan" id="kobo.8.1">
       Chapter 11
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.9.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.10.1">
     In this chapter, we will discuss the process of designing a RESTful API.
    </span>
    <span class="koboSpan" id="kobo.10.2">
     We will also concentrate on the practical implementation of the API using the Spring Framework, a popular choice for building RESTful APIs.
    </span>
    <span class="koboSpan" id="kobo.10.3">
     By the end of this chapter, you will have the knowledge to design and create a RESTful API following the best practices.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.11.1">
     In this chapter, we will be covering these topics:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.12.1">
      Designing the product API
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.13.1">
      API implementation using Spring Boot
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-49">
    <a id="_idTextAnchor052">
    </a>
    <span class="koboSpan" id="kobo.14.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.15.1">
     In this chapter, we will implement an example product API.
    </span>
    <span class="koboSpan" id="kobo.15.2">
     To be able to follow along and use the code examples as they are printed in the book, you should have the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.16.1">
      Intermediate knowledge of the Java language and platform
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.17.1">
      At least a basic knowledge of Spring Boot or a similar framework
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.18.1">
      Java 21 and Maven 3.9.0 installed
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.19.1">
      Basic knowledge of a tool for calling REST APIs, such as
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.20.1">
       curl
      </span>
     </code>
     <span class="koboSpan" id="kobo.21.1">
      , is recommended
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.22.1">
     In this chapter, we are going to apply REST principles to create our API; you can access the code for this chapter on GitHub at
    </span>
    <a href="https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter2">
     <span class="url">
      <span class="koboSpan" id="kobo.23.1">
       https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/tree/main/chapter2
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.24.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-50">
    <a id="_idTextAnchor053">
    </a>
    <span class="koboSpan" id="kobo.25.1">
     Designing the product API
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.26.1">
     The product API we will develop is an API for managing products.
    </span>
    <span class="koboSpan" id="kobo.26.2">
     Our API will offer various operations, which will be detailed during the design phase.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.27.1">
     Spending
    </span>
    <a id="_idIndexMarker064">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     an adequate amount of time on properly designing the API before starting to write the code can save a lot of time later, preventing costly and risky refactoring.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.29.1">
     The design stage should include the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.30.1">
       Defining the requirements
      </span>
     </strong>
     <span class="koboSpan" id="kobo.31.1">
      : Understanding the use cases and who will use the API is essential to creating an API that contains everything that is needed and nothing more.
     </span>
     <span class="koboSpan" id="kobo.31.2">
      A good understanding of the requirements lets you avoid breaking changes for as long as possible.
     </span>
     <span class="koboSpan" id="kobo.31.3">
      In
     </span>
     <a href="B21843_05.xhtml#_idTextAnchor116">
      <em class="italic">
       <span class="koboSpan" id="kobo.32.1">
        Chapter 5
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.33.1">
      , we will talk about how you can evolve your API and ensure backward compatibility.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.34.1">
       Identifying the resources
      </span>
     </strong>
     <span class="koboSpan" id="kobo.35.1">
      : Resources are usually domain entities such as users or products.
     </span>
     <span class="koboSpan" id="kobo.35.2">
      Relationships between multiple entities are often represented by a hierarchical URI structure.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.36.1">
       Defining the resource structure
      </span>
     </strong>
     <span class="koboSpan" id="kobo.37.1">
      : After identifying the resources, it is necessary to define the resource fields and relationships.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.38.1">
       Designing the endpoints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.39.1">
      : With the resources and the domain defined, the next step is to identify the endpoints that should be exposed, how they should be exposed, and what HTTP methods should be used for what purpose.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.40.1">
       Error handling
      </span>
     </strong>
     <span class="koboSpan" id="kobo.41.1">
      : Having clear error responses with standard error codes helps the client to react to the error correctly.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.42.1">
       Security
      </span>
     </strong>
     <span class="koboSpan" id="kobo.43.1">
      : It is essential to prevent malicious actors from accessing resources that they are not authorized to.
     </span>
     <span class="koboSpan" id="kobo.43.2">
      You will learn more about API security in
     </span>
     <a href="B21843_07.xhtml#_idTextAnchor176">
      <em class="italic">
       <span class="koboSpan" id="kobo.44.1">
        Chapter 7
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.45.1">
      .
     </span>
    </li>
   </ul>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.46.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.47.1">
      An endpoint is a specific URI that enables clients to interact with a server via an API to perform a specific function.
     </span>
     <span class="koboSpan" id="kobo.47.2">
      It represents an operation that can be executed using a unique path and the corresponding HTTP method.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.48.1">
     Based on
    </span>
    <a id="_idIndexMarker065">
    </a>
    <span class="koboSpan" id="kobo.49.1">
     these design steps, you can proceed directly to implementing the
    </span>
    <a id="_idIndexMarker066">
    </a>
    <span class="koboSpan" id="kobo.50.1">
     API in code using Java.
    </span>
    <span class="koboSpan" id="kobo.50.2">
     This is called the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.51.1">
      code-first approach
     </span>
    </strong>
    <span class="koboSpan" id="kobo.52.1">
     , usually representing the fastest path to a working API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.53.1">
     A different
    </span>
    <a id="_idIndexMarker067">
    </a>
    <span class="koboSpan" id="kobo.54.1">
     approach, called
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.55.1">
      specification-first
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     , will be explained in
    </span>
    <a href="B21843_03.xhtml#_idTextAnchor076">
     <em class="italic">
      <span class="koboSpan" id="kobo.57.1">
       Chapter 3
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.58.1">
     .
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-51">
    <a id="_idTextAnchor054">
    </a>
    <span class="koboSpan" id="kobo.59.1">
     Defining the requirements
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.60.1">
     The API
    </span>
    <a id="_idIndexMarker068">
    </a>
    <span class="koboSpan" id="kobo.61.1">
     requirements can be divided into functional and non-functional:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.62.1">
       Functional requirements
      </span>
     </strong>
     <span class="koboSpan" id="kobo.63.1">
      : These describe the specific functions and features that the software must perform.
     </span>
     <span class="koboSpan" id="kobo.63.2">
      Examples include data validation, data processing, and system interactions.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.64.1">
       Non-functional requirements
      </span>
     </strong>
     <span class="koboSpan" id="kobo.65.1">
      : These are also known as quality attributes or software quality requirements that specify the qualities or characteristics that the software must possess.
     </span>
     <span class="koboSpan" id="kobo.65.2">
      Examples include performance (response time and throughput), reliability, security, scalability, usability, and maintainability.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.66.1">
     In this chapter, we will only work on the functional requirements.
    </span>
    <span class="koboSpan" id="kobo.66.2">
     We will get to some of the non-functional requirements in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.67.1">
      Chapters 7 and 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.68.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.69.1">
     As mentioned earlier, our example REST API will be a product API and will have the following requirements:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.70.1">
       Product creation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.71.1">
      : The API should allow users to create new products by providing necessary information such as the SKU (Stock Keeping Unit, in the context of this book it is the unique product ID), name, description, and price
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.72.1">
       Product retrieval
      </span>
     </strong>
     <span class="koboSpan" id="kobo.73.1">
      : Users should be able to retrieve information about all products available in the system
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.74.1">
       Product details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.75.1">
      : The API should provide endpoints to retrieve detailed information about a specific product, identified by its SKU
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.76.1">
       Product update
      </span>
     </strong>
     <span class="koboSpan" id="kobo.77.1">
      : Users should be able to update existing product information, such as name, description, or price
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.78.1">
       Product description update
      </span>
     </strong>
     <span class="koboSpan" id="kobo.79.1">
      : The API should provide an endpoint to update the description only
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.80.1">
       Product deletion
      </span>
     </strong>
     <span class="koboSpan" id="kobo.81.1">
      : The API should allow users to delete a product from the system, identified by its SKU
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.82.1">
       Unique SKU constraint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.83.1">
      : The API should enforce a constraint to ensure that each product has a unique SKU, preventing duplicate products with the same identifier
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.84.1">
     Now that we have identified the requirements, the next step is to identify our resources.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-52">
    <a id="_idTextAnchor055">
    </a>
    <span class="koboSpan" id="kobo.85.1">
     Identifying the resources
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.86.1">
     A REST API
    </span>
    <a id="_idIndexMarker069">
    </a>
    <span class="koboSpan" id="kobo.87.1">
     can have one or more resources, and it can also have a hierarchical URI structure.
    </span>
    <span class="koboSpan" id="kobo.87.2">
     A hierarchical URI structure is a way of organizing resources in a URL hierarchy that reflects the relationships between those resources.
    </span>
    <span class="koboSpan" id="kobo.87.3">
     In a hierarchical URI structure, resources are arranged in a tree-like format, where each segment of the URL represents a level of the hierarchy.
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.88.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.89.1">
      URI or URL?
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.90.1">
      In the context
     </span>
     <a id="_idIndexMarker070">
     </a>
     <span class="koboSpan" id="kobo.91.1">
      of REST APIs, we often use the acronyms
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.92.1">
       URI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.93.1">
      (which stands for
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.94.1">
       Uniform Resource Identifier
      </span>
     </strong>
     <span class="koboSpan" id="kobo.95.1">
      ) and
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.96.1">
       URL
      </span>
     </strong>
     <span class="koboSpan" id="kobo.97.1">
      (which stands
     </span>
     <a id="_idIndexMarker071">
     </a>
     <span class="koboSpan" id="kobo.98.1">
      for
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.99.1">
       Uniform Resource Locator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.100.1">
      ) interchangeably.
     </span>
     <span class="koboSpan" id="kobo.100.2">
      To be precise, URLs are a subset of URIs.
     </span>
     <span class="koboSpan" id="kobo.100.3">
      There is a second subset of URIs
     </span>
     <a id="_idIndexMarker072">
     </a>
     <span class="koboSpan" id="kobo.101.1">
      called
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.102.1">
       URNs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.103.1">
      (which stands for
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.104.1">
       Uniform Resource Names
      </span>
     </strong>
     <span class="koboSpan" id="kobo.105.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.105.2">
      The advantage of a URL over a URN is that besides being a unique identifier of the resource, it also contains information that can be used to locate and access the resource: protocol, hostname, and path.
     </span>
     <span class="koboSpan" id="kobo.105.3">
      The path part of a URL supports a hierarchical structure such as the sequence of folders and a filename that you know from filesystem paths.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.106.1">
     Let’s take the following as an example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><a href="https://example.com/blog/posts/12 "><span class="url"><span class="koboSpan" id="kobo.107.1">https://example.com/blog/posts/12</span></span></a>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.108.1">
     In this URI, we have the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <a href="https://example.com">
      <span class="url">
       <span class="koboSpan" id="kobo.109.1">
        https://example.com
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.110.1">
      is the
     </span>
     <a id="_idTextAnchor056">
     </a>
     <span class="koboSpan" id="kobo.111.1">
      base URL
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.112.1">
       /blog
      </span>
     </code>
     <span class="koboSpan" id="kobo.113.1">
      represents the top-level resource, indicating that we are accessing the blog section of a
     </span>
     <a id="_idTextAnchor057">
     </a>
     <span class="koboSpan" id="kobo.114.1">
      website
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.115.1">
       /posts
      </span>
     </code>
     <span class="koboSpan" id="kobo.116.1">
      is a sub-resource under the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.117.1">
       /blog
      </span>
     </code>
     <span class="koboSpan" id="kobo.118.1">
      resource, representing a collection of blog posts
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.119.1">
       /12
      </span>
     </code>
     <span class="koboSpan" id="kobo.120.1">
      is a specific blog post identified by its unique identifier
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.121.1">
     In our case, we have only one resource, which is the product, so we have only
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.122.1">
      /products
     </span>
    </code>
    <span class="koboSpan" id="kobo.123.1">
     .
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.124.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.125.1">
      Resources should be nouns; they should not be verbs.
     </span>
     <span class="koboSpan" id="kobo.125.2">
      For example,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.126.1">
       /products/create
      </span>
     </code>
     <span class="koboSpan" id="kobo.127.1">
      should not be used; instead, use the corresponding HTTP method for this action.
     </span>
     <span class="koboSpan" id="kobo.127.2">
      This is essential for adhering to level 2 of the Richardson Maturity Model.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.128.1">
      In English, many verbs can be used as nouns too, for example,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.129.1">
       /products/quote
      </span>
     </code>
     <span class="koboSpan" id="kobo.130.1">
      .
     </span>
     <span class="koboSpan" id="kobo.130.2">
      When we make a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.131.1">
       POST
      </span>
     </code>
     <span class="koboSpan" id="kobo.132.1">
      request to this resource, it means
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.133.1">
       create a quote
      </span>
     </em>
     <span class="koboSpan" id="kobo.134.1">
      .
     </span>
     <span class="koboSpan" id="kobo.134.2">
      The verb part of the sentence is represented by the correct HTTP method.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.135.1">
      Resources map to business entities and the API usually works with multiple entities of the same type.
     </span>
     <span class="koboSpan" id="kobo.135.2">
      When creating or listing resources (entities) of a particular type, we are working with a collection of objects.
     </span>
     <span class="koboSpan" id="kobo.135.3">
      For collection resources, we use the plural form of the noun – for example,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.136.1">
       products
      </span>
     </code>
     <span class="koboSpan" id="kobo.137.1">
      instead of
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.138.1">
       product
      </span>
     </code>
     <span class="koboSpan" id="kobo.139.1">
      because we want to support operations on the collection of products.
     </span>
    </p>
    <div>
     <span class="koboSpan" id="kobo.140.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
   </div>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.141.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.142.1">
      RFC 3986 defines a URI as a compact sequence of characters that identifies an abstract or physical resource.
     </span>
     <span class="koboSpan" id="kobo.142.2">
      According to RFC 1738, a URL is a specific type of URI that represents the location of a resource accessible via the internet.
     </span>
     <span class="koboSpan" id="kobo.142.3">
      Thus, a URI can be further classified as a locator, a name, or both, with the term URL referring to the subset of URIs.
     </span>
     <span class="koboSpan" id="kobo.142.4">
      This means that all URLs are URIs, but not all URIs are URLs.
     </span>
     <span class="koboSpan" id="kobo.142.5">
      RFC 2141 further defines URNs as another type of URI that names a resource in a persistent, location-independent manner.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.143.1">
     Now that we
    </span>
    <a id="_idIndexMarker073">
    </a>
    <span class="koboSpan" id="kobo.144.1">
     have identified the resources, the next step is to define the resource structure.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-53">
    <a id="_idTextAnchor058">
    </a>
    <span class="koboSpan" id="kobo.145.1">
     Defining the resource structure
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.146.1">
     After identifying the resources, we should identify the attributes of the resources and any relationships
    </span>
    <a id="_idIndexMarker074">
    </a>
    <span class="koboSpan" id="kobo.147.1">
     that are important in the API.
    </span>
    <span class="koboSpan" id="kobo.147.2">
     The attributes represent the data fields associated with the resource.
    </span>
    <span class="koboSpan" id="kobo.147.3">
     Consider the data types, constraints, and any required or optional attributes for each resource.
    </span>
    <span class="koboSpan" id="kobo.147.4">
     A relationship indicates how the resources are related to each other and whether they have any hierarchical or nested relationships.
    </span>
    <span class="koboSpan" id="kobo.147.5">
     For example, a user may have multiple orders associated with them, or a product may belong to a specific category.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.148.1">
     In our case, we have only one resource, which is the product, which should have these attributes:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.149.1">
       name
      </span>
     </code>
     <span class="koboSpan" id="kobo.150.1">
      : The name of the product
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.151.1">
       sku
      </span>
     </code>
     <span class="koboSpan" id="kobo.152.1">
      : The unique key of the product
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.153.1">
       description
      </span>
     </code>
     <span class="koboSpan" id="kobo.154.1">
      : A description of the product
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.155.1">
       price
      </span>
     </code>
     <span class="koboSpan" id="kobo.156.1">
      : The price of the product
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.157.1">
     We can also define the rules for these attributes in this step:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.158.1">
       name
      </span>
     </code>
     <span class="koboSpan" id="kobo.159.1">
      : Required field, with a string with a length between 3 and 255 characters
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.160.1">
       sku
      </span>
     </code>
     <span class="koboSpan" id="kobo.161.1">
      : Required field, with the pattern AA99999
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.162.1">
       description
      </span>
     </code>
     <span class="koboSpan" id="kobo.163.1">
      : Required field, with a string with a length between 10 and 255 characters
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.164.1">
       price
      </span>
     </code>
     <span class="koboSpan" id="kobo.165.1">
      : Required field, with a value greater than 0
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.166.1">
     After
    </span>
    <a id="_idIndexMarker075">
    </a>
    <span class="koboSpan" id="kobo.167.1">
     this step, we can design the endpoints.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-54">
    <a id="_idTextAnchor059">
    </a>
    <span class="koboSpan" id="kobo.168.1">
     Designing the endpoints
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.169.1">
     To design the endpoints, it is important to know the HTTP methods and the HTTP status codes.
    </span>
    <span class="koboSpan" id="kobo.169.2">
     Before talking
    </span>
    <a id="_idIndexMarker076">
    </a>
    <span class="koboSpan" id="kobo.170.1">
     about this, though, we should go one step back and understand how it started.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.171.1">
     The HTTP methods and principles we are going to share here follow the guidelines from Microsoft mentioned in the previous chapter.
    </span>
    <span class="koboSpan" id="kobo.171.2">
     Any REST guidelines should adhere to the internet
    </span>
    <a id="_idIndexMarker077">
    </a>
    <span class="koboSpan" id="kobo.172.1">
     standard known as RFC 9110, the updated version of RFC 2616.
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.173.1">
      RFC
     </span>
    </strong>
    <span class="koboSpan" id="kobo.174.1">
     stands for
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.175.1">
      Request for Comments
     </span>
    </strong>
    <span class="koboSpan" id="kobo.176.1">
     .
    </span>
    <span class="koboSpan" id="kobo.176.2">
     RFC specifies HTTP, TCP, IP, SMTP, and many other vital internet protocols.
    </span>
    <span class="koboSpan" id="kobo.176.3">
     Fielding’s dissertation, titled
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.177.1">
      Architectural Styles and the Design of Network-based Software Architectures
     </span>
    </em>
    <span class="koboSpan" id="kobo.178.1">
     , was an important source for RFC 2616, defining the HTTP/1.1 protocol.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-55">
    <a id="_idTextAnchor060">
    </a>
    <span class="koboSpan" id="kobo.179.1">
     HTTP methods (verbs)
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.180.1">
     HTTP defines
    </span>
    <a id="_idIndexMarker078">
    </a>
    <span class="koboSpan" id="kobo.181.1">
     several methods (also known as verbs) that indicate the action to be performed on a resource.
    </span>
    <span class="koboSpan" id="kobo.181.2">
     The most used HTTP methods in RESTful APIs are the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.182.1">
       GET
      </span>
     </code>
     <span class="koboSpan" id="kobo.183.1">
      : The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.184.1">
       GET
      </span>
     </code>
     <span class="koboSpan" id="kobo.185.1">
      method requests are used to retrieve resource representations, and they
     </span>
     <a id="_idIndexMarker079">
     </a>
     <span class="koboSpan" id="kobo.186.1">
      should not alter the server state.
     </span>
     <span class="koboSpan" id="kobo.186.2">
      They are safe and
     </span>
     <a id="_idIndexMarker080">
     </a>
     <span class="koboSpan" id="kobo.187.1">
      idempotent, meaning they do not have any side effects on the server and can be repeated without changing the server state.
     </span>
     <span class="koboSpan" id="kobo.187.2">
      (Think about the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.188.1">
       get
      </span>
     </code>
     <span class="koboSpan" id="kobo.189.1">
      method of a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.190.1">
       Map
      </span>
     </code>
     <span class="koboSpan" id="kobo.191.1">
      in Java.)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.192.1">
       POST
      </span>
     </code>
     <span class="koboSpan" id="kobo.193.1">
      : The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.194.1">
       POST
      </span>
     </code>
     <span class="koboSpan" id="kobo.195.1">
      method requests
     </span>
     <a id="_idIndexMarker081">
     </a>
     <span class="koboSpan" id="kobo.196.1">
      are used to create new
     </span>
     <a id="_idIndexMarker082">
     </a>
     <span class="koboSpan" id="kobo.197.1">
      resources or generally submit data to be processed by the server.
     </span>
     <span class="koboSpan" id="kobo.197.2">
      They are non-idempotent, meaning that each request is unique and may have side effects on the server.
     </span>
     <span class="koboSpan" id="kobo.197.3">
      (Think about the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.198.1">
       ++
      </span>
     </code>
     <span class="koboSpan" id="kobo.199.1">
      operator in Java; the result will be different if it is evaluated multiple times.)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.200.1">
       PUT
      </span>
     </code>
     <span class="koboSpan" id="kobo.201.1">
      : These requests
     </span>
     <a id="_idIndexMarker083">
     </a>
     <span class="koboSpan" id="kobo.202.1">
      are typically used to create or update the entire
     </span>
     <a id="_idIndexMarker084">
     </a>
     <span class="koboSpan" id="kobo.203.1">
      representation of a resource.
     </span>
     <span class="koboSpan" id="kobo.203.2">
      They are idempotent, meaning that sending the same request multiple times should have the same effect as sending it once.
     </span>
     <span class="koboSpan" id="kobo.203.3">
      (Think about the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.204.1">
       put
      </span>
     </code>
     <span class="koboSpan" id="kobo.205.1">
      method of a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.206.1">
       Map
      </span>
     </code>
     <span class="koboSpan" id="kobo.207.1">
      in Java.)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.208.1">
       PATCH
      </span>
     </code>
     <span class="koboSpan" id="kobo.209.1">
      : This is
     </span>
     <a id="_idIndexMarker085">
     </a>
     <span class="koboSpan" id="kobo.210.1">
      like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.211.1">
       PUT
      </span>
     </code>
     <span class="koboSpan" id="kobo.212.1">
      but used to apply partial
     </span>
     <a id="_idIndexMarker086">
     </a>
     <span class="koboSpan" id="kobo.213.1">
      modifications to a resource.
     </span>
     <span class="koboSpan" id="kobo.213.2">
      It is often used when you want to update only certain fields of a resource.
     </span>
     <span class="koboSpan" id="kobo.213.3">
      (Think about a setter method of a Java Bean/POJO.)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.214.1">
       DELETE
      </span>
     </code>
     <span class="koboSpan" id="kobo.215.1">
      : This method
     </span>
     <a id="_idIndexMarker087">
     </a>
     <span class="koboSpan" id="kobo.216.1">
      is used to remove a resource
     </span>
     <a id="_idIndexMarker088">
     </a>
     <span class="koboSpan" id="kobo.217.1">
      from the server.
     </span>
     <span class="koboSpan" id="kobo.217.2">
      The method is idempotent, meaning that sending the same request multiple times should result in the same state on the server.
     </span>
    </li>
   </ul>
   <h3 class="heading-3" id="_idParaDest-56">
    <a id="_idTextAnchor061">
    </a>
    <span class="koboSpan" id="kobo.218.1">
     HTTP status codes
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.219.1">
     HTTP status codes
    </span>
    <a id="_idIndexMarker089">
    </a>
    <span class="koboSpan" id="kobo.220.1">
     are three-digit numbers that a server sends back to the client after receiving a request.
    </span>
    <span class="koboSpan" id="kobo.220.2">
     They indicate the outcome of the request and provide information about the status of the server or the requested resource.
    </span>
    <span class="koboSpan" id="kobo.220.3">
     All HTTP status codes are grouped into the following categories:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.221.1">
       1xx Informational
      </span>
     </code>
     <span class="koboSpan" id="kobo.222.1">
      : This indicates that the request was received and is being processed.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.223.1">
       2xx Success
      </span>
     </code>
     <span class="koboSpan" id="kobo.224.1">
      : This indicates that the request was received, understood, and processed successfully by the server.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.225.1">
       3xx Redirection
      </span>
     </code>
     <span class="koboSpan" id="kobo.226.1">
      : This indicates that further action is needed to complete the request.
     </span>
     <span class="koboSpan" id="kobo.226.2">
      The client may need to redirect to a different URI.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.227.1">
       4xx Client Error
      </span>
     </code>
     <span class="koboSpan" id="kobo.228.1">
      : This indicates that there was an error in the client’s request.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.229.1">
       5xx Server Error
      </span>
     </code>
     <span class="koboSpan" id="kobo.230.1">
      : This indicates that there was an error on the server side while processing the request.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.231.1">
     Now that we understand HTTP methods and statuses, we can define the API endpoints.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-57">
    <a id="_idTextAnchor062">
    </a>
    <span class="koboSpan" id="kobo.232.1">
     Defining the endpoints for our API
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.233.1">
     Let’s define
    </span>
    <a id="_idIndexMarker090">
    </a>
    <span class="koboSpan" id="kobo.234.1">
     the endpoints for the resource we identified in the previous step.
    </span>
    <span class="koboSpan" id="kobo.234.2">
     We will use the HTTP methods with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.235.1">
      products
     </span>
    </code>
    <span class="koboSpan" id="kobo.236.1">
     resources to ensure we can perform all the necessary operations as outlined in the requirements phase.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.237.1">
     GET /products
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.238.1">
     This endpoint
    </span>
    <a id="_idIndexMarker091">
    </a>
    <span class="koboSpan" id="kobo.239.1">
     will be responsible for returning a list of products.
    </span>
    <span class="koboSpan" id="kobo.239.2">
     We should return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.240.1">
      200 (ok)
     </span>
    </code>
    <span class="koboSpan" id="kobo.241.1">
     HTTP status with the products.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.242.1">
     PUT /products/{id}
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.243.1">
     This endpoint will be responsible for creating or updating the product.
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.244.1">
      PUT
     </span>
    </code>
    <span class="koboSpan" id="kobo.245.1">
     is an idempotent method, so we can call it many times and the result
    </span>
    <a id="_idIndexMarker092">
    </a>
    <span class="koboSpan" id="kobo.246.1">
     will be the same.
    </span>
    <span class="koboSpan" id="kobo.246.2">
     In case of success, we should return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.247.1">
      201 (created)
     </span>
    </code>
    <span class="koboSpan" id="kobo.248.1">
     if the product doesn’t exist and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.249.1">
      200
     </span>
    </code>
    <span class="koboSpan" id="kobo.250.1">
     if the product already exists.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.251.1">
     We could also return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.252.1">
      202 (accepted)
     </span>
    </code>
    <span class="koboSpan" id="kobo.253.1">
     if the product will be processed in the future as an asynchronous task, which is not the case here.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.254.1">
     If we decided to use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.255.1">
      POST
     </span>
    </code>
    <span class="koboSpan" id="kobo.256.1">
     method, we would need to choose between throwing an exception if the product already exists – this exception could be
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.257.1">
      409 (conflict)
     </span>
    </code>
    <span class="koboSpan" id="kobo.258.1">
     – or creating another product.
    </span>
    <span class="koboSpan" id="kobo.258.2">
     In our case, because the SKU is not generated by the application, it is an attribute passed to the API, and we cannot have two products with the same SKU, so we will need to return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.259.1">
      409
     </span>
    </code>
    <span class="koboSpan" id="kobo.260.1">
     and have another endpoint that would be responsible for updating the resource as it is a requirement.
    </span>
    <span class="koboSpan" id="kobo.260.2">
     Instead of doing this, we can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.261.1">
      PUT
     </span>
    </code>
    <span class="koboSpan" id="kobo.262.1">
     method, which can create or update the resource.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.263.1">
     According to RFC 9110, Section 9.3.4, “The fundamental difference between the POST and PUT methods is highlighted by the different intent for the enclosed representation.
    </span>
    <span class="koboSpan" id="kobo.263.2">
     The target resource in a POST request is intended to handle the enclosed representation according to the resource’s own semantics, whereas the enclosed representation in a PUT request is defined as replacing the state of the target resource.
    </span>
    <span class="koboSpan" id="kobo.263.3">
     Hence, the intent of PUT is idempotent and visible to intermediaries, even though the exact effect is only known by the origin server”.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.264.1">
     Proper interpretation of a PUT request presumes that the user agent knows which target resource is desired.
    </span>
    <span class="koboSpan" id="kobo.264.2">
     To get a better insight, please refer to
    </span>
    <a href="https://www.rfceditor.org/rfc/rfc9110.html#section-9.3.4">
     <span class="url">
      <span class="koboSpan" id="kobo.265.1">
       https://www.rfceditor.org/rfc/rfc9110.html#section-9.3.4
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.266.1">
     .
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.267.1">
     DELETE /products/{id}
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.268.1">
     This endpoint
    </span>
    <a id="_idIndexMarker093">
    </a>
    <span class="koboSpan" id="kobo.269.1">
     should remove the product.
    </span>
    <span class="koboSpan" id="kobo.269.2">
     We can return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.270.1">
      204 (no content)
     </span>
    </code>
    <span class="koboSpan" id="kobo.271.1">
     in case the product is removed.
    </span>
    <span class="koboSpan" id="kobo.271.2">
     Even if the product does not exist, we can return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.272.1">
      204
     </span>
    </code>
    <span class="koboSpan" id="kobo.273.1">
     , as the method is idempotent, meaning that sending the same request multiple times should result in the same state on the server.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.274.1">
     PATCH /products/{id}
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.275.1">
     This endpoint
    </span>
    <a id="_idIndexMarker094">
    </a>
    <span class="koboSpan" id="kobo.276.1">
     should be used to update the description of the product.
    </span>
    <span class="koboSpan" id="kobo.276.2">
     As it is a partial update of a resource, it is recommended to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.277.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.278.1">
     .
    </span>
    <span class="koboSpan" id="kobo.278.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.279.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.280.1">
     method was introduced in RFC 5789 as a partial update that doesn’t need to be idempotent.
    </span>
    <span class="koboSpan" id="kobo.280.2">
     If the product does not exist, we can return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.281.1">
      404 (Not found)
     </span>
    </code>
    <span class="koboSpan" id="kobo.282.1">
     error.
    </span>
    <span class="koboSpan" id="kobo.282.2">
     In case of success, we can return the updated product data and a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.283.1">
      200
     </span>
    </code>
    <span class="koboSpan" id="kobo.284.1">
     HTTP status.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.285.1">
     GET /products/{id}
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.286.1">
     This endpoint
    </span>
    <a id="_idIndexMarker095">
    </a>
    <span class="koboSpan" id="kobo.287.1">
     is responsible for returning the details of a single product by the ID.
    </span>
    <span class="koboSpan" id="kobo.287.2">
     If the product does not exist, we can return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.288.1">
      404 (Not found)
     </span>
    </code>
    <span class="koboSpan" id="kobo.289.1">
     error.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.290.1">
     In case of success, we should return the product representation and a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.291.1">
      200
     </span>
    </code>
    <span class="koboSpan" id="kobo.292.1">
     HTTP status.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.293.1">
     Now that we have defined our endpoints, let’s see the possible errors that we may encounter and how we can prepare for them effectively.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-58">
    <a id="_idTextAnchor063">
    </a>
    <span class="koboSpan" id="kobo.294.1">
     Error handling
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.295.1">
     Preparing for
    </span>
    <a id="_idIndexMarker096">
    </a>
    <span class="koboSpan" id="kobo.296.1">
     common issues by defining possible errors can
    </span>
    <a id="_idIndexMarker097">
    </a>
    <span class="koboSpan" id="kobo.297.1">
     help us implement a more reliable API.
    </span>
    <span class="koboSpan" id="kobo.297.2">
     We have already discussed some errors in the previous step; however, let’s get deep into it and see the most common HTTP status codes in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.298.1">
      4xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.299.1">
     range.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.300.1">
     The most common HTTP status codes in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.301.1">
      4xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.302.1">
     range, which indicates client errors, are the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.303.1">
       400 Bad Request
      </span>
     </code>
     <span class="koboSpan" id="kobo.304.1">
      : This status code indicates that the server could not understand the client’s request due to invalid syntax or a malformed request message.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.305.1">
       401 Unauthorized
      </span>
     </code>
     <span class="koboSpan" id="kobo.306.1">
      : This status code indicates that the client needs to authenticate itself to access the requested resource.
     </span>
     <span class="koboSpan" id="kobo.306.2">
      It typically occurs when the client fails to provide proper authentication credentials or access tokens.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.307.1">
       403 Forbidden
      </span>
     </code>
     <span class="koboSpan" id="kobo.308.1">
      : This status code indicates that the client is authenticated, but it does not have permission to access the requested resource.
     </span>
     <span class="koboSpan" id="kobo.308.2">
      It may be due to insufficient permissions or access control restrictions imposed by the server.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.309.1">
       404 Not Found
      </span>
     </code>
     <span class="koboSpan" id="kobo.310.1">
      : This status code indicates that the server could not find the requested resource.
     </span>
     <span class="koboSpan" id="kobo.310.2">
      It is commonly used to indicate that the URI provided by the client does not correspond to any known resource on the server.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.311.1">
       405 Method Not Allowed
      </span>
     </code>
     <span class="koboSpan" id="kobo.312.1">
      : This status code indicates that the HTTP method used by the client is not supported for the requested resource.
     </span>
     <span class="koboSpan" id="kobo.312.2">
      For example, trying to use a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.313.1">
       POST
      </span>
     </code>
     <span class="koboSpan" id="kobo.314.1">
      request on a resource that only supports
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.315.1">
       GET
      </span>
     </code>
     <span class="koboSpan" id="kobo.316.1">
      requests would result in a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.317.1">
       405 Method Not Allowed
      </span>
     </code>
     <span class="koboSpan" id="kobo.318.1">
      response.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.319.1">
       409 Conflict
      </span>
     </code>
     <span class="koboSpan" id="kobo.320.1">
      : This status code indicates that the request could not be completed because of a conflict with the current state of the resource.
     </span>
     <span class="koboSpan" id="kobo.320.2">
      It typically occurs when the client attempts to create or update a resource but the server detects a conflict with the resource’s current state; for example, when two requests attempt to update the same product’s details concurrently, a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.321.1">
       409
      </span>
     </code>
     <span class="koboSpan" id="kobo.322.1">
      status can be returned if one request’s changes conflict with the other due to a version mismatch.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.323.1">
       422 Unprocessable Entity
      </span>
     </code>
     <span class="koboSpan" id="kobo.324.1">
      : This status code indicates that the server understands the request but cannot process it due to semantic errors or validation failures in the request payload.
     </span>
     <span class="koboSpan" id="kobo.324.2">
      It is often used to indicate validation errors in the request data, for example, trying to buy a product that is out of stock.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.325.1">
       429 Too Many Requests
      </span>
     </code>
     <span class="koboSpan" id="kobo.326.1">
      : This status code indicates that the client has exceeded the rate limit or quota imposed by the server for the number of requests
     </span>
     <a id="_idIndexMarker098">
     </a>
     <span class="koboSpan" id="kobo.327.1">
      allowed within a certain time period.
     </span>
     <span class="koboSpan" id="kobo.327.2">
      It is often used to
     </span>
     <a id="_idIndexMarker099">
     </a>
     <span class="koboSpan" id="kobo.328.1">
      prevent abuse or excessive usage of server resources by limiting the rate of incoming requests from a single client or IP address.
     </span>
     <span class="koboSpan" id="kobo.328.2">
      This error is typically handled by an API gateway using a rate-limiting strategy, as we’ll cover in
     </span>
     <a href="B21843_06.xhtml#_idTextAnchor135">
      <em class="italic">
       <span class="koboSpan" id="kobo.329.1">
        Chapter 6
       </span>
      </em>
     </a>
     <span class="koboSpan" id="kobo.330.1">
      .
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.331.1">
     In our API implementation, we should be able to handle some errors:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.332.1">
      When a product does not exist, we should return
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.333.1">
       404 Not Found
      </span>
     </code>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.334.1">
      When the payload does not meet the requirements, for example, if a negative number is provided for the product price, we should return
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.335.1">
       400 Bad Request
      </span>
     </code>
     <span class="koboSpan" id="kobo.336.1">
      with the details
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.337.1">
     Some error conditions (for example, an unsupported method leading to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.338.1">
      405 Method Not Allowed
     </span>
    </code>
    <span class="koboSpan" id="kobo.339.1">
     ) are handled automatically by the framework.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.340.1">
     The security-related
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.341.1">
      401
     </span>
    </code>
    <span class="koboSpan" id="kobo.342.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.343.1">
      403
     </span>
    </code>
    <span class="koboSpan" id="kobo.344.1">
     HTTP status codes will be covered in
    </span>
    <a href="B21843_07.xhtml#_idTextAnchor176">
     <em class="italic">
      <span class="koboSpan" id="kobo.345.1">
       Chapter 7
      </span>
     </em>
    </a>
    <span class="koboSpan" id="kobo.346.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.347.1">
     In the upcoming chapters, we will take on security and documentation as separate topics and address them head-on.
    </span>
    <span class="koboSpan" id="kobo.347.2">
     However, for the development iteration represented by this chapter, we have completed our design phase.
    </span>
    <span class="koboSpan" id="kobo.347.3">
     Moving forward, we will focus on implementing our product API and ensuring that we can meet the requirements that we defined.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-59">
    <a id="_idTextAnchor064">
    </a>
    <span class="koboSpan" id="kobo.348.1">
     API implementation using Spring Boot
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.349.1">
     Spring Boot is
    </span>
    <a id="_idIndexMarker100">
    </a>
    <span class="koboSpan" id="kobo.350.1">
     the most popular Java framework
    </span>
    <a id="_idIndexMarker101">
    </a>
    <span class="koboSpan" id="kobo.351.1">
     for microservice applications.
    </span>
    <span class="koboSpan" id="kobo.351.2">
     It provides embedded servlet containers such as
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.352.1">
      Tomcat
     </span>
    </strong>
    <span class="koboSpan" id="kobo.353.1">
     ,
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.354.1">
      Jetty
     </span>
    </strong>
    <span class="koboSpan" id="kobo.355.1">
     , and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.356.1">
      Undertow
     </span>
    </strong>
    <span class="koboSpan" id="kobo.357.1">
     .
    </span>
    <span class="koboSpan" id="kobo.357.2">
     Embedding
    </span>
    <a id="_idIndexMarker102">
    </a>
    <span class="koboSpan" id="kobo.358.1">
     a container allows you to package
    </span>
    <a id="_idIndexMarker103">
    </a>
    <span class="koboSpan" id="kobo.359.1">
     your application
    </span>
    <a id="_idIndexMarker104">
    </a>
    <span class="koboSpan" id="kobo.360.1">
     as an executable JAR file that can be run directly without needing to deploy your application to a separate application server.
    </span>
    <span class="koboSpan" id="kobo.360.2">
     We are going to use Tomcat as it is the default.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.361.1">
     Our application
    </span>
    <a id="_idIndexMarker105">
    </a>
    <span class="koboSpan" id="kobo.362.1">
     will provide some endpoints and will use an SQL database.
    </span>
    <span class="koboSpan" id="kobo.362.2">
     We will use
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.363.1">
      H2
     </span>
    </strong>
    <span class="koboSpan" id="kobo.364.1">
     , which is a lightweight and open source database.
    </span>
    <span class="koboSpan" id="kobo.364.2">
     It can function as both an in-memory and filesystem database, making it easily usable in development environments without the need for additional infrastructure.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.365.1">
     We are going to use a Spring Data dependency to integrate with the persistence layer, but since this is not the focus of the book, we won’t delve deep into it.
    </span>
    <span class="koboSpan" id="kobo.365.2">
     We recommend the book
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.366.1">
      Persistence Best Practices for Java Applications, by Otávio Santana and Karina Varela, Packt Publishing
     </span>
    </em>
    <span class="koboSpan" id="kobo.367.1">
     , which talks more about the persistence layer.
    </span>
    <span class="koboSpan" id="kobo.367.2">
     To add the Spring Data dependency, include the following entry in your
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.368.1">
      pom.xml
     </span>
    </code>
    <span class="koboSpan" id="kobo.369.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.370.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.371.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.372.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.373.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.374.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.375.1">&gt;</span></span><span class="koboSpan" id="kobo.376.1">org.springframework.boot</span><span class="hljs-tag"><span class="koboSpan" id="kobo.377.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.378.1">groupId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.379.1">&gt;</span></span>
    <span class="hljs-tag"><span class="koboSpan" id="kobo.380.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.381.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.382.1">&gt;</span></span><span class="koboSpan" id="kobo.383.1">spring-boot-starter-data-jpa</span><span class="hljs-tag"><span class="koboSpan" id="kobo.384.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.385.1">artifactId</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.386.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.387.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.388.1">dependency</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.389.1">&gt;</span></span>
</code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.390.1">
     As our API is a web application, we are also going to use Spring Web to create our REST endpoints and Bean Validation to validate the user input, which we are going to talk about later
    </span>
    <a id="_idIndexMarker106">
    </a>
    <span class="koboSpan" id="kobo.391.1">
     in this chapter.
    </span>
    <span class="koboSpan" id="kobo.391.2">
     We will use the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.392.1">
      Clean Architecture
     </span>
    </strong>
    <span class="koboSpan" id="kobo.393.1">
     (
    </span>
    <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">
     <span class="url">
      <span class="koboSpan" id="kobo.394.1">
       https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.395.1">
     )
    </span>
    <span class="Hyperlink">
    </span>
    <span class="koboSpan" id="kobo.396.1">
     design for our API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.397.1">
     Clean Architecture
    </span>
    <a id="_idIndexMarker107">
    </a>
    <span class="koboSpan" id="kobo.398.1">
     was created by Robert C.
    </span>
    <span class="koboSpan" id="kobo.398.2">
     Martin, who was influenced by other well-known architectures, such as the Onion Architecture by Jeffrey Palermo and Hexagonal Architecture (a.k.a.
    </span>
    <span class="koboSpan" id="kobo.398.3">
     ports and adapters) by Alistair Cockburn.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.399.1">
     Clean Architecture shares a similar goal with these other architectures: the separation of concerns by dividing the software into layers.
    </span>
    <span class="koboSpan" id="kobo.399.2">
     The key distinction of Clean Architecture is its clear definition of layers.
    </span>
    <span class="koboSpan" id="kobo.399.3">
     While other architectures provide less precise layer definitions, Clean Architecture distinctly defines four layers, each with specific roles and responsibilities.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.400.1">
     We are going to use Clean Architecture because its multiple layers allow for a clear separation of
    </span>
    <a id="_idIndexMarker108">
    </a>
    <span class="koboSpan" id="kobo.401.1">
     concerns, facilitating better organization and understandability.
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.402.1">
      Figure 2.1
     </span>
    </em>
    <span class="koboSpan" id="kobo.403.1">
     shows the layers defined by Clean Architecture:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.404.1">
     <img alt="Figure 2.1 – Clean Architecture layers" src="../Images/B21843_02_1.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.405.1">
     Figure 2.1 – Clean Architecture layers
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.406.1">
     Let’s
    </span>
    <a id="_idIndexMarker109">
    </a>
    <span class="koboSpan" id="kobo.407.1">
     break
    </span>
    <a id="_idIndexMarker110">
    </a>
    <span class="koboSpan" id="kobo.408.1">
     down each of these layers:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.409.1">
       Entities
      </span>
     </strong>
     <span class="koboSpan" id="kobo.410.1">
      : This layer
     </span>
     <a id="_idIndexMarker111">
     </a>
     <span class="koboSpan" id="kobo.411.1">
      contains the business entities or domain objects of the application.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.412.1">
       Use cases
      </span>
     </strong>
     <span class="koboSpan" id="kobo.413.1">
      : This layer
     </span>
     <a id="_idIndexMarker112">
     </a>
     <span class="koboSpan" id="kobo.414.1">
      contains the application-specific business logic or use cases.
     </span>
     <span class="koboSpan" id="kobo.414.2">
      This layer represents the application’s behavior in terms of the actions or operations that users can perform.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.415.1">
       Interface adapters
      </span>
     </strong>
     <span class="koboSpan" id="kobo.416.1">
      : This layer is responsible for adapting the application’s internal
     </span>
     <a id="_idIndexMarker113">
     </a>
     <span class="koboSpan" id="kobo.417.1">
      representation to external interfaces
     </span>
     <a id="_idIndexMarker114">
     </a>
     <span class="koboSpan" id="kobo.418.1">
      such as
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.419.1">
       user interfaces
      </span>
     </strong>
     <span class="koboSpan" id="kobo.420.1">
      (
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.421.1">
       UIs
      </span>
     </strong>
     <span class="koboSpan" id="kobo.422.1">
      ), REST APIs, databases, or third-party services.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.423.1">
       Frameworks and drivers
      </span>
     </strong>
     <span class="koboSpan" id="kobo.424.1">
      : This
     </span>
     <a id="_idIndexMarker115">
     </a>
     <span class="koboSpan" id="kobo.425.1">
      layer includes libraries, frameworks, and infrastructure code that handle external concerns such as UI rendering, database access, web servers, and external APIs.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.426.1">
     In our application, we are going to use only three layers: entities, use cases, and interface
    </span>
    <a id="_idIndexMarker116">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     adapters.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     This is because for our application, we decided we do not want to decouple from the Spring Framework completely.
    </span>
    <span class="koboSpan" id="kobo.427.3">
     In our case, we prefer having direct access to the many useful features the Spring
    </span>
    <a id="_idIndexMarker117">
    </a>
    <span class="koboSpan" id="kobo.428.1">
     Framework provides.
    </span>
    <span class="koboSpan" id="kobo.428.2">
     We accept coupling with the framework while reducing the complexity of creating a layer to separate it.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.429.1">
     The layers are defined to achieve loose coupling, ease of maintenance, and reusability.
    </span>
    <span class="koboSpan" id="kobo.429.2">
     Robert C.
    </span>
    <span class="koboSpan" id="kobo.429.3">
     Martin says that we can have more layers, and these layers are only schematic.
    </span>
    <span class="koboSpan" id="kobo.429.4">
     The main principle of layered architectures is to ensure that dependencies cross the boundaries in only one direction; an inner layer should not depend on an outer layer.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.430.1">
     Now that we have defined the architecture and also the technologies, let’s build our product API.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-60">
    <a id="_idTextAnchor065">
    </a>
    <span class="koboSpan" id="kobo.431.1">
     Creating the endpoints of our product API
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.432.1">
     As mentioned
    </span>
    <a id="_idIndexMarker118">
    </a>
    <span class="koboSpan" id="kobo.433.1">
     previously, to create our product API, we are going to use Spring Boot.
    </span>
    <span class="koboSpan" id="kobo.433.2">
     We recommend using the latest version of Spring and Java (JDK); we will be using the following versions:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.434.1">
      Java 21
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.435.1">
      Spring Boot 3.2.5
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.436.1">
     Before starting to create our API, we will define an interface with all the expected endpoints:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.437.1">public interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.438.1">ProductsApi</span></span><span class="koboSpan" id="kobo.439.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.440.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.441.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.442.1">ProductOutput</span></span><span class="koboSpan" id="kobo.443.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.444.1">createOrUpdateProduct</span></span><span class="koboSpan" id="kobo.445.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.446.1">String</span></span><span class="koboSpan" id="kobo.447.1"> productId,
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.448.1">Valid</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.449.1">ProductInput</span></span><span class="koboSpan" id="kobo.450.1"> productInput);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.451.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.452.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.453.1">Void</span></span><span class="koboSpan" id="kobo.454.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.455.1">deleteProduct</span></span><span class="koboSpan" id="kobo.456.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.457.1">String</span></span><span class="koboSpan" id="kobo.458.1"> productId);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.459.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.460.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.461.1">ProductOutput</span></span><span class="koboSpan" id="kobo.462.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.463.1">editProductDescription</span></span><span class="koboSpan" id="kobo.464.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.465.1">String</span></span><span class="koboSpan" id="kobo.466.1"> productId,
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.467.1">Valid</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.468.1">ProductDescriptionInput</span></span><span class="koboSpan" id="kobo.469.1"> input);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.470.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.471.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.472.1">ProductOutput</span></span><span class="koboSpan" id="kobo.473.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.474.1">getProductById</span></span><span class="koboSpan" id="kobo.475.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.476.1">String</span></span><span class="koboSpan" id="kobo.477.1"> productId);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.478.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.479.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.480.1">List</span></span><span class="koboSpan" id="kobo.481.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.482.1">ProductOutput</span></span><span class="koboSpan" id="kobo.483.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.484.1">getProducts</span></span><span class="koboSpan" id="kobo.485.1">();
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.486.1">
     This “
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.487.1">
      ProductsAPI
     </span>
    </code>
    <span class="koboSpan" id="kobo.488.1">
     " interface contains all the expected endpoints defined in the design step.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.489.1">
     Because we
    </span>
    <a id="_idIndexMarker119">
    </a>
    <span class="koboSpan" id="kobo.490.1">
     are following clean architecture guidelines, we defined three
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.491.1">
      data transfer objects
     </span>
    </strong>
    <span class="koboSpan" id="kobo.492.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.493.1">
      DTOs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.494.1">
     ) for input and output:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.495.1">
      ProductOutput
     </span>
    </code>
    <span class="koboSpan" id="kobo.496.1">
     ,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.497.1">
      ProductInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.498.1">
     , and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.499.1">
      ProductDescriptionInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.500.1">
     .
    </span>
    <span class="koboSpan" id="kobo.500.2">
     Utilizing these DTOs enables us to modify them without affecting our domain classes.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.501.1">
     To create our product API, we will have to define a Spring controller.
    </span>
    <span class="koboSpan" id="kobo.501.2">
     This class will be managed by Spring to handle requests to our endpoints.
    </span>
    <span class="koboSpan" id="kobo.501.3">
     Our API class will implement the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.502.1">
      ProductsApi
     </span>
    </code>
    <span class="koboSpan" id="kobo.503.1">
     interface, and we will need to add two annotations,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.504.1">
      @RestController
     </span>
    </code>
    <span class="koboSpan" id="kobo.505.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.506.1">
      @RequestMapping("/api/products")
     </span>
    </code>
    <span class="koboSpan" id="kobo.507.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.508.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.509.1">RestController</span></span><span class="koboSpan" id="kobo.510.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.511.1">RequestMapping</span></span><span class="koboSpan" id="kobo.512.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.513.1">"/api/products"</span></span><span class="koboSpan" id="kobo.514.1">)
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.515.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.516.1">ProductsApiController</span></span><span class="koboSpan" id="kobo.517.1"> implements </span><span class="hljs-title"><span class="koboSpan" id="kobo.518.1">ProductsApi</span></span><span class="koboSpan" id="kobo.519.1"> {
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.520.1">ProductsQueryUseCase</span></span><span class="koboSpan" id="kobo.521.1"> productsQueryUseCase;
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.522.1">ProductsCommandUseCase</span></span><span class="koboSpan" id="kobo.523.1"> productsCommandUseCase;
    private final </span><span class="hljs-title"><span class="koboSpan" id="kobo.524.1">ProductMapper</span></span><span class="koboSpan" id="kobo.525.1"> productMapper;
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.526.1">ProductsApiController</span></span><span class="koboSpan" id="kobo.527.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.528.1">ProductsQueryUseCase</span></span><span class="koboSpan" id="kobo.529.1"> productsQueryUseCase,
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.530.1">ProductsCommandUseCase</span></span><span class="koboSpan" id="kobo.531.1"> productsCommandUseCase,
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.532.1">ProductMapper</span></span><span class="koboSpan" id="kobo.533.1"> productMapper) {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.534.1">this</span></span><span class="koboSpan" id="kobo.535.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.536.1">productsQueryUseCase</span></span><span class="koboSpan" id="kobo.537.1"> = productsQueryUseCase;
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.538.1">this</span></span><span class="koboSpan" id="kobo.539.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.540.1">productsCommandUseCase</span></span><span class="koboSpan" id="kobo.541.1"> = productsCommandUseCase;
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.542.1">this</span></span><span class="koboSpan" id="kobo.543.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.544.1">productMapper</span></span><span class="koboSpan" id="kobo.545.1"> = productMapper;
    }
  ...
</span><span class="koboSpan" id="kobo.545.2">}
</span></code></pre>
   <p class="normal">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.546.1">
      @RestController
     </span>
    </code>
    <span class="koboSpan" id="kobo.547.1">
     is used
    </span>
    <a id="_idIndexMarker120">
    </a>
    <span class="koboSpan" id="kobo.548.1">
     to create a bean managed
    </span>
    <a id="_idIndexMarker121">
    </a>
    <span class="koboSpan" id="kobo.549.1">
     by Spring.
    </span>
    <span class="koboSpan" id="kobo.549.2">
     This controller will handle the endpoint requests mapped by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.550.1">
      @RequestMapping("/api/products")
     </span>
    </code>
    <span class="koboSpan" id="kobo.551.1">
     annotation, meaning that all requests whose URI matches the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.552.1">
      /api/products
     </span>
    </code>
    <span class="koboSpan" id="kobo.553.1">
     pattern will be handled by our controller.
    </span>
   </p>
   <div class="note">
    <div>
     <span class="koboSpan" id="kobo.554.1">
      <img alt="img" src="../Images/Information_Box_Icon.png"/>
     </span>
    </div>
    <p class="normal">
     <span class="koboSpan" id="kobo.555.1">
      Using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.556.1">
       @RestController
      </span>
     </code>
     <span class="koboSpan" id="kobo.557.1">
      is recommended for creating RESTful APIs with the Spring Framework.
     </span>
     <span class="koboSpan" id="kobo.557.2">
      It is a shortcut for the combination of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.558.1">
       @Controller
      </span>
     </code>
     <span class="koboSpan" id="kobo.559.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.560.1">
       @ResponseBody
      </span>
     </code>
     <span class="koboSpan" id="kobo.561.1">
      annotations.
     </span>
    </p>
   </div>
   <p class="normal">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.562.1">
      ProductsQueryUseCase
     </span>
    </code>
    <span class="koboSpan" id="kobo.563.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.564.1">
      ProductsCommandUseCase
     </span>
    </code>
    <span class="koboSpan" id="kobo.565.1">
     are the implementations of our use cases.
    </span>
    <span class="koboSpan" id="kobo.565.2">
     We are segregating the query and command responsibilities using the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.566.1">
      Command Query Responsibility Segregation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.567.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.568.1">
      CQRS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.569.1">
     ) pattern.
    </span>
    <span class="koboSpan" id="kobo.569.2">
     This
    </span>
    <a id="_idIndexMarker122">
    </a>
    <span class="koboSpan" id="kobo.570.1">
     pattern is commonly used in software architecture to separate the responsibilities of reading data (queries) from writing data (commands).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.571.1">
     CQRS is useful in systems where read and write operations have different characteristics or performance requirements.
    </span>
    <span class="koboSpan" id="kobo.571.2">
     It promotes a clear separation of concerns, leading to more maintainable and scalable architecture.
    </span>
    <span class="koboSpan" id="kobo.571.3">
     By segregating these responsibilities, we can later
    </span>
    <a id="_idIndexMarker123">
    </a>
    <span class="koboSpan" id="kobo.572.1">
     decide to break the API into two microservices and scale them separately.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.573.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.574.1">
      ProductMapper
     </span>
    </code>
    <span class="koboSpan" id="kobo.575.1">
     class
    </span>
    <a id="_idIndexMarker124">
    </a>
    <span class="koboSpan" id="kobo.576.1">
     uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.577.1">
      MapStruct
     </span>
    </code>
    <span class="koboSpan" id="kobo.578.1">
     library to transform one object into another object; in our case, we are mapping the data from our domain to our DTO.
    </span>
    <span class="koboSpan" id="kobo.578.2">
     Let’s see how we can implement it:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.579.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.580.1">Mapper</span></span><span class="koboSpan" id="kobo.581.1">(componentModel = </span><span class="hljs-string"><span class="koboSpan" id="kobo.582.1">"spring"</span></span><span class="koboSpan" id="kobo.583.1">)
public interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.584.1">ProductMapper</span></span><span class="koboSpan" id="kobo.585.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.586.1">ProductOutput</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.587.1">toProductOutput</span></span><span class="koboSpan" id="kobo.588.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.589.1">Product</span></span><span class="koboSpan" id="kobo.590.1"> product);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.591.1">
     The implementation of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.592.1">
      ProductMapper
     </span>
    </code>
    <span class="koboSpan" id="kobo.593.1">
     is generated during the compilation phase.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-61">
    <a id="_idTextAnchor066">
    </a>
    <span class="koboSpan" id="kobo.594.1">
     Implementing the product API endpoints
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.595.1">
     In this
    </span>
    <a id="_idIndexMarker125">
    </a>
    <span class="koboSpan" id="kobo.596.1">
     section, we will implement the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.597.1">
      ProductsApiController
     </span>
    </code>
    <span class="koboSpan" id="kobo.598.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.598.2">
     This will involve adding all the endpoints we defined
    </span>
    <a id="_idIndexMarker126">
    </a>
    <span class="koboSpan" id="kobo.599.1">
     in the previous sections, enabling full functionality for creating, retrieving, updating, and deleting products in our API.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-62">
    <a id="_idTextAnchor067">
    </a>
    <span class="koboSpan" id="kobo.600.1">
     Create or update product endpoint
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.601.1">
     To implement
    </span>
    <a id="_idIndexMarker127">
    </a>
    <span class="koboSpan" id="kobo.602.1">
     this endpoint, we’ll need to use Spring annotations.
    </span>
    <span class="koboSpan" id="kobo.602.2">
     For
    </span>
    <a id="_idIndexMarker128">
    </a>
    <span class="koboSpan" id="kobo.603.1">
     the create operation, it’s advisable to employ either
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.604.1">
      @PutMapping
     </span>
    </code>
    <span class="koboSpan" id="kobo.605.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.606.1">
      @PostMapping
     </span>
    </code>
    <span class="koboSpan" id="kobo.607.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.608.1">    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.609.1">PutMapping</span></span><span class="koboSpan" id="kobo.610.1">(value = </span><span class="hljs-string"><span class="koboSpan" id="kobo.611.1">"/{productId}"</span></span><span class="koboSpan" id="kobo.612.1">)
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.613.1">Override</span></span><span class="koboSpan" id="kobo.614.1">
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.615.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.616.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.617.1">ProductOutput</span></span><span class="koboSpan" id="kobo.618.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.619.1">createOrUpdateProduct</span></span><span class="koboSpan" id="kobo.620.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.621.1">        @PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.622.1">"productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.623.1">) @ValidSku </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.624.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.625.1"> productId,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.626.1">        @Valid @RequestBody ProductInput productInput</span></span><span class="koboSpan" id="kobo.627.1">) {
        final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.628.1">var</span></span><span class="koboSpan" id="kobo.629.1"> product = productsCommandUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.630.1">createProduct</span></span><span class="koboSpan" id="kobo.631.1">(
            productInput.</span><span class="hljs-title"><span class="koboSpan" id="kobo.632.1">toProduct</span></span><span class="koboSpan" id="kobo.633.1">(productId));
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.634.1">HttpStatus</span></span><span class="koboSpan" id="kobo.635.1"> status = product.</span><span class="hljs-title"><span class="koboSpan" id="kobo.636.1">isNewProduct</span></span><span class="koboSpan" id="kobo.637.1">() ? </span><span class="hljs-title"><span class="koboSpan" id="kobo.638.1">HttpStatus</span></span><span class="koboSpan" id="kobo.639.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.640.1">CREATED</span></span><span class="koboSpan" id="kobo.641.1"> :
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.642.1">HttpStatus</span></span><span class="koboSpan" id="kobo.643.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.644.1">OK</span></span><span class="koboSpan" id="kobo.645.1">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.646.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.647.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.648.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.649.1">status</span></span><span class="koboSpan" id="kobo.650.1">(status)
              .</span><span class="hljs-title"><span class="koboSpan" id="kobo.651.1">body</span></span><span class="koboSpan" id="kobo.652.1">(productMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.653.1">toProductOutput</span></span><span class="koboSpan" id="kobo.654.1">(product.</span><span class="hljs-title"><span class="koboSpan" id="kobo.655.1">product</span></span><span class="koboSpan" id="kobo.656.1">()));
     }
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.657.1">
     In our case, we decided to use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.658.1">
      PUT
     </span>
    </code>
    <span class="koboSpan" id="kobo.659.1">
     annotation; this decision was made because our method
    </span>
    <a id="_idIndexMarker129">
    </a>
    <span class="koboSpan" id="kobo.660.1">
     is idempotent, so we can use this method to
    </span>
    <a id="_idIndexMarker130">
    </a>
    <span class="koboSpan" id="kobo.661.1">
     update or create the product.
    </span>
    <span class="koboSpan" id="kobo.661.2">
     One of the requirements is to not allow two products to have the same SKU; in our case, we can update or create the product if it does not exist.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.662.1">
     We then have two annotations for the input,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.663.1">
      @Valid
     </span>
    </code>
    <span class="koboSpan" id="kobo.664.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.665.1">
      @RequestBody
     </span>
    </code>
    <span class="koboSpan" id="kobo.666.1">
     .
    </span>
    <span class="koboSpan" id="kobo.666.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.667.1">
      @Valid
     </span>
    </code>
    <span class="koboSpan" id="kobo.668.1">
     annotation will be discussed in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.669.1">
      Bean Validation
     </span>
    </em>
    <span class="koboSpan" id="kobo.670.1">
     section.
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.671.1">
      @RequestBody
     </span>
    </code>
    <span class="koboSpan" id="kobo.672.1">
     means that we should send the input by passing it into the body of the request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.673.1">
     Following best practices, this method can return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.674.1">
      200 (ok)
     </span>
    </code>
    <span class="koboSpan" id="kobo.675.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.676.1">
      201 (created)
     </span>
    </code>
    <span class="koboSpan" id="kobo.677.1">
     , depending on whether the product already exists or not.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.678.1">
     All API call
    </span>
    <a id="_idIndexMarker131">
    </a>
    <span class="koboSpan" id="kobo.679.1">
     examples will be demonstrated using a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.680.1">
      curl
     </span>
    </code>
    <span class="koboSpan" id="kobo.681.1">
     command, but you can easily perform the same requests using various tools, such as
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.682.1">
      Postman
     </span>
    </strong>
    <span class="koboSpan" id="kobo.683.1">
     or
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.684.1">
      UseBruno
     </span>
    </strong>
    <span class="koboSpan" id="kobo.685.1">
     , directly from
    </span>
    <a id="_idIndexMarker132">
    </a>
    <span class="koboSpan" id="kobo.686.1">
     your IDE, or with any other API testing tool of your choice.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.687.1">
     To call this endpoint, we can use a request as follows:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.688.1"> curl -X 'PUT' \
  'http</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.689.1">:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.690.1">//localhost:8080/api/products/AK21101' \</span></span><span class="koboSpan" id="kobo.691.1">
  -H 'accept</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.692.1">:</span></span><span class="koboSpan" id="kobo.693.1"> application/json' \
  -H 'Content-Type</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.694.1">:</span></span><span class="koboSpan" id="kobo.695.1"> application/json' \
  -d '</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.696.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.697.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.698.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.699.1">"Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.700.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.701.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.702.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.703.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.704.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.705.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.706.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.707.1">60</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.708.1">}</span></span><span class="koboSpan" id="kobo.709.1">'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.710.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.711.1">HTTP/</span><span class="hljs-number"><span class="koboSpan" id="kobo.712.1">1.1</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.713.1">201</span></span><span class="koboSpan" id="kobo.714.1">
Content-Type</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.715.1">:</span></span><span class="koboSpan" id="kobo.716.1"> application/json
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.717.1">{</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.718.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.719.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.720.1">"Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.721.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.722.1">"sku"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.723.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.724.1">"AK21101"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.725.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.726.1">"description"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.727.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.728.1">"Ergonomic Keyboard"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.729.1">,</span></span>
  <span class="hljs-attr"><span class="koboSpan" id="kobo.730.1">"price"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.731.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.732.1">60.00</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.733.1">}</span></span>
</code></pre>
   <h3 class="heading-3" id="_idParaDest-63">
    <a id="_idTextAnchor068">
    </a>
    <span class="koboSpan" id="kobo.734.1">
     Get all products endpoint
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.735.1">
     To return
    </span>
    <a id="_idIndexMarker133">
    </a>
    <span class="koboSpan" id="kobo.736.1">
     all the products, we need to use the HTTP
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.737.1">
      GET
     </span>
    </code>
    <span class="koboSpan" id="kobo.738.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.739.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.740.1">GetMapping</span></span><span class="koboSpan" id="kobo.741.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.742.1">Override</span></span><span class="koboSpan" id="kobo.743.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.744.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.745.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.746.1">List</span></span><span class="koboSpan" id="kobo.747.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.748.1">ProductOutput</span></span><span class="koboSpan" id="kobo.749.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.750.1">getProducts</span></span><span class="koboSpan" id="kobo.751.1">() {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.752.1">var</span></span><span class="koboSpan" id="kobo.753.1"> products = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.754.1">getAllProducts</span></span><span class="koboSpan" id="kobo.755.1">()
          .</span><span class="hljs-title"><span class="koboSpan" id="kobo.756.1">stream</span></span><span class="koboSpan" id="kobo.757.1">()
          .</span><span class="hljs-title"><span class="koboSpan" id="kobo.758.1">map</span></span><span class="koboSpan" id="kobo.759.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.760.1">productMapper</span></span><span class="koboSpan" id="kobo.761.1">::toProductOutput)
          .</span><span class="hljs-title"><span class="koboSpan" id="kobo.762.1">toList</span></span><span class="koboSpan" id="kobo.763.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.764.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.765.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.766.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.767.1">status</span></span><span class="koboSpan" id="kobo.768.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.769.1">HttpStatus</span></span><span class="koboSpan" id="kobo.770.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.771.1">OK</span></span><span class="koboSpan" id="kobo.772.1">)
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.773.1">body</span></span><span class="koboSpan" id="kobo.774.1">(products);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.775.1">
     To call this endpoint, we can use a request as follows:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.776.1">curl -X 'GET' \
  'http</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.777.1">:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.778.1">//localhost:8080/api/products' \</span></span><span class="koboSpan" id="kobo.779.1">
  -H 'accept</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.780.1">:</span></span><span class="koboSpan" id="kobo.781.1"> application/json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.782.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.783.1">HTTP/1.1 200
Content-Type: application/json
[
  {
    "name": "Keyboard",
    "sku": "AK21101",
    "description": "Ergonomic Keyboard",
    "price": 60.00
  }
]
</span></code></pre>
   <h3 class="heading-3" id="_idParaDest-64">
    <a id="_idTextAnchor069">
    </a>
    <span class="koboSpan" id="kobo.784.1">
     Get product by ID endpoint
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.785.1">
     To return
    </span>
    <a id="_idIndexMarker134">
    </a>
    <span class="koboSpan" id="kobo.786.1">
     the product by ID, we need to use the HTTP
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.787.1">
      GET
     </span>
    </code>
    <span class="koboSpan" id="kobo.788.1">
     method and pass the ID as a path parameter:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.789.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.790.1">GetMapping</span></span><span class="koboSpan" id="kobo.791.1">(value = </span><span class="hljs-string"><span class="koboSpan" id="kobo.792.1">"/{productId}"</span></span><span class="koboSpan" id="kobo.793.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.794.1">Override</span></span><span class="koboSpan" id="kobo.795.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.796.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.797.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.798.1">ProductOutput</span></span><span class="koboSpan" id="kobo.799.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.800.1">getProductById</span></span><span class="koboSpan" id="kobo.801.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.802.1">@PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.803.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.804.1">productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.805.1">) </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.806.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.807.1"> productId</span></span><span class="koboSpan" id="kobo.808.1">) {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.809.1">var</span></span><span class="koboSpan" id="kobo.810.1"> product = productsQueryUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.811.1">getProductById</span></span><span class="koboSpan" id="kobo.812.1">(productId);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.813.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.814.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.815.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.816.1">status</span></span><span class="koboSpan" id="kobo.817.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.818.1">HttpStatus</span></span><span class="koboSpan" id="kobo.819.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.820.1">OK</span></span><span class="koboSpan" id="kobo.821.1">)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.822.1">body</span></span><span class="koboSpan" id="kobo.823.1">(productMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.824.1">toProductOutput</span></span><span class="koboSpan" id="kobo.825.1">(product));
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.826.1">
     This endpoint uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.827.1">
      @PathVariable("productId")
     </span>
    </code>
    <span class="koboSpan" id="kobo.828.1">
     annotation and expects to have
    </span>
    <a id="_idIndexMarker135">
    </a>
    <span class="koboSpan" id="kobo.829.1">
     this value in the URI.
    </span>
    <span class="koboSpan" id="kobo.829.2">
     We also need to add this path variable ID to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.830.1">
      @GetMapping
     </span>
    </code>
    <span class="koboSpan" id="kobo.831.1">
     mapping annotation.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.832.1">
     In case of success, we should return the HTTP status
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.833.1">
      200
     </span>
    </code>
    <span class="koboSpan" id="kobo.834.1">
     code and return the product content.
    </span>
    <span class="koboSpan" id="kobo.834.2">
     Otherwise, we can return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.835.1">
      404
     </span>
    </code>
    <span class="koboSpan" id="kobo.836.1">
     , meaning the product does not exist.
    </span>
    <span class="koboSpan" id="kobo.836.2">
     We are going to see how to handle errors in the next section.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.837.1">
     To call this endpoint, we can use the following request:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.838.1"> curl -X 'GET' \
  'http://localhost:8080/api/products/AK21101' \
  -H 'accept: application/json'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.839.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.840.1">HTTP/1.1 200
Content-Type: application/json
{
  "name": "Keyboard",
  "sku": "AK21101",
  "description": "Ergonomic Keyboard",
  "price": 60.00
}
</span></code></pre>
   <h3 class="heading-3" id="_idParaDest-65">
    <a id="_idTextAnchor070">
    </a>
    <span class="koboSpan" id="kobo.841.1">
     Delete product by ID endpoint
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.842.1">
     Deleting
    </span>
    <a id="_idIndexMarker136">
    </a>
    <span class="koboSpan" id="kobo.843.1">
     a product by ID is very similar to getting a product by ID, with the big difference being the HTTP method; in this case, we should use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.844.1">
      DELETE
     </span>
    </code>
    <span class="koboSpan" id="kobo.845.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.846.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.847.1">DeleteMapping</span></span><span class="koboSpan" id="kobo.848.1">(value = </span><span class="hljs-string"><span class="koboSpan" id="kobo.849.1">"/{productId}"</span></span><span class="koboSpan" id="kobo.850.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.851.1">Override</span></span><span class="koboSpan" id="kobo.852.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.853.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.854.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.855.1">Void</span></span><span class="koboSpan" id="kobo.856.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.857.1">deleteProduct</span></span><span class="koboSpan" id="kobo.858.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.859.1">@PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.860.1">"productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.861.1">) </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.862.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.863.1"> productId</span></span><span class="koboSpan" id="kobo.864.1">) {
    productsCommandUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.865.1">deleteProduct</span></span><span class="koboSpan" id="kobo.866.1">(productId);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.867.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.868.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.869.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.870.1">noContent</span></span><span class="koboSpan" id="kobo.871.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.872.1">build</span></span><span class="koboSpan" id="kobo.873.1">();
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.874.1">
     This method is very similar to the previous one.
    </span>
    <span class="koboSpan" id="kobo.874.2">
     The big difference is the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.875.1">
      @DeleteMapping
     </span>
    </code>
    <span class="koboSpan" id="kobo.876.1">
     annotation and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.877.1">
      return
     </span>
    </code>
    <span class="koboSpan" id="kobo.878.1">
     .
    </span>
    <span class="koboSpan" id="kobo.878.2">
     In this case, we return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.879.1">
      204 (no content)
     </span>
    </code>
    <span class="koboSpan" id="kobo.880.1">
     HTTP status.
    </span>
    <span class="koboSpan" id="kobo.880.2">
     This means that we did not provide any content and the request was done successfully.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.881.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.882.1">
      DELETE
     </span>
    </code>
    <span class="koboSpan" id="kobo.883.1">
     method is idempotent; because of this, we can return
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.884.1">
      204
     </span>
    </code>
    <span class="koboSpan" id="kobo.885.1">
     whether the product exists or not.
    </span>
    <span class="koboSpan" id="kobo.885.2">
     As the expected behavior will be the same, the product will not exist in the database.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.886.1">
     To call
    </span>
    <a id="_idIndexMarker137">
    </a>
    <span class="koboSpan" id="kobo.887.1">
     this endpoint, we can use the following request:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.888.1"> curl -X 'DELETE' \
  'http://localhost:8080/api/products/AK21101' \
  -H 'accept: */*'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.889.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.890.1">HTTP/1.1 204
</span></code></pre>
   <h3 class="heading-3" id="_idParaDest-66">
    <a id="_idTextAnchor071">
    </a>
    <span class="koboSpan" id="kobo.891.1">
     Update product description by ID endpoint
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.892.1">
     The endpoint for updating the product description by ID is much like the one for retrieving a product.
    </span>
    <span class="koboSpan" id="kobo.892.2">
     In this case, we will use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.893.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.894.1">
     method, as it is a partial update, so the client will only pass a body with the content that is changed:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.895.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.896.1">PatchMapping</span></span><span class="koboSpan" id="kobo.897.1">(value = </span><span class="hljs-string"><span class="koboSpan" id="kobo.898.1">"/{productId}"</span></span><span class="koboSpan" id="kobo.899.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.900.1">Override</span></span><span class="koboSpan" id="kobo.901.1">
public </span><span class="hljs-title"><span class="koboSpan" id="kobo.902.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.903.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.904.1">ProductOutput</span></span><span class="koboSpan" id="kobo.905.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.906.1">editProductDescription</span></span><span class="koboSpan" id="kobo.907.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.908.1">@PathVariable(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.909.1">"productId"</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.910.1">) </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.911.1">String</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.912.1"> productId,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.913.1">@RequestBody @Valid ProductDescriptionInput input</span></span><span class="koboSpan" id="kobo.914.1">) {
    final </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.915.1">var</span></span><span class="koboSpan" id="kobo.916.1"> product = productsCommandUseCase.</span><span class="hljs-title"><span class="koboSpan" id="kobo.917.1">updateProductDescription</span></span><span class="koboSpan" id="kobo.918.1">(
        productId, input.</span><span class="hljs-title"><span class="koboSpan" id="kobo.919.1">description</span></span><span class="koboSpan" id="kobo.920.1">());
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.921.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.922.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.923.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.924.1">status</span></span><span class="koboSpan" id="kobo.925.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.926.1">HttpStatus</span></span><span class="koboSpan" id="kobo.927.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.928.1">OK</span></span><span class="koboSpan" id="kobo.929.1">)
            .</span><span class="hljs-title"><span class="koboSpan" id="kobo.930.1">body</span></span><span class="koboSpan" id="kobo.931.1">(productMapper.</span><span class="hljs-title"><span class="koboSpan" id="kobo.932.1">toProductOutput</span></span><span class="koboSpan" id="kobo.933.1">(product));
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.934.1">
     This
    </span>
    <a id="_idIndexMarker138">
    </a>
    <span class="koboSpan" id="kobo.935.1">
     method receives the product ID in
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.936.1">
      @PathVariable
     </span>
    </code>
    <span class="koboSpan" id="kobo.937.1">
     and uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.938.1">
      @PatchMapping
     </span>
    </code>
    <span class="koboSpan" id="kobo.939.1">
     annotation to map it to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.940.1">
      PATCH
     </span>
    </code>
    <span class="koboSpan" id="kobo.941.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.941.2">
     This method also has an input argument of type
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.942.1">
      ProductDescriptionInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.943.1">
     with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.944.1">
      @RequestBody
     </span>
    </code>
    <span class="koboSpan" id="kobo.945.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.946.1">
      @Valid
     </span>
    </code>
    <span class="koboSpan" id="kobo.947.1">
     annotations.
    </span>
    <span class="koboSpan" id="kobo.947.2">
     The input argument represents the request body containing the description of the product that the client would like to change.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.948.1">
     To call this endpoint, we can use the following request:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.949.1"> curl -X 'PATCH' \
  'http://localhost:8080/api/products/AK21101' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "description": "Ergonomic Keyboard 2.0"
}'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.950.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.951.1">HTTP/1.1 200
Content-Type: application/json
{
  "name": "Keyboard",
  "sku": "AK21101",
  "description": "Ergonomic Keyboard 2.0",
  "price": 60.00
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.952.1">
     With
    </span>
    <a id="_idIndexMarker139">
    </a>
    <span class="koboSpan" id="kobo.953.1">
     our endpoints in place, our API class is now complete.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.954.1">
     You can access the full code with the following link:
    </span>
    <a href="https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/blob/main/chapter2/product-api/src/main/java/com/packt/productapi/adapter/inbound/rest/ProductsApiController.java">
     <span class="url">
      <span class="koboSpan" id="kobo.955.1">
       https://github.com/PacktPublishing/Mastering-RESTful-Web-Services-with-Java/blob/main/chapter2/product-api/src/main/java/com/packt/productapi/adapter/inbound/rest/ProductsApiController.java
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.956.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.957.1">
     The code of our API is done; now we can call the endpoints and test them.
    </span>
    <span class="koboSpan" id="kobo.957.2">
     However, what happens if the product does not exist, or we send invalid data?
    </span>
    <span class="koboSpan" id="kobo.957.3">
     We need to cover the negative cases.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-67">
    <a id="_idTextAnchor072">
    </a>
    <span class="koboSpan" id="kobo.958.1">
     Exception handling
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.959.1">
     Exception handling is
    </span>
    <a id="_idIndexMarker140">
    </a>
    <span class="koboSpan" id="kobo.960.1">
     the part of the implementation where we respond to errors or exceptional
    </span>
    <a id="_idIndexMarker141">
    </a>
    <span class="koboSpan" id="kobo.961.1">
     situations that occur during a program’s execution.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.962.1">
     In a RESTful API, many types of errors can occur, usually belonging to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.963.1">
      4xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.964.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.965.1">
      5xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.966.1">
     group of HTTP status codes.
    </span>
    <span class="koboSpan" id="kobo.966.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.967.1">
      5xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.968.1">
     statuses mean that there is an error in the server application.
    </span>
    <span class="koboSpan" id="kobo.968.2">
     They can be caused by external factors on the server side (e.g., unavailability of a database server) or a bug in the application (e.g.,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.969.1">
      NullPointerException
     </span>
    </code>
    <span class="koboSpan" id="kobo.970.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.970.2">
     On the other hand, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.971.1">
      4xx
     </span>
    </code>
    <span class="koboSpan" id="kobo.972.1">
     statuses indicate errors caused by the client.
    </span>
    <span class="koboSpan" id="kobo.972.2">
     For example,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.973.1">
      405 (Method Not Allowed)
     </span>
    </code>
    <span class="koboSpan" id="kobo.974.1">
     is automatically generated by the Spring Framework when the client tries to use an HTTP method not expected by the API.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.975.1">
     Spring and Java provide many ways to handle exceptions.
    </span>
    <span class="koboSpan" id="kobo.975.2">
     We can create a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.976.1">
      try-catch
     </span>
    </code>
    <span class="koboSpan" id="kobo.977.1">
     block in each endpoint and handle them one by one; we can also have a custom
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.978.1">
      ExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.979.1">
     for each controller or have a global exception handler.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.980.1">
     We will be
    </span>
    <a id="_idIndexMarker142">
    </a>
    <span class="koboSpan" id="kobo.981.1">
     implementing global exception handling in our API.
    </span>
    <span class="koboSpan" id="kobo.981.2">
     This approach helps to prevent repeated code and ensures uniform behavior across all endpoints, especially if the API exposes multiple resources.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.982.1">
     Spring
    </span>
    <a id="_idIndexMarker143">
    </a>
    <span class="koboSpan" id="kobo.983.1">
     Frameworks supports the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.984.1">
      Problem Details for HTTP APIs
     </span>
    </em>
    <span class="koboSpan" id="kobo.985.1">
     specification, RFC 9457.
    </span>
    <span class="koboSpan" id="kobo.985.2">
     This RFC is an updated standard that builds upon RFC 7807.
    </span>
    <span class="koboSpan" id="kobo.985.3">
     The main goal is to provide detailed information about errors in HTTP APIs by defining five fields:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.986.1">
       Type
      </span>
     </code>
     <span class="koboSpan" id="kobo.987.1">
      : This should contain a URI that identifies the problem type
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.988.1">
       Status
      </span>
     </code>
     <span class="koboSpan" id="kobo.989.1">
      : This indicates the HTTP status code
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.990.1">
       Title
      </span>
     </code>
     <span class="koboSpan" id="kobo.991.1">
      : The title is a concise summary of the problem
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.992.1">
       Detail
      </span>
     </code>
     <span class="koboSpan" id="kobo.993.1">
      : This field should contain more detailed information about the problem
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.994.1">
       Instance
      </span>
     </code>
     <span class="koboSpan" id="kobo.995.1">
      : This should contain a URI that identifies the endpoint call
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.996.1">
     In Spring, we can follow the RFC guidelines by extending the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.997.1">
      ResponseEntityExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.998.1">
     class or enabling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.999.1">
      spring.mvc.problemdetails.enabled
     </span>
    </code>
    <span class="koboSpan" id="kobo.1000.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.1000.2">
     We will extend the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1001.1">
      ResponseEntityExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1002.1">
     class, which provides the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1003.1">
      ProblemDetail
     </span>
    </code>
    <span class="koboSpan" id="kobo.1004.1">
     class with the five elements defined by RFC 9457.
    </span>
    <span class="koboSpan" id="kobo.1004.2">
     We can also add some extensions, which we will do to provide better response errors in
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1005.1">
      400 (Bad Request)
     </span>
    </code>
    <span class="koboSpan" id="kobo.1006.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1007.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1008.1">ControllerAdvice</span></span><span class="koboSpan" id="kobo.1009.1">
public </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1010.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1011.1">GlobalExceptionHandler</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1012.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1013.1">ResponseEntityExceptionHandler</span></span><span class="koboSpan" id="kobo.1014.1"> {
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1015.1">ExceptionHandler</span></span><span class="koboSpan" id="kobo.1016.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1017.1">EntityNotFoundException</span></span><span class="koboSpan" id="kobo.1018.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1019.1">class</span></span><span class="koboSpan" id="kobo.1020.1">)
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1021.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1022.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1023.1">Object</span></span><span class="koboSpan" id="kobo.1024.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1025.1">handleNotFound</span></span><span class="koboSpan" id="kobo.1026.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.1027.1">        EntityNotFoundException exception, WebRequest request</span></span><span class="koboSpan" id="kobo.1028.1">) {
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1029.1">ProblemDetail</span></span><span class="koboSpan" id="kobo.1030.1"> problemDetail = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1031.1">ProblemDetail</span></span><span class="koboSpan" id="kobo.1032.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1033.1">forStatusAndDetail</span></span><span class="koboSpan" id="kobo.1034.1">(
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1035.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1036.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1037.1">NOT_FOUND</span></span><span class="koboSpan" id="kobo.1038.1">, exception.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1039.1">getMessage</span></span><span class="koboSpan" id="kobo.1040.1">());
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1041.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1042.1">this</span></span><span class="koboSpan" id="kobo.1043.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1044.1">handleExceptionInternal</span></span><span class="koboSpan" id="kobo.1045.1">(exception, problemDetail,
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1046.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1047.1">HttpHeaders</span></span><span class="koboSpan" id="kobo.1048.1">(), </span><span class="hljs-title"><span class="koboSpan" id="kobo.1049.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1050.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1051.1">NOT_FOUND</span></span><span class="koboSpan" id="kobo.1052.1">, request);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1053.1">ExceptionHandler</span></span><span class="koboSpan" id="kobo.1054.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1055.1">ConstraintViolationException</span></span><span class="koboSpan" id="kobo.1056.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1057.1">class</span></span><span class="koboSpan" id="kobo.1058.1">)
    public </span><span class="hljs-title"><span class="koboSpan" id="kobo.1059.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1060.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1061.1">Object</span></span><span class="koboSpan" id="kobo.1062.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1063.1">handleBadRequestDueToBeanValidation</span></span><span class="koboSpan" id="kobo.1064.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.1065.1">        ConstraintViolationException ex, WebRequest request</span></span><span class="koboSpan" id="kobo.1066.1">) {
        final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1067.1">Set</span></span><span class="koboSpan" id="kobo.1068.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1069.1">String</span></span><span class="koboSpan" id="kobo.1070.1">&gt; errors = ex.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1071.1">getConstraintViolations</span></span><span class="koboSpan" id="kobo.1072.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1073.1">stream</span></span><span class="koboSpan" id="kobo.1074.1">()
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1075.1">map</span></span><span class="koboSpan" id="kobo.1076.1">(e -&gt; ((</span><span class="hljs-title"><span class="koboSpan" id="kobo.1077.1">PathImpl</span></span><span class="koboSpan" id="kobo.1078.1">) e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1079.1">getPropertyPath</span></span><span class="koboSpan" id="kobo.1080.1">())
                           .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1081.1">getLeafNode</span></span><span class="koboSpan" id="kobo.1082.1">() + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1083.1">": "</span></span><span class="koboSpan" id="kobo.1084.1"> + e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1085.1">getMessage</span></span><span class="koboSpan" id="kobo.1086.1">())
                .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1087.1">collect</span></span><span class="koboSpan" id="kobo.1088.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1089.1">Collectors</span></span><span class="koboSpan" id="kobo.1090.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1091.1">toSet</span></span><span class="koboSpan" id="kobo.1092.1">());
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1093.1">ProblemDetail</span></span><span class="koboSpan" id="kobo.1094.1"> problemDetail = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1095.1">ProblemDetail</span></span><span class="koboSpan" id="kobo.1096.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">forStatusAndDetail</span></span><span class="koboSpan" id="kobo.1098.1">(
            </span><span class="hljs-title"><span class="koboSpan" id="kobo.1099.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1100.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1101.1">BAD_REQUEST</span></span><span class="koboSpan" id="kobo.1102.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1103.1">"Invalid request content."</span></span><span class="koboSpan" id="kobo.1104.1">);
        problemDetail.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1105.1">setProperty</span></span><span class="koboSpan" id="kobo.1106.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1107.1">"errors"</span></span><span class="koboSpan" id="kobo.1108.1">, errors);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1109.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1110.1">this</span></span><span class="koboSpan" id="kobo.1111.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1112.1">handleExceptionInternal</span></span><span class="koboSpan" id="kobo.1113.1">(ex, problemDetail,
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1114.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1115.1">HttpHeaders</span></span><span class="koboSpan" id="kobo.1116.1">(), </span><span class="hljs-title"><span class="koboSpan" id="kobo.1117.1">HttpStatus</span></span><span class="koboSpan" id="kobo.1118.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1119.1">BAD_REQUEST</span></span><span class="koboSpan" id="kobo.1120.1">, request);
    }
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1121.1">Override</span></span><span class="koboSpan" id="kobo.1122.1">
    protected </span><span class="hljs-title"><span class="koboSpan" id="kobo.1123.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1124.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1125.1">Object</span></span><span class="koboSpan" id="kobo.1126.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1127.1">handleMethodArgumentNotValid</span></span><span class="koboSpan" id="kobo.1128.1">(
</span><span class="hljs-params"><span class="koboSpan" id="kobo.1129.1">        MethodArgumentNotValidException ex, HttpHeaders headers,</span></span>
<span class="hljs-params"><span class="koboSpan" id="kobo.1130.1">        HttpStatusCode status, WebRequest request</span></span><span class="koboSpan" id="kobo.1131.1">) {
        final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1132.1">List</span></span><span class="koboSpan" id="kobo.1133.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1134.1">String</span></span><span class="koboSpan" id="kobo.1135.1">&gt; errors = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1136.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1137.1">ArrayList</span></span><span class="koboSpan" id="kobo.1138.1">&lt;&gt;();
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1139.1">for</span></span><span class="koboSpan" id="kobo.1140.1"> (final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1141.1">FieldError</span></span><span class="koboSpan" id="kobo.1142.1"> error :
            ex.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1143.1">getBindingResult</span></span><span class="koboSpan" id="kobo.1144.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1145.1">getFieldErrors</span></span><span class="koboSpan" id="kobo.1146.1">()) {
                errors.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1147.1">add</span></span><span class="koboSpan" id="kobo.1148.1">(
                    error.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1149.1">getField</span></span><span class="koboSpan" id="kobo.1150.1">() + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1151.1">": "</span></span><span class="koboSpan" id="kobo.1152.1"> + error.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1153.1">getDefaultMessage</span></span><span class="koboSpan" id="kobo.1154.1">());
        }
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1155.1">for</span></span><span class="koboSpan" id="kobo.1156.1"> (final </span><span class="hljs-title"><span class="koboSpan" id="kobo.1157.1">ObjectError</span></span><span class="koboSpan" id="kobo.1158.1"> error :
            ex.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1159.1">getBindingResult</span></span><span class="koboSpan" id="kobo.1160.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1161.1">getGlobalErrors</span></span><span class="koboSpan" id="kobo.1162.1">()) {
                errors.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1163.1">add</span></span><span class="koboSpan" id="kobo.1164.1">(
                error.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1165.1">getObjectName</span></span><span class="koboSpan" id="kobo.1166.1">() + </span><span class="hljs-string"><span class="koboSpan" id="kobo.1167.1">": "</span></span><span class="koboSpan" id="kobo.1168.1"> + error.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1169.1">getDefaultMessage</span></span><span class="koboSpan" id="kobo.1170.1">());
        }
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1171.1">ProblemDetail</span></span><span class="koboSpan" id="kobo.1172.1"> problemDetail = ex.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1173.1">getBody</span></span><span class="koboSpan" id="kobo.1174.1">();
        problemDetail.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1175.1">setProperty</span></span><span class="koboSpan" id="kobo.1176.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1177.1">"errors"</span></span><span class="koboSpan" id="kobo.1178.1">, errors);
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1179.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1180.1">handleExceptionInternal</span></span><span class="koboSpan" id="kobo.1181.1">(ex, problemDetail, headers, status,
            request);
    }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1182.1">
     Our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1183.1">
      GlobalExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1184.1">
     extends the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1185.1">
      ResponseEntityExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1186.1">
     Spring class, which provides the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1187.1">
      handleMethodArgumentNotValid
     </span>
    </code>
    <span class="koboSpan" id="kobo.1188.1">
     method; we are overriding this method and updating
    </span>
    <a id="_idIndexMarker144">
    </a>
    <span class="koboSpan" id="kobo.1189.1">
     the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1190.1">
      ProblemDetail
     </span>
    </code>
    <span class="koboSpan" id="kobo.1191.1">
     class to give a clear message
    </span>
    <a id="_idIndexMarker145">
    </a>
    <span class="koboSpan" id="kobo.1192.1">
     in the case of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1193.1">
      400 (Bad Request)
     </span>
    </code>
    <span class="koboSpan" id="kobo.1194.1">
     informing about the wrong input data.
    </span>
    <span class="koboSpan" id="kobo.1194.2">
     This kind of error can be detected by Bean Validation when the user does not send the correct input.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1195.1">
     Our class also has two custom
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1196.1">
      ExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1197.1">
     : the first one to handle our custom exception,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1198.1">
      EntityNotFoundException
     </span>
    </code>
    <span class="koboSpan" id="kobo.1199.1">
     , and the second one to handle
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1200.1">
      ConstraintViolationException
     </span>
    </code>
    <span class="koboSpan" id="kobo.1201.1">
     , which can be caused due to validation from
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1202.1">
      PathVariable
     </span>
    </code>
    <span class="koboSpan" id="kobo.1203.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1204.1">
     Thanks to our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1205.1">
      GlobalExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1206.1">
     , every the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1207.1">
      EntityNotFoundException
     </span>
    </code>
    <span class="koboSpan" id="kobo.1208.1">
     exception is thrown, the client will receive a
    </span>
    <strong class="screenText">
     <span class="koboSpan" id="kobo.1209.1">
      404
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1210.1">
     error.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1211.1">
     By creating this class, we have implemented global exception handling and defined a consistent and standardized format for errors, making it easier for clients consuming the API to understand and handle errors consistently across different endpoints.
    </span>
    <span class="koboSpan" id="kobo.1211.2">
     Besides, it also provides
    </span>
    <a id="_idIndexMarker146">
    </a>
    <span class="koboSpan" id="kobo.1212.1">
     more clarity, helping clients to understand the
    </span>
    <a id="_idIndexMarker147">
    </a>
    <span class="koboSpan" id="kobo.1213.1">
     nature of the error and how to resolve it.
    </span>
    <span class="koboSpan" id="kobo.1213.2">
     This improves the developer experience and reduces the time required to diagnose and fix issues.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1214.1">
     Now that we have our exception handler, we need to ensure that the user does not send invalid input.
    </span>
    <span class="koboSpan" id="kobo.1214.2">
     Let’s see how we can achieve this using Bean Validation.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-68">
    <a id="_idTextAnchor073">
    </a>
    <span class="koboSpan" id="kobo.1215.1">
     Bean Validation
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1216.1">
     Bean Validation
    </span>
    <a id="_idIndexMarker148">
    </a>
    <span class="koboSpan" id="kobo.1217.1">
     is a Java specification based on
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1218.1">
      Java Specification Requests
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1219.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1220.1">
      JSRs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1221.1">
     ) 380, 349, and 303.
    </span>
    <span class="koboSpan" id="kobo.1221.2">
     These
    </span>
    <a id="_idIndexMarker149">
    </a>
    <span class="koboSpan" id="kobo.1222.1">
     requests provide a standardized approach to validating Java beans.
    </span>
    <span class="koboSpan" id="kobo.1222.2">
     Bean Validation is very
    </span>
    <a id="_idIndexMarker150">
    </a>
    <span class="koboSpan" id="kobo.1223.1">
     useful for validating user requests, by providing some predefined rules and a way to create your custom Bean Validation, making it easier to enforce data integrity and validate input data within Java applications.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1224.1">
     Bean Validation
    </span>
    <a id="_idIndexMarker151">
    </a>
    <span class="koboSpan" id="kobo.1225.1">
     can be applied through various annotations, as follows:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1226.1">
       @NotNull
      </span>
     </code>
     <span class="koboSpan" id="kobo.1227.1">
      : Specifies that the annotated element must not be null
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1228.1">
       @Size
      </span>
     </code>
     <span class="koboSpan" id="kobo.1229.1">
      : Specifies the size constraints for a string, collection, map, or array
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1230.1">
       @Min
      </span>
     </code>
     <span class="koboSpan" id="kobo.1231.1">
      : Specifies the minimum value for a numeric element
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1232.1">
       @Max
      </span>
     </code>
     <span class="koboSpan" id="kobo.1233.1">
      : Specifies the maximum value for a numeric element
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1234.1">
       @DecimalMin
      </span>
     </code>
     <span class="koboSpan" id="kobo.1235.1">
      : Specifies the minimum value for a numeric element with decimal precision
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1236.1">
       @DecimalMax
      </span>
     </code>
     <span class="koboSpan" id="kobo.1237.1">
      : Specifies the maximum value for a numeric element with decimal precision
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1238.1">
       @Digits
      </span>
     </code>
     <span class="koboSpan" id="kobo.1239.1">
      : Specifies the exact or maximum number of digits for a numeric element
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1240.1">
       @Pattern
      </span>
     </code>
     <span class="koboSpan" id="kobo.1241.1">
      : Specifies a regular expression pattern that the annotated element must match
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1242.1">
       @Email
      </span>
     </code>
     <span class="koboSpan" id="kobo.1243.1">
      : Specifies that the annotated element must be a well-formed email address
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1244.1">
       @NotBlank
      </span>
     </code>
     <span class="koboSpan" id="kobo.1245.1">
      : Specifies that the annotated string must not be null or empty and must contain at least one non-whitespace character
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1246.1">
       @NotEmpty
      </span>
     </code>
     <span class="koboSpan" id="kobo.1247.1">
      : Specifies that the annotated string must not be null or empty
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1248.1">
       @Positive
      </span>
     </code>
     <span class="koboSpan" id="kobo.1249.1">
      : Specifies that the annotated numeric element must be positive (greater than 0)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1250.1">
       @Negative
      </span>
     </code>
     <span class="koboSpan" id="kobo.1251.1">
      : Specifies that the annotated numeric element must be negative (less than 0)
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1252.1">
       @PositiveOrZero
      </span>
     </code>
     <span class="koboSpan" id="kobo.1253.1">
      : Specifies that the annotated numeric element must be positive or 0
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1254.1">
       @NegativeOrZero
      </span>
     </code>
     <span class="koboSpan" id="kobo.1255.1">
      : Specifies that the annotated numeric element must be negative or 0
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1256.1">
       @Past
      </span>
     </code>
     <span class="koboSpan" id="kobo.1257.1">
      : Specifies that the annotated date or time must be in the past
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1258.1">
       @PastOrPresent
      </span>
     </code>
     <span class="koboSpan" id="kobo.1259.1">
      : Specifies that the annotated date or time must be in the past or present
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1260.1">
       @Future
      </span>
     </code>
     <span class="koboSpan" id="kobo.1261.1">
      : Specifies
     </span>
     <a id="_idIndexMarker152">
     </a>
     <span class="koboSpan" id="kobo.1262.1">
      that the annotated date or time must be in the future
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1263.1">
       @FutureOrPresent
      </span>
     </code>
     <span class="koboSpan" id="kobo.1264.1">
      : Specifies that the annotated date or time must be in the future or present
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1265.1">
     Besides all this, the Bean Validation specification provides the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1266.1">
      @Valid
     </span>
    </code>
    <span class="koboSpan" id="kobo.1267.1">
     annotation, which is used to trigger the validation of nested objects or elements within a collection.
    </span>
    <span class="koboSpan" id="kobo.1267.2">
     When applied to a field or parameter representing a complex object or a collection of objects,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1268.1">
      @Valid
     </span>
    </code>
    <span class="koboSpan" id="kobo.1269.1">
     tells the Bean Validation framework to validate the nested objects according to their validation constraints.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1270.1">
     Let’s implement a custom Bean Validation for our SKU field and apply the annotations we’ve discussed in our request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1271.1">
     Our API has
    </span>
    <a id="_idIndexMarker153">
    </a>
    <span class="koboSpan" id="kobo.1272.1">
     an SKU field that should conform to a pattern (AA99999) specified
    </span>
    <a id="_idIndexMarker154">
    </a>
    <span class="koboSpan" id="kobo.1273.1">
     in the requirements phase.
    </span>
    <span class="koboSpan" id="kobo.1273.2">
     We can prevent clients from using invalid SKUs by creating a custom Bean Validation rule.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1274.1">
     We can use the following code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1275.1">@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1276.1">Constraint</span></span><span class="koboSpan" id="kobo.1277.1">(validatedBy = {})
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1278.1">NotNull</span></span><span class="koboSpan" id="kobo.1279.1">
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1280.1">Pattern</span></span><span class="koboSpan" id="kobo.1281.1">(regexp = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1282.1">"[A-Za-z]{2}[0-9]{5}"</span></span><span class="koboSpan" id="kobo.1283.1">,
    message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1284.1">"SKU must follow the pattern AA99999"</span></span><span class="koboSpan" id="kobo.1285.1">)
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1286.1">Target</span></span><span class="koboSpan" id="kobo.1287.1">({</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1288.1">PARAMETER</span></span><span class="koboSpan" id="kobo.1289.1">, </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1290.1">FIELD</span></span><span class="koboSpan" id="kobo.1291.1">})
@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1292.1">Retention</span></span><span class="koboSpan" id="kobo.1293.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1294.1">RetentionPolicy</span></span><span class="koboSpan" id="kobo.1295.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1296.1">RUNTIME</span></span><span class="koboSpan" id="kobo.1297.1">)
public @interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.1298.1">ValidSku</span></span><span class="koboSpan" id="kobo.1299.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1300.1">String</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1301.1">message</span></span><span class="koboSpan" id="kobo.1302.1">() </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1303.1">default</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1304.1">"Invalid SKU"</span></span><span class="koboSpan" id="kobo.1305.1">;
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1306.1">Class</span></span><span class="koboSpan" id="kobo.1307.1">&lt;?&gt;[] </span><span class="hljs-title"><span class="koboSpan" id="kobo.1308.1">groups</span></span><span class="koboSpan" id="kobo.1309.1">() </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1310.1">default</span></span><span class="koboSpan" id="kobo.1311.1"> {};
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1312.1">Class</span></span><span class="koboSpan" id="kobo.1313.1">&lt;? </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1314.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1315.1">Payload</span></span><span class="koboSpan" id="kobo.1316.1">&gt;[] </span><span class="hljs-title"><span class="koboSpan" id="kobo.1317.1">payload</span></span><span class="koboSpan" id="kobo.1318.1">() </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1319.1">default</span></span><span class="koboSpan" id="kobo.1320.1"> {};
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1321.1">
     This code creates a new annotation called
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1322.1">
      @ValidSku
     </span>
    </code>
    <span class="koboSpan" id="kobo.1323.1">
     , and it checks whether the field adheres to a specific pattern: two alphabetic characters followed by five numeric digits (e.g.,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1324.1">
      AA12345
     </span>
    </code>
    <span class="koboSpan" id="kobo.1325.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.1325.2">
     If the annotated field does not match the defined pattern, a validation error message,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1326.1">
      SKU must follow the pattern AA99999
     </span>
    </code>
    <span class="koboSpan" id="kobo.1327.1">
     , is generated.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1328.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1329.1">
      ValidSku
     </span>
    </code>
    <span class="koboSpan" id="kobo.1330.1">
     annotation is designed to be applied to fields and parameters, as indicated by the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1331.1">
      @Target
     </span>
    </code>
    <span class="koboSpan" id="kobo.1332.1">
     annotation.
    </span>
    <span class="koboSpan" id="kobo.1332.2">
     It also indicates that the validation constraint should be retained at runtime for reflection purposes.
    </span>
    <span class="koboSpan" id="kobo.1332.3">
     This annotation streamlines the process of validating SKUs in Java applications, enhancing data integrity and ensuring compliance with specific SKU formatting requirements.
    </span>
   </p>
   <p class="normal">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1333.1">
      ValidSku
     </span>
    </code>
    <span class="koboSpan" id="kobo.1334.1">
     also validates whether the field is not null using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1335.1">
      @NotNull
     </span>
    </code>
    <span class="koboSpan" id="kobo.1336.1">
     annotation.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1337.1">
     After creating our annotation, we can update our API by adding
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1338.1">
      @ValidSku
     </span>
    </code>
    <span class="koboSpan" id="kobo.1339.1">
     to our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1340.1">
      PathVariable
     </span>
    </code>
    <span class="koboSpan" id="kobo.1341.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1341.2">
     We should also add the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1342.1">
      @Validated
     </span>
    </code>
    <span class="koboSpan" id="kobo.1343.1">
     annotation from Spring to our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1344.1">
      ProductsApiController
     </span>
    </code>
    <span class="koboSpan" id="kobo.1345.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1345.2">
     It is essential to validate the method annotation and not just the fields:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1346.1">public interface </span><span class="hljs-title"><span class="koboSpan" id="kobo.1347.1">ProductsApi</span></span><span class="koboSpan" id="kobo.1348.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1349.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1350.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1351.1">ProductOutput</span></span><span class="koboSpan" id="kobo.1352.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1353.1">createOrUpdateProduct</span></span><span class="koboSpan" id="kobo.1354.1">(
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1355.1">ValidSku</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1356.1">String</span></span><span class="koboSpan" id="kobo.1357.1"> productId, @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1358.1">Valid</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1359.1">ProductInput</span></span><span class="koboSpan" id="kobo.1360.1"> productInput);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1361.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1362.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1363.1">Void</span></span><span class="koboSpan" id="kobo.1364.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1365.1">deleteProduct</span></span><span class="koboSpan" id="kobo.1366.1">(@</span><span class="hljs-title"><span class="koboSpan" id="kobo.1367.1">ValidSku</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1368.1">String</span></span><span class="koboSpan" id="kobo.1369.1"> productId);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1370.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1371.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1372.1">ProductOutput</span></span><span class="koboSpan" id="kobo.1373.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1374.1">editProductDescription</span></span><span class="koboSpan" id="kobo.1375.1">(
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1376.1">ValidSku</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1377.1">String</span></span><span class="koboSpan" id="kobo.1378.1"> productId, @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1379.1">Valid</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1380.1">ProductDescriptionInput</span></span><span class="koboSpan" id="kobo.1381.1"> input);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1382.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1383.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1384.1">ProductOutput</span></span><span class="koboSpan" id="kobo.1385.1">&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1386.1">getProductById</span></span><span class="koboSpan" id="kobo.1387.1">(
        @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1388.1">ValidSku</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1389.1">String</span></span><span class="koboSpan" id="kobo.1390.1"> productId);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1391.1">ResponseEntity</span></span><span class="koboSpan" id="kobo.1392.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1393.1">List</span></span><span class="koboSpan" id="kobo.1394.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1395.1">ProductOutput</span></span><span class="koboSpan" id="kobo.1396.1">&gt;&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1397.1">getProducts</span></span><span class="koboSpan" id="kobo.1398.1">();
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1399.1">
     Now that
    </span>
    <a id="_idIndexMarker155">
    </a>
    <span class="koboSpan" id="kobo.1400.1">
     we have created the SKU validation and our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1401.1">
      ExceptionHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1402.1">
     , we can
    </span>
    <a id="_idIndexMarker156">
    </a>
    <span class="koboSpan" id="kobo.1403.1">
     test it by passing a wrong SKU to check the result:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1404.1"> curl -X 'PUT' \
  'http://localhost:8080/api/products/AAAA' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "Keyboard",
  "description": "Ergonomic Keyboard",
  "price": 60
}'
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1405.1">
     We will receive the following output:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1406.1">HTTP/1.1 400
Content-Type: application/json
{
  "type": "about:blank",
  "title": "Bad Request",
  "status": 400,
  "detail": "Invalid request content.",
  "instance": "/api/products/123",
  "errors": [
    "productId: SKU must follow the pattern AA99999"
  ]
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1407.1">
     Our output
    </span>
    <a id="_idIndexMarker157">
    </a>
    <span class="koboSpan" id="kobo.1408.1">
     follows the standard by RFC 9457, and we also have an extra
    </span>
    <a id="_idIndexMarker158">
    </a>
    <span class="koboSpan" id="kobo.1409.1">
     field to detail the errors from the Bean Validation.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1410.1">
     Now, we can enhance our
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1411.1">
      ProductInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.1412.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1413.1">
      ProductDescriptionInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.1414.1">
     classes with Bean Validation annotations to ensure the input is valid.
    </span>
    <span class="koboSpan" id="kobo.1414.2">
     For the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1415.1">
      ProductInput
     </span>
    </code>
    <span class="koboSpan" id="kobo.1416.1">
     class, we can use the following annotations:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1417.1">public record </span><span class="hljs-title"><span class="koboSpan" id="kobo.1418.1">ProductInput</span></span><span class="koboSpan" id="kobo.1419.1">(
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1420.1">NotBlank</span></span><span class="koboSpan" id="kobo.1421.1">
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1422.1">Size</span></span><span class="koboSpan" id="kobo.1423.1">(min = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1424.1">3</span></span><span class="koboSpan" id="kobo.1425.1">, max = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1426.1">255</span></span><span class="koboSpan" id="kobo.1427.1">)
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1428.1">JsonProperty</span></span><span class="koboSpan" id="kobo.1429.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1430.1">"name"</span></span><span class="koboSpan" id="kobo.1431.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1432.1">String</span></span><span class="koboSpan" id="kobo.1433.1"> name,
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1434.1">NotBlank</span></span><span class="koboSpan" id="kobo.1435.1">
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1436.1">Size</span></span><span class="koboSpan" id="kobo.1437.1">(min = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1438.1">10</span></span><span class="koboSpan" id="kobo.1439.1">, max = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1440.1">255</span></span><span class="koboSpan" id="kobo.1441.1">)
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1442.1">JsonProperty</span></span><span class="koboSpan" id="kobo.1443.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1444.1">"description"</span></span><span class="koboSpan" id="kobo.1445.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1446.1">String</span></span><span class="koboSpan" id="kobo.1447.1"> description,
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1448.1">NotNull</span></span><span class="koboSpan" id="kobo.1449.1">
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1450.1">Positive</span></span><span class="koboSpan" id="kobo.1451.1">
    @</span><span class="hljs-title"><span class="koboSpan" id="kobo.1452.1">JsonProperty</span></span><span class="koboSpan" id="kobo.1453.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1454.1">"price"</span></span><span class="koboSpan" id="kobo.1455.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1456.1">BigDecimal</span></span><span class="koboSpan" id="kobo.1457.1"> price) {
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1458.1">
     By adding these annotations, we guarantee that the input is in accord with what is expected from our API.
    </span>
    <span class="koboSpan" id="kobo.1458.2">
     With these annotations, we provide a safer API, as we control the user input and ensure the data integrity.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1459.1">
     Our code guarantees these behaviors:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1460.1">
      The name should not be blank, and its length should be between 3 and 255
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1461.1">
      The description should not be blank, and its length should be between 10 and 255
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1462.1">
      The price should not be null and should be a positive number
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1463.1">
     In case the
    </span>
    <a id="_idIndexMarker159">
    </a>
    <span class="koboSpan" id="kobo.1464.1">
     user of this API does not obey these rules, the client
    </span>
    <a id="_idIndexMarker160">
    </a>
    <span class="koboSpan" id="kobo.1465.1">
     will receive a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1466.1">
      400
     </span>
    </code>
    <span class="koboSpan" id="kobo.1467.1">
     error with the message detail that we defined by the Bean Validation.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1468.1">
     Bean Validation lets our API provide standardized feedback to clients when validation errors occur, which is crucial for maintaining data integrity.
    </span>
    <span class="koboSpan" id="kobo.1468.2">
     It ensures that invalid or malformed data is prevented from being processed, significantly reducing the risk of data corruption or inconsistent state within the application.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-69">
    <a id="_idTextAnchor074">
    </a>
    <span class="koboSpan" id="kobo.1469.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1470.1">
     In this chapter, we covered many topics essential to creating a RESTful API.
    </span>
    <span class="koboSpan" id="kobo.1470.2">
     You learned how to design and implement a RESTful API following the best practices using the HTTP methods and HTTP status codes, and how to apply Bean Validation to guarantee data integrity.
    </span>
    <span class="koboSpan" id="kobo.1470.3">
     Not only that, you’ve also learned how to handle exceptions using the Spring Framework.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1471.1">
     In the next chapter, we will see how to create well-defined documentation for our API that clients can use.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-70">
    <a id="_idTextAnchor075">
    </a>
    <span class="koboSpan" id="kobo.1472.1">
     Further reading
    </span>
   </h1>
   <ul>
    <li class="bulletList">
     <em class="italic">
      <span class="koboSpan" id="kobo.1473.1">
       Jakarta Bean Validation specification
      </span>
     </em>
     <span class="koboSpan" id="kobo.1474.1">
      (version 3.0):
     </span>
     <a href="https://jakarta.ee/specifications/bean-validation/3.0/jakarta-bean-validation-spec-3.0.html ">
      <span class="url">
       <span class="koboSpan" id="kobo.1475.1">
        https://jakarta.ee/specifications/bean-validation/3.0/jakarta-bean-validation-spec-3.0.html
       </span>
      </span>
     </a>
    </li>
    <li class="bulletList">
     <em class="italic">
      <span class="koboSpan" id="kobo.1476.1">
       RFC 9110
      </span>
     </em>
     <span class="koboSpan" id="kobo.1477.1">
      :
     </span>
     <a href="https://www.rfc-editor.org/rfc/rfc9110.html ">
      <span class="url">
       <span class="koboSpan" id="kobo.1478.1">
        https://www.rfc-editor.org/rfc/rfc9110.html
       </span>
      </span>
     </a>
    </li>
    <li class="bulletList">
     <em class="italic">
      <span class="koboSpan" id="kobo.1479.1">
       RFC 9457
      </span>
     </em>
     <span class="koboSpan" id="kobo.1480.1">
      :
     </span>
     <a href="https://www.rfc-editor.org/rfc/rfc9457.html">
      <span class="url">
       <span class="koboSpan" id="kobo.1481.1">
        https://www.rfc-editor.org/rfc/rfc9457.html
       </span>
      </span>
     </a>
    </li>
   </ul>
  </div>
 </body></html>