- en: Chapter 3. Setting Up a JBoss EAP6 Cluster
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第三章。设置JBoss EAP6集群
- en: In the previous chapter, we have learned how to use the management console to
    deploy projects into JBoss EAP6 in both the standalone mode and domain mode. We
    also saw that the domain mode has helped us a lot when we needed to manage multiple
    servers. It achieved this goal by centralizing the management task into a domain
    controller.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们学习了如何使用管理控制台将项目部署到JBoss EAP6的独立模式和域模式。我们还看到，当需要管理多个服务器时，域模式对我们帮助很大。它通过将管理任务集中到域控制器中来实现这一目标。
- en: 'The domain mode provided by EAP6 is a good support to help us set up our cluster,
    but it''s still not the cluster itself. As we have seen in [Chapter 2](ch02.html
    "Chapter 2. Using JBoss EAP6"), *Using JBoss EAP6*, though servers are managed
    in a server group, they do not form a cluster. For the servers to form a cluster,
    we need to perform the following two tasks:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: EAP6提供的域模式为我们设置集群提供了良好的支持，但它本身并不是集群。正如我们在[第二章](ch02.html "第二章。使用JBoss EAP6")中看到的，*使用JBoss
    EAP6*，尽管服务器在服务器组中管理，但它们并没有形成一个集群。为了使服务器形成一个集群，我们需要执行以下两个任务：
- en: Setting up the EAP6 servers properly to make sure the components related with
    clustering are all running in correct status
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正确设置EAP6服务器，确保与集群相关的所有组件都处于正确状态
- en: Setting up a load balancer so that user requests can be dispatched to the different
    EAP6 servers contained in the cluster
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设置负载均衡器，以便将用户请求分发到集群中包含的不同EAP6服务器
- en: In this chapter, we'll focus on the first task.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将重点关注第一个任务。
- en: Designing a cluster
  id: totrans-6
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设计一个集群
- en: In the previous chapter, we have seen that EAP6 has provided two server groups
    in `domain.xml`. One is called **main-server-group** and the other is called **other-server-group**.
    In this chapter, we'll use the other-server-group to set the cluster, because
    it's using the `full-ha` profile, and this profile contains all the components
    we'll use to set up the cluster.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们了解到EAP6在`domain.xml`中提供了两个服务器组。一个是**main-server-group**，另一个是**other-server-group**。在本章中，我们将使用**other-server-group**来设置集群，因为它使用的是`full-ha`配置文件，而这个配置文件包含了我们将用于设置集群的所有组件。
- en: With a cluster, we can distribute the request load to multiple servers. With
    the EAP6 domain management function, we can deploy a project into multiple EAP6
    servers in the management console of the domain controller.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 使用集群，我们可以将请求负载分配到多个服务器。利用EAP6域管理功能，我们可以在域控制器的管理控制台中将项目部署到多个EAP6服务器。
- en: We will use three machines to set up a cluster in this book. Two of them will
    be used to run the EAP6 servers, and one of them will be used to run the load
    balancer. In this chapter, we will use two machines to run the EAP6 servers.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将使用三台机器来设置一个集群。其中两台将用于运行EAP6服务器，另一台将用于运行负载均衡器。在本章中，我们将使用两台机器来运行EAP6服务器。
- en: Tip
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: You can also use virtualization to have all of them running in a single physical
    box. Just make sure they have independent IP addresses that can communicate with
    one another, and the firewalls are turned off.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以使用虚拟化技术，让所有服务器在一个物理盒子里运行。只需确保它们有独立的IP地址，可以相互通信，并且防火墙已关闭。
- en: 'The deployment process is shown in following diagram:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 部署过程在以下图中展示：
- en: '![Designing a cluster](img/2432_03_02.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![设计一个集群](img/2432_03_02.jpg)'
- en: 'In this chapter, we''ll use two machines and install EAP6 on both of them,
    and we''ll talk about the load balancer in the next chapter. The deployment diagram
    of two EAP6 servers is shown in the following diagram:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将使用两台机器并在它们上安装EAP6，我们将在下一章讨论负载均衡器。以下图中展示了两个EAP6服务器的部署图：
- en: '![Designing a cluster](img/2432_03_01.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![设计一个集群](img/2432_03_01.jpg)'
- en: The two machines are called **master** and **slave**. I have put the IP addresses
    of these two servers into the diagram for your reference. These addresses are
    used in my local environment. In the diagram, the EAP6 server on **master** will
    be configured as a domain controller, and the EAP6 server running on **slave**
    will accept the management of **master**.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 这两台机器被称为**master**和**slave**。我已经将这些服务器的IP地址放入图中供您参考。这些地址用于我的本地环境。在图中，**master**上的EAP6服务器将被配置为域控制器，而**slave**上运行的EAP6服务器将接受**master**的管理。
- en: In `domain/configuration/host.xml`, EAP6 has provided us with a default server
    that belongs to other-server-group. We'll rename this server on **master** as
    `master-server`, and rename the one on **slave** as `slave-server`.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `domain/configuration/host.xml` 中，EAP6 为我们提供了一个属于 other-server-group 的默认服务器。我们将把这个服务器在
    **master** 上的名称重命名为 `master-server`，并在 **slave** 上的名称重命名为 `slave-server`。
- en: 'In the EAP6 domain mode, each server instance is running in its own JVM process.
    The following are the processes that will be running on **master**:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在 EAP6 域模式中，每个服务器实例都在自己的 JVM 进程中运行。以下是在 **master** 上将运行的进程：
- en: '[PRE0]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'The following are the processes that will be running on **slave**:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在 **slave** 上将运行的进程：
- en: '[PRE1]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The host controller running on **master** will act as the domain controller;
    the host controller running on **slave** will accept the management from the domain
    controller. In addition, both master-server and slave-server belong to other-server-group.
    When we deploy a project into other-server-group, the project will be deployed
    to both the servers, because they belong to the same server group, even though
    they are running on different machines and with different JVMs.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '在 **master** 上运行的宿主控制器将充当域控制器；在 **slave** 上运行的宿主控制器将接受域控制器的管理。此外，master-server
    和 slave-server 都属于 other-server-group。当我们向 other-server-group 部署项目时，项目将被部署到两个服务器上，因为它们属于同一个服务器组，即使它们运行在不同的机器上，使用不同的
    JVM。 '
- en: Setting up a server group
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置服务器组
- en: 'In this section we''ll start doing some configurations in EAP6\. As we know,
    there are two server groups already set up for us in JBoss EAP6:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将开始在 EAP6 中进行一些配置。正如我们所知，在 JBoss EAP6 中已经为我们设置了两个服务器组：
- en: main-server-group
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: main-server-group
- en: other-server-group
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: other-server-group
- en: And in [Chapter 2](ch02.html "Chapter 2. Using JBoss EAP6"), *Using JBoss EAP6*,
    we have played with main-server-group. In this chapter we'll use other-server-group.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [第 2 章](ch02.html "第 2 章。使用 JBoss EAP6")，*使用 JBoss EAP6* 中，我们已经玩过 main-server-group。在本章中，我们将使用
    other-server-group。
- en: The main-server-group versus other-server-group
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: main-server-group 与 other-server-group 的比较
- en: 'The major difference is that they are using two different profiles. You can
    see this in `domain.xml`:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 主要区别在于它们使用两个不同的配置文件。您可以在 `domain.xml` 中看到这一点：
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: As shown in the preceding configuration, we don't define different profiles
    into different configuration files in the domain mode. Instead it's defined in
    different profile sections in `domain` `.xml`.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 如前述配置所示，在域模式中，我们不会将不同的配置文件定义在不同的配置文件中。相反，它们在 `domain` `.xml` 中的不同配置部分中定义。
- en: Server configuration
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 服务器配置
- en: Now let's start configuring our server group. Because we need to configure two
    EAP6 instances on two different machines, let's go through them one by one. Let's
    start with **master**.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们开始配置我们的服务器组。因为我们需要在两台不同的机器上配置两个 EAP6 实例，让我们逐一进行。让我们从 **master** 开始。
- en: Setting up master
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置 master
- en: The EAP6 on **master** will be used as a domain controller. Let's start configuring
    it.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **master** 上的 EAP6 将用作域控制器。让我们开始配置它。
- en: Configuring host.xml
  id: totrans-36
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置 host.xml
- en: 'The first thing we should do is set the host name in `domain/configuration/host.xml`.
    Let''s set the hostname to `master`:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 我们应该做的第一件事是在 `domain/configuration/host.xml` 中设置主机名。让我们将主机名设置为 `master`：
- en: '[PRE3]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Then let''s set the server group and server. Because we don''t need to use
    main-server-group and its servers in this chapter, it''s better to turn them off
    to save some system resources. Open `host.xml` and set the `auto-start` option
    of **server-one** and **server-two** to `false`:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 然后让我们设置服务器组和服务器。因为我们在这个章节中不需要使用 main-server-group 及其服务器，所以最好关闭它们以节省一些系统资源。打开
    `host.xml` 并将 **server-one** 和 **server-two** 的 `auto-start` 选项设置为 `false`：
- en: '[PRE4]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The next time we start the EAP6 in the domain mode, these two servers won''t
    start. Then let''s rename `server-three` as `master-server` and set its `auto-start`
    to `true`:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 下次我们在域模式中启动 EAP6 时，这两个服务器将不会启动。然后我们将 `server-three` 重命名为 `master-server` 并将其
    `auto-start` 设置为 `true`：
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Please note that the port offset of `master-server` is `250`, and we'll use
    it to calculate the serving ports of `master-server`. The next thing we should
    do is to change the binding addresses of multiple sockets to public IP addresses.
    Because we'll use two EAP6 servers on two different machines to form a server
    group, we need to bind sockets to proper addresses to make sure they can communicate
    with each other.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，`master-server` 的端口偏移量是 `250`，我们将用它来计算 `master-server` 的服务端口。接下来，我们应该做的是将多个套接字的绑定地址更改为公共
    IP 地址。因为我们将使用两台不同机器上的两个 EAP6 服务器来形成一个服务器组，我们需要将套接字绑定到适当的地址，以确保它们可以相互通信。
- en: '[PRE6]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Please note that the **slave** server will connect to the master's management
    interface to accept its management, so it should also be bound to public address
    as shown in the previous code snippet. We'll cover **slave** configuration in
    later sections.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，**从**服务器将连接到主管理接口以接受其管理，因此它也应该绑定到之前代码片段中显示的公共地址。我们将在后面的章节中介绍 **从**服务器的配置。
- en: The public address here means the IP address other than the loopback address.
    It should be an internal IP address only accessible from LAN. In a real-world
    scenario, the management interface won't be public. They would use only an internal
    network because of security reasons. So we usually put all the EAP6 servers in
    a LAN, and only open the load balancer to the public, and let it proxy user requests
    to the internal network. We'll discuss this in the next chapter.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 这里的公共地址指的是除了回环地址之外的其他 IP 地址。它应该是一个仅限于局域网内部访问的内部 IP 地址。在实际场景中，管理接口不会是公开的。他们会因为安全原因只使用内部网络。因此，我们通常将所有
    EAP6 服务器放在局域网中，并且只将负载均衡器公开，让它代理用户请求到内部网络。我们将在下一章讨论这个问题。
- en: Adding a user account for slave server
  id: totrans-47
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 为从服务器添加用户账户
- en: The two servers (master-server and slave-server) will be managed by the domain,
    and we need to use host controllers to connect to the domain. The communication
    between the two host controllers needs to be authenticated. If slave-server wants
    to connect to the domain controller, we need to set up a user account for the
    connection, which is enforced by the security requirement of JBoss EAP6.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 两个服务器（主服务器和从服务器）将由域管理，我们需要使用主机控制器来连接到域。两个主机控制器之间的通信需要经过认证。如果从服务器想要连接到域控制器，我们需要为连接设置一个用户账户，这是由
    JBoss EAP6 的安全要求强制执行的。
- en: 'We''ll use `add-user.sh` in the `bin` directory to create a user for slave.
    The process is shown in the following screenshot:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在 `bin` 目录中使用 `add-user.sh` 为从服务器创建用户。过程如下截图所示：
- en: '![Adding a user account for slave server](img/2432_03_09.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![为从服务器添加用户账户](img/2432_03_09.jpg)'
- en: 'The following is the summary of the user we''ve created:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是我们创建的用户摘要：
- en: The type of user is **Management User**
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户类型为 **Management User**
- en: The user name is **slave**
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户名为 **slave**
- en: The user password is set to **@packt000**
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户密码设置为 **@packt000**
- en: The user belongs to **ManagementRealm**
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 该用户属于 **ManagementRealm**
- en: '**Is this new user going to be used for one AS process to connect to another
    AS process** is set to **yes**'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**此新用户是否将被用于一个 AS 进程连接到另一个 AS 进程** 设置为 **是**'
- en: 'The last point is important; we have set this user to be used for the AS process
    connection, and a secret value is generated for this user:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一点很重要；我们已经将此用户设置为用于 AS 进程连接，并为该用户生成了一个秘密值：
- en: '[PRE7]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This is the secret value that we''ll need for `slave-server` to connect to
    `master-server`. We need to enter this secret value into **slave** EAP6\. Another
    important thing is that the username here must be the same as the `name` attribute
    in `host.xml` of **slave** EAP6\. If you don''t follow this rule, you will receive
    the following error message when you try to start EAP6 on **slave**:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这是 `slave-server` 连接到 `master-server` 所需要的秘密值。我们需要将此秘密值输入到 **slave** EAP6 中。另一件重要的事情是，这里的用户名必须与
    **slave** EAP6 的 `host.xml` 中的 `name` 属性相同。如果您不遵循此规则，当您尝试在 **slave** 上启动 EAP6
    时，您将收到以下错误消息：
- en: '[PRE8]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: So this rule is enforced by EAP6.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，此规则由 EAP6 强制执行。
- en: Setting up HornetQ
  id: totrans-62
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 设置 HornetQ
- en: 'There is one more step to configure the **master** server. Open `domain.xml`
    and find the security setting of **HornetQ**:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 配置 **master** 服务器还需要进行一个额外的步骤。打开 `domain.xml` 并找到 **HornetQ** 的安全设置：
- en: '[PRE9]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Note
  id: totrans-65
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Both the `full-ha` and `full` profiles in `domain.xml` contains the settings
    of `hornetq-server`. Please make sure you are editing the configuration under
    the `full-ha` profile.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '`domain.xml` 中的 `full-ha` 和 `full` 配置文件都包含 `hornetq-server` 的设置。请确保您正在 `full-ha`
    配置文件下编辑配置。'
- en: 'Change the preceding setting to the following:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 将前面的设置更改为以下内容：
- en: '[PRE10]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'If you feel this is not very useful, you can also disable it:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您觉得这不太有用，您也可以禁用它：
- en: '[PRE11]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: We won't cover the topics of HornetQ in this book. We just configure it properly
    to make sure the EAP6 server could start correctly.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 本书不会涵盖 HornetQ 的主题。我们只是正确配置它，以确保 EAP6 服务器能够正确启动。
- en: Setting up slave
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置从服务器
- en: Now let's configure EAP6 on **slave**. Because it will accept the management
    from **master** EAP6, `domain.xml` on this server becomes useless. We just need
    to configure `host.xml`. Now let's have a look at it.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们配置**slave**上的EAP6。因为它将接受来自**master** EAP6的管理，所以这个服务器上的`domain.xml`变得无用。我们只需要配置`host.xml`。现在让我们看看它。
- en: Configuring host.xml
  id: totrans-74
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 配置host.xml
- en: 'Similar to the configuration on **master** EAP6, we first need to configure
    the name of the host:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 与**master** EAP6上的配置相似，我们首先需要配置主机名：
- en: '[PRE12]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'As noted in the *Configuring host.xml* section of *Setting up a master*, the
    name here must be the same as the username of the account we have added in **master**
    EAP6\. Then we need to assign the secret value to `ManagementRealm`:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 如在*设置master*的*配置host.xml*部分所述，这里的名称必须与我们已在**master** EAP6中添加的账户的用户名相同。然后我们需要将密钥值分配给`ManagementRealm`：
- en: '[PRE13]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then host controller of **slave** will use this secret value for authentication.
    The next step is to set up `domain-controller`:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 然后**slave**的主机控制器将使用此密钥值进行身份验证。下一步是设置`domain-controller`：
- en: '[PRE14]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: As shown before, the **slave** EAP6 will connect to the **master** EAP6 and
    use it as the domain controller.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，**slave** EAP6将连接到**master** EAP6，并使用它作为域控制器。
- en: Tip
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: Remember that `10.0.1.13` is the IP address of **master**, while `10.0.1.19`
    is the address of **slave**.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，`10.0.1.13`是**master**的IP地址，而`10.0.1.19`是**slave**的地址。
- en: 'The next step is to bind the interfaces of **slave** EAP6 to proper IP addresses
    so that the **master** EAP6 can communicate with it:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是将**slave** EAP6的接口绑定到适当的IP地址，以便**master** EAP6可以与其通信：
- en: '[PRE15]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Please note that we didn't change the binding for the `management` interface.
    Because the domain controller will undertake the management work, the local management
    on **slave** won't be used. So let's just leave it unchanged.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，我们没有更改`management`接口的绑定。因为域控制器将承担管理任务，所以**slave**上的本地管理将不会使用。所以我们就让它保持不变。
- en: 'Next we also turn off `server-one` and `server-two` to save some resources:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们还将关闭`server-one`和`server-two`以节省一些资源：
- en: '[PRE16]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Finally let''s rename `server-three` as `slave-server` and set `auto-start`
    to `true`:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们将`server-three`重命名为`slave-server`并将`auto-start`设置为`true`：
- en: '[PRE17]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: That's all we need to configure for slave EAP6.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 那就是我们需要为slave EAP6配置的所有内容。
- en: Configuring domain.xml on slave
  id: totrans-92
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 在slave上配置domain.xml
- en: The `domain.xml` on **slave** EAP6 is not used because the **master** EAP6 is
    acting as a domain controller and it will take the management tasks.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '**slave** EAP6上的`domain.xml`未使用，因为**master** EAP6正在充当域控制器，并将承担管理任务。'
- en: Testing the server group
  id: totrans-94
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试服务器组
- en: Now that we have properly set up the **master** and **slave** EAP6, it's time
    to run them for testing.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经正确设置了**master**和**slave** EAP6，是时候对它们进行测试了。
- en: Running master
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 运行master
- en: 'First let''s run the following command on **master** EAP6:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 首先在**master** EAP6上运行以下命令：
- en: '[PRE18]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'After the master server starts, let''s check the server output shown in the
    following screenshot:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 主服务器启动后，让我们检查以下屏幕截图所示的服务器输出：
- en: '![Running master](img/2432_03_10.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![运行master](img/2432_03_10.jpg)'
- en: In the preceding screenshot we can see that `master-server` has started. Then
    we can see that the management interface and admin console have also started.
    The log output is shown in the following screenshot.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的屏幕截图中，我们可以看到`master-server`已启动。然后我们可以看到管理接口和行政控制台也已启动。日志输出如下所示。
- en: '![Running master](img/2432_03_11.jpg)'
  id: totrans-102
  prefs: []
  type: TYPE_IMG
  zh: '![运行master](img/2432_03_11.jpg)'
- en: 'Now we can see that the multiple components related with cluster have started:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们可以看到与集群相关的多个组件已经启动：
- en: The JGroups subsystem has started.
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: JGroups子系统已启动。
- en: The AJP connector has started. Load balancers will use it for proxy requests.
    We'll cover this topic in the next chapter.
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: AJP连接器已启动。负载均衡器将使用它进行代理请求。我们将在下一章中介绍这个主题。
- en: The HTTP connector has started. Because the port offset for `master-server`
    is `250` and the HTTP port is bound to `8080`, 8080+250 = `8330`.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: HTTP连接器已启动。因为`master-server`的端口号偏移量为`250`，HTTP端口绑定到`8080`，所以8080+250 = `8330`。
- en: '`mod_cluster` has started. We''ll learn about `mod_cluster` in [Chapter 5](ch05.html
    "Chapter 5. Load Balancing with mod_cluster"), *Load Balancing with mod_cluster*.'
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`mod_cluster`已启动。我们将在[第5章](ch05.html "第5章。使用mod_cluster进行负载均衡")*使用mod_cluster进行负载均衡*中了解`mod_cluster`。'
- en: 'The described process is shown in the following screenshot:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 描述的过程如下所示：
- en: '![Running master](img/2432_03_12.jpg)'
  id: totrans-109
  prefs: []
  type: TYPE_IMG
  zh: '![运行master](img/2432_03_12.jpg)'
- en: Running slave
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 运行slave
- en: 'Now let''s start the **slave** server by using `domain.sh`. Its host controller
    will try to connect to the remote domain controller on **master**. After the **slave**
    server starts, we could check the console output from **master** EAP6 to confirm
    that the **slave** has been registered:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们使用`domain.sh`启动**从**服务器。其主机控制器将尝试连接到**主**服务器上的远程域控制器。在**从**服务器启动后，我们可以检查**主**EAP6控制台的输出以确认**从**服务器已注册：
- en: '[PRE19]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Checking the server status
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查服务器状态
- en: Now let's access the web manage console on **master** EAP6 at `http://master:9990`.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们访问**主**EAP6上的Web管理控制台，网址为`http://master:9990`。
- en: 'After logging in with the account `jbossadmin`, we can check the status of
    `master-server` and `slave-server`. Here is their status:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 使用账户`jbossadmin`登录后，我们可以检查`master-server`和`slave-server`的状态。以下是它们的状态：
- en: '![Checking the server status](img/2432_03_03.jpg)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
  zh: '![检查服务器状态](img/2432_03_03.jpg)'
- en: 'As shown in the screenshots, both **master** and **slave** are shown in the
    management console. That means the domain controller is managing all the servers.
    Now let''s go to **slave** and try to access its management console. The result
    is as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 如截图所示，**主**和**从**服务器都显示在管理控制台中。这意味着域控制器正在管理所有服务器。现在让我们转到**从**服务器并尝试访问其管理控制台。结果如下：
- en: '![Checking the server status](img/2432_03_05.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![检查服务器状态](img/2432_03_05.jpg)'
- en: We can see that **slave** EAP6 is now under the management of the domain controller.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到**从**EAP6现在处于域控制器的管理之下。
- en: Project deployment
  id: totrans-120
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 项目部署
- en: Now let's deploy `cluster-demo1` into `other-server-group`.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们将`cluster-demo1`部署到`other-server-group`。
- en: Deploying a project to other-server-group
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将项目部署到其他服务器组
- en: 'In the previous chapter we already learned how to deploy a project into the
    server group, so I will briefly describe the process here:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们已经学习了如何将项目部署到服务器组，所以在这里我将简要描述这个过程：
- en: Log in to the management console of **master** EAP6.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录到**主**EAP6的管理控制台。
- en: Click on **Manage Deployments** in the sidebar.
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在侧边栏中点击**管理部署**。
- en: Click on **Add** under the **Content Repository** tab and add **cluster-demo1.war**.
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在**内容库**选项卡下点击**添加**并添加**cluster-demo1.war**。
- en: Follow the instructions and save the deployment.
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照说明并保存部署。
- en: Click on the **Server Groups** tab.
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**服务器组**选项卡。
- en: Click on **View** of **other-server-group**.
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**其他服务器组**的**查看**。
- en: Click on **Assign** and select **cluster-demo1.war**.
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击**分配**并选择**cluster-demo1.war**。
- en: Save the deployment and click on **En/Disable** to start the **cluster-demo1.war**
    file.
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存部署并点击**启用/禁用**以启动**cluster-demo1.war**文件。
- en: 'If everything goes fine, you should see the server output from both **master**
    and **slave**. The following is the output on master:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，你应该会看到来自**主**和**从**服务器的输出。以下是在主服务器上的输出：
- en: '[PRE20]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The following is the output on **slave**:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在**从**服务器上的输出：
- en: '[PRE21]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'With the help of the domain mode, the project is deployed into two servers
    that belong to the same group. Now we can verify that the project has been deployed
    to these two servers by using **cURL**:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 在域模式帮助下，项目被部署到属于同一组的两个服务器上。现在我们可以通过使用**cURL**来验证项目是否已部署到这两个服务器：
- en: '![Deploying a project to other-server-group](img/2432_03_13.jpg)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![将项目部署到其他服务器组](img/2432_03_13.jpg)'
- en: Clustering with the standalone mode
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用独立模式进行集群
- en: In the preceding sections we saw that the domain mode provides us a central
    place to manage our servers. The question is, do we need to use the domain mode
    to build an EAP6 cluster? The answer is, not necessarily.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的章节中，我们看到了域模式为我们提供了一个集中管理服务器的地方。问题是，我们是否需要使用域模式来构建EAP6集群？答案是，不一定。
- en: 'Using the standalone mode to build a cluster is perfectly fine. We just need
    to enable the relative subsystems that are needed for building the cluster. And
    EAP6 has provided us a set of configurations in the standalone mode. The `*-ha.xml`
    files contain the profiles for clustering. We can use them during the startup.
    The following is the command:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 使用独立模式构建集群是完全可以的。我们只需要启用构建集群所需的相对子系统。EAP6在独立模式下为我们提供了一套配置。`*-ha.xml`文件包含集群配置文件。我们可以在启动时使用它们。以下是一个命令：
- en: '[PRE22]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Here are some disadvantages of using the standalone mode in the clustering
    environment:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在集群环境中使用独立模式的一些缺点如下：
- en: We have to configure each EAP6 server separately
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们必须分别配置每个EAP6服务器
- en: There is no centralized point to manage these servers
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有一个集中点来管理这些服务器
- en: 'That means we must deploy the project to each EAP6 server separately, and make
    sure they are in sync during redeployment. In addition, if we run multiple standalone
    EAP6 servers on the same machine, we have to carefully set the offset for all
    the ports to prevent them from conflicting with one another. Apart from these
    disadvantages, there are some advantages of the standalone mode for clustering:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着我们必须将项目分别部署到每个EAP6服务器上，并确保在重新部署期间它们保持同步。此外，如果我们在同一台机器上运行多个独立的EAP6服务器，我们必须仔细设置所有端口的偏移量，以防止它们相互冲突。除了这些缺点之外，独立模式在集群中还有一些优点：
- en: You can configure each server independently. For example, we can turn off the
    HornetQ subsystem on server A, and enable it on servers B and C.
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您可以独立配置每个服务器。例如，我们可以在服务器A上关闭HornetQ子系统，并在服务器B和C上启用它。
- en: 'The server running in the standalone mode can be debugged easily. In the domain
    mode, EAP6 will spawn multiple processes: a process-controller process, a host-controller
    process, and multiple server processes (each server instance runs in its own JVM
    space), and it will add some difficulties for debugging.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在独立模式下运行的服务器可以轻松地进行调试。在域模式下，EAP6将启动多个进程：一个进程控制器进程、一个主机控制器进程以及多个服务器进程（每个服务器实例都在自己的JVM空间中运行），这将为调试增加一些困难。
- en: Summary
  id: totrans-148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: 'In this chapter we have looked at the configuration of the EAP6 cluster, and
    we have set up two EAP6 servers running in the domain mode to form a server group.
    Nevertheless, we haven''t finished all the work of building a cluster: Now we
    have two EAP6 servers running independently, and we still need a load balancer
    to dispatch user requests to these two servers. In the next chapter, let''s focus
    on setting up a load balancer.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们探讨了EAP6集群的配置，并已设置两个以域模式运行EAP6服务器以形成一个服务器组。尽管如此，我们还没有完成构建集群的所有工作：现在我们有两个独立运行的EAP6服务器，我们仍然需要一个负载均衡器来将用户请求分发到这两个服务器。在下一章中，我们将专注于设置负载均衡器。
