<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;Application Structure and Deployment"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. Application Structure and Deployment</h1></div></div></div><p>Deployment<a id="id667" class="indexterm"/> is the process of uploading resources or applications on the application server. During the software development life cycle, it is the step that logically follows the development phase and can be performed either manually or in an automated fashion.</p><p>In this chapter, we will explore both approaches using the tools that are provided by the server distribution. We will also cover how to deploy resources on the application server using the WildFly plugin for Eclipse. This is the preferred choice for Java developers due to the quick deployment time.</p><p>In the last part of this chapter, we cover the details of the WildFly classloader architecture. In short, our agenda for this chapter includes the following topics:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The type of resources that can be deployed on WildFly</li><li class="listitem" style="list-style-type: disc">Deploying applications on a WildFly standalone instance</li><li class="listitem" style="list-style-type: disc">Deploying applications on a WildFly domain</li><li class="listitem" style="list-style-type: disc">Understanding WildFly's classloading architecture</li></ul></div><div class="section" title="Deploying resources on the application server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec29"/>Deploying resources on the application server</h1></div></div></div><p>There are <a id="id668" class="indexterm"/>basically three file types that we work with in Java Enterprise applications, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>JAR</strong></span>: This<a id="id669" class="indexterm"/> is the most basic package, which can be used for both application and common resources</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>WAR</strong></span>: This<a id="id670" class="indexterm"/> is used to package web applications</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>EAR</strong></span>: This <a id="id671" class="indexterm"/>packages multiple WAR files or contains a set of modules</li></ul></div><p>Besides these, WildFly is able to process the following archives, which provide the application server with additional functionality:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>RAR</strong></span>: This <a id="id672" class="indexterm"/>is the resource adapter file, which is used to define a resource adapter component (the resource adapter subsystem is provided by the <a id="id673" class="indexterm"/><code class="literal">IronJacamar</code> project; for more information, visit <a class="ulink" href="http://www.jboss.org/ironjacamar">http://www.jboss.org/ironjacamar</a>)</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>SAR</strong></span>: This<a id="id674" class="indexterm"/> file enables the deployment of service archives containing the <code class="literal">MBean</code> services, as supported by previous versions of the application server</li></ul></div><p>In this chapter, we will discuss the first three kinds of archives, all of which constitute the typical packaging solution for Java Enterprise applications. Before discussing application deployment, let's look at the single archives in a little more detail.</p><div class="section" title="The JAR file"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec73"/>The JAR file</h2></div></div></div><p>A <a id="id675" class="indexterm"/>
<span class="strong"><strong>Java</strong></span> <span class="strong"><strong>Archive</strong></span> (<span class="strong"><strong>JAR</strong></span>) file <a id="id676" class="indexterm"/>is used to package multiple files into a single archive. Its internal physical layout is similar to a ZIP file, and as a matter of fact, it uses the same algorithm as the zip utility for compressing files.</p><p>A JAR file is generally used to distribute Java classes and associated metadata. In Java EE applications, the JAR file often contains utility code, shared libraries, and Enterprise JavaBeans (EJBs).</p></div><div class="section" title="The WAR file"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec74"/>The WAR file</h2></div></div></div><p>A <a id="id677" class="indexterm"/>
<span class="strong"><strong>Web</strong></span> <span class="strong"><strong>Application</strong></span> <span class="strong"><strong>Archive</strong></span> (<span class="strong"><strong>WAR</strong></span>) file<a id="id678" class="indexterm"/> is essentially an archive used to encapsulate a web application. The web application usually includes a collection of web-related resources, such as <span class="strong"><strong>Java</strong></span> <span class="strong"><strong>Server</strong></span> <span class="strong"><strong>Pages</strong></span> (<span class="strong"><strong>JSP</strong></span>), servlets, XHTML/HTML files, and so on. It also includes Java class files, and possibly other file types, depending on the technology used. Since Java EE 6, EJBs can be packaged within a WAR archive using the same packaging guidelines that apply to web application classes. This means that you can place EJB classes, along with the other class files, under the <code class="literal">classes</code> directory under <code class="literal">WEB-INF</code>. Alternatively, you can package your EJBs within a JAR file and then place this JAR file in the <code class="literal">WEB-INF\lib</code> directory of WAR.</p><p>Because of this, it's more common for developers to use the WAR file to distribute Java EE applications.</p></div><div class="section" title="The EAR file"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec75"/>The EAR file</h2></div></div></div><p>An<a id="id679" class="indexterm"/> <span class="strong"><strong>Enterprise</strong></span> <span class="strong"><strong>Archive</strong></span> (<span class="strong"><strong>EAR</strong></span>) file <a id="id680" class="indexterm"/>represents an application archive, which acts as a container for a set of modules or WAR files. An EAR file can contain any of the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">One or more web modules packaged in WAR files</li><li class="listitem" style="list-style-type: disc">One or more EJB modules packaged in JAR files</li><li class="listitem" style="list-style-type: disc">One or more application client modules</li><li class="listitem" style="list-style-type: disc">Any additional JAR files required by the application</li><li class="listitem" style="list-style-type: disc">JBoss-specific archives such as the SAR file</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note38"/>Note</h3><p>There are two distinct advantages of using an Enterprise Archive file. First, it helps to distribute all application components using a single archive instead of distributing every single module. Second, and most important, is the fact that applications within an EAR file are loaded by a single classloader. This means that each module has visibility on other modules packed within the same archive.</p></div></div><p>The isolation level of application modules contained in the EAR file can be modified by adding the <code class="literal">ear-subdeployments-isolated</code> element to the main configuration file (<code class="literal">domain.xml</code> or <code class="literal">standalone.xml</code>). The default value is <code class="literal">false</code>, which means that the classes in the WAR file can access the classes in the <code class="literal">ejb.jar</code> file. Likewise, the classes in the <code class="literal">ejb.jar</code> file can access each other. If, for some reason, you do not want this behavior and want to restrict the visibility of your classes, add the following lines to your configuration file:</p><div class="informalexample"><pre class="programlisting">&lt;subsystem &gt;
<span class="strong"><strong>  &lt;ear-subdeployments-isolated&gt;true&lt;/ear-subdeployments-isolated&gt;</strong></span>
&lt;/subsystem&gt;</pre></div><p>In the <span class="emphasis"><em>Explaining WildFly classloading</em></span> section, we will discuss the application server classloading architecture in depth. We will also show you how to override this configuration setting at the application level.</p></div></div></div>
<div class="section" title="Deploying applications on a standalone WildFly server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec30"/>Deploying applications on a standalone WildFly server</h1></div></div></div><p>Deploying applications <a id="id681" class="indexterm"/>on JBoss has traditionally been a fairly simple task, so you might wonder why a full chapter has been dedicated to it. The answer to this is that deploying applications on WildFly can be achieved in several ways, each of which we are going to look at.</p><p>First of all, we<a id="id682" class="indexterm"/> are going to look at automatic deployment of applications via the <code class="literal">deployments</code> folder, but before we do this, we need to explain the two modes available when deploying applications:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Automatic</strong></span> <span class="strong"><strong>deployment mode</strong></span>: This mode is triggered by the deployment scanner when a resource within the <code class="literal">deployments</code> folder is modified</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Manual deployment mode</strong></span>: This <a id="id683" class="indexterm"/>mode does not rely on the deployment scanner to trigger a deployment, but rather on a set of marker files to decide if the application needs to be deployed/redeployed</li></ul></div><div class="section" title="Automatic application deployment"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec76"/>Automatic application deployment</h2></div></div></div><p>Automatic<a id="id684" class="indexterm"/> application <a id="id685" class="indexterm"/>deployment consists of placing your application in the <code class="literal">deployments</code> folder, which is located at the following path:</p><p>
<code class="literal">JBOSS_HOME\standalone\deployments</code>
</p><p>By default, every application archive (WAR, JAR, EAR, and SAR) that is placed in this folder is automatically deployed on the server, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_06_01.jpg" alt="Automatic application deployment"/></div><p>The service that scans for deployed resources is called the <a id="id686" class="indexterm"/>
<span class="strong"><strong>deployment scanner</strong></span>, and it is configured within the <code class="literal">standalone.xml</code> configuration file. You can find it by searching for the <code class="literal">deployment-scanner</code> domain. The following snippet shows the default deployment scanner configuration:</p><div class="informalexample"><pre class="programlisting">&lt;subsystem &gt;
    &lt;deployment-scanner path="deployments" relative-to="jboss.server.base.dir" scan-interval="5000" runtime-failure-causes-rollback="false"/&gt;&lt;/subsystem&gt;</pre></div><p>As you <a id="id687" class="indexterm"/>can see, by <a id="id688" class="indexterm"/>default, the server scans in the <code class="literal">deployments</code> folder every <code class="literal">5000</code> ms. This service can be customized in many ways. Next, we will look at how we can further configure the deployment scanner.</p><div class="section" title="Deploying applications to a custom folder"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec44"/>Deploying applications to a custom folder</h3></div></div></div><p>If you want to <a id="id689" class="indexterm"/>change the location of the deployment folder, you need to modify the <code class="literal">relative-to</code> and <code class="literal">path</code> properties. If you provide both properties, the <code class="literal">deployments</code> folder is a sum of both properties. For example, considering that you have defined the <code class="literal">wildfly8deployments</code> path, you can later reference it as a relative path for your deployments, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;paths&gt;
  <span class="strong"><strong>&lt;path name="wildfly8deployments" path="/opt/applications" /&gt;</strong></span>
&lt;/paths&gt;

&lt;subsystem &gt;
     &lt;deployment-scanner path="deployments" relative-to="wildfly8deployments" scan-interval="5000" runtime-failure-causes-rollback="false"/&gt;
&lt;/subsystem&gt;</pre></div><p>In this configuration, the deployment scanner looks for applications within the <code class="literal">deployments</code> folder under <code class="literal">/opt/applications</code>.</p><p>The same effect can be achieved using an absolute path for your deployments, leaving out the <code class="literal">relative-to</code> property and configuring the <code class="literal">path</code> element, as shown in the following example:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;deployment-scanner scan-interval="5000" runtime-failure-causes-rollback="false" path="/opt/applications/deployments" /&gt;</strong></span>
</pre></div></div><div class="section" title="Changing the behavior of the deployment scanner"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec45"/>Changing the behavior of the deployment scanner</h3></div></div></div><p>By default, every <a id="id690" class="indexterm"/>packaged archive that is placed in the <code class="literal">deployments</code> folder is automatically deployed. On the other hand, exploded applications need one more step to be deployed (see the <span class="emphasis"><em>Manual application deployment</em></span> section).</p><p>We can easily change this behavior of the deployment scanner. The properties that control the <code class="literal">auto-deploy</code> feature are <code class="literal">auto-deploy-zipped</code> and <code class="literal">auto-deploy-exploded</code>, respectively, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;deployment-scanner scan-interval="5000" relative-to="jboss.server.base.dir"path="deployments" <span class="strong"><strong>auto-deploy-zipped="true" auto-deploy-exploded="false"/&gt;</strong></span>
</pre></div><p>You can<a id="id691" class="indexterm"/> set the <code class="literal">auto-deploy-exploded</code> property to <code class="literal">true</code> to achieve automatic deployment of exploded archives, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;deployment-scanner scan-interval="5000" relative-to="jboss.server.base.dir"path="deployments" <span class="strong"><strong>auto-deploy-zipped="true" auto-deploy-exploded="true"/&gt;</strong></span>
</pre></div></div><div class="section" title="Deployment rollback"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec46"/>Deployment rollback</h3></div></div></div><p>WildFly 8 introduces a new option to roll back a failed deployment. To do this, simply update the <code class="literal">runtime-failure-causes-rollback</code> property to <code class="literal">true</code>, as shown in the following code snippet. The default behavior is <code class="literal">false</code>:</p><div class="informalexample"><pre class="programlisting">&lt;subsystem &gt;
    &lt;deployment-scanner path="deployments" relative-to="jboss.server.base.dir" scan-interval="5000" runtime-failure-causes-rollback="true"/&gt;&lt;/subsystem&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note39"/>Note</h3><p>If the <code class="literal">failure-causes-rollback</code> property is set to <code class="literal">true</code>, a deployment failure also triggers the rollback of any other deployment that was processed as part of the same scan.</p></div></div></div><div class="section" title="Deploying an application using the CLI"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec47"/>Deploying an application using the CLI</h3></div></div></div><p>Copying<a id="id692" class="indexterm"/> the application archives is often favored by many developers, as it can be performed automatically <a id="id693" class="indexterm"/>by the development environment. However, we lay stress on the advantages of using the CLI interface, which offers a wide choice of additional options when deploying and also allows you to deploy applications remotely.</p><p>All it takes to deploy an application archive is to log in to the CLI, either a local or remote instance, and issue the <code class="literal">deploy</code> command. When used without arguments, the <code class="literal">deploy</code> command prints a list of applications that are currently deployed. Take a look at the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[disconnected /] connect</strong></span>
<span class="strong"><strong>[standalone@localhost:9990 /] deploy MyApp.war</strong></span>
</pre></div><p>To deploy your application to the standalone server, pass through the relative (or absolute) path of your archive. This path obviously relates to the client machine if you are connected to a remote server. This immediately deploys your application to the server. Take a look at the following screenshot:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] deploy ./target/MyApp.war</strong></span>
</pre></div><p>When you <a id="id694" class="indexterm"/>specify a relative<a id="id695" class="indexterm"/> path, it is relative to the location you started the CLI utility from. You can, however, use absolute paths when specifying the location of your archives. The CLI auto-complete functionality (using the <span class="emphasis"><em>Tab</em></span> key) makes light work of this. Have a look at the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] deploy /opt/workspace/my-app/target/MyApp.war</strong></span>
</pre></div><p>By default, when you deploy via the CLI, the application is deployed and enabled so that the user can access it. If you want to just perform the deployment of the application and enable it at a later time, you can add the <code class="literal">--disabled</code> switch, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] deploy ./target/MyApp.war --disabled</strong></span>
</pre></div><p>In order to enable the application, simply issue another <code class="literal">deploy</code> command without the <code class="literal">--disabled</code> switch, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] deploy --name=MyApp.war</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note40"/>Note</h3><p>Did you notice the optional <code class="literal">--name</code> switch that has been added? When using this switch, you are able to use the <span class="strong"><strong>tab completion</strong></span> feature<a id="id696" class="indexterm"/> so that you can automatically find the inactive deployment unit.</p></div></div><p>Redeploying the application requires an additional flag to the <code class="literal">deploy</code> command. You will get an error if you try to deploy the same application twice without using this flag. The <code class="literal">–f</code> argument forces the redeployment of the application, as shown here:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] deploy -f ./target/MyApp.war</strong></span>
</pre></div><p>Undeploying the application can be done through the <code class="literal">undeploy</code> command, which takes the name of the deployment as an argument, as shown here:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[standalone@localhost:9990 /] undeploy MyApp.war</strong></span>
</pre></div><p>Upon checking the configuration file, <code class="literal">standalone.xml</code>, you notice that the <code class="literal">deployment</code> element for your application has been removed.</p></div><div class="section" title="Deploying an application using the web admin console"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec48"/>Deploying an application using the web admin console</h3></div></div></div><p>Application <a id="id697" class="indexterm"/>deployment can also be completed using the web admin console:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start the console hyperlink, <code class="literal">http://localhost:9990/console</code>, in your browser.</li><li class="listitem">You need to <a id="id698" class="indexterm"/>add at least one management user to access the web console. To add a new user, execute the <code class="literal">add-user.bat</code> or <code class="literal">add-user.sh</code> script within the <code class="literal">bin</code> folder of your WildFly installation, and enter the requested information. See <a class="link" href="ch10.html" title="Chapter 10. Securing WildFly">Chapter 10</a>, <span class="emphasis"><em>Securing WildFly</em></span>, for more details.</li><li class="listitem">Server deployment is managed by the application server by selecting <span class="strong"><strong>Runtime</strong></span> in the top menu and then choosing the <span class="strong"><strong>Manage Deployments</strong></span> option. If you want to add a new application to WildFly, just click on the <span class="strong"><strong>Add</strong></span> button of your console, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_02.jpg" alt="Deploying an application using the web admin console"/></div><p>An intuitive wizard guides you through selecting your application and providing a runtime name for it, as shown in the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_06_03.jpg" alt="Deploying an application using the web admin console"/></div></li></ol></div><p>There<a id="id699" class="indexterm"/> are two <a id="id700" class="indexterm"/>properties shown in the wizard that may cause some confusion:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Name</strong></span> property<a id="id701" class="indexterm"/> is the name by which the deployment should be known within a server's runtime, for example, <code class="literal">MyApp-1.0.0.war</code>. This is used as the basis for the module names and is usually the name of the archive.</li><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>Runtime Name</strong></span> is <a id="id702" class="indexterm"/>typically the same as the <span class="strong"><strong>Name</strong></span>, but there may be instances where you wish to have two deployments with the same runtime name. For example, you may have <code class="literal">MyApp-1.0.0.war</code> and <code class="literal">MyApp-1.0.1.war</code> within the content repository but have the runtime name of <code class="literal">MyApp.war</code> for both archives. They cannot be deployed at the same time, and one of them would need to be disabled.</li></ul></div><p>The admin console, by default, deploys the application but does not enable it. By clicking on the <span class="strong"><strong>Enable</strong></span> button, the application can now be accessed, as shown in the following screenshot:</p><p> </p><div class="mediaobject"><img src="graphics/6232OS_06_04.jpg" alt="Deploying an application using the web admin console"/></div><p>
</p></div><div class="section" title="Deploying an application using the WildFly Eclipse plugin"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec49"/>Deploying an application using the WildFly Eclipse plugin</h3></div></div></div><p>Eclipse is<a id="id703" class="indexterm"/> the <a id="id704" class="indexterm"/>most widely used application development environment for Java developers, and it's also the favorite IDE for JBoss developers, as the JBoss Tools project<a id="id705" class="indexterm"/> (<a class="ulink" href="http://www.jboss.org/tools">http://www.jboss.org/tools</a>) supports the Eclipse environment by providing a set of plugins for JBoss projects.</p><p>In the first chapter of this book, we outlined the installation steps for Eclipse, along with JBoss tools. We also set up the WildFly server adapter, which allows you to start, stop, debug, and deploy applications on WildFly using the standalone mode.</p><p>Deploying applications to WildFly is easy once you have your WildFly Eclipse plugin installed:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Simply navigate to the <span class="strong"><strong>Server</strong></span> tab, right-click on the <span class="strong"><strong>WildFly Runtime Server</strong></span>, and select <span class="strong"><strong>Add and Remove</strong></span>. You are presented with a window, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_05.jpg" alt="Deploying an application using the WildFly Eclipse plugin"/></div></li><li class="listitem">Next, click <a id="id706" class="indexterm"/>on your application, select <span class="strong"><strong>Add</strong></span>, and then click on <span class="strong"><strong>Finish</strong></span>. The project now <a id="id707" class="indexterm"/>publishes to the server. If you ever need to redeploy, click on the project you want to deploy, and choose <span class="strong"><strong>Full</strong></span> <span class="strong"><strong>Publish</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_06.jpg" alt="Deploying an application using the WildFly Eclipse plugin"/></div></li></ol></div><div class="section" title="Configuring Eclipse deployments"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl4sec02"/>Configuring Eclipse deployments</h4></div></div></div><p>By double-clicking <a id="id708" class="indexterm"/>on the WildFly Runtime, you have access to a tabbed menu, which contains two options: <span class="strong"><strong>Overview</strong></span> and <span class="strong"><strong>Deployment</strong></span>. The <span class="strong"><strong>Deployment</strong></span> option is specific to JBoss tools and lets you choose the deployment location and packaging style of deployment. Take a look at the following screenshot:</p><div class="mediaobject"><img src="graphics/6232OS_06_07.jpg" alt="Configuring Eclipse deployments"/></div><p>Upon checking the <span class="strong"><strong>Deploy projects as compressed archives</strong></span> option, your application is compressed and packaged.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>If you choose to deploy your application as an exploded archive, Eclipse adds a <code class="literal">.dodeploy</code> marker file once the application has been copied to the <code class="literal">deployments</code> folder. This triggers immediate application deployment. See the next section for more information about marker files.</p></div></div></div></div></div><div class="section" title="Manual application deployment"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec77"/>Manual application deployment</h2></div></div></div><p>When <a id="id709" class="indexterm"/>using the <a id="id710" class="indexterm"/>manual application deployment approach, the deployment scanner does not automatically deploy the applications that are placed in the <code class="literal">deployments</code> folder. Rather, it uses a set of marker files, which are used to trigger application redeployment and capture the result of the operation.</p><p>You might wonder why marker files are used by the application server and why the default server configuration is set to use exploded deployments.</p><p>Actually, there are several reasons for this choice, and all of them are related to how the operating system's filesystem works. Exploded archives involve moving/replacing files in your filesystem, which should be performed automatically. By atomic operation, we mean that a filesystem operation needs to be performed as a single operation. Unfortunately, some operating systems like Windows don't treat complex filesystem operations such as a file moving as atomic operations.</p><p>Most Windows users often experience deployment issues on releases of WildFly prior to JBoss AS 7. This is due to the JVM refusing to release a file handle to <code class="literal">META-INF/application.xml</code> or an EJB descriptor file. That's because Windows uses a mandatory file lock, which prevents any application from accessing the file. On the other hand, operating systems such as UNIX use an advisory file lock, which means that unless an application checks for a file lock, it is not prevented from accessing the file.</p><p>Also, using marker files, the application server is able to solve a common issue related to large deployment files. If you've ever tried to deploy a large package unit (especially over a network), you might have experienced deployment errors because the deployment scanner starts deploying before the copy operation is completed, resulting in partially-completed deployments. Marker files are used by default for exploded deployments. They consist of empty files with a suffix, which are added either by the user or by the container to indicate the outcome of an operation.</p><p>The most relevant marker file is <code class="literal">.dodeploy</code>, which triggers application redeployment. As a matter of fact, when we add an exploded deployment and the <code class="literal">auto-deploy-exploded</code> attribute is <code class="literal">false</code> in the deployment scanner configuration, the logs in the console warn us that the application is still not deployed, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>21:51:54,915 INFO  [org.jboss.as.server.deployment.scanner] (DeploymentScanner-threads - 1) JBAS015003: Found MyApp.war in deployment directory. To trigger deployment create a file called MyApp.war.dodeploy</strong></span>
</pre></div><p>Both Windows and Unix users can trigger deployment by simply running the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>echo "" &gt; MyApp.war.dodeploy</strong></span>
</pre></div><p>Once you have started the deployment process, the application server replies with two possible outcomes. A<a id="id711" class="indexterm"/> deployed marker file (for example, <code class="literal">MyApp.war.deployed</code>) is placed in the <code class="literal">deployments</code> directory by the deployment scanner service to indicate that the given content has been deployed to the server, and your logs should confirm the outcome, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>22:23:18,887 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 28) JBAS018559: Deployed "MyApp.war" (runtime-name : "MyApp.war")</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>If you remove the <code class="literal">.deployed</code> file, the application is undeployed, and an <code class="literal">.undeployed</code> marker file is added to the <code class="literal">deployments</code> folder (for example, <code class="literal">MyApp.war.undeployed</code>). If you try to remove the <code class="literal">.undeployed</code> file, the application is deployed again. This is a useful shortcut to quickly undeploy (or redeploy) the application without deleting it on the filesystem.</p></div></div><p>The other possible outcome is a deployment failure, which is indicated by a <code class="literal">.failed</code> marker. The content of the file includes some information about the cause of the failure; however, you should check the server logs for more detailed information regarding the cause of the error.</p><p>When using <a id="id712" class="indexterm"/>the autodeploy mode, you can remove the <code class="literal">.failed</code> marker file, which redeploys the application when the folder is rescanned by the deployment scanner. Additionally, the user can place the <code class="literal">.skipdeploy</code> marker file (for example, <code class="literal">MyApp.war.skipdeploy</code>), which disables <code class="literal">auto-deploy</code> of the content for as long as this marker file is present. Use this if you rely on automatic deployment and want to ensure that no deploy is triggered when updates are still incomplete.</p><p>Let's see a sample script, which can be used to perform a safe redeployment of a web application named <code class="literal">MyApp.war</code>, when using the Linux operating system:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>touch $JBOSS_HOME/standalone/deployments/MyApp.war.skipdeploy</strong></span>
<span class="strong"><strong>cp -r MyApp.war/  $JBOSS_HOME/standalone/deployments</strong></span>
<span class="strong"><strong>rm $JBOSS_HOME/standalone/deployments/MyApp.war.skipdeploy</strong></span>
</pre></div><p>The Windows equivalent is defined as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>echo "" &gt; "%JBOSS_HOME%\standalone\deployments\MyApp.war.skipdeploy"</strong></span>
<span class="strong"><strong>xcopy MyApp.war %JBOSS_HOME%\standalone\deployments\MyApp.war /E /I</strong></span>
<span class="strong"><strong>del %JBOSS_HOME%\standalone\deployments\MyApp.war.skipdeploy</strong></span>
</pre></div><p>Finally, the application server provides some additional temporary marker files, such as <code class="literal">.isdeploying</code>, <code class="literal">.isundeploying</code>, or <code class="literal">.pending</code>, that are placed by the deployment scanner to indicate the transition to the deployment or undeployment of a resource. Full details of <a id="id713" class="indexterm"/>marker files are provided in the <code class="literal">README.txt</code> file placed in the <code class="literal">deployments</code> folder of the <a id="id714" class="indexterm"/>server distribution. The following table displays a short summary of the available marker files used by the application server:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Marker</p>
</th><th style="text-align: left" valign="bottom">
<p>Created by</p>
</th><th style="text-align: left" valign="bottom">
<p>Description</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.dodeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>User</p>
</td><td style="text-align: left" valign="top">
<p>Creating<a id="id715" class="indexterm"/> this file triggers application deployment. Touching this file causes application redeployment.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.skipdeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>User</p>
</td><td style="text-align: left" valign="top">
<p>Application<a id="id716" class="indexterm"/> autodeployment is disabled as long as this file exists.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.deployed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>The application is deployed. Removing it causes undeployment of the application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.undeployed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>The application has been undeployed. Removing it causes redeployment of the application.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.failed</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>The application deployment has failed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.isdeploying</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>The application deployment is in progress.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.isundeploying</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>The application undeployment is in progress.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">.pending</code>
</p>
</td><td style="text-align: left" valign="top">
<p>WildFly</p>
</td><td style="text-align: left" valign="top">
<p>One <a id="id717" class="indexterm"/>condition is preventing application deployment (for example, file copying in progress).</p>
</td></tr></tbody></table></div></div></div>
<div class="section" title="Deploying applications on a WildFly domain"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec31"/>Deploying applications on a WildFly domain</h1></div></div></div><p>Deploying <a id="id718" class="indexterm"/>applications on a WildFly domain is not as simple as deploying to a standalone server. There is no predefined <code class="literal">deployments</code> folder in the domain installation. The reason for this is that in the <code class="literal">domain</code> mode, there can be many servers belonging to different server groups, each one running different profiles. In this situation, a single <code class="literal">deployments</code> folder raises the obvious question: which server groups will use that folder?</p><p>Next, we are going to look at the options available when deploying applications to a WildFly domain. These <a id="id719" class="indexterm"/>two options are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <span class="strong"><strong>command-line interface</strong></span> (<span class="strong"><strong>CLI</strong></span>)</li><li class="listitem" style="list-style-type: disc">The admin web interface</li></ul></div><div class="section" title="Deploying to a domain using the CLI"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec78"/>Deploying to a domain using the CLI</h2></div></div></div><p>Let's see how to <a id="id720" class="indexterm"/>deploy an application <a id="id721" class="indexterm"/>using the CLI. Start by launching the CLI, and connect to the domain controller, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[disconnected /] connect</strong></span>
<span class="strong"><strong>domain@localhost:9990 /]</strong></span>
</pre></div><p>When you deploy an application using the domain mode, you have to specify to which server group the deployment is associated. The CLI lets you choose between the following two options:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Deploy to all server groups</li><li class="listitem" style="list-style-type: disc">Deploy to a single server group</li></ul></div><div class="section" title="Deploying to all server groups"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec50"/>Deploying to all server groups</h3></div></div></div><p>When choosing the<a id="id722" class="indexterm"/> option to deploy to all server groups, the application is deployed to all the available server groups. The <code class="literal">--all-server-groups</code> flag can be used to deploy to all the available server groups. For example, use the following command:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] deploy ../application.ear --all-server-groups</strong></span>
</pre></div><p>If, on the other hand, you want to undeploy an application from all server groups belonging to a domain, you have to issue the <code class="literal">undeploy</code> command, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] undeploy application.ear --all-relevant-server-groups</strong></span>
</pre></div><p>You might have noticed that the <code class="literal">undeploy</code> command uses <code class="literal">--all-relevant-server-groups</code> instead of <code class="literal">--all-server-groups</code>. The reason for this difference is that the deployment may not be enabled on all server groups, so by using this option, you actually undeploy it just from all those server groups in which the deployment is enabled.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>Deploying an application as <code class="literal">disabled</code> can be useful if you have some startup beans (which are activated when the application is enabled) and you want to load them, but don't want to trigger their execution, for example, if the database or any other enterprise information system is temporarily unavailable.</p></div></div></div><div class="section" title="Deploying to a single server group"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec51"/>Deploying to a single server group</h3></div></div></div><p>The<a id="id723" class="indexterm"/> option of deploying to a single server group lets you perform a selective deployment of your application just on the server groups you have indicated, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] deploy application.ear --server-groups=main-server-group</strong></span>
</pre></div><p>You are not limited to a single server group. To deploy to multiple server groups, separate them with a comma, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] deploy application.ear --server-groups=main-server-group,other-server-group</strong></span>
</pre></div><p>Remember, you can use the autocomplete functionality (the <span class="emphasis"><em>Tab</em></span> key) to display the list of available <code class="literal">--server-groups</code>.</p><p>Now, suppose we want to undeploy the application from just one server group. There can be two possible outcomes. If the application is available just on that server group, you successfully complete the undeployment:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] undeploy MyApp.war --server-groups=main-server-group</strong></span>
</pre></div><p>On the other hand, if your application is available on other server groups, the following error is returned by the CLI:</p><p> </p><div class="mediaobject"><img src="graphics/6232OS_06_08.jpg" alt="Deploying to a single server group"/></div><p>
</p><p>This error occurs because when you are removing an application from a server group, the domain controller verifies that the application is not referenced by any other server group. If it is, the <code class="literal">undeploy</code> command fails.</p><p>If you wish to<a id="id724" class="indexterm"/> remove your application from a single server group, you need to issue the <code class="literal">-keep-content</code> argument. This causes the domain controller to undeploy the application from the server group while retaining the content:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[domain@localhost:9990 /] undeploy application.ear --server-groups=main-server-group --keep-content</strong></span>
</pre></div><p>We have covered many of the available options to deploy applications to a domain. Before moving to the admin console, let's review the CLI deployment options, as shown in the following table:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Command</p>
</th><th style="text-align: left" valign="bottom">
<p>Options</p>
</th><th style="text-align: left" valign="bottom">
<p>Effect</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">deploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">--all-server-groups</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id725" class="indexterm"/>deploys an application to all server groups.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">undeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">--server-groups</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id726" class="indexterm"/>deploys an application to one or more server groups.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">undeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">--all-relevant-server-groups</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id727" class="indexterm"/>undeploys and removes an application from all server groups.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">undeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">--server-groups</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id728" class="indexterm"/>undeploys an application from one server group. This fails if it's referenced in another server group.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">undeploy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">--server-groups -keep-content</code>
</p>
</td><td style="text-align: left" valign="top">
<p>This <a id="id729" class="indexterm"/>undeploys an application from one server group without deleting it.</p>
</td></tr></tbody></table></div></div></div><div class="section" title="Deploying to a domain using the Admin console"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec79"/>Deploying to a domain using the Admin console</h2></div></div></div><p>Deploying <a id="id730" class="indexterm"/>applications using<a id="id731" class="indexterm"/> the <span class="strong"><strong>Admin</strong></span> console is pretty intuitive and requires just a few simple steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Start by logging in to the web application via the default address, <code class="literal">http://localhost:9990</code>.</li><li class="listitem">Then, select the <span class="strong"><strong>Runtime</strong></span> tab in the top menu and select <span class="strong"><strong>Manage Deployments</strong></span> in the left-hand side panel of the screen, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_09.jpg" alt="Deploying to a domain using the Admin console"/></div></li><li class="listitem">Before you <a id="id732" class="indexterm"/>can deploy your application to a server group, you need to upload it to the server, where<a id="id733" class="indexterm"/> it is stored in a content repository. To do this, click on <span class="strong"><strong>CONTENT REPOSITORY,</strong></span> and then click on <span class="strong"><strong>Add</strong></span>.<p>This displays the following dialog, which allows you to upload your application:</p><div class="mediaobject"><img src="graphics/6232OS_06_10.jpg" alt="Deploying to a domain using the Admin console"/></div></li><li class="listitem">Once you are finished with the upload wizard, the application is uploaded to the domain<a id="id734" class="indexterm"/> repository. In order to deploy/undeploy it to the single server groups, you need<a id="id735" class="indexterm"/> to select the <span class="strong"><strong>SERVER GROUPS</strong></span> tab, and then click on the <span class="strong"><strong>View</strong></span> button on the server group you wish to deploy to, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_11.jpg" alt="Deploying to a domain using the Admin console"/></div></li><li class="listitem">The next screen shows you all the deployments for this server group. Now, click on the <span class="strong"><strong>Assign</strong></span> button. This allows you to select from the applications that are currently stored within the content repository. Select the checkbox for your application and then click on <span class="strong"><strong>Save</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_12.jpg" alt="Deploying to a domain using the Admin console"/></div></li><li class="listitem">At this point, the <a id="id736" class="indexterm"/>application is deployed but still not enabled. Choose the <span class="strong"><strong>En/Disable</strong></span> button to <a id="id737" class="indexterm"/>complete the deployment of the application, as shown in the following screenshot:<div class="mediaobject"><img src="graphics/6232OS_06_13.jpg" alt="Deploying to a domain using the Admin console"/></div></li></ol></div><p>Clicking on the <span class="strong"><strong>Remove</strong></span> button within the <span class="strong"><strong>SERVER GROUPS</strong></span> tab removes the deployment from the server group selected, while the other <span class="strong"><strong>Remove</strong></span> button within the <span class="strong"><strong>CONTENT</strong></span> <span class="strong"><strong>REPOSITORY</strong></span> tab actually deletes the deployment from the temporary domain repository where uploaded applications are bundled.</p></div></div>
<div class="section" title="Explaining WildFly classloading"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec32"/>Explaining WildFly classloading</h1></div></div></div><p>There are two <a id="id738" class="indexterm"/>approaches to managing dependencies, the first being the <a id="id739" class="indexterm"/>
<span class="strong"><strong>Class-Path</strong></span> approach and the second, the <a id="id740" class="indexterm"/>
<span class="strong"><strong>Dependencies</strong></span> approach. We will cover both of these topics in this section, but before we do, let's take a look at the history of classloading in WildFly in order to understand why classloading works the way it does. As mandated by the Java EE specification, an application server needs to provide an environment where any deployed application can access any class, or library of classes, of a particular version.</p><p>This is also known as <a id="id741" class="indexterm"/>
<span class="strong"><strong>Class Namespace Isolation</strong></span> (Java EE 5 specification, section EE.8.4). However, loading classes from different namespaces can raise some issues that are not easy to solve. For example, what happens if you pack a newer version of a utility library with your application, while an older version of the same library was loaded by the application server? Or, how do you simultaneously use two different versions of the same utility library within the same instance of the application server?</p><p>The JBoss AS classloading strategy<a id="id742" class="indexterm"/> has changed sensibly through the years. The 4.x releases of the application server used <code class="literal">UnifiedClassLoader</code>, which aimed to reduce communications overhead between running applications, as class data could be shared by reference or simple copies.</p><p>One of the major issues not resolved with <code class="literal">UnifiedClassLoader</code> is <a id="id743" class="indexterm"/>
<span class="strong"><strong>classloading dependencies</strong></span>. The idea is that if one application (A) uses the classes of another application (B), the system should know how to redeploy A when B gets redeployed; otherwise, it references stale classes. There were actually two different attempts to try to make this work without the user having to configure anything. Neither attempt really worked and both were dropped.</p><p>With JBoss AS 5.0, a new classloader was based on the new <a id="id744" class="indexterm"/>
<span class="strong"><strong>Virtual File System</strong></span> (<span class="strong"><strong>VFS</strong></span>). The VFS was implemented to simplify and unify file handling within the application server. The new classloader, named the VFS classloader, uses VFS to locate JAR and class files. Even though this represented a significant change in how classes were loaded in JBoss AS 5.0, the resulting behavior is much the same as that of prior versions of JBoss AS.</p><p>A common source of errors was including API classes in a deployment that was also provided by the container. This could result in multiple versions of the class being created and the deployment failing to deploy properly.</p><p>Since JBoss AS 7, classloading marks a radical departure from previous attempts. Classloading is now <a id="id745" class="indexterm"/>based on the JBoss modules project, and any application that is deployed is, in effect, a module. This fact may raise some questions, such as what module name is to be assigned to a deployed application, and how dependencies between modules are handled by the application server.</p><p>These questions will be answered in the next few sections.</p><div class="section" title="Getting to know module names"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec80"/>Getting to know module names</h2></div></div></div><p>Getting to<a id="id746" class="indexterm"/> know module names is not an academic exercise. We can even go so far as establishing dependencies between modules. So, in many cases, you need to know how module names are assigned to an application.</p><p>Applications that are packaged as top-level archives (such as WAR, JAR, and SAR) are assigned the following module name:</p><p>
<code class="literal">deployment.[archive name]</code>
</p><p>For example, a web application named <code class="literal">WebExample1.war</code> is deployed with the following module name:</p><p>
<code class="literal">deployment.WebExample1.war</code>
</p><p>On the other hand, for applications that contain nested modules (such as EAR), each archive is assigned a module name using the following convention:</p><p>
<code class="literal">deployment.[ear archive name].[sub deployment archive name]</code>
</p><p>So, for example, the preceding web archive, if contained in an EAR file called <code class="literal">EnterpriseApp.ear</code>, would be deployed with the following name:</p><p>
<code class="literal">deployment.EnterpriseApp.ear.WebExample1.war</code>
</p></div><div class="section" title="Finding the isolation level"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec81"/>Finding the isolation level</h2></div></div></div><p>A general rule <a id="id747" class="indexterm"/>in WildFly 8 is that every deployed application module is isolated from other modules, that is, by default, the application <a id="id748" class="indexterm"/>does not have visibility on the AS modules, nor do the AS modules have visibility on the application.</p><p>Using the application server modules is relatively easy and can be summarized in a single sentence: add a dependency to the required module and the AS will use it. Some dependencies are automatically added to the application server, while others need to be signaled by the user:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The core module libraries (namely, the <code class="literal">Enterprise</code> classes) are qualified as implicit dependencies, so they are automatically added to your application when the deployer detects their usage</li><li class="listitem" style="list-style-type: disc">Other module libraries need to be explicitly declared by the user in the application's <code class="literal">MANIFEST</code> file or in a custom JBoss deployment file named <code class="literal">jboss-deployment-structure.xml</code> (more about this file in the <span class="emphasis"><em>Advanced deployment strategies</em></span> section)</li></ul></div><div class="section" title="Implicit dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec52"/>Implicit dependencies</h3></div></div></div><p>Repeatedly <a id="id749" class="indexterm"/>declaring commonly used dependencies for your enterprise application becomes very tedious. This is why the core modules are automatically added for you by the application server. Some of these core modules <a id="id750" class="indexterm"/>are only added when the application server detects annotations or configuration files for a particular technology. For example, adding a <code class="literal">beans.xml</code> file automatically triggers the <a id="id751" class="indexterm"/>
<span class="strong"><strong>Weld</strong></span> dependency (Weld is the Contexts and Dependency injection implementation used in WildFly).</p><p>The following table outlines the modules that are implicitly added to your application:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Subsystem</p>
</th><th style="text-align: left" valign="bottom">
<p>Automatic dependencies</p>
</th><th style="text-align: left" valign="bottom">
<p>Triggered dependencies</p>
</th><th style="text-align: left" valign="bottom">
<p>Trigger condition</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>Core server</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">javax.api</code>
</p>
<p>
<code class="literal">sun.jdk</code>
</p>
<p>
<code class="literal">org.jboss.vfs</code>
</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>EE</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">javaee.api</code>
</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>EJB3</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>
<code class="literal">javaee.api</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Presence of <code class="literal">ejb-jar.xml</code> or EJB annotations</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>JAX-RS</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">javax.xml.bind.api</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.jboss.resteasy</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Presence of JAX-RS annotations</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>JPA</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">javax.persistence</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">javaee.api</code>
</p>
<p>
<code class="literal">org.jboss.as.jpa</code>
</p>
<p>
<code class="literal">org.hibernate</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Presence of <code class="literal">@PersistenceUnit</code> or <code class="literal">@PersistenceContext</code> or equivalent XML</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Logging</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.jboss.logging</code>
</p>
<p>
<code class="literal">org.apache.commons.logging</code>
</p>
<p>
<code class="literal">org.apache.log4j</code>
</p>
<p>
<code class="literal">org.slf4j</code>
</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Security</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.picketbox</code>
</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Web</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>
<code class="literal">javaee.api</code>
</p>
<p>
<code class="literal">com.sun.jsf-impl</code>
</p>
<p>
<code class="literal">org.hibernate.validator</code>
</p>
<p>
<code class="literal">org.jboss.as.web</code>
</p>
<p>
<code class="literal">org.jboss.logging</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Deployment of WEB archive; JSF added if used</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>Web services</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">org.jboss.ws.api</code>
</p>
<p>
<code class="literal">org.jboss.ws.spi</code>
</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top"> </td></tr><tr><td style="text-align: left" valign="top">
<p>Weld</p>
</td><td style="text-align: left" valign="top"> </td><td style="text-align: left" valign="top">
<p>
<code class="literal">javax.persistence.api</code>
</p>
<p>
<code class="literal">javaee.api</code>
</p>
<p>
<code class="literal">org.javassist</code>
</p>
<p>
<code class="literal">org.jboss.interceptor</code>
</p>
<p>
<code class="literal">org.jboss.as.weld</code>
</p>
<p>
<code class="literal">org.jboss.logging</code>
</p>
<p>
<code class="literal">org.jboss.weld.core</code>
</p>
<p>
<code class="literal">org.jboss.weld.api</code>
</p>
<p>
<code class="literal">org.jboss.weld.spi</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Presence of <code class="literal">beans.xml</code>
</p>
</td></tr></tbody></table></div><p>If your application uses any of the core modules indicated, then you don't need to specify its dependency, as the <a id="id752" class="indexterm"/>application <a id="id753" class="indexterm"/>server links the module automatically. If you are using Maven, then you can mark these dependencies as provided.</p></div><div class="section" title="Explicit dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec53"/>Explicit dependencies</h3></div></div></div><p>Modules <a id="id754" class="indexterm"/>that are not qualified as<a id="id755" class="indexterm"/> implicit dependencies need to be declared by the user. Let's say you want to use the log4j library, which is bundled in the application server distribution. The simplest and recommended approach to achieve this is by including the <code class="literal">Dependencies: [module]</code> declaration within <code class="literal">META-INF/MANIFEST.MF</code>. The following example code for the chapter uses Maven to populate the <code class="literal">MANIFEST.MF</code> file:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
    &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.1.1&lt;/version&gt;
    &lt;configuration&gt;
        &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
        &lt;archive&gt;
            &lt;manifestEntries&gt;
                &lt;Dependencies&gt;org.apache.log4j&lt;/Dependencies&gt;
            &lt;/manifestEntries&gt;
        &lt;/archive&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div><p>This has the result of adding the following to your <code class="literal">MANIFEST.MF</code> file:</p><div class="mediaobject"><img src="graphics/6232OS_06_14.jpg" alt="Explicit dependencies"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note44"/>Note</h3><p>Please note that the module name does not always match the package name of the library. The actual module name is specified in the <code class="literal">module.xml</code> file by the <code class="literal">name</code> attribute of the <code class="literal">module</code> element.</p></div></div><p>You are not<a id="id756" class="indexterm"/> limited to a single <a id="id757" class="indexterm"/>dependency, as you can add multiple dependencies separated by a comma. For example, in order to add a dependency on both log4j and Apache Velocity API, use the following:</p><div class="informalexample"><pre class="programlisting">Dependencies: org.apache.log4j,org.apache.velocity</pre></div><p>You can even export the dependencies used by one application module to other applications by adding the <code class="literal">export</code> keyword. For example, in addition to the earlier example, we're now exporting the dependencies to other modules, as follows:</p><div class="mediaobject"><img src="graphics/6232OS_06_15.jpg" alt="Explicit dependencies"/></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note45"/>Note</h3><p>The <code class="literal">export</code> parameter can also be used to export a dependency to all subdeployments contained in the EAR. Consequently, if you export a dependency from the top-level of the EAR (or by a JAR in the <code class="literal">ear/lib</code> directory), then the dependency is also available to all subdeployment units.</p></div></div><p>Applications<a id="id758" class="indexterm"/> that are marked as <a id="id759" class="indexterm"/>dependent to the <code class="literal">deployment.WebApp1.war</code> module also have access to its dependencies:</p><div class="mediaobject"><img src="graphics/6232OS_06_16.jpg" alt="Explicit dependencies"/></div><p>Within <code class="literal">META-INF/MANIFEST.MF</code>, you can also specify additional commands that can modify the server deployer's behavior. For example, the <code class="literal">optional</code> attribute can be added to specify that the deployment does not fail if the module is not found at the deployment time.</p><p>Finally, when the <code class="literal">services</code> keyword is specified, the deployer tries to load services that are placed within the <code class="literal">META-INF/services</code> directory of the archive.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note46"/>Note</h3><p>The <a id="id760" class="indexterm"/>
<code class="literal">service</code> API has become <code class="literal">public</code> in Java SE 6. A <span class="strong"><strong>service</strong></span><a id="id761" class="indexterm"/> can be defined as a set of programming interfaces and classes that provide access to some specific application functionality or feature. A <span class="strong"><strong>Service Provider Interface</strong></span> (<span class="strong"><strong>SPI</strong></span>)<a id="id762" class="indexterm"/> is the set of <code class="literal">public</code> interfaces and <code class="literal">abstract</code> classes that a service defines.</p><p>You can define a service provider by implementing the service provider API. Usually, you create a JAR file to hold your provider. To register your provider, you must create a provider configuration file in the JAR file's <code class="literal">META-INF/services</code> directory. When adding the <code class="literal">services</code> attribute to your <code class="literal">META-INF/MANIFEST.MF</code> file, you are actually able to load the services contained in the <code class="literal">META-INF/services</code> directory.</p><p>One excellent introduction<a id="id763" class="indexterm"/> to the SPI API is available at <a class="ulink" href="http://www.oracle.com/technetwork/articles/javase/extensible-137159.html">http://www.oracle.com/technetwork/articles/javase/extensible-137159.html</a>.</p></div></div></div></div><div class="section" title="Setting up global modules"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec82"/>Setting up global modules</h2></div></div></div><p>Setting up <a id="id764" class="indexterm"/>global modules resembles the old AS approach to loading common libraries, where you used to place them in the <code class="literal">lib</code> folder under <code class="literal">JBOSS_HOME/common</code>.</p><p>If you define a section named <code class="literal">global-modules</code> within <code class="literal">standalone.xml/domain.xml</code>, then you make the module accessible to other AS modules. For example, instead of declaring a dependency on log4j, you can alternatively use the following section:</p><div class="informalexample"><pre class="programlisting">&lt;subsystem &gt;
  &lt;global-modules&gt;
    <span class="strong"><strong>&lt;module name="org.apache.log4j" /&gt;</strong></span>
  &lt;/global-modules&gt;
&lt;/subsystem&gt;</pre></div><p>Although this approach is not generally recommended, as it brings us back to the concept of a monolithic application server, it can still yield some benefits, for example, when you migrate some older applications, and also when you don't want or simply cannot specify dependencies to the archive.</p></div><div class="section" title="Advanced deployment strategies"><div class="titlepage"><div><div><h2 class="title"><a id="ch06lvl2sec83"/>Advanced deployment strategies</h2></div></div></div><p>The topics<a id="id765" class="indexterm"/> covered so far are sufficient <a id="id766" class="indexterm"/>for the vast majority of applications. If you are using a complex archive configuration, such as an EAR archive with several modules and dependencies, it might be useful to define your classloading strategy in a single file. The configuration file, <code class="literal">jboss-deployment-structure.xml</code>, does exactly this. Some of the advantages<a id="id767" class="indexterm"/> of using this file are outlined as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">You can define the dependencies of all application modules in a single file</li><li class="listitem" style="list-style-type: disc">You can load the module classes in a fine-grained manner by including/excluding all or some parts of modules</li><li class="listitem" style="list-style-type: disc">You can define the classloading isolation policy for your applications packaged in an enterprise archive</li></ul></div><p>Let's see what <code class="literal">jboss-deployment-structure.xml</code> can do for you by taking a look at some practical examples.</p><div class="section" title="Setting up a single module dependency"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec54"/>Setting up a single module dependency</h3></div></div></div><p>We have <a id="id768" class="indexterm"/>already learned how to activate a <code class="literal">log4j</code> dependency using the <code class="literal">Dependencies</code> attribute in the archive's <code class="literal">MANIFEST</code> file. The same effect can be achieved using the <code class="literal">jboss-deployment-structure.xml</code> file. Let's recap the archive structure, which is basically made up of a web application named <code class="literal">WebApp.war</code>.</p><p>As you can see in the following diagram, the <code class="literal">jboss-deployment-structure.xml</code> file needs to be placed within the <code class="literal">META-INF</code> folder of the EAR:</p><div class="mediaobject"><img src="graphics/6232OS_06_17.jpg" alt="Setting up a single module dependency"/></div><p>The following is the content of <code class="literal">jboss-deployment-structure.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;jboss-deployment-structure&gt;
  <span class="strong"><strong>&lt;sub-deployment name="WebApp.war"&gt;</strong></span>
    <span class="strong"><strong>&lt;dependencies&gt;</strong></span>
      <span class="strong"><strong>&lt;module name="org.apache.log4j" /&gt;</strong></span>
    <span class="strong"><strong>&lt;/dependencies&gt;</strong></span>
  <span class="strong"><strong>&lt;/sub-deployment&gt;</strong></span>
&lt;/jboss-deployment-structure&gt;</pre></div><p>The <code class="literal">jboss-deployment-structure</code> file is not for the exclusive use of EARs and can be used within a WAR archive by placing it within the <code class="literal">WEB-INF</code> folder. It is, however, applicable only as a top-level archive. Thus, if a <code class="literal">jboss-deployment-structure.xml</code> file is placed in the WAR's <code class="literal">WEB-INF</code> folder and the WAR is packaged in an EAR file, then the <code class="literal">jboss-deployment-structure.xml</code> file is ignored. The relevant part of this file is the subdeployment element, which references the web application, including the <code class="literal">dependencies</code> element. The expected outcome is that the application server triggers the dependency to <a id="id769" class="indexterm"/>the Log4J API, which is, therefore, visible by our web application.</p></div><div class="section" title="Excluding the server's automatic dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec55"/>Excluding the server's automatic dependencies</h3></div></div></div><p>Earlier in <a id="id770" class="indexterm"/>this chapter, we discussed how the application server can automatically trigger dependencies when certain conditions are met. For example, if you deploy a JSF application (containing the <code class="literal">faces-config.xml</code> file), then the JSF 2.2 API implementation is automatically added.</p><p>This might not always be the desired option, as you may want to provide another release implementation for that module. You can easily achieve this using the <code class="literal">exclusion</code> element in the <code class="literal">jboss-deployment-structure.xml</code> file, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;jboss-deployment-structure&gt;
  &lt;deployment&gt;
    &lt;exclusions&gt;
      <span class="strong"><strong>&lt;module name="javax.faces.api" /&gt;</strong></span>
      <span class="strong"><strong>&lt;module name="com.sun.jsf-impl" /&gt;</strong></span>
    &lt;/exclusions&gt;
    &lt;dependencies&gt;
      <span class="strong"><strong>&lt;module name="javax.faces.api" slot="2.1"/&gt;</strong></span>
      <span class="strong"><strong>&lt;module name="com.sun.jsf-impl" slot="2.1"/&gt;</strong></span>
    &lt;/dependencies&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></div><p>Notice that in the <code class="literal">dependencies</code> section, we added our alternate JSF 2.1 implementation, which is used by your application. You need to install these two modules shown in the preceding code, as explained in <a class="link" href="ch02.html" title="Chapter 2. Configuring the Core WildFly Subsystems">Chapter 2</a>, <span class="emphasis"><em>Configuring the Core WildFly Subsystems</em></span>. They can be placed alongside the implementations provided by WildFly by creating a folder named <code class="literal">2.1</code>. The new folder for the JSF 2.1 archive is highlighted in bold in the following command lines:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/main</strong></span>
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/main/jboss-jsf-api_2.2_spec-2.2.6.jar</strong></span>
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/main/module.xml</strong></span>
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/2.1</strong></span>
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/2.1/jsf-api-2.1.jar</strong></span>
<span class="strong"><strong>$JBOSS_HOME/modules/system/layers/base/javax/faces/api/2.1/module.xml</strong></span>
</pre></div><p>You also need to add the <code class="literal">slot</code> attribute to the <code class="literal">module.xml</code> file, as highlighted in the following <a id="id771" class="indexterm"/>code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;module  name="javax.faces.api" <span class="strong"><strong>slot="2.1" &gt;</strong></span>
    ...
&lt;/module&gt;</pre></div></div><div class="section" title="Isolating sub-deployments"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec56"/>Isolating sub-deployments</h3></div></div></div><p>Considering <a id="id772" class="indexterm"/>that you have an EAR application that is made up of a web application, an EJB module, and a JAR file containing utility classes, all subdeployments are placed at the root of the archive so that they can see each other. However, let's suppose your web application contains some implementations of the same EJB. That's absolutely possible since Java EE allows your web application to include EJB classes within the <code class="literal">WEB-INF/classes</code> or <code class="literal">WEB-INF/lib</code> folder, as the following diagram depicts:</p><div class="mediaobject"><img src="graphics/6232OS_06_18.jpg" alt="Isolating sub-deployments"/></div><p>How does the classloader resolve this conflict? The application server classloader has a priority list when loading classes, thus reducing any conflict between loaded classes, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The highest priority is automatically given to modules by the container, including the Java EE APIs. Libraries contained in the <code class="literal">modules</code> folder are included in this category.</li><li class="listitem" style="list-style-type: disc">The next priority goes to libraries that are indicated by the user within <code class="literal">MANIFEST.MF</code> of the packaged archive as dependencies (or in the <code class="literal">jboss-deployment-structure.xml</code> file).</li><li class="listitem" style="list-style-type: disc">The penultimate priority is given to libraries that are packed within the application itself, such as classes contained in <code class="literal">WEB-INF/lib</code> or <code class="literal">WEB-INF/classes</code>.</li><li class="listitem" style="list-style-type: disc">Finally, the last priority goes to libraries that are packed within the same EAR archive (in the EAR's <code class="literal">lib</code> folder).</li></ul></div><p>So, in this<a id="id773" class="indexterm"/> example, the EJB libraries located in the <code class="literal">WEB-INF</code> folder hides the implementations of <code class="literal">EJB.jar</code> top-level deployment. If this is not the desired result, you can simply override it, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;jboss-deployment-structure&gt;
  &lt;ear-subdeployments-isolated&gt;false&lt;/ear-subdeployments-isolated&gt;
  &lt;sub-deployment name="WebApp.war"&gt;
    &lt;dependencies&gt;
      &lt;module name="deployment.App.ear.EJB.jar" /&gt;
    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></div><p>In the preceding code snippet, we added a dependency to the <code class="literal">EJB.jar</code> deployment, which is placed at the root of the EAR and which overrides the implementation packed within the web application.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note47"/>Note</h3><p>Note the <code class="literal">ear-subdeployments-isolated</code> element placed at the top of the file. By setting the EAR isolation level, you will be able to indicate if the subdeployment modules are visible to each other.</p></div></div><p>The default value of the <code class="literal">ear-subdeployments-isolated</code> element is <code class="literal">false</code>, which means that the subdeployment modules can see each other. If you are setting isolation to <code class="literal">true</code>, each module is then picked up by a different classloader, which means that the web application is unable to find the classes contained in the <code class="literal">EJB.jar</code> and <code class="literal">Utility.jar</code> libraries).</p><p>If you want to keep the deployment isolated but allow visibility between some of your dependencies, then you have two choices available:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Move the library to the <code class="literal">EAR/lib</code> folder so that it is picked up as a separate module</li><li class="listitem" style="list-style-type: disc">Specify a dependency using Dependencies or Class-Path in the <code class="literal">MANIFEST.MF</code> file of the calling application</li></ul></div><p>In the following diagram, you can see how to correctly set up your EAR, by placing common libraries in the <code class="literal">lib</code> folder and adding a dependency to the EJB classes:</p><div class="mediaobject"><img src="graphics/6232OS_06_19.jpg" alt="Isolating sub-deployments"/></div><p>The following is <a id="id774" class="indexterm"/>the corresponding configuration required in <code class="literal">jboss-deployment-structure.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;jboss-deployment-structure&gt;
  <span class="strong"><strong>&lt;ear-subdeployments-isolated&gt;true&lt;/ear-subdeployments-isolated&gt;</strong></span>
  &lt;sub-deployment name="WebApp.war"&gt;
    &lt;dependencies&gt;
      &lt;module name="deployment.App.ear.EJB.jar" /&gt;
    &lt;/dependencies&gt;
  &lt;/sub-deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note48"/>Note</h3><p>Packaging libraries in a shared library within your EAR is an option. With Java EE 5 onward, it has been possible to place these files in a shared library folder called <code class="literal">lib</code>. You can override this default folder name using the <code class="literal">library-directory</code> element in the <code class="literal">META-INF/application.xml</code> file. For example, suppose you want to use the <code class="literal">common</code> folder to hold your shared libraries, in which case you can add the following line to your <code class="literal">application.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;library-directory&gt;common&lt;/library-directory&gt;</pre></div><p>As a side note, you should avoid placing component-declaring annotations (such as EJB3) in the shared folder, as it can have unintended consequences on the deployment process. For this reason, it is strongly recommended that you place your utility classes in the shared library folder.</p></div></div></div><div class="section" title="Using the Class-Path declaration to solve dependencies"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl3sec57"/>Using the Class-Path declaration to solve dependencies</h3></div></div></div><p>Until now, we <a id="id775" class="indexterm"/>have configured dependencies between modules using the JBoss way, which is the recommended choice. Nevertheless, we should also account for Java's portable way to reference one or more libraries included in the EAR file. This can be achieved by adding the <code class="literal">Class-Path</code> attribute to the <code class="literal">MANIFEST.MF</code> file. This allows a module to reference another library that is not otherwise visible to the application (think back to the earlier example of a deployment unit with the isolation set to <code class="literal">true</code>).</p><p>For example, considering that you need to reference the <code class="literal">Utility.jar</code> application from within your web application, you can simply add the following to your <code class="literal">META-INF/MANIFEST.MF</code> file directly inside your EAR:</p><div class="informalexample"><pre class="programlisting">Manifest-Version: 1.0
Class-Path: Utility.jar</pre></div><p>You can actually include more than one library to the <code class="literal">Class-Path</code> attribute, separating them by a comma.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note50"/>Note</h3><p>Unlike the <code class="literal">Dependencies</code> attribute, the <code class="literal">Class-Path</code> attribute points to the actual JAR filename (and not the module name) to reference the dependent libraries.</p></div></div><p>Choosing between the Class-Path approach and JBoss's Dependencies approach depends on how your application is structured: using JBoss's Dependencies approach buys you a richer set of options, in particular, the ability to export the dependencies to other deployments, as we have illustrated earlier. One more point in favor of JBoss's Dependencies approach is the ability to reference modules that are not actually packaged within the application.</p><p>On the other hand, the main advantage of the Class-Path approach relies on application portability. Thus, if a fully portable solution is a priority for you, you can consider switching to the <code class="literal">Class-Path</code> manifest attribute.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec33"/>Summary</h1></div></div></div><p>In this chapter, we covered a wide variety of functionalities related to the deployment of applications. Applications are deployed differently, depending on whether they are deployed to a standalone server or to a domain of servers.</p><p>As far as standalone servers are concerned, an application can be deployed either automatically or manually. By default, packaged archives are deployed automatically. This means that all you need to do is place the archive within the <code class="literal">standalone</code>/<code class="literal">deployments</code> folder of the application server. Applications that are deployed manually (by default, exploded archives) need marker files to activate the deployment.</p><p>As far as domain servers are concerned, since the application server cannot determine which server group you want to target the deployment to, you need to specify this information when using either the command-line interface or the web admin interface.</p><p>One of the great advantages of using a domain of servers is the ability to deploy applications on single or multiple server groups, which can even be created and equipped at runtime.</p><p>In the later part of this chapter, we covered the classloading mechanism used by the application server. Every application deployed to WildFly is treated as a module, all of which are isolated from other modules contained in the application server distribution. Modules representing Java EE API classes are implicitly added to your application's classpath as dependencies, which means that you don't need any special configuration to deploy a Java EE application.</p><p>If you want to reference other modules contained in the application server, you simply need to add a <code class="literal">Dependencies</code> property within the <code class="literal">META-INF/MANIFEST.MF</code> file of the application. Enterprise archives can also specify dependencies on other modules by setting the <code class="literal">Class-Path</code> attribute within the <code class="literal">META-INF/MANIFEST.MF</code> file.</p><p>If you want to maintain all your dependencies in a single file, you can use the <code class="literal">jboss-deployment-structure.xml</code> file. This allows you to define all dependencies within an archive, including the ability to override the default EAR isolation level and filter in/out classes, which are part of the application server deployment.</p><p>In the next chapter, we will cover the management of the application server by taking a close look at the command-line interface and the web admin console.</p></div></body></html>