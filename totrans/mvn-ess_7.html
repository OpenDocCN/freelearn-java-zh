<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;Best Practices"><div class="titlepage"><div><div><h1 class="title"><a id="ch07"/>Chapter 7. Best Practices</h1></div></div></div><p>In this book, so far, we discussed most of the key concepts related to Maven. In this chapter, we will focus on best practices associated with all of these core concepts. The following best practices constitute an essential ingredient in creating a successful and productive build environment. The criteria listed here will help you to evaluate the efficiency of your Maven project, mostly if you are dealing with a large-scale multi-module project:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The time taken by a developer to get started with a new project and add it to the build system</li><li class="listitem" style="list-style-type: disc">The effort required to upgrade a version of a dependency across all the project modules</li><li class="listitem" style="list-style-type: disc">The time taken to build the complete project with a fresh local Maven repository</li><li class="listitem" style="list-style-type: disc">The time taken to do a complete offline build</li><li class="listitem" style="list-style-type: disc">The time taken to update the versions of Maven artifacts produced by the project; for example, from 1.0.0-SNAPSHOT to 1.0.0</li><li class="listitem" style="list-style-type: disc">The effort required for a completely new developer to understand what your Maven build does</li><li class="listitem" style="list-style-type: disc">The effort required to introduce a new Maven repository</li><li class="listitem" style="list-style-type: disc">The time taken to execute unit tests and integration tests</li></ul></div><p>The rest of the chapter talks about 25 industry-accepted best practices that would help you to improve developer productivity and reduce any maintenance nightmares.</p><div class="section" title="Dependency management"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec47"/>Dependency management</h1></div></div></div><p>In the following <a id="id326" class="indexterm"/>example, you will notice that the dependency <a id="id327" class="indexterm"/>versions are added to each and every dependency defined in the application POM file:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
    &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
    <span class="strong"><strong>&lt;version&gt;2.26&lt;/version&gt;</strong></span>
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;commons-codec&lt;/groupId&gt;
    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
    <span class="strong"><strong>&lt;version&gt;1.2&lt;/version&gt;</strong></span>
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><p>Imagine you have a set of application POM files in a multi-module project having the same set of dependencies. If you have duplicated the artifact version with each and every dependency, then to upgrade to the latest dependency you need to update all the POM files, which can easily lead to a mess.</p><p>Not just that, if you have different versions of the same dependency used in different modules of the same <a id="id328" class="indexterm"/>project, then it's going to be a debugging nightmare in the case of an issue.</p><p>With <code class="literal">dependencyManagement</code>, we can overcome both these issues. If it's a multi-module Maven project, you <a id="id329" class="indexterm"/>need to introduce <code class="literal">dependencyManagement</code> in the parent POM, so it will be inherited by all the other child modules:</p><div class="informalexample"><pre class="programlisting">&lt;dependencyManagement&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
      &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
      &lt;version&gt;2.26&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;commons-codec&lt;/groupId&gt;
      &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
      &lt;version&gt;1.2&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</pre></div><p>Once you define <code class="literal">dependencies</code> under the <code class="literal">dependencyManagement</code> section, as shown in the preceding code, you only need to refer a <code class="literal">dependency</code> from its <code class="literal">groupId</code> and the <code class="literal">artifactId</code> elements. The <code class="literal">version</code> element is picked from the appropriate <code class="literal">dependencyManagement</code> section:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
    &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;commons-codec&lt;/groupId&gt;
    &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><p>With this, if you want to upgrade or downgrade a dependency, you only need to change the dependency version under the <code class="literal">dependencyManagement</code> section.</p><p>The same principle applies to plugins as well. If you have a set of plugins, which are used across multiple modules, you should define them under the <code class="literal">pluginManagement</code> section of the parent module. In this way, you can downgrade or upgrade plugin versions seamlessly just by <a id="id330" class="indexterm"/>changing the <code class="literal">pluginManagement</code> <a id="id331" class="indexterm"/>section of the parent POM, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">&lt;pluginManagement&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.4.2&lt;/version&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.0-beta-6&lt;/version&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
      &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
      &lt;version&gt;2.0.4&lt;/version&gt;
    &lt;/plugin&gt;
    &lt;plugin&gt;
       &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
	   &lt;version&gt;2.13&lt;/version&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/pluginManagement&gt;</pre></div><p>Once you define the plugins in the plugin management section, as shown in the preceding code, you only need to refer a plugin from its <code class="literal">groupId</code> (optional) and <code class="literal">artifactId</code> elements. The version is <a id="id332" class="indexterm"/>picked from the appropriate <a id="id333" class="indexterm"/>
<code class="literal">pluginManagement</code> section:</p><div class="informalexample"><pre class="programlisting">&lt;plugins&gt;      
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
    &lt;executions&gt;……&lt;/executions&gt;
  &lt;/plugin&gt;
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-site-plugin&lt;/artifactId&gt;
    &lt;executions&gt;……&lt;/executions&gt;
  &lt;/plugin&gt;
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
    &lt;executions&gt;……&lt;/executions&gt;
  &lt;/plugin&gt;
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;executions&gt;……&lt;/executions&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;</pre></div><p>Maven plugins were discussed in detail in <a class="link" href="ch04.html" title="Chapter 4. Maven Plugins">Chapter 4</a>, <span class="emphasis"><em>Maven Plugins</em></span>.</p></div></div>
<div class="section" title="Defining a parent module"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec48"/>Defining a parent module</h1></div></div></div><p>In most of the <a id="id334" class="indexterm"/>multi-module Maven projects, there are many things that <a id="id335" class="indexterm"/>are shared across multiple modules. Dependency versions, plugin versions, properties, and repositories are only some of them. It is a common (and a best) practice to create a separate module called <code class="literal">parent</code> and define everything in common in its POM file. The packaging type of this POM file is <code class="literal">pom</code>. The artifact generated by the <code class="literal">pom</code> packaging type is itself a POM file.</p><p>The following are few examples of Maven parent modules:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Axis2 project</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>WSO2 Carbon project</strong></span>: <a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/trunk/parent/">https://svn.wso2.org/repos/wso2/carbon/platform/trunk/parent/</a></li></ul></div><p>Not all the projects follow this approach. Some just keep the parent POM file under the root directory (not under the <code class="literal">parent</code> module). The following are a couple of examples:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Synapse project</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/synapse/trunk/java/pom.xml">http://svn.apache.org/repos/asf/synapse/trunk/java/pom.xml</a></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache HBase project</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/hbase/trunk/pom.xml">http://svn.apache.org/repos/asf/hbase/trunk/pom.xml</a></li></ul></div><p>Both the approaches <a id="id336" class="indexterm"/>deliver the same results, yet the first one is much preferred. With the first approach, the parent POM file only defines the shared resources across different Maven modules in the project while there is another POM file at the root of <a id="id337" class="indexterm"/>the project, which defines all the modules to be included in the project build. With the second approach, you define all the shared resources as well as all the modules to be included in the project build in the same POM file, which is under the project root directory. The first approach is better than the second one, based on the <span class="emphasis"><em>separation of concerns</em></span> principle.</p></div>
<div class="section" title="POM properties"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec49"/>POM properties</h1></div></div></div><p>There are six types of <a id="id338" class="indexterm"/>properties that you can use within a Maven application <a id="id339" class="indexterm"/>POM file:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Built-in properties</li><li class="listitem" style="list-style-type: disc">Project properties</li><li class="listitem" style="list-style-type: disc">Local settings</li><li class="listitem" style="list-style-type: disc">Environmental variables</li><li class="listitem" style="list-style-type: disc">Java system properties</li><li class="listitem" style="list-style-type: disc">Custom properties</li></ul></div><p>It is always recommended that you use properties instead of hardcoding values in application POM files. Let's see a few examples.</p><p>Let's consider the <a id="id340" class="indexterm"/>example of the application POM file inside the Apache Axis2 distribution module, which is available at <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/distribution/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/distribution/pom.xml</a>. This defines all the artifacts created in the Axis2 project that need to be included in the final distribution. All the artifacts share the same <code class="literal">groupId</code> element as well as the <code class="literal">version</code> elements of the <code class="literal">distribution</code> module. This is a common scenario in most of the multimodule Maven projects. Most of the modules (if not all) share the same <code class="literal">groupId</code> and the <code class="literal">version</code> elements:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    <span class="strong"><strong>&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;</strong></span>
    &lt;artifactId&gt;axis2-java2wsdl&lt;/artifactId&gt;
    <span class="strong"><strong>&lt;version&gt;${project.version}&lt;/version&gt;</strong></span>
  &lt;/dependency&gt;
  &lt;dependency&gt;
    <span class="strong"><strong>&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;</strong></span>
    &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
    <span class="strong"><strong>&lt;version&gt;${project.version}&lt;/version&gt;</strong></span>
   &lt;/dependency&gt;
   &lt;dependency&gt;
    <span class="strong"><strong>&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;</strong></span>
    &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
    <span class="strong"><strong>&lt;version&gt;${project.version}&lt;/version&gt;</strong></span>
   &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><p>In the preceding configuration, instead of duplicating the <code class="literal">version</code> element, Axis2 uses the project property <code class="literal">${project.version}</code>. When Maven finds this project property, it reads the value from the project POM <code class="literal">version</code> element. If the project POM file does not have a <code class="literal">version</code> element, then <a id="id341" class="indexterm"/>Maven will try to read it from the immediate parent POM file. The benefit here is, when you upgrade your project version some day, you only need to <a id="id342" class="indexterm"/>upgrade the <code class="literal">version</code> element of the <code class="literal">distribution</code> POM file (or its parent).</p><p>The preceding configuration is not perfect; it can be further improved as follows:</p><div class="informalexample"><pre class="programlisting">&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;<span class="strong"><strong>${project.groupId}</strong></span>&lt;/groupId&gt;
    &lt;artifactId&gt;axis2-java2wsdl&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;<span class="strong"><strong>${project.groupId}</strong></span>&lt;/groupId&gt;

    &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;<span class="strong"><strong>${project.groupId}</strong></span>&lt;/groupId&gt;
     &lt;artifactId&gt;axis2-adb&lt;/artifactId&gt;
     &lt;version&gt;${project.version}&lt;/version&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;</pre></div><p>Here, we also replace the hardcoded value of the <code class="literal">groupId</code> element in all the dependencies with the project property <code class="literal">${project.groupid}</code>. When Maven finds this project property, it reads the value from the project POM <code class="literal">groupId</code> element. In case the project POM file does not have a <code class="literal">groupId</code> element, then Maven will try to read it from the immediate parent POM file.</p><p>Here is a list of some of the built-in properties and project properties of Maven:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">project.version</code>: This <a id="id343" class="indexterm"/>refers to the value of the <code class="literal">version</code> element of the project POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">project.groupId</code>: This <a id="id344" class="indexterm"/>refers to the value of the <code class="literal">groupId</code> element of the project POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">project.artifactId</code>: This refers to the value of the <code class="literal">artifactId</code> element of the project POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">project.name</code>: This refers to the value of the <code class="literal">name</code> element of the project POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">project.description</code>: This refers to the value of the <code class="literal">description</code> element of the project POM file</li><li class="listitem" style="list-style-type: disc"><code class="literal">project.basedir</code>: This refers to the path of the project's base directory<p>The following is an example, which shows the usage of this project property. Here, we have a system dependency, which needs to be referred from a file <code class="literal">system</code> path:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.axis2.wso2&lt;/groupId&gt;
  &lt;artifactId&gt;axis2&lt;/artifactId&gt;
  &lt;version&gt;1.6.0.wso2v2&lt;/version&gt;
  &lt;scope&gt;system&lt;/scope&gt;
  &lt;systemPath&gt;$<span class="strong"><strong>{project.basedir}</strong></span>/
            lib/axis2-1.6.jar&lt;/systemPath&gt; 
&lt;/dependency&gt;</pre></div></li></ul></div><p>In addition to the project properties, you can also read properties from the <code class="literal">USER_HOME/.m2/settings.xml</code> file. For example, if you want to read the path to the local Maven repository, you can use the property, <code class="literal">${settings.localRepository}</code>. In the same way, with the same pattern, you can read any of the configuration elements, which are defined in the <code class="literal">settings.xml</code> file.</p><p>The environment variables defined in the system can be read using the <code class="literal">env</code> prefix within an application POM file. The <code class="literal">${env.M2_HOME}</code> property will return the path to Maven home, while <code class="literal">${env.java_home}</code> returns the path to the Java home directory. These properties will be quite useful within certain Maven plugins.</p><p>Maven also lets you define your own set of custom properties. Custom properties are mostly used when defining dependency versions.</p><p>You should not scatter custom properties all over the places. An ideal place to define them is the parent POM file in a multimodule Maven project, which will then be inherited by all the other child modules.</p><p>If you look at the parent <a id="id345" class="indexterm"/>POM file of the WSO2 Carbon project, you will find a large set of <a id="id346" class="indexterm"/>custom properties is defined (<a class="ulink" href="https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml">https://svn.wso2.org/repos/wso2/carbon/platform/branches/turing/parent/pom.xml</a>). The <a id="id347" class="indexterm"/>following block of code contains some of those custom properties:</p><div class="informalexample"><pre class="programlisting">&lt;properties&gt;
  &lt;rampart.version&gt;1.6.1-wso2v10&lt;/rampart.version&gt;
  &lt;rampart.mar.version&gt;1.6.1-wso2v10&lt;/rampart.mar.version&gt;
  &lt;rampart.osgi.version&gt;1.6.1.wso2v10&lt;/rampart.osgi.version&gt;
&lt;/properties&gt;</pre></div><p>When you add a dependency to the Rampart jar, you do not need to specify the version there. Just refer it by the <code class="literal">${rampart.version}</code> property name. Also, keep in mind that all the custom-defined properties are inherited and can be overridden in any child POM file:</p><div class="informalexample"><pre class="programlisting">&lt;dependency&gt;
  &lt;groupId&gt;org.apache.rampart.wso2&lt;/groupId&gt;
  &lt;artifactId&gt;rampart-core&lt;/artifactId&gt;
  &lt;version&gt;<span class="strong"><strong>${rampart.version}</strong></span>&lt;/version&gt;
&lt;/dependency&gt;</pre></div></div>
<div class="section" title="Avoiding repetitive groupIds and versions, and inheriting from the parent POM"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec50"/>Avoiding repetitive groupIds and versions, and inheriting from the parent POM</h1></div></div></div><p>In a <a id="id348" class="indexterm"/>multimodule Maven <a id="id349" class="indexterm"/>project, most of the modules (if not all) share the same <code class="literal">groupId</code> and the <code class="literal">version</code> elements. In that case, you can avoid adding <code class="literal">version</code> and <code class="literal">groupId</code> elements to your application POM file, as those will be automatically inherited from the corresponding parent POM.</p><p>If you look at <a id="id350" class="indexterm"/>
<code class="literal">axis2-kernel</code> (which is a module of the Apache Axis2 project), you will find that no <code class="literal">groupId</code> or a <code class="literal">version</code> element is defined: (<a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/kernel/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/kernel/pom.xml</a>). Maven reads them from the parent POM file:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
        &lt;artifactId&gt;axis2-parent&lt;/artifactId&gt;
        &lt;version&gt;1.7.0-SNAPSHOT&lt;/version&gt;
        &lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;
    &lt;/parent&gt;

    &lt;artifactId&gt;axis2-kernel&lt;/artifactId&gt;
    &lt;name&gt;Apache Axis2 - Kernel&lt;/name&gt;
     
&lt;/project&gt;</pre></div></div>
<div class="section" title="Following naming conventions"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec51"/>Following naming conventions</h1></div></div></div><p>When defining coordinates <a id="id351" class="indexterm"/>for your Maven project, you must <a id="id352" class="indexterm"/>always follow the naming conventions.</p><p>The value of the <code class="literal">groupId</code> element should follow the same naming convention you use in Java package names. It has to be a domain name (the reverse of the domain name) that you own—or at least that your project is developed under.</p><p>The following list covers some of the <code class="literal">groupId</code> naming conventions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The name of the <code class="literal">groupId</code> element has to be in lower case.</li><li class="listitem" style="list-style-type: disc">Use the reverse of a domain name that can be used to uniquely identify your project. This will also help to avoid collisions between artifacts produced by different projects.</li><li class="listitem" style="list-style-type: disc">Avoid using digits or special characters (for example, <code class="literal">org.wso2.carbon.identity-core</code>).</li><li class="listitem" style="list-style-type: disc">Do not try to group two words into a single word by camel casing (for example, <code class="literal">org.wso2.carbon.identityCore</code>).</li><li class="listitem" style="list-style-type: disc">Ensure that all the subprojects developed under different teams in the same company finally inherit from the same <code class="literal">groupId</code> and extend the name of the parent <code class="literal">groupId</code> rather than defining their own.</li></ul></div><p>Let's go through some examples. You will notice that all the open source projects developed under <span class="strong"><strong>Apache </strong></span>
<a id="id353" class="indexterm"/>
<span class="strong"><strong>Software Foundation</strong></span> (<span class="strong"><strong>ASF</strong></span>) use the same parent <code class="literal">groupId</code> (<code class="literal">org.apache</code>) and define their own <code class="literal">groupId</code>, which extends from the parent:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Axis2 project</strong></span>: <code class="literal">org.apache.axis2</code>, which inherits from the <code class="literal">org.apache</code> parent <code class="literal">groupId</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Synapse project</strong></span>: <code class="literal">org.apache.synapse</code>, which inherits from the <code class="literal">org.apache</code> parent <code class="literal">groupId</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache ServiceMix project</strong></span>: <code class="literal">org.apache.servicemix</code>, which inherits from the <code class="literal">org.apache</code> parent <code class="literal">groupId</code></li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>WSO2 Carbon project</strong></span>: <code class="literal">org.wso2.carbon</code></li></ul></div><p>Apart from the <code class="literal">groupId</code>, you should also follow the naming conventions while defining <code class="literal">artifactIds</code>.</p><p>The following lists out some of the <code class="literal">artifactId</code> naming conventions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The name of the <code class="literal">artifactId</code> has to be in lower case.</li><li class="listitem" style="list-style-type: disc">Avoid duplicating the <a id="id354" class="indexterm"/>value of <code class="literal">groupId</code> inside the <code class="literal">artifactId</code>. If you find a need to start your <code class="literal">artifactId</code> element with the <a id="id355" class="indexterm"/><code class="literal">groupId</code> element and add something to the end, then you need to revisit the structure of your project. You may need to add more module groups.</li><li class="listitem" style="list-style-type: disc">Avoid using special characters (for example, #, $, &amp;, %).</li><li class="listitem" style="list-style-type: disc">Do not try to group two words into a single word by camel casing (for example, identityCore).</li></ul></div><p>The following naming conventions for <code class="literal">version</code> are also equally important. The version of a given Maven artifact can be divided into four parts:</p><div class="informalexample"><pre class="programlisting">&lt;Major version&gt;.&lt;Minor version&gt;.&lt;Incremental version&gt;-&lt;Build number or the qualifier&gt;</pre></div><p>The major version reflects the introduction of a new major feature. A change in the major version of a given artifact could also mean that the new changes are not necessarily backward compatible with the previously released artifact. The minor version reflects an introduction of a new feature to the previously released version in a backward compatible manner. The incremental version reflects a bug fixed release of the artifact. The build number can be the revision number from the source code repository.</p><p>This versioning convention is not just for Maven artifacts. Apple did a major release of its iOS mobile operating system in September 2014: iOS 8.0.0. Soon after the release, they discovered a critical bug in it that had an impact on cellular network connectivity and the TouchID on the iPhone. Then they released iOS 8.0.1 as a patch release to fix the issues.</p><p>Let's go through some <a id="id356" class="indexterm"/>examples:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Axis2 1.6.0 release</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/tags/v1.6.0/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/tags/v1.6.0/pom.xml</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache </strong></span><a id="id357" class="indexterm"/><span class="strong"><strong>Axis2 1.6.2 release</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/tags/v1.6.2/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/tags/v1.6.2/pom.xml</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Axis2 1.7.0-SNAPSHOT</strong></span>: <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/pom.xml</a>.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Apache Synapse 2.1.0-wso2v5</strong></span>: <a class="ulink" href="http://svn.wso2.org/repos/wso2/tags/carbon/3.2.3/dependencies/synapse/2.1.0-wso2v5/pom.xml">http://svn.wso2.org/repos/wso2/tags/carbon/3.2.3/dependencies/synapse/2.1.0-wso2v5/pom.xml</a>. Here the synapse code is maintained under the WSO2 source repository, not under Apache. In this case, we use the wso2v5 classifier to make it different from the same artifact produced by Apache Synapse.</li></ul></div></div>
<div class="section" title="Think twice before you write your own plugin. You may not need it!"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec52"/>Think twice before you write your own plugin. You may not need it!</h1></div></div></div><p>Maven is all about plugins! There is a plugin out there for almost everything you need to do. If you find a need to write a plugin, spend some time doing some research on the web to see whether you can find <a id="id358" class="indexterm"/>something similar—the chances are very high. You <a id="id359" class="indexterm"/>can also find a list of available Maven plugins at <a class="ulink" href="http://maven.apache.org/plugins">http://maven.apache.org/plugins</a>.</p></div>
<div class="section" title="The Maven release plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec53"/>The Maven release plugin</h1></div></div></div><p>Releasing a <a id="id360" class="indexterm"/>project requires a lot of repetitive tasks. The objective of the <a id="id361" class="indexterm"/>Maven <code class="literal">release</code> plugin is to automate them. The release plugin defines following eight goals, which are executed in two stages—preparing the release and performing the release:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">release:clean</code>: This cleans up after a release preparation</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:prepare</code>: This prepares for a release in SCM (Software Configuration Management)</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:prepare-with-pom</code>: This prepares for a release in SCM, and generates release POMs by fully resolving the dependencies</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:rollback</code>: This rolls back to a previous release</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:perform</code>: This performs a release from SCM</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:stage</code>: This performs a release from SCM into a staging folder or repository</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:branch</code>: This creates a branch of the current project with all versions updated</li><li class="listitem" style="list-style-type: disc"><code class="literal">release:update-versions</code>: This updates the versions in the POM(s)</li></ul></div><p>The preparation stage will complete the following tasks with the <code class="literal">release:prepare</code> goal:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Verify that all <a id="id362" class="indexterm"/>the changes in the source code are committed.</li><li class="listitem" style="list-style-type: disc">Make sure that there are no SNAPSHOT dependencies. During the project development phase we use SNAPSHOT dependencies, but, at the time of release, all the dependencies should be changed to a released version.</li><li class="listitem" style="list-style-type: disc">The version of project POM files will be changed from SNAPSHOT to a concrete version number.</li><li class="listitem" style="list-style-type: disc">The SCM information in the project POM will be changed to include the final destination of the tag.</li><li class="listitem" style="list-style-type: disc">Execute all the tests against the modified POM files.</li><li class="listitem" style="list-style-type: disc">Commit the modified POM files to SCM and tag the code with a version name.</li><li class="listitem" style="list-style-type: disc">Change the version of POM files in the trunk to a SNAPSHOT version and then commit the modified POM files to the trunk.</li></ul></div><p>Finally, the release will be performed with the <code class="literal">release:perform</code> goal. This will check out the code from the release tag in the SCM and run a set of predefined goals: <code class="literal">site</code> and <code class="literal">deploy-site</code>.</p><p>The <code class="literal">maven-release-plugin</code> is not defined in the super POM, and should be explicitly defined in your project POM file. The <code class="literal">releaseProfiles</code> configuration element defines the profiles to be <a id="id363" class="indexterm"/>released, and the <code class="literal">goals</code> configuration element defines the plugin goals to be executed during <code class="literal">release:perform</code>. In the following configuration, the <code class="literal">deploy</code> goal of the <code class="literal">maven-deploy-plugin</code> and the <code class="literal">single</code> goal of the <code class="literal">maven-assembly-plugin</code> will get executed:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
    &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.5&lt;/version&gt;
    &lt;configuration&gt;
      &lt;releaseProfiles&gt;<span class="strong"><strong>release</strong></span>&lt;/releaseProfiles&gt;
      &lt;goals&gt;<span class="strong"><strong>deploy assembly:single</strong></span>&lt;/goals&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note41"/>Note</h3><p>More details about the <a id="id364" class="indexterm"/>Maven Release plugin are available at <a class="ulink" href="http://maven.apache.org/maven-release/maven-release-plugin/">http://maven.apache.org/maven-release/maven-release-plugin/</a>.</p></div></div></div>
<div class="section" title="The Maven enforcer plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec54"/>The Maven enforcer plugin</h1></div></div></div><p>The Maven <a id="id365" class="indexterm"/>Enforce plugin lets you control or enforce <a id="id366" class="indexterm"/>constraints in your build environment. These could be the Maven version, Java version, operating system parameters, and even user-defined rules.</p><p>The plugin defines two goals: <code class="literal">enforce</code> and <code class="literal">displayInfo</code>. The <code class="literal">enforcer:enforce</code> goal will execute all the defined rules against all the modules in a multimodule Maven project, while <code class="literal">enforcer:displayInfo</code> will display the project compliance details with respect to the standard rule set.</p><p>The <code class="literal">maven-enforcer-plugin</code> is not defined in the super POM, and should be explicitly defined in your <a id="id367" class="indexterm"/>project POM file:</p><div class="informalexample"><pre class="programlisting">&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;<span class="strong"><strong>maven-enforcer-plugin</strong></span>&lt;/artifactId&gt;
    &lt;version&gt;1.3.1&lt;/version&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;enforce-versions&lt;/id&gt;
        &lt;goals&gt;
          &lt;goal&gt;enforce&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
<span class="strong"><strong>          &lt;rules&gt;</strong></span>
<span class="strong"><strong>            &lt;requireMavenVersion&gt;</strong></span>
<span class="strong"><strong>              &lt;version&gt;3.2.1&lt;/version&gt;</strong></span>
<span class="strong"><strong>            &lt;/requireMavenVersion&gt;</strong></span>
<span class="strong"><strong>            &lt;requireJavaVersion&gt;</strong></span>
<span class="strong"><strong>              &lt;version&gt;1.6&lt;/version&gt;</strong></span>
<span class="strong"><strong>            &lt;/requireJavaVersion&gt;</strong></span>
<span class="strong"><strong>            &lt;requireOS&gt;</strong></span>
<span class="strong"><strong>              &lt;family&gt;mac&lt;/family&gt;</strong></span>
<span class="strong"><strong>            &lt;/requireOS&gt;</strong></span>
<span class="strong"><strong>          &lt;/rules&gt;</strong></span>
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;</pre></div><p>The preceding plugin configuration enforces the Maven version to be 3.2.1, Java version to be 1.6, and the operating system to be in the Mac family.</p><p>The Apache Axis2 <a id="id368" class="indexterm"/>project uses the <code class="literal">enforcer</code> plugin to make sure that no application POM file defines Maven repositories. All the artifacts required by Axis2 are expected to be in the Maven central repository. The following configuration element is extracted from <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/pom.xml</a>. Here, it <a id="id369" class="indexterm"/>bans all the repositories and plugin <a id="id370" class="indexterm"/>repositories, except snapshot repositories:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.1&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;phase&gt;validate&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;enforce&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;rules&gt;
          &lt;requireNoRepositories&gt;
            &lt;banRepositories&gt;true&lt;/banRepositories&gt;
            &lt;banPluginRepositories&gt;true&lt;/banPluginRepositories&gt;
            &lt;allowSnapshotRepositories&gt;true
                                   &lt;/allowSnapshotRepositories&gt;
            &lt;allowSnapshotPluginRepositories&gt;true
                             &lt;/allowSnapshotPluginRepositories&gt;
          &lt;/requireNoRepositories&gt;
        &lt;/rules&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note42"/>Note</h3><p>In addition to the <a id="id371" class="indexterm"/>standard rule set shipped with the <code class="literal">enforcer</code> plugin, you can also define your own rules. More details about how to write custom rules are available at <a class="ulink" href="http://maven.apache.org/enforcer/enforcer-api/writing-a-custom-rule.html">http://maven.apache.org/enforcer/enforcer-api/writing-a-custom-rule.html</a>.</p></div></div></div>
<div class="section" title="Avoiding the use of unversioned plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec55"/>Avoiding the use of unversioned plugins</h1></div></div></div><p>If you have associated a <a id="id372" class="indexterm"/>plugin with your application POM, without a version, then Maven will download the corresponding <code class="literal">maven-metadata.xml</code> file and store it locally. Only the latest released version of the plugin will be downloaded and used in the project. This can easily create uncertainties. Your project may work fine with the current version of a plugin, but later, if there is a new release of the same plugin, your Maven project will start to use the latest one automatically. This can result in an unpredictable behavior and lead to a debugging mess.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>It is always recommended that you specify the plugin version along with the plugin configuration.</p></div></div><p>You can enforce this as a rule with the Maven <code class="literal">enforcer</code> plugin, shown as follows:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.3.1&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;enforce-plugin-versions&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;enforce&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;rules&gt;
          <span class="strong"><strong>&lt;requirePluginVersions&gt;</strong></span>
               &lt;message&gt;………… &lt;message&gt;
            &lt;banLatest&gt;true&lt;/banLatest&gt;
            &lt;banRelease&gt;true&lt;/banRelease&gt;
            &lt;banSnapshots&gt;true&lt;/banSnapshots&gt;
            &lt;phases&gt;clean,deploy,site&lt;/phases&gt;
            <span class="strong"><strong>&lt;additionalPlugins&gt;</strong></span>
<span class="strong"><strong>              &lt;additionalPlugin&gt;</strong></span>
                  org.apache.maven.plugins:maven-eclipse-plugin
              <span class="strong"><strong>&lt;/additionalPlugin&gt;</strong></span>
<span class="strong"><strong>              &lt;additionalPlugin&gt;</strong></span>
                  org.apache.maven.plugins:maven-reactor-plugin
              <span class="strong"><strong>&lt;/additionalPlugin&gt;</strong></span>
<span class="strong"><strong>            &lt;/additionalPlugins&gt;</strong></span>
            <span class="strong"><strong>&lt;unCheckedPluginList&gt;</strong></span>
                  org.apache.maven.plugins:maven-enforcer-plugin,
                  org.apache.maven.plugins:maven-idea-plugin
            <span class="strong"><strong>&lt;/unCheckedPluginList&gt;</strong></span>
          <span class="strong"><strong>&lt;/requirePluginVersions&gt;</strong></span>
        &lt;/rules&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>The following <a id="id373" class="indexterm"/>explains each of the key configuration elements defined in the preceding code:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">message</code>: This is used to define an optional message to the user, in case the rule execution fails.</li><li class="listitem" style="list-style-type: disc"><code class="literal">banLatest</code>: This is used to restrict the use of "LATEST" as a version for any plugin.</li><li class="listitem" style="list-style-type: disc"><code class="literal">banRelease</code>: This is used to restrict the use of "RELEASE" as a version for any plugin.</li><li class="listitem" style="list-style-type: disc"><code class="literal">banSnapshots</code>: This is used to restrict the use of SNAPSHOT plugins.</li><li class="listitem" style="list-style-type: disc"><code class="literal">banTimestamps</code>: This is used to restrict the use of SNAPSHOT plugins with timestamp versions.</li><li class="listitem" style="list-style-type: disc"><code class="literal">phases</code>: This is a comma separated list of phases that should be used to find lifecycle plugin bindings. The default value is "<code class="literal">clean</code>,<code class="literal">deploy</code>,<code class="literal">site</code>".</li><li class="listitem" style="list-style-type: disc"><code class="literal">additionalPlugins</code>: This is a list of additional plugins to enforce having versions. These plugins may not be defined in application POM files, but are used anyway, like help, eclipse, and so on. The plugins should be specified in the form <code class="literal">groupId:artifactId</code>.</li><li class="listitem" style="list-style-type: disc"><code class="literal">unCheckedPluginList</code>: This is a comma separated list of plugins to skip version <a id="id374" class="indexterm"/>checking.</li></ul></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note43"/>Note</h3><p>You can <a id="id375" class="indexterm"/>read more about the <code class="literal">requirePluginVersions</code> rule from <a class="ulink" href="http://maven.apache.org/enforcer/enforcer-rules/requirePluginVersions.html">http://maven.apache.org/enforcer/enforcer-rules/requirePluginVersions.html</a>.</p></div></div></div>
<div class="section" title="Descriptive parent POM files"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec56"/>Descriptive parent POM files</h1></div></div></div><p>Make sure your <a id="id376" class="indexterm"/>project's parent POM file is descriptive enough to list out what the project does, who the developers and contributors are, their contact <a id="id377" class="indexterm"/>details, the license under which the project artifacts are released, where to report issues, and so on. Here is a good example of a descriptive POM file, which is available at <a class="ulink" href="http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/pom.xml">http://svn.apache.org/repos/asf/axis/axis2/java/core/trunk/modules/parent/pom.xml</a>:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;
  &lt;name&gt;Apache Axis2 - Parent&lt;/name&gt;       
  &lt;inceptionYear&gt;2004&lt;/inceptionYear&gt;     
  &lt;description&gt;Axis2 is an effort to re-design and totally re-  
                 implement both Axis/Java……&lt;/description&gt;
  &lt;url&gt;http://axis.apache.org/axis2/java/core/&lt;/url&gt;     
  &lt;licenses&gt;&lt;license&gt;http://www.apache.org/licenses/LICENSE-2.0.html&lt;/license&gt;&lt;/licenses&gt;
  &lt;issueManagement&gt;         
    &lt;system&gt;jira&lt;/system&gt;         
    &lt;url&gt;http://issues.apache.org/jira/browse/AXIS2&lt;/url&gt;       
  &lt;/issueManagement&gt;
  &lt;mailingLists&gt;         
    &lt;mailingList&gt;             
      &lt;name&gt;Axis2 Developer List&lt;/name&gt;             
      &lt;subscribe&gt;java-dev-subscribe@axis.apache.org&lt;/subscribe&gt;             
      &lt;unsubscribe&gt;java-dev-unsubscribe@
                                  axis.apache.org&lt;/unsubscribe&gt;             
      &lt;post&gt;java-dev@axis.apache.org&lt;/post&gt;             
      &lt;archive&gt;http://mail-archives.apache.org/mod_mbox/axis-java-dev/&lt;/archive&gt;             
      &lt;otherArchives&gt;                    
        &lt;otherArchive&gt;http://markmail.org/search/list:
                         org.apache.ws.axis-dev&lt;/otherArchive&gt;             
      &lt;/otherArchives&gt;         
    &lt;/mailingList&gt;
    &lt;developers&gt;         
      &lt;developer&gt;             
        &lt;name&gt;Sanjiva Weerawarana&lt;/name&gt;             
        &lt;id&gt;sanjiva&lt;/id&gt;             
        &lt;email&gt;sanjiva AT wso2.com&lt;/email&gt;             
        &lt;organization&gt;WSO2&lt;/organization&gt;         
      &lt;/developer&gt;
    &lt;developers&gt;  
    &lt;contributors&gt;
      &lt;contributor&gt;             
        &lt;name&gt;Dobri Kitipov&lt;/name&gt;             
        &lt;email&gt;kdobrik AT gmail.com&lt;/email&gt;             
        &lt;organization&gt;Software AG&lt;/organization&gt;           
        &lt;/contributor&gt;     
    &lt;/contributors&gt;
&lt;/project&gt;</pre></div></div>
<div class="section" title="Documentation is your friend"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec57"/>Documentation is your friend</h1></div></div></div><p>If you are a good <a id="id378" class="indexterm"/>developer you know the value of documentation. Anything you write should not be cryptic or only be understood by you. Let it be a Java, .NET, C++ project, or a Maven project—the documentation is your friend. A code with a good documentation is extremely readable. If any configuration you add into an application POM file is not self-descriptive, make sure you add at least a single line comment explaining what it does.</p><p>Here to follow some good examples from the Apache Axis2 project:</p><div class="informalexample"><pre class="programlisting">&lt;profile&gt;             
  &lt;id&gt;java16&lt;/id&gt;             
  &lt;activation&gt;                 
    &lt;jdk&gt;1.6&lt;/jdk&gt;             
  &lt;/activation&gt;             
  <span class="strong"><strong>&lt;!-- JDK 1.6 build still use JAX-WS 2.1 because integrating </strong></span>
<span class="strong"><strong>       Java endorsed mechanism with Maven is bit of complex -  </strong></span>
  -&gt;               
  &lt;properties&gt;                 
    &lt;jaxb.api.version&gt;2.1&lt;/jaxb.api.version&gt;
    &lt;jaxbri.version&gt;2.1.7&lt;/jaxbri.version&gt;                 
    &lt;jaxws.tools.version&gt;2.1.3&lt;/jaxws.tools.version&gt;                 
    &lt;jaxws.rt.version&gt;2.1.3&lt;/jaxws.rt.version&gt;               
  &lt;/properties&gt;         
&lt;/profile&gt;</pre></div><p>      -------------------------------------------------------------------------------------------------------</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;                     
  &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;                       
  <span class="strong"><strong>&lt;!-- Minimum required version here is 2.2-beta-4 because </strong></span>
<span class="strong"><strong>       org.apache:apache:7 uses the runOnlyAtExecutionRoot </strong></span>
<span class="strong"><strong>       parameter, which is not supported in earlier                        </strong></span>
<span class="strong"><strong>       versions. --&gt;                     </strong></span>
  &lt;version&gt;2.2-beta-5&lt;/version&gt;                     
  &lt;configuration&gt;                         
<span class="strong"><strong>  &lt;!-- Workaround for MASSEMBLY-422 / MASSEMBLY-449 --&gt;                           </strong></span>
    &lt;archiverConfig&gt;                               
      &lt;fileMode&gt;420&lt;/fileMode&gt;<span class="strong"><strong>&lt;!-- 420(dec)=644(oct) --&gt;                             </strong></span>
      &lt;directoryMode&gt;493&lt;/directoryMode&gt;<span class="strong"><strong>&lt;!--493(dec)=755(oct)--&gt;                             </strong></span>
      &lt;defaultDirectoryMode&gt;493&lt;/defaultDirectoryMode&gt;                           
    &lt;/archiverConfig&gt;                     
  &lt;/configuration&gt;                 
&lt;/plugin&gt;</pre></div><p>      -------------------------------------------------------------------------------------------------------</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>&lt;!-- No chicken and egg problem here because the plugin doesn't expose any extension. We can always use the version from the current build. --&gt;                 </strong></span>
&lt;plugin&gt;                     
  &lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;                     
  &lt;artifactId&gt;axis2-repo-maven-plugin&lt;/artifactId&gt;                        
  &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/plugin&gt;</pre></div></div>
<div class="section" title="Avoid overriding the default directory structure"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec58"/>Avoid overriding the default directory structure</h1></div></div></div><p>Maven <a id="id379" class="indexterm"/>follows the design philosophy <span class="emphasis"><em>Convention over Configuration</em></span>. Without any configuration changes, Maven assumes the location of the source code is <code class="literal">${basedir}/src/main/java</code>, the location of tests is <code class="literal">${basedir}/src/test/java</code>, and the resources are available at <code class="literal">${basedir}/src/main/resources</code>. After a successful build, Maven knows where to place the compiled classes (<code class="literal">${basedir}/target/classes</code>) and where to copy the final artifact (<code class="literal">${basedir}/target/</code>). It is possible to change this directory structure, but it's recommended not to do so. Why?</p><p>Keeping the default structure improves the readability of the project. Even a fresh developer knows where to look, if he is familiar with Maven. Also, if you have associated plugins and other Maven extensions with your project, you will be able to use them with minimal changes if you have not altered the default Maven directory structure. Most of these <a id="id380" class="indexterm"/>plugins and other extensions assume the Maven convention by default.</p></div>
<div class="section" title="Using SNAPSHOT versioning during the development"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec59"/>Using SNAPSHOT versioning during the development</h1></div></div></div><p>You should use the <code class="literal">SNAPSHOT</code> qualifier for the artifacts produced by your project if those are still under <a id="id381" class="indexterm"/>development and deployed regularly to a Maven snapshot repository. If the version to be released is 1.7.0, then you should use the version <code class="literal">1.7.0-SNAPSHOT</code> while it's under development. Maven treats the version <code class="literal">SNAPSHOT</code> in a special manner. If you try to deploy <code class="literal">1.7.0-SNAPSHOT</code> into a repository, Maven will first expand the <code class="literal">SNAPSHOT</code> qualifier into a date and time value in UTC (Coordinated Universal Time). If the date/time at the time of deployment is 10.30 AM, November 10th, 2014, then the <code class="literal">SNAPSHOT</code> qualifier will be replaced with 20141110-103005-1, and the artifact will be deployed with the version <code class="literal">1.7.0-20141110-103005-1</code>.</p></div>
<div class="section" title="Get rid of unused dependencies"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec60"/>Get rid of unused dependencies</h1></div></div></div><p>Always <a id="id382" class="indexterm"/>ensure that you maintain a clean application POM file. You should not have any unused dependencies defined or used undeclared dependencies. The Maven <code class="literal">dependency</code> plugin helps you in identifying such discrepancies.</p><p>The <code class="literal">maven-dependency-plugin</code> is not defined in the super POM and should be explicitly defined in your project POM file:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.0&lt;/version&gt;
&lt;/plugin&gt;</pre></div><p>Once the preceding configuration is added into your application POM file, you need to run the <code class="literal">analyze</code> goal of the <code class="literal">dependency</code> plugin against your Maven project:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn dependency:analyze</strong></span>
</pre></div><p>Here, you can see a sample output, which complains about an unused declared dependency:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>[WARNING] Unused declared dependencies found:</strong></span>
<span class="strong"><strong>[WARNING] org.apache.axis2:axis2-kernel:jar:1.6.2:compile</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note44"/>Note</h3><p>More details <a id="id383" class="indexterm"/>about the Maven dependency plugin are available at <a class="ulink" href="http://maven.apache.org/plugins/maven-dependency-plugin/">http://maven.apache.org/plugins/maven-dependency-plugin/</a>.</p></div></div></div>
<div class="section" title="Avoiding keeping credentials in application POM files"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec61"/>Avoiding keeping credentials in application POM files</h1></div></div></div><p>During a <a id="id384" class="indexterm"/>Maven build you need to connect to external repositories outside your firewall. In a tightly secured environment, any outbound connection has to go through an internal proxy server. The following configuration in <code class="literal">MAVEN_HOME/conf/settings.xml</code> shows how to connect to an external repository via a secured proxy server:</p><div class="informalexample"><pre class="programlisting">&lt;proxy&gt;
  &lt;id&gt;internal_proxy&lt;/id&gt;
  &lt;active&gt;true&lt;/active&gt;
  &lt;protocol&gt;http&lt;/protocol&gt;
  &lt;username&gt;proxyuser&lt;/username&gt;
  &lt;password&gt;proxypass&lt;/password&gt;
  &lt;host&gt;proxy.host.net&lt;/host&gt;
  &lt;port&gt;80&lt;/port&gt;
  &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;
&lt;/proxy&gt;</pre></div><p>Also, the Maven repositories can be protected for legitimate access. If a given repository is protected with HTTP Basic Authentication, the corresponding credentials should be defined as follows, under the <code class="literal">server</code> element of <code class="literal">MAVEN_HOME/conf/settings.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server&gt;
  &lt;id&gt;central&lt;/id&gt;
  <span class="strong"><strong>&lt;username&gt;my_username&lt;/username&gt;       </strong></span>
  <span class="strong"><strong>&lt;password&gt;my_password&lt;/password&gt;</strong></span>
&lt;/server&gt;</pre></div><p>Keeping confidential data in configuration files in clear text is a security threat that must be avoided. Maven provides a way of encrypting configuration data in <code class="literal">settings.xml</code>.</p><p>First, we need to create a master encryption key, shown as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn -emp mymasterpassword</strong></span>
<span class="strong"><strong>{lJ1MrCQRnngHIpSadxoyEKyt2zIGbm3Yl0ClKdTtRR6TleNaEfGOEoJaxNcdMr+G}</strong></span>
</pre></div><p>With the output from the above command, we need to create a file called <code class="literal">settings-security.xml</code> under <code class="literal">USER_HOME/.m2/</code> and add the encrypted master password there, as follows:</p><div class="informalexample"><pre class="programlisting">&lt;settingsSecurity&gt;   
&lt;master&gt;
{lJ1MrCQRnngHIpSadxoyEKyt2zIGbm3Yl0ClKdTtRR6TleNaEfGOEoJaxNcdMr+G}
&lt;/master&gt;
&lt;/settingsSecurity&gt;</pre></div><p>Once the <a id="id385" class="indexterm"/>master password is configured properly, we can start encrypting rest of the confidential data in <code class="literal">settings.xml</code>. Let's see how to encrypt the server password. First, we need to generate the encrypted password for the cleartext one using the following command. Note that earlier we used emp (encrypt master password) and now we are using ep (encrypt password):</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$  mvn -ep my_password</strong></span>
<span class="strong"><strong>{PbYw8YaLb3cHA34/5EdHzoUsmmw/u/nWOwb9e+x6Hbs=}</strong></span>
</pre></div><p>Copy the value of the encrypted password and replace the corresponding value in <code class="literal">settings.xml</code>:</p><div class="informalexample"><pre class="programlisting">&lt;server&gt;
  &lt;id&gt;central&lt;/id&gt;
  <span class="strong"><strong>&lt;username&gt;my_username&lt;/username&gt;       </strong></span>
  <span class="strong"><strong>&lt;password&gt;</strong></span>
    {PbYw8YaLb3cHA34/5EdHzoUsmmw/u/nWOwb9e+x6Hbs=}
  <span class="strong"><strong>&lt;/password&gt;</strong></span>
&lt;/server&gt;</pre></div></div>
<div class="section" title="Avoiding using deprecated references"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec62"/>Avoiding using deprecated references</h1></div></div></div><p>Since <a id="id386" class="indexterm"/>Maven 3.0 onwards, all the properties starting with <code class="literal">pom.*</code> are deprecated. Avoid using any of the deprecated Maven properties and, if you have used them already, ensure that you migrate to the equivalent ones.</p></div>
<div class="section" title="Avoiding repetition &#x2013; use archetypes"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec63"/>Avoiding repetition – use archetypes</h1></div></div></div><p>When we create a <a id="id387" class="indexterm"/>Java project, we need to structure it in different ways based on the type of the project. If it's a Java EE web application then we need to have a WEB-INF directory and a <code class="literal">web.xml</code> file. If it's a Maven plugin project, we need to have a Mojo class, which extends from <code class="literal">org.apache.maven.plugin.AbstractMojo</code>. Since each type of project has its own predefined structure, why would everyone have to build the same structure again and again? Why don't we start with a template? Each project can have its own template and the developers can extend the template to suit their requirements. Maven archetypes address this concern. Each archetype is a project template.</p><p>We discussed Maven <a id="id388" class="indexterm"/>archetypes in detail, in <a class="link" href="ch03.html" title="Chapter 3. Maven Archetypes">Chapter 3</a>, <span class="emphasis"><em>Maven Archetypes</em></span>.</p></div>
<div class="section" title="Avoiding using maven.test.skip"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec64"/>Avoiding using maven.test.skip</h1></div></div></div><p>You may <a id="id389" class="indexterm"/>manage an extremely small project that does not evolve a lot without unit tests. But, any large-scale project cannot exist without unit tests. Unit tests provide the first level of guarantee that you do not break any existing functionality with a newly introduced code change. In an ideal scenario, you should not commit any code to a source repository without building the complete project with unit tests.</p><p>Maven uses the <code class="literal">surefire</code> plugin to run tests and as a malpractice developers are used to skip the execution of unit tests by setting the <code class="literal">maven.test.skip</code> property to <code class="literal">true</code>, as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean install –Dmaven.test.skip=true</strong></span>
</pre></div><p>This can lead to serious repercussions in the later stage of the project, and you must ensure that all your developers do not skip tests while building.</p><p>Using the <code class="literal">requireProperty</code> rule of the Maven <code class="literal">enforcer</code> plugin, you can ban developers from using the <code class="literal">maven.test.skip</code> property.</p><p>The following shows the <code class="literal">enforcer</code> plugin configuration that you need to add to your application POM:</p><div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-enforcer-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.3.1&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;enforce-property&lt;/id&gt;
      &lt;goals&gt;
        &lt;goal&gt;enforce&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;rules&gt;
          <span class="strong"><strong>&lt;requireProperty&gt;</strong></span>
            &lt;property&gt;maven.test.skip&lt;/property&gt;
            &lt;message&gt;maven.test.skip must be specified&lt;/message&gt;
            &lt;regex&gt;false&lt;/regex&gt;
            &lt;regexMessage&gt;You cannot skip tests&lt;/regexMessage&gt;
          <span class="strong"><strong>&lt;/requireProperty&gt;</strong></span>
        &lt;/rules&gt;
        &lt;fail&gt;true&lt;/fail&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div><p>Now, if you <a id="id390" class="indexterm"/>run <code class="literal">mvn clean install</code> against your project, you will see the following error message:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>maven.test.skip must be specified</strong></span>
</pre></div><p>This means you need to specify <code class="literal">Dmaven.test.skip=false</code> every time you run <code class="literal">mvn clean install</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ mvn clean install –Dmaven.test.skip=false</strong></span>
</pre></div><p>But if you set <code class="literal">–Dmaven.test.skip=true</code>, then you will see the following error:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>You cannot skip tests</strong></span>
</pre></div><p>Still, you will find it a bit annoying to type <code class="literal">–Dmaven.test.skip=false</code> whenever you run a build. To avoid that, into your application POM file, add the property <code class="literal">maven.test.skip</code> and set its value to <code class="literal">false</code>:</p><div class="informalexample"><pre class="programlisting">&lt;project&gt;

  &lt;properties&gt;
    <span class="strong"><strong>&lt;maven.test.skip&gt;false&lt;/maven.test.skip&gt;</strong></span>
  &lt;/properties&gt;

&lt;/project&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note45"/>Note</h3><p>More details about <a id="id391" class="indexterm"/>
<code class="literal">requireProperty</code> rule are available at <a class="ulink" href="http://maven.apache.org/enforcer/enforcer-rules/requireProperty.html">http://maven.apache.org/enforcer/enforcer-rules/requireProperty.html</a>.</p></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch07lvl1sec65"/>Summary</h1></div></div></div><p>In this chapter, we looked at and highlighted some of the best practices to be followed in a large-scale development project with Maven. Most of the points highlighted here were discussed in detail in previous chapters throughout the book. It is always recommended to follow best practices since it will drastically improve developer productivity and will reduce any maintenance nightmares.</p><p>Overall, the book covered Apache Maven 3 and its core concepts with examples, including Maven archetypes, plugins, assemblies, and lifecycles.</p></div></body></html>