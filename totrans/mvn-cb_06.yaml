- en: Chapter 6. Code Quality Plugins
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this chapter, we will review some of the available tools for the Java language
    and how to use them in the context of Maven. We will cover the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing code coverage with the Maven JaCoCo plugin
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing code coverage with the Maven Cobertura plugin
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven PMD plugin
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven Checkstyle plugin
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven FindBugs plugin
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Generating source references with the Maven JXR plugin
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven SonarQube plugin
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Introduction
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It is one thing to write code and another to write good code. The subjectivity
    of code quality is greatly reduced by having coding guidelines/standards. Whether
    a developer follows coding standards or not can be verified by subjecting the
    code to a code review. On the other hand, there are tools that automatically perform
    these reviews against defined standards.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: In addition to code quality, programming best practices also recommend writing
    automated unit tests for the code. The line and branch coverage achieved by these
    unit tests can also be quantitatively measured by tools.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing code coverage with the Maven JaCoCo plugin
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: JaCoCo is a free Java code coverage tool. This is essentially the successor
    to Emma, and it has been developed by the EclEmma team as an Eclipse project.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: JaCoCo offers line and branch coverage.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Maven is set up on your system and is verified to work. To do this, refer to
    the first three recipes of [Chapter1](ch01.html "Chapter 1. Getting Started"),
    *Getting Started*.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to analyze the code coverage with the Maven JaCoCo
    plugin:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: Open the pom file of a project that has unit tests (for instance, `project-with-tests`).
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following code:'
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-21
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Run the following command from the command prompt:'
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-23
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Note the output for the preceding command:'
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Open the `index.html` file generated in the `target/site/jacoco` folder:![How
    to do it...](img/6124OS_06_01.jpg)
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-27
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the pom file, we instruct Maven to run the following two goals of the Maven
    JaCoCo plugin:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: '`prepare-agent`: This is bound by default to the `initialize` phase of the
    Maven default lifecycle. The goal runs and prepares the agent that does the analysis.'
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`report`: This agent gathers test coverage information when the tests are run
    and creates the report as part of the prepare-package phase (which we have explicitly
    specified).'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The report gives information about the test coverage. Green indicates lines
    that are covered by tests and red indicates lines that are not covered by tests.
    In the preceding example, **12 of 19** instructions are not covered by tests.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You could subject the project to code coverage and generate the same report
    without making any changes to the pom file. To do this, run the following command:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Now, you may get the following error:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: To fix this, specify the `groupId` and `artifactId` parameters of the plugin
    explicitly. In the *Configuring Maven to search for plugins* recipe of [Chapter
    8](ch08.html "Chapter 8. Handling Typical Build Requirements"), *Handling Typical
    Build Requirements*, we will see an alternate way to address this.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following code, what what we will be doing is explicitly calling the
    relevant goals that we saw getting executed earlier. So, first `prepare-agent`
    will run, followed by `test`, and then the `report` goal:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'How about failing the build if the code coverage is below a threshold value?
    To do this, perform the following steps:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following execution block to the plugin configuration in the `build`
    section specified earlier:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Run the following command:'
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Observe the result as shown in following screenshot:![There's more...](img/6124OS_06_02.jpg)
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Analyzing code coverage with the Maven Cobertura plugin
  id: totrans-46
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Cobertura is another popular Java tool that calculates the percentage of code
    accessed by tests. It is based on **jcoverage**. There are many ways to use Cobertura,
    including standalone, through Ant script, and Maven. Let us use the Maven Cobertura
    plugin.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to analyze the code coverage with the Maven Cobertura
    plugin:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Open a Maven project that has unit tests (for instance, `project-with-tests`).
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following command:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Observe the following output:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: See the report generated:![How to do it...](img/6124OS_06_03.jpg)
  id: totrans-55
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-56
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: JaCoCo instruments the code online when the tests are running and hence,it needs
    to have the agent running. On the other hand, Cobertura instruments the bytecode
    during compilation offline. The `cobertura` goal of the Cobertura Maven plugin
    instruments the project, runs the tests, and generates the report.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: There are separate goals to `instrument` and `check` results, if required.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'What if we want to fail the build if the code coverage is below a threshold
    level? We can set up Cobertura to do this:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following to the pom file:'
  id: totrans-61
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Run the following command:'
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Observe the output as shown in the following screenshot:![There's more...](img/6124OS_06_04.jpg)
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The build has failed because, in the pom file, we specified that the build should
    be halted if the coverage is less than 85%.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing code with the Maven PMD plugin
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: PMD is a source code analyzer. It finds common programming flaws such as unused
    variables, empty catch blocks, and unnecessary object creation. It also includes
    the **Copy/Paste Detector** (**CPD**) that finds duplicated code.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to run PMD on a Maven project:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: Open the Maven project for which you want to do a PMD analysis (for instance,
    `project-with-violations`).
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following command:'
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Observe the output:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Check the contents of the `target` folder:![How to do it...](img/6124OS_06_05.jpg)
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the `pmd.xml` report:![How to do it...](img/6124OS_06_06.jpg)
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the `cpd.html` file in the `site` folder:![How to do it...](img/6124OS_06_07.jpg)
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `pmd` or `cpd` goals of the Maven PMD plugin are not bound to any phase.
    Also, they analyze the Java source and thus, do not need any other Maven phase
    or goal to be run.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: When the `pmd` goal is run, it generates a PMD site report using default rulesets
    and the configuration set in the plugin. It also generates a pmd output file in
    the XML format.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also define your own customized ruleset. To do this, add the following
    code in the `configuration` section of the pom file:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Likewise, when the `cpd` goal is run, it generates a similar report for duplicated
    code. By default, the minimum token count that it considers to report that code
    is duplicated is 100 tokens (which is typically 10 lines of code).
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
- en: There's more...
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The plugin can be made to fail the build by using the check goal in the following
    way:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following code to the pom file of `project-with-violations`:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Run the following command:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Observe the output as shown in the following screenshot:![There's more...](img/6124OS_06_08.jpg)
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven Checkstyle plugin
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Checkstyle is a tool that helps programmers follow coding standards. It automates
    the process of checking if defined coding standards are followed. It can support
    any coding standards by suitable configuration. Like other tools, it can be run
    standalone as well as integrated with Maven.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to analyze code with the Maven Checkstyle plugin:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: Open the Maven project for which you want to do a Checkstyle analysis (for instance,
    `project-with-violations`).
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following command:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Observe the output as shown in the following screenshot:'
  id: totrans-99
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Open the `checkstyle-result.xml` report in the `target` folder:![How to do it...](img/6124OS_06_09.jpg)
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Unlike the `pmd`, `checkstyle` goal of Maven, the Checkstyle plugin is not bound
    to any phase.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: When the `checkstyle` goal is run, it generates a Checkstyle site report using
    default rulesets and the configuration set in the plugin. It also generates a
    Checkstyle output file in the XML format.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 'The Maven Checkstyle plugin supports several configuration options to customize
    the rules, exclude files from being checked, and so on. Let''s briefly discuss
    the examples that show usage of Maven Checkstyle plugin in some advanced usecases:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: 'Checkstyle rules can be specified inline in the `configuration` section of
    the plugin:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'They can also be specified in an external file and referred using the `configLocation`
    element:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'A Suppressions filter can be created to tell Checkstyle not to report violations
    on specific files and specific sections of the files:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: There's more...
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As in the case of PMD, we can configure the Maven Checkstyle plugin such that
    it fails a build in case of errors:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following code to the pom file of `project-with-violations`:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Run the following Maven command:'
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Observe the output as shown in the following screenshot:![There's more...](img/6124OS_06_10.jpg)
  id: totrans-118
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Analyzing code with the Maven FindBugs plugin
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: FindBugs is another tool that uses static analysis to inspect Java bytecode
    for bugs in a Java code. It is based on the concept of bug patterns. A bug pattern
    is a code snippet that is often an error.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let us see how we can use the Maven FindBugs plugin to analyze and identify
    defects in our code:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
- en: Open the Maven project for which you want to do the FindBugs analysis.
  id: totrans-123
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following command:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Observe the output:'
  id: totrans-126
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Open the generated XML file `findbugsXml.xml` in the `target` folder:![How to
    do it...](img/6124OS_06_11.jpg)
  id: totrans-128
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-129
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When the `findbugs` goal of the FindBugs plugin is run, it analyzes the bytecode
    and reports errors to an output file in the XML format. Unlike Checkstyle and
    the PMD plugins, it does not generate a default site report unless configured
    differently.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
- en: Tip
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As FindBugs works on bytecode, the project needs to be compiled before the FindBugs
    analysis can be run. Otherwise, you will not find any FindBugs defects!
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
- en: 'FindBugs also provides several options that allow you to specify the classes
    to be included/excluded from analysis, specify the rules to be run, and to fail
    when errors crop up during the build. Let''s briefly discuss some examples that
    describe the basic usage of the FindBugs plugin:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
- en: 'Filter bugs to report: This plugin allows us to specify classes and methods
    that can be included or excluded from reporting:'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Bug detectors to run: We can also specify which detectors to run. This can
    be done in the following manner:'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-137
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: There's more...
  id: totrans-138
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can also launch the FindBugs GUI to view the report in a graphical format:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
- en: 'To do this, run the following Maven command:'
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-141
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Observe the FindBugs screen:![There's more...](img/6124OS_06_12.jpg)
  id: totrans-142
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Generating source references with the Maven JXR plugin
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You may have observed the following warnings when running the PMD or Checkstyle
    plugin:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The plugins attempt to link the violation to the specific lines in the cross-reference
    of the source. As they are unable to find this cross-reference, they display the
    warning.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
- en: To generate this cross-reference, we need to use the Maven JXR plugin.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to generate source references with the Maven JXR plugin:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
- en: Open the project for which you want to run the cross-reference.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following Maven command:'
  id: totrans-151
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-152
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Observe the output:'
  id: totrans-153
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-154
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Browse the `target/site` folder.![How to do it...](img/6124OS_06_13.jpg)
  id: totrans-155
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open the contents of the `xref` folder in the browser:![How to do it...](img/6124OS_06_14.jpg)
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When the `jxr` goal of the Maven JXR plugin is run, it generates a cross-reference
    of all the source files of the project. The format is similar to Javadoc, but
    on clicking on the class, you get to see the source code with the line numbers:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/6124OS_06_15.jpg)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
- en: There's more...
  id: totrans-160
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Once the cross-reference exists, code quality tools, such as PMD and Checkstyle,
    link to this reference automatically by using the following steps:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
- en: 'Run the following Maven command:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-163
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Open the Checkstyle report in the browser:![There's more...](img/6124OS_06_16.jpg)
  id: totrans-164
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You can now see the line numbers against each of the violations, with the link
    to the line number in the cross-referenced source code.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
- en: Analyzing code with the Maven SonarQube plugin
  id: totrans-166
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Each of the code analysis tools we have seen in the previous sections identify
    specific issues in the code. While Checkstyle looks for violations in coding guidelines,
    PMD identifies common coding errors, and FindBugs detects bug patterns.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
- en: You could have your project configured to run all the three. In addition, you
    could also run plugins to identify coverage. You could also do all these and more
    by doing a SonarQube analysis of the project.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: SonarQube is a platform to manage code quality. It is a web-based application,
    where rules, alerts, thresholds, and other metrics can be configured. It provides
    various ways to analyze code. The results of the analysis can then be viewed in
    a web application. SonarQube also provides several paid plugins, such as **SQALE**,
    and for specific languages, such as Cobol and C++.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready...
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Let''s briefly discuss some basic requirements for using the Maven SonarQube
    plugin:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
- en: Visit the download page for SonarQube at [http://www.sonarqube.org/downloads/](http://www.sonarqube.org/downloads/).
  id: totrans-172
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Download the latest release.
  id: totrans-173
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Unzip the ZIP file to a folder of your choice.
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Based on the platform, start the server by following the instructions.
  id: totrans-175
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Confirm that the server is running by visiting the web page at `http://localhost:9000/`
    (assuming it's a default installation).
  id: totrans-176
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How to do it...
  id: totrans-177
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Use the following steps to analyze the code with the Maven SonarQube plugin:'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
- en: Open the Maven project for which you want to do SonarQube analysis.
  id: totrans-179
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Run the following Maven command:'
  id: totrans-180
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Observe the output as shown in the following screenshot:![How to do it...](img/6124OS_06_17.jpg)
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Visit the Sonar web page at `http://localhost:9000`:![How to do it...](img/6124OS_06_18.jpg)
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click on the project link:![How to do it...](img/6124OS_06_19.jpg)
  id: totrans-184
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: How it works...
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `sonar` goal of the Maven SonarQube plugin sets in motion a series of steps
    to do various analyses of the project. Based on the configuration, the Sonar plugin
    performs Checkstyle analysis, FindBugs analysis and PMD analysis, as well as detects
    code coverage, code duplication, design issues and code complexity.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
- en: It sends the output to a database and generates reports that can be viewed from
    the web page by the user.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
- en: As you can see from the dashboard, it has generated the unit test report along
    with coverage information. Clicking on the link will take the user to details
    of the coverage.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/6124OS_06_20.jpg)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
- en: 'Similarly, clicking on **Issues** gives details of the various violations:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
- en: '![How it works...](img/6124OS_06_21.jpg)'
  id: totrans-191
  prefs: []
  type: TYPE_IMG
- en: Each of these issues can be drilled down to the line-level details, and Sonar
    provides the details, including fix suggestions.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这些问题中的每一个都可以深入到行级细节，Sonar 提供了详细信息，包括修复建议。
- en: There's more...
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: SonarQube provides several configuration options to specify rules to be included/excluded,
    source files to be included/excluded, and so on. The configuration can be done
    through the web interface, and in some cases, by means of properties, either in
    the Maven's settings file or through the command line.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: SonarQube 提供了多个配置选项来指定要包含/排除的规则、要包含/排除的源文件等。配置可以通过网页界面进行，在某些情况下，也可以通过属性进行，无论是在
    Maven 的设置文件中还是在命令行中。
- en: In addition, SonarQube provides plugins for Eclipse and IntelliJ. Once installed
    and configured, these plugins report violations directly in the IDE in the specific
    lines. As this is not specific to Maven, its details are outside the scope of
    this section.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，SonarQube 为 Eclipse 和 IntelliJ 提供了插件。一旦安装并配置，这些插件就会在 IDE 中直接报告特定行的违规情况。由于这并非特定于
    Maven，其详细信息超出了本节范围。
