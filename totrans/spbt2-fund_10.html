<html><head></head><body><div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Solutions</h1>
                </header>
            
            <article>
                
<p class="mce-root"><span>This section contains the worked-out answers for the activities present at the end of each chapter. </span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 1: The Spring Project and Framework</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Project Lombok in Action</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Create a <kbd>BeanData</kbd> class in the package that contains the <kbd>Application</kbd> class:
<ul>
<li>Add a private final String field named <kbd>Bean</kbd>.</li>
<li>Add a private final String field named <kbd>BeanClass</kbd>.</li>
<li>Insert the <kbd>@Data</kbd> and <kbd>@RequiredArgs</kbd> annotations in the class.<br/>
Take a look at the following screenshot:</li>
</ul>
</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/d8df7b58-1871-40f2-b6c6-eae2b6c87e48.png" style="width:52.25em;height:17.67em;" width="1210" height="408"/></div>
<ol start="2">
<li>Fill the data structure:
<ul>
<li>Open the main application file that you enhanced with the loop over the Beans earlier.</li>
<li>Add a list for <kbd>BeanData</kbd> instances.</li>
<li>Fill the list with the corresponding data for each Bean.</li>
</ul>
</li>
</ol>
<div class="packt_infobox"><br/>
You can fetch the Bean from the context using the Bean name with the <kbd>getBean</kbd> method, for example.</div>
<ol start="3">
<li>Print the <kbd>BeanData</kbd> list content:
<ul>
<li>After the Bean list is filled, add another loop right after that loops over the <kbd>BeanData</kbd> list.</li>
<li>Use <kbd>System.out.println</kbd> to output the name and class of the Bean using the generated <kbd>Getters</kbd>.</li>
</ul>
</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 2: Building a Spring Application</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Autowiring and Configurations</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Create the <kbd>ConfigurationProperty</kbd> class <kbd>GreetingProperties</kbd> to read the configuration value for the suffix and add a property value to the configuration file.</li>
<li>Create the greeting service</li>
<li>Inject the class in the service</li>
<li>Create a public method that creates the greeting with the greeter's name as the parameter.</li>
<li>In the Application class, add a config method which executes the greeting method and print out the result</li>
<li>Advanced:
<ul>
<li>Add an autowired field in the Application class</li>
<li>Execute greeting method when dependencies of the Application class are set using a different mechanism.</li>
</ul>
</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 3: Testing Spring Applications</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Writing Integration Tests</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Create a new integration test class on your own for the <kbd>BlogService</kbd> class.</li>
<li>Create various tests for the <kbd>retrievePagedBlogEntries</kbd> method of the <kbd>BlogService</kbd>.</li>
<li>Create a happy path test (everything works as it should with simple test data).</li>
<li>Create tests for interesting parameter combinations (for example values like 0, -1 etc. with the behavior you expect.</li>
<li>Fix the service code to make it match your expectations.</li>
</ol>
<p>Advanced: Create different types of tests, have a look at them and analyze the dis-/advantages. (Omit the type you created in <em>step 2</em>)</p>
<ul>
<li>unit-tests without mockito</li>
<li>unit-tests with mockito</li>
<li>integration-tests without any mocking</li>
<li>integration-tests with <kbd>MockBeans</kbd></li>
<li>integration-tests with <kbd>SpyBeans</kbd></li>
</ul>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2MqhUZ4">https://bit.ly/2MqhUZ4</a> to access the code for the <kbd>BlogService</kbd> test files.</div>
<p class="mce-root"/>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 4: The MVC Pattern</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Create Your First Web MVC Controller</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Go to <a href="https://start.spring.io">https://start.spring.io</a> and enter the following values:<br/>
Group: <kbd>com.packt.springboot</kbd><br/>
Artifact: <kbd>blogmania</kbd></li>
<li>In the Search for dependencies field enter the following dependencies pressing enter after each:<br/>
Web, Thymeleaf, Devtools</li>
<li>You should see the following screen:</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/60e6745d-b269-4de4-9176-e65a5b2ff0bf.png" style="width:40.58em;height:28.08em;" width="1990" height="1378"/></div>
<ol start="4">
<li>Press <span class="packt_screen">Generate Project</span> to download a ZIP file containing the initial project files.</li>
<li>Now unzip the downloaded file which is called <kbd>blog.zip</kbd> into your project folder.</li>
<li>Add the dependency for the Bootstrap webjars archive to the file <kbd>pom.xml</kbd> in the <kbd>&lt;dependencies&gt;</kbd> section.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2QoVEBX">https://bit.ly/2QoVEBX</a> to access the code for the <kbd>pom.xml</kbd> file.</div>
<ol start="7">
<li>Create a file <kbd>welcome.html</kbd> in the <kbd>src/main/resource/templates</kbd> folder.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2x6w90k">https://bit.ly/2x6w90k</a> to access the code for the <kbd>welcome.html</kbd> file.</div>
<ol start="8">
<li>Add a controller to render the view. Create the <kbd>WelcomeController</kbd> class in a package called <kbd>com.packt.springboot.blogmania.controller</kbd>.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2OhxZlo">https://bit.ly/2OhxZlo</a> to access the code for the <kbd>WelcomeController.java</kbd> file.</div>
<ol start="9">
<li>Now start the application by using Maven:</li>
</ol>
<pre style="padding-left: 60px">mvnw spring-boot:run</pre>
<ol start="10">
<li>Use your browser to navigate to <kbd>http://localhost:8080</kbd>:</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/ea6fd632-3d4f-4e1f-9c0f-f672fe8b0851.png" style="width:32.67em;height:13.08em;" width="800" height="320"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 5: Displaying Information Using Web Pages</h1>
                </header>
            
            <article>
                
<p class="mce-root">The following are the solutions for this chapter.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Displaying the Details of a Blog-Post</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Create an <kbd>@Controller</kbd> annotated class. Name the class <kbd>BlogPostController</kbd>. Inject the <kbd>BlogPostService</kbd> as you have learned it in the previous chapter.</li>
<li>Add a handling method to the <kbd>BlogPostController</kbd> called <kbd>displayBlogPostBySlug()</kbd> that gets the slug of the post to be retrieved from the query. Set the mapping to "<kbd>/{slug}</kbd>" and use a path variable slug to find the blog post. Throw a <kbd>BlogPostNotFoundException</kbd> when a blogpost with the given slug could not be found.</li>
<li>Retrieve the blog post from the <kbd>BlogPostService</kbd> by using the <kbd>findBySlug()</kbd> method.</li>
<li>Return a <kbd>ModelAndView</kbd> instance from the <kbd>displayBlogPostBySlug()</kbd> method. Set the view name to <strong>blogpost</strong> and add the blog post returned from the <kbd>BlogPostService</kbd> as an attribute named <kbd>blogPost</kbd> to the model.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2xaKvfc">https://bit.ly/2xaKvfc</a> to access the code for the <kbd>BlogPostController.java</kbd> file.</div>
<ol start="5">
<li class="mce-root">Create a view template file <kbd>src/main/resources/templates/blogposts/details.html</kbd>. You can use the file <kbd>empty.html</kbd> in the sample directory for the layout code of the page.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2Qrh4OL">https://bit.ly/2Qrh4OL</a> to access the code for the <kbd>details.html</kbd> file.</div>
<p> </p>
<ol start="6">
<li>Start the application using the <kbd>mvnw spring-boot:run</kbd> command</li>
<li>Open the URL <kbd>http://localhost:8080/blogposts/my-first-post</kbd></li>
<li>Obtain the following output screen:</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/471580fe-82f9-4ebc-a1c8-6dbe83dc319b.png" style="width:27.75em;height:13.17em;" width="398" height="188"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 6: Passing Data Between the View and the Controller</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Creating a Page to Enter a New Blog Post</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Open the project at <a href="https://bit.ly/2Ft1iBQ">https://bit.ly/2Ft1iBQ</a>.</li>
<li>Open the yet empty model class Category in the <kbd>package com.packt.springboot.blogmania.category</kbd>.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2xadDDh">https://bit.ly/2xadDDh</a> to access the complete code for the <kbd>Category.java</kbd> file.</div>
<ol start="3">
<li>Add an attribute of type String called <kbd>name</kbd> to the model class and use Lombok annotations to generate all methods of a data class.</li>
<li>Open the controller class called <kbd>CategoryController</kbd> in the same package as the Category class. You will find an empty Spring controller.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2x6YMKG">https://bit.ly/2x6YMKG</a> to access the complete code for the <kbd>CategoryController.java</kbd> file.</div>
<ol start="5">
<li>Add a field called <kbd>allCategories</kbd> of type <kbd>List&lt;Category&gt;</kbd> that will hold all available categories. Don’t forget to initialize the list (with an <kbd>ArrayList&lt;&gt;</kbd>).</li>
<li>Add a method <kbd>renderCategoryForm()</kbd> to initialize a new empty category and add it to the model as an attribute named <kbd>category</kbd>. This method should be mapped to the get request with the URI "<kbd>/categories/new</kbd>". Render a view named "<kbd>/categories/form</kbd>".</li>
<li>Add a method <kbd>addCategory()</kbd> with a post request mapping for "<kbd>/categories</kbd>".<br/>
This method will receive a Category as a parameter and add it to the list of all categories. Return "<kbd>redirect:/</kbd>" as the view name.</li>
<li>Implement the currently empty method retrieveAllCategories() to return the list of all categories. You may want to return a copy of the list to prevent clients from changing the original list.</li>
<li>Open the file called src/main/resources/categories/form.html that will contain the form for the category.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2NHbtFw">https://bit.ly/2NHbtFw</a> to access the complete code for the <kbd>form.html</kbd> file.</div>
<ol start="10">
<li>Add a form to enter the category name. Use the action <kbd>@{/categories}</kbd> in the form. Feel free to use Bootstrap to style the input elements.</li>
<li>Open the file <kbd>src/main/resources/blogposts/form.html</kbd> containing the form to edit a blogpost.</li>
</ol>
<div class="packt_infobox"><br/>
Go to <a href="https://bit.ly/2NHbtFw">https://bit.ly/2NHbtFw</a> to access the complete code for the <kbd>form.html</kbd> file.</div>
<ol start="12">
<li>Add a drop-down field to the form with <kbd>th:field="*{categoryName}"</kbd> to generate all options use the list of all categories available in a model attribute named categories.</li>
<li>Start the application and open your browser at <kbd>http://localhost:8080</kbd>.</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/fe7875f7-4ff8-45e5-8fd5-8e949d0b286b.png" style="width:18.25em;height:25.17em;" width="769" height="1065"/></div>
<ol start="14">
<li>Now click on <span class="packt_screen">Add Category</span>.</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/1e6afbd6-23b9-4367-af90-1d60f4b3e458.png" style="width:21.08em;height:20.08em;" width="769" height="735"/></div>
<ol start="15">
<li>Enter a category title and click <span class="packt_screen">Save</span>.</li>
<li>Add as many more categories as you like.</li>
<li>Now click on the plus sign (<span class="packt_screen">+</span>) in the upper right.</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/299d825b-ef52-4489-bbea-42f0b383f199.png" style="width:26.25em;height:36.25em;" width="763" height="1056"/></div>
<ol start="18">
<li>Enter a blog post and look at the list of categories.</li>
</ol>
<ol start="19">
<li>After clicking <span class="packt_screen">Save</span><span>, the selected category should appear under the blog post title.</span></li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/b9f0f141-4dfb-43eb-b8c2-8c3561b58e0e.png" style="width:29.00em;height:39.17em;" width="763" height="1032"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 7: RESTful APIs</h1>
                </header>
            
            <article>
                
<p>The following are the solutions for this chapter.</p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Creating a List of Blog Articles as a REST Resource</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Take the blogmania application and find the <kbd>BlogPostController</kbd>. Here you can see how individual blog articles are delivered for the web frontend. Another controller, <kbd>HomePageController</kbd>, adds all articles to the model. These two may serve as examples for the next steps.</li>
<li>Write another controller, a REST controller this time, that gives a list of all the articles under the URL /api/blogposts To do that create a new class (preferably in the blogpost package) called <kbd>BlogPostRestController</kbd>, and make it a Spring REST controller.</li>
<li>While you could add the full path to each method, we know that <kbd>/api/blogposts</kbd> will be the same for all methods that can come in this controller, so add that path at the class level.</li>
<li>The class will need one or two dependencies – add them to the class.</li>
<li>Add a mapping function to get all the blog articles via REST. REST conventions say that this list resource will live under exactly the path we gave at the class level.</li>
</ol>
<ol start="6">
<li>Start the application and use Postman to access <kbd>localhost:8080/api/blogposts</kbd> – you should now see the list of blog articles returned as a JSON list.</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/22bb439a-f0c7-47b6-818b-d9e6113655ec.png" style="width:38.50em;height:28.67em;" width="904" height="671"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 8: Web Application Security</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Exploring Security Annotations</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>Navigate to the <kbd>HomePageController</kbd> and find the <kbd>homePage()</kbd> method. Add an annotation to limit access to users who have the role USER as follows:</li>
</ol>
<pre style="padding-left: 60px">@GetMapping("/")<br/>@RolesAllowed("USER")<br/>public String homePage(Model model) { … }</pre>
<ol start="2">
<li>Restart the application and open the page in the browser.</li>
</ol>
<div class="packt_infobox"><br/>
Note that we are immediately redirected to the login page. Log in with any of the predefined users; for instance, <kbd>peter/quinn</kbd> or <kbd>cate/sakai</kbd>.</div>
<ol start="3">
<li>Note that the index page changed to reflect your user.<br/>
Take a look at the following screenshots showing the name and role assigned:</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/9ab817dd-357a-46bf-b264-4f7754ff636a.png" style="width:12.42em;height:7.83em;" width="213" height="133"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/63ef0115-0a14-42a4-aae1-838e5338cdfc.png" style="width:34.25em;height:19.92em;" width="635" height="369"/></div>
<ol start="4">
<li>Try to log out.</li>
<li>Find the <kbd>ShortMessageService</kbd> and its <kbd>findAll()</kbd> method. Add an annotation that limits the display to the articles that a user has written themselves:</li>
</ol>
<pre style="padding-left: 60px">@PostFilter("isAnonymous() || " +<br/>     "filterObject.author.username == authentication.name")<br/>public List&lt;ShortMessage&gt; findAll() { … }</pre>
<ol start="6">
<li>Restart the application and open the page in the browser.</li>
</ol>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Chapter 9: Persisting Data Using a Database</h1>
                </header>
            
            <article>
                
<p><span>The following are the solutions for this chapter.</span></p>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Activity: Creating an SMS Application to Display Multiple Authors</h1>
                </header>
            
            <article>
                
<p><strong>Steps for Completion</strong></p>
<ol>
<li>To start, in the <kbd>ShortMessage</kbd> class, change the author field to: List&lt;Author&gt; authors. To make the Java even compile, there needs to be a change in <kbd>ShortMessageRepository</kbd> when creating a <kbd>ShortMessage</kbd>: In a first step, just wrap the author using <kbd>Collections.singletonList()</kbd>.</li>
<li>In the next step, change the Thymeleaf view <kbd>index.html</kbd> to accept multiple authors. Note that the attribute is now called <kbd>msg.authors</kbd>. It is a bit of work to create a comma-separated list, but you can copy from the way the multiple authorities are shown a few lines above. To be complete, this has to be done twice: Once for the <kbd>fullName</kbd>, once for the username.</li>
<li>You may want to start the app now to verify that everything is displayed as it was before. Small steps like these are how software evolves.</li>
<li>Now add a new Flyway migration <kbd>V03__authors.sql –</kbd> you need a new table <kbd>message_authors</kbd>, copy data from <kbd>short_message</kbd> and finally drop the <kbd>author_id column</kbd>. For reference, look it up again in the third section of this chapter.</li>
<li>Now the <kbd>ShortMessageRepository</kbd> is not compatible with the database anymore. There are many ways to fix this. One quite easy way is to add the following at the start of the <kbd>retrieveAll</kbd> method:</li>
</ol>
<pre style="padding-left: 60px">LinkedMultiValueMap&lt;Integer, Author&gt; authorsMap =<br/>    new LinkedMultiValueMap&lt;&gt;();<br/>RowCallbackHandler addAuthor = rs -&gt; authorsMap.add(<br/>    rs.getInt("message_id"),<br/>    authorService.retrieveAuthor(rs.getInt("author_id")));<br/>jdbcTemplate.query(<br/>    "SELECT message_id, author_id FROM message_authors",<br/>    addAuthor);</pre>
<ol start="6">
<li>Using this map from article IDs to authors, change the query and the implementation for the second <kbd>jdbcTemplate</kbd> execution.</li>
<li>You may want to start the app now to verify that everything is displayed as it was before. Note that you are now getting the same display for a different data model and different data in the database!</li>
<li>To actually see some change, you can use the H2 console in another browser tab to add some co-authors and immediately see the results after reloading in the original tab.</li>
<li>Create a new migration <kbd>V04__coauthors.sql</kbd> with some message – author links. When you start the application again, these are visible as in the following screenshot:</li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img src="Images/468095d5-7c63-40c1-8a56-3691cd1b2c3f.png" style="width:33.08em;height:32.42em;" width="996" height="975"/></div>


            </article>

            
        </section>
    </div>



  
<div id="sbo-rt-content"><section>

                            <header>
                    <h1 class="header-title">Solutions Summary</h1>
                </header>
            
            <article>
                
<p>Hope this section helped solve any obstacles that you had been facing while attempting these activities. Now you should be able to solve other such problems as well.</p>
<p>Happy solving!</p>


            </article>

            
        </section>
    </div>



  </body></html>