<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Handling Typical Build Requirements"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Handling Typical Build Requirements</h1></div></div></div><p>In this chapter, we will cover the following recipes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Including and excluding additional resources</li><li class="listitem" style="list-style-type: disc">Including and excluding source files and folders</li><li class="listitem" style="list-style-type: disc">Configuring Maven to search for plugins</li><li class="listitem" style="list-style-type: disc">Working in offline mode</li><li class="listitem" style="list-style-type: disc">Controlling the verbosity of the Maven output</li><li class="listitem" style="list-style-type: disc">Using the Maven Help plugin</li><li class="listitem" style="list-style-type: disc">Using the Maven SCM plugin</li><li class="listitem" style="list-style-type: disc">Generating changelogs for a site</li></ul></div><div class="section" title="Introduction"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec77"/>Introduction</h1></div></div></div><p>In previous chapters, we have seen how to set up Apache Maven to build software projects. We have also seen how to configure it to analyze code quality and code coverage. We have seen how to generate and publish project documentation.</p><p>As we use Apache Maven, we will encounter requirements that are not generic, but at the same time, not rare. In many projects, there would be a need to include additional source or resource folders. We will see how Maven allows us to do this. We would also want to get more verbose output from Maven to help troubleshoot when things go wrong. We will also see to what extent we can get the Maven build working without the Internet. We will also see how Maven works with <a id="id440" class="indexterm"/>
<span class="strong"><strong>software configuration management</strong></span> (<span class="strong"><strong>SCM</strong></span>) systems and allows SCM changes to be part of project documentation.</p></div></div>
<div class="section" title="Including and excluding additional resources"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec78"/>Including and excluding additional resources</h1></div></div></div><p>There are many situations where you will need to include additional resource files or folders for compilation or testing. You might also have to exclude specific files or folders. Let us see how we can do this.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec191"/>Getting ready</h2></div></div></div><p>Maven is set up on your <a id="id441" class="indexterm"/>system <a id="id442" class="indexterm"/>and is verified for work. To do this, refer to the first three recipes of <a class="link" href="ch01.html" title="Chapter 1. Getting Started">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec192"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open one of the Maven projects for which we need to include or exclude files or folders; for instance, <code class="literal">project-with-include-exclude</code>.</li><li class="listitem">Add the following to the <code class="literal">build</code> section of your <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">&lt;resources&gt;
      &lt;resource&gt;
        &lt;directory&gt;src/resources/xml&lt;/directory&gt;
        &lt;includes&gt;
          &lt;include&gt;*.xml&lt;/include&gt;
        &lt;/includes&gt;
      &lt;/resource&gt;
      &lt;resource&gt;
        &lt;directory&gt;src/resources/json&lt;/directory&gt;
        &lt;includes&gt;
          &lt;include&gt;include.json&lt;/include&gt;
        &lt;/includes&gt;
        &lt;excludes&gt;
          &lt;exclude&gt;exclude.json&lt;/exclude&gt;
        &lt;/excludes&gt;
      &lt;/resource&gt;
&lt;/resources&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn resources:resources</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-resources-plugin:2.6:resources (default-cli) @ project-with-include-exclude ---</strong></span>
<span class="strong"><strong>[INFO] Using 'UTF-8' encoding to copy filtered resources.</strong></span>
<span class="strong"><strong>[INFO] Copying 2 resources</strong></span>
<span class="strong"><strong>[INFO] Copying 1 resource</strong></span>
<span class="strong"><strong>[INFO] ------------------------------------------------------------------------</strong></span>
</pre></div></li><li class="listitem">View the contents of the <code class="literal">resources</code> folder:<div class="mediaobject"><img src="graphics/6124OS_08_01.jpg" alt="How to do it..."/></div></li><li class="listitem">View the <a id="id443" class="indexterm"/>contents of<a id="id444" class="indexterm"/> the build output directory:<div class="mediaobject"><img src="graphics/6124OS_08_02.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec193"/>How it works...</h2></div></div></div><p>The <code class="literal">resources</code> goal of the Maven Resources plugin copies all the resources required by the source to build the output directory. This goal is bound to the <code class="literal">process-resources</code> phase, which is part of the <code class="literal">default</code> lifecycle.</p><p>By default, the goal copies over the contents of <code class="literal">src/main/resources</code>. When the <code class="literal">resources</code> tag is specified in the <code class="literal">pom</code> file, it copies the contents of the directories specified there, based on the <code class="literal">include</code> and <code class="literal">exclude</code> filters specified.</p><p>In our specific example, we did three things:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Included all the XML files in the <code class="literal">src/resources/xml</code> folder</li><li class="listitem" style="list-style-type: disc">Included a specific file in the <code class="literal">src/resources/json</code> folder</li><li class="listitem" style="list-style-type: disc">Excluded a specific file in the <code class="literal">src/resouces/json</code> folder</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec194"/>There's more...</h2></div></div></div><p>What if we need to copy test resources<a id="id445" class="indexterm"/> selectively? For this, we would need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following in the <code class="literal">build</code> section of your <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">&lt;testResources&gt;
  &lt;testResource&gt;
    &lt;directory&gt;src/resources/xml&lt;/directory&gt;
    &lt;includes&gt;
      &lt;include&gt;*.xml&lt;/include&gt;
    &lt;/includes&gt;
  &lt;/testResource&gt;
  &lt;testResource&gt;
    &lt;directory&gt;src/resources/json&lt;/directory&gt;
    &lt;includes&gt;
      &lt;include&gt;include.json&lt;/include&gt;
    &lt;/includes&gt;
    &lt;excludes&gt;
      &lt;exclude&gt;exclude.json&lt;/exclude&gt;
    &lt;/excludes&gt;
  &lt;/testResource&gt;
&lt;/testResources&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn resources:testResources</strong></span>
</pre></div></li><li class="listitem">View the contents of the <code class="literal">test-classes</code> folder:<div class="mediaobject"><img src="graphics/6124OS_08_03.jpg" alt="There's more..."/></div></li></ol></div><p>This will now copy over the specified test resources to the test output directory (<code class="literal">target/test-classes</code>).</p><p>We saw that the <code class="literal">resources</code> <a id="id446" class="indexterm"/>and <code class="literal">testResources</code> goals copied resources to <code class="literal">classes</code> and <code class="literal">test-classes</code> respectively. What if we need to copy these to specific folders, For instance, <code class="literal">xml</code> files to the <code class="literal">xml</code> folder and <code class="literal">json</code> files to the <code class="literal">json</code> folder? The <code class="literal">add-resource</code> and <code class="literal">add-test-resource</code> goals of the Build Helper Maven plugin come to our assistance here.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Update the <code class="literal">pom</code> file with the following code:<div class="informalexample"><pre class="programlisting">&lt;plugin&gt;
  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
  &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.9.1&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;add-resource&lt;/id&gt;
      &lt;phase&gt;generate-resources&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;add-resource&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;resources&gt;
          &lt;resource&gt;
            &lt;directory&gt;src/resources/xml&lt;/directory&gt;
            &lt;targetPath&gt;xml&lt;/targetPath&gt;
          &lt;/resource&gt;
          &lt;resource&gt;
            &lt;directory&gt;src/resources/json&lt;/directory&gt;
            &lt;targetPath&gt;json&lt;/targetPath&gt;
              &lt;includes&gt;
                &lt;include&gt;include.json&lt;/include&gt;
              &lt;/includes&gt;
              &lt;excludes&gt;
                &lt;exclude&gt;exclude.json&lt;/exclude&gt;
              &lt;/excludes&gt;
          &lt;/resource&gt;
        &lt;/resources&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn compile</strong></span>
</pre></div></li><li class="listitem">Examine the <code class="literal">target/classes</code> folder now.</li></ol></div><p>You will see the <code class="literal">xml</code> and <code class="literal">json</code> subfolders <a id="id447" class="indexterm"/>with their respective content.</p></div></div>
<div class="section" title="Including and excluding source files and folders"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec79"/>Including and excluding source files and folders</h1></div></div></div><p>As per Maven conventions, all project<a id="id448" class="indexterm"/> sources should be in the <code class="literal">src</code> folder. However, there may be <a id="id449" class="indexterm"/>legacy projects that are organized differently and may have more than one source folder. Also, in some projects, we might generate sources dynamically from tools such as <code class="literal">wsdl2java</code>. In such cases, Maven needs to be told about these additional source folders. Note that such projects may not work well in IDEs.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec195"/>How to do it...</h2></div></div></div><p>Use the following steps to include and exclude source files and folders in your Maven project:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project named <code class="literal">project-with-additional-source</code>.</li><li class="listitem">Add the following section in the <code class="literal">pom</code> file:<div class="informalexample"><pre class="programlisting">    &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;add-source&lt;/id&gt;
            &lt;phase&gt;generate-sources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;add-source&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;sources&gt;
                &lt;source&gt;src/main/source&lt;/source&gt;
              &lt;/sources&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
    &lt;/plugin&gt;</pre></div></li><li class="listitem"> Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn compile</strong></span>
</pre></div></li><li class="listitem">See the output generated:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- build-helper-maven-plugin:1.9.1:add-source (add-source) @ project-with-additional-source ---</strong></span>
<span class="strong"><strong>[INFO] Source directory: C:\projects\apache-maven-cookbook\project-with-additional-source\src\main\source added.</strong></span>
</pre></div></li><li class="listitem">View the <code class="literal">target/classes</code> folder:<div class="mediaobject"><img src="graphics/6124OS_08_04.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec196"/>How it works...</h2></div></div></div><p>We had an additional<a id="id450" class="indexterm"/> source folder called <code class="literal">src/main/source</code>. We specified this in<a id="id451" class="indexterm"/> the <code class="literal">configuration</code> section of the Build Helper Maven plugin. We also bound the <code class="literal">add-source</code> goal of the plugin to the <code class="literal">generate-sources</code> phase of the <code class="literal">default</code> lifecycle.</p><p>As part of the <code class="literal">default</code> lifecycle, the <code class="literal">generate-sources </code>phase is run by Maven prior to the <code class="literal">compile</code> goal. This invokes the <code class="literal">add-source</code> goal of the plugin, which adds the additional folder and its contents for compilation.</p><p>In a similar way, additional test folders can be added to the build. The configuration would be identical to the earlier case, except for the <code class="literal">execution</code> section, which would be as follows:</p><div class="informalexample"><pre class="programlisting">         &lt;execution&gt;
            &lt;id&gt;add-test-source&lt;/id&gt;
            &lt;phase&gt;generate-test-sources&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;add-test-source&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;sources&gt;
                &lt;source&gt;src/main/source&lt;/source&gt;
              &lt;/sources&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt; </pre></div><p>We specify the <code class="literal">add-test-source</code> goal instead of <code class="literal">add-source</code> and bind it to the <code class="literal">generate-test-sources</code> phase.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec197"/>There's more...</h2></div></div></div><p>The Build Helper Maven plugin provides a number of other goals that meet specific project requirements. Here are some of them:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">attach-artifact</code>: This is used to <a id="id452" class="indexterm"/>attach additional artifacts to be installed and/or deployed, besides the project artifact. This would be done by configuring the plugin as follows:<div class="informalexample"><pre class="programlisting">      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;attach-artifacts&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;attach-artifact&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;artifacts&gt;
                &lt;artifact&gt;
                  &lt;file&gt;some file&lt;/file&gt;
                  &lt;type&gt;extension of your file &lt;/type&gt;
                  &lt;classifier&gt;optional&lt;/classifier&gt;
                &lt;/artifact&gt;
              &lt;/artifacts&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">maven-version</code>: This is <a id="id453" class="indexterm"/>used to set a property containing the current version of Maven, which can be used as required. To use the Maven version number in the manifest of the project JAR, we will configure the plugin as follows:<div class="informalexample"><pre class="programlisting">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9.1&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;maven-version&lt;/id&gt;
            &lt;goals&gt;
              &lt;goal&gt;maven-version&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.2&lt;/version&gt;
        &lt;configuration&gt;
          &lt;archive&gt;
            &lt;manifestEntries&gt;
              &lt;Maven-Version&gt;${maven.version}&lt;/Maven-Version&gt;
            &lt;/manifestEntries&gt;
          &lt;/archive&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</pre></div></li></ul></div></div></div>
<div class="section" title="Configuring Maven to search for plugins"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec80"/>Configuring Maven to search for plugins</h1></div></div></div><p>You will recall that in the section on using the Maven JaCoCo plugin, to generate code coverage we had to explicitly specify the <code class="literal">projectId</code> and <code class="literal">artifactId</code> values of the plugin to it from the command line. However, for most other plugins, we specified the plugin name without additional information.</p><p>We will see why we had to <a id="id454" class="indexterm"/>do this and how to avoid it.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec198"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">settings</code> file (specifically the <code class="literal">settings.xml</code> file in your home directory).</li><li class="listitem">Add the following section:<div class="informalexample"><pre class="programlisting">&lt;pluginGroups&gt;
    &lt;pluginGroup&gt;org.jacoco&lt;/pluginGroup&gt;
&lt;/pluginGroups&gt;</pre></div></li><li class="listitem">Run the following command on the same project for which you ran JaCoCo earlier:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean jacoco:prepare-agent test jacoco:report</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO]</strong></span>
<span class="strong"><strong>[INFO] --- jacoco-maven-plugin:0.7.2.201409121644:report (default-cli) @ project-with-tests ---</strong></span>
<span class="strong"><strong>[INFO] Analyzed bundle 'Project with Tests' with 1 classes</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec199"/>How it works...</h2></div></div></div><p>There are two types <a id="id455" class="indexterm"/>of Maven plugins, which are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Plugins maintained by the Maven team itself (let us call them official plugins). These are in the default plugin groups <code class="literal">org.apache.maven.plugins</code> and <code class="literal">org.codehaus.mojo</code>.</li><li class="listitem" style="list-style-type: disc">All other plugins (let's say third-party plugins).</li></ul></div><p>All official plugins have the same <code class="literal">groupId</code>, namely <code class="literal">org.apache.maven.plugins</code>. They also have a convention for <code class="literal">artifactId</code>: <code class="literal">maven-${prefix}-plugin</code>, where <code class="literal">prefix</code> stands for the plugin prefix, the short name to refer to the plugin.</p><p>The prefix used to reference the plugin can be customized as well. The prefix can be specified directly through the <code class="literal">goalPrefix</code> configuration parameter on the <code class="literal">Maven-plugin-plugin</code> of the plugin's <code class="literal">pom</code> file.</p><p>So, when we run <code class="literal">mvn clean</code>, Maven looks for the <code class="literal">maven-clean-plugin</code> in the <code class="literal">org.apache.maven.plugins</code> group.</p><p>What about third-party plugins? <code class="literal">pluginGroups</code> lets Maven know the <code class="literal">groupId</code> where it should search for additional plugins. So in the earlier case, Maven searched for plugins in the <code class="literal">org.jacoco</code> group.</p><p>Third-party plugins should be named differently from official plugins. The conventional way to define the <code class="literal">artifactId</code> for third-party plugins is <code class="literal">${prefix}-maven-plugin</code>. When specified in this way, Maven automatically identifies the shortcut name for the plugin. In the earlier case, as the <code class="literal">artifactId</code> is <code class="literal">jacoco-maven-plugin</code>, the shortcut is <code class="literal">jacoco</code>.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec200"/>There's more...</h2></div></div></div><p>Maven will always search specified <code class="literal">pluginGroups</code> before it <a id="id456" class="indexterm"/>searches the following default groups:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">org.apache.maven.plugins</code></li><li class="listitem" style="list-style-type: disc"><code class="literal">org.codehaus.mojo</code></li></ul></div><p>Maven takes the first match for the shortcut that it finds. For instance, if there is a <code class="literal">clean</code> shortcut in a user-specified plugin in <code class="literal">pluginGroups</code>, it will take precedence over a Maven Clean plugin.</p></div></div>
<div class="section" title="Working in offline mode"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec81"/>Working in offline mode</h1></div></div></div><p>There might be situations where a<a id="id457" class="indexterm"/> Maven project needs to be built without access to the Internet. Let us see how Maven supports this, as well as the caveats.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec201"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a project that you want to build offline.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn dependency:go-offline </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_08_05.jpg" alt="How to do it..."/></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –o clean package</strong></span>
</pre></div></li></ol></div><p>Observe that the build is <a id="id458" class="indexterm"/>completed successfully without any network connection.</p></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec202"/>How it works...</h2></div></div></div><p>The <code class="literal">go-offline</code> goal<a id="id459" class="indexterm"/> of the Maven Dependency plugin downloads all the required dependencies and plugins for the project, based on the pom file. The <code class="literal">–o</code> option tells Maven to work offline and not check the Internet for anything.</p><p>However, it is not without<a id="id460" class="indexterm"/> its issues. On a brand new local repository, the <code class="literal">offline</code> option will not work with the following error:</p><div class="mediaobject"><img src="graphics/6124OS_08_06.jpg" alt="How it works..."/></div><p>This is a known problem or limitation with the Maven Dependency plugin. The required project has to be built online once to download anything that is missed out by the plugin. Subsequently, the project can be built offline. This is typically not required, as most organizations use a repository manager, such as Nexus or Artifactory, if they do not allow direct Internet access.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>If your project uses <code class="literal">SNAPSHOT</code> dependencies, then Maven will need the Internet to look for updates to the dependencies. To avoid this, you can set the <code class="literal">updatePolicy</code> to <code class="literal">never</code>, but this would be counterproductive as you will not get the latest version of the dependency.</p></div></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec203"/>There's more...</h2></div></div></div><p>Another way to run Maven in offline mode is to specify the <code class="literal">offline</code> parameter as <code class="literal">true</code> in the <code class="literal">settings</code> file. Once this is done, no attempt is made by Maven to connect to the Internet.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following in the settings file:<div class="informalexample"><pre class="programlisting">&lt;offline&gt;true&lt;/offline&gt;</pre></div></li><li class="listitem">Run a Maven build:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package</strong></span>
</pre></div></li></ol></div><p>Observe that the build is completed successfully without connecting to the Internet.</p></div></div>
<div class="section" title="Controlling the verbosity of the Maven output"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec82"/>Controlling the verbosity of the Maven output</h1></div></div></div><p>Sometimes, the output from<a id="id461" class="indexterm"/> Maven might be too verbose and we <a id="id462" class="indexterm"/>may want to only see the errors. At other times, the information displayed by Maven may be insufficient and we want to see more details. Let us see how we can control this.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec204"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a Maven project.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>    mvn –q clean package </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_08_07.jpg" alt="How to do it..."/></div></li><li class="listitem">Now run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>    mvn –X clean package </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_08_08.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec205"/>How it works...</h2></div></div></div><p>Maven provides <a id="id463" class="indexterm"/>different levels of logging. The typical<a id="id464" class="indexterm"/> levels are <code class="literal">DEBUG</code> (detailed messages), <code class="literal">INFO</code> (information messages), and <code class="literal">ERROR</code> (error messages). Specifying a level displays all messages at and above that level. For instance, specifying the <code class="literal">INFO</code> level displays messages at the <code class="literal">INFO</code> and <code class="literal">ERROR</code> levels.</p><p>By default, Maven logs all <code class="literal">INFO</code> level messages to the screen.</p><p>The <code class="literal">-q</code> parameter tells Maven to be quiet and not display anything other than <code class="literal">ERROR</code> level messages on the screen. So the only display is the output from tests.</p><p>On the other<a id="id465" class="indexterm"/> hand, the <code class="literal">-X</code> parameter tells Maven to display all<a id="id466" class="indexterm"/> messages at the <code class="literal">DEBUG</code> level and above. This gives a lot of information, which is useful for troubleshooting issues.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec206"/>There's more...</h2></div></div></div><p>Instead of viewing the Maven output on the screen, you could redirect it to a file to be viewed later. To do this, run the following command:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>      mvn –l simple-project-log.txt clean package</strong></span>
</pre></div><p>The command will be completed with no output on the screen. The <code class="literal">simple-project-log.txt</code> file will contain all the log messages. You can use a combination of <code class="literal">–l</code> along with <code class="literal">–q</code> or <code class="literal">–X</code> to redirect the appropriate level of logging to the file.</p><p>Alternately, the output can be redirected to a file:</p><div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn clean package &gt; simple-project-log.txt</strong></span>
</pre></div></div></div>
<div class="section" title="Using the Maven Help plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec83"/>Using the Maven Help plugin</h1></div></div></div><p>Maven provides a <code class="literal">–h</code> command-line flag to <a id="id467" class="indexterm"/>display various command-line parameters that it supports. However, there is a Help plugin that helps you get other information.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec207"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the simple Maven project.</li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>  mvn help:effective-pom </strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="mediaobject"><img src="graphics/6124OS_08_09.jpg" alt="How to do it..."/></div></li><li class="listitem">Run the following <a id="id468" class="indexterm"/>command on a project with a profile (for instance, <code class="literal">project-with-profile</code>):<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn help:all-profiles</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] --- maven-help-plugin:2.2:all-profiles (default-cli) @ project-with-profile ---</strong></span>
<span class="strong"><strong>[INFO] Listing Profiles for Project: com.packt.cookbook:project-with-profile:jar</strong></span>
<span class="strong"><strong>:1.0-SNAPSHOT</strong></span>
<span class="strong"><strong>  Profile Id: dev (Active: false , Source: pom)</strong></span>
</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –help:active-profiles</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Active Profiles for Project 'com.packt.cookbook:project-with-profile:jar:1.0-SNAPSHOT':</strong></span>

<span class="strong"><strong>The following profiles are active:</strong></span>
</pre></div></li><li class="listitem">Now run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn –Pdev help:active-profiles</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>Active Profiles for Project 'com.packt.cookbook:project-with-profile:jar:1.0-SNAPSHOT':</strong></span>

<span class="strong"><strong>The following profiles are active:</strong></span>

<span class="strong"><strong> - dev (source: com.packt.cookbook:project-with-profile:1.0-SNAPSHOT)</strong></span>
</pre></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec208"/>How it works...</h2></div></div></div><p>The Maven Help plugin <a id="id469" class="indexterm"/>provides different goals. These are also supported by IDEs, and are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">effective-pom</code>: This <a id="id470" class="indexterm"/>displays the pom file that will be used by Maven after applying inheritance, interpolation, and profiles. This is useful to know the final pom file when it is needed for troubleshooting.</li><li class="listitem" style="list-style-type: disc"><code class="literal">all-profiles</code>: This <a id="id471" class="indexterm"/>goal displays all the profiles that are available for the project. It indicates whether the profiles are active or not.</li><li class="listitem" style="list-style-type: disc"><code class="literal">active-profiles</code>: This goal <a id="id472" class="indexterm"/>displays the list of active profiles. We explicitly enabled the <code class="literal">dev</code> profile (which was not active by default), so it showed up in the list of active profiles.</li></ul></div></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec209"/>There's more...</h2></div></div></div><p>The Maven Help plugin provides a few other goals as well. A notable one is the <code class="literal">describe</code> goal, which is used to get details of any plugin.</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">To understand this, let's use an instance and run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn help:describe -DgroupId=org.jacoco -DartifactId=jacoco-maven-plugin -Ddetail=true</strong></span>
</pre></div></li><li class="listitem">Observe the results:<div class="mediaobject"><img src="graphics/6124OS_08_10.jpg" alt="There's more..."/></div></li></ol></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>The <code class="literal">describe</code> goal does not need you to have a Maven project. You are just getting some help information for a particular plugin!</p></div></div></div></div>
<div class="section" title="Using the Maven SCM plugin"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec84"/>Using the Maven SCM plugin</h1></div></div></div><p>Maven provides a mechanism to<a id="id473" class="indexterm"/> interact with SCM systems in a vendor-independent way. Typically, a Maven project is checked in an SCM. Using the Maven SCM plugin, you can perform a number of SCM-related activities.</p><div class="section" title="Getting ready"><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec210"/>Getting ready</h2></div></div></div><p>The Maven project that we want to use the plugin with should be in an SCM. Maven supports a number of SCM providers. We will use Git to illustrate this.</p></div><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec211"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Add the following code to your pom file:<div class="informalexample"><pre class="programlisting">  &lt;scm&gt;
        &lt;connection&gt;scm:git:https://bitbucket.org/maruhgar/apache-maven-cookbook&lt;/connection&gt;
     &lt;developerConnection&gt;scm:git:https://maruhgar@bitbucket.org/maruhgar/apache-maven-cookbook&lt;/developerConnection&gt;
        &lt;url&gt;https://bitbucket.org/maruhgar/apache-maven-cookbook&lt;/url&gt;
    &lt;/scm&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn scm:status</strong></span>
</pre></div></li><li class="listitem">Observe the output in Windows:<div class="mediaobject"><img src="graphics/6124OS_08_11.jpg" alt="How to do it..."/></div></li><li class="listitem">For Linux, the <a id="id474" class="indexterm"/>output will be as follows:<div class="mediaobject"><img src="graphics/6124OS_08_12.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec212"/>How it works...</h2></div></div></div><p>When the <code class="literal">status</code> goal of the Maven SCM plugin is run, it uses the information in the <code class="literal">scm</code> tag of the <code class="literal">pom</code> file to get the SCM details. It uses this information and invokes the corresponding <code class="literal">scm</code> command to get the status information. In the preceding example, it is the <code class="literal">git status</code>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p>The command-line version of the relevant SCM client must be installed and available in the Maven path for this to work.</p></div></div><p>There are three entries in the <code class="literal">scm</code> tag:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">connection</code>: This is the <a id="id475" class="indexterm"/>connection information to access the repository. This is typically in the following form:<div class="informalexample"><pre class="programlisting">&lt;service name&gt;:&lt;scm implementation&gt;:&lt;repository url&gt;</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><code class="literal">service name</code>: This would be an SCM</li><li class="listitem" style="list-style-type: disc"><code class="literal">scm implementation</code>: This would be one of the supported SCMs</li><li class="listitem" style="list-style-type: disc"><code class="literal">repository url</code>: This would be a URL for the repository</li></ul></div></li><li class="listitem" style="list-style-type: disc"><code class="literal">developerConnection</code>: This is <a id="id476" class="indexterm"/>similar to any connection, except that this may need authentication or have additional privileges. Typically, the <code class="literal">connection</code> access would be read-only, while the <code class="literal">developerConnection</code> access would be read-write.</li><li class="listitem" style="list-style-type: disc"><code class="literal">url</code>: This is the repository<a id="id477" class="indexterm"/> URL.</li></ul></div><p>You will also notice that the appropriate shell command is used based on the operating system, which is <code class="literal">cmd.exe</code> in the case of Windows and <code class="literal">sh</code> in the case of Linux.</p></div><div class="section" title="There's more..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec213"/>There's more...</h2></div></div></div><p>The Maven SCM plugin<a id="id478" class="indexterm"/> provides a number of other commands for various SCM operations, such as <code class="literal">add</code>, <code class="literal">remove</code>, <code class="literal">checkin</code>, <code class="literal">checkout</code>, <code class="literal">update</code>, <code class="literal">diff</code>, <code class="literal">branch</code>, and <code class="literal">tag</code>.</p><p>Bootstrap is an interesting option to checkout and build a project with:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Create a new Maven project (or open the <code class="literal">bootstrap-project</code> file).</li><li class="listitem">Add a valid Maven project in the <code class="literal">scm</code> section:<div class="informalexample"><pre class="programlisting">&lt;scm&gt;
    &lt;connection&gt;scm:git:https://github.com/maruhgar/mvn-examples&lt;/connection&gt;
    &lt;url&gt;https://github.com/maruhgar/mvn-examples&lt;/url&gt;
  &lt;/scm&gt;</pre></div></li><li class="listitem">Add the following entries in the <code class="literal">build</code> section:<div class="informalexample"><pre class="programlisting">&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
      &lt;artifactId&gt;maven-scm-plugin&lt;/artifactId&gt;
      &lt;version&gt;1.9.2&lt;/version&gt;
      &lt;configuration&gt;
        &lt;goals&gt;install&lt;/goals&gt;
        &lt;goalsDirectory&gt;test-properties&lt;/goalsDirectory&gt;
      &lt;/configuration&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;</pre></div></li><li class="listitem">Run the Maven command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn scm:bootstrap</strong></span>
</pre></div></li><li class="listitem">Observe the results:<div class="mediaobject"><img src="graphics/6124OS_08_13.jpg" alt="There's more..."/></div></li></ol></div><p>Our Maven project has<a id="id479" class="indexterm"/> checked another Maven project, using the information in the <code class="literal">scm</code> section, and run the specified goal on this. We specify a <code class="literal">goalsDirectory</code> element because the SCM contains a number of projects and we want to execute the goals for a specific project, in this case <code class="literal">test-properties</code>.</p></div></div>
<div class="section" title="Generating changelogs for a site"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec85"/>Generating changelogs for a site</h1></div></div></div><p>Now that we have seen the <a id="id480" class="indexterm"/>Maven SCM plugin in action, we can see how we <a id="id481" class="indexterm"/>can use this feature to generate a log of project changes as part of the site report.</p><div class="section" title="How to do it..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec214"/>How to do it...</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the Maven project <code class="literal">project-with-documentation</code>.</li><li class="listitem">Add the following entry in the <code class="literal">reporting</code> section:<div class="informalexample"><pre class="programlisting">      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
        &lt;artifactId&gt;maven-changelog-plugin&lt;/artifactId&gt;
        &lt;version&gt;2.3&lt;/version&gt;
      &lt;/plugin&gt;</pre></div></li><li class="listitem">Run the following command:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>mvn site</strong></span>
</pre></div></li><li class="listitem">Observe the output:<div class="informalexample"><pre class="programlisting"><span class="strong"><strong>[INFO] Generating "Change Log" report    --- maven-changelog-plugin:2.3</strong></span>
<span class="strong"><strong>[INFO] Generating changed sets xml to: C:\projects\apache-maven-cookbook\project-with-documentation\target\changelog.xml</strong></span>
<span class="strong"><strong>[INFO] Executing: cmd.exe /X /C "git whatchanged "--since=2014-11-06 02:45:57 +0</strong></span>
<span class="strong"><strong>000" "--until=2014-12-07 02:45:57 +0000" --date=iso -- C:\projects\apache-maven-cookbook\project-with-documentation"</strong></span>
</pre></div></li><li class="listitem">Observe the generated reports:<div class="mediaobject"><img src="graphics/6124OS_08_14.jpg" alt="How to do it..."/></div></li></ol></div></div><div class="section" title="How it works..."><div class="titlepage"><div><div><h2 class="title"><a id="ch08lvl2sec215"/>How it works...</h2></div></div></div><p>When the <code class="literal">site</code> command is<a id="id482" class="indexterm"/> run, Maven uses the information in the <code class="literal">reporting</code> section <a id="id483" class="indexterm"/>of the <code class="literal">pom</code> file to generate various reports. It finds an entry for the Maven Changelog plugin and generates the corresponding changelog report.</p><p>This is essentially the SCM log for the project, with details such as timestamp, author, and details of change.</p></div></div></body></html>