# 第二章：Java 9 的全景

Java 自从第一个版本发布以来已经是一个成熟的成年人，超过二十年了。凭借令人惊叹的开发者社区和众多行业的广泛应用，该平台继续在性能、安全性和可扩展性方面与世界其他地区保持同步。我们将从探索 Java 9 中引入的最显著特性开始，探讨它们背后的最大推动力，以及我们可以在平台后续发展中期待什么，以及一些未包含在本版本中的内容。

在本章中，我们将涵盖以下主题：

+   从 20,000 英尺的高度看 Java 9

+   打破单体架构

+   在 Java Shell 中玩耍

+   控制外部进程

+   利用 G1 提升性能

+   使用 JMH 测量性能

+   准备迎接 HTTP 2.0

+   包含响应式编程

+   扩展愿望清单

# 从 20,000 英尺的高度看 Java 9

你可能会问自己--Java 9 仅仅是一个包含了一些未能在 Java 8 中实现的功能的维护版本吗？Java 9 中有很多新内容，使其成为一个独特的版本。

毫无疑问，Java 平台的模块化（作为 Jigsaw 项目的一部分开发）是使其成功进入 Java 9 的最大工作之一。最初计划在 Java 8 中实现，但被推迟，Jigsaw 项目也是 Java 9 最终发布进一步推迟的主要原因之一。Jigsaw 还为 Java 平台引入了一些显著的变化，这也是 Java 9 被视为重大版本的原因之一。我们将在后续章节中详细探讨这些特性。

**JCP**（Java Community Process）提供了将一系列特性提案（也称为**Java 增强提案**或**JEPs**）转化为正式规范的机制，这些规范为通过新功能扩展平台提供了基础。在这一点上，Java 9 并无不同。除了与 Jigsaw 相关的 Java 增强提案外，还有许多其他增强功能被纳入了 Java 9。在这本书中，我们将根据相应的增强提案，以逻辑组的形式讨论各种特性，包括以下内容：

+   **Java Shell**（也称为**JShell**）--Java 平台的交互式外壳

+   以可移植的方式与操作系统进程协同工作的新 API

+   在 Java 7 中引入的 **Garbage-first**（G1）垃圾收集器在 Java 9 中被设置为默认的垃圾收集器

+   将 **Java Microbenchmark Harness**（JMH）工具添加到 Java 分发中，该工具可以用于对 Java 应用程序进行性能基准测试

+   通过新的客户端 API 支持 HTTP 2.0 和 WebSocket 标准

+   并发增强，其中定义了 `Flow` 类，该类描述了 Java 平台中反应式流规范的接口

一些最初被接受用于发布 9 的提案并没有实现，而是被推迟到了以后的版本，以及其他开发者可能期待的未来有趣的事情。

您可以从 [`www.oracle.com/technetwork/java/javase/downloads/index.html`](http://www.oracle.com/technetwork/java/javase/downloads/index.html) 下载适用于您系统的 JDK 9 发行版，如果您在尝试阅读其他章节和尝试新引入的示例和概念之前，想先动手实践。

# 打破单体

几年来，Java 平台的实用性持续发展和增加，使其成为了一个庞大的单体。为了使平台更适合嵌入式和移动设备，有必要发布简化版，如 Java CDC 和 Java ME。然而，这些版本在满足 JDK 提供的功能性方面变化多端的应用需求时，证明还不够灵活。在这方面，模块化系统的需求变得迫切，不仅是为了解决 Java 工具的模块化（总体而言，超过 5000 个 Java 类和 1500 个 C++ 源文件，Hotspot 运行时超过 25,0000 行代码），而且还为了提供一个机制，让开发者可以使用与 JDK 中相同的模块系统来创建和管理模块化应用程序。Java 8 提供了一种中间机制，允许应用程序仅使用整个 JDK 提供的 API 子集，这种机制被命名为紧凑配置文件。实际上，紧凑配置文件还为后续工作奠定了基础，这些工作是为了打破 JDK 各个不同组件之间的依赖关系，从而实现 Java 中的模块化。

模块化系统本身是在名为 Jigsaw 的项目下开发的，基于此，形成了几个 Java 增强提案和一个目标 JSR（376）。为了满足 Jigsaw 项目的需求，做了很多工作——有概念实现的证据，提出的特性比成功进入 Java 9 的特性要多。除此之外，还对 JDK 代码库进行了完全重构，并对 JDK 可分发镜像进行了完全重组。

在社区中，关于是否应该采用现有的成熟 Java 模块系统，如 OSGi，作为 JDK 的一部分，而不是提供一个全新的模块系统，存在相当大的争议。然而，OSGi 针对的是运行时行为，例如模块依赖的解析、安装、卸载、模块（在 OSGi 术语中称为 bundle）的启动和停止、自定义模块类加载器等。然而，Project Jigsaw 的目标是一个编译时模块系统，其中依赖关系的解析发生在应用程序编译时。此外，将模块作为 JDK 的一部分进行安装和卸载，消除了在编译时显式将其包括为依赖项的需要。此外，通过现有的类加载器层次结构（引导类加载器、扩展类加载器和系统类加载器），可以实现模块类的加载，尽管，使用与 OSGi 模块类加载器相当的自定义模块类加载器也是可能的。然而，后者已被放弃；当我们讨论 Java 模块系统的细节时，我们将更详细地讨论 Java 模块类加载。

Java 模块系统带来的额外好处包括增强的安全性和性能。通过将 JDK 和应用程序模块化成 Jigsaw 模块，我们能够创建组件及其相应领域之间明确界定的边界。这种关注点的分离与平台的安全架构相一致，并且是更好地利用资源的能力。我们已经为所有上述点以及采用 Java 9 的主题（这也需要对将现有项目迁移到 Java 9 的可能方法有一定的理解）分配了两个详细的章节。
