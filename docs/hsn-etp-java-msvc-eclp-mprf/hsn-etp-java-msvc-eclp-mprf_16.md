# 第十二章：评估

# 第一章

1.  企业 Java 微服务具有以下特性：

    +   它是使用 Java 语言编写的。

    +   它可以使用任何 Java 框架。

    +   它可以使用任何 Java API。

    +   它必须是企业级的：可靠、可用、可扩展、安全、健壮和性能良好。

    +   它必须满足微服务架构的特性，如[`martinfowler.com/microservices/`](https://martinfowler.com/microservices/)所列，这些特性如下：

        +   通过服务实现组件化

        +   围绕业务能力组织

        +   产品而非项目

        +   智能端点和愚蠢的管道

        +   去中心化治理

        +   去中心化数据管理

        +   基础设施自动化

        +   设计失败

        +   进化式设计

1.  数字经济和数字转型的术语描述了四个不同力量的汇合...

# 第二章

1.  微 Profile 社区的主要沟通方式是他们的 Google 组，称为*Eclipse MicroProfile*。您可以通过向`microprofile@googlegroups.com`发送电子邮件来发送消息给它。另一种很好的方式来让你的声音被听到是参加每两周一次的 MicroProfile Hangout 通话。请查看 MicroProfile Google 日历以获取确切的日期、时间和会议信息以加入。

1.  微 Profile Hangout 通话作为一个论坛，讨论与会者提出的话题并做出决定，包括子项目状态、发布内容、发布日期和子项目创建批准。

1.  子项目（MicroProfile 规范）负责人或一组负责人通常是所在主题的专家，并指定为其提供便利。需要指出的重要一点是，工作组的负责人（或子项目）并不是单独塑造或决定规范的演变，或者包括哪些功能以及不包括哪些功能。他们没有否决权或在有关其规范的决策上没有最终决定权。通过分享观点、专业知识、过去经验、现有技术的分析和最佳实践，工作组将提出他们最好的建议。

1.  在 MicroProfile Google 组和/或 MicroProfile Hangout 通话中详细讨论新想法之后，如果确定值得进一步辩论，社区决定为这个新想法创建一个工作组，并指定一个负责人或一组负责人，他们通常是处理主题的专家，担任其促进者。工作组将建立一个定期每周或每两周的会议，并记录在 MicroProfile Google 日历中。任何人都可以参加会议，但通常有一小群人作为主题专家参加这些电话会议。经过几次会议，工作组决定是否将新功能带到 MicroProfile Hangout 电话中讨论其成为 MicroProfile 子项目的提案。在 MicroProfile Hangout 电话中，子项目提案可能会被拒绝或接受。接受子项目意味着它有效地解决了一个需求，丰富了规范，使其朝着优化企业 Java 以适应微服务架构的目标迈进。此刻，子项目成为正式的 MicroProfile API。一旦子项目成为 MicroProfile API，然后决定它是否应该作为独立子项目在外部或作为 MicroProfile 发布伞下的子项目。

1.  Eclipse MicroProfile 遵循时间盒的快速逐步发布计划，该计划是公开的，列在 Eclipse 基金会 MicroProfile 项目页面上。例如，从 1.x 到 2.x 的主要 Eclipse MicroProfile 发布，包括对 MicroProfile API 的重大更新，可能会引入破坏性变化。次要发布，即点发布，包括对小型 API 的更新或新的 API，以确定发布日期。目前，MicroProfile 社区的发布窗口每年在二月、六月和十一月，适用于次要和/或主要发布。

1.  沙盒仓库是一个 GitHub 仓库，用于孵化最终将成为独立仓库的想法和代码示例，为新的规范做出贡献。任何人都可以打开拉取请求，并使用沙盒进行新想法的实验，以及分享代码和文档，这些可以作为社区 Google 组、MicroProfile Hangout 通话或工作组会议讨论的一部分使用。

1.  将子项目发布在 MicroProfile 伞下/平台之外的原因是，它给了社区和最终用户一个机会来使用和测试新技术，因此在将其纳入伞下之前，在真实应用中证明它。MicroProfile 项目鼓励在将其纳入伞下/平台发布之前，新的子项目规范至少在外部发布一个版本。

1.  微服务启动器是一个样本源代码生成器，其目标是帮助开发者快速开始使用和利用企业 Java 微服务社区驱动的开源规范 Eclipse MicroProfile，通过在 Maven 项目中生成工作样本代码。

# 第三章

1.  配置属性的默认来源是环境变量、Java 系统属性和`META-INF`/`microprofile-config.properties`文件。

1.  你可以提供一个自定义 ConfigSource 实现，该实现将属性名称映射到自定义源中的值。

1.  字符串并不是唯一支持的数据类型，因为 MP-Config 通过可插拔的 SPI 支持类型转换，并且默认提供几种转换。

1.  如果你已经给了一个`defaultValue`，或者已经将属性作为`Optional<?>`值注入，你不需要为注入的属性提供一个值。

1.  复杂的属性类型可以使用自定义`Converter<?>`实现来处理，该实现接受一个字符串并返回复杂类型。

1.  当在类上指定一个注解时...

# 第四章

1.  线缆格式在只查看 HTTP 状态码来确定 HC 状态的环境中不可用。

1.  一个 MP-HC 响应可以通过使用`HealthCheckResponse#withData()`方法包括任意属性。

1.  你可以为每个服务创建一个 HealthCheck 实现，MP-HC 功能将逻辑上组合它们以产生总体状态响应。

1.  JWT 是一个 JSON Web Token，一个具有头部、载荷和签名组件的 JSON 格式的对象。

1.  声明是 JWT 载荷中的一个单独命名的值。

1.  任何可以表示为 JSON 的东西都可以用在 JWT 中。

1.  验证 JWT 的一个主要步骤是验证它是否基于配置的公钥使用 RS256 算法进行签名。

1.  可以查看除了组声明以外的其他声明来添加应用程序特定的授权决策。

# 第五章

1.  分布式跟踪提供了从端到端请求的微观视图，而指标则暴露了单个组件的标量数值。

1.  分布式跟踪系统通常提供诸如根因分析和关键路径分析、上下文化日志记录、分布式上下文传播和服务依赖关系图等功能。

1.  自动跟踪 JAX-RS 服务器端点和 MicroProfile Rest 客户端。一些供应商还可以自动跟踪 JAX-RS 客户端。

1.  这些标签对每个 REST 请求`http.method`、`http.status_code`、`http.url`、`component`、`span.kind`和`error`（如果抛出异常）进行添加。

1.  可以通过使用`@Traced`注解或注入追踪器并创建...来实现显式 instrumentation。

# 第六章

1.  不是的：默认情况下，即使没有使用任何一个 MP OpenAPI 注解，任何 REST 端点都会有 OpenAPI 生成。

1.  是的：你可以选择使用多少个或多少少的 MP OpenAPI 注解来表示你的微服务中的 REST 端点。

1.  这种观念是你预先定义好你的端点的预期合同，并将其封装在 OpenAPI 文档中，这些文档可以与你的微服务一起打包。

1.  不需要：你只需要知道请求和响应的格式，然后你就可以创建你自己的类型安全接口。

1.  通过使用`.../mp-rest/url` MP Config 设置，其中`...`是类型安全接口的接口名或传递给`RegisterRestClient`注解的 configKey。

1.  一种方法是注册一个`ClientHeadersFactory`实现。另一种方法是将标头列在`org.eclipse.microprofile.rest.client.propagateHeaders` MP-Config 属性中。

# 第七章

1.  在撰写本书时，有八个 Eclipse MicroProfile 的实现，全部都是开源的。它们是 Thorntail、Open Liberty、Apache TomEE、Payara Micro、Hammock、KumuluzEE、Launcher 和 Helidon。还有 Quarkus 作为最新加入者。

1.  应用服务器是 Java EE 应用程序的容器。应用组装器只包括应用程序需要的功能，而不是要求应用服务器运行，并且通常生成可执行的 JAR 文件。应用组装器可以生成 uberjar，一个自包含的可运行 JAR 文件，或者一个带有其运行时依赖位于子目录中的应用 jar，例如，伴随的`lib`或`libs`子目录。...

# 第八章

1.  我们在整本书以及本章中看到了许多示例，MP-Config 设置会影响应用程序和 MP 特性。

1.  只要你提供的路径存在，你应该能够看到带有关于该路径信息的成功的健康检查。

1.  它显示了关于 KeyCloak 服务器的信息。如果 KeyCloak 停止了，它会显示一个错误。

1.  因为它是在第一次请求时延迟生成的，所以找不到这个指标。

1.  待定。

1.  对于未加密的方法，行为应该相似。对于加密的方法，Swagger-UI 调用失败。

1.  你会看到错误响应。

1.  那就是编码后的 MP-JWT。你可以在 curl 命令中使用它作为`*Authorization: Bearer ...*`头值，其中你需要用在 Access Base64 Token 字段中找到的字符串替换...。

# 第九章

1.  MicroProfile Reactive Messaging 是通过连接器处理消息源的一个很好的选择，特别是在消息源以高频率生成消息且异步处理这些消息最合适的情况。

1.  MicroProfile Context Propagation 最佳支持 MicroProfile Reactive Streams Operators 和 MicroProfile Reactive Messaging，因为它允许将传统与当前线程相关联的上下文 propagate across 各种工作单元。

1.  当前支持反应式编程的规范包括 MicroProfile Reactive Streams Operators、MicroProfile Reactive Messaging 和 MicroProfile Context Propagation。

1.  在撰写本书时，那些位于...的项目...

# 第十章

1.  Eclipse MicroProfile 为使用企业级 Java 开发微服务提供了最佳方法之一。反过来，使用容器作为部署单元的微服务为在云和本地部署的高度分布式系统开发提供了最佳方法，即云原生应用。因此，基于 MicroProfile 的微服务有助于云原生应用的开发。

1.  云原生应用开发有两个互补的方面或组件：应用服务和基础设施服务。应用服务加快了云原生应用的业务逻辑开发，基础设施服务加快了其交付和部署。这两个方面是互补的，是云原生应用开发的重要组成部分。

1.  云原生应用开发是一种构建和运行应用程序的方法，它充分利用了基于四个关键信条的云计算模型：a) 基于服务的架构（微服务、微小服务、SOA 服务等等）；b) 用于服务间通信的 API 驱动方法；c) 基于容器的底层基础设施；d) DevOps 流程。 架构和通信方面与云原生应用的开发关切相关，基础设施和流程方面与它们的交付/部署相关。 Eclipse MicroProfile 与这些信条相关，因为它支持实现可以使用容器作为其底层基础设施的架构的微服务，其中微服务使用它们的 API 进行相互通信，并且使用 DevOps 流程进行开发。

1.  以下是 Eclipse MicroProfile 如何贡献于指导你向云原生应用迈进的每个八步：

    1.  发展 DevOps 文化和实践：“利用新技术、更快的方法和更紧密的协作，采纳 DevOps 的原则和文化遗产，并围绕这些价值观组织你的组织。” 虽然这是一个与组织和工作流程有关的步骤，但基于微服务的 Eclipse MicroProfile 规范可以很好地适应这种文化和流程的改变，因为微服务由于其特性，紧密支持 DevOps 流程。

    1.  使用快速微服务加速现有应用：“通过迁移到现代、基于容器的平台来加速现有应用的开发——并将单体应用拆分为微服务或微小服务以获得额外的效率提升。” 当您将单体应用拆分为微服务时，Eclipse MicroProfile 能提供很大帮助。 随着您在单体应用中识别出边界上下文，考虑使用 Eclipse MicroProfile 为每个实现边界上下文逻辑的微服务进行实现。

+   1.  使用应用服务加速开发：“通过复用性加速软件开发。云原生应用服务是即用的开发者工具。然而，为了最大化收益，这些可复用的组件必须优化并集成到 underlying 云原生基础设施中。”内存中数据网格（IMDG）和消息代理是帮助加速业务逻辑开发的应用服务。使用 Eclipse MicroProfile 开发的微服务可以通过在其方法体中调用这些应用服务来利用它们。当集成到应用服务，如 IMDG 或消息代理时，Eclipse MicroProfile 不会施加任何限制。

    1.  选择合适的工具完成合适的任务：“使用支持正确混合的框架、语言和架构的基于容器的应用平台——并且可以根据您的特定业务应用需求进行定制。”当开发者选择合适的工具来完成合适的任务时，Eclipse MicroProfile 就是这些工具之一。例如，Red Hat Application Runtimes 是一组运行时和工具的集合，其中包括 Eclipse MicroProfile、Node.js、Spring Boot 和 Vert.x。

    1.  为开发者提供自助式按需的基础设施服务：“利用容器和容器编排技术简化对底层基础设施的访问，赋予 IT 运维团队控制力和可见性，并在数据中心、私有云和公有云等各种基础设施环境中提供健壮的应用生命周期管理。”您用 Eclipse MicroProfile 开发的微服务可以部署到一个或多个容器中。通过轻松管理这些容器以及在其上运行的微服务架构，您可以加快开发周期，更快地向企业交付价值。

    1.  自动化 IT 以加速应用交付：“创建用于学习自动化语言和流程的自动化沙盒，建立跨组织协作对话以定义服务需求，创建赋予用户权力并加快交付的自助服务目录，以及使用计量、监控和计费回策略和流程。”Eclipse MicroProfile 提供了度量、容错和健康检查等功能，所有这些都可以作为 IT 自动化流程的输入。

+   1.  实现持续交付和先进的部署技术：“利用自动化交付、持续集成/持续交付（CI/CD）流水线、滚动蓝绿部署和金丝雀部署、以及 A/B 测试，加速您的云原生应用的交付。”微服务与 CI/CD 的结合可以促进先进的部署技术。例如，您可以作为蓝绿部署或金丝雀部署的一部分，将具有新功能的基于 MicroProfile 的微服务引入生产环境，一旦验证新功能按预期工作，即可将所有流量切换到它。

    1.  发展更加模块化的架构：“选择一种适合您特定需求的模块化设计，使用微服务、单体优先方法或 miniservices—或它们的组合。”在这个步骤中，您可以使用 Eclipse MicroProfile 为新的应用程序开发微服务，或者将您的单体的特定有限上下文拆分为微服务。

1.  十二因子应用是一种方法，开发者在设计和实现微服务和应用程序时可以遵循，而不受实现它们的编程语言或框架的限制。开发者可以使用 Eclipse MicroProfile 实现微服务的十二因子应用框架。十二因子应用和 Eclipse MicroProfile 不是相互排斥的，而是相互补充的。

1.  大多数，如果不是全部，市场 FaaS 提供支持 Java。因此，开发人员可以编写函数体，使用 Eclipse MicroProfile 的许多实现中的一种，这些实现都是用 Java 编写的。Eclipse MicroProfile 的易用性和丰富功能与 FaaS 平台的简单性相结合，可以大大提高开发人员向企业交付价值的速度。此外，实现 Eclipse MicroProfile 的 Quarkus 等技术，占用内存少，启动时间快，是 FaaS 的理想运行时。

1.  在使用 Eclipse MicroProfile 进行跨云部署时，您需要考虑以下事项：

    +   需要在云环境提供的基础上，配置云环境与本地环境之间的通信路由。

    +   配置 MicroProfile OpenTracing 以启用跨云环境的跟踪捕获。

+   +   监控跨云环境的 MicroProfile Metrics 信息拆分

    +   设置 CI 任务以针对适当的云环境，以维护正确的微服务。

1.  在多云环境中的分布式追踪可能会遇到挑战。我们希望实现与单云环境相同的目标，即可视化一个请求在穿过每个云中的服务以及跨云时所关联的单一路径，但处理不同的上下文传播格式和每个云中追踪数据的存储格式时可能会遇到复杂问题。第一个挑战是要确保追踪可以在不同的云环境中持续进行。这是一个问题，因为截至目前，还没有广泛采用或标准的追踪上下文格式。通常，每个追踪系统使用不同的头和格式来传播追踪上下文。第二个挑战，即使在同构追踪环境中，也要可视化来自多云环境的追踪数据。这可能是个问题，因为每个云中的追踪数据可能存储在不同的数据库中或以不同的格式存储。这可以通过将数据复制到单一统一存储中或根据需要发送缺失的追踪数据并在适当的数据格式调整后，在系统之间发送来克服。

1.  服务网格，如 Istio 或 LinkerD，在 Kubernetes 之上提供平台级别的服务，涵盖发现、路由和故障容限等领域。其中一些服务也可以在 MicroProfile 中找到。当你将 MicroProfile 应用程序部署到这样的服务网格中时，你需要考虑是否想使用 MicroProfile 中的版本还是网格中的版本。在此受影响最大的 MicroProfile 功能是故障容限，尤其是重试逻辑。
