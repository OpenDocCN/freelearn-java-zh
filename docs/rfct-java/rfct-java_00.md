# 前言

在这样一个似乎除了人工智能就没有其他话题的时代，写一本书来汇集编写良好、可维护的，用一个词来说，就是干净的代码的关键实践，可能看起来有些奇怪。当我写这本书的时候，一些工具已经变得众所周知——也许它们已经众所周知——这些工具可以帮助开发者编写代码，建议如何完成他们正在编写的代码行，甚至编写一些简短的方法。目前，意见非常两极分化，一方面是那些担心几周后就会变得过时的人，另一方面是那些认为他们的自然智力优于任何人工智能的人。

如同经常发生的那样，我们可能会发现自己处于中间某个位置。虽然 AI 确实可以帮助我们在一些小而具体的任务上，比如分析我们正在编写的代码周围的代码片段，并为我们完成工作，但距离它能够为我们编写所有代码、这些代码是可扩展的、可维护的、可扩展的，并且没有错误——如果这个时刻真的到来——还有相当长的时间。编写好的代码需要做出超越语法本身的决策，这涉及到理解特定问题的具体要求和细微差别，这是任何 AI 都无法理解的。

编写良好的代码是清晰、易读且易于理解的。这对于团队协作至关重要，因为其他开发者（甚至未来的你自己）需要理解和修改代码。AI 可以帮助生成代码，但它可能并不总是产生易于维护的代码。

软件开发中不可避免地会出现错误。编写干净和有组织的代码可以显著简化调试过程。清晰的代码更容易导航，这使得识别和修复问题变得更加简单。AI 工具可以帮助调试，但它们可能无法捕捉到每种类型的错误，或者像人类一样理解你代码的具体逻辑。

程序员的技术技能仍然非常重要，并且将在很长时间内保持重要；编写干净的代码和重构代码库将是至关重要的品质，这将使我们成为更好、更有价值的专业人士。

# 这本书面向的对象

这本书主要面向编写代码的人；我们相信它对那些刚刚开始编写代码的人特别有用，即使是经验丰富的专业人士有时也会忘记如何做某些事情——或者可能认为上下文不允许有其他方法。我们不提供秘密配方，也没有魔法公式，只提供重构代码、编写干净代码以及最重要的是，理解如果有什么问题并修复它的主要技术和技巧的汇编。我们还试图避免通过每天的小调整陷入不愉快的情况。所有这些都在一本书中。

我们的工作非常复杂，远比看起来复杂，这种复杂性对那些不说我们行话的人来说是难以传达的；有许多方面需要考虑，有多个变量在起作用，既有技术性的也有非技术性的。即使在完成学业之后，一个人也常常开始面对工作世界，不得不学习许多其他新事物。

这是我开始职业生涯时希望拥有的书：一种非常广阔且对许多人来说仍处于未探索状态的领域的地图。

# 本书涵盖的内容

*第一章*，*什么是重构？*，从基本概念开始，解释了重构的含义以及为什么它很重要。面对许多可能的重构机会，让我们学习如何正确地评估每个机会的重要性，即先重构哪一个。我们还将了解何时不需要重构。

*第二章*，*良好的编码习惯*，讨论了通过日常习惯编写高质量代码的话题。什么是好的代码？什么是坏的代码？我们将深入探讨这个问题，并简要介绍清洁代码的概念。我们将讨论软件设计的 SOLID 原则，以及（不使用）副作用和可变性以及坏代码的常见原因。

*第三章*，*代码异味*，是关于在浏览代码库时可能遇到的最常见的“红旗”；这些红旗应该立即引起专业人士的注意。识别它们（并因此避免它们）是我们技能的关键部分。

*第四章*，*测试*，讲述了测试阶段的重要性。为什么它很重要？为什么你必须要尽可能多地测试？我们将了解单元测试以及如何确保我们的大部分代码库都经过了测试。我们将探讨测试驱动开发。

*第五章*，*重构技巧*，是对我们在*第三章*中发现的代码“异味”可以采用的主要“技巧”的概述。我们将学习如何编写更好的方法和在必要时移动代码；我们将组织数据并简化条件逻辑和方法调用。我们还将讨论泛化。

*第六章*，*元编程*，是关于...不编写代码！换句话说，我们可以使用经过良好测试和稳固的框架和库来为我们编写代码，避免重复造轮子。

*第七章*，*静态和动态分析*，讲述了我们如何确保我们走在正确的道路上。本章深入探讨了代码分析和程序分析的概念，同时也探索了一些在理解我们离我们想要设定的质量阈值有多远时非常有用的工具。

*第八章*，*每天打造质量*，告诉我们在我们日常工作中可以采取的小和大行动。从代码版本控制到代码格式化，从代码审查到结对编程，我们可以融入许多小而持续的努力，以保持我们的代码库干净和可维护。

*第九章*，*精通软件架构*，提升了我们的视野，并讨论了软件项目的架构。它解释了什么是架构以及它由什么组成；它告诉我们关于主要架构模式的内容。正如我们针对单个代码片段所做的那样，我们讨论了哪些是主要的架构红旗以避免。

# 要充分利用这本书

本书提供的代码示例只是代码片段，足够通用，可以与任何供应商提供的最新 Java 版本一起运行。所有最常用的操作系统（Windows、macOS 和 Linux）都将适用。使用的构建和依赖关系管理工具是 Maven。

建议的配置是 Java 17 和 Apache Maven 3.8：

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Java 17 | Windows、macOS 或 Linux |
| Maven 3.8 | Windows、macOS 或 Linux |

# GitHub 仓库

如果有任何勘误，将在本 GitHub 仓库中更新：[`github.com/PacktPublishing/Refactoring-in-Java`](https://github.com/PacktPublishing/Refactoring-in-Java)

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`: 表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“使用`PreparedStatement`创建参数化 SQL 查询，其中`?`是用户输入的占位符。”

代码块按以下方式设置：

```java
String userInput = getUserInput();
String sqlQuery = "SELECT * FROM users WHERE username = ?";
PreparedStatement preparedStatement = connection.prepareStatement(sqlQuery);
preparedStatement.setString(1, userInput);
ResultSet resultSet = preparedStatement.executeQuery();
```

任何命令行输入或输出都按以下方式编写：

```java
They're not equal
They're equal
```

**粗体**: 表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词以**粗体**显示。以下是一个示例：“我们可以看到一个**开始**节点，从这个节点开始，有一条边进入条件节点。”

小贴士或重要注意事项

看起来像这样。

# 联系我们

欢迎读者反馈。

**一般反馈**: 如果您对本书的任何方面有疑问，请通过电子邮件发送至[customercare@packtpub.com](http://customercare@packtpub.com)，并在邮件主题中提及书名。

**勘误**: 尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将不胜感激，如果您能向我们报告这一点。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果你在互联网上以任何形式遇到我们作品的非法副本，我们将非常感激你提供位置地址或网站名称。请通过 copyright@packt.com 与我们联系，并提供材料的链接。

**如果你有兴趣成为作者**：如果你在某个领域有专业知识，并且你感兴趣的是撰写或为书籍做出贡献，请访问 authors.packtpub.com。

# 分享你的想法

一旦你阅读了《Java 重构》，我们很乐意听听你的想法！[请点击此处直接进入这本书的亚马逊评论页面并分享你的反馈](https://packt.link/r/1805126636)。

你的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载这本书的免费 PDF 副本

感谢你购买这本书！

你喜欢随时随地阅读，但无法携带你的印刷书籍到处走？

你的电子书购买是否与你的选择设备不兼容？

别担心，现在每本 Packt 书籍都免费提供该书的 DRM 免费 PDF 版本，无需额外费用。

在任何地方、任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制和粘贴代码到你的应用程序中。

优惠远不止这些，你还可以获得独家折扣、时事通讯和每日免费内容的访问权限

按照以下简单步骤获取福利：

1.  扫描下面的二维码或访问以下链接

![](img/B20912_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781805126638`](https://packt.link/free-ebook/9781805126638)

1.  提交你的购买证明

1.  就这些！我们将直接将你的免费 PDF 和其他福利发送到你的邮箱

# 第一部分：重构简介

我们将首先定义“重构”的含义以及为什么它是软件开发中的重要实践。我们还将涵盖重构的好处以及何时适合使用它的情况。我们将深入研究开发者应考虑重构的具体代码区域，提供如何识别和优先考虑改进区域的指导。

然后，我们将通过日常习惯来讨论编写高质量代码的话题，每个专业人士都应该内化这些习惯。我们将首先讨论好代码与坏代码的区别，并简要探讨清洁代码的概念。然后，我们将深入研究软件设计的 SOLID 原则，探讨（不使用）副作用、可变性和坏代码的常见原因。

本部分包含以下章节：

+   *第一章*，*什么是重构？*

+   *第二章*，*良好的编码习惯*
