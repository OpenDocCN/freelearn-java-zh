# 前言

理解 Java 内存的工作原理对你的 Java 编码和应用管理有很大的好处。它使得可视化对象组合中发生的事情以及对象分配和释放的情况变得更容易，结合对象组合。正如你可能已经知道的，对象组合是对象包含其他对象的地方。例如，`Person`类指定了一个类型为`Address`的属性，而`Address`也是一个类。了解这些在内存中是如何工作的，使得了解如何到达某个特定数据字段所需的步骤变得更容易。

此外，当你理解 Java 内存的工作原理时，`static`的概念以及使用`this`关键字访问实例将更容易可视化并完全理解。如果不理解 Java 内存的工作原理，就无法真正掌握`static`和`this`的概念。

另一个理解 Java 内存的好处是，使用原始类型或类引用作为参数之间的区别突然变得更有意义。这也帮助理解对象的不可变性和可变性。

更复杂的话题也会更容易理解，例如**并发**，这是我个人最喜欢的一个。这是指在你的应用程序中同时发生多件事情（多线程）。你可能还没有与之合作过，但作为一个 Java 开发者，你总有一天会。理解 Java 内存使得理解并发的某些方面变得更容易，特别是数据访问。另一个将更容易理解的话题是垃圾回收。这对于性能至关重要，因为它是一个非常昂贵的进程，你希望尽可能少地需要它，并尽可能多地优化它。

当你更好地理解 Java 内存的工作原理时，你每天可能已经在使用的所有东西都会变得更加清晰。

# 本书面向的对象

这本书面向所有类型的 Java 专业人士。无论是初级还是高级开发者，DevOps 工程师，测试人员，还是 Java 应用程序的系统管理员，这都不重要。如果你目前对 Java 内存、垃圾回收和/或 JVM 调优没有深入的了解，这本书将帮助你将 Java 技能提升到新的水平。

# 本书涵盖的内容

*第一章*，*Java 内存的不同部分*，涵盖了 Java 内存的不同部分：栈、堆和元空间。我们将从栈内存以及变量如何在栈上存储开始。然后，我们将继续处理对象以及它们如何在堆上存储。接下来，我们将简要讨论访问原始类型和对象。最后，我们将描述元空间及其用途。

*第二章*，*Java 内存中的基本类型和对象*，聚焦于 Java 内存中的基本类型和对象。我们将更详细地处理堆和栈。通过使用可视化，我们将展示 Java 程序执行过程中栈和堆内存发生的情况。一旦内存管理的基本原理清晰，我们将更详细地处理对象引用。我们解释了当 Java 的按值调用机制应用于引用时，如何导致一个称为**逃逸引用**的安全问题。我们讨论了如何解决这个问题。

*第三章*，*聚焦堆空间*，关注堆空间的不同部分。它有两个主要区域：年轻代空间和持久代空间。年轻代空间包含两个独立区域：eden 空间和幸存者空间。本章不会深入探讨垃圾收集过程，但我们会简要提及它以及它是如何解释对象在空间之间晋升的。我们将添加堆和不同区域的可视化，以提供有关堆空间详细信息的清晰度。本章的内容对于理解下一章将要讨论的垃圾收集算法是必要的。

*第四章*，*通过垃圾收集释放内存*，深入探讨堆上对象的释放。为了使应用程序能够继续运行，释放内存是必要的。如果没有释放内存的能力，我们只能分配一次，最终会耗尽内存。在本章中，我们处理堆空间中的对象何时适合进行垃圾收集以及垃圾收集器经过哪些阶段。我们将以尽可能直观的方式结束对垃圾收集器不同实现的讨论。

*第五章*，*聚焦元空间*，涉及元空间，它是 JVM 用于类元数据和例如静态变量的。这些元数据在类加载时被存储。我们将描述类加载过程以及内存的分配。释放元空间内存与释放堆内存略有不同。这个过程也将在此处描述。

*第六章*，*配置和监控 JVM 的内存管理*，解释了如何开始 JVM 调优。首先，我们将描述 JVM 调优是什么以及谁需要它。有几个指标与 JVM 内存管理调优相关。我们将检查这些指标以及如何获取它们。最后，我们将结束实际的 JVM 配置调整和如何使用分析来深入了解调优效果。

*第七章*，*避免内存泄漏*，讨论了如何有效地使用内存以及如何发现和解决内存泄漏。当内存中保留不再需要的对象时，我们就会得到内存泄漏。一开始，这可能看似无害，但久而久之，它将减慢应用程序的速度，并且应用程序需要重新启动才能正常工作。在本章中，我们将确保读者理解内存泄漏并知道如何发现它们。我们将以导致内存泄漏的非常常见的错误以及如何避免它们结束。

# 为了充分利用本书

本书假定使用 Java 8 或更高版本。不需要特定的操作系统或 IDE。如果您计划亲自运行示例，那么 VisualVM（用于监控 Java 应用程序内存的视觉工具）将很有用。

如果您目前系统上没有安装任何东西，以下设置就足够了：

+   JDK 8 或更高版本（Oracle 的 JDK 或 OpenJDK）

+   IntelliJ IDEA（社区版就足够了）或 Eclipse

+   VisualVM

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Java 8+ | Windows、macOS 或 Linux |

**如果您正在使用这本书的数字版，我们建议您亲自输入代码或从书的 GitHub 仓库（下一节中有一个链接）获取代码。这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误**。

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/B18762_Java-Memory-Management`](https://github.com/PacktPublishing/B18762_Java-Memory-Management)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还从丰富的图书和视频目录中提供了其他代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/OeQqF`](https://packt.link/OeQqF)。

# 使用约定

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“例如，`int x;` 定义（创建）了一个原始变量 `x`，其类型为（原始类型）`int`。”

代码块设置如下：

```java
Object o = new Object();
```

```java
System.out.println(o);
```

```java
o = null;
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```java
Object o = new Object();
```

```java
System.out.println(o);
```

```java
o = null;
```

任何命令行输入或输出都如下所示：

java.lang.Object@4617c264

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词会以**粗体**显示。以下是一个示例：“在**创建**按钮旁边有一个**创建另一个**选项。”

小贴士或重要注意事项

看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果你对本书的任何方面有疑问，请通过电子邮件发送给我们，邮箱地址为 customercare@packtpub.com，并在邮件主题中提及书名。

**勘误表**：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果你在这本书中发现了错误，我们将不胜感激，如果你能向我们报告这个错误。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果你在互联网上发现我们作品的任何形式的非法副本，如果你能提供位置地址或网站名称，我们将不胜感激。请通过电子邮件发送给我们，邮箱地址为 copyright@packt.com，并附上材料的链接。

**如果你有兴趣成为作者**：如果你在某个领域有专业知识，并且有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享你的想法

一旦你阅读了《Java 内存管理》，我们很乐意听听你的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1801812853)并分享你的反馈。

你的评论对我们和科技社区都很重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

你喜欢在路上阅读，但无法携带你的印刷书籍到处走？

你的电子书购买是否与您选择的设备不兼容？

不要担心，现在，每购买一本 Packt 书籍，你都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从你最喜欢的技术书籍中搜索、复制和粘贴代码到你的应用程序中。

优惠不会就此停止，你还可以获得独家折扣、时事通讯和每日免费内容的每日电子邮件。

按照以下简单步骤获取福利：

1.  扫描下面的二维码或访问以下链接

![](img/B18762_QR_Free_PDF.jpg)

https://packt.link/free-ebook/9781801812856

1.  提交你的购买证明

1.  就这样！我们将直接将您的免费 PDF 和其他福利发送到您的电子邮件地址。
