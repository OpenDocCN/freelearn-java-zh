# 第一章. 关键特性

在简要介绍 Apache Camel 是什么之后，本章将介绍 Camel 提供的关键特性。它仅提供了这些特性的概述；详细信息将在专门的章节中介绍。

在企业中，您在 IT 生态系统中会看到许多不同的软件和系统。为了整合数据和同步系统，企业希望实现这些系统的通信和集成。这种通信或集成并不容易，因为我们必须处理每个系统的规范，协议和消息的数据格式通常都不同，因此我们必须转换和适应每个系统。

使用点对点通信是一种选择。然而，这种方法的缺点是我们紧密集成了几个系统。切换到其他系统或协议需要重构实现。此外，使用点对点处理多个系统并不容易。

因此，我们不是使用点对点，而是使用中介。中介通过在系统之间添加和使用一个层（中间人）来减少复杂性，并提供了一种更灵活的方法。目的是促进信息流和系统的集成。

Apache Camel 是一个中介框架。

# 什么是 Apache Camel？

Apache Camel 起源于 Apache ServiceMix。Apache ServiceMix 3 由 Spring 框架提供支持，并按照 JBI 规范实现。**Java 业务集成**（**JBI**）规范提出了一种即插即用的集成方法。JBI 基于 Web 服务概念和标准。例如，它直接重用了来自**Web 服务描述语言**（**WSDL**）的**消息交换模式**（**MEP**）概念。

Camel 重用了这些概念中的一些，例如，您会看到我们在 Camel 中有 MEP 的概念。

然而，JBI 主要面临两个问题：

+   在 JBI 中，所有端点之间的消息都在**标准化消息路由器**（**NMR**）中传输。

    在核磁共振（NMR）中，消息具有标准的 XML 格式。由于 NMR 中的所有消息都具有相同的格式，因此审计消息和预测格式都很简单。

    然而，JBI 的 XML 格式在性能上有一个重要的缺点：它需要序列化和反序列化消息。一些协议（如 REST 或 RMI）在 XML 中描述起来并不容易。

    例如，REST 可以在流模式下工作。在 XML 中序列化流是没有意义的。

    Camel 对有效载荷不敏感。这意味着您可以使用 Camel 传输任何类型的消息（不一定是 XML 格式）。

+   JBI 描述了一个包装。我们区分绑定组件（负责与 NMR 外部的系统交互以及处理 NMR 中的消息），以及服务引擎（负责在 NMR 内部转换消息）。

    然而，基于这些组件直接部署端点是不可能的。JBI 要求每个端点一个服务单元（一个 ZIP 文件），以及每个服务组装中的每个包（另一个 ZIP 文件）。JBI 还将端点的描述与其配置分开。

    这并不会导致一个非常灵活的打包：由于定义和配置分散在不同的文件中，不易维护。在 Camel 中，端点的配置和定义被收集在一个简单的 URI 中。它更容易阅读。

    此外，Camel 不强制任何打包；相同的定义可以打包在一个简单的 XML 文件、OSGi 捆绑包和常规 JAR 文件中。

除了 JBI，Camel 的另一个基础是 Gregor Hohpe 和 Bobby Woolf 合著的书籍《企业集成模式》。

本书描述了设计模式，这些模式在处理企业应用集成和面向消息的中间件时解决经典问题。

本书描述了问题和解决这些问题的模式。Camel 力求实现书中描述的模式，使它们易于使用，让开发者专注于手头的任务。

这就是 Camel：一个开源框架，允许你集成系统，并且自带许多连接器和**企业集成模式**（**EIP**）组件。如果还不够，还可以扩展和实现自定义组件。

# 组件和 bean 支持

Apache Camel 自带了大量的组件；目前，有超过 100 个组件可用。

我们可以看到：

+   允许外部系统暴露端点或与外部系统通信的连接性组件。例如，FTP、HTTP、JMX、WebServices、JMS 以及许多其他组件都是连接性组件。通过直接使用 URI，为这些组件创建端点和相关的配置非常简单。

+   应用内部规则到 Camel 消息内部的内部组件。这类组件对飞行中的消息应用验证或转换规则。例如，验证或 XSLT 是内部组件。

多亏了这一点，Camel 带来了一个非常强大的连接性和中介框架。

此外，创建新的自定义组件非常简单，允许你在默认组件集不符合你的要求时扩展 Camel。

通过创建自己的处理器和重用你的 bean，实现复杂的集成逻辑也非常容易。Camel 支持 bean 框架（IoC），如 Spring 或 Blueprint。

# 谓词和表达式

正如我们稍后将要看到的，大多数 EIP 需要一个规则定义来将路由逻辑应用到消息上。规则使用表达式来描述。

这意味着我们不得不在企业集成模式中定义表达式或谓词。一个表达式返回任何类型的值，而一个谓词只返回真或假。

Camel 支持许多不同的语言来声明表达式或谓词。它不会强迫您使用其中之一，而是允许您使用最合适的一种。

例如，Camel 支持 xpath、mvel、ognl、python、ruby、PHP、JavaScript、SpEL（Spring 表达式语言）、Groovy 等作为表达式语言。它还提供了易于使用的本地 Camel 预构建函数和语言，例如 header、constant 或简单语言。

# 数据格式和类型转换

Camel 对有效载荷是中立的。这意味着它可以支持任何类型的信息。根据端点，可能需要从一种格式转换为另一种格式。这就是为什么 Camel 支持不同的数据格式，以可插拔的方式。这意味着 Camel 可以在给定的格式中打包或解包消息。例如，除了标准的 JVM 序列化之外，Camel 本地支持 Avro、JSON、protobuf、JAXB、XmlBeans、XStream、JiBX、SOAP 等。

根据端点和您的需求，您可以在消息处理过程中显式定义数据格式。另一方面，Camel 知道端点的预期格式和类型。正因为如此，Camel 会寻找类型转换器，允许隐式地将消息从一种格式转换为另一种格式。

您也可以在消息处理过程中的某些点显式定义您选择的类型转换器。Camel 提供了一套现成的类型转换器，但作为 Camel 支持可插拔模型，您可以通过提供自己的类型转换器来扩展它。这是一个简单的 POJO 实现。

# 易于配置和 URI

Camel 使用基于 URI 的不同方法。端点及其配置都在 URI 上。

URI 是人类可读的，并提供了端点的详细信息，包括端点组件和端点配置。

由于此 URI 是完整配置的一部分（它定义了我们稍后将命名的路由，正如我们将看到的），因此可以一行内获得集成逻辑和连接的完整概述。我们将在第二章*核心概念*中详细讨论这一点。

# 轻量级和不同的部署拓扑

Camel 本身非常轻量。Camel 核心仅约 2 MB，包含运行 Camel 所需的一切。由于它基于可插拔架构，所有 Camel 组件都作为外部模块提供，允许您仅安装所需的模块，而无需安装多余的、不必要的重模块。

正如我们所见，Camel 基于简单的 POJO，这意味着 Camel 核心不依赖于其他框架：它是一个原子框架，并准备好使用。所有其他模块（组件、DSL 等）都是建立在 Camel 核心之上的。

此外，Camel 并不局限于一个容器进行部署。Camel 支持广泛的容器来运行。它们如下所示：

+   一个 J2EE 应用服务器，如 WebSphere、WebLogic、JBoss 等

+   一个 Web 容器，如 Apache Tomcat

+   Apache Karaf 等 OSGi 容器

+   使用 Spring 等框架的独立应用程序

Camel 提供了很大的灵活性，允许您将其嵌入到您的应用程序中或使用企业级容器。

# 快速原型设计和测试支持

在任何集成项目中，通常我们有一些集成逻辑尚未可用。例如：

+   要集成的应用程序尚未购买或尚未准备就绪

+   要集成的远程系统成本高昂，在开发阶段不可接受

+   多个团队并行工作，因此我们可能在团队之间遇到某些类型的死锁

作为完整的集成框架，Camel 提供了一种非常简单的方式来原型化集成逻辑的一部分。即使您没有实际的集成系统，您也可以模拟这个系统（模拟），因为它允许您在不等待依赖项的情况下实现集成逻辑。模拟支持是 Camel 核心的直接部分，不需要任何额外的依赖。

同样，在集成项目中，测试也非常关键。在这种类型的项目中，可能会发生许多错误，其中大多数是未预见的。此外，集成过程中的微小变化可能会影响许多其他过程。Camel 提供了工具，可以轻松测试您的设计和集成逻辑，并允许您将其集成到持续集成平台中。

# 使用 JMX 进行管理和监控

Apache Camel 使用 Java 管理扩展 (JMX) 标准，并通过 MBeans（管理豆）提供了对系统的深入了解，以下是对当前系统的详细视图：

+   与相关指标关联的不同集成过程

+   与相关指标关联的不同组件和端点

此外，这些 MBeans 提供的见解比指标更多。它们还提供了管理 Camel 的操作。例如，这些操作允许您停止集成过程，挂起端点等。通过结合指标和操作，您可以配置一个非常灵活的集成解决方案。

# 活跃的社区

Apache Camel 社区非常活跃。这意味着潜在问题可以很快被发现，并且很快就有修复方案。然而，这也意味着提出了许多想法和贡献，为 Camel 增加了越来越多的功能。

活跃社区的另一大优势是您永远不会孤单；邮件列表上有很多人活跃，他们准备好回答您的问题并提供建议。

Apache Camel 是一个在企业组织中广泛使用的企业集成解决方案，通过 RedHat 或 Talend 提供企业级支持。

# 摘要

本章简要介绍了 Camel 及其来源。主要介绍了 Camel 的关键特性。在下一章中，在详细处理这些特性之前，我们将介绍 Camel 的核心概念，这将有助于您轻松理解后续章节。
