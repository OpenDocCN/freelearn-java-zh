# 第九章：最佳实践和通用原则

在你为了获得开发微服务样本项目的经验而付出了艰辛努力之后，你可能会想知道如何避免常见错误并改进开发基于微服务的产品和服务的过程。我们可以遵循这些原则或指南来简化微服务开发的过程并避免/减少潜在的限制。我们将在本章重点关注这些关键概念。

本章分为以下三个部分：

+   概述和心态

+   最佳实践和原则

+   微服务框架和工具

# 概述和心态

你可以在新旧产品和服务的背景下实现微服务-based 设计。与认为从头开始开发和设计新系统比修改一个已经在运行的现有系统更容易的观点相反，每种方法都有其各自的挑战和优点。

例如，由于新产品或服务不存在现有的系统设计，你有自由和灵活性去设计系统，而不必考虑其影响。然而，你对于新系统的功能和系统要求并不清晰，因为这些随着时间成熟并逐渐成形。另一方面，对于成熟的产品和服务，你对功能和系统要求有详细的知识和信息。然而，你有一个挑战，那就是减轻设计更改带来的风险影响。因此，当涉及到将生产系统从单体应用更新为微服务时，你需要比如果你正在构建一个系统时计划得更好。

从零开始。

有经验的成功的软件设计专家和架构师总是评估利弊，并且对现有运行系统做任何更改时都持谨慎态度。绝不应该仅仅因为某种设计可能很酷或者时髦就对其进行更改。因此，如果你想将现有生产系统的设计更新为微服务，在做出这个决定之前你需要评估所有的利弊。

我相信单体系统提供一个很好的平台升级到成功的微服务设计。显然，我们这里不讨论成本。你对现有系统和功能有足够的了解，这使你能够将现有系统分割并基于功能以及这些如何相互交互构建微服务。另外，如果你的单体产品已经以某种方式模块化，那么通过暴露 API 而不是**应用程序二进制接口**（**ABI**）直接转换微服务可能是实现微服务架构的最简单方式。成功的基于微服务的系统更依赖于微服务和它们之间的交互协议，而不是其他任何东西。

说到这里，并不意味着如果您从头开始，就不能拥有一个成功的基于微服务的系统。然而，建议基于单体设计的新项目，这为您提供了系统的视角和理解功能。它允许您快速找到瓶颈，并指导您识别任何可以用微服务开发的有潜力的特性。在这里，我们没有讨论项目的规模，这是另一个重要的因素。我们将在下一节中讨论这一点。

在当今的云计算时代和敏捷开发世界中，从任何更改到更改上线通常只需要一个小时。在当今竞争激烈的环境中，每个组织都希望拥有快速将功能交付给用户的优势。持续开发、集成和部署是生产交付过程的一部分，这是一个完全自动化的过程。

如果您提供基于云的产品或服务，那么基于微服务的系统使团队能够敏捷地响应修复任何问题或向用户提供新功能。

因此，在决定从头开始一个新的基于微服务的项目，或者计划将现有单体系统的设计升级为基于微服务的系统之前，您需要评估所有的利弊。您必须倾听并理解团队分享的不同想法和观点，并采取谨慎的方法。

最后，我想分享拥有更好的流程和高效系统对于成功生产系统的重要性。拥有基于微服务的系统并不能保证成功的生产系统，而单体应用程序并不意味着在今天这个时代你不能拥有一个成功的生产系统。Netflix，一个基于微服务的云视频租赁服务，和 Etsy，一个单体电子商务平台，都是成功生产系统的例子（在章节的*参考文献*部分，您可以看到一个有趣的 Twitter 讨论链接）。因此，流程和敏捷也是成功生产系统的关键。

# 最佳实践和原则

正如我们在第一章所学习到的，微服务是一种实现**面向服务架构**（**SOA**）的轻量级风格。除此之外，微服务并没有严格定义，这给了你开发微服务的灵活性，按照你想要的和需求来开发。同时，你需要确保遵循一些标准实践和原则，使你的工作更容易，并成功实施基于微服务的架构。

# 纳米服务、规模和单体

您项目中的每个微服务都应该体积小，并执行一个功能或特性（例如，用户管理），独立到足以自行执行该功能。

来自 Mike Gancarz（设计 X Window 系统的成员）的以下两句话，定义了 Unix 哲学的一个首要原则，也适用于微服务范式：

“小即是美。”

“让每个程序做好一件事。”

现在，我们如何定义在今天这个时代的大小，当你有一个框架（例如 Finangle）来减少**代码行数**（**LOC**）时？此外，许多现代语言，如 Python 和 Erlang，都较为简洁。这使得决定是否要将此代码微服务化变得困难。

显然，你可能为少量的代码行实现一个微服务；这实际上不是一个微服务，而是一个纳米服务。

Arnon Rotem-Gal-Oz 将纳米服务定义如下：

“纳米服务是一个反模式，其中服务过于细粒度。纳米服务是一个其开销（通信、维护等）超过其效用的服务。”

因此，基于功能设计微服务总是有意义的。领域驱动设计使在领域层面定义功能变得更容易。

如前所述，您项目的规模是在决定是否实施微服务或确定您想要为项目拥有的微服务数量时的一个关键因素。在一个简单的小型项目中，使用单体架构是有意义的。例如，基于我们在第三章学到的领域设计，*领域驱动设计*，你会清楚地了解你的功能性需求，并使事实可用以绘制各种功能或特性之间的边界。例如，在我们已经实施的示例项目（在线表格预订系统；OTRS）中，只要你不希望向客户暴露 API，或者你不想将其作为 SaaS 使用，或者在你做出决定之前有许多类似的参数需要评估，使用单体设计开发相同的项目是非常容易的。

您可以稍后将在单体项目中迁移到微服务设计，当时机到来时。因此，重要的是您应该以模块化方式开发单体项目，并在每个层次和层面上实现松耦合，并确保不同功能和特性之间有预定义的接触点和边界。此外，您的数据源（如数据库）应相应地设计。即使您不打算将项目迁移到基于微服务的系统，这也将使故障修复和功能改进更容易实施。

关注前面的点将减轻您在迁移到微服务时可能遇到的任何可能的困难。

通常，大型或复杂的项目应该使用基于微服务的架构进行开发，因为它提供了许多优势，如前几章所讨论的。

我甚至建议将你的初始项目开发为单块应用；一旦你更好地理解了项目的功能和项目复杂性，然后你再将其迁移到微服务。理想情况下，一个开发好的初始原型应该为你提供功能边界，这将使你能够做出正确的选择。

# 持续集成和部署

你必须有一个持续集成和部署的过程。它让你能够更快地交付更改并尽早发现错误。因此，每个服务应该有自己的集成和部署过程。此外，它必须是自动化的。有许多工具可供选择，如 Teamcity、Jenkins 等，这些工具被广泛使用。它帮助你自动化构建过程——这可以尽早捕获构建失败，特别是当你将你的更改与主分支（如任何发布分支/标签或主分支）集成时。

你还可以将你的测试集成到每个自动化集成和部署过程中。**集成测试**测试系统的不同部分之间的交互，如两个接口（API 提供者和消费者）之间，或系统中的不同组件或模块之间，如 DAO 和数据库之间等。集成测试很重要，因为它测试模块之间的接口。首先，在孤立状态下测试单个模块。然后，执行集成测试以检查组合行为并验证需求是否正确实现。因此，在微服务中，集成测试是验证 API 的关键工具。我们将在下一节中详细介绍这一点。

最后，你可以在 CD（持续部署）机器上看到主分支的最新更改，该过程在这里部署构建。

这个过程并不会到此结束：你可以创建一个容器，比如 Docker，然后将其交给你的 WebOps 团队，或者有一个单独的过程，将其送到一个配置好的位置或者部署到 WebOps 阶段环境。从这里，一旦得到指定权限的批准，它就可以直接部署到你的生产系统。

# 系统/端到端测试自动化

测试是任何产品和服务的交付中的一个非常重要的部分。你不希望向客户交付有缺陷的应用程序。在过去，当瀑布模型流行时，一个组织在向客户交付之前，测试阶段通常需要 1 到 6 个月或更长时间。近年来，在敏捷过程变得流行之后，更加重视自动化。与先前的点测试类似，自动化也是强制性的。

无论你是否遵循**测试驱动开发**（**TDD**），我们必须要有系统或端到端的自动化测试。测试你的业务场景非常重要，端到端测试也同样如此，它可能从你的 REST 调用开始，到数据库检查，或者从 UI 应用程序开始，到数据库检查。

如果你有公开的 API，测试你的 API 也很重要。

这样做可以确保任何更改都不会破坏任何功能，并确保无缝、无 bug 的生产交付。如上节所述，每个模块都通过单元测试进行隔离测试，以检查一切是否按预期工作，然后在不同模块之间执行集成测试，以检查预期的组合行为并验证需求是否正确实现。集成测试后，执行功能测试，以验证功能和特性需求。

所以，如果单元测试确保孤立状态下单个模块运行良好，那么集成测试确保不同模块之间的交互按预期工作。如果单元测试正常工作，那么集成测试失败的概率大大降低。同样，集成测试确保功能测试很可能成功。

假设我们总是保持所有类型的测试更新，无论是单元级测试还是端到端的测试场景。

# 自我监控和日志记录

一个微服务应当提供关于自身及其所依赖的各种资源状态的服务信息。服务信息包括诸如处理请求的平均、最小和最大时间、成功和失败的请求数量、能够追踪请求、内存使用情况等统计数据。

在 2015 年的 Glue Conference（Glue Con）上，Adrian Cockcroft 强调了几个对于监控微服务非常重要的实践。其中大多数对于任何监控系统都是有效的：

+   在分析指标意义的代码上花费更多时间，而不是在收集、移动、存储和显示指标的代码上。这不仅有助于提高生产力，还提供重要的参数来微调微服务并提高系统效率。想法是开发更多的分析工具，而不是开发更多的监控工具。

+   显示延迟的指标需要小于人类的注意力跨度。这意味着根据 Adrian 的说法，小于 10 秒。

+   验证您的测量系统具有足够的准确性和精度。收集响应时间的直方图。

+   准确的数据使决策更快，并允许您进行微调，直到达到精确度级别。他还建议，最好显示响应时间的图表是直方图。

+   监控系统需要比被监控的系统更具可用性和可扩展性。

+   这个说法说明了一切：你不能依赖一个本身不稳定或不是 24/7 可用的系统。

+   针对分布式、短暂、云原生、容器化的微服务进行优化。

+   将指标适合模型以理解关系。

监控是微服务架构的关键组成部分。根据项目规模，你可能会有几十个到几千个微服务（对于一个大企业的重大项目来说确实如此）。即使是为了扩展和高可用性，组织也会为每个微服务创建一个集群或负载均衡的池/容器，甚至根据版本为每个微服务创建单独的池。最终，这增加了你需要监控的资源数量，包括每个微服务实例。此外，重要的是你有一个流程，以便在任何事情出错时立即知道，或者更好的是，在事情出错之前收到警告通知。因此，构建和使用微服务架构的有效和高效的监控至关重要。Netflix 使用诸如 Netflix Atlas（处理 12 亿个指标的实时运营监控）、Security Monkey（用于监控基于 AWS 环境的网络安全）、Scumblr（情报收集工具）和 FIDO（用于分析事件和自动事件报告）等工具进行安全监控。

日志是微服务中不应忽视的重要方面。有效的日志记录至关重要。由于可能有 10 个或更多的微服务，管理日志记录是一项巨大的任务。

对于我们的示例项目，我们使用了**映射诊断上下文**（**MDC**）日志记录，这在某种程度上足以满足单个微服务的日志记录。然而，我们还需要整个系统或集中日志记录的日志记录。我们还需要日志的聚合统计数据。有一些工具可以完成这项工作，例如 Loggly 或 Logspout。

请求和生成的相关事件为您提供了请求的整体视图。对于任何事件和请求的跟踪，将事件和请求与服务 ID 和请求 ID 分别关联非常重要。你还可以将事件的内容，如消息、严重性、类名等，与服务 ID 相关联。

# 每个微服务单独的数据存储

如果你还记得，微服务最重要的特征之一是你可以了解微服务如何与其他微服务隔离运行，最常见的是作为独立的应用程序。

遵循这一规则，建议你不要在多个微服务之间使用相同的数据库或任何其他数据存储。在大型项目中，你可能有不同的团队在同一个项目中工作，你希望每个微服务都能选择最适合自己的数据库。

现在，这也带来了一些挑战。

例如，以下内容与可能在同一项目中工作在不同微服务上的团队相关，如果该项目共享相同的数据库结构。一种可能性是，一个微服务的更改可能会影响另一个微服务的模型。在这种情况下，一个更改可能会影响依赖性微服务，所以你还需要更改依赖性模型结构。

为了解决这个问题，微服务应该基于一个 API 驱动的平台进行开发。每个微服务都会暴露出自己的 API，其他微服务可以消费这些 API。因此，你还需要开发 API，这是不同微服务集成的必要条件。

同样，由于不同的数据存储，实际项目数据也分布在多个数据存储中，这使得数据管理更加复杂，因为不同的存储系统更容易失去同步或变得不一致，外键也可能意外地改变。为了解决这个问题，你需要使用**主数据管理**（**MDM**）工具。MDM 工具在后台运行，如果发现任何不一致性，会进行修复。对于 OTRS 示例，它可能会检查存储预订请求 ID 的每个数据库，以验证它们中都存在相同的 ID（换句话说，任何数据库中都没有缺失或额外的 ID）。市场上的 MDM 工具包括 Informatica、IBM MDM 高级版、Oracle Siebel UCM、Postgres（主流复制）、mariadb（主/主配置）等。

如果现有的产品都不符合你的要求，或者你对任何专有产品都不感兴趣，那么你可以自己编写。目前，API 驱动的开发和平台减少了这种复杂性；因此，微服务沿着 API 平台开发是非常重要的。

# 交易边界

我们在第三章中讨论了领域驱动设计概念，*领域驱动设计*。如果你没有完全掌握它，请复习这一部分，因为它能让你从垂直角度理解状态。由于我们关注的是基于微服务的设计，结果是我们有一个系统系统，每个微服务代表一个系统。在这种环境中，在任何给定时间找到整个系统的状态是非常具有挑战性的。如果你熟悉分布式应用，那么你可能会在这种环境中对状态感到舒适。

确立交易边界非常重要，这些边界描述了在任何给定时间哪个微服务拥有一个消息。你需要一种或一种参与事务、交易路由、错误处理程序、幂等消费者和补偿操作的方式。确保跨异质系统的一致性行为并非易事，但市场上有一些工具可以为你完成这项工作。

例如，Camel 具有出色的事务功能，可以帮助开发者轻松创建具有事务行为的服务。

# 微服务框架和工具

最好还是不要重新发明轮子。因此，我们想探讨一下市场上已经有哪些工具，并提供使微服务开发和部署更简单的平台、框架和特性。

在整个书籍中，我们广泛使用了 Spring Cloud，原因相同：它提供了构建微服务所需的所有工具和平台。Spring Cloud 使用 Netflix **开源软件**（**OSS**）。让我们来探索一下 Netflix OSS——一个完整的套餐。

我还添加了关于每个工具如何帮助构建良好的微服务架构的简要概述。

# Netflix 开源软件（OSS）

Netflix OSS 中心是 Java 基础微服务开源项目中最受欢迎和广泛使用的开源软件。世界上最成功的视频租赁服务依赖于它。Netflix 有超过 4000 万用户，并在全球范围内使用。Netflix 是一个纯基于云的解决方案，基于微服务架构开发。可以说，每当有人谈论微服务时，Netflix 是首先出现在脑海中的名字。让我们讨论它提供的各种工具。在开发示例 OTRS 应用程序时，我们已经讨论了许多工具。然而，还有一些我们没有探索过。在这里，我们只对每个工具进行概述，而不是深入讨论。这将为您提供微服务架构的实用特性和在云中使用它的整体概念。

# 构建 - Nebula

Netflix Nebula 是一组使您使用 Gradle（类似 Maven 的构建工具）构建微服务变得更加容易的 Gradle 插件。对于我们的示例项目，我们使用了 Maven，因此我们在这本书中没有机会探索 Nebula。然而，探索它是很有趣的。对于开发人员来说，Nebula 最重要的功能是消除了 Gradle 构建文件中的样板代码，这使得开发者可以专注于编码。

拥有一个好的构建环境，特别是 CI/CD（持续集成和持续部署）对于微服务开发和与敏捷开发保持一致是必须的。Netflix Nebula 使您的构建变得更容易、更高效。

# 部署和交付 - Spinnaker 与 Aminator

一旦您的构建准备好，您希望将该构建移动到 **亚马逊网络服务**（**AWS**）EC2。Aminator 创建并打包构建的镜像，形式为 **亚马逊机器镜像**（**AMI**）。Spinnaker 然后将这些 AMI 部署到 AWS。

Spinnaker 是一个高速度和效率的持续交付平台，用于发布代码更改。Spinnaker 还支持其他云服务，例如 Google 计算机引擎和 Cloud Foundry。

如果你想将最新的微服务构建部署到例如 EC2 的云环境中，Spinnaker 和 Aminator 可以帮助你以自主的方式完成。

# 服务注册和发现 - Eureka

如我们在本书中所探讨的，Eureka 提供了一个负责微服务注册和发现的服务。除此之外，Eureka 还用于负载均衡中间层（托管不同微服务的进程）。Netflix 也使用 Eureka，以及其他工具，如 Cassandra 或 memcached，以提高其整体可用性。

微服务架构中必须要有服务注册与发现。Eureka 就是为此目的而设计的。请参阅第四章，*实现微服务*，以获取有关 Eureka 的更多信息。

# 服务通信 - Ribbon

如果进程间或服务间没有通信，微服务架构就毫无用处。Ribbon 应用提供了这一特性。Ribbon 与 Eureka 一起实现负载均衡，与 Hystrix 一起实现故障容忍或断路器操作。

Ribbon 还支持除了 HTTP 以外的 TCP 和 UDP 协议，并提供这些协议支持异步和响应式模型。它还提供了缓存和批量处理功能。

由于您将在项目中拥有许多微服务，您需要一种使用进程间或服务间通信处理信息的方法。Netflix 为这一目的提供了 Ribbon 工具。

# 断路器 - Hystrix

Hystrix 工具用于断路器操作，即延迟和故障容忍。因此，Hystrix 阻止级联失败。Hystrix 执行实时操作，监控服务和属性变化，并支持并发。

断路器或故障容忍是任何项目的重要概念，包括微服务。一个微服务的失败不应该使您的整个系统停止；为了防止这种情况发生，并在失败时向客户提供有意义的信息，这是 Netflix Hystrix 的职责。

# 边缘（代理）服务器 - Zuul

Zuul 是一个边缘服务器或代理服务器，为 UI 客户端、Android/iOS 应用程序或任何第三方消费者提供 API。从概念上讲，它是外部应用程序的门户。

Zuul 允许动态路由和监控请求。它还执行安全操作，如身份验证。它可以识别每个资源的身份验证要求，并拒绝任何不满足它们的请求。

您需要一个边缘服务器或 API 网关来处理您的微服务。Netflix Zuul 提供了这一特性。请参阅第五章，*部署与测试*，以获取更多信息。

# 操作监控 - Atlas

Atlas 是一个操作监控工具，提供近实时的时间序列数据维度信息。它捕获操作智能，提供系统内部当前发生情况的图片。它具有内存数据存储功能，允许它快速收集和报告大量指标。目前，它为 Netflix 处理了 13 亿个指标。

Atlas 是一个可扩展的工具。这就是为什么它现在可以处理 13 亿个指标，而几年前只有 100 万个指标。Atlas 不仅在读取数据方面提供可扩展性，而且在作为图表请求一部分进行聚合方面也提供可扩展性。

Atlas 使用了 Netflix Spectator 库来记录维度时间序列数据。

一旦你在云环境中部署了微服务，你就需要有一个监控系统来跟踪和监控所有的微服务。Netflix Atlas 为你完成了这项工作。

# 可靠性监控服务 - Simian Army

在云环境中，没有任何单一组件能保证 100% 的正常运行时间。因此，成功的微服务架构的要求是在一个云组件失败的情况下使整个系统可用。Netflix 开发了一个名为 Simian Army 的工具来避免系统失败。Simian Army 保持了云环境的安全、安全和高可用性。为了实现高可用性和安全性，它使用了各种服务（猴子）在云中产生各种故障、检测异常情况，并测试云应对这些挑战的能力。

它使用了以下服务（猴子），这些服务来自 Netflix 的博客：

+   **Chaos Monkey**：Chaos Monkey 是一个服务，它识别出一组系统，并在一组中的一个系统随机终止。该服务在受控的时间和间隔内运行。Chaos Monkey 只在正常工作时间运行，目的是让工程师保持警觉并能够响应。

+   **Janitor Monkey**：Janitor Monkey 是一个在 AWS 云中运行的服务，寻找未使用的资源进行清理。它可以扩展到与其他云提供商和云资源一起工作。服务的日程是可配置的。Janitor Monkey 通过对其应用一组规则来确定资源是否应该成为清理候选资源。如果任何规则确定资源是清理候选资源，Janitor Monkey 将标记该资源，并安排一个时间进行清理。在特殊情况下，在 Janitor Monkey 删除资源之前，你想保留一个未使用的资源更长时间，资源所有者会在清理时间前 configurable 天收到通知。

+   **Conformity Monkey**：Conformity Monkey 是一个在 AWS 云中运行的服务，寻找不符合最佳实践预定义规则的实例。它可以扩展到与其他云提供商和云资源一起工作。服务的日程是可配置的。如果任何规则确定该实例不符合，猴子会向实例所有者发送电子邮件通知。在某些特殊情况下，你可能想忽略特定的一致性规则的警告。

+   **安全猴**：安全猴监控 AWS 账户中的策略更改和对不安全配置的警报。安全猴的主要目的是安全，尽管它也是一个跟踪潜在问题的有用工具，因为它本质上是一个变更跟踪系统。

成功的微服务架构确保你的系统始终运行，单个云组件的故障不应该导致整个系统失败。Simian Army 使用许多服务来实现高可用性。

# AWS 资源监控 - Edda

在云环境中，一切都是动态的。例如，虚拟主机实例经常变化，IP 地址可能被各种应用程序重复使用，或者发生防火墙等相关变化。

Edda 是一个跟踪这些动态 AWS 资源的服务的服务。Netflix 将其命名为 Edda（意为*北欧神话传说*），因为它记录了云管理和部署的传说。Edda 使用 AWS API 轮询 AWS 资源并记录结果。这些记录允许你搜索并查看云如何随时间变化。例如，如果 API 服务器的任何主机出现问题，那么你需要找出那个主机是哪个团队负责的。

它提供以下功能：

+   **动态查询**：Edda 提供了 REST API，并支持矩阵参数，提供字段选择器，让你只检索所需的数据。

+   **历史**/变更：Edda 维护了所有 AWS 资源的历史记录。这些信息有助于分析停机的原因和影响。Edda 还可以提供关于资源当前和历史信息的不同的视图。在撰写本文时，它将信息存储在 MongoDB 中。

+   **配置**：Edda 支持许多配置选项。通常，你可以从多个账户和多个区域轮询信息，并可以使用账户和区域的组合来指定位点。同样，它为 AWS、Crawler、Elector 和 MongoDB 提供不同的配置。

如果你正在使用 AWS 来托管基于微服务的产品，那么 Edda 起到了监控 AWS 资源的作用。

# 主机上性能监控 - Vector

Vector 是一个静态的网页应用程序，在网页浏览器内运行。它允许监控安装了**性能共乘**（**PCP**）的主机的表现。Vector 支持 PCP 3.10+ 版本。PCP 收集指标并将其提供给 Vector。

它提供高分辨率的即时指标。这有助于工程师了解系统如何表现，并正确诊断性能问题。

Vector 是一个帮助你监控远程主机性能的工具。

# 分布式配置管理 - Archaius

Archaius 是一个分布式配置管理工具，它允许你执行以下操作：

+   使用动态和类型化的属性。

+   执行线程安全的配置操作。

+   使用轮询框架检查属性变更。

+   在配置的有序层次结构中使用回调机制。

+   使用 JConsole 检查并操作属性，因为 Archaius 提供了 JMX MBean。

+   当您有一个基于微服务的产品时，需要一个好的配置管理工具。Archaius 帮助在分布式环境中配置不同类型的属性。

# Apache Mesos 调度器 - Fenzo

Fenzo 是 Apache Mesos 框架的 Java 编写的调度库。Apache Mesos 框架匹配并分配资源给待处理任务。以下是其关键特性：

+   它支持长期运行的服务风格任务和批量任务。

+   它可以自动扩展执行主机集群，基于资源需求。

+   它支持插件，您可以根据需求创建。

+   您可以监控资源分配失败，这使您能够调试根本原因。

# 成本和云利用率 - Ice

Ice 从成本和使用角度提供了云资源的鸟瞰视图。它提供了关于为不同团队提供的最新云资源配置信息，这对于优化云资源的使用非常有价值。

Ice 是一个 grail 项目。用户与 Ice UI 组件交互，该组件显示通过 Ice reader 组件发送的信息。reader 从由 Ice processor 组件生成的数据中获取信息。Ice processor 组件从详细的云账单文件中读取数据信息，并将其转换为 Ice reader 组件可读取的数据。

# 其他安全工具 - Scumblr 和 FIDO

与 Security Monkey 一起，Netflix OSS 还利用了 Scumblr 和完全集成的防御操作（FIDO）工具。

为了跟踪并保护您的微服务免受常规威胁和攻击，您需要一种自动化的方式来确保并监控您的微服务。Netflix Scumblr 和 FIDO 为您完成这项工作。

# Scumblr

Scumblr 是一个基于 Ruby on Rails 的 Web 应用程序，允许您执行定期搜索，并针对识别的结果存储/采取行动。基本上，它收集情报，利用互联网范围内的针对性搜索浮出具体的安全问题以供调查。

Scumblr 利用 Workflowable 宝石允许为不同类型的结果设置灵活的工作流程。Scumblr 搜索使用称为“搜索提供者”的插件。它检查异常，例如以下异常。由于它是可扩展的，您可以添加尽可能多的异常：

+   妥协的凭据

+   漏洞/黑客讨论

+   攻击讨论

+   与安全相关的社交媒体讨论

# 完全集成的防御操作（FIDO）

FIDO 是一个安全编排框架，用于分析事件和自动化事件响应。它通过评估、评估和响应恶意软件来自动化事件响应过程。FIDO 的主要目的是处理评估当今安全堆栈中威胁和它们生成的大量警报所需的大量手动工作。

作为一个编排平台，FIDO 可以通过大幅减少检测、通知和响应网络攻击所需的手动努力，使您现有的安全工具更高效、更准确地使用。有关更多信息，您可以参考以下链接：

+   [`github.com/Netflix/Fido`](https://github.com/Netflix/Fido)

+   [`github.com/Netflix`](https://github.com/Netflix)

# 参考文献

+   单片式（Etsy）与微服务（Netflix）的 Twitter 讨论：[`twitter.com/adrianco/status/441169921863860225`](https://twitter.com/adrianco/status/441169921863860225)

+   由 Adrian Cockcroft 所做的《监控微服务和容器》演讲：[`www.slideshare.net/adriancockcroft/gluecon-monitoring-microservices-and-containers-a-challenge`](http://www.slideshare.net/adriancockcroft/gluecon-monitoring-microservices-and-containers-a-challenge)

+   纳米服务反模式：[`arnon.me/2014/03/services-microservices-nanoservices/`](http://arnon.me/2014/03/services-microservices-nanoservices/)

+   Apache Camel 用于微服务架构：[`www.javacodegeeks.com/2014/09/apache-camel-for-micro%C2%ADservice-architectures.html`](https://www.javacodegeeks.com/2014/09/apache-camel-for-micro%C2%ADservice-architectures.html)

+   Teamcity: [`www.jetbrains.com/teamcity/`](https://www.jetbrains.com/teamcity/)

+   Jenkins: [`jenkins-ci.org/`](https://jenkins-ci.org/)

+   Loggly: [`www.loggly.com/`](https://www.loggly.com/)

# 总结

在本章中，我们探讨了各种最适合微服务基础产品和服务最佳实践和原则。微服务架构是云环境的结果，与基于本地的大型单片系统相比，其应用越来越广泛。我们已经确定了几个与大小、敏捷性和测试有关的原则，这些原则对于成功实施至关重要。

我们已经对 Netflix OSS 使用的各种工具有了概述，这些工具是实现微服务架构基础产品和服务所需的各种关键特性。Netflix 提供视频租赁服务，成功使用了相同的工具。

在下一章中，读者可能会遇到问题，可能会困在这些问题上。本章解释了在微服务开发过程中遇到的常见问题及其解决方案。
