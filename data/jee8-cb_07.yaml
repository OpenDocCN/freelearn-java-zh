- en: Deploying and Managing Applications on Major Java EE Servers
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在主要 Java EE 服务器上部署和管理应用程序
- en: 'This chapter covers the following recipes:'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖了以下配方：
- en: Apache TomEE usage
  id: totrans-2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Apache TomEE 使用
- en: GlassFish usage
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GlassFish 使用
- en: WildFly usage
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: WildFly 使用
- en: Introduction
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简介
- en: One of the most important skills you should have as a Java EE developer is knowing
    how to work with the most used Java EE application servers in the market.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 作为 Java EE 开发者，您应该具备的最重要技能之一是了解如何与市场上最常用的 Java EE 应用服务器一起工作。
- en: As we've stated in previous chapters, the standards involved in the Java EE
    ecosystem allow you to reuse most of the knowledge you already have no matter
    which server you are using.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们在前面的章节中所提到的，Java EE 生态系统中的标准允许您无论使用哪个服务器，都可以重用您已经拥有的大部分知识。
- en: However, when we are talking about deployment and some administration tasks,
    things could be different (and usually are). The differences are not in the way
    they work, but in the way they are done.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，当我们谈论部署和一些管理任务时，事情可能会有所不同（通常都是）。这些差异不在于它们的工作方式，而在于它们执行的方式。
- en: So, in this chapter, we will cover some important and common tasks for Apache
    TomEE, GlassFish, and WildFly.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在本章中，我们将介绍 Apache TomEE、GlassFish 和 WildFly 的一些重要和常见任务。
- en: Apache TomEE usage
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Apache TomEE 使用
- en: If you have already used Apache Tomcat, you can consider yourself ready to use
    Apache TomEE. It is based on the Tomcat's core and implements the Java EE specs.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已经使用过 Apache Tomcat，您可以考虑自己准备好使用 Apache TomEE。它基于 Tomcat 的核心并实现了 Java EE
    规范。
- en: Getting ready
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: First, you need to download it to your environment. At the time of writing,
    TomEE has no Java EE 8 compatible version (actually, there is only GlassFish 5).
    However, the tasks covered here shouldn't change in future versions as they are
    not attached to the Java EE specs.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要将其下载到您的环境中。在撰写本文时，TomEE 没有与 Java EE 8 兼容的版本（实际上，只有 GlassFish 5）。然而，这里涵盖的任务在未来的版本中不应该改变，因为它们与
    Java EE 规范无关。
- en: To download it, just visit [http://tomee.apache.org/downloads.html](http://tomee.apache.org/downloads.html). This
    recipe in based on version 7.0.2 Plume.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要下载它，只需访问 [http://tomee.apache.org/downloads.html](http://tomee.apache.org/downloads.html)。此配方基于
    7.0.2 Plume 版本。
- en: Wherever possible, we will focus on doing tasks using the configuration files.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在可能的情况下，我们将专注于使用配置文件执行任务。
- en: How to do it...
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Refer to the following detailed tasks.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 参考以下详细任务。
- en: Deploying EAR, WAR, and JAR files
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署 EAR、WAR 和 JAR 文件
- en: 'For EAR and WAR files, the deployment folder is:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 EAR 和 WAR 文件，部署文件夹是：
- en: '`$TOMEE_HOME/webapps`'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '`$TOMEE_HOME/webapps`'
- en: 'For JAR files, the folder is:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 JAR 文件，文件夹是：
- en: '`$TOMEE_HOME/lib`'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '`$TOMEE_HOME/lib`'
- en: Creating datasources and a connection pool
  id: totrans-23
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建数据源和连接池
- en: To create a datasource and a connection pool to help you use databases in your
    project, edit the `$TOMEE_HOME/conf/tomee.xml` file.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 为了创建数据源和连接池以帮助您在项目中使用数据库，请编辑 `$TOMEE_HOME/conf/tomee.xml` 文件。
- en: 'Inside the `<tomee>` node, insert a child node like this one:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在 `<tomee>` 节点内部，插入如下子节点：
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The example targets PostgreSQL, so you will need to perform some changes for
    another database. Of course, you will also need to change the other parameters
    according to your needs.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 示例针对的是 PostgreSQL，因此您需要对其他数据库进行一些更改。当然，您还需要根据您的需求更改其他参数。
- en: Logging setup and rotate
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日志设置和轮转
- en: 'To configure the logging for Apache TomEE, edit the `$TOMEE_HOME/conf/logging.properties` file.
    The file works with handlers like this:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置 Apache TomEE 的日志记录，请编辑 `$TOMEE_HOME/conf/logging.properties` 文件。该文件使用类似以下的处理程序：
- en: '[PRE1]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: So, you can define the logging level, directory, and prefix according to your
    needs.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，您可以根据需要定义日志级别、目录和前缀。
- en: 'If you need to configure log rotation, just add these lines to your handler:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要配置日志轮转，只需将这些行添加到您的处理程序中：
- en: '[PRE2]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: In this example, we are defining this file to rotate on every 1024 kilobytes
    (1 MB) and keep the last 10 files on our disk.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们定义此文件在每 1024 千字节（1 MB）时旋转，并保留我们磁盘上的最后 10 个文件。
- en: Starting and stopping
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动和停止
- en: 'To start the Apache TomEE, just execute this script:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动 Apache TomEE，只需执行此脚本：
- en: '`$TOMEE_HOME/bin/startup.sh`'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '`$TOMEE_HOME/bin/startup.sh`'
- en: 'To stop it, execute the following script:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止它，执行以下脚本：
- en: '`$TOMEE_HOME/bin/shutdown.sh`'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '`$TOMEE_HOME/bin/shutdown.sh`'
- en: Session clustering
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 会话集群
- en: 'If you want to build a cluster using Apache TomEE nodes, you need to edit the `$TOMEE_HOME/conf/server.xml`
    file. Then, find this line:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想使用 Apache TomEE 节点构建集群，您需要编辑 `$TOMEE_HOME/conf/server.xml` 文件。然后，找到以下行：
- en: '[PRE3]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Insert a child node, like this:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 插入一个子节点，如下所示：
- en: '[PRE4]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: This block will set up your server to run in a dynamic discovery cluster. What
    this means is that every server that runs in the same network using this configuration
    will become a new member in the cluster and so will share the alive sessions.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 此块将设置服务器以在动态发现集群中运行。这意味着在相同网络中使用此配置运行的每个服务器都将成为集群的新成员，并共享活动会话。
- en: All these parameters are so important, so I really recommend you to keep all
    of them unless you are absolutely sure of what you are doing.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些参数都极其重要，所以我真心建议您保留所有这些参数，除非您绝对确定自己在做什么。
- en: There's more...
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: The best way to set up a Java EE cluster today is using containers (specially
    Docker containers). So, I'd recommend that you have a look at [Chapter 11](1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml),
    *Rising to the Cloud – Java EE, Containers, and Cloud Computing*. If you mix the
    content of that chapter with the content of this one, you will have a powerful
    environment for your application.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 目前设置Java EE集群的最佳方式是使用容器（特别是Docker容器）。因此，我建议您查看第11章，*迈向云端 – Java EE、容器和云计算*。如果您将本章内容与该章节内容相结合，将为您的应用程序提供一个强大的环境。
- en: 'To allow your application to share its session with all the nodes in the cluster,
    you need to edit the `web.xml` file, find the `web-app` node, and insert this:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 要允许您的应用程序与集群中的所有节点共享会话，您需要编辑`web.xml`文件，找到`web-app`节点，并插入以下内容：
- en: '[PRE5]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Without it, your session clustering will not work. You also need to keep all
    objects that you are holding in the session as serializable.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有它，您的会话集群将无法工作。您还需要保持会话中持有的所有对象为可序列化。
- en: See also
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考信息
- en: For more information about Apache TomEE visit [http://tomee.apache.org/](http://tomee.apache.org/)
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 更多关于Apache TomEE的信息，请访问[http://tomee.apache.org/](http://tomee.apache.org/)
- en: GlassFish usage
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: GlassFish使用
- en: The great thing about GlassFish is that it is the **Reference Implementation** (**RI**).
    So, whenever you have a new version of Java EE, being a developer, you already
    have the respective GlassFish version to try it.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: GlassFish的伟大之处在于它是**参考实现**（**RI**）。因此，每当有新的Java EE版本发布时，作为开发者，您已经拥有了相应的GlassFish版本来尝试它。
- en: Getting ready
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: First, you need to download it to your environment. At the time of writing,
    GlassFish 5 is the only Java EE 8 server that has been released.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要将其下载到您的环境中。在撰写本文时，GlassFish 5是唯一已发布的Java EE 8服务器。
- en: To download it, just visit [https://javaee.github.io/glassfish/download](https://javaee.github.io/glassfish/download).
    This recipe in based on version 5 (Java EE 8 compatible).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 要下载它，只需访问[https://javaee.github.io/glassfish/download](https://javaee.github.io/glassfish/download)。本食谱基于版本5（Java
    EE 8兼容）。
- en: Wherever possible, we will focus on doing the tasks using the configuration
    files.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在可能的情况下，我们将专注于使用配置文件执行任务。
- en: How to do it...
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Refer to the following detailed tasks.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 参考以下详细任务。
- en: Deploying EAR, WAR, and JAR files
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署EAR、WAR和JAR文件
- en: 'For EAR and WAR files, the deployment folder is:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 对于EAR和WAR文件，部署文件夹是：
- en: '`$GLASSFISH_HOME/glassfish/domains/[domain_name]/autodeploy`'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '`$GLASSFISH_HOME/glassfish/domains/[domain_name]/autodeploy`'
- en: Usually `domain_name` is `domain1`, unless you've changed it in the installation
    process.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 通常`domain_name`是`domain1`，除非您在安装过程中更改了它。
- en: 'For JAR files, the folder is:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 对于JAR文件，文件夹是：
- en: '`$GLASSFISH_HOME/glassfish/lib`'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '`$GLASSFISH_HOME/glassfish/lib`'
- en: Creating datasources and a connection pool
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建数据源和连接池
- en: 'To create a datasource and a connection pool to help you use databases in your
    project, edit the `$GLASSFISH_HOME/glassfish/domains/[domain_name]/config/domain.xml`
    file. Inside the `<resources>` node, insert a child node like this one:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建数据源和连接池以帮助您在项目中使用数据库，请编辑`$GLASSFISH_HOME/glassfish/domains/[domain_name]/config/domain.xml`文件。在`<resources>`节点内，插入如下子节点：
- en: '[PRE6]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Then, look for this node:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，查找以下节点：
- en: '[PRE7]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Add this child to it:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 向其中添加以下子节点：
- en: '[PRE8]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The example targets MySQL, so you will need to perform some changes for another
    database. Of course, you will also need to change the other parameters according
    to your needs.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 该示例针对MySQL，因此您需要对其他数据库进行一些更改。当然，您还需要根据需要更改其他参数。
- en: Logging setup and rotate
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日志设置和轮换
- en: 'To configure logging for GlassFish, edit the `$GLASSFISH_HOME/glassfish/domains/domain1/config/logging.properties` file:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 要为GlassFish配置日志记录，请编辑`$GLASSFISH_HOME/glassfish/domains/domain1/config/logging.properties`文件：
- en: 'The file works with handlers like this:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 该文件与以下处理程序一起工作：
- en: '[PRE9]'
  id: totrans-79
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: So, you can define the logging level, directory, format, and more according
    to your needs.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，您可以根据需要定义日志级别、目录、格式等。
- en: 'If you need to configure log rotation, you have to focus on these lines:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你需要配置日志轮换，你必须关注这些行：
- en: '[PRE10]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In this example, we are defining this file to rotate on every 2000 kilobytes
    (2 MB) and will not rotate on date change. There's no limit for history files.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们定义这个文件在每2000千字节（2 MB）时旋转，并且不会在日期更改时旋转。历史文件没有限制。
- en: Starting and stopping
  id: totrans-84
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动和停止
- en: 'To start GlassFish, just execute this script:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动GlassFish，只需执行以下脚本：
- en: '`$GLASSFISH_HOME/bin/asadmin start-domain --verbose`'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '`$GLASSFISH_HOME/bin/asadmin start-domain --verbose`'
- en: 'To stop it, excecute the following script:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止它，执行以下脚本：
- en: '`$GLASSFISH_HOME/bin/asadmin stop-domain`'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '`$GLASSFISH_HOME/bin/asadmin stop-domain`'
- en: Session clustering
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 会话集群
- en: Building a cluster using GlassFish is a little tricky and involves using both
    command line and the admin panel, but it is completely doable! Let's check it
    out.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 使用GlassFish构建集群有点棘手，需要同时使用命令行和管理面板，但这是完全可以做到的！让我们来看看。
- en: 'First, you need two or more instances (called nodes) up and running. You can
    do it in any way you like—each one running in a different machine, using virtual
    machines or containers (my favorite option). Either way you choose, the way of
    getting the cluster up is the same:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要两个或更多实例（称为节点）启动并运行。你可以以任何你喜欢的方式做到这一点——每个在不同的机器上运行，使用虚拟机或容器（我最喜欢的选项）。无论你选择哪种方式，启动集群的方式都是相同的：
- en: 'So, get your first node and open its admin panel:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 因此，获取你的第一个节点并打开其管理面板：
- en: '`https://[hostname]:4848`'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`https://[hostname]:4848`'
- en: Click on the Clusters option in the left menu and then click on the New button. 
    Name the cluster `myCluster` and click on the OK button.
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击左侧菜单中的“集群”选项，然后点击“新建”按钮。将集群命名为`myCluster`并点击“确定”按钮。
- en: Select your cluster from the list. In the opened page, select the Instances option
    in the tab and then click on New. Name the instance `node1` and click on OK.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从列表中选择你的集群。在打开的页面中，选择选项卡中的“实例”选项，然后点击“新建”。将实例命名为`node1`并点击“确定”。
- en: Now, go the General tab and click on the Start Cluster button. Voilá! Your cluster
    is up and running with your first node.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，转到“常规”选项卡，然后点击“启动集群”按钮。哇！你的集群已经启动并运行，并且已经有了第一个节点。
- en: 'Now, go to the second machine (VM, container, other server, or any server)
    with GlassFish already installed and run this command:'
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在，转到已经安装了GlassFish的第二台机器（虚拟机、容器、其他服务器或任何服务器）并运行此命令：
- en: '[PRE11]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This will set the second machine as a member of the cluster. If you refresh
    the Cluster page on the first machine, you will see the new member (`node2`).
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 这将把第二台机器设置为集群的成员。如果你在第一台机器上刷新集群页面，你会看到新的成员（`node2`）。
- en: You will notice that `node2` has stopped. Click on it and in the new page click
    on the Node link (it will usually show the hostname of `node2`).
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你会注意到`node2`已经停止了。点击它，然后在新的页面中点击Node链接（它通常会显示`node2`的主机名）。
- en: In the opened page, change the Type value to `SSH`. Some new fields will show
    up in a `SSH` section.
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在打开的页面中，将“类型”值更改为`SSH`。在`SSH`部分将显示一些新的字段。
- en: Change SSH User Authentication to `SSH Password` and fill the SSH User Password field
    with the proper password.
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将SSH用户认证改为`SSH密码`，并在SSH用户密码字段中填写正确的密码。
- en: Click on the Save button. If you run some SSH error (usually `connection refused`),
    set the Force option to Enabled, and click on Save button again.
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“保存”按钮。如果你遇到一些SSH错误（通常是`连接被拒绝`），将“强制”选项设置为启用，然后再次点击“保存”按钮。
- en: 'Go back to the command line on the machine hosting `node2` and run this command:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 返回到托管`node2`的机器上的命令行并运行此命令：
- en: '[PRE12]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: If everything went well, your `node2` should be up and running and you should
    now have a real cluster. You can repeat these steps how ever many times you need
    to add new nodes to your cluster.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，你的`node2`应该已经启动并运行，你现在应该有一个真正的集群。你可以根据需要重复这些步骤来添加新的节点到你的集群。
- en: There's more...
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 还有更多...
- en: A common issue for this clustering with GlassFish arises when you don't have
    the SSH service running in your nodes; as there are tons of options of them for
    many operating systems, we won't cover each one of them here.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用GlassFish的这种集群，一个常见的问题是你没有在节点上运行SSH服务；由于许多操作系统有大量的选项，我们在这里不会涵盖每一个。
- en: The best way to set up a Java EE cluster today is using containers (specially
    Docker containers). So, I'd recommend that you have a look at [Chapter 11](1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml), *Rising
    to the Cloud – Java EE, Containers, and Cloud Computing*. If you mix that content
    with this, you will have a powerful environment for your application.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 目前设置 Java EE 集群的最佳方式是使用容器（特别是 Docker 容器）。因此，我建议您查看第 11 章 [Rising to the Cloud
    – Java EE, Containers, and Cloud Computing](1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml)，这样，如果您将这部分内容与当前内容结合，将为您的应用程序提供一个强大的环境。
- en: 'To allow your application to share its session with all the nodes in the cluster,
    you need to edit the `web.xml` file, find the `web-app` node, and insert this:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 要允许您的应用程序与集群中的所有节点共享会话，您需要编辑 `web.xml` 文件，找到 `web-app` 节点，并插入以下内容：
- en: '[PRE13]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Without it, your session clustering will not work. You need also to keep all
    objects that you are holding in the session as serializable.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 没有它，您的会话集群将无法工作。您还需要确保所有在会话中持有的对象都是可序列化的。
- en: Finally, there's a commercial version of GlassFish, which is Payara Server.
    If you are looking for support and other commercial perks, you should take a look
    at it.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，还有商业版本的 GlassFish，即 Payara Server。如果您正在寻找支持和其他商业优惠，您应该看看它。
- en: See also
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参见
- en: For more information about GlassFish, visit [https://javaee.github.io/glassfish/](https://javaee.github.io/glassfish/).
  id: totrans-115
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 想了解更多关于 GlassFish 的信息，请访问 [https://javaee.github.io/glassfish/](https://javaee.github.io/glassfish/)。
- en: WildFly usage
  id: totrans-116
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: WildFly 使用
- en: WildFly is another great Java EE implementation. It was known as **JBoss AS**,
    but changed its name some years ago (although we still have the JBoss EAP as the
    *enterprise-production ready* version). As its administration and use are slightly
    different from Apache TomEE and GlassFish, it's worth having a proper look at
    it.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: WildFly 是另一个优秀的 Java EE 实现。它曾被称为 **JBoss AS**，但几年前更改了名称（尽管我们仍然有 JBoss EAP 作为
    *企业生产就绪* 版本）。由于其管理和使用方式与 Apache TomEE 和 GlassFish 略有不同，因此仔细研究它是值得的。
- en: Getting ready
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 准备工作
- en: First, you need to download it to your environment. At the time of writing,
    WildFly has no Java EE 8-compatible version (actually there is only GlassFish
    5). However, the tasks covered here shouldn't change in a future version, as they
    are not attached to the Java EE specs. To download it, just visit [http://wildfly.org/downloads/](http://wildfly.org/downloads/).
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要将其下载到您的环境中。在撰写本文时，WildFly 没有与 Java EE 8 兼容的版本（实际上只有 GlassFish 5）。然而，这里涵盖的任务在未来版本中不应发生变化，因为它们与
    Java EE 规范无关。要下载它，只需访问 [http://wildfly.org/downloads/](http://wildfly.org/downloads/)。
- en: This recipe in based on version 11.0.0.Final (Java EE7 Full and Web Distribution).
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例基于版本 11.0.0.Final（Java EE7 全功能和 Web 发行版）。
- en: Wherever possible, we will focus on doing the tasks using the configuration
    files.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在可能的情况下，我们将专注于使用配置文件来完成这些任务。
- en: How to do it...
  id: totrans-122
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何操作...
- en: Refer to the following detailed tasks.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 参考以下详细任务。
- en: Deploying EAR, WAR, and JAR files
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 部署 EAR、WAR 和 JAR 文件
- en: 'For EAR and WAR files, the deployment folder is:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 EAR 和 WAR 文件，部署文件夹是：
- en: '`$WILDFLY_HOME/standalone/deployments`'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '`$WILDFLY_HOME/standalone/deployments`'
- en: For JAR files (like JDBC connections, for example), WildFly creates a flexible
    folder structure. So, the best way to distribute them is using its UI, as we will
    show in the connection pool topic (the next one).
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 JAR 文件（例如 JDBC 连接），WildFly 创建了一个灵活的文件夹结构。因此，最佳的分发方式是使用其 UI，正如我们将在连接池主题（下一个主题）中展示的那样。
- en: Creating datasources and a connection pool
  id: totrans-128
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建数据源和连接池
- en: 'Take the following steps to create your datasources and connection pool:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 按以下步骤创建您的数据源和连接池：
- en: 'To create a datasource and a connection pool to help you use databases in your
    project, start WildFly and visit the following URL:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建数据源和连接池以帮助您在项目中使用数据库，启动 WildFly 并访问以下 URL：
- en: '`http://localhost:9990/`'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '`http://localhost:9990/`'
- en: Click on Deployments and then click on the Add button. In the opened page, select
    Upload a new deployment and click on the Next button. In the opened page, select
    the proper JDBC connector (we will use MySQL for this recipe) and click on Next.
  id: totrans-132
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击“部署”然后点击“添加”按钮。在打开的页面中，选择“上传新的部署”并点击“下一步”按钮。在打开的页面中，选择适当的 JDBC 连接器（我们将使用 MySQL
    进行此示例）并点击“下一步”。
- en: Verify the information in the opened page and click on Finish.
  id: totrans-133
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 验证打开页面中的信息并点击“完成”。
- en: Now that your JDBC connector is available in the server, you can go ahead and
    create your datasource. Go to Home in the administration panel and click on the
    Configuration option.
  id: totrans-134
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 现在您的 JDBC 连接器已在服务器中可用，您可以继续创建数据源。转到管理面板中的“首页”并点击“配置”选项。
- en: 'In the opened page, follow this path:'
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在打开的页面中，按照以下路径：
- en: Subsystems | Datasources | Non-XA | Datasource | Add
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 子系统 | 数据源 | 非XA | 数据源 | 添加
- en: 'In the opened window select MySQL Datasource and click on Next. Then, fill
    the fields like this:'
  id: totrans-137
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在打开的窗口中选择 MySQL 数据源，然后点击下一步。然后填写字段如下：
- en: 'Name: `MySqlDS`'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '名称: `MySqlDS`'
- en: JNDI Name: `java:/MySqlDS`
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'JNDI 名称: `java:/MySqlDS`'
- en: Click on Next. In the next page, click on Detected Driver, select the proper
    MySQL connector (the one you just uploaded) and click on Next.
  id: totrans-140
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击下一步。在下一页，点击检测到的驱动程序，选择适当的 MySQL 连接器（你刚刚上传的那个），然后点击下一步。
- en: 'The last step is to fill the connection settings fields, like this:'
  id: totrans-141
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后一步是填写连接设置字段，如下所示：
- en: Connection URL: `jdbc:mysql://localhost:3306/sys`
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '连接 URL: `jdbc:mysql://localhost:3306/sys`'
- en: 'Username: `root`'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '用户名: `root`'
- en: 'Password: `mysql`'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '密码: `mysql`'
- en: Click on the Next button, review the information, and click on Finish. Your
    newly created connection will appear in the datasources list. You can click on
    the dropdown list and select Test to check whether everything is working well.
  id: totrans-145
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击下一步按钮，查看信息，然后点击完成。你新创建的连接将出现在数据源列表中。你可以点击下拉列表并选择测试来检查一切是否正常工作。
- en: Logging setup and rotate
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日志设置和轮换
- en: To configure the logging for WildFly, edit the `$WILDFLY_HOME/standalone/configuration/standalone.xml` file.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置 WildFly 的日志，编辑 `$WILDFLY_HOME/standalone/configuration/standalone.xml` 文件。
- en: To customize the logging properties, find the `<profile>` node and then find `<subsystem
    xmlns='urn:jboss:domain:logging:3.0'>` inside it.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要自定义日志属性，找到 `<profile>` 节点，然后在其中找到 `<subsystem xmlns='urn:jboss:domain:logging:3.0'>`。
- en: 'It is based on handles like this:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 它基于这样的处理程序：
- en: '[PRE14]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'By default, it will rotate daily:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，它将每天轮换：
- en: '[PRE15]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'If you want it to rotate based on the size, you should remove the preceding
    handler and then insert this one:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想根据大小进行轮换，你应该移除前面的处理器，然后插入这个：
- en: '[PRE16]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: In this case, the log will rotate when the file reaches 2 MB and will keep a
    history of five files in the backup.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，当文件达到 2 MB 时，日志将进行轮换，并保留五个文件的备份历史。
- en: Starting and stopping
  id: totrans-156
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动和停止
- en: 'To start GlassFish, just execute this script:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 要启动 GlassFish，只需执行此脚本：
- en: '`$WILDFLY_HOME/bin/standalone.sh`'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '`$WILDFLY_HOME/bin/standalone.sh`'
- en: 'To stop it, execute this script:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止它，执行此脚本：
- en: '`$WILDFLY_HOME/bin/jboss-cli.sh --connect command=:shutdown`'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '`$WILDFLY_HOME/bin/jboss-cli.sh --connect command=:shutdown`'
- en: Session clustering
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 会话集群
- en: 'If you go to the `$WILDFLY_HOME/standalone/configuration` folder, you will
    see these files:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你转到 `$WILDFLY_HOME/standalone/configuration` 文件夹，你会看到这些文件：
- en: '`standalone.xml`'
  id: totrans-163
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`standalone.xml`'
- en: '`standalone-ha.xml `'
  id: totrans-164
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`standalone-ha.xml`'
- en: '`standalone-full.xml `'
  id: totrans-165
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`standalone-full.xml`'
- en: '`standalone-full-ha.xml`'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`standalone-full-ha.xml`'
- en: '`standalone.xml` is the default, with all default configuration. To build a
    cluster, we need to use the `standalone-ha.xml` file (`ha` comes from **high availability**),
    so rename it to end it as `standalone.xml`.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '`standalone.xml` 是默认配置，包含所有默认配置。要构建集群，我们需要使用 `standalone-ha.xml` 文件（`ha` 来自
    **高可用性**），因此将其重命名为以 `standalone.xml` 结尾。'
- en: 'Then, you start the server. You should not do the following:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，启动服务器。你不应该做以下事情：
- en: '[PRE17]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Instead, you should do this:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，你应该这样做：
- en: '[PRE18]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: You should now do the same in whatever other nodes (machines, VMs, containers,
    and so on) that you want to get into the cluster. Of course, they need to be in
    the same network.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在应该在你想加入集群的任何其他节点（机器、虚拟机、容器等）上做同样的事情。当然，它们需要处于同一个网络中。
- en: There's more...
  id: totrans-173
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更多内容...
- en: The best way to set up a Java EE cluster today is using containers (specially
    Docker containers). So, I'd recommend that you have a look at the [Chapter 11](1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml),  *Rising
    to the Cloud – Java EE, Containers, and Cloud Computing* chapter. If you mix that
    content with this, you will have a powerful environment for your application.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 目前设置 Java EE 集群的最好方法是使用容器（特别是 Docker 容器）。因此，我建议你查看第 11 章 [Rising to the Cloud
    – Java EE, Containers, and Cloud Computing](1f37c3b8-6cbe-436f-a427-f6c76b15de5a.xhtml)，了解如何将内容与本章内容结合，这将为你提供一个强大的应用程序环境。
- en: 'To allow your application to share its session with all nodes in the cluster,
    you need to edit the `web.xml` file, find the `web-app` node, and insert this:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 要允许你的应用程序与集群中的所有节点共享其会话，你需要编辑 `web.xml` 文件，找到 `web-app` 节点，并插入以下内容：
- en: '[PRE19]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Without it, your session clustering will not work.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 没有它，你的会话集群将无法工作。
- en: See also
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参见
- en: For more information about WildFly, visit [http://wildfly.org/](http://wildfly.org/)
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 想了解更多关于 WildFly 的信息，请访问 [http://wildfly.org/](http://wildfly.org/)
