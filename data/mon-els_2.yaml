- en: Chapter 2. Installation and the Requirements for Elasticsearch
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章：Elasticsearch 的安装和需求
- en: The **Java Runtime Environment** (**JRE**) is the only requirement to run Elasticsearch.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '**Java 运行时环境**（**JRE**）是运行 Elasticsearch 的唯一要求。'
- en: The official Elasticsearch documentation recommends that you use either Oracle
    Java 8 (update 20 or later), or Oracle Java 7 (update 55 or later). Once you choose
    your version of the JRE, we recommend that all your nodes use the same version
    to maintain compatibility. Using different versions of Java across your cluster
    or using Java versions earlier than the ones specified here, can lead to data
    corruption. Once you choose a version of Elasticsearch, all the nodes in your
    cluster should use the same version.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 官方 Elasticsearch 文档建议您使用 Oracle Java 8（更新 20 或更高版本），或 Oracle Java 7（更新 55 或更高版本）。一旦您选择了
    JRE 的版本，我们建议您的所有节点使用相同的版本以保持兼容性。在集群中使用不同版本的 Java 或使用比此处指定的版本更早的 Java 版本可能会导致数据损坏。一旦您选择了
    Elasticsearch 的版本，您的集群中的所有节点都应使用相同的版本。
- en: While it is possible to run Elasticsearch on both Windows and Linux, this book
    focuses on using it exclusively in a Linux environment. The Elasticsearch documentation
    is centered on Linux and most of the Elasticsearch community runs the software
    on Linux. However, there is no reason a production cluster of Elasticsearch cannot
    run on Windows.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然可以在 Windows 和 Linux 上运行 Elasticsearch，但本书专注于在 Linux 环境中单独使用它。Elasticsearch
    文档以 Linux 为中心，Elasticsearch 社区的大部分人都在 Linux 上运行该软件。然而，没有理由生产集群的 Elasticsearch
    不能在 Windows 上运行。
- en: This chapter will specifically cover installation instructions for Ubuntu, CentOS,
    and Red Hat Enterprise Linux (RHEL), but any Linux distribution will work. Readers
    should use 64-bit operating systems rather than 32-bit operating systems because
    the former allows more memory allocation for the JRE.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将特别介绍 Ubuntu、CentOS 和 Red Hat Enterprise Linux (RHEL) 的安装说明，但任何 Linux 发行版都适用。读者应使用
    64 位操作系统而不是 32 位操作系统，因为前者允许为 JRE 分配更多内存。
- en: 'This chapter covers the following topics:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖以下主题：
- en: Installing Elasticsearch
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 Elasticsearch
- en: Configuring Elasticsearch
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置 Elasticsearch
- en: Installing monitoring tools (Elasticsearch-head, Bigdesk, and Marvel)
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装监控工具（Elasticsearch-head、Bigdesk 和 Marvel）
- en: Cluster requirements
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 集群需求
- en: Installing Elasticsearch
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 Elasticsearch
- en: 'At the time of writing this book, Elasticsearch 2.3.2 is the current stable
    release and Elasticsearch 5 is in alpha testing. For production clusters, we recommend
    using the 2.3.2 release and quickly updating to the 5 general availability (GA)
    release once it is available. Note that while Elasticsearch 5 is compatible with
    indices created in Elasticsearch 2.x, there have also been some API changes and
    feature deprecations after the 1.x release. Readers should account for these important
    changes before upgrading. More details on upgrading from 2.x to 5 can be found
    on the Elastic website at the following URLS:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在撰写本书时，Elasticsearch 2.3.2 是当前的稳定版本，Elasticsearch 5 正在 alpha 测试中。对于生产集群，我们建议使用
    2.3.2 版本，一旦可用，应迅速更新到 5 通用可用（GA）版本。请注意，虽然 Elasticsearch 5 与在 Elasticsearch 2.x
    中创建的索引兼容，但在 1.x 版本发布后也进行了一些 API 变更和功能弃用。在升级之前，读者应考虑到这些重要变更。有关从 2.x 升级到 5 的更多详细信息，可以在
    Elastic 网站上的以下 URL 找到：
- en: '[https://www.elastic.co/blog/elasticsearch-5-0-0-alpha1-released](https://www.elastic.co/blog/elasticsearch-5-0-0-alpha1-released)'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.elastic.co/blog/elasticsearch-5-0-0-alpha1-released](https://www.elastic.co/blog/elasticsearch-5-0-0-alpha1-released)'
- en: '[https://www.elastic.co/blog/elasticsearch-5-0-0-alpha2-released](https://www.elastic.co/blog/elasticsearch-5-0-0-alpha2-released)'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://www.elastic.co/blog/elasticsearch-5-0-0-alpha2-released](https://www.elastic.co/blog/elasticsearch-5-0-0-alpha2-released)'
- en: 'Notable API changes include the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一些显著的 API 变更：
- en: Indices from Elasticsearch 1.x must first be upgraded to 2.x before finally
    moving to version 5
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Elasticsearch 1.x 的索引必须首先升级到 2.x，然后才能最终迁移到版本 5
- en: The deprecated `filtered`, `or`, and `and` queries were removed in favor of
    the `bool`, `must`, and `should` queries
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 已弃用的 `filtered`、`or` 和 `and` 查询已被 `bool`、`must` 和 `should` 查询所取代
- en: The `string` mapping was deprecated in favor of the `text` and `keyword` fields
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`string` 映射已被 `text` 和 `keyword` 字段所取代'
- en: The `index` mapping property is now set to `true` / `false` instead of `analyzed`
    / `not_analyzed` / `no`
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`index` 映射属性现在设置为 `true` / `false` 而不是 `analyzed` / `not_analyzed` / `no`'
- en: Significant changes to the Percolate API
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Percolate API 的重大变更
- en: The `_id` values are limited to 512 bytes
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`_id` 值限制为 512 字节'
- en: While examples in this book use the 2.3.2 Elasticsearch release, all examples
    should be compatible with the upcoming 5.0 release.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然本书中的示例使用的是 2.3.2 版本的 Elasticsearch，但所有示例都应与即将推出的 5.0 版本兼容。
- en: The latest version of Elasticsearch is available at [https://www.elastic.co/downloads/elasticsearch](https://www.elastic.co/downloads/elasticsearch)
    in `.zip`, `.tar.gz`, `.rpm`, and `.deb` formats. It doesn't matter how Elasticsearch
    is installed, but because it is simpler, we recommend using the `.deb` installer
    for Ubuntu users, the `.rpm` installer for CentOS or RHEL users, and the `.tar.gz`
    or `.zip` version for users of other Linux distributions, or for users who require
    a more customized setup. Elasticsearch also provides official `yum` and `apt-get`
    repositories.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 最新版本的 Elasticsearch 可在 [https://www.elastic.co/downloads/elasticsearch](https://www.elastic.co/downloads/elasticsearch)
    以 `.zip`、`.tar.gz`、`.rpm` 和 `.deb` 格式获取。Elasticsearch 的安装方式无关紧要，但我们推荐 Ubuntu 用户使用
    `.deb` 安装程序，CentOS 或 RHEL 用户使用 `.rpm` 安装程序，其他 Linux 发行版用户或需要更定制化设置的用户使用 `.tar.gz`
    或 `.zip` 版本，Elasticsearch 还提供官方的 `yum` 和 `apt-get` 仓库。
- en: Examples in this chapter assume that the user installed Elasticsearch with the
    `.rpm` or `.deb` installer, or through the official `yum` or `apt-get` repositories.
    This should also be similar for users who installed with the `.zip` and `.tar.gz`
    installers.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的示例假设用户使用 `.rpm` 或 `.deb` 安装程序或通过官方的 `yum` 或 `apt-get` 仓库安装了 Elasticsearch。对于使用
    `.zip` 和 `.tar.gz` 安装程序的用户也应类似。
- en: DEB/RPM installation
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DEB/RPM 安装
- en: 'First, download the most up-to-date package from [https://elastic.co](https://elastic.co):'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，从 [https://elastic.co](https://elastic.co) 下载最新版本的包：
- en: 'Run the following to install the DEB package on an Ubuntu or Debian-compatible
    system:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 Ubuntu 或 Debian 兼容系统上运行以下命令以安装 DEB 包：
- en: '[PRE0]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Run the following to install the RPM package on a CentOS, RHEL, or another
    compatible system:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 CentOS、RHEL 或其他兼容系统上运行以下命令以安装 RPM 包：
- en: '[PRE1]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The yum and apt-get repositories
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: yum 和 apt-get 仓库
- en: The official `yum` and `apt-get` repositories are a great way to install Elasticsearch.
    However, make sure that you use the *official* repositories. Many third-party
    `yum` and `apt-get` Elasticsearch repositories are available, but they may not
    have the latest stable release.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 官方的 `yum` 和 `apt-get` 仓库是安装 Elasticsearch 的好方法。然而，请确保您使用的是 *官方* 仓库。许多第三方 `yum`
    和 `apt-get` Elasticsearch 仓库可供选择，但它们可能没有最新的稳定版本。
- en: Ubuntu/Debian and apt-get
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Ubuntu/Debian 和 apt-get
- en: 'To install Elasticsearch using `apt-get` follow these steps:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `apt-get` 安装 Elasticsearch 的步骤如下：
- en: 'To enable the repository via `apt-get`, first add the `gpg` key:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要通过 `apt-get` 启用仓库，首先添加 `gpg` 密钥：
- en: '[PRE2]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then, add the repository via the following:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，通过以下方式添加仓库：
- en: '[PRE3]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Finally, use your package manager to install the following:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，使用您的包管理器安装以下内容：
- en: '[PRE4]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: CentOS/RHEL and yum
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CentOS/RHEL 和 yum
- en: 'For `yum`, follow these steps:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 `yum`，请按照以下步骤操作：
- en: 'Add the `gpg` key:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加 `gpg` 密钥：
- en: '[PRE5]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Then, create a new yum repository at `/etc/yum.repos.d/elasticsearch.repo`
    with the following content:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 然后，在 `/etc/yum.repos.d/elasticsearch.repo` 创建一个新的 yum 仓库，内容如下：
- en: '[PRE6]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Install the package with the following:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令安装软件包：
- en: '[PRE7]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Verification
  id: totrans-48
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证
- en: 'Start Elasticsearch with the following command:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 使用以下命令启动 Elasticsearch：
- en: '[PRE8]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Then verify installation, test to see whether Elasticsearch is running and
    loaded via the following:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，验证安装，通过以下方式测试 Elasticsearch 是否正在运行并加载：
- en: '[PRE9]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You should get this response:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该得到以下响应：
- en: '[PRE10]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'To verify that we are able to write data to Elasticsearch, use the following:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 要验证我们能否将数据写入 Elasticsearch，请使用以下命令：
- en: '[PRE11]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This returns the following:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这将返回以下内容：
- en: '[PRE12]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We fetch the data, as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们获取数据，如下所示：
- en: '[PRE13]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This returns the following output:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 这将返回以下输出：
- en: '[PRE14]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'As a sanity check, try a nonexisting record:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 作为合理性检查，尝试一个不存在的记录：
- en: '[PRE15]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'This should return an expected `false` for `found`:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该返回预期的 `false` 对于 `found`：
- en: '[PRE16]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Configuration files
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置文件
- en: 'It is worth noting the Elasticsearch installation location, specifically the
    configuration files and the log files. For example, on Ubuntu, run the following:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是 Elasticsearch 的安装位置，特别是配置文件和日志文件。例如，在 Ubuntu 上，运行以下命令：
- en: '[PRE17]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: This will show that the installation placed the logs in `/var/log/elasticsearch`
    and the config files in `/etc/elasticsearch`. Any settings for Elasticsearch (not
    related to logging) are in `elasticsearch.yml` while `logging.yml` handles logging.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 这将显示安装将日志放在 `/var/log/elasticsearch`，配置文件放在 `/etc/elasticsearch`。Elasticsearch
    的任何设置（与日志无关）都在 `elasticsearch.yml` 中，而 `logging.yml` 负责日志处理。
- en: We will delve into these files and their respective settings further throughout
    the book.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本书的后续部分进一步探讨这些文件及其相应的设置。
- en: Configuring an Elasticsearch cluster
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置 Elasticsearch 集群
- en: This section will cover some basic Elasticsearch configuration in addition to
    a few changes that will positively impact your cluster's performance.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 本节将涵盖一些基本的 Elasticsearch 配置，以及一些将对您的集群性能产生积极影响的更改。
- en: 'Most Elasticsearch configuration changes will be applied to `elasticsearch.yml`.
    For our installation of Elasticsearch on Ubuntu, this file is located at `/etc/elasticsearch/elasticsearch.yml`.
    Elasticsearch internal configuration changes are applied to `elasticsearch.yml`.
    Environmental variables can be set in the application''s startup script. For our
    installation of Elasticsearch 2.3.2 on Ubuntu, these files are in the following
    locations:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数 Elasticsearch 配置更改都将应用于 `elasticsearch.yml`。对于我们在 Ubuntu 上的 Elasticsearch
    安装，此文件位于 `/etc/elasticsearch/elasticsearch.yml`。Elasticsearch 内部配置更改应用于 `elasticsearch.yml`。环境变量可以在应用程序的启动脚本中设置。对于我们在
    Ubuntu 上的 Elasticsearch 2.3.2 安装，这些文件位于以下位置：
- en: Internal Configuration is located at
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 内部配置位于
- en: '`/etc/elasticsearch/` `elasticsearch.yml`'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`/etc/elasticsearch/elasticsearch.yml`'
- en: Environmental Variable Configuration is located at
  id: totrans-77
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 环境变量配置位于
- en: '`/etc/defau` `lts/elasticsearch`'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`/etc/default/elasticsearch`'
- en: Cluster name
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 集群名称
- en: A wonderful thing about Elasticsearch is the ease with which you can build a
    cluster. Elasticsearch nodes on the same local area network (LAN) will automatically
    form a cluster with each other if they have the configuration variable `cluster.name`
    set to the same value.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 Elasticsearch 的一个美妙之处在于构建集群的简便性。如果同一局域网（LAN）上的 Elasticsearch 节点将配置变量 `cluster.name`
    设置为相同的值，它们将自动相互形成集群。
- en: For example, if we store tweets from Twitter in our cluster, we may want to
    set `cluster.name` to `twitter_development`. Later on, we may want to create another
    cluster with the name `twitter_production` to hold all of our production data.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果我们将在我们的集群中存储来自 Twitter 的推文，我们可能希望将 `cluster.name` 设置为 `twitter_development`。稍后，我们可能希望创建另一个名为
    `twitter_production` 的集群来存储所有生产数据。
- en: 'To modify this setting, edit the `Elasticsearch.yml` file and look for the
    `cluster.name` setting. Change this value to: `cluster.name: tw` `itter_development`.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '要修改此设置，编辑 `Elasticsearch.yml` 文件并查找 `cluster.name` 设置。将此值更改为：`cluster.name:
    twitter_development`。'
- en: The default value for `cluster.name` is `elasticsearch`. It is fine to use this
    in solo development, but be careful using it when you are on a LAN with other
    developers. If you start a new Elasticsearch with the default `cluster.name` value
    and someone else on your network is also running Elasticsearch with the default
    configuration, you'll notice that data from their Elasticsearch instance will
    start replicating in your machine.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: '`cluster.name` 的默认值是 `elasticsearch`。在独立开发中使用它是可以的，但如果你在局域网（LAN）上与其他开发者一起使用，请小心使用。如果你使用默认的
    `cluster.name` 值启动一个新的 Elasticsearch，而你的网络上的其他人也在使用默认配置运行 Elasticsearch，你将注意到他们的
    Elasticsearch 实例中的数据将开始在你的机器上复制。'
- en: Memory configuration
  id: totrans-84
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 内存配置
- en: 'Elasticsearch recommends setting the heap size to half of the available RAM
    on the machine, but no more than 30.5 GB. We are using a machine with 16 GB of
    RAM, so we''ll set the heap size to 8 GB. This configuration change is made to
    the `ES_HEAP_SIZE` environment variable in `/etc/defaykts/elasticsear` `ch`:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch 建议将堆大小设置为机器可用 RAM 的一半，但不超过 30.5 GB。我们使用的是 16 GB RAM 的机器，因此我们将堆大小设置为
    8 GB。此配置更改是在 `/etc/default/elasticsearch` 中的 `ES_HEAP_SIZE` 环境变量中进行的：
- en: '[PRE18]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Open file limit
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 打开文件限制
- en: Linux limits the number of file descriptors a process can have open at one time.
    This limit exists because every time a process opens a file descriptor, it uses
    a little bit of memory. If there were no limit on the number of open files, a
    process could potentially open enough files to cause the entire system to run
    out of memory and crash.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: Linux 限制了进程一次可以打开的文件描述符数量。这个限制存在是因为每次进程打开一个文件描述符时，都会使用一点内存。如果没有对打开文件数量的限制，一个进程可能会打开足够的文件，导致整个系统内存耗尽并崩溃。
- en: By default, this limit is set to `1024`, which is too low for Elasticsearch.
    The official Elasticsearch documentation recommends upping this value to `32`
    `k` or `64k` for open files.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，此限制设置为 `1024`，这对于 Elasticsearch 来说太低了。官方 Elasticsearch 文档建议将此值提高到 `32k`
    或 `64k` 以增加打开文件的数量。
- en: The maximum file limit
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 最大文件限制
- en: The most up-to-date `.rpm` and `.deb` installers will automatically increase
    the maximum open file limit in Elasticsearch to `65535`. However, if you use an
    older version of the `.deb` or `.rpm`, or run Elasticsearch from the tarball,
    you'll have to increase the limit manually.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 最新的`.rpm`和`.deb`安装程序将自动将Elasticsearch的最大打开文件限制增加到`65535`。然而，如果您使用较旧的`.deb`或`.rpm`版本，或者从tarball运行Elasticsearch，您将必须手动增加限制。
- en: 'To check the maximum number of open files allocated to your current user, run
    the following:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查分配给当前用户的最大打开文件数，请运行以下命令：
- en: '[PRE19]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The user has a maximum of `65535` files. However, this does *not* mean Elasticsearch
    is assigned this number of files. This may mean that Elasticsearch is running
    as a different user or that it was started with different environment settings.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 用户最多有`65535`个文件。然而，这并不意味着Elasticsearch被分配了这么多文件。这可能意味着Elasticsearch以不同的用户身份运行，或者是以不同的环境设置启动的。
- en: 'To check the maximum number of open files allocated to Elasticsearch, run the
    following:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查分配给Elasticsearch的最大打开文件数，请运行以下命令：
- en: '[PRE20]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The result should look something like this:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 结果应该看起来像这样：
- en: '[PRE21]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: We see that `max_file_descriptors` was set to `1024`, so we'll have to increase
    it. If your output says `65535`, skip to the next section.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到`max_file_descriptors`被设置为`1024`，因此我们需要将其增加。如果您的输出显示`65535`，请跳到下一节。
- en: Make sure that this is for the appropriate node; this `curl` command will display
    the `max_file` descriptors for all nodes in your cluster.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 确保这是针对适当的节点；这个`curl`命令将显示您集群中所有节点的`max_file`描述符。
- en: Updating max file descriptors on Ubuntu Linux
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在Ubuntu Linux上更新最大文件描述符
- en: 'Edit the `/etc/security/limits.conf` file and add the following lines to the
    end of the file:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑`/etc/security/limits.conf`文件，并在文件末尾添加以下行：
- en: '[PRE22]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Tip
  id: totrans-104
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: The `*` symbol means *all users*. You can also set this to just the user that
    runs the Elasticsearch process.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '`*`符号表示`所有用户`。您也可以将其设置为仅运行Elasticsearch进程的用户。'
- en: Enabling pluggable authentication modules
  id: totrans-106
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用可插拔认证模块
- en: 'If we connect to the Linux server over SSH, we''ll have to ensure that PAM
    authentication is enabled. These instructions are the same if you use Ubuntu or
    CentOS/RHEL. To make this configuration change, edit the `sshd_config` file:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们通过SSH连接到Linux服务器，我们必须确保PAM认证已启用。如果您使用Ubuntu或CentOS/RHEL，这些说明是相同的。要做出此配置更改，编辑`sshd_config`文件：
- en: '[PRE23]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Ensure that this line is present:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 确保这一行存在：
- en: '[PRE24]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Then, restart your SSH server:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，重新启动您的SSH服务器：
- en: '[PRE25]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Verifying the open file limit
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 验证打开文件限制
- en: 'Log out and log back in again to make these changes take effect, then restart
    the Elasticsearch server:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 注销并重新登录以使这些更改生效，然后重新启动Elasticsearch服务器：
- en: '[PRE26]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Finally, be sure to verify that these changes took effect. It is not enough
    to verify that `ulimit -n` returns `65536`. It is also important to ensure that
    the Elasticsearch user was started up properly with the increased maximum open
    file limit:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，务必验证这些更改是否生效。仅验证`ulimit -n`返回`65536`是不够的。还必须确保Elasticsearch用户已正确启动，并具有增加的最大打开文件限制：
- en: '[PRE27]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'This should result in the following:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该导致以下结果：
- en: '[PRE28]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: This time we see that `max_file_d` `escriptors` is set to `65536`.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这次我们看到`max_file_d` `escriptors`被设置为`65536`。
- en: Disabling swapping
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 禁用交换
- en: It is important to disable memory swapping on your operating system or Elasticsearch
    process.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 在您的操作系统或Elasticsearch进程中禁用内存交换是很重要的。
- en: 'To disable swapping until your system is rebooted, run the following:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 要在系统重新启动之前禁用交换，请运行以下命令：
- en: '[PRE29]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'To disable swapping even after your system is rebooted, edit the `/etc/fstab`
    file, and comment out any lines with the word `swap` in them. For us, this looked
    like the following:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 要在系统重新启动后禁用交换，编辑`/etc/fstab`文件，并注释掉包含`swap`一词的任何行。对我们来说，这看起来像以下这样：
- en: '[PRE30]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'To disable swap for just Elasticsearch, you''ll first have to set your Elasticsearch
    heap size using `ES_HEAP_SIZE` and set the process maximum amount of locked memory
    to `ulimited` as the root user. If you use the `.rpm` or `.deb` installer, both
    of these settings can be changed in the `/etc/init.d/elasticsearch` startup script.
    Specifically, uncomment and update these lines, as follows:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 要仅禁用Elasticsearch的交换，您首先必须使用`ES_HEAP_SIZE`设置Elasticsearch堆大小，并以root用户将进程的最大锁定内存设置为`ulimited`。如果您使用`.rpm`或`.deb`安装程序，这两个设置都可以在`/etc/init.d/elasticsearch`启动脚本中更改。具体来说，取消注释并更新以下行，如下所示：
- en: (My machine has 512 MB of memory, so I'm setting `ES_HEAP_SIZE` to `256m`.)
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: （我的机器有512MB的内存，所以我将`ES_HEAP_SIZE`设置为`256m`。）
- en: '[PRE31]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'A little further down:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 有一点更远：
- en: '[PRE32]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Next, edit your `elasticsearch.yml` file, and add the line:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，编辑您的 `elasticsearch.yml` 文件，并添加以下行：
- en: '[PRE33]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Then, reboot your Elasticsearch node:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，重启您的 Elasticsearch 节点：
- en: '[PRE34]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Finally, verify that this setting worked by running the following:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，通过运行以下命令来验证此设置是否成功：
- en: '[PRE35]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'You should see the following:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该看到以下内容：
- en: '[PRE36]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: This is the response.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 这是响应。
- en: Understanding your cluster
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 了解您的集群
- en: Elasticsearch has many different moving parts, and it can get a little complicated
    to ensure that everything runs properly. Fortunately, there are some great open
    source monitoring tools that are available to help you keep tabs on your cluster.
    This section will cover how to install some of the most popular and useful monitoring
    tools on your cluster, and the following two chapters will go into these tools
    in more detail.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch 有许多不同的组件，确保所有组件正常运行可能会变得有些复杂。幸运的是，有一些优秀的开源监控工具可供您使用，以帮助您监控您的集群。本节将介绍如何在您的集群上安装一些最受欢迎和最有用的监控工具，接下来的两个章节将更详细地介绍这些工具。
- en: Installing Elasticsearch-head
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Elasticsearch-head
- en: Elasticsearch-head is a simple, free, open source tool that provides a high-level
    examination of your cluster. It is one of the most useful tools used when administering
    and monitoring the health of a cluster. Elasticsearch-head only needs to be installed
    on one node in your cluster. However, we recommend installing it on all nodes
    for redundancy. It's installed as an Elasticsearch plugin.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch-head 是一个简单、免费、开源的工具，它提供了对您的集群的高级检查。它是管理集群和监控集群健康状况时最常用的工具之一。Elasticsearch-head
    只需要在您的集群中的一个节点上安装。然而，我们建议在所有节点上安装它以提高冗余性。它作为 Elasticsearch 插件安装。
- en: 'If you have an Internet connection, you can install Elasticsearch-head with
    the Elasticsearch `plugin` utility, as follows:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有互联网连接，您可以使用 Elasticsearch 的 `plugin` 工具安装 Elasticsearch-head，如下所示：
- en: '[PRE37]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The location of the `plugin` script may vary.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '`plugin` 脚本的位置可能会有所不同。'
- en: 'The next command assumes that you installed Elasticsearch using the `.rpm`
    or `.deb` file, but if you are unsure where the plugin script is in your installation,
    go ahead and try running the following commands:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个命令假设您使用 `.rpm` 或 `.deb` 文件安装了 Elasticsearch，但如果您不确定插件脚本在您的安装中的位置，请尝试运行以下命令：
- en: '[PRE38]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'For me, this returns the following:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 对于我来说，这返回以下内容：
- en: '[PRE39]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: If you don't have an Internet connection on your Elasticsearch instance, you
    can download the Elasticsearch-head plugin, transfer it to your server, and install
    it using the following methods.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的 Elasticsearch 实例没有互联网连接，您可以下载 Elasticsearch-head 插件，将其传输到您的服务器，并使用以下方法进行安装。
- en: 'From a machine with an Internet connection, we use the following:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 从一个有互联网连接的机器上，我们使用以下方法：
- en: '[PRE40]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'From the Elasticsearch server, we use the following:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Elasticsearch 服务器，我们使用以下方法：
- en: '[PRE41]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'If you run an old version of Elasticsearch, you may have to restart your node
    before you can open Elasticsearch-head:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您运行的是旧版本的 Elasticsearch，您可能需要在打开 Elasticsearch-head 之前重启您的节点：
- en: '[PRE42]'
  id: totrans-158
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Try out the plugin by visiting `http://elasticsearch-server:9200/_plugin/head/`
    (for a test environment, `elasticsearch-server` is probably `localhost`). You
    should see something like the following:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 通过访问 `http://elasticsearch-server:9200/_plugin/head/`（对于测试环境，`elasticsearch-server`
    可能是 `localhost`）来试用此插件。您应该看到以下内容：
- en: '![Installing Elasticsearch-head](img/B03798_02_01.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![安装 Elasticsearch-head](img/B03798_02_01.jpg)'
- en: Installing Bigdesk
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 Bigdesk
- en: Bigdesk is a free, open source Elasticsearch plugin that allows you to see your
    cluster's CPU, memory, and disk usage. It's a great tool to dig into performance
    issues with a cluster and, like Elasticsearch-head, it only needs to be installed
    on one node in your cluster. We still recommend installing it on all nodes for
    redundancy.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: Bigdesk 是一个免费的开源 Elasticsearch 插件，它允许您查看您集群的 CPU、内存和磁盘使用情况。这是一个很好的工具，可以深入挖掘集群的性能问题，并且与
    Elasticsearch-head 类似，它只需要在您的集群中的一个节点上安装。我们仍然建议在所有节点上安装它以提高冗余性。
- en: Here's how to install Bigdesk.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 这是安装 Bigdesk 的方法。
- en: 'Online installation is as follows:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在线安装如下：
- en: '[PRE43]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Offline installation is has more than one method.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 离线安装有多个方法。
- en: 'From a machine with an Internet connection, use the following:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 从一个有互联网连接的机器上，使用以下方法：
- en: '[PRE44]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'From the Elasticsearch server, use the following:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 从 Elasticsearch 服务器，使用以下方法：
- en: '[PRE45]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'As with Elasticsearch-head, if you run an old version of Elasticsearch, you
    may have to restart your node before you can open Bigdesk:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Elasticsearch-head 类似，如果您运行的是旧版本的 Elasticsearch，您可能需要在打开 Bigdesk 之前重启您的节点：
- en: '[PRE46]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Try out the plugin by visiting `http://elasticsearch-server:9200/_plugin/bigdesk/`
    (for a test environment, elasticsearch-server is probably localhost). You should
    see something like the following:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 通过访问`http://elasticsearch-server:9200/_plugin/bigdesk/`（对于测试环境，elasticsearch-server可能是localhost）尝试插件。你应该会看到以下内容：
- en: '![Installing Bigdesk](img/B03798_02_02.jpg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![安装Bigdesk](img/B03798_02_02.jpg)'
- en: Marvel
  id: totrans-175
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Marvel
- en: 'Marvel is a powerful monitoring tool created by the makers of Elasticsearch.
    It''s free for use in development, but there''s a subscription fee to use it in
    production. Marvel consists of the following two components:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: Marvel是由Elasticsearch制作者创建的一个强大的监控工具。在开发中使用它是免费的，但在生产中使用则需要订阅费用。Marvel由以下两个组件组成：
- en: Marvel Agent (requires Marvel License).
  id: totrans-177
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Marvel代理（需要Marvel许可证）。
- en: Marvel Dashboard (requires Kibana).
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: Marvel仪表板（需要Kibana）。
- en: 'To install the Marvel Agent:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Marvel代理：
- en: 'Online installation is as follows:'
  id: totrans-180
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在线安装如下：
- en: '[PRE47]'
  id: totrans-181
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Offline installation is as follows:'
  id: totrans-182
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 离线安装如下：
- en: '[PRE48]'
  id: totrans-183
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Restart Elasticsearch after installing the Marvel Agent:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 安装Marvel代理后重启Elasticsearch：
- en: '[PRE49]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'To install the Marvel Dashboard, use the following steps:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装Marvel仪表板，请按照以下步骤操作：
- en: 'First, install Kibana:'
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 首先，安装Kibana：
- en: '[PRE50]'
  id: totrans-188
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Next, install the Marvel Dashboard as a Kibana plugin:'
  id: totrans-189
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，将Marvel仪表板作为Kibana插件安装：
- en: '[PRE51]'
  id: totrans-190
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Start Kibana:'
  id: totrans-191
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动Kibana：
- en: '[PRE52]'
  id: totrans-192
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'Open the Marvel Dashboard by visiting `http://server-name:5601/` (for a test
    environment, `server-name` is probably `localhost`). You should see something
    like the following:'
  id: totrans-193
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过访问`http://server-name:5601/`（对于测试环境，`server-name`可能是`localhost`）打开Marvel仪表板。你应该会看到以下内容：
- en: '![Marvel](img/B03798_02_03.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![Marvel](img/B03798_02_03.jpg)'
- en: Cluster requirements
  id: totrans-195
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 集群要求
- en: 'The requirements for your cluster—the number of nodes and the hardware specifications
    of each node—depend on several factors, including the following:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 你集群的要求——节点的数量以及每个节点的硬件规格——取决于以下几个因素：
- en: Total volume of data
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据总量
- en: Data ingest rate
  id: totrans-198
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据摄取率
- en: Average record size
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平均记录大小
- en: Data mapping
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据映射
- en: Types of queries being run
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 正在运行的查询类型
- en: System performance requirements
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 系统性能要求
- en: There's no one size fits all formula to determine cluster requirements for a
    given Elasticsearch use case. The best approach is to meticulously test performance
    while changing variables, such as shard size, the number of nodes in the cluster,
    and hardware configurations until an optimal solution is found. This section focuses
    on high-level guidelines to consider when configuring your cluster.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 没有一个通用的公式可以确定特定Elasticsearch用例的集群要求。最佳方法是仔细测试性能，同时改变变量，如分片大小、集群中的节点数量和硬件配置，直到找到最佳解决方案。本节重点介绍在配置你的集群时应考虑的高级指南。
- en: It's a good idea to run at least three nodes in a production environment and
    to set data replication to *1*, which asks Elasticsearch to maintain one copy
    of each shard in the cluster. This configuration will ensure that if a node goes
    down, your cluster won't lose any data.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产环境中运行至少三个节点是一个好主意，并将数据复制设置为*1*，这将要求Elasticsearch在集群中维护每个分片的一个副本。这种配置将确保如果一个节点宕机，你的集群不会丢失任何数据。
- en: Elasticsearch tends to be more memory intensive than CPU intensive. Any modern
    64-bit processor is likely adequate to run Elasticsearch. In general, this favors
    more processor cores over faster clock speeds.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: Elasticsearch通常比CPU密集型更注重内存。任何现代64位处理器都可能是运行Elasticsearch的足够选择。一般来说，这更倾向于更多的处理器核心而不是更快的时钟速度。
- en: Each node in the cluster should have minimum 512 MB of RAM, and half of this
    should be allocated to Elasticsearch. The Elasticsearch documentation recommends
    allocating no more than 30.5 GB of memory to an Elasticsearch node because the
    JVM compresses internally stored memory addresses when heap sizes are less than
    30.5 GB but is no longer able to do so when the allocated heap is larger than
    30.5 GB. A good rule of thumb is to have no more than 64 GB of total memory per
    node. Moreover, when determining your total memory requirement for a cluster,
    you will likely need much less total system memory than your total index size,
    but the specific amount will vary depending on your use case.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 集群中的每个节点应至少有512 MB的RAM，其中一半应分配给Elasticsearch。Elasticsearch文档建议不要将超过30.5 GB的内存分配给Elasticsearch节点，因为当堆大小小于30.5
    GB时，JVM会压缩内部存储的内存地址，但当分配的堆大小超过30.5 GB时，就不再能这样做。一个很好的经验法则是每个节点总内存不超过64 GB。此外，在确定集群的总内存需求时，你可能会需要的总系统内存比总索引大小少得多，但具体数量将取决于你的使用情况。
- en: When considering storage for an Elasticsearch cluster, prefer internal drives
    to **network attached storage** (**NAS**) solutions. Using solid-state drives
    instead of traditional hard drives will greatly improve overall system performance.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 当考虑为 Elasticsearch 集群选择存储时，优先选择内部硬盘而非**网络附加存储**（**NAS**）解决方案。使用固态硬盘代替传统硬盘将大大提升整体系统性能。
- en: Summary
  id: totrans-208
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: This chapter covered Elasticsearch installation, configuration, monitoring tools,
    and cluster requirements. Tools such as Elasticsearch-head, Bigdesk, and Marvel
    all lay the groundwork to monitor your cluster and analyze its performance. However,
    you still have to know what aspects to look for and how to find them. In the next
    chapter, we will examine Elasticsearch-head and Bigdesk further, and discuss important
    things to look for in these tools when monitoring an Elasticsearch cluster.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 本章涵盖了 Elasticsearch 的安装、配置、监控工具和集群需求。例如 Elasticsearch-head、Bigdesk 和 Marvel
    等工具都为监控您的集群和分析其性能奠定了基础。然而，您仍然需要知道要关注哪些方面以及如何找到它们。在下一章中，我们将进一步探讨 Elasticsearch-head
    和 Bigdesk，并讨论在监控 Elasticsearch 集群时这些工具中需要关注的重要事项。
