# 前言

现代软件是由用户希望快速发布新功能、无缺陷的驱动，这无疑是一项极具挑战性的任务。独立开发者已经让位于共同协作开发单一软件产品的开发团队。功能以短周期迭代的方式添加，然后频繁地发布到生产环境中——有时甚至每天一次。

要实现这一点需要开发上的卓越。我们必须确保我们的软件始终准备好部署，并且在发布到生产环境中时没有缺陷。它必须易于我们的开发同事使用。代码必须易于任何人理解和修改。当团队进行这些更改时，我们必须有信心我们的新功能能够正常工作，并且我们没有破坏任何现有功能。

本书汇集了经过验证的技术，有助于将这一现实变为可能。

**测试驱动开发**（***TDD***），SOLID 原则和六边形架构使开发者能够构建已知可以工作且易于使用的代码。开发重点在于软件工程的基本原理。这些实践是易于更改和安全的代码库背后的技术基础，并且始终准备好部署。

本书将使你能够编写出经过良好工程化和测试的代码。你将对自己的代码按预期工作有信心。你将拥有一个不断增长的快速运行的测试套件的安全感，在整个代码库中保持警惕，随着团队进行更改。你将学习如何组织代码以避免由外部系统（如支付服务或数据库引擎）引起的困难。你将减少对较慢测试形式的依赖。

你将能够编写出高质量的代码，适合持续交付的方法。

现代软件需要现代的开发方法。到这本书的结尾，你将掌握应用这些技术的技巧。

# 本书面向对象

本书主要面向熟悉 Java 语言基础且希望在高效敏捷开发团队中发挥作用的开发者。本书中描述的技术可以使你的代码在生产环境中以很少的缺陷交付，并且具有易于更改和安全的结构。这是敏捷的技术基础。

本书的前几章也将对希望在做出承诺之前了解这些方法成本和收益的企业领导者有所帮助。

# 本书涵盖内容

*第一章*，*构建 TDD 的案例*，提供了对 TDD 带来的好处以及我们如何到达这里的理解。

*第二章*，*使用 TDD 创建优质代码*，涵盖了一些有助于我们在应用 TDD 时创建良好工程化代码的一般良好实践。

*第三章*, *消除关于 TDD 的常见误解*，是对我们可能遇到的关于使用 TDD 的常见反对意见的回顾，并提供了克服这些反对意见的建议。本章适合对将新技术引入开发过程可能有所保留的业务领导者。

*第四章*, *使用 TDD 构建应用程序*，涉及设置我们的开发环境，使用 TDD 构建 Wordz 应用程序。它回顾了如何使用用户故事进行短期迭代工作。

*第五章*, *编写我们的第一个测试*，介绍了使用 Arrange、Act 和 Assert 模板的基本 TDD。编写 Wordz 的第一个测试和生产代码，我们将详细探讨 TDD 如何在我们编写代码之前促进设计步骤。我们将考虑各种选项和权衡，然后在一个测试中捕捉这些决策。

*第六章*, *遵循 TDD 的节奏*，展示了红、绿、重构周期作为开发节奏。我们决定编写下一个测试，观察它失败，让它通过，然后精炼我们的代码，使其在未来对团队来说既安全又简单。

*第七章*, *驱动设计 – TDD 与 SOLID*，在前几章的基础上展示了 TDD 如何通过将 SOLID 原则纳入其中来提供对我们设计决策的快速反馈。SOLID 原则是一套有用的指导方针，有助于设计面向对象的代码。本章是对这些原则的回顾，以便我们可以在本书的其余部分应用它们。

*第八章*, *测试替身 – 模拟和存根*，解释了两种关键技术，允许我们用更容易测试的事物替换难以测试的事物。通过这样做，我们可以将更多的代码置于 TDD 单元测试之下，减少我们对较慢的集成测试的需求。

*第九章*, *六边形架构 – 解耦外部系统*，介绍了一种强大的设计技术，使我们能够完全解耦外部系统，如数据库和 Web 服务器，与我们的核心逻辑。在这里，我们将介绍端口和适配器的概念。这简化了 TDD 的使用，并且作为好处，对外部因素强加的任何变化都提供了弹性。

*第十章*, *FIRST 测试与测试金字塔*，概述了测试金字塔作为一种思考全面测试软件系统所需的不同类型测试的方法。我们讨论了单元测试、集成测试和端到端测试，以及每种类型之间的权衡。

*第十一章*，*TDD 如何融入质量保证*，探讨了当使用本书中描述的高级测试自动化时，我们的 QA 工程师从一些可能不得不做的繁琐的详细测试中解放出来。本章探讨了测试现在是如何在整个开发过程中成为整个团队的共同努力，以及我们如何最好地结合我们的技能。

*第十二章*，*先测试，后测试，永不测试*，回顾了基于我们何时编写测试以及我们确切测试什么的几种不同的测试方法。这将帮助我们提高在应用 TDD 时产生的测试质量。

*第十三章*，*驱动领域层*，通过将 TDD、SOLID、测试金字塔和六边形架构应用于 Wordz 的领域层代码，进行了解释。这些技术的结合使我们能够将大部分游戏逻辑置于快速单元测试之下。

*第十四章*，*驱动数据库层*，提供了编写连接到我们的 SQL 数据库 Postgres 的适配器代码的指导，现在我们已经将数据库代码从领域层解耦。我们这样做是先进行测试，使用 Database Rider 测试框架编写集成测试。数据访问代码使用 JDBI 库实现。

*第十五章*，*驱动网络层*，作为本书的最后一章，解释了如何编写一个 HTTP REST API，使我们的 Wordz 游戏可以作为网络服务访问。这是通过使用集成测试来完成的，该测试是使用 Molecule HTTP 服务器库内置的工具编写的。完成这一步后，我们最终将整个微服务连接起来，准备作为一个整体运行。

# 为了充分利用本书

本书假设您了解基本的现代 Java，并可以使用类、JDK 8 lambda 表达式编写简短的程序，并使用 JDK 11 `var`关键字。它还假设您可以使用基本的`git`命令，从网络下载安装软件到您的计算机上，并对 IntelliJ IDEA Java IDE 有基本的了解。SQL、HTTP 和 REST 的基本知识将有助于本书的最后一章。

| **本书涵盖的软件/硬件** | **操作系统要求** |
| --- | --- |
| Amazon Corretto JDK 17 LTS | Windows, macOS, or Linux |
| IntelliJ IDEA 2022.1.3 Community Edition | Windows, macOS, or Linux |
| JUnit 5 | Windows, macOS, or Linux |
| AssertJ | Windows, macOS, or Linux |
| Mockito | Windows, macOS, or Linux |
| `DBRider` | Windows, macOS, or Linux |
| Postgres | Windows, macOS, or Linux |
| `psql` | Windows, macOS, or Linux |
| Molecule | Windows, macOS, or Linux |
| `git` | Windows, macOS, or Linux |

**如果您使用的是本书的数字版，我们建议您亲自输入代码或从书的 GitHub 仓库（下一节中提供链接）获取代码。这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误。**

# 下载示例代码文件

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/Test-Driven-Development-with-Java`](https://github.com/PacktPublishing/Test-Driven-Development-with-Java)。如果代码有更新，它将在 GitHub 仓库中更新。

我们还有其他来自我们丰富的书籍和视频目录的代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 下载彩色图像

我们还提供了一份包含本书中使用的截图和图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/kLcmS`](https://packt.link/kLcmS)。

# 使用的约定

本书使用了许多文本约定。

**文本中的代码**：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“将下载的`WebStorm-10*.dmg`磁盘映像文件作为系统中的另一个磁盘挂载。”

代码块应如下设置：

```java
public class DiceRoll {
    private final int NUMBER_OF_SIDES = 6;
    private final RandomGenerator rnd =
                       RandomGenerator.getDefault();
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将以粗体显示：

```java
public class DiceRoll {
    private final int NUMBER_OF_SIDES = 6;
    private final RandomGenerator rnd =
                       RandomGenerator.getDefault();
```

任何命令行输入或输出都应如下编写：

```java
private final int NUMBER_OF_SIDES = 6
```

**粗体**：表示新术语、重要单词或屏幕上看到的单词。例如，菜单或对话框中的单词以粗体显示。以下是一个示例：“从**管理**面板中选择**系统信息**。”

小贴士或重要提示

看起来像这样。

# 联系我们

我们始终欢迎读者的反馈。

**一般反馈**：如果您对本书的任何方面有疑问，请通过 customercare@packtpub.com 给我们发邮件，并在邮件主题中提及书名。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，如果您能向我们报告，我们将不胜感激。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，如果您能向我们提供位置地址或网站名称，我们将不胜感激。请通过 mailto:copyright@packt.com 与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了 *使用 Java 进行测试驱动开发*，我们非常乐意听到您的想法！请[点击此处直接转到此书的亚马逊评论页面](https://packt.link/r/1-803-23623-X)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

您喜欢在路上阅读，但无法携带您的印刷书籍到处走吗？您的电子书购买是否与您选择的设备不兼容？

别担心，现在每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠不会就此结束，您还可以获得独家折扣、时事通讯和每日免费内容的访问权限。

按照以下简单步骤获取好处：

1.  扫描下面的二维码或访问以下链接

![二维码](img/B18384_QR_Free_PDF.jpg)

[`packt.link/free-ebook/978-1-80323-623-0`](https://packt.link/free-ebook/978-1-80323-623-0)

1.  提交您的购买证明

1.  就这些！我们将直接将您的免费 PDF 和其他好处发送到您的电子邮件

# 第一部分：我们如何到达 TDD

在 *第一部分* 中，我们探讨了我们如何在软件行业中到达 TDD。我们试图用 TDD 解决什么问题？它创造了什么机会？

在以下章节中，我们将学习 TDD 为企业和技术人员带来的好处。我们将回顾优质代码的基本知识，以便我们在开始编写测试时有一个目标。了解团队有时会犹豫开始使用 TDD，我们将探讨六个常见的反对意见以及如何克服它们。

本部分包含以下章节：

+   *第一章*，*构建 TDD 的案例*

+   *第二章*，*使用 TDD 创建优质代码*

+   *第三章*，*消除关于 TDD 的常见误解*
